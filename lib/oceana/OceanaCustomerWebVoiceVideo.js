/*! jQuery v3.5.0 | (c) JS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.5.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),D=function(e,t){return e===t&&(l=!0),0},j={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&j.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(D),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(D).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function D(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(D(this,e||[],!1))},not:function(e){return this.pushStack(D(this,e||[],!0))},is:function(e){return!!D(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var j,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||j,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,j=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)sdk_$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t=Object.create(null),V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):sdk_$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^key/,we=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function Ce(){return!0}function Ee(){return!1}function Se(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function ke(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)ke(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Ee;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Ae(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,Ce)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=Te.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=Te.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ae(t,"click",Ce),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ce:Ee,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Ee,isPropagationStopped:Ee,isImmediatePropagationStopped:Ee,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ce,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ce,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ce,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&be.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&we.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Ae(this,e,Se),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return ke(this,e,t,n,r)},one:function(e,t,n,r){return ke(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ee),this.each(function(){S.event.remove(this,e,n,t)})}});var Ne=/<script|<style|<link/i,De=/checked\s*(?:[^=]|=\s*.checked.)/i,je=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function qe(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Oe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function Pe(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&De.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),Pe(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),Le)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,He),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(je,""),u,l))}return n}function Re(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Oe(o[r],a[r]);else Oe(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return sdk_$(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Pe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||qe(this,e).appendChild(e)})},prepend:function(){return Pe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=qe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Pe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Pe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return sdk_$(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ne.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Pe(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Me=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Ie=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},We=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Fe=new RegExp(ne.join("|"),"i");function Be(e,t,n){var r,i,o,a,s=e.style;return(n=n||Ie(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Me.test(a)&&Fe.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function $e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",n.style.height="9px",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=3<parseInt(r.height),re.removeChild(e)),a}}))}();var _e=["Webkit","Moz","ms"],ze=E.createElement("div").style,Ue={};function Xe(e){var t=S.cssProps[e]||Ue[e];return t||(e in ze?e:Ue[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=_e.length;while(n--)if((e=_e[n]+t)in ze)return e}(e)||e)}var Ve=/^(none|table(?!-c[ea]).+)/,Ge=/^--/,Ye={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:"0",fontWeight:"400"};function Je(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ke(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Ze(e,t,n){var r=Ie(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=Be(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Me.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Ke(e,t,n||(i?"border":"content"),o,r,a)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Ge.test(t),l=e.style;if(u||(t=Xe(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Ge.test(t)||(t=Xe(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Qe&&(i=Qe[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ve.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ze(e,u,n):We(e,Ye,function(){return Ze(e,u,n)})},set:function(e,t,n){var r,i=Ie(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Ke(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Ke(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Je(0,t,s)}}}),S.cssHooks.marginLeft=$e(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Be(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Je)}),S.fn.extend({css:function(e,t){return sdk_$(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Ie(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=et).prototype={constructor:et,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}}).init.prototype=et.prototype,(et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[Xe(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=et.prototype.init,S.fx.step={};var tt,nt,rt,it,ot=/^(?:toggle|show|hide)$/,at=/queueHooks$/;function st(){nt&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(st):C.setTimeout(st,S.fx.interval),S.fx.tick())}function ut(){return C.setTimeout(function(){tt=void 0}),tt=Date.now()}function lt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,n){for(var r,i=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function ft(o,e,t){var n,a,r=0,i=ft.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=tt||ut(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:tt||ut(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=ft.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ct,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(ft,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ft.tweeners[n]=ft.tweeners[n]||[],ft.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ot.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ct(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=ft(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&at.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(lt(r,!0),e,t,n)}}),S.each({slideDown:lt("show"),slideUp:lt("hide"),slideToggle:lt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),tt=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){nt||(nt=!0,st())},S.fx.stop=function(){nt=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},rt=E.createElement("input"),it=E.createElement("select").appendChild(E.createElement("option")),rt.type="checkbox",y.checkOn=""!==rt.value,y.optSelected=it.selected,(rt=E.createElement("input")).value="t",rt.type="radio",y.radioValue="t"===rt.value;var pt,dt=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return sdk_$(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?pt:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),pt={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=dt[t]||S.find.attr;dt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=dt[o],dt[o]=r,r=null!=a(e,t,n)?o:null,dt[o]=i),r}});var ht=/^(?:input|select|textarea|button)$/i,gt=/^(?:a|area)$/i;function vt(e){return(e.match(P)||[]).join(" ")}function yt(e){return e.getAttribute&&e.getAttribute("class")||""}function mt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return sdk_$(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):ht.test(e.nodeName)||gt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,yt(this)))});if((e=mt(t)).length)while(n=this[u++])if(i=yt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,yt(this)))});if(!arguments.length)return this.attr("class","");if((e=mt(t)).length)while(n=this[u++])if(i=yt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,yt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=mt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=yt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+vt(yt(n))+" ").indexOf(t))return!0;return!1}});var xt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(xt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:vt(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var bt=/^(?:focusinfocus|focusoutblur)$/,wt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!bt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,bt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,wt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,wt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var Tt=C.location,Ct={guid:Date.now()},Et=/\?/;S.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||S.error("Invalid XML: "+e),t};var St=/\[\]$/,kt=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,Nt=/^(?:input|select|textarea|keygen)/i;function Dt(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||St.test(n)?i(n,t):Dt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)Dt(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)Dt(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&Nt.test(this.nodeName)&&!At.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var jt=/%20/g,qt=/#.*$/,Lt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ot=/^(?:GET|HEAD)$/,Pt=/^\/\//,Rt={},Mt={},It="*/".concat("*"),Wt=E.createElement("a");function Ft(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Bt(t,i,o,a){var s={},u=t===Mt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function $t(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Wt.href=Tt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Tt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Tt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?$t($t(e,S.ajaxSettings),t):$t(S.ajaxSettings,e)},ajaxPrefilter:Ft(Rt),ajaxTransport:Ft(Mt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Ht.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Tt.href)+"").replace(Pt,Tt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Wt.protocol+"//"+Wt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Bt(Rt,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Ot.test(v.type),f=v.url.replace(qt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(jt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Et.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Lt,"$1"),o=(Et.test(f)?"&":"?")+"_="+Ct.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+It+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Bt(Mt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var _t={0:200,1223:204},zt=S.ajaxSettings.xhr();y.cors=!!zt&&"withCredentials"in zt,y.ajax=zt=!!zt,S.ajaxTransport(function(i){var o,a;if(y.cors||zt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(_t[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var Ut,Xt=[],Vt=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||S.expando+"_"+Ct.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Vt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Vt,"$1"+r):!1!==e.jsonp&&(e.url+=(Et.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Xt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((Ut=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ut.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=vt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):("number"==typeof f.top&&(f.top+="px"),"number"==typeof f.left&&(f.left+="px"),c.css(f))}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return sdk_$(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=$e(y.pixelPosition,function(e,t){if(t)return t=Be(e,n),Me.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return sdk_$(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Gt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Gt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Yt=C.sdk_jQuery,Qt=C.sdk_$;return S.noConflict=function(e){return C.sdk_$===S&&(C.sdk_$=Qt),e&&C.sdk_jQuery===S&&(C.sdk_jQuery=Yt),S},"undefined"==typeof e&&(C.sdk_jQuery=C.sdk_$=S),S});

var xmlToJSON = function () { this.version = "1.3.5"; var e = { mergeCDATA: !0, grokAttr: !0, grokText: !0, normalize: !0, xmlns: !0, namespaceKey: "_ns", textKey: "_text", valueKey: "_value", attrKey: "_attr", cdataKey: "_cdata", attrsAsObject: !0, stripAttrPrefix: !0, stripElemPrefix: !0, childrenAsArray: !0 }, t = new RegExp(/(?!xmlns)^.*:/), r = new RegExp(/^\s+|\s+$/g); return this.grokType = function (e) { return /^\s*$/.test(e) ? null : /^(?:true|false)$/i.test(e) ? "true" === e.toLowerCase() : isFinite(e) ? parseFloat(e) : e }, this.parseString = function (e, t) { return this.parseXML(this.stringToXML(e), t) }, this.parseXML = function (a, n) { for (var s in n) e[s] = n[s]; var l = {}, i = 0, o = ""; if (e.xmlns && a.namespaceURI && (l[e.namespaceKey] = a.namespaceURI), a.attributes && a.attributes.length > 0) { var c = {}; for (i; i < a.attributes.length; i++) { var u = a.attributes.item(i); m = {}; var p = ""; p = e.stripAttrPrefix ? u.name.replace(t, "") : u.name, e.grokAttr ? m[e.valueKey] = this.grokType(u.value.replace(r, "")) : m[e.valueKey] = u.value.replace(r, ""), e.xmlns && u.namespaceURI && (m[e.namespaceKey] = u.namespaceURI), e.attrsAsObject ? c[p] = m : l[e.attrKey + p] = m } e.attrsAsObject && (l[e.attrKey] = c) } if (a.hasChildNodes()) for (var y, d, m, h = 0; h < a.childNodes.length; h++)4 === (y = a.childNodes.item(h)).nodeType ? e.mergeCDATA ? o += y.nodeValue : l.hasOwnProperty(e.cdataKey) ? (l[e.cdataKey].constructor !== Array && (l[e.cdataKey] = [l[e.cdataKey]]), l[e.cdataKey].push(y.nodeValue)) : e.childrenAsArray ? (l[e.cdataKey] = [], l[e.cdataKey].push(y.nodeValue)) : l[e.cdataKey] = y.nodeValue : 3 === y.nodeType ? o += y.nodeValue : 1 === y.nodeType && (0 === i && (l = {}), d = e.stripElemPrefix ? y.nodeName.replace(t, "") : y.nodeName, m = xmlToJSON.parseXML(y), l.hasOwnProperty(d) ? (l[d].constructor !== Array && (l[d] = [l[d]]), l[d].push(m)) : (e.childrenAsArray ? (l[d] = [], l[d].push(m)) : l[d] = m, i++)); else o || (e.childrenAsArray ? (l[e.textKey] = [], l[e.textKey].push(null)) : l[e.textKey] = null); if (o) if (e.grokText) { var x = this.grokType(o.replace(r, "")); null !== x && void 0 !== x && (l[e.textKey] = x) } else e.normalize ? l[e.textKey] = o.replace(r, "").replace(/\s+/g, " ") : l[e.textKey] = o.replace(r, ""); return l }, this.xmlToString = function (e) { try { return e.xml ? e.xml : (new XMLSerializer).serializeToString(e) } catch (e) { return null } }, this.stringToXML = function (e) { try { var t = null; return window.DOMParser ? t = (new DOMParser).parseFromString(e, "text/xml") : (t = new ActiveXObject("Microsoft.XMLDOM"), t.async = !1, t.loadXML(e), t) } catch (e) { return null } }, this }.call({}); "undefined" != typeof module && null !== module && module.exports ? module.exports = xmlToJSON : "function" == typeof define && define.amd && define(function () { return xmlToJSON });
!function(T){var S=jQuery;!function(e){"use strict";function i(e){this.clientConfiguration=e,this.user=T,this.mediaServicesFactory=T,this.version="4.8.0.29.1",i.Base.Logger.clearLoggers()}i.prototype={createUser:function(e){return this.user||(this.mediaServicesFactory===T&&(this.mediaServicesFactory=new i.Base.MediaServicesFactory),this.user=new i.User(e,this.mediaServicesFactory,this.version)),this.user},registerLogger:function(e,t){i.Base.Logger.addLogger(e,t)},getMediaServices:function(){return this.mediaServicesFactory===T&&(this.mediaServicesFactory=new i.Base.MediaServicesFactory),this.mediaServicesFactory.getMediaServices()},getVersion:function(){return this.version}},e.AvayaClientServices=i}(window),function(e){"use strict";e.Base=e.Base||{},e.Config=e.Config||{},e.Services=e.Services||{},e.Services.Call=e.Services.Call||{},e.Services.Collaboration=e.Services.Collaboration||{},e.Services.Messaging=e.Services.Messaging||{},e.Services.Conference=e.Services.Conference||{},e.Services.Contacts=e.Services.Contacts||{},e.Services.ContentSharing=e.Services.ContentSharing||{},e.Services.Presence=e.Services.Presence||{},e.Services.VoiceMessaging=e.Services.VoiceMessaging||{}}(AvayaClientServices),function(e){"use strict";e.Base.Validators=e.Base.Validators||{},e.Providers=e.Providers||{},e.Providers.Analytics=e.Providers.Analytics||{},e.Providers.Interfaces=e.Providers.Interfaces||{},e.Providers.AMM=e.Providers.AMM||{},e.Providers.Call=e.Providers.Call||{},e.Providers.CallGateway=e.Providers.CallGateway||{},e.Providers.CallServiceGateway=e.Providers.CallServiceGateway||{},e.Providers.Scopia=e.Providers.Scopia||{},e.Providers.CM=e.Providers.CM||{},e.Providers.Focus=e.Providers.Focus||{},e.Providers.Mpaas=e.Providers.Mpaas||{},e.Providers.RemoteLogger=e.Providers.RemoteLogger||{},e.Providers.RTC=e.Providers.RTC||{},e.Providers.UCCP=e.Providers.UCCP||{},e.Providers.WCS=e.Providers.WCS||{},e.User=e.User||{},e.Services.Call=e.Services.Call||{},e.Services.Call.Capabilities=e.Services.Call.Capabilities||{},e.Services.Call.Modes=e.Services.Call.Modes||{},e.Services.SessionLogs=e.Services.SessionLogs||{},e.Services.Messaging.Common=e.Services.Messaging.Common||{},e.Providers.ACS=e.Providers.ACS||{},e.Services.SessionLogs=e.Services.SessionLogs||{},e.Providers.ContentSharing=e.Providers.ContentSharing||{},e.Services.Analytics=e.Services.Analytics||{},e.Config.Authentication=e.Config.Authentication||{}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbsoluteCategoryRating={EXCELLENT:5,GOOD:4,FAIR:3,POOR:2,BAD:1}}(),function(e){"use strict";function t(e,t){this.pointcutType=e,this.adviceFunction=t}t.prototype={},e.Base.AOPAdvice=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AOPPointcutType={BEFORE:"BEFORE",AROUND:"AROUND"}}(),function(o){"use strict";var c={_exceptionCallbacks:S.Callbacks(),addAdvices:function(e,t,i,a){for(var r=0;r<i.length;r++)c.addAdvicesToProperty(e,t,i[r],a)},addAdvicesToProperty:function(e,t,i,a){var r=c._getAdviceFunction(o.Base.AOPPointcutType.BEFORE,a),s=c._getAdviceFunction(o.Base.AOPPointcutType.AROUND,a),n=e.prototype[i];if("function"!=typeof n)throw Error("AOPTools: "+t+"."+i+" is not a function.");e.prototype[i]=function(){return r&&r(e,t,i,arguments),s?s(e,t,i,this,n,arguments):n.apply(this,arguments)}},addOnExceptionCallback:function(e){c._exceptionCallbacks.add(e)},removeOnExceptionCallback:function(e){c._exceptionCallbacks.remove(e)},triggerExceptionCallback:function(e){c._exceptionCallbacks.fire(e)},_getAdviceFunction:function(e,t){for(var i=0;i<t.length;i++)if(t[i].pointcutType===e)return t[i].adviceFunction}};o.Base.AOPTools=c}(AvayaClientServices),function(e){"use strict";function t(e,t){Error.call(this,e),this.message=e,this.name="BaseError",this._data=t}(t.prototype=Object.create(Error.prototype)).getMessage=function(){return this.message},t.prototype.getData=function(){return this._data},t.prototype.getName=function(){return this.name},e.Base.BaseError=t}(AvayaClientServices),function(){"use strict";S.ajaxTransport("+binary",function(d){var C;if(window.FormData&&(d.dataType&&"binary"===d.dataType||d.data&&(window.ArrayBuffer&&d.data instanceof ArrayBuffer||window.Blob&&d.data instanceof Blob)))return{send:function(e,t){C=new window.XMLHttpRequest;var i,a=d.url,r=d.type,s=d.async||!0,n=d.data||null,o=d.username||null,c=d.password||null,l=0;for(i in C.addEventListener("load",function(){var e={};e[d.dataType]=C.response,t(C.status,C.statusText,e,C.getAllResponseHeaders()),l=0}),C.addEventListener("progress",function(){this.readyState&&this.response&&("function"==typeof d.binaryProgressCallback&&d.binaryProgressCallback(AvayaClientServices.Base.Utils.stringToArrayBuffer(this.response.slice(l))),l=this.responseText.length)},!1),C.addEventListener("readystatechange",function(){this.readyState&&d.keepAliveCallback&&d.keepAliveCallback(this.readyState)}),C.open(r,a,s,o,c),C.overrideMimeType("text/xml; charset=x-user-defined"),e)e.hasOwnProperty(i)&&C.setRequestHeader(i,e[i]);C.responseType="text",C.send(n)},abort:function(){C.abort()}}})}(),function(){"use strict";AvayaClientServices.Base.BrowserSubType={CHROME_EXTENSION:"chrome_extension",FIREFOX_EXTENSION:"moz_extension",ELECTRON:"electon",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.BrowserType={CHROME:"chrome",FIREFOX:"firefox",IE:"ie",SAFARI:"safari",EDGE:"edge",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.CacheOptions=function(){this.maxElements=T,this.timeToLive=T,this.auditInterval=T}}(),function(){"use strict";AvayaClientServices.Base.ElementCacheEvents={ELEMENT_ADDED:"ELEMENT_ADDED",ELEMENT_UPDATED:"ELEMENT_UPDATED",ELEMENT_DELETED:"ELEMENT_DELETED"}}(),function(){"use strict";AvayaClientServices.Base.IMDBSearchOptions={EXACT_MATCH:"EXACT_MATCH",CONTAINS:"CONTAINS",BEGINS_WITH:"BEGINS_WITH"}}(),function(C){"use strict";function e(e,t){this._validateKeyNames(e),this._cache=new C.Base.ElementCache(t),this._cache.on(C.Base.ElementCacheEvents.ELEMENT_DELETED,function(e){this._onCacheElementsDelete(e)}.bind(this)),this._keyToCacheIds={};for(var i=0;i<e.length;i++)this._keyToCacheIds[e[i]]={};this._cacheIdLength=6,this._generateIdFailureCounter=0}e.prototype.addElement=function(e,t){var i=new Date;this._validateKeys(e);var a=this._generateCacheId(),r={keys:e,element:t,cacheId:a};if(!this._cache.addElement(a,r)){t="SimpleIMDB: Failed to add object to underlying single-key cache. CacheId: "+a;throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,t,r),new Error(t)}this._addCacheIdWithKeys(a,e),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added element in "+(new Date-i)+" milliseconds")},e.prototype.addElements=function(e){for(var t=new Date,i=[],a=[],r=this.getCacheMaxSize(),s=e.length,n=(i=r&&r<s?e.slice(-r):e.slice()).length,o=0;o<n;o++)try{this._validateKeys(i[o].keys);var c=this._generateCacheId();i[o].elementId=c,a.push({elementId:c,element:i[o]})}catch(e){i.splice(o,1),C.Base.Logger.error(C.Base.LoggerTags.CACHE,"Invalid keys of object",e)}var l=this._cache.addElements(a);for(o=0;o<l.length;o++)this._addCacheIdWithKeys(l[o].elementId,l[o].element.keys);C.Base.Logger.info(C.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added elements in "+(new Date-t)+" milliseconds")},e.prototype.getCacheMaxSize=function(){return this._cache.getCacheMaxSize()},e.prototype._addCacheIdWithKeys=function(e,t){for(var i in t)if(t.hasOwnProperty(i))for(var a=t[i],r=0;r<a.length;r++)this._keyToCacheIds[i][a[r]]===T&&(this._keyToCacheIds[i][a[r]]=[]),this._keyToCacheIds[i][a[r]].push(e)},e.prototype.updateElement=function(e,t,i){var a=new Date;this._validateKeys(e),this._validateKeys(t);var r,s=this.searchByKeys(e);if(1<s.length)throw r="SimpleIMDB: Update failed because multiple objects found",C.Base.Logger.error(C.Base.LoggerTags.CACHE,r),new Error(r);if(s.length<1)throw r="SimpleIMDB: Can not find object to update",C.Base.Logger.error(C.Base.LoggerTags.CACHE,r),new Error(r);this.deleteElements(e),this.addElement(t,i),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Successfully updated element in "+(new Date-a)+" milliseconds")},e.prototype.deleteElements=function(e){for(var t=new Date,i=this._resolveCacheIdsByKeys(e),a=0,r=0;r<i.length;r++){var s=this._cache.getElement(i[r]);s&&(a++,this._cache.deleteElement(i[r])||C.Base.Logger.warn(C.Base.LoggerTags.CACHE,"Failed to delete object with cacheId "+i[r]+" from underlying cache"),s.keys&&this._deleteCacheIdByKeys(i[r],s.keys))}C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Deleted "+a+" element(s) successfully in "+(new Date-t)+" milliseconds")},e.prototype.searchByKeys=function(e,t){for(var i=new Date,a=[],r=this._resolveCacheIdsByKeys(e,t),s=0;s<r.length;s++){var n=this._cache.getElement(r[s]);n&&n.element&&a.push(n.element)}return a=C.Base.Utils.removeDuplicatesFromArray(a),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Found "+a.length+" results in "+(new Date-i)+" milliseconds"),a},e.prototype.searchBySingleKey=function(e,t,i){var a={};return a[e]=[t],this.searchByKeys(a,i)},e.prototype.searchByAllKeys=function(e,t){var i,a=new Date,r=[],s=[];for(i in this._keyToCacheIds)if(this._keyToCacheIds.hasOwnProperty(i)){var n=this._findMatchingValues(i,e,t);if(n)for(var o=0;o<n.length;o++)s=s.concat(this._keyToCacheIds[i][n[o]])}for(var c=0;c<s.length;c++){var l=this._cache.getElement(s[c]);l&&l.element&&r.push(l.element)}return r=C.Base.Utils.removeDuplicatesFromArray(r),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Found "+r.length+" results in "+(new Date-a)+" milliseconds"),r},e.prototype.getAllElements=function(){return this._cache.getAllElements().map(function(e){return e.element})},e.prototype._deleteCacheIdByKeys=function(e,t){for(var i in t)if(t.hasOwnProperty(i))for(var a=t[i],r=0;r<a.length;r++){var s=this._keyToCacheIds[i][a[r]],n=s.indexOf(e);0<=n&&s.splice(n,1)}},e.prototype._resolveCacheIdsByKeys=function(e,t){this._validateKeys(e);var i,a,r,s=[];for(r in e)if(e.hasOwnProperty(r)){a=e[i=r][0];break}var n=this._findMatchingValues(i,a,t),o=[];if(n){for(var c=0;c<n.length;c++)o=o.concat(this._keyToCacheIds[i][n[c]]);for(c=0;c<o.length;c++){var l=o[c],d=this._cache.getElement(l);d?this._areKeys1SubsetOfKeys2(e,d.keys,t)&&s.push(l):C.Base.Logger.warn(C.Base.LoggerTags.CACHE,"Cache object with id "+l+" is not found in underlying single-key cache")}}return s},e.prototype._findMatchingValues=function(e,t,i){return i&&i!==C.Base.IMDBSearchOptions.EXACT_MATCH?Object.keys(this._keyToCacheIds[e]).filter(function(e){return i===C.Base.IMDBSearchOptions.CONTAINS?-1<e.indexOf(t):i===C.Base.IMDBSearchOptions.BEGINS_WITH?0===e.indexOf(t):void 0}):this._keyToCacheIds[e].hasOwnProperty(t)?[t]:void 0},e.prototype._areKeys1SubsetOfKeys2=function(e,t,s){function i(e,t){for(var i,a,r=0;r<t.length;r++)if(i=e,a=t[r],s&&s!==n.EXACT_MATCH?s===n.CONTAINS?-1<a.indexOf(i):s===n.BEGINS_WITH?0===a.indexOf(i):void 0:a===i)return 1}var a,n=C.Base.IMDBSearchOptions;for(a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a))return!1;for(var r=0;r<e[a].length;r++)if(!i(e[a][r],t[a]))return!1}return!0},e.prototype._validateKeyNames=function(e){if(!e||!(e instanceof Array)||e.length<1)throw new Error('SimpleIMDB: "keyNames" argument is invalid. It should be of Array type and have at least one element. keyNames: '+JSON.stringify(e));for(var t=0;t<e.length;t++)if("string"!=typeof e[t])throw new Error("SimpleIMDB: Cache key name "+JSON.stringify(e[t])+" is not of String type. Type: "+typeof e[t])},e.prototype._validateKeys=function(e){var t,i;for(t in e)if(e.hasOwnProperty(t)){if(this._keyToCacheIds[t]===T)throw i="Key name "+t+" is not registered for this IMDB",C.Base.Logger.error(C.Base.LoggerTags.CACHE,i),new Error(i);for(var a=e[t],r=0;r<a.length;r++){var s=a[r];if("string"!=typeof s)throw i="Value "+JSON.stringify(s)+" of key "+t+" is not of string type",C.Base.Logger.error(C.Base.LoggerTags.CACHE,i),new Error(i);if(""===s)throw i="Key "+t+" has empty value",C.Base.Logger.error(C.Base.LoggerTags.CACHE,i),new Error(i)}}},e.prototype._generateCacheId=function(){for(var e,t;!e;)t=C.Base.Utils.makeId(this._cacheIdLength),this._cache.getElement(t)&&++this._generateIdFailureCounter>this._cacheIdLength&&this._cacheIdLength++,e=t;return this._generateIdFailureCounter=0,e},e.prototype._onCacheElementsDelete=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.cacheId&&i.keys?this._deleteCacheIdByKeys(i.cacheId,i.keys):C.Base.Logger.error(C.Base.LoggerTags.CACHE,"Invalid cache object",i)}},C.Base.SimpleIMDB=e}(AvayaClientServices),function(t){"use strict";function e(e){this.isAllowed=e===t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,this.denialReason=e,this._onChangedCallbacks=S.Callbacks()}e.prototype={addOnChangedCallback:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.add(e)},removeOnChangedCallback:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.remove(e)},_updateIfChanged:function(e,t){this.isAllowed===e&&this.denialReason===t||(this.isAllowed=e,this.denialReason=t,this._onChangedCallbacks.fire(this))}},t.Base.Capability=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CapabilityDenialReason={CAPABILITY_NOT_DENIED:"CAPABILITY_NOT_DENIED",CAPABILITY_INVALID_STATE:"CAPABILITY_INVALID_STATE",CAPABILITY_NOT_SUPPORTED:"CAPABILITY_NOT_SUPPORTED",CAPABILITY_CALL_IS_REMOTE:"CAPABILITY_CALL_IS_REMOTE",CAPABILITY_CALL_IS_NOT_REMOTE:"CAPABILITY_CALL_IS_NOT_REMOTE",CAPABILITY_CALL_HAS_NO_AUDIO:"CAPABILITY_CALL_HAS_NO_AUDIO",CAPABILITY_CALL_HAS_NO_VIDEO:"CAPABILITY_CALL_HAS_NO_VIDEO",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CAPABILITY_NEED_SIGNIN:"CAPABILITY_NEED_SIGNIN",CAPABILITY_NEED_MODERATOR:"CAPABILITY_NEED_MODERATOR",CAPABILITY_NEED_SIGNIN_OR_MODERATOR:"CAPABILITY_NEED_SIGNIN_OR_MODERATOR",CAPABILITY_NOT_INSTALLED:"CAPABILITY_NOT_INSTALLED",CAPABILITY_NOT_CONFERENCE_OWNER:"CAPABILITY_NOT_CONFERENCE_OWNER",CAPABILITY_HARDWARE_NOT_SUPPORTED:"CAPABILITY_HARDWARE_NOT_SUPPORTED"}}(),function(t){"use strict";function e(e){this._dataSet=e||new t.Base.DataSet,this._status=t.Base.DataRetrievalStatus.IN_PROGRESS,this.isCancelled=!1,this.isCompleted=!1,this._dataRetrievalProgress=S.Callbacks(),this._dataRetrievalDone=S.Callbacks(),this._dataRetrievalFailed=S.Callbacks(),this._onCancel=T}e.prototype={cancel:function(){this._status===t.Base.DataRetrievalStatus.IN_PROGRESS&&(this._status=t.Base.DataRetrievalStatus.CANCELLED,this.isCancelled=!0,t.Base.Utils.isDefined(this._onCancel)&&this._onCancel())},getDataSet:function(){return this._dataSet},_getStatus:function(){return this._status}},t.Base.DataRetrieval=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Base.DataRetrieval.prototype,{addOnDataRetrievalProgressCallback:function(e){this._dataRetrievalProgress.add(e)},removeOnDataRetrievalProgressCallback:function(e){this._dataRetrievalProgress.remove(e)},addOnDataRetrievalDoneCallback:function(e){this._dataRetrievalDone.add(e)},removeOnDataRetrievalDoneCallback:function(e){this._dataRetrievalDone.remove(e)},addOnDataRetrievalFailedCallback:function(e){this._dataRetrievalFailed.add(e)},removeOnDataRetrievalFailedCallback:function(e){this._dataRetrievalFailed.remove(e)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataRetrievalStatus={IN_PROGRESS:"IN_PROGRESS",DONE:"DONE",CANCELLED:"CANCELLED",FAILED:"FAILED"}}(),function(e){"use strict";function t(){Array.apply(this),this.dataSetChangeCallbacks=S.Callbacks(),this.dataSetInvalidatedCallbacks=S.Callbacks()}(t.prototype=Object.create(Array.prototype)).addOnDataSetChangedCallback=function(e){this.dataSetChangeCallbacks.add(e)},t.prototype.removeOnDataSetChangedCallback=function(e){this.dataSetChangeCallbacks.remove(e)},t.prototype.onDataSetChanged=function(e,t){this.dataSetChangeCallbacks.fire(e,t)},t.prototype.addOnDataSetInvalidatedCallback=function(e){this.dataSetInvalidatedCallbacks.add(e)},t.prototype.removeOnDataSetInvalidatedCallback=function(e){this.dataSetInvalidatedCallbacks.remove(e)},t.prototype.onDataSetInvalidated=function(){this.dataSetInvalidatedCallbacks.fire(this)},e.Base.DataSet=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataSetChangeTypes={ADDED:"ADDED",REMOVED:"REMOVED",UPDATED:"UPDATED"}}(),function(){"use strict";AvayaClientServices.Base.DeferredStates={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"}}(),function(e){"use strict";var t={INDETERMINATE:"INDETERMINATE",DETERMINATE:"DETERMINATE"};e.Base.Determinateness=function(e){if(void 0!==t[e])return t[e]}}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={generateBatteryLogs:function(e){var t=S.Deferred(),i=[];i.push("----------------------------------"),i.push("Version: "+e.applicationBuildNumber);e="Unknown";return-1!==window.navigator.userAgent.indexOf("Windows NT 10")?e="Windows 10":-1!==window.navigator.userAgent.indexOf("Windows NT 6.2")?e="Windows 8":-1!==window.navigator.userAgent.indexOf("Windows NT 6.1")?e="Windows 7":-1!==window.navigator.userAgent.indexOf("Windows NT 6.0")?e="Windows Vista":-1!==window.navigator.userAgent.indexOf("Windows NT 5.1")?e="Windows XP":-1!==window.navigator.userAgent.indexOf("Windows NT 5.0")?e="Windows 2000":-1!==window.navigator.userAgent.indexOf("Mac")?e="Mac/iOS":-1!==window.navigator.userAgent.indexOf("X11")?e="UNIX":-1!==window.navigator.userAgent.indexOf("Android")?e="Android":-1!==window.navigator.userAgent.indexOf("iPad")?e="iPad":-1!==window.navigator.userAgent.indexOf("iPhone")?e="iPhone":-1!==window.navigator.userAgent.indexOf("Linux")&&(e="Linux"),i.push("Operating system: "+e),navigator.getBattery&&"function"==typeof navigator.getBattery?navigator.getBattery().then(function(e){i.push("Is Battery Charging : "+e.charging),i.push("Battery Level (%) : "+(100*e.level).toFixed(0)+"%"),i.push("----------------------------------"),t.resolve(i)},function(){i.push("Battery Level (%) : Unavailable"),i.push("----------------------------------"),t.resolve(i)}):(i.push("Battery Level (%) : Unavailable"),i.push("----------------------------------"),t.resolve(i)),t.promise()},generateMessagingLogs:function(e){var t=S.Deferred(),i=[];return e?(i.push("Number of active conversations: "+e._messagingService.conversations.length),i.push("Number of active messages: "+e._messagingService.conversations.reduce(function(e,t){return e+t.getTotalMessageCount()},0)),i.push("Number of draft conversations: "+e.getDraftConversations().length),i.push("Number of draft messages: "+e._messagingService.conversations.reduce(function(e,t){return e+t._draftMessages.length},0))):i.push("Messaging module is unavailable."),t.resolve(i),i.push("----------------------------------"),t.promise()},generateContactsLogs:function(e){var t=S.Deferred(),i=[];return e?i.push("Number of contacts in cache: "+e._contactsService._contactsDataSet.length):i.push("Contacts module is unavailable."),i.push("----------------------------------"),t.resolve(i),t.promise()},generateCallLogs:function(e){var t=S.Deferred(),i=[];return e?i.push("Number of calls: "+e.getCallCount()):i.push("Calls module is unavailable."),i.push("----------------------------------"),t.resolve(i),t.promise()},generatePerformanceLogs:function(){var e=S.Deferred(),t=[];return t.push("Request time: "+(window.performance.timing.responseEnd-window.performance.timing.requestStart)+"ms"),t.push("Load time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.requestStart)+"ms"),t.push("DOM content loaded time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.domContentLoadedEventStart)+"ms"),t.push("----------------------------------"),window.performance.memory?(t.push("JS Heap Size Limit: "+window.performance.memory.jsHeapSizeLimit),t.push("Total JS Heap Size: "+window.performance.memory.totalJSHeapSize),t.push("Used JS Heap Size: "+window.performance.memory.usedJSHeapSize)):t.push("Memory info is unavailable."),t.push("----------------------------------"),e.resolve(t),e.promise()}},e.Base.DiagnosticDataGenerator=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ErrorReasons={CAPABILITY_INVALID_STATE:"Service is in invalid state.",CAPABILITY_NOT_SUPPORTED:"Feature is not supported.",CAPABILITY_CALL_IS_REMOTE:"",CAPABILITY_CALL_IS_NOT_REMOTE:"",CAPABILITY_CALL_HAS_NO_AUDIO:"",CAPABILITY_CALL_HAS_NO_VIDEO:"",CAPABILITY_NOT_ALLOWED:"Action is not allowed.",CAPABILITY_NEED_SIGN_IN:"",CAPABILITY_NEED_MODERATOR:"",CAPABILITY_NEED_SIGN_IN_OR_MODERATOR:"",CAPABILITY_NOT_INSTALLED:"Extension is not installed.",NETWORK_ERROR:"Failed to perform operation. Network error occurred.",NETWORK_UNAUTHORIZED:"Failed to perform operation due to authorization failure.",NETWORK_AUTHORIZATION_CANCELED:"Failed to perform operation due to canceled authentication.",NETWORK_CANCELED:"Failed to perform operation. Operation was canceled.",INTERNAL_ERROR:"An internal error occurred.",TIMEOUT:"An operation has timed out",LIBRARY_NOT_SUPPORTED:"Library is not supported.",DEPRECATED:"Use of deprecated API is not recommended as if this function may be removed in the future.",BACKOFF_ALGORITHM_CANCELLED:"Backoff Algorithm canceled."}}(),function(t){"use strict";var e={jQuery:{setHandle:function(e){return t.Base.Library.Service.jQuery.setHandle(e)}}};t.Base.Library=e}(AvayaClientServices),function(i){"use strict";function e(){this._onVersionChangedCallbacks=[]}i.Base.Library.Service={SUPPORT_EXTENT_FULL:0,SUPPORT_EXTENT_COMPATIBLE:1,SUPPORT_EXTENT_NONE:2,jQuery:new e},e.prototype.setHandle=function(e){return!!this._isHandle(e)&&(this._triggerCallbacks(e),!0)},e.prototype.addOnVersionChangedCallback=function(e){e instanceof Function&&this._onVersionChangedCallbacks.push(e)},e.prototype.getSupportExtent=function(){var e=this.getSupportedVersion(),t=this.getCurrentVersion();if(t===e)return i.Base.Library.Service.SUPPORT_EXTENT_FULL;e=this._parseMajorVersion(e);return this._parseMajorVersion(t)===e?i.Base.Library.Service.SUPPORT_EXTENT_COMPATIBLE:i.Base.Library.Service.SUPPORT_EXTENT_NONE},e.prototype.getSupportedVersion=function(){return"3.6.0"},e.prototype.getCurrentVersion=function(){return S.fn.jquery},e.prototype._isHandle=function(e){return e!==T&&e.fn!==T&&e.fn.jquery!==T&&e.fn.jquery!==this.getCurrentVersion()},e.prototype._triggerCallbacks=function(e){for(var t=0;t<this._onVersionChangedCallbacks.length;++t)this._onVersionChangedCallbacks[t](e)},e.prototype._parseMajorVersion=function(e){return parseInt(e.split(".").shift())}}(AvayaClientServices),function(){"use strict";var r,c,l=[],d=!1,C=!1;function i(s,e){var n,t,o,i,a;d&&(a=e[0]+": "+e[1],(n=Array.prototype.slice.call(e,1))[0]=a),C&&(t=(i=new Date).toLocaleString("en"),(a=i.getTimezoneOffset())!==c&&(i=function(e){var t="-",i=-9<e&&e<9?"0":"";return e<0&&(t="+",e*=-1),t+i+Math.floor(e)}(a=(i=c=a)/60),a=a===parseInt(a,10)?"00":"30",r="UTC"+i+":"+a),t="["+t+", "+r+"] "+e[0]+": "+e[1],(o=Array.prototype.slice.call(e,1))[0]=t),l.forEach(function(e){var t,i,a,r=e.disableTimestamps?n:o;"function"==typeof e[s]?(t=e,i=s,a=r,AvayaClientServices.Base.Utils.isDefined(a)&&t[i].apply(t,a)):(a=e,e=s,r=r,AvayaClientServices.Base.Utils.isDefined(r)&&a.log(e,r))})}AvayaClientServices.Base.Logger={info:function(e,t){i("info",arguments)},error:function(e,t){i("error",arguments)},fatal:function(e,t){i("fatal",arguments)},debug:function(e,t){i("debug",arguments)},trace:function(e,t){i("trace",arguments)},warn:function(e,t){i("warn",arguments)},addLogger:function(e,t){if(!e||void 0===e.log)throw new TypeError("Logger should implement log method.");e.disableTimestamps=t,e.disableTimestamps?d=!0:C=!0,l.push(e)},removeLogger:function(e){e=l.indexOf(e);if(-1===e)throw new Error("Specified error does not exist.");l.splice(e,1)},clearLoggers:function(){l=[]}}}(),function(){"use strict";function e(){this.disableTimestamps=!1}e.prototype={info:function(e,t){},warn:function(e,t){},error:function(e,t){},fatal:function(e,t){},debug:function(e,t){},trace:function(e,t){}},AvayaClientServices.Base.LoggerInterface=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.LoggerTags={CACHE:"Cache",MEDIA_ENGINE:"MediaEngine",NETWORK_PROVIDER:"NetworkProvider",REST_NETWORK_PROVIDER:"RESTNetworkProvider",WEBSOCKET_NETWORK_PROVIDER:"WebSocketNetworkProvider",RTC_CALL_CONNECTION_PROVIDER:"RTCCallConnectionProvider",BANDWIDTH_MANAGER:"BandwidthManager",FSM:"FSM",SETTINGS_FILE_PARSER:"SettingsFileParser",UTILS:"Utils",ANALYTICS_SERVICE:"AnalyticsService",CALL_SERVICE:"CallService",COLLABORATION_SERVICE:"CollaborationService",CONFERENCE_SERVICE:"ConferenceService",CONTACTS_SERVICE:"ContactsService",MESSAGING_SERVICE:"MessagingService",PRESENCE_SERVICE:"PresenceService",VOICE_MESSAGING_SERVICE:"VoiceMessagingService",USER_SERVICE:"UserService",CHAT_SERVICE:"ChatService",ACS_CONTACTS_PROVIDER:"ACSContactsProvider",AMM_MESSAGING_PROVIDER:"AMMMessagingProvider",ANALYTICS_PROVIDER:"AnalyticsProvider",CALL_PROVIDER:"CallProvider",CALL_GATEWAY_PROVIDER:"CallGatewayProvider",CSG_PRESENCE_AND_CALL_PROVIDER:"CSGPresenceAndCallProvider",CM_CONFERENCE_PROVIDER:"CMConfProvider",CONTENT_SHARING_COLLABORATION_PROVIDER:"ContentSharingCollabProvider",SCOPIA_CONFERENCE_PROVIDER:"ScopiaConfProvider",UCCP_CONFERENCE_PROVIDER:"UCCPConfProvider",WCS_COLLABORATION_PROVIDER:"WCSCollabProvider",WCS_CONTENT_SHARING_HANDLER:"WCSContentSharingHandler",CALL_STATISTICS:"CallStatistics",CALL_PERFORMANCE_MONITOR:"CallPerformanceMonitor",PARTICIPANT_SERVICE:"ParticipantService"}}(),function(e){"use strict";function t(e,t,i,a){this._kind=a,this._deviceId=e,this._groupId=t,this._label=i}t.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return("audioinput"===this._kind?"Mic":"Speaker")+" [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},e.Base.AudioDevice=t}(AvayaClientServices),function(s){"use strict";function e(){this._audioContext=T,this._volume=1,this._mediaStreamContextMap={}}function n(e,t,i){this.gainFilter=e,this.mediaStreamSource=t,this.origAudioTrack=i}e.prototype.stop=function(){this._audioContext&&(this._audioContext.close&&this._audioContext.close(),this._audioContext=T),this._mediaStreamContextMap={}},e.prototype._initAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e?s.Base.Utils.isUndefined(this._audioContext)&&(this._audioContext=new e):s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Web Audio APIs are unavailable on this browser")},e.prototype.setVolume=function(e){if(1<e||e<0)throw new RangeError("Volume must be a double between 0 and 1");if(this._volume=e,s.Base.Utils.isDefined(this._audioContext))for(var t in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(this._mediaStreamContextMap[t].gainFilter.gain.value=this._volume)},e.prototype.getVolume=function(){return this._volume},e.prototype.addMediaStream=function(e){var t,i,a,r;s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Adding MediaStream to AudioInputVolumeController "+e.id),this._initAudioContext(),s.Base.Utils.isDefined(this._audioContext)&&(t=this._audioContext.createGain(),(i=this._audioContext.createMediaStreamSource(e)).connect(t),a=(r=this._audioContext.createMediaStreamDestination()).stream,t.connect(r),t.gain.value=this._volume,r=e.getAudioTracks()[0],e.addTrack(a.getAudioTracks()[0]),r.stop(),e.removeTrack(r),this._mediaStreamContextMap[e.id]=new n(t,i,r))},e.prototype.removeMediaStream=function(e){var t;s.Base.Utils.isDefined(this._audioContext)&&e&&(s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Removing MediaStream from AudioInputVolumeController "+e.id),t=this._mediaStreamContextMap[e.id],s.Base.Utils.isDefined(t)&&s.Base.Utils.isDefined(t.mediaStreamSource)&&(t.mediaStreamSource.disconnect(),t.gainFilter.disconnect(),s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Stopping audio track "+t.origAudioTrack.id),t.origAudioTrack.stop(),delete this._mediaStreamContextMap[e.id]))},s.Base.AudioInputVolumeController=e}(AvayaClientServices),function(r){"use strict";function e(){this._muted=!1,this._volume=1,this._mediaStreamContextMap={},this._selectedDevice=T,this._gestureRequiredCallbacks=S.Callbacks()}e.prototype.stop=function(){this._mediaStreamContextMap={}},e.prototype.addOnGestureRequiredCallback=function(e){this._gestureRequiredCallbacks.add(e)},e.prototype.removeOnGestureRequiredCallback=function(e){this._gestureRequiredCallbacks.remove(e)},e.prototype.playAudioStream=function(e,t){var i,a;return!!(e&&0<e.getAudioTracks().length)&&(this.isPlaying(e)?r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+e.getAudioTracks()[0].id):(r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+e.id+"  active: "+e.active),e.getAudioTracks().forEach(function(e){r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+e.id+" enabled: "+e.enabled+" kind: "+e.kind+" label: "+e.label+" muted: "+e.muted+" readyState: "+e.readyState)}),(i=document.createElement("audio")).defaultMuted=!0,i.muted=this._muted||t,i.volume=this._volume,i.autoplay=!0,i.srcObject=e,a=function(e){i.play().then(function(){r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Auto playing remote audio stream..."),i.removeEventListener("canplay",a)}.bind(this)).catch(function(e){r.Base.Logger.error(r.Base.LoggerTags.MEDIA_ENGINE,"Failed to auto play remote audio stream",e),this._gestureRequiredCallbacks.fire(a),i.removeEventListener("canplay",a)}.bind(this))}.bind(this),i.addEventListener("canplay",a),this._mediaStreamContextMap[e.id]=new r.Base.MediaStreamContext(i),this._selectedDevice&&(!0===r.Base.Utils.hasProperty(i,"setSinkId")?this._mediaStreamContextMap[e.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):r.Base.Logger.info(r.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},e.prototype.stopPlayingAudioStream=function(e,t){var i,a;e&&(i=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(i)&&(r.Base.Utils.isDefined(t)&&!t||this.logStreamChanges(e.getAudioTracks(),"Stopping playing audio for track "),t=function(){a.pause(),a.srcObject=null},0===(a=i.getMediaElement()).readyState?a.ondurationchange=t:t(),delete this._mediaStreamContextMap[e.id]))},e.prototype.isPlaying=function(e){return r.Base.Utils.isDefined(this._mediaStreamContextMap[e.id])},e.prototype.muteStream=function(e){var t;e&&(t=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(t)&&(t.setMediaMuted(!0),t.getMediaElement().muted=!0,this.logStreamChanges(e.getAudioTracks(),"Muted audio output for track ")))},e.prototype.unmuteStream=function(e){var t;e&&(t=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(t)&&(t.setMediaMuted(!1),this._muted||(t.getMediaElement().muted=!1,this.logStreamChanges(e.getAudioTracks(),"Unmuted audio output for track "))))},e.prototype.logStreamChanges=function(e,t){e&&e[0]&&r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,t+e[0].id)},e.prototype.setVolume=function(e){if(1<e||e<0)throw new RangeError("Volume must be a double between 0 and 1");for(var t in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(this._mediaStreamContextMap[t].getMediaElement().volume=e);this._volume=e},e.prototype.getVolume=function(){return this._volume},e.prototype.mute=function(){for(var e in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(e)&&(this._mediaStreamContextMap[e].getMediaElement().muted=!0);this._muted=!0},e.prototype.unmute=function(){for(var e in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(e)&&((e=this._mediaStreamContextMap[e]).isMediaMuted()||(e.getMediaElement().muted=!1));this._muted=!1},e.prototype.isMuted=function(){return this._muted},e.prototype.onSelectedDeviceChanged=function(e){for(var t in this._selectedDevice=e,this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(t=this._mediaStreamContextMap[t],!0===r.Base.Utils.hasProperty(t.getMediaElement(),"setSinkId")?t.getMediaElement().setSinkId(e.getDeviceId()):r.Base.Logger.info(r.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))},r.Base.AudioOutput=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._audioInterface=e,this._videoInterface=t,this._mediaServicesService=i}t.prototype={getAudioInterface:function(){return this._audioInterface},getVideoInterface:function(){return this._videoInterface},start:function(e){return this._mediaServicesService!==T?this._mediaServicesService.start(e):S.Deferred().resolve().promise()},stop:function(){this._mediaServicesService.stop()}},e.Base.MediaServices=t}(AvayaClientServices),function(i){"use strict";function e(){this._audioInputInterfaceService=T,this._audioOutputInterfaceService=T,this._audioInterface=T,this._videoInterfaceService=T,this._videoInterface=T,this._mediaServices=T,this._mediaServicesService=T}e.prototype={getMediaServices:function(){return this.getMediaServicesService(),this._mediaServicesService||(this._mediaServicesService=this.getMediaServicesService()),this._mediaServices||(this._mediaServices=new i.Base.MediaServices(this.getAudioInterface(),this.getVideoInterface(),this._mediaServicesService)),this._mediaServices},getMediaServicesService:function(){return this._mediaServicesService||(this._mediaServicesService=new i.Base.MediaServicesService(this.getAudioInterface(),this.getVideoInterface(),this.getAudioInputInterfaceService(),this.getAudioOutputInterfaceService(),this.getVideoInterfaceService(),new i.Base.UserMedia)),this._mediaServicesService},getAudioInputInterfaceService:function(){return this._audioInputInterfaceService||this.getAudioInterface(),this._audioInputInterfaceService},getAudioOutputInterfaceService:function(){return this._audioOutputInterfaceService||this.getAudioInterface(),this._audioOutputInterfaceService},getAudioInterface:function(){var e,t;return this._audioInterface||(this._audioInputInterfaceService=new i.Base.AudioInputInterfaceService,e=new i.Base.AudioInputInterface(this._audioInputInterfaceService),this._audioOutputInterfaceService=new i.Base.AudioOutputInterfaceService,t=new i.Base.AudioOutputInterface(this._audioOutputInterfaceService),this._audioInterface=new i.Base.AudioInterface(e,t)),this._audioInterface},getVideoInterfaceService:function(){return this._videoInterfaceService||this.getVideoInterface(),this._videoInterfaceService},getVideoInterface:function(){return this._videoInterface||(this._videoInterfaceService=new i.Base.VideoInterfaceService,this._videoInterface=new i.Base.VideoInterface(this._videoInterfaceService)),this._videoInterface}},i.Base.MediaServicesFactory=e}(AvayaClientServices),function(d){"use strict";function e(e,t,i,a,r,s){this._audioInterface=e,this._videoInterface=t,this._userMedia=s,this._audioInputInterfaceService=i,this._audioOutputInterfaceService=a,this._videoInterfaceService=r}e.prototype={startMediaServiceFactory:function(){return this._audioInterface!==T&&this._videoInterface!==T?S.when(this._audioInterface.start(),this._videoInterface.start()):S.Deferred().reject("Not initialized with a audioInterface or videoInterface").promise()},start:function(e){if(window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia&&e){e=S.Deferred();return this._startMediaServiceFactory(e)}return this.startMediaServiceFactory()},stop:function(){return S.when(this._audioInterface.stop(),this._videoInterface.stop())},_startMediaServiceFactory:function(t){if(d.Base.Utils.getBrowserType()===d.Base.BrowserType.SAFARI)return this._startMediaServiceFactoryForSafari(t);var i=function(t){return this.startMediaServiceFactory().then(function(){t.getTracks().forEach(function(e){e.stop()}),this._setDefaultDevices(t)}.bind(this),function(e){t.getTracks().forEach(function(e){e.stop()})}.bind(this))}.bind(this);return window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){i(e).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this)).catch(function(e){if("NotAllowedError"!==e.name&&"NotFoundError"!==e.name&&"PermissionDeniedError"!==e.name&&"NotReadableError"!==e.name)return d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){t.reject("Can not receive media stream: "+e)});window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){i(e).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this),function(e){return d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){t.reject("Can not receive media stream: "+e)})}.bind(this))}.bind(this)),t},_startMediaServiceFactoryForSafari:function(a){var r=function(t){return this.startMediaServiceFactory().then(function(){t.getTracks().forEach(function(e){e.stop()}),this._setDefaultDevices(t)}.bind(this),function(e){t.getTracks().forEach(function(e){e.stop()})})}.bind(this);return window.navigator.mediaDevices.getUserMedia({audio:!0}).then(function(i){window.navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){i.getTracks().forEach(function(e){t.addTrack(e)}),r(t).then(function(){a.resolve()},function(e){a.reject(e)})}.bind(this),function(e){d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can only receive audio stream: "+e),r(i).then(function(){a.resolve()},function(e){a.reject(e)})}.bind(this))}.bind(this)).catch(function(e){return"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?(d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Audio media stream permission denied: "+e),this.startMediaServiceFactory().always(function(){a.reject("Audio media stream permission denied: "+e)})):(d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){a.reject("Can not receive media stream: "+e)}))}.bind(this)),a},getAudioInputService:function(){return this._audioInputInterfaceService},getAudioOutputService:function(){return this._audioOutputInterfaceService},getVideoInterfaceService:function(){return this._videoInterfaceService},createLocalMediaStream:function(a,r,s,e,t,n,i,o,c,l){return s&&!d.Base.Utils.isDefined(n)?S.Deferred().reject("Undefined videoChannelId"):this._userMedia.getUserMedia(r,s,e,t,!1,i,o,c,l).then(function(e,t,i){return this._setDefaultDevices(e),r&&a&&this._audioInputInterfaceService.localMediaStreamCreated(a,e),s&&n&&this._videoInterfaceService.localMediaStreamCreated(n,e),{stream:e,videoResolution:t,constraint:i}}.bind(this))},_setDefaultDevices:function(e){var t=e.getAudioTracks()[0];this._setDefaultDevice(t,this._audioInterface.getInputInterface());e=e.getVideoTracks()[0];this._setDefaultDevice(e,this._videoInterface),this._setDefaultOutputDevice(this._audioInterface.getOutputInterface())},_setDefaultDevice:function(i,e){var t;!e.getSelectDeviceCapability().isAllowed||!i||e.getSelectedDevice()||(t=e.getAvailableDevices().filter(function(e){var t=i.proppedLabel||i.label;return e._label===t})[0])&&e.setSelectedDevice(t)},_setDefaultOutputDevice:function(e){var t;!e.getSelectDeviceCapability().isAllowed||e.getSelectedDevice()||(t=e.getAvailableDevices().filter(function(e){return"default"===e._deviceId})[0])&&e.setSelectedDevice(t)},addVideoTracksToLocalStream:function(e,t,i,a,r,s,n){var o=S.Deferred();return d.Base.Utils.isDefined(t)?this._userMedia.addVideoTracksToStream(e,i,a,r,s,n).then(function(e){this._videoInterfaceService.localMediaStreamCreated(t,e),o.resolve(e)}.bind(this).bind(t),function(e){o.reject(e)}):o.reject("Undefined videoChannelId"),o},removeLocalVideoTracks:function(e,t){var i=this._videoInterfaceService.getLocalMediaStream(e);if(d.Base.Utils.isDefined(i)){var a=i.getVideoTracks();d.Base.Logger.debug(d.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks starting with "+a.length+" tracks.");for(var r=a.length-1;0<=r;r--){var s=a[r],n=a.indexOf(s);-1<n&&(s.stop(),i.removeTrack(s),t&&t.isRTCRtpSenderSupported()&&t.removeIfDoesNotSupportReplaceTrack(s),a.splice(n,1))}a=i.getVideoTracks(),d.Base.Logger.debug(d.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks ending with "+a.length+" tracks."),this._videoInterfaceService.removeLocalMediaStream(e)}},getUserMedia:function(){return this._userMedia},setUserConfig:function(e,t){this._userMedia.setUserConfig(e,t)},isMediaProcessingSupported:function(){return this._userMedia.isMediaProcessingSupported()}},d.Base.MediaServicesService=e}(AvayaClientServices),function(t){"use strict";function e(e){this._selectedDevice=T,this._mediaInterfaceService=e,this._onDevicesAddedCallbacks=S.Callbacks("unique"),this._onDevicesRemovedCallbacks=S.Callbacks("unique"),this._onDevicesUpdatedCallbacks=S.Callbacks("unique"),this._onSelectedDeviceRemovedCallbacks=S.Callbacks("unique"),this._onSelectedDeviceChangedCallbacks=S.Callbacks("unique"),this._notifiedUnavailability=!1,this._onDevicesUnavailable=S.Callbacks("unique"),this._selectDeviceCapability=T,this._mediaAccessCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}e.prototype={start:function(){return this._mediaInterfaceService.start(this).then(function(){this._mediaAccessCapability._updateIfChanged(!0,t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}.bind(this),function(e){this._mediaAccessCapability._updateIfChanged(!1,t.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}.bind(this))},stop:function(){return this._mediaInterfaceService.stop(this)},setSelectedDevice:function(e){if(!this.getSelectDeviceCapability().isAllowed)throw new Error("Selecting devices is not supported in current browser.");e&&(t.Base.Utils.isUndefined(this._selectedDevice)||e.getDeviceId()!==this._selectedDevice.getDeviceId())&&(t.Base.Logger.info(t.Base.LoggerTags.MEDIA_ENGINE,"New device selected:",e.toString()),this._selectedDevice=e,this._onSelectedDeviceChangedCallbacks.fire(this,this._selectedDevice))},getAvailableDevices:function(){return this._mediaInterfaceService.getAvailableDevices()},hasAvailableDevices:function(){return this._mediaInterfaceService.hasAvailableDevices()},getSelectedDevice:function(){return this._selectedDevice},getSelectDeviceCapability:function(){var e;return this._selectDeviceCapability===T&&(e=t.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED,t.Base.Utils.isWebRTC_SupportedBrowser()&&this._canPickDevices()&&(e=t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._selectDeviceCapability=new t.Base.Capability(e)),this._selectDeviceCapability},getMediaAccessCapability:function(){return this._mediaAccessCapability},addOnDevicesAddedCallback:function(e){this._onDevicesAddedCallbacks.add(e)},removeOnDevicesAddedCallback:function(e){this._onDevicesAddedCallbacks.remove(e)},addOnDevicesRemovedCallback:function(e){this._onDevicesRemovedCallbacks.add(e)},removeOnDevicesRemovedCallback:function(e){this._onDevicesRemovedCallbacks.remove(e)},addOnDevicesUpdatedCallback:function(e){this._onDevicesUpdatedCallbacks.add(e)},removeOnDevicesUpdatedCallback:function(e){this._onDevicesUpdatedCallbacks.remove(e)},addOnSelectedDeviceRemovedCallback:function(e){this._onSelectedDeviceRemovedCallbacks.add(e)},removeOnSelectedDeviceRemovedCallback:function(e){this._onSelectedDeviceRemovedCallbacks.remove(e)},addOnDevicesUnavailableCallback:function(e){this._onDevicesUnavailable.add(e)},removeOnDevicesUnavailableCallback:function(e){this._onDevicesUnavailable.remove(e)},addOnSelectedDeviceChangedCallback:function(e){this._onSelectedDeviceChangedCallbacks.add(e)},removeOnSelectedDeviceChangedCallback:function(e){this._onSelectedDeviceChangedCallbacks.remove(e)},_canPickDevices:function(){return!0}},t.Base.MediaInterface=e}(AvayaClientServices),function(s){"use strict";function e(){this._devices=[],this._deviceIdentifier="",this._isStarted=!1,this._observeDevicesInterval=T,this._hasDevices=!1}e.prototype={start:function(e){var t=S.Deferred();return s.Base.Utils.isWebRTC_SupportedBrowser()?(this._isStarted?t.resolve():(this._observeDevicesInterval=setInterval(function(){this._observeDevices(e,t)}.bind(this),1e3),this._observeDevices(e,t)),t.promise()):t.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)).promise()},stop:function(e){return this._observeDevicesInterval&&(clearInterval(this._observeDevicesInterval),this._observeDevicesInterval=T),this._isStarted=!1,S.Deferred().resolve().promise()},getAvailableDevices:function(){return this._devices},hasAvailableDevices:function(){return this._hasDevices},_observeDevices:function(t,i){navigator.mediaDevices.enumerateDevices().then(function(e){this._processDevices(t,this._devices,e),this._isStarted||(this._isStarted=!0,i.resolve())}.bind(this))},_processDevices:function(e,t,i){this._scanForAddedDevices(e,t,i),this._scanForRemovedDevices(e,t,i),this._scanForAvailableDevices(e,t,i),this._updateDevicesLabel(e,t,i)},_getAddedDevices:function(a,e){var r=[],e=e.filter(function(e){return e.kind===this._deviceIdentifier}.bind(this));return this._hasDevices=0<e.length,e.forEach(function(t){var e=0<a.filter(function(e){return e.getDeviceId()===t.deviceId}).length,i=0<r.filter(function(e){return e._deviceId===t.deviceId}).length;e||i||!t.deviceId||(i=this._buildDevice(t),r.push(i))}.bind(this)),r},_updateDevicesLabel:function(e,t,i){var a=[];t.filter(function(t){i.forEach(function(e){return t._kind===e.kind&&t.getDeviceId()===e.deviceId&&(t.getLabel()!==e.label&&(t._label=e.label,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device label updated:",t.toString()),a.push(t)),!0)})}),0<a.length&&e._onDevicesUpdatedCallbacks.fire(e,a)},_scanForAddedDevices:function(e,t,i){i=this._getAddedDevices(t,i);0<i.length&&(i.forEach(function(e){s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"New device added:",e.toString()),t.push(e)}),e._notifiedUnavailability=!1,e._onDevicesAddedCallbacks.fire(e,i))},_scanForAvailableDevices:function(e,t,i){0!==t.length||e._notifiedUnavailability||(s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device unavailable:",e.toString()),e._onDevicesUnavailable.fire(e),e._notifiedUnavailability=!0)},_scanForRemovedDevices:function(e,t,i){var a,r=t.filter(function(t){return 0===i.filter(function(e){return"default"===e.deviceId||"communications"===e.deviceId?t.getDeviceId()===e.deviceId&&t.getLabel()===e.label:t.getDeviceId()===e.deviceId}).length});0<r.length&&(r.forEach(function(e){t.splice(t.indexOf(e),1)}),a=0,r.forEach(function(e){e.getDeviceId()&&(a++,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device removed:",e.toString()))}),0<a&&e._onDevicesRemovedCallbacks.fire(e,r),-1<r.indexOf(e.getSelectedDevice())&&(r=e._selectedDevice,e._selectedDevice=T,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Selected device removed:",r.toString()),e._onSelectedDeviceRemovedCallbacks.fire(e,r)))},_buildDevice:function(e){throw new Error("Unable to build device")}},s.Base.MediaInterfaceService=e}(AvayaClientServices),function(e){"use strict";function t(e){this.mediaElement=e,this.streamMuted=!1}t.prototype={isMediaMuted:function(){return this.streamMuted},setMediaMuted:function(e){this.streamMuted=e},getMediaElement:function(){return this.mediaElement}},e.Base.MediaStreamContext=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.MediaStreamError={ABORT:"AbortError",NOT_ALLOWED:"NotAllowedError",PERMISSION_DENIED:"PermissionDeniedError",NOT_FOUND:"NotFoundError",NOT_READABLE:"NotReadableError",OVERCONSTRAINED:"OverconstrainedError",SECURITY:"SecurityError",TYPE:"TypeError",DEVICES_NOT_FOUND:"DevicesNotFoundError"}}(),function(e){"use strict";function t(e,t,i){if(this._origStream=e,this._backgroundBlur=t,this._backgroundImage=i,this._inputVideo=document.createElement("video"),this._inputVideo.addEventListener("loadedmetadata",function(){this._runLoop()}.bind(this)),this._canvas=document.createElement("canvas"),this._canvasCtxt=this._canvas.getContext("2d"),this._debugDiv=document.getElementById("canvasDiv"),this._debugDiv){for(;this._debugDiv.firstChild;)this._debugDiv.removeChild(this._debugDiv.firstChild);this._debugDiv.appendChild(this._canvas)}this._outputStream=T,this._requestingFrames=!1,this._propagator=T}t.prototype.init=function(){},t.prototype.setOrigStream=function(e){this._origStream=e},t.prototype.getStream=function(){return this._inputVideo.srcObject=this._origStream,this._inputVideo.muted=!0,this._inputVideo.play().catch(function(){e.Base.Logger.error(e.Base.LoggerTags.MEDIA_ENGINE,"Failed to play inputVideo")}),this._outputStream=this._canvas.captureStream(30),this._requestingFrames&&this._outputStream&&0<this._outputStream.getVideoTracks().length&&this._outputStream.getVideoTracks()[0].requestFrame?this._outputStream=this._canvas.captureStream(0):this._requestingFrames=!1,0<this._origStream.getAudioTracks().length&&this._outputStream.addTrack(this._origStream.getAudioTracks()[0]),this._propagator=new e.Base.VideoTrackPropagator(this._origStream.getVideoTracks()[0],this._outputStream.getVideoTracks()[0]),this._outputStream},t.prototype._runLoop=function(){},t.prototype._updateCanvasSize=function(){this._canvas.width=this._inputVideo.videoWidth,this._canvas.height=this._inputVideo.videoHeight,this._inputVideo.width=this._inputVideo.videoWidth,this._inputVideo.height=this._inputVideo.videoHeight},t.prototype._isStreamAlive=function(){var t,i=!1;return this._origStream.active&&this._outputStream.active&&this._origStream.getVideoTracks()&&this._outputStream.getVideoTracks()&&(this._origStream.getVideoTracks().forEach(function(e){"ended"!==e.readyState&&(t=!0)}),this._outputStream.getVideoTracks().forEach(function(e){"ended"!==e.readyState&&(i=!0)})),t&&i},t.prototype.cleanup=function(){e.Base.Logger.debug(e.Base.LoggerTags.MEDIA_ENGINE,"Cleaning up MediaStreamVideoProcessor ",this._origStream,this._outputStream),this._propagator.cleanup(),this._outputStream&&this._outputStream.getVideoTracks()&&(this._outputStream.getVideoTracks().forEach(function(e){e.stop()}),this._outputStream=T),this._origStream&&this._origStream.getVideoTracks()&&(this._origStream.getVideoTracks().forEach(function(e){e.stop()}),this._origStream=T),this._inputVideo=T,this._canvas=T,this._canvasCtxt=T},e.Base.MediaStreamVideoProcessor=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.MediaTypes={AUDIO_INPUT:"audioinput",AUDIO_OUTPUT:"audiooutput",VIDEO_INPUT:"videoinput"}}(),function(a){"use strict";function e(){this._audioElement=T,a.Base.AudioOutput.call(this)}(e.prototype=Object.create(a.Base.AudioOutput.prototype)).playAudioStream=function(e,t){var i;return!!(e&&e.active&&0<e.getAudioTracks().length)&&(this.isPlaying(e)?a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+e.getAudioTracks()[0].id):(a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+e.id+"  active: "+e.active),e.getAudioTracks().forEach(function(e){a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+e.id+" enabled: "+e.enabled+" kind: "+e.kind+" label: "+e.label+" muted: "+e.muted+" readyState: "+e.readyState)}),this._audioElement&&(this._audioElement.srcObject=null,this._audioElement.remove()),this._audioElement=document.createElement("audio"),this._audioElement.muted=this._muted||t,this._audioElement.volume=this._volume,this._audioElement.autoplay=!0,this._audioElement.addEventListener("canplay",function(e){this._audioElement.play().then(function(){a.Base.Logger.debug("*** Playing remote audio stream...")}).catch(function(e){a.Base.Logger.error("Failed to play remote audio stream",e)})}.bind(this)),0<e.getVideoTracks().length?(i=new MediaStream,e.getAudioTracks().forEach(function(e){i.addTrack(e)}),this._audioElement.srcObject=i):this._audioElement.srcObject=e,this._mediaStreamContextMap[e.id]=new a.Base.MediaStreamContext(this._audioElement),this._selectedDevice&&(!0===a.Base.Utils.hasProperty(this._audioElement,"setSinkId")?this._mediaStreamContextMap[e.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):a.Base.Logger.info(a.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},a.Base.SafariAudioOutput=e}(AvayaClientServices),function(t){"use strict";function e(e){e&&!e.endsWith("/")&&(e+="/"),this._libraryLocation=e,this._selfies=[]}e.prototype.preAllocate=function(){var e;t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.preAllocate"),this._selfies.length<1&&(e=this._createSelfie(),this._selfies.push(e))},e.prototype.take=function(){return t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.take"),this._selfies.pop()||this._createSelfie()},e.prototype.return=function(e){t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.return"),e&&(e.onResults=function(){},this._selfies.push(e))},e.prototype.isFailed=function(){return this._isFailed},e.prototype.reportFailure=function(){this._isFailed=!0},e.prototype._createSelfie=function(){t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.createSelfie");var e=new t.Base.SelfieWrapper(this._libraryLocation,this);return e.initialize(),e},t.Base.SelfieFactory=e}(AvayaClientServices),function(t){"use strict";function e(t,e){var i;t&&(i={locateFile:function(e){return t+e}}),this._selfieFactory=e,this._isStarted=!1,this._isFailed=!1,this._selfieSegmentation=new SelfieSegmentation(i),this._initDfd=S.Deferred(),this._selfieSegmentation.setOptions({modelSelection:1})}e.prototype.isStarted=function(){return this._isStarted},e.prototype.isFailed=function(){return this._isFailed},e.prototype.initialize=function(){return this._selfieSegmentation.onResults(function(e){this.onResults(e)}.bind(this)),this._selfieSegmentation.initialize().then(function(){t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieSegmentation initialized successfully"),this._isStarted=!0,this._initDfd.resolve()}.bind(this),function(e){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieSegmentation initialization failed"),this._isFailed=!0,this._selfieFactory.reportFailure(),this._initDfd.reject(e)}.bind(this)),this._initDfd.promise()},e.prototype.getInitPromise=function(){return this._initDfd.promise()},e.prototype.send=function(e){return this._selfieSegmentation.send(e).catch(function(e){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"selfieSegmentation.send failed: ",e)})},e.prototype.onResults=function(e){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"Must overwrite onResults to get results")},t.Base.SelfieWrapper=e}(AvayaClientServices),function(u){"use strict";function e(){this.isAvailable()||u.Base.Logger.info(u.Base.LoggerTags.MEDIA_ENGINE,"UserMedia not available"),this._isChromeBrowser=this._checkIfBrowserIsChrome(),this._supportedConstaints=this.getMediaTrackConstraints(),this._mediaConfig=T,this._selfieFactory=T,this._hasMediaPipeVideoProcessorFailed=!1,this._callPerformanceManager=T}e.prototype.isAvailable=function(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia},e.prototype.setUserConfig=function(e,t){this._mediaConfig=e,this._callPerformanceManager=t;t=this._mediaConfig.selfieSegmentationFileLocation;this._selfieFactory=new u.Base.SelfieFactory(t),t&&this._selfieFactory.preAllocate()},e.prototype.getMediaTrackConstraints=function(){var e={width:!0,height:!0,aspectRatio:!0,frameRate:!0,facingMode:!0,volume:!0,sampleRate:!0,sampleSize:!0,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,latency:!0,channelCount:!0,deviceId:!0,groupId:!0};return navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?(e=navigator.mediaDevices.getSupportedConstraints(),u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"supportedConstraints: ",e)):u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"navigator.mediaDevices.getSupportedConstraints is not available.  Assuming browser supports all constraints."),e},e.prototype.getUserMedia=function(e,t,i,a,r,s,n,o,c){var l,d,C=S.Deferred();return this.isAvailable()?(e=this._createAudioConstraints(e,i,n),i=[],n=u.Base.Utils.getBrowserType()===u.Base.BrowserType.CHROME,t&&(o||c)&&n?(n=S.Deferred(),l=new u.Base.MediaPipeVideoProcessor(T,o,c,this._selfieFactory,this._callPerformanceManager),d=l.init(),n.then(function(e,t,i){var a;0<e.getVideoTracks().length?(l.setOrigStream(e),a=l.getStream(),d.then(function(){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Initialized MediaPipeVideoProcessor")},function(){this._hasMediaPipeVideoProcessorFailed=!0,u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to initialize MediaPipeVideoProcessor")}.bind(this)),C.resolve(a,t,i)):(l.cleanup(),C.resolve(e,t,i))}.bind(this),function(e){C.reject(e)}),i=this._createVideoConstraintList(s,a),this._getUserMediaWithConstraints(n,e,i,r)):(t&&(i=this._createVideoConstraintList(s,a)),this._getUserMediaWithConstraints(C,e,i,r))):C.reject(new u.Services.Call.CallException(u.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)),C.promise()},e.prototype._getUserMediaWithConstraints=function(e,t,i,a,r,s){u.Base.Utils.getBrowserType()===u.Base.BrowserType.SAFARI?this._getSafariUserMediaWithConstraints(e,t,i,a,r,s):this._getGenericUserMediaWithConstraints(e,t,i,a,r)},e.prototype._getGenericUserMediaWithConstraints=function(r,s,n,o,c){var e=n.shift(),l=this._buildMediaConstraints(s,e);o&&(l.fake=!0);var i=e?e.resolution:T;l.video?u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",i):l.audio&&u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only");var d=function(e,t){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),l.video&&!e.getVideoTracks().length&&l.video?this._getUserMediaErrorHandler(r,s,n,o,c,{name:"NotFoundError",message:"No video tracks",constraintName:"OverConstrainedError"}):r.resolve(e,i,t)}.bind(this);u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(l)),navigator.mediaDevices.getUserMedia(l).then(d,function(i){var a,e=i.name===u.Base.MediaStreamError.OVERCONSTRAINED&&0===n.length;i.name===u.Base.MediaStreamError.NOT_ALLOWED||i.name===u.Base.MediaStreamError.NOT_READABLE||i.name===u.Base.MediaStreamError.NOT_FOUND||i.name===u.Base.MediaStreamError.ABORT||i.name===u.Base.MediaStreamError.PERMISSION_DENIED||e?l.audio&&l.video?(l.video=!1,u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback: ",i.message),u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback using ",l),navigator.mediaDevices.getUserMedia(l).then(function(e){var t={error:a=this._getMediaStreamErrorCode(i.name,!0),reason:i.name};d(e,t)}.bind(this),function(e){u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed audio only constraints: ",e),this._getUserMediaErrorHandler(r,s,n,o,c,e)}.bind(this))):(a=this._getMediaStreamErrorCode(i.name,l.video),r.reject(new u.Services.Call.CallException(a,u.Services.Call.CallProtocolType.APPLICATION,500,i.name))):l.video?this._getUserMediaErrorHandler(r,s,n,o,c,i):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this)).catch(function(e){l.video?this._getUserMediaErrorHandler(r,s,n,o,c,e):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))},e.prototype._getMediaStreamErrorCode=function(e,t){var i;switch(t=t||!1,e){case u.Base.MediaStreamError.NOT_READABLE:case u.Base.MediaStreamError.NOT_FOUND:case u.Base.MediaStreamError.ABORT:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add microphone or camera is not accessible"),i=t?u.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE:u.Services.Call.CallError.MICROPHONE_NOT_ACCESSIBLE;break;case u.Base.MediaStreamError.OVERCONSTRAINED:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to overconstrained"),i=u.Services.Call.CallError.OVERCONSTRAINED;break;default:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to device permission denied"),i=t?u.Services.Call.CallError.CAMERA_PERMISSION_DENIED:u.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED}return i},e.prototype._getSafariUserMediaWithConstraints=function(r,s,n,o,c,l){var t=n.shift(),d=this._buildMediaConstraints(s,t);o&&(d.fake=!0);var e,i=function(){var a=t?t.resolution:T,e=function(t){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),l&&l.getTracks().forEach(function(e){t.addTrack(e)}),r.resolve(t,a)}.bind(this);if(d.video)u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",a);else if(d.audio)return u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only"),void r.resolve(l,a);u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(d)),d.audio=!1,navigator.mediaDevices.getUserMedia(d).then(e,function(e){var t,i=e.name===u.Base.MediaStreamError.OVERCONSTRAINED&&d.video&&0===n.length;e.name===u.Base.MediaStreamError.NOT_ALLOWED||e.name===u.Base.MediaStreamError.NOT_READABLE||e.name===u.Base.MediaStreamError.NOT_FOUND||e.name===u.Base.MediaStreamError.ABORT||e.name===u.Base.MediaStreamError.PERMISSION_DENIED||i?l?(t={error:this._getMediaStreamErrorCode(e.name,!0),reason:e.name},r.resolve(l,a,t)):(t=this._getMediaStreamErrorCode(e.name,d.video),r.reject(new u.Services.Call.CallException(t))):d.video?this._getUserMediaErrorHandler(r,s,n,o,c,e,l):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))}.bind(this);u.Base.Utils.isUndefined(l)&&d.audio?(e={audio:d.audio},navigator.mediaDevices.getUserMedia(e).then(function(e){l=e,i()},function(e){e.name===u.Base.MediaStreamError.NOT_ALLOWED||e.name===u.Base.MediaStreamError.PERMISSION_DENIED||e.name===u.Base.MediaStreamError.NOT_READABLE||e.name===u.Base.MediaStreamError.ABORT||e.name===u.Base.MediaStreamError.NOT_FOUND?(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track due to device permission denied"),r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED))):(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track: "+e),r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE)))})):i()},e.prototype._getUserMediaErrorHandler=function(e,t,i,a,r,s,n){return s.name===u.Base.MediaStreamError.DEVICES_NOT_FOUND?(u.Base.Logger.error(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",s),void e.reject(new u.Services.Call.CallException(u.Services.Call.CallError.DEVICES_NOT_FOUND))):s.message&&s.message.includes("Failed to allocate")?(u.Base.Logger.error(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",s),void((r=r||0)<2?(r++,setTimeout(function(){this._getUserMediaWithConstraints(e,t,i,a,r,n)}.bind(this),1e3)):e.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE)))):(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running constraints fallback: ",s),void this._getUserMediaWithConstraints(e,t,i,a,r,n))},e.prototype.addVideoTracksToStream=function(e,i,t,a,r,s){var n=S.Deferred(),o=i.getVideoTracks();return u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream starting with "+o.length+" tracks."),this.getUserMedia(!1,!0,T,e,!1,t,T,r,s).then(function(e){var t;e?(t=e.getVideoTracks(),u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream got new stream with "+t.length+" tracks."),e.getTracks().forEach(function(e){e.kind===u.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream added a track."+e.id),i.addTrack(e),a&&a.isRTCRtpSenderSupported()?a.replaceLocalMediaTrack(e,i).then(function(){n.resolve(i)},function(e){n.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}):n.resolve(i))})):n.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))},function(e){n.reject(e)}),n},e.prototype._buildMediaConstraints=function(e,t){var i={};return i.audio=e||!1,i.video=!!t&&t.constraints,i},e.prototype._createAudioConstraints=function(e,t,i){var a;return e?t?(a={deviceId:{exact:t}},i&&(a=Object.assign(a,i))):a=i||!0:a=!1,a},e.prototype._createVideoConstraintList=function(t,i){function a(e){e={resolution:e,constraints:{width:{},height:{}}};return i&&(e.constraints.deviceId={exact:i}),e}function r(e,t){var i=a(e);return i.constraints.width.exact=e.getWidth(),i.constraints.height.exact=e.getHeight(),t?i.constraints.frameRate={min:t}:(i.resolution._fps=T,u.Base.Utils.getBrowserType()===u.Base.BrowserType.SAFARI&&(i.constraints.width=e.getWidth(),i.constraints.height=e.getHeight())),i}var s,n,o,e,c,l=(n=[],o=[],s=u.Base.VideoResolution,Object.keys(s).map(function(e){return s[e]}).forEach(function(e){e&&e.getHeight()<=t.getHeight()&&(n.push(r(e,480===e.getHeight()&&25<=t.getFPS()?25:u.Config.CallUserConfiguration.minPreferredVideoFPS||u.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS)),o.push(r(e)))}),n.concat(o));return l.push((e=a(t),c="max",u.Base.Utils.getBrowserType()!==u.Base.BrowserType.CHROME&&(c="ideal"),e.constraints.width[c]=t.getWidth(),e.constraints.height[c]=t.getHeight(),e)),l},e.prototype.createRTCVideoConstraints=function(e,t){var i={};return 180===e.getHeight()?u.Base.Utils.getBrowserType()===u.Base.BrowserType.CHROME?i.video={width:{max:e.getWidth()},height:{max:e.getHeight()}}:i.video={width:{ideal:e.getWidth()},height:{ideal:e.getHeight()}}:u.Base.Utils.getBrowserType()===u.Base.BrowserType.FIREFOX&&360<=e.getHeight()&&e.getHeight()<=480?i.video={width:640,height:360}:i.video={width:e.getWidth(),height:e.getHeight()},t&&(i.deviceId={exact:t}),i},e.prototype.adjustVideoResolution=function(e,t){if(!e||!t||t.getMinBandwidth()<=e)return new u.Base.VideoResolutionDetails(t.getWidth(),t.getHeight(),t.getMinBandwidth(),e,t.getFPS());for(var i=S.map(u.Base.VideoResolution,function(e){return e}),t=i.indexOf(t),a=t=-1===t?0:t;a<i.length;a++)if(i[a].getMinBandwidth()<=e&&i[a].getMaxBandwidth()>e)return new u.Base.VideoResolutionDetails(i[a].getWidth(),i[a].getHeight(),i[a].getMinBandwidth(),e,i[a].getFPS());return u.Base.VideoResolution.resolution180p},e.prototype.adjustVideoResolutionForDimensions=function(e,t,i){var a,r=S.map(u.Base.VideoResolution,function(e){return e}),s=0;if(i)for(a=0;a<r.length;a++)if(r[a].getHeight()===i.getHeight()){s=a;break}for(a=s;a<r.length;a++)if((u.Base.Utils.isUndefined(t)||0===t||r[a].getWidth()<=t)&&(u.Base.Utils.isUndefined(e)||0===e||r[a].getHeight()<=e))return i&&r[a].getHeight()===i.getHeight()?i:r[a];return u.Base.VideoResolution.resolution180p},e.prototype.updateStreamUsingApplyConstraints=function(r,s,n,o,c){c=c||S.Deferred();var e=u.Base.UserMedia.prototype.createRTCVideoConstraints(s,o);return r.muted?(r.onunmute||(r.onunmute=function(){setTimeout(this.adjustVideoConstraints.bind(this,r,s,n,o,c),0)}.bind(this)),c.reject("Found video track issues. Can't apply constraints to the video track").promise()):(r.applyConstraints(e).then(function(){n._updateVideoResolution(s),c.resolve()},function(e){var t,i=S.map(u.Base.VideoResolution,function(e){return e}),a=i.indexOf(s);a+1<i.length?t=i[a+1]:c.reject(e),this.updateStreamUsingApplyConstraints(r,t,n,o,c)}.bind(this)),c.promise())},e.prototype._checkIfBrowserIsChrome=function(){return u.Base.Utils.getBrowserType()===u.Base.BrowserType.CHROME},e.prototype.isMediaProcessingSupported=function(){return!this._hasMediaPipeVideoProcessorFailed},u.Base.UserMedia=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){this._kind=a.Base.MediaTypes.VIDEO_INPUT,this._deviceId=e,this._groupId=t,this._label=i}e.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return"Camera device [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},a.Base.VideoDevice=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Base.MediaInterface.call(this,e),this._videoInterfaceService=e}(e.prototype=Object.create(t.Base.MediaInterface.prototype)).getRemoteMediaStream=function(e){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getRemoteMediaStream(e);throw new Error("VideoInterface.getRemoteMediaStream(): Capability not allowed")},e.prototype.getLocalMediaStream=function(e){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getLocalMediaStream(e);throw new Error("VideoInterface.getLocalMediaStream(): Capability not allowed")},e.prototype.toString=function(){return"Camera"},t.Base.VideoInterface=e}(AvayaClientServices),function(a){"use strict";function e(){a.Base.MediaInterfaceService.call(this),this._deviceIdentifier=a.Base.MediaTypes.VIDEO_INPUT,this._localStreamMap={},this._remoteStreamMap={},this._currentChannelId=1}(e.prototype=Object.create(a.Base.MediaInterfaceService.prototype))._buildDevice=function(e){return new a.Base.VideoDevice(e.deviceId,e.groupId,e.label)},e.prototype.createVideoChannel=function(){return this._currentChannelId++},e.prototype.getRemoteMediaStream=function(e){return this._remoteStreamMap[e]},e.prototype.getLocalMediaStream=function(e){return this._localStreamMap[e]},e.prototype.setRemoteMediaStream=function(e,t){this._remoteStreamMap[e]=t},e.prototype.localMediaStreamCreated=function(e,t){var i;0<t.getVideoTracks().length&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(i=new MediaStream,t.getVideoTracks().forEach(function(e){e instanceof MediaStreamTrack&&"live"===e.readyState&&i.addTrack(e)}),this._localStreamMap[e]=i):this._localStreamMap[e]=t)},e.prototype.removeMediaStreams=function(e){delete this._localStreamMap[e],delete this._remoteStreamMap[e]},e.prototype.removeLocalMediaStream=function(e){delete this._localStreamMap[e]},e.prototype.removeRemoteMediaStream=function(e){delete this._remoteStreamMap[e]},e.prototype.replaceLocalMediaStream=function(e,t){var i;this._localStreamMap.hasOwnProperty(e)&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(i=new MediaStream,t.getVideoTracks().forEach(function(e){e instanceof MediaStreamTrack&&"live"===e.readyState&&i.addTrack(e)}),this._localStreamMap[e]=i):this._localStreamMap[e]=t)},a.Base.VideoInterfaceService=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this._origTrack=e,this._propagatingTrack=t,this._propApplyConstraints=this._propagatingTrack.applyConstraints,this._propStop=this._propagatingTrack.stop,this._propGetConstraints=this._propagatingTrack.getConstraints,this._propagatingTrack.proppedLabel=this._origTrack.label,this._propagatingTrack.applyConstraints=function(){var e=S.Deferred();return this._origTrack?this._origTrack.applyConstraints.apply(this._origTrack,arguments).then(function(){this._propApplyConstraints.apply(this._propagatingTrack,arguments).then(function(){e.resolve.apply(e,arguments)},function(){e.reject.apply(e,arguments)})}.bind(this),function(){e.reject.apply(e,arguments)}.bind(this)):e.reject("Track is no longer available"),e.promise()}.bind(this),this._propagatingTrack.stop=function(){if(this._origTrack&&this._origTrack.stop.apply(this._origTrack,arguments),this._propStop)return this._propStop.apply(this._propagatingTrack,arguments)}.bind(this),this._propagatingTrack.getConstraints=function(){if(this._origTrack)return this._origTrack.getConstraints.apply(this._origTrack,arguments)}.bind(this)}t.prototype.cleanup=function(){this._origTrack=T,this._propagatingTrack=T,this._propApplyConstraints=T,this._propStop=T},e.Base.VideoTrackPropagator=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkErrorCodes={HTTP_REDIRECTION:300,HTTP_MOVED_PERMANENTLY:301,HTTP_FOUND:302,HTTP_SEE_OTHER:303,HTTP_NOT_MODIFIED:304,HTTP_USE_PROXY:305,HTTP_TEMPORARY_REDIRECT:307,HTTP_PERMANENT_REDIRECT:308,HTTP_BAD_REQUEST:400,HTTP_UNAUTHORIZED:401,HTTP_PAYMENT_REQUIRED:402,HTTP_FORBIDDEN:403,HTTP_NOT_FOUND:404,HTTP_METHOD_NOT_ALLOWED:405,HTTP_NOT_ACCEPTABLE:406,HTTP_PROXY_AUTHENTICATION_REQUIRED:407,HTTP_REQUEST_TIMEOUT:408,HTTP_CONFLICT:409,HTTP_GONE:410,HTTP_LENGTH_REQUIRED:411,HTTP_PRECONDITION_FAILED:412,HTTP_PAYLOAD_TO_LARGE:413,HTTP_URI_TOO_LONG:414,HTTP_UNSUPPORTED_MEDIA_TYPE:415,HTTP_RANGE_NOT_SATISFIABLE:416,HTTP_EXPECTATION_FAILED:417,HTTP_MISDIRECTED_REQUEST:421,HTTP_UNPROCESSABLE_ENTITY:422,HTTP_LOCKED:423,HTTP_FAILED_DEPENDENCY:424,HTTP_UPGRADE_REQUIRED:426,HTTP_PRECONDITION_REQUIRED:428,HTTP_TOO_MANY_REQUESTS:429,HTTP_REQUEST_HEADERS_TOO_LARGE:431,HTTP_NGINX_NO_RESPONSE:444,HTTP_UNAVAILABLE_FOR_LEGAL:451,HTTP_NGINX_SSL_CERTIFICATE_ERROR:495,HTTP_NGINX_SSL_CERTIFICATE_REQUIRED:496,HTTP_NGINX_HTTP_TO_HTTPS:444,HTTP_NGINX_CLIENT_CLOSED_REQUEST:499,HTTP_INTERNAL_SERVER_ERROR:500,HTTP_NOT_IMPLEMENTED:501,HTTP_BAD_GATEWAY:502,HTTP_SERVICE_UNAVAILABLE:503,HTTP_GATEWAY_TIMEOUT:504,HTTP_NETWORK_AUTHENTICATION_REQUIRED:511,HTTP_NETWORK_ERROR:400001,WEBSOCKET_CLOSE_NORMAL:1e3,WEBSOCKET_UNAUTHORIZED:1006}}(),function(i){"use strict";function e(e,t,i,a,r){this._retryHelper=e,this._deferred=t,this._status=i,this._responseText=a,this._retryAfter=this._parseRetryAfter(r)}e.prototype={getRequestRetryHelper:function(){return this._retryHelper},getStatus:function(){return this._status},getResponseText:function(){return this._responseText},getDeferred:function(){return this._deferred},getRetryAfter:function(){return this._retryAfter},_parseRetryAfter:function(e){if(i.Base.Utils.isDefined(e)&&null!==e){var t=parseInt(e);return isNaN(t)?new Date(e)-new Date:1e3*t}}},i.Base.NetworkErrorEvent=e}(AvayaClientServices),function(o){"use strict";function e(e){this._parentLoggerTag=e,this._blackList=[],this._disableOptionsLogging=!1}e.prototype.registerBlackList=function(e){this._blackList=e},e.prototype.logSendMessage=function(e,t,i){var a,r,s=["PROVIDER:",i.type],n=t;if(i.type&&i.type!==o.Base.ProviderTypes.WEB_SOCKET_PROVIDER&&(n=S.extend({},i.defaultOptions,t),i=i._getServerURL(n),s.push("URL:",i)),e instanceof ArrayBuffer)s.push("BYTES SENT:",e.byteLength);else{try{a=this._generateLoggedMessage(e)}catch(e){a="Failed to generate sent message "+e}s.push("\nMESSAGE SENT:",a)}if(!this._disableOptionsLogging){try{r=this._generateLoggedMessage(n)}catch(e){r="Failed to generate sent options "+e}s.push("\nOPTIONS SENT:",r)}this._log(o.Base.Logger.debug,s)},e.prototype.logRecvMessage=function(e,t,i){if(e&&e.data instanceof ArrayBuffer){var a,r="BYTE LENGTH RECV: "+e.data.byteLength+". ";i&&(i.receivedTime&&(r+="PrTime: "+(a=(new Date).getTime())+". TimeDiff: "+(a-i.receivedTime)+". "),i.wsConnectionId&&(r+="wsConnId: "+i.wsConnectionId)),this._log(o.Base.Logger.debug,r)}else{var s;try{s=this._generateLoggedMessage(e)}catch(e){s="Failed to generate received message "+e}t&&t.getAllResponseHeaders?(t=t.getAllResponseHeaders(),this._log(o.Base.Logger.debug,"\nMESSAGE RECEIVED:",s,"\nHEADERS RECEIVED:",t)):this._log(o.Base.Logger.debug,"\nMESSAGE RECEIVED:",s)}},e.prototype.disableOptionsLogging=function(e){this._disableOptionsLogging=e},e.prototype._generateLoggedMessage=function(e){var t,i,a;if(e)return"string"==typeof(e=e.data||e)?(a=this._blackList.join("|"),this._isXML(e)?(t=new RegExp("("+a+')="(.*?)"',"mig"),i=e.replace(t,'$1="REMOVED"'),this._blackList.reduce(function(e,t){return-1<i.indexOf("<"+t)&&e.push(t),e},[]).forEach(function(e){e=new RegExp("(?:(<"+e+"(?:[\\s\\S]*?))(\\/>))|(?:(<"+e+"(?:[\\s\\S]*?)>)([\\s\\S]*?)(</"+e+">))","mig");i=i.replace(e,"$1$2$3$5")})):i=this._isJSON(e)?(i=JSON.parse(e),this._removeFromObject(i),JSON.stringify(i,T,2)):(a=new RegExp("((?:"+a+")=)(.*?)([&]|$)","mig"),e.replace(a,"$1REMOVED$3"))):e instanceof Uint8Array?i="Uint8Array["+e.length+"]":"object"==typeof e&&(i=S.extend(!0,{},e),this._removeFromObject(i),i=JSON.stringify(i,T,2)),i},e.prototype._isXML=function(e){return 0===(e=e.trim()).indexOf("<?xml")},e.prototype._isJSON=function(e){return 0===(e=e.trim()).indexOf("{")||0===e.indexOf("[")},e.prototype._removeFromObject=function(a){Object.keys(a).forEach(function(t){if(this._removeFromLogs(t))a[t]="REMOVED";else if("string"!=typeof a[t]&&null!==a[t]&&Object.keys(a[t]).length){var i;this._blackList.forEach(function(e){-1<e.indexOf(t)&&(e=JSON.parse(e),i=e[0])}),i&&Object.values(i).forEach(function(e){a[t].hasOwnProperty(e)&&(a[t][e]="REMOVED")}),this._removeFromObject(a[t])}else if("string"==typeof a[t]&&this._isJSON(a[t]))try{var e=JSON.parse(a[t]);this._removeFromObject(e),a[t]=JSON.stringify(e)}catch(e){}}.bind(this))},e.prototype._removeFromLogs=function(e){return-1<this._blackList.indexOf(e)},e.prototype._log=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this._parentLoggerTag),e.call(T,o.Base.LoggerTags.NETWORK_PROVIDER,t)},o.Base.NetworkLogger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkProviderEvents={UNAUTHORIZED:"UNAUTHORIZED",AUTHORIZED:"AUTHORIZED",RETRYING:"RETRYING"}}(),function(e){"use strict";function t(e){this._retryCallback=e,this._retryCounter=0}t.prototype={getRetryCallback:function(){return this._retryCallback},getRetryCounter:function(){return this._retryCounter},incrementCounter:function(){this._retryCounter++}},e.Base.NetworkRequestRetryHelper=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProvidersEventTypes={PING:"Ping"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="NetworkError"}e.prototype=Object.create(i.Base.BaseError.prototype),i.Base.NetworkError=e}(AvayaClientServices),function(e){"use strict";function t(){this._listeners={}}t.prototype={on:function(e,t){return"function"!=typeof t||(this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)),this},off:function(e,t){if("function"!=typeof t)return this;if(this._listeners[e]===T)throw new Error("There is no such handler for event with name: "+e+".");t=this._listeners[e].indexOf(t);if(-1===t)throw new Error("There is no such handler for event with name: "+e+".");return this._listeners[e].splice(t,1),this},trigger:function(e,i){e=this._listeners[e];e!==T&&(i=i||[],S.each(e,function(e,t){t.apply(window,i)}))},hasListeners:function(e){e=this._listeners[e];return e!==T&&e.length},_removeListeners:function(){for(var e in this._listeners)if(this._listeners.hasOwnProperty(e))for(var t=this._listeners[e].length-1;0<=t;t--)this.off(e,this._listeners[e][t])}},e.Base.Observable=t}(AvayaClientServices),function(n){"use strict";function e(e){this._servers=[],this._config=e,this._performanceManagerProfile=T,this._callService=T,this._contentSharingService=T,this._screenCapturers=[],this._currentResolution=n.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution],this._isMonitoringAdjustment=!1,this._cameraDeallocated=!1,this._lastCpuUsageWarning=T,this._lastLowBandwidthWarning=T,this._lastBandwidthAvailableWarning=T,this._lastPerformanceAdjustment=0,this._isAdjustmentInProgress=!1,this._performanceAdjustmentsReleaseWindow=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.performanceAdjustmentsReleaseWindowDuration")||60,this._interval=2e3,this._isAdjustmentBlocked=!1,this._checkForLowCpuUsage=function(){},this._lastWarnReason=T,this._lastWarnReport=T,this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionReductionInterval")||10,this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionIncrementInterval")||60,this.CONTENT_SHARING_LOW_QUALITY_PROFILE=1,this.CONTENT_SHARING_HIGH_QUALITY_PROFILE=5,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH=400,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH=800}e.prototype.setCallService=function(e){this._callService=e,this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,function(e){this._updatePerformanceManagerProfile(e)}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,function(e){e?this._cameraDeallocated=e:this._cameraDeallocated&&(this._cameraDeallocated=!this._cameraDeallocated,this._startMonitoringAdjustment())}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,function(e,t){this._onPerformanceMonitorAlert(e,t)}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,function(){this._startMonitoringAdjustment()}.bind(this))},e.prototype.registerScreenCapturer=function(e){this._screenCapturers.push(e),e.setPerformanceManagerProfile(this._performanceManagerProfile),e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype.setContentSharingService=function(e){this._contentSharingService=e,this._contentSharingService.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype.registerServer=function(e){this._servers.push(e),e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),e._onStart=function(){}.bind(this),e._onStop=function(){this._lastBandwidthAvailableWarning=0,this._lastLowBandwidthWarning=0,this._servers.splice(this._servers.indexOf(e),1),this._increaseContentSharingQuality(),this._startMonitoringAdjustment()}.bind(this)},e.prototype.registerPerformanceSource=function(e){e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype._stepDownVideoResolution=function(e,t){var i,a,r=1e3*this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME,s=this._callService.getActiveCall();n.Base.Utils.isDefined(s)?this._callService.hasVideoTracks(s)?this._isAdjusmentBlocked(r)||(this._isAdjustmentInProgress=!0,a=this._callService.getVideoSendResolution(s),r=(i=n.Providers.Call.CPUtils.nextLowerVideoResolution(a)).getHeight()<a.getHeight(),a=360<=i.getHeight(),r&&a?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Lowering video resolution to "+i+". Reason: "+e),this._setVideoResolution(s,i).then(function(){this._startMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Lowered video resolution: ",i)}.bind(this),function(e){n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to lower video resolution: ",e)}.bind(this))):(t&&this._decreaseContentSharingQuality(),this._isAdjustmentInProgress=!1)):t&&this._decreaseContentSharingQuality():(t&&this._decreaseContentSharingQuality(),this._stopMonitoringAdjustment())},e.prototype._stepUpVideoResolution=function(){var e,t,i,a=1e3*this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME,r=this._callService.getActiveCall();n.Base.Utils.isDefined(r)?this._callService.hasVideoTracks(r)&&(this._isAdjusmentBlocked(a)||(this._isAdjustmentInProgress=!0,i=this._callService.getVideoSendResolution(r),e=this._getPreferredResolution(r)||this._callService.getVideoResolution(r),a=(t=n.Providers.Call.CPUtils.nextHighestVideoResolution(i)).getHeight()>i.getHeight(),i=t.getHeight()<=e.getHeight(),a&&i?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Increasing video resolution to "+t),this._setVideoResolution(r,t).then(function(){this._lastCpuUsageWarning=Date.now(),t===e&&this._stopMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Video resolution increased to: ",t)}.bind(this),function(e){this._stopMonitoringAdjustment(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to increase video resolution: ",e)}.bind(this))):this._isAdjustmentInProgress=!1)):this._stopMonitoringAdjustment()},e.prototype._getPreferredResolution=function(e){return!0===e._preferredResolutionCapability.isAllowed&&1===e.getVideoChannels().length?n.Base.VideoResolution[e.getVideoChannels()[0].getPreferredResolution()]:null},e.prototype._increaseContentSharingQuality=function(){this._setContentSharingQuality(this.CONTENT_SHARING_HIGH_QUALITY_PROFILE,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH)},e.prototype._decreaseContentSharingQuality=function(){this._contentSharingService&&this._contentSharingService.isContentSharingActive()&&this._setContentSharingQuality(this.CONTENT_SHARING_LOW_QUALITY_PROFILE,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH)},e.prototype._setContentSharingQuality=function(e,t){this._contentSharingService.getMaxUploadSpeed()!==t?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Setting content sharing quality to ("+e+", "+t+"kbps)"),this._contentSharingService.setImageQuality(e),this._contentSharingService.setMaxUploadSpeed(t),this._lastPerformanceAdjustment=Date.now()):n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Content sharing quality remains unchanged, current max upload speed:"+t+"kbps")},e.prototype._setVideoResolution=function(e,t){return this._callService.setVideoSendResolution(e,t).then(function(){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),this._startMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Setting video resolution to: ",t)}.bind(this),function(e){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to set video resolution: ",e)}.bind(this))},e.prototype._throttleAdjustment=function(e){this._isAdjustmentBlocked||(this._isAdjustmentBlocked=!0,e.apply(this,arguments),setTimeout(function(){this._isAdjustmentBlocked=!1}.bind(this),1e3))},e.prototype._isAdjusmentBlocked=function(e){e=Date.now()-this._lastPerformanceAdjustment<e;return this._isAdjustmentInProgress||e},e.prototype._startMonitoringAdjustment=function(){this._isMonitoringAdjustment||(this._isMonitoringAdjustment=!0,this._lastCpuUsageWarning=Date.now(),this._lastLowBandwidthWarning=Date.now(),this._lastBandwidthAvailableWarning=Date.now(),this._lastWarnReason="Monitoring starting",this._lastWarnReport=Date.now(),this._checkForLowCpuUsage=function(){var e=(Date.now()-this._lastLowBandwidthWarning)/1e3,t=(Date.now()-this._lastCpuUsageWarning)/1e3,i=(Date.now()-this._lastBandwidthAvailableWarning)/1e3;t>this._performanceAdjustmentsReleaseWindow&&e>this._performanceAdjustmentsReleaseWindow&&i>this._performanceAdjustmentsReleaseWindow?this._throttleAdjustment(this._stepUpVideoResolution):(Date.now()-this._lastWarnReport)/1e3>this._performanceAdjustmentsReleaseWindow&&(this._lastWarnReport=Date.now(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Resolution not increased because: "+this._lastWarnReason))},this._setInterval=setInterval(this._checkForLowCpuUsage.bind(this),this._interval))},e.prototype._stopMonitoringAdjustment=function(){this._isMonitoringAdjustment&&(this._isMonitoringAdjustment=!1,this._lastCpuUsageWarning=T,this._lastLowBandwidthWarning=T,this._lastBandwidthAvailableWarning=T,this._lastWarnReason=T,clearInterval(this._setInterval))},e.prototype._onPerformanceMonitorAlert=function(e,t){switch(e){case n.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED:this._throttleAdjustment(this._stepDownVideoResolution.bind(this,t,!0));break;case n.Base.PerformanceAlertType.CPU_USAGE_WARNING:this._lastCpuUsageWarning=Date.now(),this._lastWarnReason=t;break;case n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD:this._lastLowBandwidthWarning=Date.now(),this._throttleAdjustment(this._stepDownVideoResolution.bind(this,t,!1));break;case n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING:this._lastBandwidthAvailableWarning=Date.now(),this._lastWarnReason=t}},e.prototype._updatePerformanceManagerProfile=function(e){this._performanceManagerProfile=n.Providers.ContentSharing.PerformanceManagerProfiles[e]},n.Base.CallPerformanceManager=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.PerformanceAlertType={CPU_USAGE_OVERLOADED:"CPU_USAGE_OVERLOADED",CPU_USAGE_WARNING:"CPU_USAGE_WARNING",BANDWIDTH_UNAVAILABLE_OVERLOAD:"BANDWIDTH_UNAVAILABLE_OVERLOAD",BANDWIDTH_UNAVAILABLE_WARNING:"BANDWIDTH_UNAVAILABLE_WARNING"}}(),function(e){"use strict";function t(){}t.prototype.onPerformanceMonitorAlert=function(e,t){},e.Base.PerformanceSource=t}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={state:function(){},always:function(e){},done:function(e){},fail:function(e){},progress:function(e){},then:function(e,t,i){}},e.Base.Promise=t}(AvayaClientServices),function(a){"use strict";function e(){this.messagingProviders=[],this.conferenceProviders=[],this.callProviders=[],this.collaborationProviders=[],this._ammProviderFactory={},this._ammProvider={},this._wcsProviderFactory={},this._wcsProvider={},this._contactsProviders=[],this._directorySearchProviders=[],this._acsProviderFactory={},this._acsContactsProvider={},this._acsDirectorySearchProvider={},this._presenceProviders=[],this._csgProviderFactory={},this._csgPresenceProvider={},this._scopiaProvider={},this._sgCallProvider={},this._scopiaConferenceProviderFactory={},this._rtcConnectionProviderFactory={},this._remoteLoggerProvider=T}e.prototype={getMessagingProviders:function(e){if(0<this.messagingProviders.length)return this.messagingProviders;e=this._getAMMProvider(this._getAMMProviderConfiguration(e));return S.isEmptyObject(e)||this.messagingProviders.push(e),this.messagingProviders},getContactsProviders:function(e){var t;return 0===this._contactsProviders.length&&(t=this._getACSContactsProvider(),S.isEmptyObject(t)||this._contactsProviders.push(t)),this._contactsProviders},_getACSContactsProvider:function(){return S.isEmptyObject(this._acsContactsProvider)&&(S.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new a.Providers.ACS.ACSProviderFactory),this._acsContactsProvider=this._acsProviderFactory.getACSContactsProvider()),this._acsContactsProvider},getDirectorySearchProviders:function(e){var t;return 0===this._directorySearchProviders.length&&(t=this._getACSDirectorySearchProvider(),S.isEmptyObject(t)||this._directorySearchProviders.push(t)),this._directorySearchProviders},_getACSDirectorySearchProvider:function(){return S.isEmptyObject(this._acsDirectorySearchProvider)&&(S.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new a.Providers.ACS.ACSProviderFactory),this._acsDirectorySearchProvider=this._acsProviderFactory.getACSDirectorySearchProvider()),this._acsDirectorySearchProvider},getPresenceProviders:function(e){return 0===this._presenceProviders.length&&(e=this._getCSGPresenceProvider(e),S.isEmptyObject(e)||this._presenceProviders.push(e)),this._presenceProviders},_getCSGPresenceProvider:function(e){return S.isEmptyObject(this._csgPresenceProvider)&&(this._csgPresenceProvider=this._getCSGProviderFactory().getCSGPresenceProvider(e)),this._csgPresenceProvider},getConferenceProviders:function(e){if(0<this.conferenceProviders.length)return this.conferenceProviders;e=this._getScopiaConferenceProvider(e.uccpConfiguration);return S.isEmptyObject(e)||this.conferenceProviders.push(e),this.conferenceProviders},getCallProviders:function(e,t,i){return 0<this.callProviders.length||e.sgConfiguration!==T&&!a.Base.Utils.isBool(e.sgConfiguration.enabled)||(i=this._getSGCallProvider(e.sgConfiguration,t,i),S.isEmptyObject(i)||this.callProviders.push(i)),this.callProviders},getVoiceMessagingProvider:function(e){var t=e.networkProviderConfiguration.restConfig,e=t.isSecure?a.Base.Utils.isDefined(t.port)?t.port:"443":a.Base.Utils.isDefined(t.port)?t.port:"80",e=t.hostName+":"+e;return this._getCSGProviderFactory().getCSGCallsProvider(e)},_getAMMProvider:function(e){return S.isEmptyObject(this._ammProvider)&&(S.isEmptyObject(this._ammProviderFactory)&&(this._ammProviderFactory=new a.Providers.AMM.AMMProviderFactory),this._ammProvider=this._ammProviderFactory.getAMMProvider(e)),this._ammProvider},_getWCSProvider:function(e){return S.isEmptyObject(this._wcsProvider)&&(S.isEmptyObject(this._wcsProviderFactory)&&(this._wcsProviderFactory=new a.Providers.WCS.WCSProviderFactory),this._wcsProvider=this._wcsProviderFactory.getWCSProvider(e)),this._wcsProvider},_getWCSProviderConfiguration:function(e){return e.wcsConfiguration},_getScopiaConferenceProvider:function(e){return S.isEmptyObject(this._scopiaProvider)&&(S.isEmptyObject(this._scopiaConferenceProviderFactory)&&(this._scopiaConferenceProviderFactory=new a.Providers.Scopia.ScopiaConferenceProviderFactory),this._scopiaProvider=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(e)),this._scopiaProvider},_getSGCallProvider:function(e,t,i){return S.isEmptyObject(this._sgCallProvider)&&(this._sgCallProvider=new a.Providers.Call.CallProvider(this._getCSGProviderFactory(),t,i,this._getRTCConnectionProviderFactory())),this._sgCallProvider},_getCSGProviderFactory:function(){return S.isEmptyObject(this._csgProviderFactory)&&(this._csgProviderFactory=new a.Providers.CallServiceGateway.CallServiceGatewayProviderFactory),this._csgProviderFactory},_getRTCConnectionProviderFactory:function(){return S.isEmptyObject(this._rtcConnectionProviderFactory)&&(this._rtcConnectionProviderFactory=new a.Base.RTCConnectionProviderFactory),this._rtcConnectionProviderFactory},_getAMMProviderConfiguration:function(e){return e.ammConfiguration},getCollaborationProviders:function(e){if(0<this.collaborationProviders.length)return this.collaborationProviders;e=this._getWCSProvider(this._getWCSProviderConfiguration(e));return S.isEmptyObject(e)||this.collaborationProviders.push(e),this.collaborationProviders},createCollaborationProviders:function(e){return[(new a.Providers.WCS.WCSProviderFactory).getWCSProvider(this._getWCSProviderConfiguration(e))]},getRemoteLoggerProvider:function(){return a.Base.Utils.isUndefined(this._remoteLoggerProvider)&&(this._remoteLoggerProvider=new a.Providers.RemoteLogger.RemoteLoggerProvider),this._remoteLoggerProvider}},a.Base.ProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProviderTypes={REST_PROVIDER:"RestProvider",WEB_SOCKET_PROVIDER:"WebSocketProvider",SSE_PROVIDER:"SSEProvider",WCS_COMET_PROVIDER:"WCSCometProvider",UCCP_LONG_POLLING_PROVIDER:"UCCPLongPollingProvider"}}(),function(e){"use strict";function t(e,t,i,a){this._width=i,this._height=a,this._x=e,this._y=t}t.prototype={getX:function(){return this._x},getY:function(){return this._y},getWidth:function(){return this._width},getHeight:function(){return this._height},toString:function(){return"x:"+this._x+" y:"+this._y+" width:"+this._width+" height:"+this._height}},e.Base.Rect=t}(AvayaClientServices),function(u){"use strict";var t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,h=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,a=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})) \d+ typ .*/,r=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/,s=/candidate:\w{1,32} \d{1,5} (udp|UDP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/;function e(e,t,i,a,r){u.Base.Observable.call(this),this.isAvailable()&&(this._rtcConfig=e,this._dtmfSender=T,this._iceNegotiatedCallback=T,this._updateSdpCallback=T,this._sdpErrorCallback=T,this._iceGatheringTimeoutId=T,this._relayCandidatesTimeoutId=T,this._relayIceCandidateCountTimeoutId=T,this._waitForIceGatheringTimeoutId=T,this._localMediaCount=0,this._mediaStreams=[],this._iceCandidates=[],this._iceRelayCandidatesCounter={},this._hasGatheredIceCandidates=!1,this._lookupRelayCandidates=!!e&&!!e.iceTransportPolicy&&"relay"===e.iceTransportPolicy,this._RELAY_CANDIDATES_TIMEOUT=t,this._LAST_RELAY_CANDIDATE_TIMEOUT=i,this._ICE_GATHERING_TIMEOUT=i,this._ICE_RESTART_INTERVAL=a,this._MAX_ICE_RECOVERY_TIME=r,this._statsParser=new u.Base.AbstractRTCStatsReportParser,this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks=S.Callbacks())}(e.prototype=Object.create(u.Base.Observable.prototype)).isAvailable=function(){return t&&h},e.prototype.addStream=function(e){u.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig)},e.prototype.removeStream=function(e){},e.prototype.createPeerConnection=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Closing the peer connection and re-creating it with new config.",e),this.close(),u.Base.Utils.isDefined(e)&&!S.isEmptyObject(e)||(e=null),this._pc=new t(e)},e.prototype.updatePeerConfiguration=function(e,t){this._lookupRelayCandidates=!!e&&!!e.iceTransportPolicy&&"relay"===e.iceTransportPolicy,this._rtcConfig=e,t=t||!1,(this._lookupRelayCandidates||t)&&(this._iceCandidates=[],this._hasGatheredIceCandidates=!1)},e.prototype.updatePeerConnection=function(e){if(this.isRTCRtpSenderSupported()){var t=[];this._pc.getSenders().forEach(function(e){this._haveLiveTrack(e)?(t.push(e.track),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Found track to propagate to the new peer connection.",e.track.id,e.track.type)):e.track&&u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Will NOT propagate track to the new peer connection.",e.track.id,e.track.type,e.track.readyState)}.bind(this)),this.createPeerConnection(e);for(var i=new MediaStream,a=0;a<t.length;++a)this.addTrack(t[a],i)}else{var r=this._pc.getLocalStreams();this.createPeerConnection(e),r.forEach(function(e){this.addStream(e)}.bind(this))}},e.prototype._haveLiveTrack=function(e){return null!==e.track&&e.track!==T&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE},e.prototype.rollbackLocalOfferState=function(){},e.prototype.createOffer=function(r,s,n,o,c,l,e){var d=0;e=!!u.Base.Utils.isDefined(e)&&e,u.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(d=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._lookupRelayCandidates?this.createRelayOffer(r,s,n,o,this._rtcConfig,d,c,l):d&&this._rtcConfig._turnOfferType&&"hostOnly"===this._rtcConfig._turnOfferType?this.createHostOnlyOffer(r,s,n,o,this._rtcConfig,d,c,l,e):(!d||this._hasGatheredIceCandidates||this.hasICECandidates()||(this._rtcConfig._turnOfferType&&"relayOnly"===this._rtcConfig._turnOfferType&&(this._rtcConfig.iceTransportPolicy="relay"),this.updatePeerConnection(this._rtcConfig)),this._localMediaCount=this.getLocalMediaCount(),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),e=this._createOfferOptions(o),c&&(e.iceRestart=c),this._pc.createOffer(e).then(function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp;"function"==typeof n&&(i=n(i));function a(){!function(){this._iceNegotiatedCallback=r,this._updateSdpCallback=n,this._sdpErrorCallback=s;var e=Math.max(d,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),e)}.call(this),this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}t={type:t,sdp:i};this._pc.setLocalDescription(new h(t)).then(function(){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),a.call(this)}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),c&&Date.now()-l<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,c,l)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),c&&Date.now()-l<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,c,l)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this)))},e.prototype.createRelayOffer=function(a,r,s,n,o,c,l,d){var t,i,C,e;0===o.iceServers[0].urls.length||c<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?u.Base.Logger.info("Creating Relay Offer using "+o.iceServers[0].urls[0]):(e=S.extend(!0,{},o),t=e.iceServers[0].urls.shift(),e.iceServers[0].urls=[t],this.updatePeerConnection(e),u.Base.Logger.info("Creating Relay Offer using "+t)),C=function(){!function(){this._iceNegotiatedCallback=a,this._updateSdpCallback=s,this._sdpErrorCallback=r,i=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),c);var e=0===o.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(c-=e,o.iceServers[0].urls.shift(),u.Base.Logger.info("No relay candidates found  with "+t+". Remaining turn servers to try: "+o.iceServers[0].urls.length),this.createRelayOffer(a,r,s,n,o,c,l,d))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),e)}.call(this),this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))},this._pc.onicecandidate=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),c-=Date.now()-i,o.iceServers[0].urls.shift(),u.Base.Logger.info("No relay candidates found  with "+t+". Remaining turn servers to try: "+o.iceServers[0].urls.length),this.createRelayOffer(a,r,s,n,o,c,l,d))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),e=this._createOfferOptions(n),l&&(e.iceRestart=l),this._pc.createOffer(e).then(function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp,t={type:t,sdp:i="function"==typeof s?s(i):i};this._pc.setLocalDescription(new h(t)).then(function(){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),C.call(this)}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,r,s,n,o,c,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):r(e)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,r,s,n,o,c,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):r(e)}.bind(this),e))},e.prototype._isHostOnlyUdpCandidate=function(t,e){var i=!0;try{(a.test(t)||r.test(t)||s.test(t)&&!e)&&(i=!1)}catch(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to parse ICE candidate: ",t)}return i},e.prototype.createHostOnlyOffer=function(r,s,n,o,c,e,l,d,C){u.Base.Logger.info("Creating host only Offer"),this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection({}),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._isHostOnlyUdpCandidate(e.candidate.candidate,C)&&this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length||this._hasGatheredIceCandidates?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),u.Base.Logger.info("No host only candidates found. Trying relay only servers: "+c.iceServers[0].urls.length),c._turnOfferType="relayOnly",this.createOffer(r,s,n,o,l,d,C))}.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this);var t=this._createOfferOptions(o);l&&(t.iceRestart=l),this._pc.createOffer(t).then(function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp;"function"==typeof n&&(i=n(i));function a(){!function(){this._iceNegotiatedCallback=r,this._updateSdpCallback=n,this._sdpErrorCallback=s,this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(u.Base.Logger.info("No host only candidates found. Trying relay only servers: "+c.iceServers[0].urls.length),c._turnOfferType="relayOnly",this.createOffer(r,s,n,o,l,d,C))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),this._ICE_GATHERING_TIMEOUT)}.call(this),this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}t={type:t,sdp:i};this._pc.setLocalDescription(new h(t)).then(function(){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),a.call(this)}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))},e.prototype.receiveAnswer=function(e,t,i){this._pc.setRemoteDescription(new h({type:"answer",sdp:e})).then(t).catch(i)},e.prototype.createAnswer=function(s,n,o,c){var t,l=0;u.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(l=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._lookupRelayCandidates?this.createRelayAnswer(s,n,o,c,this._rtcConfig,l):(["SCM-W09","RVL-AL09"].forEach(function(e){navigator.userAgent.includes(e)&&(s=u.Base.SDPUtil.updateProfileLevelId(s,"42E01F"))}),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createAnswer offer SDP:\n"+s),!l||this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection(this._rtcConfig),this._localMediaCount=this.getLocalMediaCount(),(t=function(e,t){return this._pc.setRemoteDescription(new h({type:e,sdp:t})).then(function(){this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),this._pc.createAnswer().then(function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var t=e.type,i=e.sdp,a=u.Base.SDPUtil.getProfileLevelId(s),e=u.Base.SDPUtil.getProfileLevelId(i);a&&e&&(a=a.toUpperCase(),e=e.toUpperCase(),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",a),a===e||"424028"!==a&&"42401F"!==a||(i=u.Base.SDPUtil.updateProfileLevelId(i,a))),"function"==typeof c&&(i=c(i));function r(){!function(){this._iceNegotiatedCallback=n,this._updateSdpCallback=c,this._sdpErrorCallback=o;var e=Math.max(l,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),e)}.call(this),this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}i={type:t,sdp:i};this._pc.setLocalDescription(new h(i)).then(function(){r.call(this)}.bind(this),function(e){this._answerError(e,o)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+e),o(e)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e)}.bind(this))}.bind(this))("offer",s).catch(function(e){"42401F"===u.Base.SDPUtil.getProfileLevelId(s)?(u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Trying to set profile-level-id to 42E01F"),s=u.Base.SDPUtil.updateProfileLevelId(s,"42E01F"),t("offer",s).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e)})):(u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e))}))},e.prototype.createRelayAnswer=function(s,i,n,o,a,c){var e,l;u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createRelayAnswer offer SDP:\n"+s),0===a.iceServers[0].urls.length||c<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?u.Base.Logger.info("Creating Relay Answer using "+a.iceServers[0].urls[0]):(e=S.extend(!0,{},a),l=e.iceServers[0].urls.shift(),e.iceServers[0].urls=[l],this.updatePeerConnection(e),u.Base.Logger.info("Creating Relay Answer using "+l)),this._pc.setRemoteDescription(new h({type:"offer",sdp:s})).then(function(){function r(){!function(){this._iceNegotiatedCallback=i,this._updateSdpCallback=o,this._sdpErrorCallback=n,t=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),c);var e=0===a.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(c-=e,a.iceServers[0].urls.shift(),u.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+a.iceServers[0].urls.length),this.createRelayAnswer(s,i,n,o,a,c))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),e)}.call(this),this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}var t;this._pc.onicecandidate=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),c-=Date.now()-t,a.iceServers[0].urls.shift(),u.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+a.iceServers[0].urls.length),this.createRelayAnswer(s,i,n,o,a,c))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this,i),this._pc.createAnswer().then(function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var t=e.type,i=e.sdp,a=u.Base.SDPUtil.getProfileLevelId(s),e=u.Base.SDPUtil.getProfileLevelId(i);a&&e&&(a=a.toUpperCase(),e=e.toUpperCase(),u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",a),a===e||"424028"!==a&&"42401F"!==a||(i=u.Base.SDPUtil.updateProfileLevelId(i,a)));i={type:t,sdp:i="function"==typeof o?o(i):i};this._pc.setLocalDescription(new h(i)).then(function(){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createAnswer.setLocalDescription"),r.call(this)}.bind(this),function(e){this._answerError(e,n)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+e),n(e)}.bind(this))}.bind(this)).catch(function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),n(e)}.bind(this)))},e.prototype._answerError=function(e,t){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+e),t(e)},e.prototype._iceGatheringTimeoutHandler=function(){var e;clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayCandidatesTimeoutId=T,this._relayIceCandidateCountTimeoutId=T,this._iceGatheringTimeoutId=T,this._pc.onicecandidate=function(e){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),u.Base.Utils.isDefined(this._pc)&&(u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),0===this._iceCandidates.length?this._handleIceGatheringTimeoutError():(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering.  Using current SDP"),u.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T))},e.prototype._handleIceGatheringTimeoutError=function(){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering. No candidates found"),u.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=T),u.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T),this._throwSdpError(),this._iceNegotiatedCallback=T,this._updateSdpCallback=T,this._sdpErrorCallback=T},e.prototype._throwSdpError=function(){this._sdpErrorCallback({errorCode:u.Services.Call.CallError.TRANSPORT_ERROR,protocolType:u.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},e.prototype._relayCandidatesTimeoutHandler=function(){var e;u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice host only or relay candidates gathering: "+this._iceCandidates.length),this._relayCandidatesTimeoutId=T,0<this._iceCandidates.length&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T,this._pc.onicecandidate=function(e){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),u.Base.Utils.isDefined(this._pc)&&(u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),u.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T))},e.prototype.close=function(){this._pc&&((u.Base.Utils.isDefined(this._pc.connectionState)?this._pc.connnectionState:this._pc.signalingState)!==u.Base.AbstractRTCConnectionProvider.Constants.RTC_PEER_CONNECTION_STATE_CLOSED&&this._pc.close(),this._mediaStreams=[],clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),clearTimeout(this._waitForIceGatheringTimeoutId))},e.prototype.hasICECandidates=function(){return 0<this._iceCandidates.length},e.prototype.onAddStream=function(e){},e.prototype.onAddRemoteTrack=function(e){},e.prototype.onRemoveRemoteTrack=function(e){},e.prototype.onAddTrackInternal=function(e){e=e.track;e&&this.onAddRemoteTrack&&this.onAddRemoteTrack(e)},e.prototype.onRemoveTrackInternal=function(e){e=e.track;e&&this.onRemoveRemoteTrack&&this.onRemoveRemoteTrack(e)},e.prototype.onTrackInternal=function(t){var e,i;this.onAddStream&&(0<t.streams.length?(e=this._mediaStreams.findIndex(function(e){return e.id===t.streams[0].id}),(i=t.streams[0])&&(i.onaddtrack=this.onAddTrackInternal.bind(this),i.onremovetrack=this.onRemoveTrackInternal.bind(this),-1===e?(this._mediaStreams.push(i),this.onAddStream(i)):this._mediaStreams[e].active||(this._mediaStreams[e]=i,this.onAddStream(i)))):t.track&&t.track.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&this.onAddRemoteTrack&&(0<(i=this._pc.getRemoteStreams()).length&&(i[0].addTrack(t.track),i[0].onaddtrack=this.onAddTrackInternal.bind(this),i[0].onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddRemoteTrack(t.track))))},e.prototype._getDTMFSender=function(){},e.prototype._sendUpdatedSdp=function(){var e;u.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T),u.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=T),u.Base.Utils.isDefined(this._relayIceCandidateCountTimeoutId)&&(clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayIceCandidateCountTimeoutId=T),u.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T)},e.prototype._onIceCandidate=function(e){var t,i;u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?(this._iceCandidates.push(e.candidate.candidate),this._lookupRelayCandidates||-1===e.candidate.candidate.indexOf("relay")||(!(t=this.parseIceRelayCandidate(e.candidate.candidate,e.candidate))||"1"!==t.component&&"rtp"!==t.component||(i=0,e=t.networkId||"0",e=t.foundation+":"+e,this._iceRelayCandidatesCounter.hasOwnProperty(e)&&(i=this._iceRelayCandidatesCounter[e]),this._iceRelayCandidatesCounter[e]=++i,i===this._localMediaCount&&u.Base.Utils.isUndefined(this._relayIceCandidateCountTimeoutId)&&(u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Short circuiting relay candidates"),this._relayIceCandidateCountTimeoutId=setTimeout(function(){this._pc.onicecandidate=function(e){u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._sendUpdatedSdp()}.bind(this),2e3))))):0<this._iceCandidates.length?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(i=this._hasGatheredIceCandidates?1e3:0,setTimeout(function(){0===this._iceCandidates.length&&(this._hasGatheredIceCandidates?this._sendUpdatedSdp():this._handleIceGatheringTimeoutError())}.bind(this),i))},e.prototype._oniceGatheringStateChange=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> oniceGatheringStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this._pc.iceGatheringState===u.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_GATHERING&&(clearTimeout(this._waitForIceGatheringTimeoutId),this._waitForIceGatheringTimeoutId=T,this._hasGatheredIceCandidates||(this._hasGatheredIceCandidates=0!==this._iceCandidates.length),this._iceCandidates=[])},e.prototype._oniceConnectionStateChange=function(e){u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< oniceConnectionStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]),this._pc.iceConnectionState===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CLOSED&&(this._iceCandidates=[],this.trigger(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[]))},e.prototype.stopAllStreams=function(){},e.prototype.enableAllStreams=function(){this.enableLocalStreams(),this.enableRemoteStreams()},e.prototype.enableRemoteStreams=function(){this._enableDisableRemoteStreams(!0)},e.prototype.disableRemoteStreams=function(){this._enableDisableRemoteStreams(!1)},e.prototype._enableDisableRemoteStreams=function(e){},e.prototype.enableLocalStreams=function(){this._enableDisableLocalStreams(!0)},e.prototype.disableLocalStreams=function(){this._enableDisableLocalStreams(!1)},e.prototype._enableDisableLocalStreams=function(e){},e.prototype.enableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!0)},e.prototype.disableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!1)},e.prototype._enableDisableLocalAudioStreams=function(e){},e.prototype.enableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!0)},e.prototype.disableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!1)},e.prototype._enableDisableLocalVideoStreams=function(e){},e.prototype.enableRemoteAudioStream=function(){this._enableDisableRemoteAudioStream(!0)},e.prototype.enableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!0)},e.prototype.disableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!1)},e.prototype._enableDisableRemoteAudioStream=function(e){},e.prototype._enableDisableRemoteVideoStreams=function(e){},e.prototype.limitOutgoingVideoBitRate=function(i){this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(e){var t;e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Limiting outgoing video bitrate "+e.track.id+" to "+i),(t=e.getParameters()).encodings.forEach(function(e){e.maxBitRate=1024*i}),e.setParameters(t).catch(function(e){u.Base.Logger.warn("Failed to limit outgoing video bitrate",e)}))})},e.prototype.enableRemoteVideoTrack=function(t,i){t.getVideoTracks().forEach(function(e){e.id===i.id?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Enabling video track: "+e.id+" for "+t.id),e.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(t.removeTrack(e),t.addTrack(i)):e.enabled=!0):(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Disabling old video track: "+e.id+" for "+t.id),e.enabled=!1,e.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.removeTrack(e))}.bind(this))},e.prototype.sendDTMF=function(e){var t=this._getDTMFSender();return!!u.Base.Utils.isDefined(t)&&(t.insertDTMF(e),!0)},e.prototype.isPlaying=function(e){return!!(0<e.currentTime&&!e.paused&&!e.ended&&2<e.readyState)},e.prototype.stopStream=function(e){u.Base.Utils.isDefined(e)&&null!==e&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping stream "+e.id),e.getTracks().forEach(function(e){e.stop()}))},e.prototype.hasVideo=function(e){return e&&0<e.getVideoTracks().length},e.prototype._createOfferOptions=function(e){return u.Base.Utils.isDefined(e)?this.addTransceiverIfNeeded(e)?{offerToReceiveAudio:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:e!==u.Services.Call.MediaDirection.INACTIVE}:{}},e.prototype.isRTCRtpSenderSupported=function(){return!1},e.prototype.addTrack=function(e,t){u.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this.monitorAudioTrack(e)},e.prototype.monitorAudioTrack=function(i){i&&i.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(i.onended=function(e){var t=i?i.id:T;u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"*** Local audio track ended "+t),this.trigger(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,[i])}.bind(this))},e.prototype.removeLocalAudioTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local audio track: "+e.track.id),e.track.stop(),t.removeTrack(e.track))}.bind(this))},e.prototype.removeLocalVideoTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local video track: "+e.track.id),e.track.stop(),t.removeTrack(e.track))}.bind(this))},e.prototype.removeIfDoesNotSupportReplaceTrack=function(e){},e.prototype.replaceLocalMediaTrack=function(i,e){var a=S.Deferred(),r=0,s=function(){e?(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+i.kind+" track  "+i.id),this.addTrack(i,e),e.addTrack(i),this.monitorAudioTrack(i),a.resolve(!0)):(u.Base.Logger.warn(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+i.kind+" track  "+i.id+" due to missing media stream"),a.reject("Missing local media stream"))}.bind(this);return this._pc.getSenders().forEach(function(t){t.track&&t.track.kind===i.kind&&(r++,u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+i.kind+" track  "+t.track.id+" with "+i.id),t.replaceTrack(i).then(function(){e&&(e.addTrack(i),this.monitorAudioTrack(i));a.resolve(!1)}.bind(this)).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+i.kind+" track instead due to "+e),t.track.stop(),s()}))}.bind(this)),0===r&&s(),a.promise()},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t)}.bind(this))},e.prototype.isSetLocalVideoDirectionSupported=function(){return!!this._pc&&"getTransceivers"in this._pc},e.prototype.hasVideoTrackStopStreaming=function(t){return this.isRTCRtpSenderSupported()?0!==this._pc.getSenders().filter(function(e){return!!e.track&&e.track.id===t.id&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED}.bind(this)).length:!!t&&t.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED},e.prototype.hasVideoTracks=function(){return!!this.isRTCRtpSenderSupported()&&0!==this._pc.getSenders().filter(function(e){return!!e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK}.bind(this)).length},e.prototype.getStats=function(){return this._getStats([u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},e.prototype.getVideoStats=function(){return this._getStats([u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},e.prototype._getStats=function(t){if(this.isRTCRtpSenderSupported()){var i=S.Deferred(),a=new u.Base.AudioStatistics,r=new u.Base.VideoStatistics,s={},n=[],o=!t.includes(u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK);return this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.includes(e.track.kind)&&n.push(e.getStats().then(function(e){o?this._statsParser.parseVideoStats(e,r):this._statsParser.parse(e,a,r,s)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.includes(e.track.kind)&&n.push(e.getStats().then(function(e){o?this._statsParser.parseVideoStats(e,r):this._statsParser.parse(e,a,r,s)}.bind(this)))}.bind(this)),S.when.apply(this,n).then(function(){i.resolve({audioStatistics:a,videoStatistics:r,iceCandidateStatistics:s})},function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),i.reject(e)}),i.promise()}return this._pc.getStats(null).then(function(e){return this._statsParser.parse(e)}.bind(this)).catch(function(e){return u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),Promise.reject(e)})},e.prototype.adjustVideoConstraints=function(e,t,i,a){var r=S.Deferred();return e&&t?(a=this._createVideoConstraintsList(e,t,i,a),this._applyVideoConstraints(r,a)):r.reject("Undefined video width or height"),r.promise()},e.prototype.adjustAudioConstraints=function(e){var t=S.Deferred(),i=navigator.mediaDevices.getSupportedConstraints();return u.Base.Utils.isDefined(e)&&i.noiseSuppression?(e={noiseSuppression:e},this._applyAudioConstraints(t,e)):t.reject("Unsupported constraints"),t.promise()},e.prototype.updateMediaConstraints=function(e,t){var i,a=!1;for(i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&t[i]===e[i]||(t[i]=e[i],a=!0));return a},e.prototype._applyAudioConstraints=function(i,a){this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(t){var e;t.track&&t.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&t.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=t.track.getConstraints(),this.updateMediaConstraints(a,e)?(u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",e),t.track.applyConstraints(e).then(function(){var e=t.track.getConstraints();u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",e),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",e),i.reject("Failed to apply audio constraints")}.bind(this))):i.resolve())}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(t){var e;t.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=t.getConstraints(),this.updateMediaConstraints(a,e)?(u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",a),t.applyConstraints(e).then(function(){var e=t.getConstraints();u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",e),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",e),i.reject("Failed to apply audio constraints")}.bind(this))):i.resolve())}.bind(this))}.bind(this))},e.prototype._applyVideoConstraints=function(i,a){var r=a.shift(),e=!1;r?this.isRTCRtpSenderSupported()?(this._pc.getSenders().forEach(function(t){if(t.track&&t.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&t.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(e=!0,u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",r),t.track.muted)return t.track.onunmute||(t.track.onunmute=function(){t.track.applyConstraints(r).then(function(){var e=t.track.getConstraints();u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",e),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(r),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}),u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),i.reject("Video track is muted. Can't apply constraints to the video track");t.track.applyConstraints(r).then(function(){var e=t.track.getConstraints();u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",e),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}}.bind(this)),e||i.resolve()):this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){if(e.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",r),e.muted)return e.onunmute||(e.onunmute=function(){e.applyConstraints(r).then(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(r),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}),u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),i.reject("Video track is muted. Can't apply constraints to the video track");e.applyConstraints(r).then(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),i.resolve()}).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}}.bind(this))}.bind(this)):i.reject("Unsupported constraints")},e.prototype.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(e){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.add(e)},e.prototype.removeOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(e){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.remove(e)},e.prototype._createVideoConstraintsList=function(e,t,i,a){function r(e,t){var i={width:{exact:e.getWidth()},height:{exact:e.getHeight()}};return a&&(i.deviceId={exact:a}),t?i.frameRate={min:t}:u.Base.Utils.getBrowserType()===u.Base.BrowserType.SAFARI&&(i.width=e.getWidth(),i.height=e.getHeight()),i}var s=[],n=[],o=i||u.Config.CallUserConfiguration.minPreferredVideoFPS||u.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS;Object.keys(u.Base.VideoResolution).filter(function(e){e=u.Base.VideoResolution[e];e&&e.getHeight()<=t&&(s.push(r(e,o)),n.push(r(e)))});var c=s.concat(n);return u.Base.Utils.getBrowserType()!==u.Base.BrowserType.CHROME?(i={width:{ideal:e},height:{ideal:t}},a&&(i.deviceId={exact:a}),c.push(i)):(e={width:{max:e},height:{max:t}},a&&(e.deviceId={exact:a}),c.push(e)),c},e.prototype.addTransceiverIfNeeded=function(e){return!1},e.prototype.getIceConnectionState=function(){return this._pc?this._pc.iceConnectionState:T},e.prototype.parseIceRelayCandidate=function(e,t){return T},e.prototype.getLocalMediaCount=function(){var t=0;return this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(e){!e.track||e.track.kind!==u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.kind!==u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||e.track.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||t++}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.kind!==u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.kind!==u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||e.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||t++})}),t},e.prototype.addOnSelectedCandidatePairIdChanged=function(e){this._statsParser&&this._statsParser.addOnSelectedCandidatePairIdChanged(e)},e.prototype.removeOnSelectedCandidatePairIdChanged=function(e){this._statsParser&&this._statsParser.removeOnSelectedCandidatePairIdChanged(e)},e.prototype.setVideoSendBandwidth=function(i){var e,a=S.Deferred();return this.isRTCRtpSenderSupported()?0<(e=this._pc.getSenders().filter(function(e){return!!e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE}.bind(this))).length?e.forEach(function(e){var t=e.getParameters();t.encodings||(t.encodings=[]),t.encodings[0]||(t.encodings[0]={}),t.encodings[0].maxBitrate=1e3*i,u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send bandwidth - new parameters: ",t),e.setParameters(t).then(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send bandwidth set to at most "+i+"kbps"),a.resolve()}.bind(this),function(e){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send bandwidth failed - error: "+e.name),a.reject()}.bind(this))}.bind(this)):a.reject("No live video tracks"):a.reject("Old browser"),a.promise()},e.prototype.getVideoSendBandwidth=function(){var t;return this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(e){!e.track||e.track.kind!==u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK||e.track.readyState!==u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||(e=e.getParameters()).encodings&&e.encodings[0]&&u.Base.Utils.isDefined(e.encodings[0].maxBitrate)&&(t=e.encodings[0].maxBitrate)}.bind(this)),t},e.prototype.setVideoSendResolution=function(e,s){var n,o=!1;return this.isRTCRtpSenderSupported()?(this._pc.getSenders().forEach(function(t){var i,a,r;t.track&&t.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&t.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(o=!0,u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send resolution to at most "+e+"x"+s),n=t.track.muted?S.Deferred().reject("Set video send resolution failed: Video track is muted").promise():(i=t.track.getConstraints(),a=i.height,r=i.width,i.height={ideal:s,max:s},i.width={ideal:e,max:e},t.track.applyConstraints(i).then(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send resolution set to at most "+e+"x"+s,i)}.bind(this),function(e){i.height=a,i.width=r,u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send resolution failed : "+e.name+"  Recovering using old constraints.",i),t.track.applyConstraints(i).then(function(){u.Base.Logger.info(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully recovered using old constraints")},function(){u.Base.Logger.error(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to recover using old constraints.",i)})}.bind(this))))}.bind(this)),o||(n=S.Deferred().reject("No live video track found").promise())):n=S.Deferred().reject("Reducing video resolution isn't supported on this browser").promise(),n},e.prototype.stopLocalAudioTrack=function(){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(u.Base.Logger.debug(u.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping local audio track: "+e.track.id),e.track.stop())}.bind(this))},e.prototype.isLocalAudioTrackEnded=function(){return this.isLocalMediaTrackEnded(u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK)},e.prototype.isLocalVideoTrackEnded=function(){return this.isLocalMediaTrackEnded(u.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK)},e.prototype.isLocalMediaTrackEnded=function(t){var i=!0;return!!this.isRTCRtpSenderSupported()&&(this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===t&&e.track.readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(i=!1)}.bind(this)),i)},u.Base.AbstractRTCConnectionProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.Constants={ICE_GATHERING_STATE_COMPLETE:"complete",ICE_GATHERING_STATE_GATHERING:"gathering",ICE_CONNECTION_STATE_COMPLETED:"completed",ICE_CONNECTION_STATE_CONNECTED:"connected",ICE_CONNECTION_STATE_CHECKING:"checking",ICE_CONNECTION_STATE_FAILED:"failed",ICE_CONNECTION_STATE_DISCONNECTED:"disconnected",ICE_CONNECTION_STATE_NEW:"new",ICE_CONNECTION_STATE_CLOSED:"closed",RTC_PEER_CONNECTION_STATE_CLOSED:"closed",MEDIA_STREAM_TRACK_READY_STATE_LIVE:"live",MEDIA_STREAM_TRACK_READY_STATE_ENDED:"ended",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",RTC_STATS_TYPE:{INBOUND_RTP:"inbound-rtp",REMOTE_OUTBOUND_RTP:"remote-outbound-rtp",OUTBOUND_RTP:"outbound-rtp",REMOTE_INBOUND_RTP:"remote-inbound-rtp",TRACK:"track",CANDIDATE_PAIR:"candidate-pair",LOCAL_CANDIDATE:"local-candidate",REMOTE_CANDIDATE:"remote-candidate",MEDIA_SOURCE:"media-source",CODEC:"codec",TRANSPORT:"transport"},RTC_STATS_MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"}}}(),function(o){"use strict";function e(){this._inboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUND_RTP,this._outboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP,this._remoteInboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_INBOUND_RTP,this._remoteOutboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_OUTBOUND_RTP,this._trackType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRACK,this._candidatePairType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CANDIDATE_PAIR,this._localCandidateType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.LOCAL_CANDIDATE,this._remoteCandidateType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_CANDIDATE,this._mediaSourceType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.MEDIA_SOURCE,this._codec=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CODEC,this._transportType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRANSPORT,this._localCandidates={},this._remoteCandidates={},this._selectedCandidatePairId=T,this._audioTransportId=T,this._videoTransportId=T,this._selectedCandidatePairIdChangedCallbacks=S.Callbacks()}e.prototype.processOutboundGenericStats=function(e,t){o.Base.Utils.isDefined(e.timestamp)&&(t.timestamp=e.timestamp),o.Base.Utils.isDefined(e.packetsSent)&&(t.packetsTransmitted=e.packetsSent),o.Base.Utils.isDefined(e.bytesSent)&&(t.bytesTransmitted=e.bytesSent),o.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalTransmitted=e.packetsLost),o.Base.Utils.isDefined(e.roundTripTime)&&(t.roundTripTimeMilliseconds=e.roundTripTime)},e.prototype.processInboundGenericStats=function(e,t){o.Base.Utils.isDefined(e.timestamp)&&(t.timestamp=e.timestamp),o.Base.Utils.isDefined(e.packetsReceived)&&(t.packetsReceived=e.packetsReceived),o.Base.Utils.isDefined(e.bytesReceived)&&(t.bytesReceived=e.bytesReceived),o.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalReceived=e.packetsLost),o.Base.Utils.isDefined(e.jitter)&&(t.jitterMillisecondsReceived=1e3*e.jitter),o.Base.Utils.isDefined(e.fractionLost)&&(t.packetsLossFractionReceived=e.fractionLost)},e.prototype.processOutboundVideoStats=function(e,t){o.Base.Utils.isDefined(e.framesEncoded)&&(t.framesEncoded=e.framesEncoded),o.Base.Utils.isDefined(e.totalEncodeTime)&&(t.totalEncodeTime=e.totalEncodeTime),o.Base.Utils.isDefined(e.firCount)&&(t.firCountTransmitted=e.firCount),o.Base.Utils.isDefined(e.pliCount)&&(t.pliCountTransmitted=e.pliCount),o.Base.Utils.isDefined(e.nackCount)&&(t.nackCountTransmitted=e.nackCount)},e.prototype.processInboundVideoStats=function(e,t){o.Base.Utils.isDefined(e.framesDecoded)&&(t.framesDecoded=e.framesDecoded),o.Base.Utils.isDefined(e.totalDecodeTime)&&(t.totalDecodeTime=e.totalDecodeTime),o.Base.Utils.isDefined(e.firCount)&&(t.firCountReceived=e.firCount),o.Base.Utils.isDefined(e.pliCount)&&(t.pliCountReceived=e.pliCount),o.Base.Utils.isDefined(e.nackCount)&&(t.nackCountReceived=e.nackCount)},e.prototype.processInboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:o.Base.Utils.isDefined(e.transportId)&&(this._audioTransportId=e.transportId),this.processInboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:o.Base.Utils.isDefined(e.transportId)&&(this._videoTransportId=e.transportId),this.processInboundGenericStats(e,i),this.processInboundVideoStats(e,i)}},e.prototype.processRemoteOutboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processInboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processInboundGenericStats(e,i),this.processInboundVideoStats(e,i)}},e.prototype.processOutboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processOutboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processOutboundGenericStats(e,i),this.processOutboundVideoStats(e,i)}},e.prototype.processRemoteInboundStats=function(e,t,i,a){this.processOutboundStats(e,t,i,a)},e.prototype.processVideoTrackStats=function(e,t){o.Base.Utils.isDefined(e.remoteSource)&&(e.remoteSource?(o.Base.Utils.isDefined(e.framesPerSecond)&&(t.actualFrameRateReceived=e.framesPerSecond),o.Base.Utils.isDefined(e.frameHeight)&&(t.heightReceived=e.frameHeight),o.Base.Utils.isDefined(e.frameWidth)&&(t.widthReceived=e.frameWidth),o.Base.Utils.isDefined(e.framesReceived)&&(t.framesReceived=e.framesReceived)):(o.Base.Utils.isDefined(e.framesPerSecond)&&(t.actualFrameRateTransmitted=e.framesPerSecond),o.Base.Utils.isDefined(e.frameHeight)&&(t.heightTransmitted=e.frameHeight),o.Base.Utils.isDefined(e.frameWidth)&&(t.widthTransmitted=e.frameWidth),o.Base.Utils.isDefined(e.framesSent)&&(t.framesTransmitted=e.framesSent)))},e.prototype.processAudioTrackStats=function(e,t){o.Base.Utils.isDefined(e.remoteSource)&&(e.remoteSource?(o.Base.Utils.isDefined(e.totalAudioEnergy)&&(t.totalAudioEnergyReceived=e.totalAudioEnergy),o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelReceived=e.audioLevel)):o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelTransmitted=e.audioLevel))},e.prototype.processTrackStats=function(e,t,i){switch(e.kind){case o.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK:this.processVideoTrackStats(e,i);break;case o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK:this.processAudioTrackStats(e,t)}},e.prototype.processAudioMediaSourceStats=function(e,t){o.Base.Utils.isDefined(e.totalAudioEnergy)&&(t.totalAudioEnergyTransmitted=e.totalAudioEnergy),o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelTransmitted=e.audioLevel)},e.prototype.processMediaSourceStats=function(e,t,i){e.kind===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO&&this.processAudioMediaSourceStats(e,t)},e.prototype.processCodecGenericStats=function(e,t){o.Base.Utils.isDefined(e.mimeType)&&(t.codec=e.mimeType)},e.prototype.processCodecStats=function(e,t,i){this.getCodecMediaType(e)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO?this.processCodecGenericStats(e,t):this.processCodecGenericStats(e,i)},e.prototype.getMediaType=function(e){return e.mediaType},e.prototype.processRTCStats=function(e,t,i,a,r){switch(e.type){case this._inboundStatsType:this.processInboundStats(e,t,i,r);break;case this._outboundStatsType:this.processOutboundStats(e,t,i,r);break;case this._remoteInboundStatsType:this.processRemoteInboundStats(e,t,i,r);break;case this._remoteOutboundStatsType:this.processRemoteOutboundStats(e,t,i,r);break;case this._trackType:this.processTrackStats(e,t,i);break;case this._candidatePairType:this.processCandidatePairStats(e,t,i,a);break;case this._localCandidateType:this.processLocalCandidateStats(e);break;case this._remoteCandidateType:this.processRemoteCandidateStats(e);break;case this._mediaSourceType:this.processMediaSourceStats(e,t,i);break;case this._codec:this.processCodecStats(e,t,i);break;case this._transportType:this.processTransportStats(e,t)}},e.prototype.processVideoRTCStats=function(e,t,i){if(this.getMediaType(e,i)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO)switch(e.type){case this._inboundStatsType:this.processInboundGenericStats(e,t),this.processInboundVideoStats(e,t);break;case this._outboundStatsType:this.processOutboundGenericStats(e,t),this.processOutboundVideoStats(e,t)}},e.prototype.processVideoCandidatePairStats=function(e,t){o.Base.Utils.isDefined(e.currentRoundTripTime)&&(t.roundTripTimeMillis=1e3*e.currentRoundTripTime),o.Base.Utils.isDefined(e.availableOutgoingBitrate)&&(t.availableTransmitBitrate=e.availableOutgoingBitrate),o.Base.Utils.isDefined(e.availableIncomingBitrate)&&(t.availableReceiveBitrate=e.availableIncomingBitrate)},e.prototype.processCandidatePairStats=function(e,t,i,a){var r,s,n;"succeeded"===e.state&&(r=this._localCandidates[e.localCandidateId],s=this._remoteCandidates[e.remoteCandidateId],n=e.ID||e.id,r&&s&&(a[n]=new o.Base.CandidatePairStatistics(r,s)),this.getCandidatePairMediaType(e)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(e,i))},e.prototype.getCandidatePairMediaType=function(e){if(o.Base.Utils.isDefined(e.transportId))return-1!==e.transportId.search("audio")||this._audioTransportId===e.transportId?"audio":-1!==e.transportId.search("video")||this._videoTransportId===e.transportId?"video":void 0},e.prototype.getCodecMediaType=function(e){if(o.Base.Utils.isDefined(e.mimeType))return-1!==e.mimeType.search("audio")?"audio":-1!==e.mimeType.search("video")?"video":void 0},e.prototype.processLocalCandidateStats=function(e){var t=e.address||e.ip||"localhost",i=e.ID||e.id;this._localCandidates[i]=new o.Base.CandidateStatistics(t,e.port,e.protocol,e.candidateType)},e.prototype.processRemoteCandidateStats=function(e){var t=e.address||e.ip,i=e.ID||e.id;this._remoteCandidates[i]=new o.Base.CandidateStatistics(t,e.port,e.protocol,e.candidateType)},e.prototype.processTransportStats=function(e,t){var i=e.id||e.rtcpTransportStatsId;!i||-1===i.search("audio")&&i!==this._audioTransportId||(this._selectedCandidatePairId&&this._selectedCandidatePairId!==e.selectedCandidatePairId&&this._selectedCandidatePairIdChangedCallbacks.fire(e.selectedCandidatePairId),this._selectedCandidatePairId=e.selectedCandidatePairId,t.transportBytesReceived=e.bytesReceived)},e.prototype.calculateStats=function(e,t){o.Base.Utils.isDefined(e.packetsReceived)&&(o.Base.Utils.isUndefined(e.packetLossTotalReceived)?e.fractionLostLocal=T:0===e.packetsReceived?e.fractionLostLocal=0:e.fractionLostLocal=e.packetLossTotalReceived/(e.packetsReceived+e.packetLossTotalReceived)),this.calculateVideoStats(t)},e.prototype.calculateVideoStats=function(e){o.Base.Utils.isUndefined(e.packetsLossFractionTransmitted)&&(o.Base.Utils.isUndefined(e.packetsTransmitted)||o.Base.Utils.isUndefined(e.packetLossTotalTransmitted)?e.packetsLossFractionTransmitted=T:0===e.packetsTransmitted?e.packetsLossFractionTransmitted=0:e.packetsLossFractionTransmitted=e.packetLossTotalTransmitted/(e.packetsTransmitted+e.packetLossTotalTransmitted)),o.Base.Utils.isUndefined(e.packetsLossFractionReceived)&&(o.Base.Utils.isUndefined(e.packetsReceived)||o.Base.Utils.isUndefined(e.packetLossTotalReceived)?e.packetsLossFractionReceived=T:0===e.packetsReceived?e.packetsLossFractionReceived=0:e.packetsLossFractionReceived=e.packetLossTotalReceived/(e.packetsReceived+e.packetLossTotalReceived))},e.prototype.parse=function(t,i,a,r){i=i||new o.Base.AudioStatistics,a=a||new o.Base.VideoStatistics,r=r||{};return o.Base.Utils.forEach(t,function(e){this.processRTCStats(e,i,a,r,t)},this),this.calculateStats(i,a),{audioStatistics:i,videoStatistics:a,iceCandidateStatistics:r}},e.prototype.parseVideoStats=function(t,i){i=i||new o.Base.VideoStatistics;return o.Base.Utils.forEach(t,function(e){this.processVideoRTCStats(e,i,t)},this),this.calculateVideoStats(i),{videoStatistics:i}},e.prototype.addOnSelectedCandidatePairIdChanged=function(e){this._selectedCandidatePairIdChangedCallbacks.add(e)},e.prototype.removeOnSelectedCandidatePairIdChanged=function(e){this._selectedCandidatePairIdChangedCallbacks.remove(e)},o.Base.AbstractRTCStatsReportParser=e}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.AudioStatistics=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h){this.bytesTransmitted=t,this.bytesReceived=e,this.packetsTransmitted=a,this.packetsReceived=i,this.roundTripTimeMilliseconds=r,this.packetLossTotalTransmitted=s,this.packetLossTotalReceived=n,this.jitterMillisecondsReceived=o,this.totalAudioEnergyTransmitted=l,this.totalAudioEnergyReceived=c,this.audioLevelTransmitted=C,this.audioLevelReceived=d,this.codec=u,this.fractionLostLocal=h,this.transportBytesReceived=0}}(),function(a){"use strict";function e(e){this._previousAudioStatistics=T,this._previousVideoStatistics=T,this._call=e,this.isStarted=!1,this._interval=T,this._statisticsLog=T,this._config=a.Base.CallStatisticsLoggerConfig}e.prototype.start=function(){this.isStarted?a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger has already started"):(this._initialize(),this.isStarted=!0,this._logStatistics(),this._interval=setInterval(this._logStatistics.bind(this),this._config.INTERVAL_IN_MILLIS))},e.prototype._logStatistics=function(){var e,t;a.Base.Utils.isDefined(this._call)?(e=this._call.getAudioDetails(),t=this._call.getVideoDetails(),S.when(e,t).done(function(e,t){this._processStatistics(e,t),this._saveStatistics(e,t),this._logStats()}.bind(this)),S.when(e,t).fail(function(){this.stop(),a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"Statistics of call ("+this._call.getCallId()+") are unavailable, stopping CallStatisticLogger")}.bind(this))):(this.stop(),a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"Statistics cannot be processed because the call is not longer available, stopping CallStatisticLogger"))},e.prototype._processStatistics=function(t,i){var a;this._statisticsLog.forEach(function(e){e.mediaType===this._config.MEDIA_TYPE.AUDIO?a=t[e.key]:e.mediaType===this._config.MEDIA_TYPE.VIDEO&&(a=i[e.key]),this._processStatistic(e,a)},this)},e.prototype._processStatistic=function(e,t){a.Base.Utils.isDefined(t)?e.valueType===this._config.VALUE_TYPE.INSTANT?e.value=t:e.valueType===this._config.VALUE_TYPE.CALCULATED&&(this._statHasPreviousValue(e)?e.value=0===t?0:this._calculateStatValue(e,t):e.value=T):e.value=T},e.prototype._calculateStatValue=function(e,t){var i;return e.mediaType===this._config.MEDIA_TYPE.AUDIO?i=this._previousAudioStatistics[e.key]:e.mediaType===this._config.MEDIA_TYPE.VIDEO&&(i=this._previousVideoStatistics[e.key]),t-i},e.prototype._logStats=function(){var e=(new Date).getTime(),i='{"ID":"'+this._call.getCallId().slice(0,4)+'",';i+='"TS":"'+e+'",';this._statisticsLog.forEach(function(e,t){i+=e.getAlias()+":"+e.getValue();t=t===this._statisticsLog.length-1;i+=t?"}":","}.bind(this)),a.Base.Logger.debug(a.Base.LoggerTags.CALL_STATISTICS,i)},e.prototype.stop=function(){this.isStarted?(this.isStarted=!1,this._cleanStatistics(),clearInterval(this._interval)):a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger is already stopped")},e.prototype._saveStatistics=function(e,t){this._previousAudioStatistics=e,this._previousVideoStatistics=t},e.prototype._cleanStatistics=function(){this._previousAudioStatistics=T,this._previousVideoStatistics=T,this._statisticsLog.forEach(function(e){e.value=T})},e.prototype._statHasPreviousValue=function(e){return e.mediaType===this._config.MEDIA_TYPE.AUDIO?!!a.Base.Utils.isDefined(this._previousAudioStatistics)&&a.Base.Utils.isDefined(this._previousAudioStatistics[e.key]):e.mediaType===this._config.MEDIA_TYPE.VIDEO?!!a.Base.Utils.isDefined(this._previousVideoStatistics)&&a.Base.Utils.isDefined(this._previousVideoStatistics[e.key]):void 0},e.prototype._initialize=function(){a.Base.Utils.isDefined(this._statisticsLog)||(this._statisticsLog=[],Object.keys(this._config.CALCULATED_AUDIO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.CALCULATED_AUDIO_STATS[e],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_AUDIO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.INSTANT_AUDIO_STATS[e],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.INSTANT))},this),Object.keys(this._config.CALCULATED_VIDEO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.CALCULATED_VIDEO_STATS[e],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_VIDEO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.INSTANT_VIDEO_STATS[e],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.INSTANT))},this))},a.Base.CallStatisticsLogger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CallStatisticsLoggerConfig={INTERVAL_IN_MILLIS:1e4,MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"},VALUE_TYPE:{INSTANT:"instant",CALCULATED:"calculated"},CALCULATED_AUDIO_STATS:{packetsReceived:"AI_PR",bytesReceived:"AI_BR",packetLossTotalReceived:"AI_PL",totalAudioEnergyReceived:"AI_TE",packetsTransmitted:"AO_PT",bytesTransmitted:"AO_BT",totalAudioEnergyTransmitted:"AO_TE"},CALCULATED_VIDEO_STATS:{packetsReceived:"VI_PR",bytesReceived:"VI_BR",packetLossTotalReceived:"VI_PL",framesReceived:"VI_FR",firCountReceived:"VI_FC",pliCountReceived:"VI_PC",nackCountReceived:"VI_NC",packetsTransmitted:"VO_PT",bytesTransmitted:"VO_BT",framesTransmitted:"VO_FT",firCountTransmitted:"VO_FC",pliCountTransmitted:"VO_PC",nackCountTransmitted:"VO_NC"},INSTANT_AUDIO_STATS:{jitterMillisecondsReceived:"AI_JR",audioLevelReceived:"AI_LR",audioLevelTransmitted:"AO_LT",roundTripTimeMilliseconds:"AO_RT"},INSTANT_VIDEO_STATS:{jitterMillisecondsReceived:"VI_JR",widthReceived:"VI_WR",heightReceived:"VI_HR",availableReceiveBitrate:"VI_AB",widthTransmitted:"VO_WT",heightTransmitted:"VO_HT",availableTransmitBitrate:"VO_AB",roundTripTimeMillis:"VO_RT",totalEncodeTime:"VO_TE",totalDecodeTime:"VI_TD",framesEncoded:"VO_FE",framesDecoded:"VI_FD"}}}(),function(){"use strict";(AvayaClientServices||{}).Base.CandidatePairStatistics=function(e,t){this.local=e,this.remote=t}}(),function(e){"use strict";function t(e,t,i,a){this.address=e,this.port=t,this.protocol=i,this.type=a}t.prototype={toString:function(){return"[address: "+this.address+"; port: "+this.port+"; protocol: "+this.protocol+"; type: "+this.type+"]"}},e.Base.CandidateStatistics=t}(AvayaClientServices||{}),function(a){"use strict";function e(e,t,i){this._tlsOrTcpFound=!1,a.Base.RTCConnectionProvider.call(this,e,t,i),this._statsParser=new a.Base.EdgeRTCStatsReportParser}(e.prototype=Object.create(a.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(e){a.Base.RTCConnectionProvider.prototype.addStream.call(this,e)},e.prototype.removeStream=function(e){a.Base.RTCConnectionProvider.prototype.removeStream.call(this,e)},e.prototype.createPeerConnection=function(e){var t;e&&!S.isEmptyObject(e)?(e.bundlePolicy="max-compat",this._tlsOrTcpFound=!1,0<e.iceServers.length&&(Array.isArray(e.iceServers[0].urls)?(e.iceServers[0].urls.length>(t=e.iceServers[0].urls.filter(function(e){return e.includes("turn:")&&e.includes("?transport=udp")})).length&&(this._tlsOrTcpFound=!0),e.iceServers[0].urls=t):e.iceServers[0].urls.includes("stun:")&&(e.iceServers[0].urls=[])),a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,e)):a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,{bundlePolicy:"max-compat",iceTransportPolicy:"all",iceServers:[]}),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this)},e.prototype.onAddStreamInternal=function(e){a.Base.RTCConnectionProvider.prototype.onAddStreamInternal.call(this,e)},e.prototype._getDTMFSender=function(){return null},e.prototype.stopStream=function(e){a.Base.RTCConnectionProvider.prototype.stopStream.call(this,e)},e.prototype.stopAllStreams=function(){a.Base.RTCConnectionProvider.prototype.stopAllStreams.call(this)},e.prototype._enableDisableRemoteStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteStreams.call(this,e)},e.prototype._enableDisableLocalStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalStreams.call(this,e)},e.prototype._enableDisableLocalAudioStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalAudioStreams.call(this,e)},e.prototype._enableDisableLocalVideoStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalVideoStreams.call(this,e)},e.prototype._enableDisableRemoteVideoStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteVideoStreams.call(this,e)},e.prototype._enableDisableRemoteAudioStream=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteAudioStream.call(this,e)},e.prototype._throwSdpError=function(){this._tlsOrTcpFound?this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found. This browser doesn't support TCP or TLS TURN."}):this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TRANSPORT_ERROR,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},e.prototype._answerError=function(e,t){var i;0===this._iceCandidates.length&&this._tlsOrTcpFound?(i={errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"Error while setting answer as local description: this browser doesn't support TCP or TLS TURN."},a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+i),t(i)):(a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+e),t(e))},e.prototype.addTrack=function(e,t){a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id),a.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t),t.addTrack(e)},e.prototype.removeLocalAudioTrack=function(){this._pc.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(e){e.stop(),t.removeTrack(e)})})},e.prototype.isRTCRtpSenderSupported=function(){return a.Base.RTCConnectionProvider.prototype.isRTCRtpSenderSupported()},e.prototype.adjustVideoConstraints=function(e,t,i){return S.Deferred().reject("Video constraints is NOT support by Edge").promise()},a.Base.EdgeRTCConnectionProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.EdgeRTCConnectionProvider.Constants={RTC_STATS_TYPE:{INBOUNDRTP:"inboundrtp",OUTBOUNDRTP:"outboundrtp"}}}(),function(r){"use strict";function e(){r.Base.AbstractRTCStatsReportParser.call(this),this._inboundStatsType=r.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUNDRTP,this._outboundStatsType=r.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUNDRTP}(e.prototype=Object.create(r.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(e,t,i){0<e.frameHeight||-1!==e.trackIdentifier.search("video")?this.processVideoTrackStats(e,i):this.processAudioTrackStats(e,t)},e.prototype.processInboundGenericStats=function(e,t){r.Base.Utils.isDefined(e.packetsReceived)&&(t.packetsReceived=e.packetsReceived),r.Base.Utils.isDefined(e.bytesReceived)&&(t.bytesReceived=e.bytesReceived),r.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalReceived=e.packetsLost),r.Base.Utils.isDefined(e.jitter)&&(t.jitterMillisecondsReceived=1e3*e.jitter),r.Base.Utils.isDefined(e.fractionLost)&&(t.packetsLossFractionReceived=e.fractionLost),r.Base.Utils.isDefined(e.codecId)&&(t.codec=e.codecId)},e.prototype.processInboundStats=function(e,t,i,a){e.isRemote||(r.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,e,t,i,a),t.bytesReceived=T,i.bytesReceived=T)},e.prototype.processOutboundStats=function(e,t,i,a){e.isRemote||(r.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,e,t,i,a),t.bytesTransmitted=T,i.bytesTransmitted=T)},e.prototype.processAudioTrackStats=function(e,t){},e.prototype.getMediaType=function(e,t){return e.codecId?"H264"===e.codecId?r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:"H264"===t[e.associateStatsId].codecId?r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO},r.Base.EdgeRTCStatsReportParser=e}(AvayaClientServices),function(r){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) (udp|UDP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+/;function e(e,t,i){r.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this._statsParser=new r.Base.FirefoxRTCStatsReportParser}(e.prototype=Object.create(r.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(t){r.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this))},e.prototype.removeStream=function(e){this._pc&&this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this))},e.prototype.createPeerConnection=function(e){r.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),this._pc.ontrack=this.onTrackInternal.bind(this)},e.prototype._getDTMFSender=function(){return r.Base.Utils.isDefined(this._dtmfSender)||this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=e.dtmf)}.bind(this)),this._dtmfSender},e.prototype.stopAllStreams=function(){var t;this._pc&&(t=!1,this._pc.getSenders().forEach(function(e){e.track&&(e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.track.stop(),this._pc.removeTrack(e))}.bind(this)),t||this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.stop()})}),this._pc.getReceivers().forEach(function(e){e.track&&e.track.stop()}.bind(this)))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling remote ":"Disabling remote ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalAudioStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableLocalVideoStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?e.track.enabled===t&&!t||(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id+":"+e.track.readyState),e.track.enabled=t):r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(e.sender.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t):r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+e.sender.track.id+":"+e.sender.track.readyState))}.bind(this))},e.prototype.isSetLocalVideoDirectionSupported=function(){return!0},e.prototype.hasVideoTrackStopStreaming=function(t){return 0!==this._pc.getTransceivers().filter(function(e){return!!e.sender.track&&e.sender.track.id===t.id&&(e.stopped||e.sender.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED)}.bind(this)).length},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype._enableDisableRemoteAudioStream=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype.addTrack=function(e,t){r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id+":"+e.readyState),r.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===r.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&r.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.id===t.id&&(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+e.track.id),e.track.stop())}.bind(this))},e.prototype.enableRemoteVideoTrack=function(e,t){var i=0;this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(i++,e.track.id!==t.id&&e.track.readyState===r.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e.track.stop(),r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing remote video track  "+e.track.id+" with "+t.id)))}),0===i?(r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding remote video track  "+t.id),this.addTrack(t,e)):0===e.getVideoTracks().length&&e.addTrack(t)},e.prototype.isRTCRtpSenderSupported=function(){return!0},e.prototype.rollbackLocalOfferState=function(){"stable"!==this._pc.signalingState&&this._pc.setLocalDescription({type:"rollback"})},e.prototype.adjustVideoConstraints=function(e,t,i,a){return 360<=t&&t<=480&&(e=640,t=360),r.Base.AbstractRTCConnectionProvider.prototype.adjustVideoConstraints.call(this,e,t,i,a)},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?{foundation:e[1],component:e[2],networkId:T}:T},e.prototype.addTransceiverIfNeeded=function(e){if(e){var t=!1;if(this._pc.getTransceivers().forEach(function(e){e.receiver&&e.receiver.track&&e.receiver.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.sender&&e.sender.track&&e.sender.track.kind===r.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0)}),!t)return r.Base.Logger.debug(r.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+e),this._pc.addTransceiver("video",{direction:e}),!0}return!1},r.Base.FirefoxRTCConnectionProvider=e}(AvayaClientServices),function(r){"use strict";function e(){r.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(r.Base.AbstractRTCStatsReportParser.prototype)).processOutboundVideoStats=function(e,t){r.Base.AbstractRTCStatsReportParser.prototype.processOutboundVideoStats.call(this,e,t),r.Base.Utils.isDefined(e.bitrateMean)&&(t.actualBitRateTransmitted=e.bitrateMean),r.Base.Utils.isDefined(e.framerateMean)&&(t.actualFrameRateTransmitted=e.framerateMean),r.Base.Utils.isDefined(e.roundTripTime)&&(t.roundTripTimeMillis=1e3*e.roundTripTime)},e.prototype.processInboundVideoStats=function(e,t){r.Base.AbstractRTCStatsReportParser.prototype.processInboundVideoStats.call(this,e,t),r.Base.Utils.isDefined(e.bitrateMean)&&(t.actualBitRateReceived=e.bitrateMean),r.Base.Utils.isDefined(e.framerateMean)&&(t.actualFrameRateReceived=e.framerateMean)},e.prototype.processOutboundStats=function(e,t,i,a){!0!==e.isRemote&&r.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,e,t,i,a)},e.prototype.processInboundStats=function(e,t,i,a){!0===e.isRemote?this.processOutboundStats(e,t,i,a):r.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,e,t,i,a)},r.Base.FirefoxRTCStatsReportParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.ObservableRTCEvents={ICE_CONNECTION_STATE_CHANGED:"rtcProvider.iceConnectionStateChanged",LOCAL_AUDIO_TRACK_ENDED:"rtcProvider.localAudioTrackEnded"}}(),function(o){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .* network-id (\d+)/;function e(e,t,i){o.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this.isAvailable()&&(this._statsParser=new o.Base.RTCStatsReportParser,this._iceDisconnectedTimeoutId=T,this._iceConnectionStateFailed=!1)}(e.prototype=Object.create(o.Base.AbstractRTCConnectionProvider.prototype)).updatePeerConfiguration=function(e,t){o.Base.AbstractRTCConnectionProvider.prototype.updatePeerConfiguration.call(this,e,t)},e.prototype.addStream=function(t){o.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),this._isRTCRtpSenderSupported?t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this)):this._pc.addStream(t)},e.prototype.addTrack=function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id+":"+e.readyState),o.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&o.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.removeStream=function(e){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this)):this._pc.removeStream(e))},e.prototype.createPeerConnection=function(e){o.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this),this._isRTCRtpSenderSupported="function"==typeof this._pc.getSenders},e.prototype.onAddStreamInternal=function(e){var t=e.stream;t&&(t.onaddtrack=this.onAddTrackInternal.bind(this),t.onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddStream&&this.onAddStream(e.stream))},e.prototype._getDTMFSender=function(){return o.Base.Utils.isDefined(this._dtmfSender)||(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=e.dtmf)}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e=e.getAudioTracks()[0];o.Base.Utils.isDefined(e)&&(this._dtmfSender=this._pc.createDTMFSender(e))}.bind(this))),this._dtmfSender},e.prototype.stopAllStreams=function(){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&(e.track.stop(),this._pc.removeTrack(e))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.stop()}),e.getVideoTracks().forEach(function(e){e.stop()}),this._pc.removeStream(e)}.bind(this)),this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.stop()}),e.getVideoTracks().forEach(function(e){e.stop()})}))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.id),e.enabled=t)}),e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)}):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.id),e.enabled=t)}),e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalAudioStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalVideoStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(e.track.enabled=t,o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id+":"+e.track.readyState)):(e.track.enabled=t,o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState)))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableRemoteAudioStream=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.id),e.enabled=t)})})},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.id===t.id&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+e.track.id),e.track.stop(),"function"!=typeof e.replaceTrack&&this._pc.removeTrack(e))}.bind(this))},e.prototype.replaceLocalMediaTrack=function(i,a){var r=S.Deferred(),e=0,s=function(e){e&&this._pc.removeTrack(e),a?(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+i.kind+" track  "+i.id),this.addTrack(i,a),a.addTrack(i),this.monitorAudioTrack(i),r.resolve(!0)):(o.Base.Logger.warn(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+i.kind+" track  "+i.id+" due to missing media stream"),r.reject("Missing local media stream"))}.bind(this);return this._pc.getSenders().forEach(function(t){t.track&&t.track.kind===i.kind&&"function"==typeof t.replaceTrack&&(e++,o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+i.kind+" track  "+t.track.id+" with "+i.id),t.replaceTrack(i).then(function(){a&&(a.addTrack(i),this.monitorAudioTrack(i));r.resolve(!1)}.bind(this)).catch(function(e){o.Base.Logger.info(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+i.kind+" track instead due to "+e),t.track.stop(),s(t)}))}.bind(this)),0===e&&s(),r.promise()},e.prototype.getStats=function(){if(this.isRTCRtpSenderSupported()){var t=S.Deferred(),i=new o.Base.AudioStatistics,a=new o.Base.VideoStatistics,r={},s=[];return this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&s.push(e.getStats().then(function(e){this._statsParser.parse(e,i,a,r)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&s.push(e.getStats().then(function(e){this._statsParser.parse(e,i,a,r)}.bind(this)))}.bind(this)),S.when.apply(this,s).then(function(){t.resolve({audioStatistics:i,videoStatistics:a,iceCandidateStatistics:r})},function(e){o.Base.Logger.error(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),t.reject(e)}),t.promise()}if(0===RTCPeerConnection.prototype.getStats.length)return this._pc.getStats().then(function(e){return this._statsParser.parse(e)}.bind(this)).catch(function(e){return o.Base.Logger.error(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),Promise.reject(e)});var n=S.Deferred();return this._pc.getStats(function(e){e=this._statsParser.fallback(e);n.resolve(e)}),n.promise()},e.prototype.isRTCRtpSenderSupported=function(){return this._isRTCRtpSenderSupported},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?t?{foundation:t.foundation||e[1],component:t.component||e[2],networkId:e[3]}:{foundation:e[1],component:e[2],networkId:e[3]}:T},e.prototype.close=function(){o.Base.AbstractRTCConnectionProvider.prototype.close.call(this),clearTimeout(this._iceDisconnectedTimeoutId)},e.prototype._oniceConnectionStateChange=function(e){o.Base.AbstractRTCConnectionProvider.prototype._oniceConnectionStateChange.call(this,e),this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?(clearTimeout(this._iceDisconnectedTimeoutId),this._iceDisconnectedTimeoutId=setTimeout(function(){o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Forced iceConnectionState to failed ["+this._pc.iceGatheringState+"]"),this._iceConnectionStateFailed=!0,this.trigger(o.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED])}.bind(this),15e3)):this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED?clearTimeout(this._iceDisconnectedTimeoutId):this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED&&(clearTimeout(this._iceDisconnectedTimeoutId),this._iceConnectionStateFailed=!1)},e.prototype.getIceConnectionState=function(){return this._pc?!0===this._iceConnectionStateFailed&&this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED:this._pc.iceConnectionState:T},o.Base.RTCConnectionProvider=e}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={create:function(e,t,i){var a=r.Base.Utils.getBrowserType();return a===r.Base.BrowserType.CHROME?new r.Base.RTCConnectionProvider(e,t,i):a===r.Base.BrowserType.EDGE?new r.Base.EdgeRTCConnectionProvider(e,t,i):a===r.Base.BrowserType.SAFARI?new r.Base.SafariRTCConnectionProvider(e,t,i):a===r.Base.BrowserType.FIREFOX?new r.Base.FirefoxRTCConnectionProvider(e,t,i):T}},r.Base.RTCConnectionProviderFactory=e}(AvayaClientServices),function(c){"use strict";function e(){c.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(c.Base.AbstractRTCStatsReportParser.prototype)).fallback=function(e){var i,a,r,s,t,n,o;return e.result().forEach(function(e){var t=e.stat("mediaType");"ssrc"===e.type&&-1<e.id.indexOf("send")&&"audio"===t&&(i=e),"ssrc"===e.type&&-1<e.id.indexOf("send")&&"video"===t&&(r=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"audio"===t&&(a=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"video"===t&&(s=e)}),a&&i&&(t={bytesReceived:parseInt(a.stat("bytesReceived")),packetsReceived:parseInt(a.stat("packetsReceived")),packetsLost:parseInt(a.stat("packetsLost")),googJitterReceived:parseInt(a.stat("googJitterReceived"))},n={bytesSent:parseInt(i.stat("bytesSent")),packetsSent:parseInt(i.stat("packetsSent")),googRtt:parseInt(i.stat("googRtt")),packetsLost:parseInt(i.stat("packetsLost"))},""===i.stat("packetsLost")&&(n.packetsLost=0),""===i.stat("googRtt")&&(n.googRtt=0),n=new c.Base.AudioStatistics(t.bytesReceived,n.bytesSent,t.packetsReceived,n.packetsSent,n.googRtt,n.packetsLost,t.packetsLost,t.googJitterReceived)),s&&r&&(o={bytesReceived:parseInt(s.stat("bytesReceived")),actualBitRateReceived:T,packetsReceived:parseInt(s.stat("packetsReceived")),packetsLost:parseInt(s.stat("packetsLost")),googFrameRateReceived:parseInt(s.stat("googFrameRateReceived"))},c.Base.Utils.isUndefined(o.packetsLost)&&(o.packetsLost=0),c.Base.Utils.isUndefined(o.packetsReceived)&&(o.packetsReceived=0),0===o.packetsReceived?o.packetsLossFractionReceived=0:o.packetsLossFractionReceived=s.stat("packetsLost")/s.stat("packetsReceived"),t={bytesSent:parseInt(r.stat("bytesSent")),actualBitRateTransmitted:T,packetsSent:parseInt(r.stat("packetsSent")),packetsLost:parseInt(r.stat("packetsLost")),googFrameRateSent:parseInt(r.stat("googFrameRateSent"))},c.Base.Utils.isUndefined(t.packetsLost)&&(t.packetsLost=0),c.Base.Utils.isUndefined(t.packetsSent)&&(t.packetsSent=0),0===t.packetsSent?t.packetsLossFractionTransmitted=0:t.packetsLossFractionTransmitted=r.stat("packetsLost")/r.stat("packetsSent"),o=new c.Base.VideoStatistics(t.bytesSent,o.bytesReceived,t.actualBitRateTransmitted,o.actualBitRateReceived,t.packetsSent,o.packetsReceived,t.packetsLost,o.packetsLost,t.packetsLossFractionTransmitted,o.packetsLossFractionReceived,t.googFrameRateSent,o.googFrameRateReceived)),{audioStatistics:n,videoStatistics:o}},c.Base.RTCStatsReportParser=e}(AvayaClientServices),function(n){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .*/;function e(e,t,i){this._sdkStream=T,this._foundCandidates=!1,n.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this._statsParser=new n.Base.SafariRTCStatsReportParser}(e.prototype=Object.create(n.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(t){n.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this))},e.prototype.removeStream=function(e){this._pc&&this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this))},e.prototype.createPeerConnection=function(e){n.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),this._pc.ontrack=this.onTrackInternal.bind(this)},e.prototype._getDTMFSender=function(){return this._dtmfSender!==T&&this._pc.getSenders().forEach(function(e){e.track!==T&&e.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(this._dtmfSender=e.dtmf)}),this._dtmfSender},e.prototype.stopAllStreams=function(){this._pc&&(this._pc.getSenders().forEach(function(e){e.track&&(e.track.stop(),this._pc.removeTrack(e))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.stop()}.bind(this)))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling remote ":"Disabling remote ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalAudioStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableLocalVideoStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id),e.track.enabled=t):n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype.addTrack=function(e,t){n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id),n.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===n.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&n.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.replaceLocalVideoTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local video track "+e.track.id+" with "+t.id),e.track.stop(),e.replaceTrack(t))})},e.prototype.isRTCRtpSenderSupported=function(){return!0},e.prototype.addTransceiverIfNeeded=function(e){if(e){var t=!1;if(this._pc.getTransceivers().forEach(function(e){e.receiver&&e.receiver.track&&e.receiver.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.sender&&e.sender.track&&e.sender.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0)}),!t)return n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+e),this._pc.addTransceiver("video",{direction:e}),!0}return!1},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?{foundation:e[1],component:e[2],networkId:T}:T},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===n.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(e.sender.track.readyState===n.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t):n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+e.sender.track.id+":"+e.sender.track.readyState))}.bind(this))},e.prototype.isSetLocalVideoDirectionSupported=function(){return!0},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getTransceivers().forEach(function(e){e.sender.track&&e.sender.track.id===t.id&&e.sender.track.stop()})},e.prototype.replaceLocalMediaTrack=function(t,i){var a=S.Deferred(),r=0,s=function(){i?(n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+t.kind+" track  "+t.id),this.addTrack(t,i),i.addTrack(t),a.resolve()):(n.Base.Logger.warn(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+t.kind+" track  "+t.id+" due to missing media stream"),a.reject("Missing local media stream"))}.bind(this);return this._pc.getTransceivers().forEach(function(e){e.sender.track&&e.sender.track.kind===t.kind&&(r++,n.Base.Logger.debug(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+t.kind+" track  "+e.sender.track.id+" with "+t.id),e.sender.track.stop(),e.sender.replaceTrack(t).then(function(){i&&i.addTrack(t),e.direction===n.Services.Call.MediaDirection.INACTIVE&&(e.direction=n.Services.Call.MediaDirection.SEND_RECV),a.resolve()}).catch(function(e){n.Base.Logger.info(n.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+t.kind+" track instead due to "+e),s()}))}),0===r&&s(),a.promise()},n.Base.SafariRTCConnectionProvider=e}(AvayaClientServices),function(o){"use strict";function e(){o.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(o.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(e,t,i){e.frameHeight!==T?this.processVideoTrackStats(e,i):this.processAudioTrackStats(e,t)},e.prototype.processCandidatePairStats=function(e,t,i,a){var r,s,n;"succeeded"===e.state&&(r=this._localCandidates[e.localCandidateId],s=this._remoteCandidates[e.remoteCandidateId],n=e.ID||e.id,r&&s&&(a[n]=new o.Base.CandidatePairStatistics(r,s)),this.getCandidatePairMediaType(e,t,i)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(e,i))},e.prototype.getMediaType=function(e,t){return e.type===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP?e.mediaType:-1!==e.id.indexOf("Audio")?o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO},e.prototype.getCandidatePairMediaType=function(e,t,i){if(o.Base.Utils.isDefined(e.transportId))return this._audioTransportId===e.transportId?"audio":this._videoTransportId===e.transportId?"video":void 0},o.Base.SafariRTCStatsReportParser=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.key=e,this.value=T,this.valueType=a,this.mediaType=i,this.alias=t}t.prototype.getValue=function(){return e.Base.Utils.isDefined(this.value)?'"'+this.value+'"':'"undefined"'},t.prototype.getAlias=function(){return'"'+this.alias+'"'},e.Base.StatisticLog=t}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.VideoStatistics=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S,f,E,A,P,T,y,b,I,m,R,D,N,O,L){this.bytesTransmitted=e,this.bytesReceived=t,this.actualBitRateTransmitted=i,this.actualBitRateReceived=a,this.packetsTransmitted=r,this.packetsReceived=s,this.packetLossTotalTransmitted=n,this.packetLossTotalReceived=o,this.packetsLossFractionTransmitted=c,this.packetsLossFractionReceived=l,this.actualFrameRateTransmitted=d,this.actualFrameRateReceived=C,this.framesEncoded=u,this.framesDecoded=h,this.codec=_,this.roundTripTimeMillis=v,this.heightTransmitted=g,this.heightReceived=p,this.widthTransmitted=f,this.widthReceived=S,this.firCountTransmitted=A,this.firCountReceived=E,this.pliCountTransmitted=T,this.pliCountReceived=P,this.framesTransmitted=y,this.framesReceived=b,this.nackCountTransmitted=m,this.nackCountReceived=I,this.availableTransmitBitrate=R,this.availableReceiveBitrate=D,this.jitterMillisecondsReceived=N,this.totalEncodeTime=O,this.totalDecodeTime=L}}(),function(a){"use strict";function e(e){this._isStarted=!1,this._initialDelay=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,this._evaluationWindowDuration=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this._delayOverloadThreshold=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorOverloadThreshold")||200,this._delayWarningThreshold=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorWarningThreshold")||40,this._evaluateInterval=500,this._accumulatedMeasurements=0,this._measurements=[],this._minimumMeasurements=T,this._setInterval=T,this.onPerformanceMonitorAlert=function(){}}e.prototype.start=function(){this._isStarted||(a.Base.Logger.debug(a.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor starting in - "+this._initialDelay+"s"),setTimeout(function(){this._isStarted=!0,this._minimumMeasurements=this._evaluationWindowDuration/this._evaluateInterval*1e3,this._setInterval=setInterval(this._measureRuntimeDelay.bind(this),this._evaluateInterval)}.bind(this),1e3*this._initialDelay))},e.prototype._measureRuntimeDelay=function(){var t,i,e;this._isStarted&&document.hasFocus()&&(e=Date.now(),setTimeout(function(e){t=Date.now(),i=t-e,this._registerMeasure(i)}.bind(this,e),0))},e.prototype._registerMeasure=function(e){this._measurements.push(e),this._accumulatedMeasurements+=e,this._measurements.length>=this._minimumMeasurements&&this._evaluate(this._measurements)},e.prototype._evaluate=function(e){var t=this._accumulatedMeasurements/e.length,i=e[e.length-1];i>this._delayWarningThreshold&&(i="Latest JS Scheduling delay exceeded threshold - delay= "+Math.round(i)+"ms",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.CPU_USAGE_WARNING,i)),t>this._delayOverloadThreshold&&(t="Average JS Scheduling delay exceeds threshold - delay= "+Math.round(t)+"ms",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,t));e=e.shift();this._accumulatedMeasurements-=e},e.prototype.stop=function(){this._isStarted&&(this._isStarted=!1,this._measurements=[],clearInterval(this._setInterval),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor stopped"))},a.Base.RuntimePerformanceMonitor=e}(AvayaClientServices),function(a){"use strict";var s="m=audio",n="m=video",t="a=recvonly",i="a=sendonly",r="a=sendrecv",o="a=inactive",c="profile-level-id";a.Base.SDPUtil={updateAudioSdpInactive:function(e){return a.Base.SDPUtil.updateSdp(e,s,o)},updateAudioSdpRecvOnly:function(e){return a.Base.SDPUtil.updateSdp(e,s,t)},updateAudioSdpSendOnly:function(e){return a.Base.SDPUtil.updateSdp(e,s,i)},updateAudioSdpSendRecv:function(e){return a.Base.SDPUtil.updateSdp(e,s,r)},updateVideoSdpInactive:function(e){return a.Base.SDPUtil.updateSdp(e,n,o)},updateVideoSdpRecvOnly:function(e){return a.Base.SDPUtil.updateSdp(e,n,t)},updateVideoSdpSendOnly:function(e){return a.Base.SDPUtil.updateSdp(e,n,i)},updateVideoSdpSendRecv:function(e){return a.Base.SDPUtil.updateSdp(e,n,r)},updateSdp:function(e,t,i){if(-1===e.indexOf(t))return e;var a=e.indexOf(s),r=e.indexOf(n);return t===s?a<r?e.substring(0,a)+e.substring(a,r).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)+e.substring(r):e.substring(0,a)+e.substring(a).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i):r<a?e.substring(0,r)+e.substring(r,a).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)+e.substring(a):e.substring(0,r)+e.substring(r).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)},rejectMedia:function(e,t){return-1===e.indexOf(t)?e:t===s?e.replace(/(m=audio)\s+(\d+)\s+(.*)/,"m=audio 0 $3"):t===n?e.replace(/(m=video)\s+(\d+)\s+(.*)/,"m=video 0 $3"):e},updateProfileLevelId:function(e,t){var i=e.indexOf(c);return-1<i&&((i=e.substring(i+c.length+1,i+c.length+1+6))!==t&&(e=e.replace(i,t),a.Base.Logger.debug(a.Base.LoggerTags.UTILS,"CHANGED the profile-level-id value of the SDP from:",i,"to:",t))),e},getProfileLevelId:function(e){var t=e.indexOf(c);return-1<t?e.substring(t+c.length+1,t+c.length+1+6):T},hasH264:function(e){var t=e.indexOf(n);if(-1===t)return!1;var i=e.indexOf(s);return null!==(t<i?e.substring(t,i):e.substring(t)).match(/a=rtpmap:\d+ H264\/\d+/)}}}(AvayaClientServices),function(o){"use strict";function e(e,t,i){this._data="",this._currentLineIndex=0,this._getSettingsFileVariable="function"==typeof e?e:T,this._setSettingsFileVariable="function"==typeof t?t:T,this._onAdditionalSettingsFileRequested="function"==typeof i?i:T}e.prototype.parse=function(e){return"string"!=typeof e||0===e.length||(this._data=e,this._currentLineIndex=0,this.proceed())},e.prototype.proceed=function(){for(var e,t=this._splitByLines(this._data),i=t.length,a=!0;this._currentLineIndex<i;this._currentLineIndex++)if(0!==(r=t[this._currentLineIndex].trim()).length&&"#"!==r.charAt(0)){var r=this._getLineArr(r);if(r.length){var s=r[0].toUpperCase(),n=r.slice(1);switch(s){case"SET":this._processSET(n);break;case"GOTO":0<=(e=this._processGOTO(n))&&(this._currentLineIndex=e);break;case"IF":0<=(e=this._processIF(n))&&(this._currentLineIndex=e);break;case"GET":this._currentLineIndex++,a=this._processGET(n);break;default:o.Base.Logger.warn(o.Base.LoggerTags.SETTINGS_FILE_PARSER,"SettingsFileParser: Unknown command",s)}}if(!a)return!1}return!0},e.prototype._splitByLines=function(e){return e.split(/\r\n|\r|\n/g)},e.prototype._trimSharp=function(e){return e.trim().replace(/^#+|#+$/g,"").trim()},e.prototype._getLineArr=function(e){var a=e.match(/("([^"]*)"|([^"\s]+))+(?=(\s*|\s*$))/g)||[];return a.length&&a.forEach(function(e,t,i){a[t]=e.replace(/"/g,"")}),a},e.prototype._processSET=function(e){var t,i;!this._setSettingsFileVariable||(t=e.length)&&(i=e[0],e=1<t?e[1]:"",this._setSettingsFileVariable(i,e))},e.prototype._processGET=function(e){return!this._onAdditionalSettingsFileRequested||(!e.length||(this._onAdditionalSettingsFileRequested(e[0]),!1))},e.prototype._processGOTO=function(e){var t=-1;if(e.length)for(var i,a=e[0],r=this._splitByLines(this._data),s=r.length,n=0;n<s;n++)if(i=r[n].trim(),"#"===i.charAt(0)&&"#"!==i.charAt(1)&&a===this._trimSharp(i)){t=n;break}return t},e.prototype._processIF=function(e){if(!this._getSettingsFileVariable)return-1;if(e.length<5)return-1;var t=e[0],i=e[1],a=e[2],r=e[3],e=e[4];if(t.toString().length<=1||"$"!==t.charAt(0))return-1;if("SEQ"!==i.toUpperCase())return-1;if(0===a.toString().length)return-1;if("GOTO"!==r.toUpperCase())return-1;t=t.substr(1).toUpperCase();return this._getSettingsFileVariable(t)===a?this._processGOTO([e]):-1},o.Base.SettingsFileParser=e}(AvayaClientServices),function(i){"use strict";function e(){this._handlers={},this.currentState=null}i.Base.SimpleFsm=function(){},e.prototype={handleEvent:function(e){var t;e.stringValue?this.currentState&&this._handlers?this._handlers[this.currentState.stringValue]&&this._handlers[this.currentState.stringValue][e.stringValue]?(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Executing handler for state "+this.currentState.stringValue+" and event "+e.stringValue+" "+this._handlers[this.currentState.stringValue][e.stringValue].name),t=this._handlers[this.currentState.stringValue][e.stringValue](e),i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Executed handler "+this._handlers[this.currentState.stringValue][e.stringValue].name),t&&t.nextState&&(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Next state: "+t.nextState.stringValue),this.currentState=t.nextState),t&&t.nextEvent&&(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Next event: "+t.nextEvent.stringValue),this.handleEvent(t.nextEvent))):i.Base.Logger.error(i.Base.LoggerTags.FSM,"No handler bound for state "+this.currentState.stringValue+" and event "+e.stringValue):i.Base.Logger.error(i.Base.LoggerTags.FSM,"State machine's state was not initialized"):i.Base.Logger.error(i.Base.LoggerTags.FSM,"Unknown event: "+e)},registerHandler:function(e,t,i){if(this._handlers[e.stringValue]||(this._handlers[e.stringValue]={}),this._handlers[e.stringValue][t.stringValue])throw"Duplicate FSM registration state "+e.stringValue+" event "+t.stringValue;this._handlers[e.stringValue][t.stringValue]=i},registerNoOpHandler:function(e,t){this.registerHandler(e,t,function(){})},start:function(e){this.currentState=e}},i.Base.SimpleFsm.SimpleFsm=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.stringValue=e,this.data=t}t.prototype={},e.Base.SimpleFsm.SimpleFsmEvent=t}(AvayaClientServices),function(e){"use strict";function t(e){this.stringValue=e}t.prototype={},e.Base.SimpleFsm.SimpleFsmState=t}(AvayaClientServices),function(e){"use strict";var r="AVAYA_JSCSDK_1.0";e.Base.Storage={TYPES:{LOCAL:function(){try{return window.localStorage}catch(e){return}}(),SESSION:function(){try{return window.sessionStorage}catch(e){return}}()},KEYS:{VIDEO_RESOLUTIONS:"videoResolutions"},get:function(e,t){return e?(e[r]||this._initNamespace(e),JSON.parse(e[r])[t]):T},set:function(e,t,i){if(!e)return!1;e[r]||this._initNamespace(e);var a=JSON.parse(e[r]);return a[t]=i,e[r]=JSON.stringify(a),!0},remove:function(e,t){if(!e||!e[r])return!1;var i=JSON.parse(e[r]);return delete i[t],e[r]=JSON.stringify(i),!0},_initNamespace:function(e){return e[r]=JSON.stringify({}),!0}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){Error.call(this,e),this.message=e,this.validatedObject=t,this.violatedRule=i,this.name="ValidationError"}t.prototype=Object.create(Error.prototype),e.Base.ValidationError=t}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={validate:function(){throw new Error("Function is not implemented!")},_processCondition:function(e,t,i,a){if(e)return!0;e=i.message||this.defaultMessage;return this._handleValidationError(e,t,i,a)},_handleValidationError:function(e,t,i,a){if(a)return!1;throw new r.Base.ValidationError(e,t,i)}},r.Base.Validators.BaseValidator=e}(AvayaClientServices),function(e){"use strict";function t(){this.defaultMessage="Provided element is not defined."}(t.prototype=Object.create(e.Base.Validators.BaseValidator.prototype)).validate=function(e,t,i){var a=void 0!==e;return this._processCondition(a,e,t,i)},e.Base.Validators.DefinedValidator=t}(AvayaClientServices),function(e){"use strict";function t(){this.defaultMessage="Provided element is not compatible with required type."}(t.prototype=Object.create(e.Base.Validators.BaseValidator.prototype)).validate=function(e,t,i){var a=typeof e===t.expected||"object"==typeof e&&e instanceof t.expected;return this._processCondition(a,e,t,i)},e.Base.Validators.TypeValidator=t}(AvayaClientServices),function(a){"use strict";function e(e,t,i,a,r){this._width=e,this._height=t,this._fps=r||30,this._minBandwidth=i,this._maxBandwidth=a}(e.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getFPS:function(){return this._fps},getMinBandwidth:function(){return this._minBandwidth},getMaxBandwidth:function(){return this._maxBandwidth},toString:function(){return this._width+"x"+this._height+" (bandwidth: min. "+this._minBandwidth+"kbps, max. "+this._maxBandwidth+"kbps)"}}).convertToConfigVideoResolution=function(e){var t,i;for(i in a.Base.VideoResolution)a.Base.VideoResolution.hasOwnProperty(i)&&a.Base.VideoResolution[i].getHeight()===e.getHeight()&&(t=i);return t},a.Base.VideoResolutionDetails=e}(AvayaClientServices),function(e){"use strict";function t(){this._onInvalidCredentialsProvidedCallbacks=S.Callbacks()}t.prototype={onAuthenticationChallenge:function(e,t){},addOnInvalidCredentialsCallback:function(e){this._onInvalidCredentialsProvidedCallbacks.add(e)},removeOnInvalidCredentialsCallback:function(e){this._onInvalidCredentialsProvidedCallbacks.remove(e)}},e.Config.AbstractCredentialProvider=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.credentialProvider=new e.Config.AbstractCredentialProvider,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration}t.prototype={},e.Config.ACSConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.pollingIntervalInMinutes=0,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.AMMConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.AnalyticsConfiguration=function(){this.enabled=!1}}(),function(){"use strict";var e={basic:function(e,t){return"Basic "+btoa(e+":"+t)},bearer:t};function t(e,t){return e+" "+t}AvayaClientServices.Config.Authentication.Header=e}(),function(){"use strict";AvayaClientServices.Config.Authentication.Scheme={BASIC:"Basic",BEARER:"Bearer"}}(),function(){"use strict";AvayaClientServices.Config.Authentication.TokenType={BEARER:"Bearer",UPTOKEN:"UPToken",ESGTOKEN:"ESGToken"}}(),function(e){"use strict";var t={INCOMING_VIDEO_REQUEST_TIMEOUT:15e3,VIDEO_MAX_BANDWIDTH_ANY_NETWORK:1024,TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT:5e3,ICE_CANDIDATES_GATHERING_TIMEOUT:12e3,ICE_CONNECTION_RETRY_INTERVAL:5e3,MIN_PREFERRED_VIDEO_FPS:15};e.Config.CallUserConfiguration=function(){this.incomingCall=!1,this.videoEnabled=!1,this.startRingingOnIncomingCall=!0,this.incomingVideoRequestTimeout=t.INCOMING_VIDEO_REQUEST_TIMEOUT,this.videoMaxBandwidthAnyNetwork=t.VIDEO_MAX_BANDWIDTH_ANY_NETWORK,this.iceCandidatesGatheringTimeout=t.ICE_CANDIDATES_GATHERING_TIMEOUT,this.turnRelayCandidatesGatheringTimeout=t.TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT,this.iceConnectionRestartInterval=t.ICE_CONNECTION_RETRY_INTERVAL,this.minPreferredVideoFPS=t.MIN_PREFERRED_VIDEO_FPS},e.Config.CallUserConfiguration.DefaultValues=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.CollaborationConfiguration=function(){this.contentSharingWorkerPath=T,this.imageQuality=1}}(),function(a){"use strict";function e(e,t,i){a.Config.AbstractCredentialProvider.call(this),this.username=e,this.password=t,this.domain=i,this.displayName="",this.isGuest=!1}(e.prototype=Object.create(a.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t({username:this.username,password:this.password,domain:this.domain,isGuest:this.isGuest,displayName:this.displayName})},a.Config.CredentialProvider=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Config.AbstractCredentialProvider.call(this),this.token=e,this.bearer="string"==typeof t?t.trim():T}(e.prototype=Object.create(i.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t({bearer:this.bearer,token:this.token})},i.Config.CredentialTokenProvider=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Config.CredentialProvider.call(this),this.username=this._createGuestUser(),this.password="",this.domain="",this.displayName=e,this.isGuest=!0}(e.prototype=Object.create(t.Config.CredentialProvider.prototype)).getDisplayName=function(){return this.displayName},e.prototype.setDisplayName=function(e){this.displayName=e},e.prototype._generateUUID=function(){var i=window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=i.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"===e?t:3&t|8).toString(16)})},e.prototype._createGuestUser=function(){return"csaGuest/jsg-"+this._generateUUID()},t.Config.GuestCredentialProvider=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._failureCount=e,this._retryCallback=t,this._cancelCallback=i}t.prototype={getFailureCount:function(){return this._failureCount},retry:function(e){this._retryCallback(e)},cancel:function(){this._cancelCallback()}},e.Config.InvalidCredentialsEvent=t}(AvayaClientServices),function(e){"use strict";function t(){this.voipConfigurationAudio=new e.Config.VoIPConfigurationAudio,this.voipConfigurationVideo=new e.Config.VoIPConfigurationVideo,this.mediaEngineEnabled=!0,this.retrieveDeviceLabelsEnabled=!0,this.selfieSegmentationFileLocation=T}t.prototype={},e.Config.MediaConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.MediaServiceConfiguration=function(){this.sessionId=T,this.accessToken=T,this.userAgentURL=T}}(),function(e){"use strict";function t(e,t,i,a){this.webSocketConfig=t,this.sseConfig=i,this.restConfig=e,this.maxConnectionErrorCount=a||5}t.prototype={},e.Config.NetworkProviderConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this.frametimeThreshold=e,this.overloadsThreshold=t,this.evaluateInterval=i}t.prototype={},e.Config.PerformanceManagerConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.PresenceConfiguration=function(){this.enabled=!1}}(),function(){"use strict";AvayaClientServices.Config.SecurityPolicy={BEST_EFFORT:"BEST_EFFORT",DISABLED:"DISABLED",REQUIRED:"REQUIRED"}}(),function(e){"use strict";function t(e,t,i,a,r,s){this.hostName=e||"",this.port=t,this.isSecure=!!i,this.path=a||"",this.credentials=r||"",this.query=s||""}t.prototype={getUrl:function(e){e=e?"ws":"http";return this.isSecure&&(e+="s"),e+="://",this.credentials&&(e+=this.credentials+"@"),e+=this.hostName,this.port&&(e+=":"+this.port),e+=this.path,e+=this.query}},e.Config.ServerInfo=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider,this.maxCallStartReconnectionAttempts=-1,this._disableWebRTCForTheseBrowsers=[]}t.prototype={},e.Config.SGConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.UCCPConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.applicationBuildNumber="",this.applicationProductName="",this.applicationProductVersion="",this.ammConfiguration=new e.Config.AMMConfiguration,this.acsConfiguration=new e.Config.ACSConfiguration,this.uccpConfiguration=new e.Config.UCCPConfiguration,this.sgConfiguration=new e.Config.SGConfiguration,this.callUserConfiguration=new e.Config.CallUserConfiguration,this.presenceConfiguration=new e.Config.PresenceConfiguration,this.wcsConfiguration=new e.Config.WCSConfiguration,this.mediaConfiguration=new e.Config.MediaConfiguration,this.collaborationConfiguration=new e.Config.CollaborationConfiguration,this.analyticsConfiguration=new e.Config.AnalyticsConfiguration,this.mediaServiceContext="",this._mediaServiceConfiguration=null}t.prototype={},e.Config.UserConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.VideoResolution={RESOLUTION_1080p:"resolution1080p",RESOLUTION_720p:"resolution720p",RESOLUTION_480p:"resolution480p",RESOLUTION_360p:"resolution360p",RESOLUTION_240p:"resolution240p",RESOLUTION_180p:"resolution180p"}}(),function(e){"use strict";function t(){this.bgnMode=!1,this.codecList=[],this.echoMode=!1,this.mediaMode=!1,this.mobileEchoMode=!1,this.noiseSupMode=!1,this.opusMode=!1,this.receiveGainMode=!1,this.receiveSupMode=!1,this.transmitGainMode=!1,this.vadMode=!1}t.prototype={},e.Config.VoIPConfigurationAudio=t}(AvayaClientServices),function(e){"use strict";function t(){this.anyNetworkBandwidthMode=!1,this.congestionControlAlgorithm=!1,this.videoResolution=e.Config.VideoResolution.RESOLUTION_720p,this.presentationHigherPriorityThanPeopleVideo=!1,this.maxAvgVideoEncodingTime=35,this.maxAvgVideoDecodingTime=40,this.maxWarningVideoEncodingTime=13,this.maxWarningVideoDecodingTime=13,this.performanceMonitorGracePeriod=5,this.performanceMonitorWindowDuration=10,this.performanceAdjustmentsReleaseWindowDuration=60,this.minVideoResolutionReductionInterval=10,this.minVideoResolutionIncrementInterval=60,this.runtimePerformanceMonitorOverloadThreshold=200,this.runtimePerformanceMonitorWarningThreshold=40,this.konvaSharingGracePeriod=15,this.konvaSharingMeasurementsInterval=.5,this.konvaSharingMeasurementsWindowDuration=10,this.konvaSharingFramesAverageLimit=2.5,this.konvaSharingFramesWarningLimit=1}t.prototype={},e.Config.VoIPConfigurationVideo=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.WCSConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.WCSCredentials=function(e,t,i,a,r){this.token=e,this.username=t,this.participantId=i,this.sessionId=a,this.mode=r}}(),function(s){"use strict";function e(e,t,i,a,r){s.Config.AbstractCredentialProvider.call(this),this.token=e,this.username=t,this.attendeeId=i,this.sessionId=a,this.mode=r}(e.prototype=Object.create(s.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t(new s.Config.WCSCredentials(this.token,this.username,this.attendeeId,this.sessionId,this.mode))},s.Config.WCSCredentialTokenProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSConstants={SVC_GET_CONTACTS:"getContacts",SVC_SEARCH_CONTACTS:"searchContacts",TERMINAL_TYPE:"TERMINAL",PROVENANCE_TYPE_AVAYA:"Avaya",PROVENANCE_SUBTYPE_ADMINISTERED:"Administered"}}(),function(i){"use strict";function e(){this._quickSerachCache=new i.Base.SimpleIMDB(["searchString","searchScope"],{maxElements:250,timeToLive:1728e5,auditInterval:5e3})}e.prototype.addQuickSearchResultsToCache=function(e){for(var t,i=[],a=this._quickSerachCache.getCacheMaxSize(),r=this._trimToCacheMaxSize(e,a),s=0;s<r.length;s++)t={keys:{searchString:[r[s].searchString],searchScope:[r[s].searchScope]},element:r[s]},i.push(t);this._quickSerachCache.addElements(i)},e.prototype.getQuickSearchResultsFromCache=function(e,t){t={searchString:[e],searchScope:[t]};return this._quickSerachCache.searchByKeys(t,i.Base.IMDBSearchOptions.EXACT_MATCH)},e.prototype._trimToCacheMaxSize=function(e,t){e=t&&e.length>t?e.slice(-t):e.slice();return e},i.Providers.ACS.ACSContactsCache=e}(AvayaClientServices),function(y){"use strict";function e(){}e.prototype={convertACSContactArraytoContactArray:function(e){var t=[];if(e&&0<e.length)for(var i=0;i<e.length;i++)t.push(this.convertACSContactV1toContact(e[i]));return t},convertACSContactV1toContact:function(e){var r=y.Base.Utils,t=new y.Services.Contacts.Contact;if(r.isDefined(e)){r.isDefined(e.id)&&r.isDefined(e.id.value)&&(t.id=e.id),r.isDefined(e.contactUrl)&&r.isDefined(e.contactUrl.value)?t._uniqueAddressForMatching=e.contactUrl.value:r.isDefined(e.loginID)&&e.loginID?t._uniqueAddressForMatching=e.loginID:r.isDefined(e.terminalId)&&e.terminalId&&(t._uniqueAddressForMatching=e.terminalId);var i,s=new y.Base.Capability(y.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),n=new y.Base.Capability(y.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),a=function(e,t,i){var a;r.isDefined(e)&&e&&(r.isDefined(e.value)?("string"===i?a=e.value:"boolean"===i?a="true"===e.value:"float"===i&&(a=parseFloat(e.value)),t()._value=a,a=r.isDefined(e)&&r.isDefined(e.editable)&&!e.editable,t()._setWriteCapability(a?s:n)):"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e={value:a=e,editable:!1,provenance:[]},t()._value=a,t()._setWriteCapability(s)))};if(a(e.surName||e.lastName,t.getLastName.bind(t),"string"),a(e.givenName||e.firstName||e.name,t.getFirstName.bind(t),"string"),a(e.displayName||e.name,t.getDisplayName.bind(t),"string"),a(e.asciiSurName,t.getASCIILastName.bind(t),"string"),a(e.asciiGivenName,t.getASCIIFirstName.bind(t),"string"),a(e.asciiDisplayName,t.getASCIIDisplayName.bind(t),"string"),a(e.alias,t.getAlias.bind(t),"string"),a(e.location,t.getLocation.bind(t),"string"),a(e.workRoomNo,t.getWorkRoomNumber.bind(t),"string"),a(e.streetAddress,t.getStreetAddress.bind(t),"string"),a(e.city,t.getCity.bind(t),"string"),a(e.state,t.getState.bind(t),"string"),a(e.country,t.getCountry.bind(t),"string"),a(e.postalCode,t.getPostalCode.bind(t),"string"),a(e.company,t.getCompany.bind(t),"string"),a(e.manager,t.getManager.bind(t),"string"),a(e.department,t.getDepartment.bind(t),"string"),a(e.preferredLanguage,t.getLanguage.bind(t),"string"),a(e.notes,t.getNotes.bind(t),"string"),a(e.scopiaUserId||e.userId,t.getScopiaUserId.bind(t),"string"),a(e.scopiaLoginId||e.loginID,t.getScopiaLoginId.bind(t),"string"),a(e.rank,t.getRank.bind(t),"float"),a(e.isBuddy,t.isBuddy.bind(t),"boolean"),a(e.favourite,t.isFavorite.bind(t),"boolean"),a(e.videoCapable,t.isVideoCapable.bind(t),"boolean"),r.isDefined(e.pictureUrl)&&e.pictureUrl)if("string"==typeof e.pictureUrl?i=e.pictureUrl:r.isDefined(e.pictureUrl.value)&&""!==e.pictureUrl.value&&(i=e.pictureUrl.value),i)for(var o in y.Services.Contacts.ContactPictureSize)y.Services.Contacts.ContactPictureSize.hasOwnProperty(o)&&t.addPictureUrl(o,i+"?size="+y.Services.Contacts.ContactPictureSize[o].toLowerCase());if(r.isDefined(e.emailAddresses))for(var c=e.emailAddresses.length,l=0;l<c;l++){var d=new y.Services.Contacts.ContactEmailAddressField;r.isDefined(e.emailAddresses[l].value)&&(d._address=e.emailAddresses[l].value),r.isDefined(e.emailAddresses[l].type)&&(d._emailAddressType=this._convertACSEmailAddressTypeToContactEmailAddressType(e.emailAddresses[l].type)),e.emailAddresses[l].editable?d._setWriteCapability(n):d._setWriteCapability(s),t.getEmailAddresses().getValues().push(d)}if(r.isDefined(e.email)&&e.email&&((v=new y.Services.Contacts.ContactEmailAddressField)._address=e.email,v._setWriteCapability(s),t.getEmailAddresses().getValues().push(v)),r.isDefined(e.phoneNumberList)){var C=e.phoneNumberList.length;for(l=0;l<C;l++){var u=new y.Services.Contacts.ContactPhoneField;r.isDefined(e.phoneNumberList[l].phoneNumber)&&(u._phoneNumber=e.phoneNumberList[l].phoneNumber),r.isDefined(e.phoneNumberList[l].label1)&&(u._label1=e.phoneNumberList[l].label1),r.isDefined(e.phoneNumberList[l].label2)&&(u._label2=e.phoneNumberList[l].label2),r.isDefined(e.phoneNumberList[l].type)&&(u._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(e.phoneNumberList[l].type)),r.isDefined(e.phoneNumberList[l].speedDialEnabled)&&(u._speedDialEnabled="true"===e.phoneNumberList[l].speedDialEnabled),r.isDefined(e.phoneNumberList[l].isPrimary)&&(u._default="true"===e.phoneNumberList[l].isPrimary),e.phoneNumberList[l].editable?u._setWriteCapability(n):u._setWriteCapability(s);var h=e.phoneNumberList[l].provenance;if(h)for(var _=0;_<h.length;_++)h[_].type===y.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&h[_].subType===y.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&u.setAvayaAdministered(!0);t.getPhoneNumbers().getValues().push(u)}}var v,p,g,S=[];for(e.telephoneMobile&&S.push(e.telephoneMobile),e.telephoneOffice&&S.push(e.telephoneOffice),l=0;l<S.length;l++){var f=new y.Services.Contacts.ContactPhoneField;f._phoneNumber=S[l],f._setWriteCapability(s),t.getPhoneNumbers().getValues().push(f)}if(r.isDefined(e.type)&&e.type===y.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(v=!1,(p=new y.Services.Contacts.ContactPhoneField)._setWriteCapability(s),e.protocol&&(p._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(e.protocol),v=!0),e.description&&(p._label1=e.description,v=!0),e.number&&(p._phoneNumber=e.number,v=!0),v&&t.getPhoneNumbers().getValues().push(p)),r.isDefined(e.imaddresses)){var E=e.imaddresses.length;for(l=0;l<E;l++){var A=new y.Services.Contacts.ContactIMAddressField;r.isDefined(e.imaddresses[l].value)&&(A._address=e.imaddresses[l].value),r.isDefined(e.imaddresses[l].type)&&(A._imAddressType=this._convertACSHandleTypeToContactHandleType(e.imaddresses[l].type)),e.imaddresses[l].editable?A._setWriteCapability(n):A._setWriteCapability(s);var P=e.imaddresses[l].provenance;if(P)for(var T=0;T<P.length;T++)P[T].type===y.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&P[T].subType===y.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&A.setAvayaAdministered(!0);t.getIMAddresses().getValues().push(A)}}r.isDefined(e.custom1)&&r.isDefined(e.custom1.value)&&((p=new y.Services.Contacts.ContactStringField)._value=e.custom1.value,p._setWriteCapability(s),t.getCustom1().getValues().push(p)),t.getCustom1()._setWriteCapability(s),r.isDefined(e.custom2)&&r.isDefined(e.custom2.value)&&((g=new y.Services.Contacts.ContactStringField)._value=e.custom2.value,g._setWriteCapability(s),t.getCustom2().getValues().push(g)),t.getCustom2()._setWriteCapability(s),r.isDefined(e.custom3)&&r.isDefined(e.custom3.value)&&((g=new y.Services.Contacts.ContactStringField)._value=e.custom3.value,g._setWriteCapability(s),t.getCustom3().getValues().push(g)),t.getCustom3()._setWriteCapability(s),r.isDefined(e.type)&&e.type===y.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(e.contactIdentifier?t.getTerminal()._terminalId=e.contactIdentifier.value:t.getTerminal()._terminalId=e.terminalId,e.givenName?t.getTerminal()._terminalName=e.givenName.value:t.getTerminal()._terminalName=e.name)}return t},convertQuickSearchResults:function(e,t,i){for(var a=[],r=0;r<e.length;r++){var s=t[e[r].correlationId],n=this.convertACSContactArraytoContactArray(e[r].contacts),n=new y.Services.Contacts.ResolveContactResult(s,i,n);a.push(n)}return a},convertContactToACSContactV1:function(e){return this.mergeContactWithACSContactV1(e,new y.Providers.ACS.ContactV1)},mergeContactWithACSContactV1:function(e,t){if(e&&t){var i=new y.Providers.ACS.ContactV1;e._getUniqueAddressWithoutChanges()&&(i.contactUrl.value=e._getUniqueAddressWithoutChanges()),i.id.value=t.id.value,y.Base.Utils.isDefined(e._terminal)&&""!==e.getTerminal().getTerminalId()?i.contactIdentifier.value=e.getTerminal().getTerminalId():i.contactIdentifier.value=t.contactIdentifier.value,i.pictureUrl.value=t.pictureUrl.value,i.asciiSurName.value=e.getASCIILastName().getValue(),i.asciiGivenName.value=e.getASCIIFirstName().getValue(),i.asciiDisplayName.value=e.getASCIIDisplayName().getValue(),i.surName.value=e.getLastName().getValue(),i.givenName.value=e.getFirstName().getValue(),i.displayName.value=e.getDisplayName().getValue(),i.alias.value=e.getAlias().getValue(),i.location.value=e.getLocation().getValue(),i.workRoomNo.value=e.getWorkRoomNumber().getValue(),i.streetAddress.value=e.getStreetAddress().getValue(),i.city.value=e.getCity().getValue(),i.state.value=e.getState().getValue(),i.country.value=e.getCountry().getValue(),i.postalCode.value=e.getPostalCode().getValue(),i.company.value=e.getCompany().getValue(),i.manager.value=e.getManager().getValue(),i.department.value=e.getDepartment().getValue(),i.preferredLanguage.value=e.getLanguage().getValue(),i.notes.value=e.getNotes().getValue(),y.Base.Utils.isDefined(e._scopiaUserId)&&(i.scopiaUserId.value=e.getScopiaUserId().getValue()),y.Base.Utils.isDefined(e._scopiaLoginId)&&(i.scopiaLoginId.value=e.getScopiaLoginId().getValue()),i.rank.value=e.getRank().getValue().toString(),i.isBuddy.value=e.isBuddy().getValue().toString(),i.favourite.value=e.isFavorite().getValue().toString(),i.videoCapable.value=e.isVideoCapable().getValue().toString();for(var a=[],r=e.getEmailAddresses().getValues(),s=0;s<r.length;s++){var n=new y.Providers.ACS.ContactEmailData;n.value=r[s].getAddress(),n.type=this._convertContactEmailAddressTypeToACSEmailAddressType(r[s].getEmailAddressType()),a.push(n)}i.emailAddresses=a;var o=[],c=e.getPhoneNumbers().getValues();for(s=0;s<c.length;s++){var l=new y.Providers.ACS.ContactPhoneData;l.phoneNumber=c[s].getPhoneNumber(),l.label1=c[s].getLabel1(),l.label2=c[s].getLabel2(),l.type=this._convertContactPhoneNumberTypeToACSPhoneType(c[s].getPhoneNumberType()),l.speedDialEnabled=c[s].isSpeedDialEnabled().toString(),l.isPrimary=c[s].isDefault().toString(),o.push(l)}i.phoneNumberList=o;var d=[],C=e.getIMAddresses().getValues();for(s=0;s<C.length;s++){var u=new y.Providers.ACS.ContactHandleData;u.value=C[s].getAddress(),u.type=this._convertContactHandleTypeToACSHandleType(C[s].getIMAddressType()),d.push(u)}i.imaddresses=d}return i},_convertACSPhoneNumberTypeToContactPhoneNumberType:function(e){if(!e)return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;switch(e){case y.Providers.ACS.ACSPhoneNumberType.WORK:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;case y.Providers.ACS.ACSPhoneNumberType.HOME:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME;case y.Providers.ACS.ACSPhoneNumberType.HANDLE:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE;case y.Providers.ACS.ACSPhoneNumberType.MOBILE:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE;case y.Providers.ACS.ACSPhoneNumberType.FAX:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX;case y.Providers.ACS.ACSPhoneNumberType.PAGER:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER;default:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}},_convertContactPhoneNumberTypeToACSPhoneType:function(e){if(!e)return y.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK;switch(e){case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK:return y.Providers.ACS.ACSPhoneNumberType.WORK;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE:return y.Providers.ACS.ACSPhoneNumberType.HANDLE;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME:return y.Providers.ACS.ACSPhoneNumberType.HOME;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE:return y.Providers.ACS.ACSPhoneNumberType.MOBILE;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX:return y.Providers.ACS.ACSPhoneNumberType.FAX;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER:return y.Providers.ACS.ACSPhoneNumberType.PAGER;default:return y.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK}},_convertACSEmailAddressTypeToContactEmailAddressType:function(e){if(!e)return y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER;switch(e){case y.Providers.ACS.ACSEmailAddressType.WORK:return y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK;case y.Providers.ACS.ACSEmailAddressType.OTHER:default:return y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER}},_convertContactEmailAddressTypeToACSEmailAddressType:function(e){if(!e)return y.Providers.ACS.ACSEmailAddressType.OTHER;switch(e){case y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK:return y.Providers.ACS.ACSEmailAddressType.WORK;case y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER:default:return y.Providers.ACS.ACSEmailAddressType.OTHER}},_convertACSHandleTypeToContactHandleType:function(e){if(!e)return y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER;switch(e){case y.Providers.ACS.ACSHandleType.WORK:return y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK;case y.Providers.ACS.ACSHandleType.OTHER:default:return y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER}},_convertContactHandleTypeToACSHandleType:function(e){if(!e)return y.Providers.ACS.ACSHandleType.OTHER;switch(e){case y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK:return y.Providers.ACS.ACSHandleType.WORK;case y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER:default:return y.Providers.ACS.ACSHandleType.OTHER}},extendAcsContact:function(e){var t=y.Base.Utils.deepMerge;if((e=t(new y.Providers.ACS.ContactV1,e)).emailAddresses)for(var i=e.emailAddresses.length,a=0;a<i;a++)e.emailAddresses[a]=t(new y.Providers.ACS.ContactEmailData,e.emailAddresses[a]);if(e.phoneNumberList){var r=e.phoneNumberList.length;for(a=0;a<r;a++)e.phoneNumberList[a]=t(new y.Providers.ACS.ContactPhoneData,e.phoneNumberList[a])}if(e.imaddresses){var s=e.imaddresses.length;for(a=0;a<s;a++)e.imaddresses[a]=t(new y.Providers.ACS.ContactHandleData,e.imaddresses[a])}return e}},y.Providers.ACS.ACSContactsConverter=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSContentsActions={ADD:"ADD",UPDATE:"UPDATE",DELETE:"DELETE",REFRESH:"refreshContactList"}}(),function(i){"use strict";function e(){this._acsRequestBuilder=null,this._acsContactsConverter=null,this._acsNetworkProvider=null,this._acsContactsProvider=null,this._acsDirectorySearchProvider=null,this._contactsAnalyticsService=new i.Services.Analytics.ContactsAnalyticsService,this._acsContactsCache=new i.Providers.ACS.ACSContactsCache}e.prototype={getACSContactsProvider:function(){var e;return this._acsContactsProvider||(e=this._createACSContactsProviderV1(),this._acsContactsProvider=new i.Providers.ACS.ACSContactsProvider,this._acsContactsProvider.registerACSContactsProvider(1,e)),this._acsContactsProvider},getACSDirectorySearchProvider:function(){var e;return this._acsDirectorySearchProvider||(e=this._createACSDirectorySearchProviderV1(),this._acsDirectorySearchProvider=new i.Providers.ACS.ACSDirectorySearchProvider,this._acsDirectorySearchProvider.registerACSDirectorySearchProvider(1,e)),this._acsDirectorySearchProvider},_createACSContactsProviderV1:function(){return new i.Providers.ACS.ACSContactsProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder())},_createACSDirectorySearchProviderV1:function(){return new i.Providers.ACS.ACSDirectorySearchProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder(),this._contactsAnalyticsService,this._acsContactsCache)},_getACSContactsConverter:function(){return this._acsContactsConverter||(this._acsContactsConverter=new i.Providers.ACS.ACSContactsConverter),this._acsContactsConverter},_getACSRequestBuilder:function(){return this._acsRequestBuilder||(this._acsRequestBuilder=new i.Providers.ACS.ACSRequestBuilder),this._acsRequestBuilder},_getACSNetworkProvider:function(){var e,t;return this._acsNetworkProvider||(t=[i.Providers.ACS.ACSEventTypes.CAS_NOTIFICATION,i.Providers.ACS.ACSEventTypes.PING],e=new i.Base.SSEProvider(t),t=new i.Base.RESTProvider,t=new i.Base.SSEIntegrationProvider(t,e),e=new i.Base.WebSocketProvider,e=new i.Base.NetworkProvider(e,t,i.Base.LoggerTags.ACS_CONTACTS_PROVIDER),t=new i.Base.NetworkProvider(new i.Base.RESTProvider,T,i.Base.LoggerTags.ACS_CONTACTS_PROVIDER),this._acsNetworkProvider=new i.Providers.ACS.ACSNetworkProvider(this._getACSRequestBuilder(),t,e,this._contactsAnalyticsService)),this._acsNetworkProvider}},i.Providers.ACS.ACSProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSProviderStates={STARTING:"STARTING",STARTED:"STARTED",STOPPING:"STOPPING",STOPPED:"STOPPED"}}(),function(o){"use strict";function e(){this._acsResources={},this._endpoints={},this._contentTypes={resourcesV1:"application/vnd.avaya.acs.resources.v1+json",resourcesV2:"application/vnd.avaya.acs.resources.v2+json",resourcesV7:"application/vnd.avaya.acs.resources.v7+json",errorV1:"application/vnd.avaya.acs.error.v1+json",contactsV1:"application/vnd.avaya.acs.contacts.v1+json",contactV1:"application/vnd.avaya.acs.contact.v1+json",searchV1:"application/vnd.avaya.acs.search.v1+json",searchresultV1:"application/vnd.avaya.acs.searchresult.v1+json",quicksearchV1:"application/vnd.avaya.acs.quicksearch.v1+json",searchresultiviewV1:"application/vnd.avaya.acs.searchresult-iview.v1+json"},this._usedIds={}}(e.prototype={}).setResources=function(e){this._acsResources=e,this._endpoints.searchContactsIView="",this._acsResources.resources.contacts&&(this._acsResources.resources.contacts.GET&&(this._acsResources.resources.contacts.GET.getContacts&&(this._endpoints.getContacts=this._acsResources.resources.contacts.GET.getContacts.href,this._endpoints.searchContacts=this._endpoints.getContacts+"/searches",this._endpoints.quickSearchContacts=this._endpoints.getContacts+"/quicksearches"),this._acsResources.resources.contacts.GET.searchIViewContacts&&(this._endpoints.searchContactsIView=this._acsResources.resources.contacts.GET.searchIViewContacts.href)),this._acsResources.resources.contacts.POST&&(this._acsResources.resources.contacts.POST.addUpdateContact&&(this._endpoints.addUpdateContact=this._acsResources.resources.contacts.POST.addUpdateContact.href),this._acsResources.resources.contacts.POST.performUnifiedSearch&&(this._endpoints.searchContacts=this._acsResources.resources.contacts.POST.performUnifiedSearch.href),this._acsResources.resources.contacts.POST.performQuickSearch&&(this._endpoints.quickSearchContacts=this._acsResources.resources.contacts.POST.performQuickSearch.href))),this._acsResources&&this._acsResources.sessionManagement&&this._acsResources.sessionManagement.href&&(this._endpoints.refreshRestSession=this._acsResources.sessionManagement.href)},e.prototype.setNotificationResources=function(e){e&&e.sessionManagement&&e.sessionManagement.href&&(this._endpoints.refreshNotificationSession=e.sessionManagement.href)},e.prototype.buildResourcesOptions=function(e,t){var i=[this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "),i={urlSuffix:"/acs/resources",sendType:"GET",dataType:"JSON",crossDomain:!0,headers:{Accept:i=t?[this._contentTypes.resourcesV7,this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "):i}};return e&&(i.headers["X-Avaya-Requested-With"]="XMLHttpRequest"),i},e.prototype.buildInvalidateSessionOptions=function(){return{urlSuffix:"/acs/session",sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildRefreshRestSessionOptions=function(){return this._endpoints.refreshRestSession?{url:this._endpoints.refreshRestSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/acs/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildRefreshNotificationSessionOptions=function(){return this._endpoints.refreshNotificationSession?{url:this._endpoints.refreshNotificationSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/notification/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildGetContactsOptions=function(e){if(o.Base.Utils.isUndefined(this._endpoints.getContacts))return T;var t={headers:{}},i=this._acsResources.resources.contacts&&this._acsResources.resources.contacts.GET.getContacts&&this._acsResources.resources.contacts.GET.getContacts.limits&&this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal?this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal:250;return t.url=this._endpoints.getContacts+"?count="+i,e&&(t.url+="&after="+e),t.sendType="GET",t.dataType="JSON",t.headers.Accept=[this._contentTypes.contactsV1,this._contentTypes.errorV1].join(", "),t},e.prototype.buildGetContactOptions=function(e){return{url:e,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", ")}}},e.prototype.buildAddContactOptions=function(){return o.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?T:{url:this._endpoints.addUpdateContact,sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},e.prototype.buildUpdateContactOptions=function(){return o.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?T:{url:this._endpoints.addUpdateContact,sendType:"PUT",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},e.prototype.buildAddUpdateContactData=function(e){return JSON.stringify({userEmail:this._acsResources.self,contacts:[e]},this._stringifyReplacer)},e.prototype.buildDeleteContactOptions=function(e){return{url:e,sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildSearchContactsData=function(e){var t,i=e.getSearchString(),a=e.getSearchField();a===o.Services.Contacts.SearchFieldType.NAME?t=["Displayname,"+i]:a===o.Services.Contacts.SearchFieldType.HANDLE?t=["EmailAddress,"+i]:a===o.Services.Contacts.SearchFieldType.LOGIN_ID?t=["LoginID,"+i]:a===o.Services.Contacts.SearchFieldType.TERMINAL?t=["Terminal,"+i]:a===o.Services.Contacts.SearchFieldType.ALL&&(t=["ALL,"+i]);e=e.getMaxResults();return 0===e&&(e=T),JSON.stringify({searchCriteria:t,maxResults:e})},e.prototype.buildSearchContactsIViewOnlyData=function(e){var t=e.getSearchString();o.Base.Utils.getBrowserType()!==o.Base.BrowserType.IE&&o.Base.Utils.getBrowserType()!==o.Base.BrowserType.EDGE||(t=encodeURIComponent(t));var i=e.getSearchField();i===o.Services.Contacts.SearchFieldType.NAME?a="displayname="+t:i===o.Services.Contacts.SearchFieldType.HANDLE?a="emailAddress="+t:i===o.Services.Contacts.SearchFieldType.LOGIN_ID?a="loginID="+t:i===o.Services.Contacts.SearchFieldType.TERMINAL?a="terminal="+t:i===o.Services.Contacts.SearchFieldType.ALL&&(a="all="+t);var a=[a],e=e.getMaxResults();return(e=0===e?T:e)&&a.push("maxResults="+e),a.join("&")},e.prototype.buildQuickSearchContactsOptions=function(){return{url:this._endpoints.quickSearchContacts+"?maxResults=100",sendType:"POST",dataType:"text",headers:{Accept:[this._contentTypes.searchresultV1,this._contentTypes.errorV1],"Content-Type":this._contentTypes.quicksearchV1}}},e.prototype.buildQuickSearchContactsData=function(e,t){var i,a=[],r=o.Services.Contacts.ResolveContactsFieldType;switch(t){case r.HANDLE:i="Handle";break;case r.PHONE_NUMBER:i="PhoneNumber";break;default:o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Invalid field type of resolving contacts",t)}if(i)for(var s=0;s<e.length;s++){var n={correlationId:String(s),criteria:{}};n.criteria[i]=e[s],a.push(n)}return JSON.stringify({filter:["EmailAddress","FirstName","LastName","PhoneNumber","IMHandle"],searchCriteria:a})},e.prototype.buildSearchContactsOptions=function(){return{url:this._endpoints.searchContacts+"?searchDirectory=true",sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.searchV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},e.prototype.buildSearchContactsIViewOnlyOptions=function(){return{url:this._endpoints.searchContactsIView,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.searchresultiviewV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},e.prototype.buildNotificationsOptions=function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},e.prototype.buildSubscribeForACSNotifications=function(e){return{subscribe:{requestId:"subscribe-"+this._generateId(),resources:[{application:"acs",service:e,resource:this._endpoints[e]}],version:"1"}}},e.prototype.buildUnsubscribeFromACSNotifications=function(e){return{unsubscribe:{requestId:"unsubscribe-"+this._generateId(),resources:[{application:"acs",service:e,resource:this._endpoints[e]}],version:"1"}}},e.prototype._stringifyReplacer=function(e,t){return t&&t.hasOwnProperty("value")&&t.value===T?T:t},e.prototype._generateId=function(e,t){for(var i;i=o.Base.Utils.makeId(),this._usedIds[i];);return i},o.Providers.ACS.ACSRequestBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEmailAddressType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSHandleType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSPhoneNumberType={WORK:"work",HANDLE:"handle",MOBILE:"mobile",HOME:"home",FAX:"fax",PAGER:"pager"}}(),function(e){"use strict";function t(){this.value=T,this.editable=T}t.prototype={equals:function(e){return this.value===e.value&&this.editable===e.editable}},e.Providers.ACS.ContactAttribute=t}(AvayaClientServices),function(e){"use strict";function t(){this.value=T,this.type=e.Providers.ACS.ACSEmailAddressType.OTHER,this.editable=T}t.prototype={equals:function(e){return this.value===e.value&&this.type===e.type&&this.editable===e.editable}},e.Providers.ACS.ContactEmailData=t}(AvayaClientServices),function(e){"use strict";function t(){this.value=T,this.type=e.Providers.ACS.ACSHandleType.OTHER,this.editable=T,this.provenance=T}t.prototype={equals:function(e){return this.value===e.value&&this.type===e.type&&this.editable===e.editable&&this.provenance===e.provenance}},e.Providers.ACS.ContactHandleData=t}(AvayaClientServices),function(e){"use strict";function t(){this.phoneNumber=T,this.label1=T,this.label2=T,this.type=e.Providers.ACS.ACSPhoneNumberType.WORK,this.speedDialEnabled=!1,this.isPrimary=!1,this.editable=T}t.prototype={equals:function(e){return this.phoneNumber===e.phoneNumber&&this.label1===e.label1&&this.label2===e.label2&&this.type===e.type&&this.speedDialEnabled===e.speedDialEnabled&&this.isPrimary===e.isPrimary&&this.editable===e.editable}},e.Providers.ACS.ContactPhoneData=t}(AvayaClientServices),function(e){"use strict";function t(){this.userEmail="",this.contacts=[],this.hasMoreResults=!1}t.prototype={},e.Providers.ACS.ContactsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.id=new e.Providers.ACS.ContactAttribute,this.contactIdentifier=new e.Providers.ACS.ContactAttribute,this.contactUrl=new e.Providers.ACS.ContactAttribute,this.surName=new e.Providers.ACS.ContactAttribute,this.givenName=new e.Providers.ACS.ContactAttribute,this.displayName=new e.Providers.ACS.ContactAttribute,this.alias=new e.Providers.ACS.ContactAttribute,this.company=new e.Providers.ACS.ContactAttribute,this.location=new e.Providers.ACS.ContactAttribute,this.workRoomNo=new e.Providers.ACS.ContactAttribute,this.streetAddress=new e.Providers.ACS.ContactAttribute,this.city=new e.Providers.ACS.ContactAttribute,this.state=new e.Providers.ACS.ContactAttribute,this.country=new e.Providers.ACS.ContactAttribute,this.postalCode=new e.Providers.ACS.ContactAttribute,this.manager=new e.Providers.ACS.ContactAttribute,this.department=new e.Providers.ACS.ContactAttribute,this.asciiGivenName=new e.Providers.ACS.ContactAttribute,this.asciiSurName=new e.Providers.ACS.ContactAttribute,this.asciiDisplayName=new e.Providers.ACS.ContactAttribute,this.pictureUrl=new e.Providers.ACS.ContactAttribute,this.isBuddy=new e.Providers.ACS.ContactAttribute,this.favourite=new e.Providers.ACS.ContactAttribute,this.videoCapable=new e.Providers.ACS.ContactAttribute,this.preferredLanguage=new e.Providers.ACS.ContactAttribute,this.notes=new e.Providers.ACS.ContactAttribute,this.rank=new e.Providers.ACS.ContactAttribute,this.custom1=new e.Providers.ACS.ContactAttribute,this.custom2=new e.Providers.ACS.ContactAttribute,this.custom3=new e.Providers.ACS.ContactAttribute,this.scopiaUserId=new e.Providers.ACS.ContactAttribute,this.scopiaLoginId=new e.Providers.ACS.ContactAttribute,this.phoneNumberList=[],this.emailAddresses=[],this.imaddresses=[]}t.prototype={equals:function(e){if(!(this.id.equals(e.id)&&this.contactIdentifier.equals(e.contactIdentifier)&&this.contactUrl.equals(e.contactUrl)&&this.surName.equals(e.surName)&&this.givenName.equals(e.givenName)&&this.displayName.equals(e.displayName)&&this.alias.equals(e.alias)&&this.company.equals(e.company)&&this.location.equals(e.location)&&this.workRoomNo.equals(e.workRoomNo)&&this.streetAddress.equals(e.streetAddress)&&this.city.equals(e.city)&&this.state.equals(e.state)&&this.country.equals(e.country)&&this.postalCode.equals(e.postalCode)&&this.manager.equals(e.manager)&&this.department.equals(e.department)&&this.asciiGivenName.equals(e.asciiGivenName)&&this.asciiSurName.equals(e.asciiSurName)&&this.asciiDisplayName.equals(e.asciiDisplayName)&&this.pictureUrl.equals(e.pictureUrl)&&this.isBuddy.equals(e.isBuddy)&&this.favourite.equals(e.favourite)&&this.videoCapable.equals(e.videoCapable)&&this.preferredLanguage.equals(e.preferredLanguage)&&this.notes.equals(e.notes)&&this.rank.equals(e.rank)&&this.custom1.equals(e.custom1)&&this.custom2.equals(e.custom2)&&this.custom3.equals(e.custom3)&&this.scopiaUserId.equals(e.scopiaUserId)&&this.scopiaLoginId.equals(e.scopiaLoginId))||this.phoneNumberList.length!==e.phoneNumberList.length||this.emailAddresses.length!==e.emailAddresses.length||this.imaddresses.length!==e.imaddresses.length)return!1;for(var t=0;t<this.phoneNumberList.length;t++)if(!this.phoneNumberList[t].equals(e.phoneNumberList[t]))return!1;for(t=0;t<this.emailAddresses.length;t++)if(!this.emailAddresses[t].equals(e.emailAddresses[t]))return!1;for(t=0;t<this.imaddresses.length;t++)if(!this.imaddresses[t].equals(e.imaddresses[t]))return!1;return!0}},e.Providers.ACS.ContactV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.displayMsg="",this.errorMsg=""}t.prototype={},e.Providers.ACS.ErrorV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}t.prototype={},e.Providers.ACS.NotificationResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.resources={avayaRequestTimeout:{maximum:T,minimum:T,recommended:T},capabilities:[],contactSearchCapabilities:[],resources:{notification:{websocket:{href:T},sse:{href:T}},contacts:{POST:{addUpdateContact:{href:T}},GET:{getContacts:{href:T,limits:{maxSearchResultsPerPage:T,maxSearchResultsTotal:T}},searchIViewContacts:{href:T,limits:{maxSearchResultsTotal:T}}}},pictures:{GET:{getUserPicture:{href:T}}}},self:T,sessionManagement:{href:T,timeout:T}}}t.prototype={},e.Providers.ACS.ResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.ACS.ResourcesV1.call(this),this.version=2,this.v2MediaType=!0}t.prototype={},e.Providers.ACS.ResourcesV2=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ObservableEvents={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMM3EventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStateActions={TYPING:"typing",RECORDING_AUDIO:"recordingAudio",RECORDING_VIDEO:"recordingVideo",ATTACHING_FILE:"attachingFile",TAKING_PICTURE:"takingPicture",OTHER:"other"}}(),function(s){"use strict";s.Providers.AMM.AMMChatStateNotification=function(e,t,i,a,r){this.action=e.action,this.state=e.state,this.self=t,this.timeout=setTimeout(function(){t?r(e):(e.action="",e.state=s.Providers.AMM.ChatStates.PAUSED,i.fire(e))},a)}}(AvayaClientServices),function(s){"use strict";function e(){this._chatStateNotifications=[],this._conversationId="",this._localComposingInactivityTimeout=15e3,this._remoteComposingInactivityTimeout=6e4,this._composingRefreshTimeout=5e3,this._chatStateRefresh=!1,this._chatStateRefreshTimeout={}}e.prototype={setConversationId:function(e){this._conversationId=e},getConversationId:function(){return this._conversationId},setChatStateNotification:function(e,t,i){e.state===s.Providers.AMM.ChatStates.COMPOSING?this._setTypingNotification(e,t,i):this._chatStateNotifications[e.address]&&e.state===s.Providers.AMM.ChatStates.PAUSED&&(clearTimeout(this._chatStateNotifications[e.address].timeout),delete this._chatStateNotifications[e.address])},setChatStateRefreshTimeout:function(){this._chatStateRefresh=!0,this._chatStateRefreshTimeout=setTimeout(function(){this._chatStateRefresh=!1}.bind(this),this._composingRefreshTimeout)},getChatNotification:function(e){return this._chatStateNotifications[e]},clearChatStateRefreshTimeout:function(){this._chatStateRefresh=!1,clearTimeout(this._chatStateRefreshTimeout)},clearChatStateNotifications:function(){this._chatStateNotifications=[]},isChatStateAdded:function(){return this._chatStateRefresh},onPauseChatState:function(e,t){return S.Deferred().reject().promise()},_setTypingNotification:function(e,t,i){var a=t?this._localComposingInactivityTimeout:this._remoteComposingInactivityTimeout,r=function(e){this._localTimeoutEvent(e,i)}.bind(this);this._chatStateNotifications[e.address]?(clearTimeout(this._chatStateNotifications[e.address].timeout),this._chatStateNotifications[e.address].timeout=setTimeout(function(){t?this._localTimeoutEvent(e,i):this._remoteTimeoutEvent(e,i)}.bind(this),a)):this._chatStateNotifications[e.address]=new s.Providers.AMM.AMMChatStateNotification(e,t,i,a,r)},_localTimeoutEvent:function(t,i){this.onPauseChatState(t.action,this._conversationId).fail(function(e){s.Base.Logger.error(s.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"An attempt to update typing status was failed.",e),this._remoteTimeoutEvent(t,i)}.bind(this))},_remoteTimeoutEvent:function(e,t){e.action="",e.state=s.Providers.AMM.ChatStates.PAUSED,t.fire(e)}},s.Providers.AMM.AMMChatStateNotifications=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStates={COMPOSING:"composing",PAUSED:"paused"}}(),function(i){"use strict";function e(){this._parsers=[]}e.prototype={register:function(e,t){this._parsers[e]=t},unregister:function(e){this._parsers[e]=T},parse:function(e,t){return this._parsers[e]?this._delegateParser(e,t):t},_delegateParser:function(e,t){if(this._parsers[e]!==T)return this._parsers[e].parse(t);i.Base.Logger.error(i.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"No parser specified!",e)}},i.Providers.AMM.AMMMessagesParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.MessagesService={CONVERSATION:"conversation",CHAT_STATE:"chatState"}}(),function(s){"use strict";function e(){this._ammProvider={}}e.prototype={getAMMProvider:function(e){if(s.Base.Utils.isDefined(e)&&e.enabled)return S.isEmptyObject(this._ammProvider)&&(this._ammProvider=new s.Providers.AMM.AMMProvider,this._ammProvider.registerAMMProvider(2.1,this._createAMM2_1Provider()),this._ammProvider.registerAMMProvider(3,this._createAMM3_XProvider("AMM3Provider")),this._ammProvider.registerAMMProvider(3.2,this._createAMM3_XProvider("AMM3_2Provider"))),this._ammProvider},_createAMM2_1Provider:function(){var e=new s.Base.RESTProvider,t=new s.Base.NetworkProvider(e,T,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),e=this._createEventsV2Parser();return new s.Providers.AMM.AMM2_1Provider(t,e)},_createEventsV2Parser:function(){var e=new s.Providers.AMM.AMMMessagesParser;return e.register(s.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new s.Providers.AMM.GetConversationsParser),e.register(s.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new s.Providers.AMM.ValidateUsersParser),e.register(s.Providers.AMM.AMMResponsesTypes.SEND,new s.Providers.AMM.SendParser),e.register(s.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new s.Providers.AMM.GetMessagesParser),e.register(s.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new s.Providers.AMM.AddParticipantsParser),e.register(s.Providers.AMM.AMMResponsesTypes.CLOSE,new s.Providers.AMM.CloseParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new s.Providers.AMM.NotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFIED,new s.Providers.AMM.NotifiedParser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY,new s.Providers.AMM.DiscoveryV2Parser),e.register(s.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new s.Providers.AMM.SubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new s.Providers.AMM.UnsubscribedParser),e},_createAMM3_XProvider:function(e){var t=[s.Providers.AMM.AMM3EventTypes.CAS_NOTIFICATION,s.Providers.AMM.AMM3EventTypes.PING],i=new s.Base.SSEProvider(t),a=new s.Base.RESTProvider,r=new s.Base.SSEIntegrationProvider(a,i),t=new s.Base.WebSocketProvider,a=new s.Base.NetworkProvider(t,r,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),i=new s.Base.RESTProvider,t=new s.Base.NetworkProvider(i,T,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),r=this._createEventsV3Parser(),i=new s.Providers.AMM.AMMChatStateNotifications;return new s.Providers.AMM[e](t,a,i,r)},_createEventsV3Parser:function(){var e=new s.Providers.AMM.AMMMessagesParser;return e.register(s.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new s.Providers.AMM.GetConversationsParser),e.register(s.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new s.Providers.AMM.ValidateUsersParser),e.register(s.Providers.AMM.AMMResponsesTypes.SEND,new s.Providers.AMM.SendParser),e.register(s.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new s.Providers.AMM.GetMessagesParser),e.register(s.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new s.Providers.AMM.AddParticipantsParser),e.register(s.Providers.AMM.AMMResponsesTypes.CLOSE,new s.Providers.AMM.CloseParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new s.Providers.AMM.NotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFIED,new s.Providers.AMM.NotifiedParser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY,new s.Providers.AMM.DiscoveryV3Parser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY_NOTIFICATION,new s.Providers.AMM.DiscoveryNotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new s.Providers.AMM.SubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new s.Providers.AMM.UnsubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.RESOURCE_STATE,new s.Providers.AMM.ResourceStateParser),e}},s.Providers.AMM.AMMProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ProviderStates={AVAILABLE:"available",UNAVAILABLE:"unavailable"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMMResponsesTypes={ADD_PARTICIPANTS:"AddParticipants",GET_CONVERSATIONS:"GetConversations",VALIDATE_USERS:"ValidateUsers",SEND:"Send",GET_MESSAGES:"GetMessages",CLOSE:"Close",NOTIFICATION:"Notification",NOTIFIED:"Notified",DISCOVERY:"Discovery",DISCOVERY_NOTIFICATION:"DiscoveryNotification",SUBSCRIBED:"Subscribed",UNSUBSCRIBED:"Unsubscribed",RESOURCE_STATE:"ResourceState"}}(),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")}},e.Providers.AMM.AbstractParser=t}(AvayaClientServices),function(r){"use strict";function e(){}(e.prototype=Object.create(r.Providers.AMM.AbstractParser.prototype)).parse=function(e){for(var t={participants:[]},i=0;i<e.participants.length;i++){var a=new r.Providers.AMM.AddParticipantsResponse(e.participants[i].address,e.participants[i].givenName,e.participants[i].language,e.participants[i].modalities,e.participants[i].nativeGivenName,e.participants[i].nativeSurname,e.participants[i].surname,e.participants[i].type);t.participants.push(a)}return t},r.Providers.AMM.AddParticipantsParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.CloseResponse(e.closed,e.href,e.sensitivity)},t.Providers.AMM.CloseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryNotificationResponse(e.applications,e.capabilities,e.sessionManagement,e.version,e.commandURL)},t.Providers.AMM.DiscoveryNotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryV2Response(e.addresses,e.avayaRequestTimeout,e.capabilities,e.conversationsResource,e.domains,e.limits,e.messages,e.outbox,e.self,e.services)},t.Providers.AMM.DiscoveryV2Parser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryV3Response(e.avayaRequestTimeout,e.contacts,e.conversationsResource,e.domains,e.messages,e.notificationService,e.notifications,e.outbox,e.picture,e.self,e.services,e.sessionManagement,e.users)},t.Providers.AMM.DiscoveryV3Parser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.GetConversationsResponse(e.conversations,e.href,e.lastUpdated,e.moreSearchResults)},t.Providers.AMM.GetConversationsParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.GetMessagesResponse(e.attachmentCount,e.counts,e.flags,e.href,e.id,e.lastAccessedTime,e.lastUpdated,e.latestEntryTimestamp,e.messages,e.participants,e.subject,e.totalCount,e.type,e.unreadAttachmentCount,e.unreadCount)},t.Providers.AMM.GetMessagesParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.NotificationResponse(e.application,e.contents,e.resource,e.service,e.version)},t.Providers.AMM.NotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.NotifiedResponse(e.requestId,e.results,e.version)},t.Providers.AMM.NotifiedParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.ResourceStateResponse(e.results,e.version)},t.Providers.AMM.ResourceStateParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.SendResponse(e.body,e.event,e.flags,e.from,e.href,e.id,e.lastModifiedDate,e.parts,e.receivedDate,e.subject,e.threadId,e.to,e.inReplyTo)},t.Providers.AMM.SendParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.SubscribedResponse(e.results,e.version)},t.Providers.AMM.SubscribedParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.UnsubscribedResponse(e.results,e.version)},t.Providers.AMM.UnsubscribedParser=e}(AvayaClientServices),function(r){"use strict";function e(){}(e.prototype=Object.create(r.Providers.AMM.AbstractParser.prototype)).parse=function(e){for(var t={validatedAddresses:[]},i=0;i<e.validatedAddresses.length;i++){var a=new r.Providers.AMM.ValidateUsersResponse(e.validatedAddresses[i].addresses,e.validatedAddresses[i].query);t.validatedAddresses.push(a)}return t},r.Providers.AMM.ValidateUsersParser=e}(AvayaClientServices),function(e){"use strict";function t(){this.active=!1,this.closed=!1,this.href="",this.sensitivity=""}t.prototype={},e.Providers.AMM.ConversationFlagsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.conversationIds=[],this.href="",this.lastUpdated=""}t.prototype={},e.Providers.AMM.ConversationIdsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.href="",this.id="",this.lastAccessedTime="",this.lastUpdated=""}t.prototype={},e.Providers.AMM.ConversationIdV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.conversations=[],this.href="",this.lastUpdated="",this.moreSearchResults=!1}t.prototype={},e.Providers.AMM.ConversationsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.attachmentCount=0,this.href="",this.id="",this.flags=new e.Providers.AMM.ConversationFlagsV1,this.lastAccessedTime="",this.lastUpdated="",this.latestEntryTimestamp="",this.messages=[],this.name="",this.owner="",this.participants={href:""},this.totalCount=0,this.type="",this.unreadAttachmentCount=0,this.unreadCount=0,this.counts={eventCount:0,eventUnreadMessage:0,messageAttachment:0,messageCount:0,messageUnreadAttachment:0,messageUnreadMessage:0}}t.prototype={},e.Providers.AMM.ConversationV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.address="",this.givenName="",this.language="",this.modalities=[],this.nativeGivenName="",this.nativeSurname="",this.picture="",this.surname="",this.subType="",this.type=""}t.prototype={},e.Providers.AMM.EntityV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.displayMsg="",this.errorMsg="",this.errorCode=0}t.prototype={},e.Providers.AMM.ErrorV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.participants=[],this.reason="",this.type="",this.units="",this.value=0}t.prototype={},e.Providers.AMM.EventV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.doNotForward=!1,this.href="",this.importance="",this.read=!1,this.sensitivity=""}t.prototype={},e.Providers.AMM.MessageFlagsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.body="",this.event=new e.Providers.AMM.EventV1,this.flags=new e.Providers.AMM.MessageFlagsV1,this.from=new e.Providers.AMM.EntityV1,this.href="",this.id="",this.inReplyTo="",this.lastModifiedDate="",this.parts=[],this.receivedDate="",this.subject="",this.threadId="",this.to=[]}t.prototype={},e.Providers.AMM.MessageV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}t.prototype={},e.Providers.AMM.NotificationResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.action="",this.address="",this.state="",this.timestamp=""}t.prototype={},e.Providers.AMM.NotificationContentsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.participants=[]}t.prototype={},e.Providers.AMM.ParticipantsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.disposition="",this.duration=0,this.media="",this.mimeType="",this.partId="",this.size=0}t.prototype={},e.Providers.AMM.PartV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=2,this.addresses="",this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.services={markAsReadIf:"",validateAddress:""}}t.prototype={},e.Providers.AMM.ResourcesV2=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=3,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.picture="",this.contacts="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}}}t.prototype={},e.Providers.AMM.ResourcesV3=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=4,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.contacts={href:""},this.conversationsResource={href:"",capabilities:{automaticLastAccessedDate:!1,postSessionEvent:!1,subjectChange:!1},limits:{maxMessageCount:0,maxIdsLimit:0}},this.domains=[],this.messages={href:"",capabilities:{html:!1}},this.notifications={href:""},this.outbox={href:"",capabilities:{richContent:!1},limits:{maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0}},this.picture={href:""},this.self="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}},this.notificationService={sse:{href:""},websocket:{href:""}},this.users={href:""},this.sessionManagement={href:"",timeout:0,username:""}}t.prototype={},e.Providers.AMM.ResourcesV4=t}(AvayaClientServices),function(e){"use strict";function t(){this.query="",this.addresses=[]}t.prototype={},e.Providers.AMM.ValidatedAddressesV1=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.AddParticipantsResponse=function(e,t,i,a,r,s,n,o){this._address=e,this.givenName=t,this.language=i,this.modalities=a,this.nativeGivenName=r,this.nativeSurname=s,this.surname=n,this.type=o}}(),function(){"use strict";AvayaClientServices.Providers.AMM.CloseResponse=function(e,t,i){this.closed=e,this.href=t,this.sensitivity=i}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryNotificationResponse=function(e,t,i,a,r){this.applications=e,this.capabilities=t,this.sessionManagement=i,this.version=a,this.commandURL=r}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV2Response=function(e,t,i,a,r,s,n,o,c,l){this.addresses=e,this.avayaRequestTimeout=t,this.capabilities=i,this.conversationsResource=a,this.domains=r,this.limits=s,this.messages=n,this.outbox=o,this.self=c,this.services=l}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV3Response=function(e,t,i,a,r,s,n,o,c,l,d,C,u){this.avayaRequestTimeout=e,this.contacts=t,this.conversationsResource=i,this.domains=a,this.messages=r,this.notificationService=s,this.notifications=n,this.outbox=o,this.picture=c,this.self=l,this.services=d,this.sessionManagement=C,this.users=u}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetConversationsResponse=function(e,t,i,a){this.conversations=e,this.href=t,this.lastUpdated=i,this.moreSearchResults=a;for(var r=0;r<this.conversations.length;r++)for(var s=0;s<this.conversations[r].messages.length;s++){this.conversations[r].messages[s].from._address=this.conversations[r].messages[s].from.address,delete this.conversations[r].messages[s].from.address;for(var n=0;n<this.conversations[r].messages[s].to.length;n++)this.conversations[r].messages[s].to[n]._address=this.conversations[r].messages[s].to[n].address,delete this.conversations[r].messages[s].to[n].address}}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetMessagesResponse=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_){this.attachmentCount=e,this.counts=t,this.flags=i,this.href=a,this.id=r,this.lastAccessedTime=s,this.lastUpdated=n,this.latestEntryTimestamp=o,this.messages=c,this.participants=l,this.subject=d,this.totalCount=C,this.type=u,this.unreadAttachmentCount=h,this.unreadCount=_}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotificationResponse=function(e,t,i,a,r){this.application=e,this.contents=t,this.resource=i,this.service=a,this.version=r}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotifiedResponse=function(e,t,i){this.requestId=e,this.results=t,this.version=i}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ResourceStateResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SendResponse=function(e,t,i,a,r,s,n,o,c,l,d,C,u){this.body=e,this.event=t,this.flags=i,this.from=a,this.href=r,this.id=s,this.lastModifiedDate=n,this.parts=o,this.receivedDate=c,this.subject=l,this.threadId=d,this.to=C,this.inReplyTo=u}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SubscribedResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.UnsubscribedResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ValidateUsersResponse=function(e,t){this.addresses=[],this.query=t;for(var i=0;i<e.length;i++){var a={_address:e[i].address,givenName:e[i].givenName,language:e[i].language,modalities:e[i].modalities,nativeGivenName:e[i].nativeGivenName,nativeSurname:e[i].nativeSurname,surname:e[i].surname,type:e[i].type};this.addresses.push(a)}}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCategories={CLIENT:"Client",USER:"User",SERVICES:"Services",PROVIDERS:"Providers",ANALYTICS:"Analytics",MESSAGING:"Messaging",CONTACTS:"Contacts",CALLS:"Calls",COLLABORATIONS:"Collaborations",CALL_FEATURES:"Call Features"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCustomDimensions={PRODUCT_VENDOR:1,PRODUCT_NAME:2,PRODUCT_VERSION:3,PROVIDER_TYPE:4,MIME_TYPE:5}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsProvidersTypes={CONTACTS:"AADS",MESSAGING:"AMM",CALLS:"AAWG",PRESENCE:"AAWG",VOICE_MESSAGING:"AAWG",COLLABORATION:"WCS",CONFERENCE:"UCCP"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsServicesNames={CALL:"CALL",COLLABORATION:"COLLAB",CONTACT:"CONTACT",MESSAGING:"MSG",PRESENCE:"PRES",VOICE_MESSAGING:"VM"}}(),function(f){"use strict";function e(e,t,i,a){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Initializing"),f.Base.Observable.call(this),this._config=T,this._csgwProviderFactory=e,this._configCallGwProvider=T,this._mediaServiceFactory=t,this._cpCalls={},this._sdpMediaOfferNotifications={},this._callFailureNotificationsQueue={},this._callEstablishedNotificationsQueue={},this._rtcConfiguration={},this._videoResolution={},this._consultConferencePromises={},this._callsAnalyticsService=i,this._rtcConnectionProviderFactory=a,this._isVideoAllowed=!0,this._browserType=f.Base.Utils.getBrowserType(),this._isServerSupportsNailedUpVideoConnection=T,this._activeCallVideoTrack=T,this._pendingVideoMuteState=T,this._pendingAudioMuteState=T,this._pendingSpeakerMuteState=T,f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Initialized")}(e.prototype=Object.create(f.Base.Observable.prototype)).start=function(e,t){if(this._config=e,this._updateVideoLicense(),!this._isBrowserSupported()&&!this._isConfiguredForMPaaSCollabCall())return S.Deferred().resolve().promise();if(this._config.sgConfiguration===T||!1===this._config.sgConfiguration.enabled)return f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Call gateway provider started without config"),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),S.Deferred().resolve().promise();this._videoResolution=t;e=this._getHost();this._configCallGwProvider=this._csgwProviderFactory.getCSGCallsProvider(e);e=!1;if(this._config.sgConfiguration&&this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest){if(!this._config.mediaServiceContext||!this._config._mediaServiceConfiguration)return f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Created default call gateway provider for Guest user"),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),S.Deferred().resolve().promise();var i="csaGuest/sessionId-"+this._getMediaServiceSessionId();this._config.sgConfiguration.credentialProvider.username=i,e=!0}else if(this._configCallGwProvider._isExternalGateway){if(this._configCallGwProvider._started)return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Registered user CANNOT be assigned to an external call gateway provider."),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[]),S.Deferred().reject("CANNOT be assigned to an external call gateway provider").promise();this._configCallGwProvider._isExternalGateway=!1}i=!this._config.callUserConfiguration.presentationOnly&&!this._config.mediaServiceContext&&this._config.callUserConfiguration.incomingCall;return this._startCallGwProvider(this._configCallGwProvider,this._config.sgConfiguration,i,t,e)},e.prototype._isConfiguredForMPaaSCollabCall=function(){var e=!!this._config.sgConfiguration&&!!this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest,t=!!this._config.wcsConfiguration&&this._config.wcsConfiguration.enabled;return e&&!!this._config.mediaServiceContext&&t},e.prototype.supportsMPaaSCollabCall=function(){var e=!!this._config._mediaServiceConfiguration&&this._config._mediaServiceConfiguration.sessionId;return this._isConfiguredForMPaaSCollabCall()&&e},e.prototype.detectIPv6OnlySupport=function(){var i=S.Deferred(),a=this._rtcConnectionProviderFactory.create();return a._pc.onicecandidate=function(e){var t;e.candidate?(t="candidate:",t=(e=e.candidate.candidate).indexOf(t)+t.length,null!==(t=e.substr(t).split(" ")[4].match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))&&5===t.length&&t[1]<=255&&t[2]<=255&&t[3]<=255&&t[4]<=255&&(a.close(),i.reject())):(a.close(),i.resolve())},a._pc.onicegatheringstatechange=function(){"complete"===a._pc.iceGatheringState&&(a.close(),i.resolve())},a._pc.createOffer({offerToReceiveAudio:1}).then(function(e){a._pc.setLocalDescription(e)},function(e){a.close(),i.reject()}),i.promise()},e.prototype._startCallGwProvider=function(e,t,i,a,r){if(e._removeListeners(),e.on(f.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,this._answerCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,this._callRingingHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,this._createMediaRequestHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,this._remoteCallEndedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,this._incomingCallHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,this._callFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,this._callStateFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,this._makeCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._callsServiceActivatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._callsServiceDeactivatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._networkFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._networkAvailabilityHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.MAX_NETWORK_RECONNECTION_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,this._updateTransferStatusHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,this._updateConsultConferenceStatusHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,this._updateCallDataHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,this._updateCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,this._iceConfigUpdatesHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,this._terminateCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,function(e){e&&e.includes("mediaChannelGuidelines")?(this._isServerSupportsNailedUpVideoConnection=!0,this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,[])):(this._isServerSupportsNailedUpVideoConnection=!1,this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,[]))}.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,function(e,t,i){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,[e,t,i])}.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,function(e){this.trigger(f.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,[e])}.bind(this)),e.on(f.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(f.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),e.on(f.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(f.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this.isNailedUpVideoConnectionRequired()){var s={};return this.isVideoAllowed()?s.requiredDirection=f.Services.Call.MediaDirection.RECV_ONLY:s.permittedDirection=f.Services.Call.MediaDirection.INACTIVE,e.start(this,t,i,a,s,r)}return e.start(this,t,i,a,T,r)},e.prototype._stopCallGwProvider=function(i,t){var e,a=[],r=this._csgwProviderFactory.getCSGCallsProviderAsArray(),s=[];t?0<(e=r.filter(function(e){return e._host===t})).length&&(s.push(e[0]),a.push(e[0].stop())):r.forEach(function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Stopping call gateway provider for "+e._host),s.push(e),a.push(e.stop())}),S.when.apply(S,a).then(function(){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Stopped call gateway provider(s)");for(var e=0;e<s.length;e++)s[e]._removeListeners(),s[e]._cpCalls={};i.resolve()}.bind(this),function(e){f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Error encountered while stopping call gateway provider(s)",e);for(var t=0;t<s.length;t++)s[t]._removeListeners(),s[t]._cpCalls={};i.reject(e)}.bind(this)).always(function(){for(var e=0;e<s.length;e++)delete this._csgwProviderFactory._csgCallsProviderMap[s[e]._host]}.bind(this))},e.prototype.stop=function(e){if(!this._isBrowserSupported())return S.Deferred().resolve().promise();this._triggerEndCalls(e);var t=S.Deferred();return this._stopCallGwProvider(t,e),t.promise()},e.prototype.stopImmediately=function(){var t=S.Deferred(),i=[];return this._csgwProviderFactory.getCSGCallsProviderAsArray().forEach(function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Force stopping call gateway provider for "+e._host),i.push(e.stopImmediately())}),S.when.apply(S,i).then(function(){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Force stopped call gateway provider(s)"),t.resolve()}.bind(this),function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Failed to force stop call gateway provider(s)"),t.reject()}.bind(this)),t.promise()},e.prototype.startCall=function(e,t,i,a,r,s,n,o){var c,l,d,C,u,h,_=S.Deferred();return e._isGuestUser?(u=this._config.sgConfiguration.networkProviderConfiguration.restConfig,c=this._configCallGwProvider._host,l=this._csgwProviderFactory.getCSGCallsProvider(c),d=new f.Config.ServerInfo(u.hostName,u.port,u.isSecure,u.path),C=this._config.sgConfiguration.credentialProvider.getDisplayName()):f.Base.Utils.isDefined(e._callCreationInfo)&&f.Base.Utils.isDefined(e._callCreationInfo.getServiceGatewayURL())&&(u=e._callCreationInfo.getServiceGatewayURL(),h=f.Base.Utils.parseUrl(u),c=f.Base.Utils.getHost(h),l=this._csgwProviderFactory.getCSGCallsProvider(c),u=c.split(":"),d=new f.Config.ServerInfo(u[0],u[1],h.isSecure,h.path),h=e._callCreationInfo.getAuthorizationToken(),C=e._callCreationInfo.getMeetMeUserName()),l?l._started&&!l._isExternalGateway?(f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Guest user cannot be assigned non external gateway provider"),_.reject("CANNOT assign guest to non external gateway provider")):this._getGatewayCalls(e,c).length||l._isExternalGateway?this._startNewCall(e,t,i,a,r,s,n,_,l,o):this._startExternalGwCall(l,d,C,h,e,t,i,a,r,s,n,_,o):this._startNewCall(e,t,i,a,r,s,n,_,T,o),_.promise()},e.prototype._startExternalGwCall=function(e,t,i,a,r,s,n,o,c,l,d,C,u){var h=new f.Config.SGConfiguration;a!==T?h.credentialProvider=new f.Config.CredentialTokenProvider(a,f.Config.Authentication.TokenType.ESGTOKEN):(h.credentialProvider=new f.Config.GuestCredentialProvider(i),h.credentialProvider.username=this._config.sgConfiguration.credentialProvider.username),h.enabled=!0,h.networkProviderConfiguration=new f.Config.NetworkProviderConfiguration,h.networkProviderConfiguration.restConfig=t,this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.maxCallStartReconnectionAttempts?h.maxCallStartReconnectionAttempts=this._config.sgConfiguration.maxCallStartReconnectionAttempts:h.maxCallStartReconnectionAttempts=-1,this._startCallGwProvider(e,h,!1,d,!0).then(function(){this.isNailedUpVideoConnectionRequired()&&!this.isServerSupportsNailedUpVideoConnection()?C.reject():(this._startNewCall(r,s,n,o,c,l,d,C,e,u),C.resolve())}.bind(this),function(e){C.reject(e)})},e.prototype._startNewCall=function(e,t,i,a,r,s,n,o,c,l){this._createCPCall(e,T,T,n,c).startCall(r,s,t,i,a,l),o.resolve()},e.prototype._createCPCall=function(e,t,i,a,r){r=f.Base.Utils.isDefined(r)?r:this._configCallGwProvider,a=new f.Providers.Call.CPCall(e,this,r,a);return a.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),a.callId=t,a.incomingCallInfo=i,e&&(a.backgroundBlur=e.isBackgroundBlur(),a.backgroundImage=e.getBackgroundImage()),a},e.prototype.updateCpCall=function(e,t){e.call.getCallId()!==t&&(delete this._cpCalls[e.call.getCallId()],e.call._setCallId(t),this._cpCalls[t]=e)},e.prototype.updateVideoResolution=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.updateVideoResolution(e,a,t)}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.updateDevices=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){if(i.isMPaaSCollabCall())return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.updateDevice(e,a,t)}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.startContentVideoSharing=function(e,t){var i=this._cpCalls[e];if(i){e=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice();return i.startContentVideoSharing(t,e)}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.stopContentVideoSharing=function(e){e=this._cpCalls[e];return e?e.stopContentVideoSharing():S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.updateAudioSourceForVideoSharing=function(e,t){e=this._cpCalls[e];return e?e.updateAudioSourceForVideoSharing(t):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.stopCall=function(e,t){var i=S.Deferred(),a=this._cpCalls[e.getCallId()];return a?(a.end(t),this.stopExternalGatewayProvider(e).always(function(){i.resolve()})):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.stopExternalGatewayProvider=function(e){var t,i,a=S.Deferred();return e._isGuestUser&&f.Base.Utils.isUndefined(e._sessionId)?i=this._configCallGwProvider._host:e._callCreationInfo!==T&&e._callCreationInfo.getServiceGatewayURL()!==T&&e._callCreationInfo.getAuthorizationToken()!==T&&(t=e._callCreationInfo.getServiceGatewayURL(),t=f.Base.Utils.parseUrl(t),i=f.Base.Utils.getHost(t)),i&&0===this._getGatewayCalls(e,i).length?this._stopCallGwProvider(a,i):a.reject(),a.promise()},e.prototype.isExternalGatewayCall=function(e,t){var i;return e._isGuestUser?i=this._configCallGwProvider._host:e._callCreationInfo&&f.Base.Utils.isDefined(e._callCreationInfo.getServiceGatewayURL())&&f.Base.Utils.isDefined(e._callCreationInfo.getAuthorizationToken())&&(e=e._callCreationInfo.getServiceGatewayURL(),e=f.Base.Utils.parseUrl(e),i=f.Base.Utils.getHost(e)),t===i},e.prototype.accept=function(e,t,i){var a=S.Deferred(),r=this._cpCalls[e.getCallId()];return r?(r.call.getVideoChannels().length||this.setVideoMode(e,f.Services.Call.VideoMode.DISABLE,i,!1),r.acceptCall(t,i),a.resolve()):a.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),a.promise()},e.prototype.acceptSendVideo=function(e,t,i){var a=this._cpCalls[e.getCallId()];if(a){if(a.isMPaaSCollabCall())return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var r,e=a.call.getVideoChannels();return 0<e.length?(e[0]._setRequestedDirection(f.Providers.Call.Utils.getVideoDirection(i)),r=e[0]):(r=this._createVideoChannel_VideoMode(i),a.call.getVideoChannels().push(r)),this.triggerVideoChannelUpdate(a.call),a.acceptSendVideo(t,r)}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.denySendVideo=function(e){var t=S.Deferred(),e=this._cpCalls[e.getCallId()];if(e){if(e.isMPaaSCollabCall())return t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));e.denySendVideo(),t.resolve()}else t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND));return t.promise()},e.prototype.registerIncomingOrRemoteCall=function(e){var t,i=this._cpCalls[e.getCallId()];i&&(f.Base.Utils.isUndefined(e.getAudioChannel())&&(t=this.createAudioChannel_AudioMode(f.Services.Call.AudioMode.SEND_RECEIVE),e._audioChannel=t),i.call=e,this.registerCall(e.getCallId(),e,i))},e.prototype.getCalls=function(e){return f.Base.Utils.isDefined(e)?this._csgwProviderFactory.getCSGCallsProvider(e).getCalls():S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getClients=function(e){return f.Base.Utils.isDefined(e)?this._csgwProviderFactory.getCSGCallsProvider(e).getClients():S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getCall=function(e,t){return f.Base.Utils.isDefined(t)?this._csgwProviderFactory.getCSGCallsProvider(t).getCall(e):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getClient=function(e,t){return f.Base.Utils.isDefined(t)?this._csgwProviderFactory.getCSGCallsProvider(t).getClient(e):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.lookupCall=function(e){return this._cpCalls.hasOwnProperty(e)?this._cpCalls[e].call:T},e.prototype.muteAudio=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.muteAudio(),e.isConference()&&e.getConference()._sendLocalMuteEvent(!0),S.Deferred().resolve().promise()):(this._pendingAudioMuteState=e._audioMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.unmuteAudio=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.unmuteAudio(),e.isConference()&&e.getConference()._sendLocalMuteEvent(!1),S.Deferred().resolve().promise()):(this._pendingAudioMuteState=e._audioMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.muteVideo=function(e){var t=this._cpCalls[e.getCallId()];return t?t.muteVideo():(this._pendingVideoMuteState=e._videoMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.unmuteVideo=function(e){var t=this._cpCalls[e.getCallId()];return t?t.unmuteVideo():(this._pendingVideoMuteState=e._videoMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.muteSpeaker=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.muteSpeaker(),S.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=e._speakerMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.unmuteSpeaker=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.unmuteSpeaker(),S.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=e._speakerMuteState,S.Deferred().resolve("Queued").promise())},e.prototype.hold=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.hold();S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.unhold=function(e){e=this._cpCalls[e.getCallId()];return e?e.unhold():S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.transfer=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.transfer(t):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.attendedTransfer=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.attendedTransfer(t.getCallId()):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.join=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.join(t):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.sendDTMF=function(e,t){var i=S.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(e.sendDTMF(t),i.resolve()):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.setVideoMode=function(e,t,i,a){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"setVideoMode direction: "+t);var r,s=this._cpCalls[e.getCallId()];return 0===e.getVideoChannels().length&&(r=this._createVideoChannel_VideoMode(e,t),t===f.Services.Call.VideoMode.DISABLE&&(e.isIncoming()?r._setVideoDisabledReason(f.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER):r._setVideoDisabledReason(f.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),e._videoChannels.push(r)),f.Base.Utils.isDefined(s)&&e.getState()!==f.Services.Call.CallStates.IDLE&&e.getState()!==f.Services.Call.CallStates.ALERTING&&e.getState()!==f.Services.Call.CallStates.IGNORED?s.updateVideoMode(t,i,a):(this.triggerVideoChannelUpdate(e),S.Deferred().resolve())},e.prototype.setVideoSendResolution=function(e,t){return this._cpCalls[e.getCallId()].setVideoSendResolution(t)},e.prototype.getVideoSendBandwidth=function(e){return this._cpCalls[e.getCallId()].getVideoSendBandwidth()},e.prototype.getVideoBandwidth=function(e){return this._cpCalls[e.getCallId()].getVideoBandwidth()},e.prototype.getVideoResolution=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.getVideoResolution()},e.prototype.getVideoSendResolution=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.getVideoSendResolution()},e.prototype.hasVideoTracks=function(e){if(f.Base.Utils.isDefined(e)){e=this._cpCalls[e.getCallId()];if(e)return e.hasVideoTracks()}return!1},e.prototype.setAudioMode=function(e,t){var i,a,r=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e.getAudioChannel())||(a=this.createAudioChannel_AudioMode(t),e._audioChannel=a),f.Base.Utils.isDefined(r)?(i=S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.FAILED)),f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"set audio is not supported")):(f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"audio is set: "+t),i=S.Deferred().resolve()),i},e.prototype.setWebCollaboration=function(e,t){var i,e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(i=S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.FAILED)),f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"set web collaboration is not supported")):(f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"web collaboration is set: "+t),i=S.Deferred().resolve()),i},e.prototype.addParticipantFromCall=function(e,t){var i=this._cpCalls[e];if(f.Base.Utils.isDefined(i)){if(i.call.getConference().getAddParticipantFromCallCapability(t).isAllowed){e=t.getCallId();return this._consultConferencePromises[e]=S.Deferred(),i.addParticipantFromCall(t),this._consultConferencePromises[e]}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}return S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.getCallStatistics=function(e){var t,i=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(i)?(t=e.getAudioChannel(),e=e.getVideoChannels(),t=!!t&&t.getRequestedDirection()!==f.Services.Call.MediaDirection.DISABLE&&t._getNegotiatedDirection()!==f.Services.Call.MediaDirection.DISABLE,e=!!e&&0!==e.length&&e[0].getRequestedDirection()!==f.Services.Call.MediaDirection.DISABLE&&e[0].getNegotiatedDirection()!==f.Services.Call.MediaDirection.DISABLE,t||e?i.getCallStatistics():S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.STATISTICS_UNAVAILABLE)).promise()):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype._triggerEndCalls=function(e){for(var t in this._cpCalls)!this._cpCalls.hasOwnProperty(t)||this._cpCalls[t]._callGatewayProvider._host!==e&&e||((t=this._cpCalls[t]).stopAllStreams(),this.unRegisterCall(t.call)&&this._triggerAsyncEndCall(t.call))},e.prototype._triggerAsyncEndCall=function(e){setTimeout(function(){this.triggerCallEnded(e)}.bind(this),0)},e.prototype.getMediaServiceFactory=function(){return this._mediaServiceFactory},e.prototype.startRinging=function(e){var t=S.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(e.startRinging(),t.resolve()):t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),t.promise()},e.prototype.acceptAnswerCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},e.prototype.acceptUpdateCallRequest=function(e,t){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,t)},e.prototype.acceptTerminateCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},e.prototype.acceptMakeCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},e.prototype._acceptCallRequest=function(e,t,i){var a=S.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?e.acceptCallRequest(a,t,i):a.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),a.promise()},e.prototype.rejectAnswerCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},e.prototype.rejectUpdateCallRequest=function(e,t){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED)},e.prototype.rejectTerminateCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},e.prototype.rejectMakeCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},e.prototype._rejectCallRequest=function(e,t){var i=S.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?e.rejectCallRequest(i,t):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.getOfferSDP=function(e,t,i,a,r,s,n,o){var c=this._cpCalls[e];c&&c.isReadyToReceiveMediaRequest()?c.getOfferSDP(t,i,a,r,T,T,s,n,o):this._sdpMediaOfferNotifications[e]={action:t,audioStream:i,videoStreams:a,videoBandwidth:r,turnData:s,restartTurnGathering:n,useIPv6Candidates:o}},e.prototype.getQueuedMediaOfferNotification=function(e){var t=this._sdpMediaOfferNotifications[e];return t&&delete this._sdpMediaOfferNotifications[e],t},e.prototype.getQueuedCallFailure=function(e){var t=this._callFailureNotificationsQueue[e];return t&&delete this._callFailureNotificationsQueue[e],t},e.prototype.getQueuedVideoMuteState=function(){var e=this._pendingVideoMuteState;return this._pendingVideoMuteState=T,e},e.prototype.getQueuedAudioMuteState=function(){var e=this._pendingAudioMuteState;return this._pendingAudioMuteState=T,e},e.prototype.getQueuedSpeakerMuteState=function(){var e=this._pendingSpeakerMuteState;return this._pendingSpeakerMuteState=T,e},e.prototype.queueCallEstablishedNotification=function(e,t,i,a,r,s,n,o,c,l,d,C){this._callEstablishedNotificationsQueue[e]={address:t,displayName:i,audioStream:a,videoStreams:r,isConference:s,uccpUrl:n,webCollabUrl:o,ucid:l,parentUcid:d,contextId:C}},e.prototype.getQueuedCallEstablishedNotification=function(e){var t=this._callEstablishedNotificationsQueue[e];return t&&delete this._callEstablishedNotificationsQueue[e],t},e.prototype.offerSDP=function(e,t,i,a,r,s,n){var o=this._cpCalls[e];o&&o.isReadyToReceiveMediaRequest()?o.offerSDP(i,t,a,r,s,n):this._sdpMediaOfferNotifications[e]={action:t,audioStream:a,videoStreams:r,offer:i,videoBandwidth:s,turnData:n}},e.prototype.callRinging=function(e,t,i,a,r,s,n,o,c,l,d,C){var u=this._cpCalls[e];u?(u.call._isEarlyMedia&&!n&&this.stopEarlyMedia(u.call),u.callRinging(t,i,a,r,s,n,o,c,l,d,C)):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.answerSDP=function(e,t,i,a,r,s){var n=this._cpCalls[e];n?n.answerSDP(i,t,a,r,s):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.answerSdpAck=function(e,t,i,a){var r=this._cpCalls[e];r?r.answerSdpAck(t,i,a):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.callEstablished=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g){var S=this._cpCalls[e];if(f.Base.Utils.isDefined(c)&&this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[c]),S)f.Base.Utils.isDefined(v)?S.callEstablished(t,i,l,d,C,u,h,r,v,p,g):S.callEstablished(t,i,l,d,C,u,h,r);else{if(!r)return f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Queue established because call is not found: ",e),void this.queueCallEstablishedNotification(e,t,i,l,d,C,u,h,_,v,p,g);this._isWebRTCSupportedBrowser()?(_={remoteAddress:t,remoteDisplayName:i,isAuraAsserted:o,isPrivate:s,alertType:n,audioStream:l,videoStreams:d,videoResolution:l=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(_,this._videoResolution)||this._videoResolution},S=this._createCPCall(null,e,_,l),this.isSolutionSupportsNailedUpConnection()&&S.setNailedUpVideoConnectionSupported(!0),this._cpCalls[e]=S,this.triggerRemoteCallCreated(e,t,i,o,s,this._isVideoCall(d),n,a)):f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Remote call is not supported: ",e)}},e.prototype.callEndedRemotely=function(e,t){var i=this._cpCalls[e];i?i.callEndedRemotely(t):f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.callStateFailure=function(e,t){e=this._cpCalls[e];e&&e.callStateFailure(t)},e.prototype.callFailure=function(e,t,i,a,r){var s=this._cpCalls[e];s?s.callFailure(t,i,a,r):this._callFailureNotificationsQueue[e]={errorCode:t,protocolType:i,protocolErrorCode:a,failureReason:r}},e.prototype.stopEarlyMedia=function(e){var t,i=this._cpCalls[e];i?(t=this.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),i.stopEarlyMedia(t)):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.triggerCallStarted=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,[e])},e.prototype.triggerCallRinging=function(e,t,i,a,r){t=!!f.Base.Utils.isDefined(t)&&t;this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,[e,t,i,a,r])},e.prototype.triggerCallEstablished=function(e,t,i,a,r,s,n,o){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,[e,t,r,s,n,o]),this.triggerConferenceEscalation(e,i,a,t)},e.prototype.triggerCallEstablishing=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,[e])},e.prototype.triggerRemoteStreamAdded=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_STREAM_ADDED,[e,t])},e.prototype.triggerCallEnded=function(e,t,i){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,[e,t,i])},e.prototype.triggerRemoteCallCreated=function(e,t,i,a,r,s,n,o){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,[e,t,i,a,r,s,n,o])},e.prototype.triggerIncomingCall=function(e,t,i,a,r,s,n,o,c,l,d,C){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,[e,t,i,a,r,s,n,o,c,l,d,C])},e.prototype.triggerIncomingAddVideoRequest=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,[e,t])},e.prototype.triggerIncomingAddVideoAccepted=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,[e])},e.prototype.triggerIncomingAddVideoDenied=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,[e])},e.prototype.triggerIncomingAddVideoTimedout=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,[e])},e.prototype.triggerVideoChannelUpdate=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,[e])},e.prototype.triggerConferenceEscalation=function(e,t,i,a){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,[e,t,i,a])},e.prototype.triggerVideoEscalationRejected=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_ESCALATION_REJECTED,[e])},e.prototype.triggerCallFailure=function(e,t,i,a,r){e=this._cpCalls[e];e&&this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[e.call,t,i,a,r])},e.prototype.triggerCallServiceUnavailable=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[e])},e.prototype.triggerRemoteHold=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,[e])},e.prototype.triggerRemoteUnhold=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,[e])},e.prototype.triggerRemoteAddressChanged=function(e,t,i,a,r,s){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,[e,t,i,a,r,s])},e.prototype.triggerAllowedNailedUpVideoModes=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,[e,t])},e.prototype.triggerMediaConnectionUpdate=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,[e,t])},e.prototype.triggerCallMediaFailed=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,[e])},e.prototype.triggerMediaRecoveryInitiated=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,[e])},e.prototype.registerCall=function(e,t,i){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"register call: "+e),t._setCallId(e),this._cpCalls[e]=i},e.prototype.unRegisterCall=function(e){if(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"unregister call: "+e.getCallId());var t=this._cpCalls[e.getCallId()];if(t)return t.cleanupImmediately(),delete this._cpCalls[e.getCallId()],!0}return!1},e.prototype.isVideoConfigurationEnabled=function(){return this._config.callUserConfiguration.videoEnabled},e.prototype._callRingingHandler=function(e,t,i,a,r,s,n,o,c,l,d,C){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Ringing"),this.callRinging(e,t,i,a,r,s,n,o,c,l,d,C)},e.prototype._callEstablishedHandler=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Established"),this.callEstablished(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S)},e.prototype._createMediaRequestHandler=function(e,t,i,a,r,s,n){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Create Media Request"),this.getOfferSDP(e,t,i,a,r,s,!1,n)},e.prototype._remoteCallEndedHandler=function(e,t){var i="Received Remote Call Ended";t&&(i=i+": ["+t.getProtocol()+","+t.getCause()+","+t.getText()+"]"),f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,i),this.callEndedRemotely(e,t)},e.prototype._incomingCallHandler=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p){var g=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(C,this._videoResolution)||this._videoResolution;f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Received Incoming Call");v={remoteAddress:t,remoteDisplayName:i,isAuraAsserted:a,isPrivate:r,alertType:s,sdp:o,audioStream:c,videoStreams:l,turnData:v},g=this._createCPCall(null,e,v,g);g.determineIfNailedUpVideoConnectionSupported(l),g._isReadyToReceiveMediaRequest=!0,g._updateVideoBandwidth(C),this._cpCalls[e]=g,this.triggerIncomingCall(e,t,i,a,r,this._isVideoCall(l),s,d,u,h,_,p)},e.prototype._callFailureHandler=function(e,t,i,a,r){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Failure: ["+t+":"+i+":"+a+":"+r+"]"),this.callFailure(e,t,i,a,r)},e.prototype._callStateFailureHandler=function(e,t,i,a,r){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call State Failure: ["+t+":"+i+":"+a+":"+r+"]"),this.callStateFailure(e,t)},e.prototype._networkFailureHandler=function(e,t,i){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Network Failure: ["+e+":"+t+":"+i+"]");var a,r,s=!1;for(a in this._cpCalls)!this._cpCalls.hasOwnProperty(a)||(r=this._cpCalls[a])&&r.call&&r._callGatewayProvider&&r._callGatewayProvider._host===e&&(r.setCallServiceAvailable(!1),this.triggerCallServiceUnavailable(r.call),this._callsAnalyticsService.sendUnavailableEvent(f.Services.Analytics.AnalyticsErrorCode.NETWORK_ERROR),s=!0);s||(this.triggerCallServiceUnavailable(),this._callsAnalyticsService.sendUnavailableEvent(f.Services.Analytics.AnalyticsErrorCode.NO_CALL_WAS_CREATED_ERROR))},e.prototype._maxNetworkRecoveryAttemptedHandler=function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Maximum Network Recover Attempted: "+e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,[e])},e.prototype._callsServiceDeactivatedHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Calls Service Deactivated: "+e+":"+t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,[e,t])},e.prototype._networkAvailabilityHandler=function(s){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Network Availability: "+s),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),this.getCalls(s).then(function(e){for(var t in this._cpCalls)if(this._cpCalls.hasOwnProperty(t)){var i=this._cpCalls[t];if(i._callGatewayProvider&&i._callGatewayProvider._host===s){for(var a=!1,r=0;r<e.length;r++)e[r].callId===t&&(a=!0,i.setCallServiceAvailable(!0),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[i.call]));a||i.triggerCallMediaFailed()}}}.bind(this),function(e){f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Failed to get list of active calls from server",e)}.bind(this))},e.prototype._callsServiceActivatedHandler=function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Calls Service Activated: "+e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,[e])},e.prototype._updateTransferStatusHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Transfer Status Update: "+t),this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e])._transferPromise.notify(t),t===f.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_DONE?e.transferCompleted():t===f.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_FAILED&&e.transferFailed())},e.prototype._updateConsultConferenceStatusHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Consult Conference Status Update: "+t),this._consultConferencePromises.hasOwnProperty(e)&&(this._consultConferencePromises[e].notify(t),t===f.Providers.Call.CallProvider.Constants.CONSULT_CONFERENCE_STATUS_DONE?(this._consultConferencePromises[e].resolve(),delete this._consultConferencePromises[e]):(t===f.Providers.Call.CallProvider.CONSULT_CONFERENCE_STATUS_FAILED||-1<t.indexOf(f.Providers.Call.CallProvider.Constants.ERROR))&&(f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Failed to add "+e+" to Consult Conference: "+t),this._consultConferencePromises[e].reject(t),delete this._consultConferencePromises[e]))},e.prototype._updateCallDataHandler=function(e,t,i,a,r,s,n,o,c){var l,d,C,u,h;f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Data Update: ["+e+":"+t+":"+i+":"+r+":"+s+":"+n+"]"),this._cpCalls.hasOwnProperty(e)&&(h=(C=(d=(l=this._cpCalls[e]).call).isConference())&&d.getConference(),u=C&&h._isConferenceStarted(),e=C&&h._isStarting,h=C?h._getType():"unknown",f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,(C?"Conference":"Non-Conference")+" Data Update: [Existing conference call? "+C+"; Is conference started? "+u+"; Is conference starting? "+e+"; Conference type="+h+"; uucpUrl="+r+"; webCollabUrl="+s+"]"),f.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(this,d,t,i,n,o,c),a&&(!C||C&&!u&&!e||r||s)&&l.hasReceivedCallEstablishedEvent()&&this.triggerConferenceEscalation(l.call,r,s,a))},e.prototype._iceConfigUpdatesHandler=function(e){if(e&&0<e.length){this._rtcConfiguration={iceServers:[{urls:""}]};if(1===e.length)this._rtcConfiguration.iceServers[0].urls="stun:"+e[0];else{for(var t=[],i=0;i<e.length;i++)t.push("stun:"+e[i]);this._rtcConfiguration.iceServers[0].urls=t}}},e.prototype._videoLicenseUpdatedHandler=function(e){this._updateVideoLicense(e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,[e])},e.prototype._createVideoChannel_VideoMode=function(e,t){e=new f.Services.Call.VideoChannel(e);return e._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),e._setRequestedDirection(f.Providers.Call.Utils.getVideoDirection(t)),e},e.prototype.createAudioChannel_AudioMode=function(e){var t=new f.Services.Call.AudioChannel;return t._setRequestedDirection(f.Providers.Call.Utils.getAudioDirection(e)),t},e.prototype.createVideoChannel_MediaDirection=function(e,t){e=new f.Services.Call.VideoChannel(e);return e._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),e._setRequestedDirection(t),e},e.prototype.hasVideoDevices=function(){return this._mediaServiceFactory.getVideoInterface().hasAvailableDevices()},e.prototype.isNailedUpVideoConnectionRequired=function(){return this._browserType===f.Base.BrowserType.EDGE},e.prototype.isServerSupportsNailedUpVideoConnection=function(){return!f.Base.Utils.isDefined(this._isServerSupportsNailedUpVideoConnection)||this._isServerSupportsNailedUpVideoConnection},e.prototype.isSolutionSupportsNailedUpConnection=function(){return this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()},e.prototype.isVideoAllowed=function(){return this._isVideoAllowed},e.prototype._isVideoCall=function(e){if(f.Base.Utils.isDefined(e)&&0<e.length&&e[0].enabled){var t=e[0].direction;return this.isSolutionSupportsNailedUpConnection()?!f.Services.Call.MediaDirection._isDisabled(t)&&e[0].logicalDirection!==f.Services.Call.MediaDirection.INACTIVE:!f.Services.Call.MediaDirection._isDisabled(t)&&t!==f.Services.Call.MediaDirection.INACTIVE}return!1},e.prototype._ringbackToneURLsChangedHandler=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,[e])},e.prototype._isBrowserSupported=function(){var e=f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers");return f.Base.Utils.isWebRTC_SupportedBrowser(e)},e.prototype._isTurnTlsHasHighestPriority=function(){return f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._setTurnTlsToHighestPriority")},e.prototype._answerCallRequestedHandler=function(e,t){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,[e.call]))},e.prototype._terminateCallRequestedHandler=function(e,t){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,[e.call]))},e.prototype._updateCallRequestedHandler=function(e,t,i){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,[e.call,i]))},e.prototype._makeCallRequestedHandler=function(e,t,i,a,r,s){var n=this._createCPCall(null,e,T,this._videoResolution);(this._cpCalls[e]=n).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED,i),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,[e,t,a,r,s])},e.prototype._updateVideoLicense=function(e){var t=f.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");f.Base.Utils.isDefined(t)&&(this._isVideoAllowed=this._isVideoAllowed&&t),e&&(this._isVideoAllowed=this._isVideoAllowed&&e)},e.prototype._isWebRTCSupportedBrowser=function(){var e=f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),e=f.Base.Utils.isWebRTC_SupportedBrowser(e);return this.isNailedUpVideoConnectionRequired()?e&&this.isServerSupportsNailedUpVideoConnection():e},e.prototype.setActiveCallVideoTrack=function(e){this._activeCallVideoTrack=T,this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()&&(!this._cpCalls.hasOwnProperty(e)||0<(e=this._cpCalls[e]).getVideoStreams().length&&e.localStream.getVideoTracks().forEach(function(e){e.readyState!==f.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(this._activeCallVideoTrack=e)}.bind(this)))},e.prototype.getActiveCallVideoTrack=function(){return this._activeCallVideoTrack},e.prototype._getGatewayCalls=function(t,i){return t._callService._callManager.getAllCalls().filter(function(e){return!!e.getCallId()&&(!!this._cpCalls[e.getCallId()]&&(e.getCallId()!==t.getCallId()&&this._cpCalls[e.getCallId()]._callGatewayProvider._host===i))}.bind(this))},e.prototype._getHost=function(){var e=this._config.sgConfiguration.networkProviderConfiguration.restConfig,t=e.isSecure?f.Base.Utils.isDefined(e.port)?e.port:"443":f.Base.Utils.isDefined(e.port)?e.port:"80";return e.hostName+":"+t},e.prototype._getCsgCallsProvider=function(){var e=this._getHost();return this._csgwProviderFactory.getCSGCallsProvider(e)},e.prototype.setOnNetworkEvents=function(e,t){var i=this._getMediaServiceSessionId();if(!i){var a=new f.Services.Call.CallException(f.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE);return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,a),S.Deferred().reject(a).promise()}e={sessionId:i,acceptedEvents:e};return this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.setOnNetworkEvents(e,t)},e.prototype.isNetworkEventsUrlDefined=function(){var e=!1;return this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(this._csgCallsProvider=this._getCsgCallsProvider(),e=this._csgCallsProvider.isNetworkEventsUrlDefined()),e},e.prototype.removeOnNetworkEvents=function(){var e=this._getMediaServiceSessionId();if(e)return this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.removeOnNetworkEvents(e);e=new f.Services.Call.CallException(f.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE);return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,e),S.Deferred().reject(e).promise()},e.prototype._getMediaServiceSessionId=function(){var e;return e=this._config._mediaServiceConfiguration?this._config._mediaServiceConfiguration.sessionId:e},e.prototype.isMediaConnected=function(e){e=this._cpCalls[e.getCallId()];return!!e&&e.isMediaConnected()},e.prototype.updatePreferredResolution=function(e,t){var i=this._cpCalls[e._call.getCallId()];return i===T?S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)):i.updatePreferredResolution(e,t)},e.prototype.setPreferredReceiveResolution=function(e,t,i){e=this._cpCalls[e.getCallId()];return e?e.setPreferredReceiveResolution(t,i):S.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype._onPerformanceMonitorAlert=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,[e,t])},e.prototype.setBackgroundBlur=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.setBackgroundBlur(t,e,a)}return S.Deferred().resolve().promise()},e.prototype.setBackgroundImage=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.setBackgroundImage(t,e,a)}return S.Deferred().resolve().promise()},f.Providers.Call.CallProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallProvider.Constants={DISABLE_STATE:"DISABLE",ENABLE_STATE:"ENABLE",ERROR:"ERROR",ADD_VIDEO:"ADD_VIDEO",UPDATE_VIDEO:"UPDATE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",HOLD:"HOLD",INCOMING_UNHOLD:"INCOMING_UNHOLD",UNHOLD:"UNHOLD",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",ADD_PARTICIPANT_ACTION:"ADD_PARTICIPANT",ADD_VIDEO_ACTION:"ADD_VIDEO",HOLD_ACTION:"HOLD",UNHOLD_ACTION:"UNHOLD",INCOMING_ADD_VIDEO_ACTION:"INCOMING_ADD_VIDEO",INCOMING_REMOVE_VIDEO_ACTION:"INCOMING_REMOVE_VIDEO",INCOMING_UPDATE_VIDEO_ACTION:"INCOMING_UPDATE_VIDEO",INCOMING_HOLD_ACTION:"INCOMING_HOLD",INCOMING_UNHOLD_ACTION:"INCOMING_UNHOLD",TRANSFER_ACTION:"TRANSFER",TRANSFER_STATUS_DONE:"DONE",TRANSFER_STATUS_FAILED:"FAILED",CONSULT_CONFERENCE_STATUS_DONE:"DONE",CONSULT_CONFERENCE_STATUS_FAILED:"FAILED",END_CALL_BY_REMOTE:"remote",END_CALL_NORMAL:"normal",END_CALL_DENY_WITH_REASON:"denyWithReason",INITIAL_MEDIA:"INITIAL_MEDIA",DEFAULT_CALL_GW_PROVIDER:"DefaultCallGWProvider",ANSWER_CALL_REQUESTED:"AnswerCallRequested",MAKE_CALL_REQUESTED:"MakeCallRequested",TERMINATE_CALL_REQUESTED:"TerminateCallRequested",UPDATE_CALL_REQUESTED:"UpdateCallRequested",ICE_CANDIDATE_TYPE_RELAY_ONLY:"relayOnly",ICE_CANDIDATE_TYPE_HOST_ONLY:"hostOnly"}}(),function(e){"use strict";var t=e.Providers.Call.States={};t.INITIAL=new e.Base.SimpleFsm.SimpleFsmState("INITIAL"),t.STARTING=new e.Base.SimpleFsm.SimpleFsmState("STARTING"),t.ALERTING=new e.Base.SimpleFsm.SimpleFsmState("ALERTING"),t.MEDIA_RECOVERY=new e.Base.SimpleFsm.SimpleFsmState("MEDIA_RECOVERY"),t.ACTIVE=new e.Base.SimpleFsm.SimpleFsmState("ACTIVE"),t.ACTIVE_RENEGOTIATE=new e.Base.SimpleFsm.SimpleFsmState("ACTIVE_RENEGOTIATE"),t.FAILED=new e.Base.SimpleFsm.SimpleFsmState("FAILED"),t.ENDING=new e.Base.SimpleFsm.SimpleFsmState("ENDING"),t.ENDED=new e.Base.SimpleFsm.SimpleFsmState("ENDED")}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this._username=e,this._credential=t,this._address=i,this._transportTypes=a,this._iceTransportPolicy=r||"relay",this._expiryTime=s}t.prototype={getUsername:function(){return this._username},getCredential:function(){return this._credential},getAddress:function(){return this._address},getTransportTypes:function(){return this._transportTypes},getIceTransportPolicy:function(){return this._iceTransportPolicy},getExpiryTime:function(){return this._expiryTime}},e.Providers.Call.TurnData=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._address=e,this._protocol=t,this._transport=i,this._port=a,this._transportPrecedence=0,this._tlsHasHighestPriority=!1}t.prototype={getProtocol:function(){return this._protocol},getTransport:function(){return this._transport},getPort:function(){return this._port},getUrl:function(){return this._protocol+":"+this._address+":"+this._port+"?transport="+this._transport},_setTlsToHighestPriority:function(e){this._tlsHasHighestPriority=e},getTransportPrecedence:function(){if("udp"===this._transport)return 3;if("tcp"!==this._transport)return 0;var e=this._tlsHasHighestPriority?100:1;return"turn"===this._protocol?2:e}},e.Providers.Call.TurnTransportType=t}(AvayaClientServices),function(d){"use strict";d.Providers.Call.Utils={updateVideoSdp:function(e,t){switch(e.direction){case d.Services.Call.MediaDirection.SEND_ONLY:return d.Base.SDPUtil.updateVideoSdpSendOnly(t);case d.Services.Call.MediaDirection.SEND_RECV:return d.Base.SDPUtil.updateVideoSdpSendRecv(t);case d.Services.Call.MediaDirection.RECV_ONLY:return d.Base.SDPUtil.updateVideoSdpRecvOnly(t);default:return d.Base.SDPUtil.updateVideoSdpInactive(t)}},updateAudioSdp:function(e,t){switch(e.direction){case d.Services.Call.MediaDirection.SEND_ONLY:return d.Base.SDPUtil.updateAudioSdpSendOnly(t);case d.Services.Call.MediaDirection.SEND_RECV:return d.Base.SDPUtil.updateAudioSdpSendRecv(t);case d.Services.Call.MediaDirection.RECV_ONLY:return d.Base.SDPUtil.updateAudioSdpRecvOnly(t);default:return d.Base.SDPUtil.updateAudioSdpInactive(t)}},updateAndTriggerRemoteAddressChangedIfNeeded:function(e,t,i,a,r,s,n){var o=d.Base.Utils.isDefined(a)&&t.getRemoteDisplayName()!==a,c=d.Base.Utils.isDefined(i)&&t.getRemoteAddress()!==i,l=t.getUserToUserInfo(),l=d.Base.Utils.isDefined(r)&&(d.Base.Utils.isUndefined(l)||l.getUCID()!==r);(c||o||l)&&e.triggerRemoteAddressChanged(t,i,a,r,s,n)},getVideoDirection:function(e){switch(e){case d.Services.Call.VideoMode.SEND_RECEIVE:return d.Services.Call.MediaDirection.SEND_RECV;case d.Services.Call.VideoMode.SEND_ONLY:return d.Services.Call.MediaDirection.SEND_ONLY;case d.Services.Call.VideoMode.RECEIVE_ONLY:return d.Services.Call.MediaDirection.RECV_ONLY;case d.Services.Call.VideoMode.INACTIVE:return d.Services.Call.MediaDirection.INACTIVE;case d.Services.Call.VideoMode.DISABLE:return d.Services.Call.MediaDirection.DISABLE;default:return d.Services.Call.MediaDirection.UNDEFINED}},getAudioDirection:function(e){switch(e){case d.Services.Call.AudioMode.SEND_RECEIVE:case d.Services.Call.AudioMode.ENABLE:return d.Services.Call.MediaDirection.SEND_RECV;case d.Services.Call.AudioMode.DISABLE:return d.Services.Call.MediaDirection.DISABLE;default:return d.Services.Call.MediaDirection.UNDEFINED}},getVideoMode:function(e){switch(e){case d.Services.Call.MediaDirection.SEND_RECV:return d.Services.Call.VideoMode.SEND_RECEIVE;case d.Services.Call.MediaDirection.SEND_ONLY:return d.Services.Call.VideoMode.SEND_ONLY;case d.Services.Call.MediaDirection.RECV_ONLY:return d.Services.Call.VideoMode.RECEIVE_ONLY;case d.Services.Call.MediaDirection.INACTIVE:return d.Services.Call.VideoMode.INACTIVE;default:return d.Services.Call.VideoMode.DISABLE}}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._protocol=e,this._cause=t,this._text=i}t.prototype={getProtocol:function(){return this._protocol},getCause:function(){return this._cause},getText:function(){return this._text},_setCause:function(e){this._cause=e},_setProtocol:function(e){this._protocol=e}},e.Providers.Call.CallReason=t}(AvayaClientServices),function(u){"use strict";var n=window.AudioContext||window.webkitAudioContext;function e(e,t,i,a){this._callGatewayProvider=i,this._callProvider=t,this.call=e,this.localStream=null,this.remoteStream=null,this.remote=!1,this.callId=null,this.incomingCallInfo={},this.incomingVideoRequestTimer=T,this.mediaTransactionDfd=T,this.noMediaTransactionDfd=T,this._mediaTransactionInitialEvent=T,this.audioStream=null,this.videoStreams=[],this._videoChannelId=T,this._audioDevice=T,this._videoDevice=T,this._videoSharingStream=T,this._videoSharingAudioContext=T,this._videoSharingAudioConstraints=T,this._videoSharingMicrophoneGainNode=T;var r=t._config?t._config.callUserConfiguration.turnRelayCandidatesGatheringTimeout:5e3,i=t._config?t._config.callUserConfiguration.iceCandidatesGatheringTimeout:15e3,e=t._config?t._config.callUserConfiguration.iceConnectionRestartInterval:5e3;this._rtConnection=t._rtcConnectionProviderFactory.create(t._rtcConfiguration,r,i,e,3e5),this._rtcConfiguration=t._rtcConfiguration,this._transferPromise=T,this._joinRemotePromise=T,this._isEarlyMedia=!1,this._videoResolution=a,this._videoBandwidth=T,this._videoSendResolution=T,this._maxVideoResolution=a,this._activeRenegotiateEventQueue=[],this._queuedRemoteCallEstablishedEvent=T,this._isReadyToReceiveMediaRequest=!1,this._3pccRequestTransactionMap={},this._mediaAction=T,this._prevMediaAction=T,this._latestVideoModeDirection=T,this._latestNonHoldingVideoDirection=T,this._isNailedUpVideoConnectionSupported=!1,this._isRingingStarted=!1,this._isCallServiceAvailable=!0,this._iceConnectionRestartTimestamp=T,this._iceRestartTransactionDfd=T,this._iceRestartRelayType="",this._iceRestartAttempts=0,this._selectedCandidatePairChangedTimerId=T,this._selectedCandidatePairChangedTimestamp=T,this._serviceAvailableIceRecoveryTimerId=T,this._pendingVideoMuteUnmuteFunctor=T,this._hasReceivedCallEstablishedEvent=!1,this._hasLoggedRelayICECandidates=!1,this._isMPaaSCollabCall=!1,this._videoStatsInterval=T,this._videoStatsTimer=T,this._videoStatsFloatingWindow=[],this._avgVideoEncodeMs=0,this._avgVideoDecodeMs=0,this._isMediaConnected=!1,this._hadMediaConnected=!1,this._hasInitiatedMediaConnection=!1,this._iceRestartInProgress=!1,this._hasTriggeredMediaFailed=!1,this._initialGetOfferEvent=T,this._browserType=u.Base.Utils.getBrowserType(),this._runtimePerformanceMonitor=new u.Base.RuntimePerformanceMonitor(t._config),this.onPerformanceMonitorAlert=function(){},this.backgroundImage=T,this.backgroundBlur=!1,this._getOfferSDPEventInMultipleHandler=new u.Providers.Call.GetOfferSDPEventInMultipleHandler,this._offerSDPEventInMultipleHandler=new u.Providers.Call.OfferSDPEventInMultipleHandler,this._escalateVideoGetOfferEventInActiveRenegotiateHandler=new u.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler,this._escalateVideoOfferEventInActiveRenegotiateHandler=new u.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler,this._fsm=new u.Base.SimpleFsm.SimpleFsm,this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.StartCallEvent,u.Providers.Call.StartCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AcceptCallEvent,u.Providers.Call.AcceptCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.JoinRemoteCallEvent,u.Providers.Call.JoinRemoteCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.StartRingingEvent,u.Providers.Call.StartRingingEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.StartCallResponseEvent,u.Providers.Call.StartCallResponseEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.GetOfferSDPEvent,u.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OfferSDPEvent,u.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallRingingEvent,u.Providers.Call.CallRingingEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdateLocalStreamEvent,u.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.StartContentVideoSharingEvent,u.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallRingingEvent),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SendDTMFEvent,u.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.GetOfferSDPEvent,u.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OfferSDPEvent,u.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnRemoveRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallStateFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.BlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SendDTMFEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingAddVideoEvent,u.Providers.Call.IncomingAddVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingRemoveVideoEvent,u.Providers.Call.IncomingRemoveVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingAddVideoTimedoutEvent,u.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AcceptSendVideoEvent,u.Providers.Call.AcceptSendVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DenySendVideoEvent,u.Providers.Call.DenySendVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.BlockCameraEvent,u.Providers.Call.BlockCameraEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.UnBlockCameraEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.EscalateVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.EscalateNailedUpVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.DeEscalateVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RejectOfferSDPEvent,u.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SendDTMFEvent,u.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateRemoteVideoEvent,u.Providers.Call.UpdateRemoteVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.HoldEvent,u.Providers.Call.HoldEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnHoldEvent,u.Providers.Call.UnHoldEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateLocalStreamEvent,u.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.StartContentVideoSharingEvent,u.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.StopContentVideoSharingEvent,u.Providers.Call.StopContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateContentVideoSharingAudioEvent,u.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AttendedTransferEvent,u.Providers.Call.AttendedTransferEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.TransferEvent,u.Providers.Call.TransferEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallRingingEvent,u.Providers.Call.CallRingingEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoRejectedEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AddParticipantFromExistingCallEvent,u.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingGenericOfferSDPEvent,u.Providers.Call.IncomingGenericOfferSDPEventInActive),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AudioEndedEvent,u.Providers.Call.AudioEndedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallStateFailureEvent),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RejectOfferSDPEvent,u.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AnswerSdpAckEvent,u.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoGetOfferEvent,this._escalateVideoGetOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoGetOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoAnswerEvent,u.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoRejectedEvent,u.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallStateFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.IncomingGenericOfferSDPEvent,u.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdateLocalStreamEvent,this._queueUpdateLocalStreamEvent.bind(this)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.StartContentVideoSharingEvent,this._queueStartContentVideoSharingEvent.bind(this)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.BlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AudioEndedEvent),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EndCallResponseEvent,u.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.IncomingCallEstablishedEventInEndingHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RejectOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StopContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EndCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EndCallEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallEstablishedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StopContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.start(u.Providers.Call.States.INITIAL),this._rtConnection&&(this._rtConnection.on(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,function(e){this._processIceConnectionStateChange(e)}.bind(this)),this._rtConnection.on(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,function(e){this.recoverLocalAudio()}.bind(this))),this._selectedCandidatePairChangedCallback=function(e){e&&(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected ICE candidate pair updates "+e),this._selectedCandidatePairChangedTimestamp=Date.now(),this.initiateIceRecoveryIfSelectedCandidatePairChanged())}.bind(this),u.Base.Logger.debug(u.Base.LoggerTags.CALL_PROVIDER,"Initialized CPCall")}(e.prototype={}).prepareEvent=function(e){return e.data||(e.data={}),e.data.cpCall=this,e.data.callProvider=this._callProvider,e},e.prototype.handleEvent=function(e){this.prepareEvent(e),this._fsm.handleEvent(e)},e.prototype.revertFsmState=function(e){var t=new u.Providers.Call.RevertStateEvent;t.data={state:e},this.handleEvent(t)},e.prototype.startCall=function(e,t,i,a,r,s){this._audioDevice=e,this._videoDevice=t,a=a||!1,r=r||!1,this._rtConnection&&this._rtConnection.addOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback);var n=new u.Providers.Call.StartCallEvent;n.data={remoteAddress:this.call.getRemoteAddress(),audioDevice:e,videoDevice:t,video:i,videoResolution:this._videoResolution,webCollab:a,uccp:r,nailedUpVideoConnection:s},this.handleEvent(n)},e.prototype.generateTemporarilyCallId=function(){return"temp-"+u.Base.Utils.generateUUID()},e.prototype.getOfferSDP=function(e,t,i,a,r,s,n,o,c){var l=!1;this._rtcConfiguration&&this._rtcConfiguration._expiryTime&&(l=Date.now()>=this._rtcConfiguration._expiryTime);n=this.updateIceServers(n);n&&(this._hasLoggedRelayICECandidates=!1,!o&&"relayOnly"===this.getIceRestartRelayType()&&l&&(o=!0)),this._prevMediaAction=this._mediaAction;l=new((this._mediaAction=e)===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?u.Providers.Call.EscalateVideoGetOfferEvent:u.Providers.Call.GetOfferSDPEvent),a=this.adjustVideoResolution(e,i,a);r=r||this._audioDevice,s=s||this._videoDevice,l.data={action:e,audioStream:t,videoStreams:i,audioDevice:r,videoDevice:s,videoResolution:a,iceServerChanged:n,restartTurnGathering:o,useIPv6Candidates:c},e!==u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&(this._initialGetOfferEvent=l),this.handleEvent(l)},e.prototype.offerSDP=function(e,t,i,a,r,s){var n,s=this.updateIceServers(s);s&&(this._hasLoggedRelayICECandidates=!1);var o={offer:e,action:t,audioStream:i,videoStreams:a,audioDevice:this._callProvider.getMediaServiceFactory().getAudioInterface().getInputInterface().getSelectedDevice(),videoDevice:this._callProvider.getMediaServiceFactory().getVideoInterface().getSelectedDevice(),iceServerChanged:s};switch(this._prevMediaAction=this._mediaAction,this._mediaAction=t,u.Base.Utils.isDefined(this.mediaTransactionDfd)&&this.mediaTransactionDfd.state()!==u.Base.DeferredStates.PENDING&&this.call.getState()===u.Services.Call.CallStates.ESTABLISHED&&this.call._setState(u.Services.Call.CallStates.FAR_END_RENEGOTIATING),t){case u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION:n=new(0===a.length||!1===a[0].enabled?u.Providers.Call.OfferSDPEvent:u.Providers.Call.EscalateVideoOfferEvent)(o);break;case u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:n=new u.Providers.Call.IncomingGenericOfferSDPEvent(o);break;default:n=new u.Providers.Call.OfferSDPEvent(o)}if(0<this.videoStreams.length&&0<a.length){i=this.getStreamDirection(this.videoStreams[0]),s=this.getStreamDirection(a[0]);i!==u.Services.Call.MediaDirection.INACTIVE&&s===u.Services.Call.MediaDirection.INACTIVE&&this._browserType===u.Base.BrowserType.EDGE?(this.determineIfNailedUpVideoConnectionSupported(a),this.isNailedUpVideoConnectionSupported()?(n.data.videoBandwidth=r,n.data.videoResolution=this.adjustVideoResolution(t,a,r)):t===u.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?this.callFailure(u.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,u.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):this.callFailure(u.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,u.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser")):(n.data.videoBandwidth=r,n.data.videoResolution=this.adjustVideoResolution(t,a,r))}else if(this.isNailedUpVideoConnectionSupported()&&t===u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Reject SDP Offer: "+t),void this.rejectOfferSDP(4880001,"Video escalation prohibited","Add video is not supported");this.handleEvent(n)},e.prototype.callRinging=function(e,t,i,a,r,s,n,o,c,l,d){var C=new u.Providers.Call.CallRingingEvent;C.data={address:e,displayName:t,isAuraAsserted:i,isPrivate:a,alertType:r,earlyMedia:s,audioStream:n,videoStreams:o,ucid:c,parentUcid:l,contextId:d},this.handleEvent(C)},e.prototype.answerSDP=function(e,t,i,a,r){var s=new(t===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?u.Providers.Call.EscalateVideoAnswerEvent:u.Providers.Call.AnswerSDPEvent);this._updateVideoBandwidth(r),s.data={answer:e,action:t,audioStream:i,videoStreams:a,videoBandwidth:r},this.handleEvent(s)},e.prototype.answerSdpAck=function(e,t,i){var a=new(e===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&(0===i.length||!1===i[0].enabled)?u.Providers.Call.EscalateVideoRejectedEvent:u.Providers.Call.AnswerSdpAckEvent);a.data={action:e,audioStream:t,videoStreams:i},this.handleEvent(a)},e.prototype.buildCallEstablishedEvent=function(e,t,i,a,r,s,n,o,c,l,d){this._hasReceivedCallEstablishedEvent=!0;var C=new u.Providers.Call.CallEstablishedEvent;return C.data={address:e,displayName:t,audioStream:i,videoStreams:a,isConf:r,isRemote:o},r&&(C.data.uccpUrl=s,C.data.webCollabUrl=n),c&&(C.data.ucid=c,C.data.parentUcid=l,C.data.contextId=d),C},e.prototype.callEstablished=function(e,t,i,a,r,s,n,o,c,l,d){this.startPerformanceMonitoring();d=this.buildCallEstablishedEvent(e,t,i,a,r,s,n,o,c,l,d);this.handleEvent(d)},e.prototype.muteAudio=function(){var e=new u.Providers.Call.MuteAudioEvent;this.handleEvent(e)},e.prototype.unmuteAudio=function(){var e=new u.Providers.Call.UnmuteAudioEvent;this.handleEvent(e)},e.prototype.recoverLocalAudio=function(){var e=new u.Providers.Call.AudioEndedEvent;this.handleEvent(e)},e.prototype.sendMuteUnmuteVideo=function(){switch(this.call._videoMuteState){case u.Services.Call.MediaMuteStates.MUTED:this.muteVideo();break;case u.Services.Call.MediaMuteStates.UNMUTED:this.unmuteVideo()}},e.prototype.muteVideo=function(){var e;return this.noMediaTransactionDfd=S.Deferred(),this.videoStreams.length?(e=new u.Providers.Call.MuteVideoEvent,this.handleEvent(e)):this.noMediaTransactionDfd.resolve("Queued").promise(),this.noMediaTransactionDfd.promise()},e.prototype.unmuteVideo=function(){var e;return this.noMediaTransactionDfd=S.Deferred(),this.videoStreams.length?(e=new u.Providers.Call.UnmuteVideoEvent,this.handleEvent(e)):this.noMediaTransactionDfd.resolve("Queued").promise(),this.noMediaTransactionDfd.promise()},e.prototype.muteSpeaker=function(){var e=new u.Providers.Call.MuteSpeakerEvent;this.handleEvent(e)},e.prototype.unmuteSpeaker=function(){var e=new u.Providers.Call.UnmuteSpeakerEvent;this.handleEvent(e)},e.prototype.end=function(e){u.Base.Logger.debug(u.Base.LoggerTags.CALL_PROVIDER,"Local call ending: "+e),this.cleanup();var t=new u.Providers.Call.EndCallEvent;t.data={remote:!1,denialReason:e},-1===this.call.getCallId().indexOf("temp-")&&this.handleEvent(t)},e.prototype.cleanup=function(){this.stopAllStreams(),this.removeVideoSharingAudioContext(),clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.stopPerformanceMonitoring(),this._rtConnection&&this._rtConnection.removeOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback)},e.prototype.stopMonitoringVideoDelays=function(){clearTimeout(this._videoStatsTimer),clearInterval(this._videoStatsInterval)},e.prototype.cleanupImmediately=function(){this.cleanup(),this._rtConnection&&this._rtConnection.close()},e.prototype.callEndedRemotely=function(e){this.cleanup();var t=new u.Providers.Call.EndCallEvent;t.data={remote:!0,callReason:e},this.handleEvent(t)},e.prototype.incomingCall=function(){var e=new u.Providers.Call.IncomingCallEvent;this.handleEvent(e)},e.prototype.acceptCall=function(e,t){this._audioDevice=e,this._videoDevice=t;var i=new u.Providers.Call.AcceptCallEvent;i.data={audioDevice:e};e=this.call.getVideoChannels();0<e.length&&(i.data.videoDevice=t,i.data.videoChannel=e[0],i.data.videoResolution=this.getVideoResolution()),this.handleEvent(i)},e.prototype.acceptSendVideo=function(e,t){this.mediaTransactionDfd=S.Deferred(),this._videoDevice=e;var i=new u.Providers.Call.AcceptSendVideoEvent;i.data={videoChannel:t,videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=i;e=this.mediaTransactionDfd.promise();return this.handleEvent(i),e},e.prototype.denySendVideo=function(){var e=new u.Providers.Call.DenySendVideoEvent;this.handleEvent(e)},e.prototype.callFailed=function(e,t,i){var a=new u.Providers.Call.EndCallEvent;a.data={remote:!1,reason:i},this.handleEvent(a)},e.prototype.callStateFailure=function(e){!e||e!==u.Services.Call.CallError.CALL_STATE_MISMATCH||!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()?(e=new u.Providers.Call.CallStateFailureEvent,this.handleEvent(e)):this.triggerCallMediaFailed()},e.prototype.callFailure=function(e,t,i,a){a={errorCode:e,protocolType:t,protocolErrorCode:i,failureReason:a},a=new u.Providers.Call.CallFailureEvent(a);this.handleEvent(a)},e.prototype.rejectOfferSDP=function(e,t,i){i={errorCode:e,errorMsg:t,displayMsg:i},i=new u.Providers.Call.RejectOfferSDPEvent(i);this.handleEvent(i)},e.prototype.blockCamera=function(e){this.mediaTransactionDfd=S.Deferred();e={deallocateCamera:e=!this.isNailedUpVideoConnectionSupported()&&e||!1},e=new u.Providers.Call.BlockCameraEvent(e);return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.unBlockCamera=function(e){this.mediaTransactionDfd=S.Deferred();var t=new u.Providers.Call.UnBlockCameraEvent;return t.data={videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.updateRemoteVideo=function(){this.mediaTransactionDfd=S.Deferred();var e=new u.Providers.Call.UpdateRemoteVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.updatePreferredResolution=function(e,t){var i=u.Base.VideoResolution[t],a=e.getNegotiatedResolution();i.getMinBandwidth()>a.getMinBandwidth()&&(t="Given resolution exceeds negotiated, using "+a+" instead",u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,t),i=a);var r,s,n=(new u.Base.VideoResolutionDetails).convertToConfigVideoResolution(i);return e._preferredResolution=n,e.getNegotiatedDirection()!==u.Services.Call.MediaDirection.SEND_ONLY&&(r=this.setPreferredReceiveResolution(e.getChannelId(),n)),e.getNegotiatedDirection()!==u.Services.Call.MediaDirection.RECV_ONLY&&(s=this.setVideoSendResolution(i)),S.when(r,s).then(function(){return n})},e.prototype.setPreferredReceiveResolution=function(t,e){var i,a,r;return this.noMediaTransactionDfd=S.Deferred(),0<this.call.getVideoChannels().filter(function(e){return t===e.getChannelId()}).length?(i=new u.Providers.Call.UpdatePreferredReceiveResolutionEvent,a=u.Base.VideoResolution[e],r=new u.Base.VideoResolutionDetails,e=a.getHeight()>this._videoResolution.getHeight()?r.convertToConfigVideoResolution(this._videoResolution):e,i.data={videoResolution:e},this.handleEvent(i)):this.noMediaTransactionDfd.reject(new u.Services.Call.CallException(u.Services.Call.CallError.NOT_FOUND)),this.noMediaTransactionDfd.promise()},e.prototype.updateVideoResolution=function(e,t,i){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Update video resolution: ",i),this.mediaTransactionDfd=S.Deferred();t=new u.Providers.Call.UpdateLocalStreamEvent({audioDevice:e,videoDevice:t,videoResolution:i,videoResolutionChanged:!0});return t.data.videoResolution.getMinBandwidth()>this._maxVideoResolution.getMinBandwidth()&&(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Given resolution exceeds the maximum allowed, using "+this._maxVideoResolution+" instead"),t.data.videoResolution=this._maxVideoResolution),t.data.videoResolution.getMinBandwidth()===this._videoResolution.getMinBandwidth()?(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"Given resolution is the same as current ("+i+")"),this.mediaTransactionDfd.resolve().promise()):(this._updateVideoResolution(t.data.videoResolution),this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise().then(function(){return this._videoResolution}.bind(this)))},e.prototype.setVideoSendResolution=function(e){if(u.Base.Utils.isDefined(e)){var t=S.Deferred(),i=e.getHeight(),a=e.getWidth(),r=i===this._videoResolution.getHeight()?this._videoResolution.getMaxBandwidth():e.getMinBandwidth();return this._rtConnection.setVideoSendResolution(a,i).then(function(){this._updateVideoSendResolution(e),this._rtConnection.setVideoSendBandwidth(r).then(function(){t.resolve()}.bind(this),function(e){u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"Failed set video set video send bandwidth "+e),t.reject(e)}.bind(this))}.bind(this),function(e){u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"Failed set video set video send resolution "+e),t.reject(e)}.bind(this)),t.promise()}return u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"Undefined video resolution details"),S.Deferred().reject().promise()},e.prototype.adjustVideoConstraints=function(e,t,i){if(this._videoResolution.getHeight()>t||this._videoResolution.getWidth()>e||this._videoResolution.getFPS()>i){t=Math.min(this._videoResolution.getHeight(),t),e=Math.min(this._videoResolution.getWidth(),e),i=Math.min(this._videoResolution.getFPS(),i);var a=this;return this._rtConnection.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks(function(){var e=Object.keys(u.Base.VideoResolution).filter(function(e){return u.Base.VideoResolution[e].getHeight()===t})[0];e&&this._updateVideoResolution(u.Base.VideoResolution[e])}.bind(this)),this._rtConnection.adjustVideoConstraints(e,t,i,this._videoDevice.getDeviceId()).then(function(){var e=Object.keys(u.Base.VideoResolution).filter(function(e){return u.Base.VideoResolution[e].getHeight()===t})[0];e&&a._updateVideoResolution(u.Base.VideoResolution[e])}).fail(function(e){return S.Deferred().reject(e).promise()}.bind(this))}return S.Deferred().resolve().promise()},e.prototype.updateDevice=function(e,t,i){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Update to new device: ",i),i._kind===u.Base.MediaTypes.VIDEO_INPUT){if(this._videoDevice=i,0<this.videoStreams.length&&(u.Base.Utils.isDefined(this._videoSharingStream)||this._getPreviousVideoDirection()===u.Services.Call.MediaDirection.RECV_ONLY))return S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CALL_STATE_MISMATCH)).promise()}else this._audioDevice=i;var a=new u.Providers.Call.UpdateLocalStreamEvent;return a.data={audioDevice:e,videoDevice:t,selectedDevice:i,videoResolution:this._videoResolution,videoResolutionChanged:!1},u.Base.Utils.isDefined(i)?(u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=S.Deferred()),this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()):(u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"No device selected"),S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.FAILED)).promise())},e.prototype.startContentVideoSharing=function(e,t){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"startContentVideoSharing: replacing video by content"),t&&(this._videoDevice=t),0===this.call.getVideoChannels().length)return S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();this._videoSharingStream=e;t=new u.Providers.Call.StartContentVideoSharingEvent;return t.data={stream:e,videoResolution:this._videoResolution,videoResolutionChanged:!1},u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=S.Deferred()),this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.stopContentVideoSharing=function(){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),this.isScreenSharingUsingVideo()){var e=new u.Providers.Call.StopContentVideoSharingEvent;return u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=S.Deferred()),this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()}return S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.updateAudioSourceForVideoSharing=function(e){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"updateAudioSourceForVideoSharing: from microphone: "+e);var t=new u.Providers.Call.UpdateContentVideoSharingAudioEvent;return t.data={stream:this._videoSharingStream,fromMicrophone:e},u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=S.Deferred()),this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.replaceContentWithVideo=function(){var e;u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),u.Base.Utils.isDefined(this._videoDevice)?((e=new u.Providers.Call.UpdateLocalStreamEvent).data={audioDevice:this._audioDevice,videoDevice:this._videoDevice,selectedDevice:this._videoDevice,videoResolution:this._videoResolution,videoResolutionChanged:!1},this.handleEvent(e)):(u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"No device selected"),this.mediaTransactionDfd.reject(new u.Services.Call.CallException(u.Services.Call.CallError.FAILED)))},e.prototype.escalateVideo=function(e){this.mediaTransactionDfd=S.Deferred();var t=new u.Providers.Call.EscalateVideoEvent;return t.data={videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.escalateNailedUpVideo=function(){this.mediaTransactionDfd=S.Deferred();var e=new u.Providers.Call.EscalateNailedUpVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.deEscalateVideo=function(){this.mediaTransactionDfd=S.Deferred();var e=new u.Providers.Call.DeEscalateVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.resolveMediaTransaction=function(e){setTimeout(function(){u.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.resolve(e),this.mediaTransactionDfd=T)}.bind(this),0)},e.prototype.rejectMediaTransaction=function(e){u.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.reject(e),this.mediaTransactionDfd=T)},e.prototype.sendDTMF=function(e){var t=new u.Providers.Call.SendDTMFEvent;t.data={dtmf:e},this.handleEvent(t)},e.prototype.incomingVideoRequestTimedout=function(){var e=new u.Providers.Call.IncomingAddVideoTimedoutEvent;this.handleEvent(e)},e.prototype.deviceRetrievalFailure=function(e){var t=new u.Providers.Call.DeviceRetrievalFailedEvent,e=u.Base.Utils.isDefined(e)?e:u.Services.Call.CallStates.FAILED;t.data={nextState:e},this.handleEvent(t)},e.prototype.hold=function(){this.mediaTransactionDfd=S.Deferred();var e=new u.Providers.Call.HoldEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.unhold=function(){this.mediaTransactionDfd=S.Deferred();var e=new u.Providers.Call.UnHoldEvent;return e.data={videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.transfer=function(e){this._transferPromise=S.Deferred();var t=new u.Providers.Call.TransferEvent;return t.data={targetRemoteAddress:e},this.handleEvent(t),this._transferPromise.promise()},e.prototype.attendedTransfer=function(e){this._transferPromise=S.Deferred();var t=new u.Providers.Call.AttendedTransferEvent;return t.data={targetCallId:e},this.handleEvent(t),this._transferPromise.promise()},e.prototype.addParticipantFromCall=function(e){var t=new u.Providers.Call.AddParticipantFromExistingCallEvent;t.data={participantCallId:e.getCallId()},this.handleEvent(t)},e.prototype.join=function(e){this._joinRemotePromise=S.Deferred();var t=new u.Providers.Call.JoinRemoteCallEvent;return t.data={audioDevice:e,videoResolution:this._videoResolution},this.handleEvent(t),this._joinRemotePromise.promise()},e.prototype.startRinging=function(){var e;this.isRingingStarted()?u.Base.Logger.warn("StartRinging request ignored: already started"):(e=new u.Providers.Call.StartRingingEvent,this.handleEvent(e))},e.prototype.acceptCallRequest=function(e,t){var i=new u.Providers.Call.AcceptCallRequestEvent;i.data={deferred:e,requestedType:t},this.handleEvent(i)},e.prototype.rejectCallRequest=function(e,t){var i=new u.Providers.Call.RejectAnswerCallRequestEvent;i.data={deferred:e,requestedType:t},this.handleEvent(i)},e.prototype.updateAudioVideoStreamsDirection=function(e,t,i){this.updateAudioStreamDirection(e,i),this.updateVideoStreamsDirection(t,i)},e.prototype.updateAudioNoiseReduction=function(e){e.serverNoiseReduction&&(this.audioStream.serverNoiseReduction=e.serverNoiseReduction)},e.prototype.updateAudioStreamDirection=function(e,t){if(e&&this.audioStream){switch(e.direction){case u.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.direction=u.Services.Call.MediaDirection.RECV_ONLY;break;case u.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.direction=u.Services.Call.MediaDirection.SEND_ONLY;break;case u.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.direction=e.direction);break;default:this.audioStream.direction=e.direction}this.isNailedUpVideoConnectionSupported()&&this._updateAudioStreamLogicalDirection(e,t)}},e.prototype._updateAudioStreamLogicalDirection=function(e,t){if(e)switch(e.logicalDirection){case u.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.logicalDirection=u.Services.Call.MediaDirection.RECV_ONLY;break;case u.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.logicalDirection=u.Services.Call.MediaDirection.SEND_ONLY;break;case u.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.logicalDirection=e.logicalDirection);break;default:this.audioStream.logicalDirection=e.logicalDirection}},e.prototype.updateVideoStreamsDirection=function(e,t){this._updateVideoStreamsDirection(e,t,this._calculateDirectVideoUpdateDirection.bind(this))},e.prototype.updateVideoStreamsDirectionBasedOnVideoMode=function(e,t){this._latestVideoModeDirection?this._updateVideoStreamsDirection(e,t,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoStreamsDirection(e,t)},e.prototype._updateVideoStreamsDirection=function(e,t,i){if(e){for(var a=0;a<this.videoStreams.length;a++)e[a]&&(e[a].enabled?this.isNailedUpVideoConnectionSupported()||this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[a].direction=i.call(this,e[a].direction,this.videoStreams[a].direction,!0,t):this.videoStreams[a].direction=u.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[a].enabled=!1,this.videoStreams[a].direction=u.Services.Call.MediaDirection.INACTIVE));this.isNailedUpVideoConnectionSupported()&&this._updateVideoStreamsLogicalDirection(e,t,i),0<this.videoStreams.length&&this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING&&t!==u.Providers.Call.CallProvider.Constants.HOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION&&(this._latestNonHoldingVideoDirection=this.getStreamDirection(this.videoStreams[0]))}},e.prototype._calculateDirectVideoUpdateDirection=function(e,t,i,a){if(!i)return u.Services.Call.MediaDirection.INACTIVE;switch(e){case u.Services.Call.MediaDirection.SEND_ONLY:return t===u.Services.Call.MediaDirection.SEND_ONLY?u.Services.Call.MediaDirection.INACTIVE:u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return t===u.Services.Call.MediaDirection.RECV_ONLY?u.Services.Call.MediaDirection.INACTIVE:u.Services.Call.MediaDirection.SEND_ONLY;case u.Services.Call.MediaDirection.SEND_RECV:return u.Base.Utils.isDefined(a)&&a===u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION?this.call._videoChannels[0]._getInternalRequestedDirection():e;default:return e}},e.prototype._calculateVideoModeUpdateVideoDirection=function(e){switch(e){case u.Services.Call.MediaDirection.SEND_RECV:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:return u.Services.Call.MediaDirection.SEND_RECV;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return T}break;case u.Services.Call.MediaDirection.RECV_ONLY:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:return u.Services.Call.MediaDirection.SEND_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.INACTIVE;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return T}break;case u.Services.Call.MediaDirection.SEND_ONLY:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.INACTIVE;default:return T}break;default:return T}},e.prototype._updateVideoStreamsLogicalDirection=function(e,t,i){if(e)for(var a=0;a<this.videoStreams.length;a++)e[a]&&(e[a].enabled?this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[a].logicalDirection=this.videoStreams[a].logicalDirection=i.call(this,e[a].logicalDirection,this.videoStreams[a].logicalDirection,this.videoStreams[a].enabled,t):this.videoStreams[a].logicalDirection=u.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[a].enabled=!1,this.videoStreams[a].logicalDirection=u.Services.Call.MediaDirection.INACTIVE))},e.prototype.getStreamDirection=function(e){var t;return t=e?this.isNailedUpVideoConnectionSupported()&&e.logicalDirection||e.direction:t},e.prototype.updateVideoChannelDirection=function(e){this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(e,this.getReversedVideoChannelDirection.bind(this)):this._updateVideoChannelDirection(e,this.getReversedVideoChannelDirection.bind(this))},e.prototype.updateVideoChannelDirectionBasedOnVideoMode=function(e){this._latestVideoModeDirection?this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(e,this._calculateVideoModeUpdateVideoDirection.bind(this)):this._updateVideoChannelDirection(e,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoChannelDirection(e)},e.prototype._updateVideoChannelDirection=function(e,t){if(e)for(var i=this.call.getVideoChannels(),a=0;a<i.length;a++)e[a]&&(e[a].enabled?i[a]._setNegotiatedDirection(t.call(this,e[a].direction)):i[a]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype._updateVideoChannelLogicalDirection=function(e,t){if(e)for(var i,a=this.call.getVideoChannels(),r=0;r<a.length;r++)e[r]&&(e[r].enabled?(i=e[r].logicalDirection||e[r].direction,a[r]._setNegotiatedDirection(t.call(this,i))):a[r]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype.calculateUpdateVideoDirection=function(e){if(e&&0<this.videoStreams.length){e=this.getStreamDirection(e);return this._calculateVideoModeUpdateVideoDirection(e)}return T},e.prototype.getReversedVideoChannelDirection=function(e){switch(e){case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return e}},e.prototype.updateAudioChannelDirection=function(e){var t=this.call.getAudioChannel();t&&e&&(e.enabled?t._setNegotiatedDirection(e.direction):t._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype.setAVStreams=function(e,t){this.audioStream=e,this.videoStreams=t},e.prototype.removeLocalVideoTracks=function(){var e=this.call.getVideoChannels();this.localStream&&0<e.length&&(this._callProvider.getMediaServiceFactory().getMediaServicesService().removeLocalVideoTracks(e[0].getChannelId(),this._rtConnection),this.localStream.getVideoTracks().forEach(function(e){this.localStream.removeTrack(e)}.bind(this)),this.setAVStreams(this.getAudioStream(),[]))},e.prototype.hasVideoTracks=function(){return!!this.localStream&&0<this.localStream.getVideoTracks().length},e.prototype.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty=function(e){0===this.getVideoStreams().length||0!==e.length&&e[0]||(this.call.getVideoChannels().forEach(function(e){e._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE),e._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}),this.removeLocalVideoTracks())},e.prototype.getAudioStream=function(){return this.audioStream},e.prototype.getVideoStreams=function(){return this.videoStreams},e.prototype.stopAllStreams=function(){var e=this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();e&&e.stopPlayingAudioStream(this.remoteStream),this._rtConnection&&(this._rtConnection.stopAllStreams(),this._rtConnection.removeStream(this.localStream)),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._callProvider.getMediaServiceFactory().getAudioInputInterfaceService().removeLocalMediaStream(this.call.getCallId()),this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().removeRemoteMediaStream(this.call.getCallId())},e.prototype.getVideoChannelId=function(){return this._videoChannelId},e.prototype.setVideoChannelId=function(e){this._videoChannelId!==e&&u.Base.Utils.isDefined(this._videoChannelId)&&this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._videoChannelId=e},e.prototype.updateVideoMode=function(e,t,i){var a;if(!this._callProvider.hasVideoDevices()&&e!==u.Services.Call.VideoMode.DISABLE)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Camera not found"),S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAMERA_NOT_FOUND));if(0===this.videoStreams.length){var r=u.Providers.Call.Utils.getVideoDirection(e);this.call._videoChannels[0]._setRequestedDirection(r),this._latestVideoModeDirection=r,a=this.escalateVideo(t)}else{if(e===u.Services.Call.VideoMode.INACTIVE)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Inactive video mode is not supported"),S.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.UNHANDLED_VIDEO_DIRECTION)).promise();var s=this._getPreviousVideoDirection(),r=this._setNewVideoDirection(e);switch(this._latestVideoModeDirection=r,this.call._videoChannels[0]._setRequestedDirection(r),e){case u.Services.Call.VideoMode.SEND_RECEIVE:a=s===u.Services.Call.MediaDirection.SEND_ONLY?this.updateRemoteVideo():s===u.Services.Call.MediaDirection.INACTIVE?this.videoStreams[0].enabled||this.isNailedUpVideoConnectionSupported()?(this.videoStreams[0].enabled=!0,this.call.getVideoChannels()[0].isCameraAccessDenied()?this.escalateVideo():this.escalateNailedUpVideo()):(this.removeLocalVideoTracks(),this.escalateVideo()):this.unBlockCamera(t);break;case u.Services.Call.VideoMode.SEND_ONLY:a=s===u.Services.Call.MediaDirection.SEND_RECV?this.updateRemoteVideo():s===u.Services.Call.MediaDirection.RECV_ONLY?(this.videoStreams[0].direction=u.Services.Call.MediaDirection.INACTIVE,this.videoStreams[0].logicalDirection=u.Services.Call.MediaDirection.INACTIVE,this.updateRemoteVideo()):this.unBlockCamera(t);break;case u.Services.Call.VideoMode.RECEIVE_ONLY:a=s===u.Services.Call.MediaDirection.SEND_ONLY?this.deEscalateVideo():s!==u.Services.Call.MediaDirection.INACTIVE||this._rtConnection.hasVideo(this.localStream)?this.blockCamera(i):this.escalateVideo(t);break;case u.Services.Call.VideoMode.DISABLE:a=this.deEscalateVideo();break;default:return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Unsupported video mode: "+e),S.Deferred().reject()}}return a},e.prototype._setNewVideoDirection=function(e){e=u.Providers.Call.Utils.getVideoDirection(e);return this.videoStreams[0].direction=e,this.isNailedUpVideoConnectionSupported()&&(this.videoStreams[0].logicalDirection=e),e},e.prototype._getPreviousVideoDirection=function(){return this.isNailedUpVideoConnectionSupported()&&this.videoStreams[0].logicalDirection||this.videoStreams[0].direction},e.prototype.notifyCallServiceOfMediaChanges=function(){this.isNailedUpVideoConnectionSupported()?this._notifyCallServiceOfLogicalMediaChanges():this._notifyCallServiceOfMediaChanges()},e.prototype._notifyCallServiceOfMediaChanges=function(){for(var e=this.call.getVideoChannels(),t=0;t<e.length&&t<this.videoStreams.length;t++){var i=this.videoStreams[t].direction;i!==u.Services.Call.MediaDirection.INACTIVE&&i!==u.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(e[t].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),i!==u.Services.Call.MediaDirection.SEND_RECV&&i!==u.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(i,!0),e[t]._setNegotiatedDirection(i),this._callProvider.triggerVideoChannelUpdate(this.call,e[t])):(e[t]._setNegotiatedDirection(u.Services.Call.MediaDirection.INACTIVE),this.videoStreams[t].enabled||e[t].getRequestedDirection()===u.Services.Call.MediaDirection.DISABLE||e[t]._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this.disableLocalVideoStreams(),this._callProvider.triggerVideoChannelUpdate(this.call))}},e.prototype._notifyCallServiceOfLogicalMediaChanges=function(){for(var e=this.call.getVideoChannels(),t=0;t<e.length&&t<this.videoStreams.length;t++){var i=this.videoStreams[t].logicalDirection||this.videoStreams[t].direction;i!==u.Services.Call.MediaDirection.INACTIVE&&i!==u.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(e[t].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),i!==u.Services.Call.MediaDirection.SEND_RECV&&i!==u.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(i),e[t]._setNegotiatedDirection(i),this._callProvider.triggerVideoChannelUpdate(this.call,e[t])):(e[t]._setNegotiatedDirection(u.Services.Call.MediaDirection.INACTIVE),this.videoStreams[t].enabled||e[t].getRequestedDirection()===u.Services.Call.MediaDirection.DISABLE||e[t]._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this._callProvider.triggerVideoChannelUpdate(this.call))}},e.prototype.transferCompleted=function(){u.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.resolve()},e.prototype.transferFailed=function(){u.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.reject()},e.prototype.isFirefoxBrowser=function(){return this._browserType===u.Base.BrowserType.FIREFOX},e.prototype.getCallStatistics=function(){var t=S.Deferred(),e=!!this.audioStream&&this.audioStream.enabled,i=0!==this.videoStreams.length&&this.videoStreams[0].enabled;return(e||i)&&u.Base.Utils.isDefined(this._rtConnection)&&null!==this._rtConnection&&u.Base.Utils.isDefined(this._rtConnection._pc)?this._rtConnection.getStats().then(function(e){this._logSelectedCandidates(e),this._checkCallStatisticReport(e,t)}.bind(this),function(){t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE))}):t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE)),t.promise()},e.prototype.monitorVideoDelays=function(){var e,a,r,s,n,o;0!==this.videoStreams.length&&this.videoStreams[0].enabled&&(e=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,a=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoDecodingTime")||40,r=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoEncodingTime")||35,s=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoDecodingTime")||13,n=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoEncodingTime")||13,o=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this.stopMonitoringVideoDelays(),this._videoStatsTimer=setTimeout(function(){this._videoStatsInterval=setInterval(function(){this._rtConnection.getVideoStats().then(function(e){var t,i=this._videoStatsFloatingWindow.length;o<=i&&this._videoStatsFloatingWindow.shift(),this._videoStatsFloatingWindow.push(e.videoStatistics),o<=i&&(e=this._getLastVideoEncodingTime(this._videoStatsFloatingWindow),i=this._getLastVideoDecodingTime(this._videoStatsFloatingWindow),(n<e||s<i)&&(t="Last video encoding/decoding above threshold: ["+e+", "+i+"]",this._onPerformanceMonitorAlert(u.Base.PerformanceAlertType.CPU_USAGE_WARNING,t)),i=this._calculateAvgVideoEncodingTime(this._videoStatsFloatingWindow,o),t=this._calculateAvgVideoDecodingTime(this._videoStatsFloatingWindow,o),(a<=t||r<=i)&&(i="Average video encoding/decoding above threshold: ["+t+", "+i+"]",this._onPerformanceMonitorAlert(u.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,i)))}.bind(this))}.bind(this),1e3)}.bind(this),1e3*e))},e.prototype._calculateAvgVideoEncodingTime=function(e,t){if(0===e.length||e.length<t)this._avgVideoEncodeMs=0;else if(u.Base.Utils.isDefined(e[0].totalEncodeTime)){for(var i=0,a=1;a<e.length;a++){var r=e[a].framesEncoded-e[0].framesEncoded;0<r&&(i+=(e[a].totalEncodeTime-e[0].totalEncodeTime)/r)}this._avgVideoEncodeMs=i/(e.length-1)*1e3}return this._avgVideoEncodeMs},e.prototype._calculateAvgVideoDecodingTime=function(e,t){if(0===e.length||e.length<t)this._avgVideoDecodeMs=0;else if(u.Base.Utils.isDefined(e[0].totalDecodeTime)){for(var i=0,a=1;a<e.length;a++){var r=e[a].framesDecoded-e[0].framesDecoded;0<r&&(i+=(e[a].totalDecodeTime-e[0].totalDecodeTime)/r)}this._avgVideoDecodeMs=i/(e.length-1)*1e3}return this._avgVideoDecodeMs},e.prototype._getLastVideoDecodingTime=function(e){var t,i,a=0;return u.Base.Utils.isDefined(e[0].totalDecodeTime)&&2<=e.length&&(t=e[e.length-1].framesDecoded,i=e[e.length-2].framesDecoded,a=(e[e.length-1].totalDecodeTime-e[e.length-2].totalDecodeTime)/(t-i)*1e3),a},e.prototype._getLastVideoEncodingTime=function(e){var t,i,a=0;return u.Base.Utils.isDefined(e[0].totalEncodeTime)&&2<=e.length&&(t=e[e.length-1].framesEncoded,i=e[e.length-2].framesEncoded,a=(e[e.length-1].totalEncodeTime-e[e.length-2].totalEncodeTime)/(t-i)*1e3),a},e.prototype._onPerformanceMonitorAlert=function(e,t){this.onPerformanceMonitorAlert(e,t)},e.prototype.startPerformanceMonitoring=function(){this.monitorVideoDelays(),this._runtimePerformanceMonitor.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),this._runtimePerformanceMonitor.start()},e.prototype.stopPerformanceMonitoring=function(){this.stopMonitoringVideoDelays(),this._runtimePerformanceMonitor.stop()},e.prototype._checkCallStatisticReport=function(e,t){e?t.resolve(e):t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE))},e.prototype._logSelectedCandidates=function(e){if(!this._hasLoggedRelayICECandidates&&e.iceCandidateStatistics)for(var t in e.iceCandidateStatistics){var i;e.iceCandidateStatistics.hasOwnProperty(t)&&(i=e.iceCandidateStatistics[t].local,t=e.iceCandidateStatistics[t].remote,i&&t&&(this._hasLoggedRelayICECandidates=!0,u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected local ICE  candidate",i.toString()),u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected remote ICE candidate",t.toString())))}},e.prototype.stopEarlyMedia=function(e){this._isEarlyMedia&&this.remoteStream&&e.isPlaying(this.remoteStream)&&(this._rtConnection.disableRemoteStreams(),e.stopPlayingAudioStream(this.remoteStream))},e.prototype.getVideoResolution=function(){return this._videoResolution},e.prototype.getVideoBandwidth=function(){return this._videoBandwidth},e.prototype.getVideoSendResolution=function(){return u.Base.Utils.isDefined(this._videoSendResolution)||this._updateVideoSendResolution(this._videoResolution),this._videoSendResolution},e.prototype.getVideoSendBandwidth=function(){var e=this._rtConnection.getVideoSendBandwidth();return e!==T?e/1e3:this.getVideoBandwidth()},e.prototype._updateVideoBandwidth=function(e){e!==T&&(this._videoBandwidth=e)},e.prototype._updateVideoResolution=function(e){this._videoResolution.getHeight()!==e.getHeight()&&(this._videoResolution=e,this._callProvider._videoResolution=e)},e.prototype._updateVideoSendResolution=function(e){this._videoSendResolution=e},e.prototype.popQueuedActiveRenegotiateEvent=function(){return this._activeRenegotiateEventQueue.shift()},e.prototype.setQueuedActiveRenegotiateEvent=function(e){this._activeRenegotiateEventQueue.push(e)},e.prototype.isReadyToReceiveMediaRequest=function(){return this._isReadyToReceiveMediaRequest},e.prototype.popQueuedRemoteCallEstablishedEvent=function(){var e=this._queuedRemoteCallEstablishedEvent;return this._queuedRemoteCallEstablishedEvent=T,e},e.prototype.setQueuedRemoteCallEstablishedEvent=function(e){this._queuedRemoteCallEstablishedEvent=e},e.prototype.getMediaTransactionInitialEvent=function(){return this._mediaTransactionInitialEvent},e.prototype.setMediaTransactionInitialEvent=function(e){this._mediaTransactionInitialEvent=e},e.prototype.adjustVideoResolution=function(e,t,i){var a=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(i,this._videoResolution)||this._videoResolution;return t&&t[0]&&(i=t[0].maxHeight,(t=t[0].maxWidth)&&i&&(a=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolutionForDimensions(i,t,a))),a.getMinBandwidth()<this._maxVideoResolution.getMinBandwidth()&&e!==u.Providers.Call.CallProvider.Constants.UPDATE_VIDEO&&(this._maxVideoResolution=a),a},e.prototype.setCallRequestedTransactionalId=function(e,t){this._3pccRequestTransactionMap[e]=t},e.prototype.getCallRequestedTransactionalId=function(e){return this._3pccRequestTransactionMap[e]},e.prototype.updateIceServers=function(e){var t,i=!1;return e&&(t=[],e.getTransportTypes().sort(function(e,t){return e.getTransportPrecedence()>t.getTransportPrecedence()?-1:e.getTransportPrecedence()<t.getTransportPrecedence()?1:0}),e.getTransportTypes().forEach(function(e){t.push(e.getUrl())}),i=this._addTurnServers(e.getUsername(),e.getCredential(),t,e.getIceTransportPolicy(),e.getExpiryTime())),i},e.prototype.isNailedUpVideoConnectionSupported=function(){return this._isNailedUpVideoConnectionSupported},e.prototype.setNailedUpVideoConnectionSupported=function(e){this._isNailedUpVideoConnectionSupported=e},e.prototype.determineIfNailedUpVideoConnectionSupported=function(e){e=!!e&&0<e.length&&!!e[0].logicalDirection;this._isNailedUpVideoConnectionSupported=this._callProvider.isSolutionSupportsNailedUpConnection()&&e},e.prototype.setRingingStarted=function(e){this._isRingingStarted=e},e.prototype.isRingingStarted=function(){return this._isRingingStarted},e.prototype.disableVideoStreamsAndChannels=function(e){0<this.videoStreams.length&&(this.videoStreams[0].enabled=!1,this.isNailedUpVideoConnectionSupported()?this.videoStreams[0].logicalDirection=u.Services.Call.MediaDirection.INACTIVE:this.videoStreams[0].direction=u.Services.Call.MediaDirection.INACTIVE);var t=this.call.getVideoChannels();0<t.length&&(t[0]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE),t[0]._setVideoDisabledReason(e))},e.prototype._addTurnServers=function(e,t,i,a,r){return!!(e&&t&&i)&&(this._rtcConfiguration={iceServers:[{username:e,credential:t,credentialType:"password",urls:i}],iceTransportPolicy:a},r&&(30<r&&(r-=30),this._rtcConfiguration._expiryTime=Date.now()+1e3*r),"relay"!==a&&this.isIceRecoverySupportedConference()&&(this._rtcConfiguration._turnOfferType=this.getIceRestartRelayType()||u.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY),!0)},e.prototype.resetAudioOnlyNailedUpConnection=function(){return!(!this._callProvider.isSolutionSupportsNailedUpConnection()||!this.hasNailedUpConnectionVideoChannel())&&(this.disableVideoStreamsAndChannels(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),this.disableLocalVideoStreams(),!0)},e.prototype.hasNailedUpConnectionVideoChannel=function(){return 0<this.call.getVideoChannels().filter(function(e){return e.getChannelId().toString().includes("NailedUp_")}).length},e.prototype._queueUpdateLocalStreamEvent=function(e){this.setQueuedActiveRenegotiateEvent(e)},e.prototype._queueStartContentVideoSharingEvent=function(e){this.setQueuedActiveRenegotiateEvent(e)},e.prototype.hasVideoTrackStopStreaming=function(e){return this._rtConnection.hasVideoTrackStopStreaming(e)},e.prototype.disableLocalVideoStreams=function(e){this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()?(e=e||u.Services.Call.MediaDirection.INACTIVE,this._rtConnection.setLocalVideoDirection(e)):this._rtConnection.disableLocalVideoStreams()},e.prototype.enableLocalVideoStreams=function(e,t){0<this.videoStreams.length&&(this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()&&(e=e||u.Services.Call.MediaDirection.SEND_RECV,this._rtConnection.setLocalVideoDirection(e),t&&this.call._videoMuteState===u.Services.Call.MediaMuteStates.UNMUTED&&this.isSendingVideoDirection()&&(this._mediaAction===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION||this._mediaAction===u.Providers.Call.CallProvider.Constants.UPDATE_VIDEO||this._mediaAction===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION)&&(this.call._videoMuteState=u.Services.Call.MediaMuteStates.UNDEFINED,this._rtConnection.disableLocalVideoStreams())),this.isLocalVideoMuted()||this._rtConnection.enableLocalVideoStreams())},e.prototype.isSendingVideoDirection=function(){if(0<this.videoStreams.length){var e=this.getStreamDirection(this.videoStreams[0]);return e===u.Services.Call.MediaDirection.SEND_RECV||e===u.Services.Call.MediaDirection.SEND_ONLY}return!1},e.prototype.muteLocalVideo=function(){this._rtConnection.disableLocalVideoStreams()},e.prototype.unmuteLocalVideo=function(){this._rtConnection.enableLocalVideoStreams()},e.prototype.isLocalVideoMuted=function(){return this.call._videoMuteState===u.Services.Call.MediaMuteStates.MUTED},e.prototype.enableLocalStreams=function(){this.call.isAudioMuted()||this._rtConnection.enableLocalAudioStreams(),this.enableLocalVideoStreams()},e.prototype.disableLocalStreams=function(){this._rtConnection.disableLocalAudioStreams(),this.disableLocalVideoStreams()},e.prototype.queueMuteUnumteFunctor=function(e){this._pendingVideoMuteUnmuteFunctor=e},e.prototype.execQueuedVideoMuteUnmuteFunctor=function(){this._pendingVideoMuteUnmuteFunctor&&this._pendingVideoMuteUnmuteFunctor(this.callId,this.call._sessionId,this.getVideoStreams()),this._pendingVideoMuteUnmuteFunctor=T},e.prototype.hasReceivedCallEstablishedEvent=function(){return this._hasReceivedCallEstablishedEvent},e.prototype.isMPaaSCall=function(){return!!this.call._sessionId},e.prototype.isMPaaSCollabCall=function(){return this._isMPaaSCollabCall},e.prototype.isIceRecoverySupportedBrowser=function(){return this._browserType!==u.Base.BrowserType.EDGE},e.prototype.isIceRecoverySupportedConference=function(){return this.isMPaaSCall()&&this.isIceRecoverySupportedBrowser()&&!this.isMPaaSCollabCall()},e.prototype.iceConnectionFailedHandler=function(){var e;clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this._selectedCandidatePairChangedTimerId=T,this._selectedCandidatePairChangedTimestamp=T,this.isIceRecoverySupportedConference()&&this.call.getState()!==u.Services.Call.CallStates.ENDING&&this.call.getState()!==u.Services.Call.CallStates.ENDED&&(e=!0,this.isCallServiceAvailable()&&this._iceRestartAttempts++,u.Base.Utils.isUndefined(this.getIceConnectionRestartTimestamp())?(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Starting ICE media recovery"),this.setIceConnectionRestartTimestamp(Date.now()),this._callProvider.triggerMediaRecoveryInitiated(this.call)):this.hasIceRecoveryElapsed()?(e=!1,u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> ICE recovery has elapsed"),this.triggerCallMediaFailed()):u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Continuing ICE media recovery"),e&&(e=new u.Providers.Call.UpdateIceRestartMediaEvent,this.handleEvent(e)))},e.prototype.iceRecoveryCleanup=function(){this.isIceRecoverySupportedConference()&&(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Cleanup ICE media recovery"),this.setIceRestartInProgress(!1),this.setIceConnectionRestartTimestamp(T))},e.prototype.hasIceRecoveryElapsed=function(){return!this._iceConnectionRestartTimestamp||3e5<Date.now()-this._iceConnectionRestartTimestamp},e.prototype.setIceConnectionRestartTimestamp=function(e){this.isIceRecoverySupportedConference()&&(this._iceConnectionRestartTimestamp=e)},e.prototype.getIceConnectionRestartTimestamp=function(){return this._iceConnectionRestartTimestamp},e.prototype.setIceRestartRelayType=function(e){this._iceRestartRelayType=e},e.prototype.getIceRestartRelayType=function(){return this._iceRestartRelayType},e.prototype.getIceRestartAttemtps=function(){return this._iceRestartAttempts},e.prototype.initiateIceRecoveryIfSelectedCandidatePairChanged=function(){this._selectedCandidatePairChangedTimestamp&&this.isIceRecoverySupportedConference()&&!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(e){var i=e.audioStatistics.transportBytesReceived,a=function(t){this._selectedCandidatePairChangedTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){t++;e=e.audioStatistics.transportBytesReceived-i;0!=e&&(this._iceRestartAttempts=0),!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&0==e&&(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=t?(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after ICE candidatePair changes"),this.iceConnectionFailedHandler()):a(t))}.bind(this))}.bind(this),5e3)}.bind(this);a(0)}.bind(this)))},e.prototype.initiateIceRecoveryIfDetectedMediaPathProblem=function(){this.isIceRecoverySupportedConference()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(e){var i=e.audioStatistics.transportBytesReceived,a=function(t){this._serviceAvailableIceRecoveryTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){0<e.audioStatistics.transportBytesReceived&&(t++,e.audioStatistics.transportBytesReceived-i==0?(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=t?(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after calls service available"),this.iceConnectionFailedHandler()):a(t)):(this._iceRestartAttempts=0,this._isMediaConnected||(this._isMediaConnected=!0,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected))))}.bind(this))}.bind(this),5e3)}.bind(this);a(0)}.bind(this)))},e.prototype.setCallServiceAvailable=function(e){this._isCallServiceAvailable=e,this._isCallServiceAvailable&&(e=new u.Providers.Call.ServiceAvailableEvent,this.handleEvent(e))},e.prototype.isCallServiceAvailable=function(){return this._isCallServiceAvailable},e.prototype.triggerCallMediaFailed=function(){u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,">>> Failed to recovery media"),this.iceRecoveryCleanup(),!this._hasTriggeredMediaFailed&&this.isIceConnectionStateFailed()&&(this._hasTriggeredMediaFailed=!0,this._callProvider.triggerCallMediaFailed(this.call))},e.prototype.isIceConnectionStateFailed=function(){return!!this._rtConnection&&this._rtConnection.getIceConnectionState()===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED},e.prototype.getIceConnectionState=function(){var e;return e=this._rtConnection?this._rtConnection.getIceConnectionState():e},e.prototype.isMediaConnected=function(){return this._isMediaConnected},e.prototype.setIceRestartInProgress=function(e){this._iceRestartInProgress=e},e.prototype.isIceRestartInProgress=function(){return this._iceRestartInProgress},e.prototype._recalculateMediaConnection=function(e){var t=this._isMediaConnected;this._isMediaConnected=e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED||e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED,this._isMediaConnected&&(this._hadMediaConnected=!0),this._isMediaConnected!==t&&e!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CHECKING&&this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)},e.prototype._processIceConnectionStateChange=function(e,t){this._recalculateMediaConnection(e),this._isMediaConnected?this.iceRecoveryCleanup():(e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED||t&&!this.isIceRestartInProgress())&&this.iceConnectionFailedHandler()},e.prototype._replaceAudioTrackIfNeeded=function(e,t){if(e=e||!1,this._rtConnection.isLocalAudioTrackEnded()||t){t=this.getNoiseSuppressionConstraints();return u.Providers.Call.CPUtils.replaceLocalAudioTrack(this,this._callProvider.getMediaServiceFactory(),e,t)}return S.Deferred().reject("Condition failed").promise()},e.prototype.applyAudioConstraintsIfNeeded=function(){var e,t=this.getAudioStream();if(t.serverNoiseReduction&&"ENABLE"===t.serverNoiseReduction)e=!1;else switch(this.call.getNoiseReductionSetting()){case u.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case u.Services.Call.NoiseReductionSetting.DISABLE_ALL:e=!1;break;case u.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case u.Services.Call.NoiseReductionSetting.ENABLED:e=!0;break;default:"DISABLE"===t.serverNoiseReduction&&(e=!0)}u.Base.Utils.isDefined(e)&&this._rtConnection.adjustAudioConstraints(e)},e.prototype.getNoiseSuppressionConstraints=function(){var e,t=this.getAudioStream();if(t.serverNoiseReduction&&"ENABLE"===t.serverNoiseReduction)e={noiseSuppression:!1};else switch(this.call.getNoiseReductionSetting()){case u.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case u.Services.Call.NoiseReductionSetting.DISABLE_ALL:e={noiseSuppression:!1};break;case u.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case u.Services.Call.NoiseReductionSetting.ENABLED:e={noiseSuppression:!0};break;default:"DISABLE"===t.serverNoiseReduction&&(e={noiseSuppression:!0})}return e},e.prototype.setVideoSharingAudioContext=function(e){this.removeVideoSharingAudioContext(),this._videoSharingAudioContext=e},e.prototype.removeVideoSharingAudioContext=function(){this._videoSharingAudioContext&&(this._videoSharingAudioContext.close(),this._videoSharingAudioContext=T,this._videoSharingAudioConstraints=T,this._videoSharingMicrophoneGainNode=T)},e.prototype.setVideoSharingAudioConstraints=function(e){this._videoSharingAudioConstraints=e},e.prototype.getVideoSharingAudioConstraints=function(){return this._videoSharingAudioConstraints},e.prototype.setVideoSharingMicrophoneGainNode=function(e){this._videoSharingMicrophoneGainNode=e},e.prototype.updateVideoSharingMicrophoneVolume=function(e){this._videoSharingAudioContext&&this._videoSharingMicrophoneGainNode&&this._videoSharingMicrophoneGainNode.gain.setValueAtTime(e,this._videoSharingAudioContext.currentTime)},e.prototype.stopVideoSharingStream=function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(e){e.stop(),e.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&this._rtConnection.replaceLocalMediaTrack(this.localStream.getAudioTracks()[0])}.bind(this)),this._videoSharingStream=T)},e.prototype.isScreenSharingUsingVideo=function(){return u.Base.Utils.isDefined(this._videoSharingStream)},e.prototype.mixVideoSharingAudio=function(e,t){this.removeVideoSharingAudioContext();var i=new n;this.setVideoSharingAudioContext(i),e.getAudioTracks().forEach(function(e){var t=e.getConstraints();t.echoCancellation=!0,t.autoGainControl=!1,e.applyConstraints(t).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Apply "+t+" constraints rejected: "+e)})}),t=t||this._videoSharingStream;var a=i.createMediaStreamSource(t),r=i.createMediaStreamSource(e),s=i.createMediaStreamDestination(),t=i.createGain();t.gain.setValueAtTime(.75,i.currentTime),a.connect(t),t.connect(s);i=i.createGain();return this.setVideoSharingMicrophoneGainNode(i),this.updateVideoSharingMicrophoneVolume(this.call.isAudioMuted()?0:1),r.connect(i),i.connect(s),e.getAudioTracks()[0].enabled=!0,s.stream.getAudioTracks()[0]},e.prototype.setBackgroundBlur=function(e,t,i){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"setBackgroundBlur: ",e),this.backgroundBlur=e,this.backgroundImage=e?T:this.backgroundImage;i=new u.Providers.Call.SetBackgroundBlurEvent({audioDevice:t,videoDevice:i});return this.mediaTransactionDfd=S.Deferred(),this._mediaTransactionInitialEvent=i,this.handleEvent(i),this.mediaTransactionDfd.promise()},e.prototype.setBackgroundImage=function(e,t,i){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"setBackgroundImage: ",e),this.backgroundImage=e,this.backgroundBlur=!e&&this.backgroundBlur;i=new u.Providers.Call.SetBackgroundImageEvent({audioDevice:t,videoDevice:i});return this.mediaTransactionDfd=S.Deferred(),this._mediaTransactionInitialEvent=i,this.handleEvent(i),this.mediaTransactionDfd.promise()},u.Providers.Call.CPCall=e}(AvayaClientServices),function(h){"use strict";h.Providers.Call.CPUtils={createLocalMediaStream:function(e,t,r,i,a,s,n,o){h.Base.Logger.debug(h.Base.LoggerTags.CALL_PROVIDER,"The video resolution of the localStream has to be changed due to bandwidth management.");function c(){r._rtConnection.stopStream(r.localStream),r._rtConnection.removeStream(r.localStream);var e=function(){var e=o?o.data.constraints:T;i.getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!0,u.enable,d,u.videoDeviceId,u.videoChannelId,a,e,r.backgroundBlur,r.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&r._updateVideoResolution(e.videoResolution);var i=r.getAudioStream(),a=[];t.getTracks().forEach(function(e){var t,i;e.kind===h.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(i=(t=r.getVideoStreams()[0])?t.direction:h.Services.Call.MediaDirection.INACTIVE,i=new h.Providers.Interfaces.VideoStream(e.id,i),r.isNailedUpVideoConnectionSupported()&&(i.logicalDirection=t.logicalDirection),a.push(i))}),u.enable&&e.constraint&&0<C.length&&h.Providers.Call.CPUtils.updateVideoDeniedStreams(C,a,e.constraint),r.setAVStreams(i,a),r.localStream=t,r._rtConnection.addStream(r.localStream),r.call.isAudioMuted()&&r._rtConnection.disableLocalAudioStreams(),0!==a.length&&r.isLocalVideoMuted()&&r.muteLocalVideo(),s.call(T,r,o),l.resolve(e.videoResolution)},function(e){n.call(T,r,e),l.reject(e)})}.bind(this);h.Base.Utils.getBrowserType()===h.Base.BrowserType.EDGE?setTimeout(function(){e()}.bind(this),500):e()}var l=S.Deferred(),d=e?e.getDeviceId():T,C=r.call.getVideoChannels(),u=this.getVideoOptions(C,t);return u.enable?r._rtConnection.adjustVideoConstraints(a.getWidth(),a.getHeight(),a.getFPS()).then(function(){r._updateVideoResolution(a),s.call(T,r,o),l.resolve(a)},function(){c()}):c(),l.promise()},updateVideoResolutionFirefox:function(e,t,i,a,r,s){h.Base.Logger.debug("The video resolution of the localStream has to be changed due to bandwidth management.");var n=a.localStream.getVideoTracks()[0];n?t.getMediaServicesService().getUserMedia().updateStreamUsingApplyConstraints(n,i,a,e.getDeviceId()).always(function(){r.call(T,a)}):s.call(T,a,"Missing video track")},updateDevices:function(a,r,s,n,e,o,c,t){var i,l=!1,d=!1,C={videoDeviceId:T,videoChannelId:T},u=s.call.getVideoChannels();if(r){if(!(0<u.length&&u[0].getRequestedDirection()!==h.Services.Call.MediaDirection.DISABLE))return h.Base.Logger.debug("Ignoring. Video channels is empty or disabled"),o.call(T,s),S.Deferred().resolve().promise();l=!0,i=T,C=this.getVideoOptions(u,r),s._rtConnection.removeLocalVideoTrack(s.localStream),h.Base.Logger.debug("Changing to new video device: "+r.getLabel())}return a&&(d=!0,i=a.getDeviceId(),s._rtConnection.removeLocalAudioTrack(s.localStream),h.Base.Logger.debug("Changing to new audio device: "+a.getLabel())),n.getMediaServicesService().createLocalMediaStream(s.call.getCallId(),d,l,i,C.videoDeviceId,C.videoChannelId,e,t,s.backgroundBlur,s.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&s._updateVideoResolution(e.videoResolution);var i=[];t.getTracks().forEach(function(e){i.push(s._rtConnection.replaceLocalMediaTrack(e,s.localStream))}),S.when.apply(this,i).then(function(){l&&(s._videoDevice=r,n.getVideoInterfaceService().replaceLocalMediaStream(C.videoChannelId,s.localStream),s.isLocalVideoMuted()&&s.muteLocalVideo()),d&&(s._audioDevice=a,n.getAudioInputInterfaceService().replaceLocalMediaStream(s.call.getCallId(),s.localStream),s.call.isAudioMuted()&&s._rtConnection.disableLocalAudioStreams()),o.call(T,s)},function(e){c.call(T,s,e)})},function(e){c.call(T,s,e)})},updateVideoResolution:function(r,a,e,s,n,o){var c=this.getVideoOptions(r.call.getVideoChannels(),r._videoDevice);return r._rtConnection.removeLocalVideoTrack(r.localStream),h.Base.Logger.debug("Updating video resolution: "+e.getWidth()+"x"+e.getHeight()),a.getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!1,!0,T,c.videoDeviceId,c.videoChannelId,e,T,r.backgroundBlur,r.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&r._updateVideoResolution(e.videoResolution);var i=[];t.getTracks().forEach(function(e){i.push(r._rtConnection.replaceLocalMediaTrack(e,r.localStream))}),S.when.apply(this,i).then(function(){a.getVideoInterfaceService().replaceLocalMediaStream(c.videoChannelId,r.localStream),r.isLocalVideoMuted()&&r.muteLocalVideo(),s.call(T,r,o)},function(e){n.call(T,r,e)})}.bind(this),function(e){var t=r.call.getVideoChannels(),i=r.getVideoStreams(),a=e.getError();0<t.length&&a&&(a===h.Services.Call.CallError.CAMERA_PERMISSION_DENIED||a===h.Services.Call.CallError.OVERCONSTRAINED)?(h.Providers.Call.CPUtils.updateVideoDeniedStreams(t,i,{error:a,reason:e.getProtocolErrorReason()}),s.call(T,r,o)):n.call(T,r,e)})},replaceLocalAudioTrack:function(t,i,a,e){h.Base.Logger.info("Replacing local audio track");var r=t._audioDevice?t._audioDevice.getDeviceId():T,s=S.Deferred();return t._rtConnection.removeLocalAudioTrack(t.localStream),i.getMediaServicesService().createLocalMediaStream(t.call.getCallId(),!0,!1,r,T,T,T,e).then(function(e){e.stream.getTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e,t.localStream).then(function(e){i.getAudioInputInterfaceService().replaceLocalMediaStream(t.call.getCallId(),t.localStream),t.call.isAudioMuted()&&t._rtConnection.disableLocalAudioStreams(),e&&a?(h.Base.Logger.debug("Send media negotiation"),t._callGatewayProvider.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){s.resolve()},function(e){h.Base.Logger.error("Failed to send media negotiation: "+e),s.reject(e)})):s.resolve()},function(e){h.Base.Logger.error("Failed to replace audio track: "+e),s.reject(e)})})},function(e){s.reject(e)}),s},updateVideoDeniedStreams:function(e,t,i){e[0]._setCameraConstraint(i);var a=e[0]._getInternalRequestedDirection();a===h.Services.Call.MediaDirection.SEND_RECV?(e[0]._setRequestedDirection(h.Services.Call.MediaDirection.RECV_ONLY),h.Base.Logger.warn(h.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY: "+i.error),0===t.length?t.push(new h.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",h.Services.Call.MediaDirection.RECV_ONLY)):t[0].direction=h.Services.Call.MediaDirection.RECV_ONLY):a===h.Services.Call.MediaDirection.SEND_ONLY&&(e[0]._setRequestedDirection(h.Services.Call.MediaDirection.INACTIVE),h.Base.Logger.warn(h.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE: "+i.error),0!==t.length&&(t[0].direction=h.Services.Call.MediaDirection.INACTIVE))},getVideoOptions:function(e,t){var i,a,r=!1;if(h.Base.Utils.isDefined(e))for(var s=0;s<e.length;s++)e[s]._getInternalRequestedDirection()!==h.Services.Call.MediaDirection.INACTIVE&&e[s].getNegotiatedDirection()!==h.Services.Call.MediaDirection.DISABLE&&(r=!0,i=e[s].getChannelId(),t&&(a=t.getDeviceId()));return{enable:r,videoChannelId:i,videoDeviceId:a}},nextLowerVideoResolution:function(e){var t=S.map(h.Base.VideoResolution,function(e){return e}),i=t.indexOf(e);return i+1<t.length?t[i+1]:e},nextHighestVideoResolution:function(e){var t=S.map(h.Base.VideoResolution,function(e){return e}),i=t.indexOf(e);return 0!==i?t[i-1]:e}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.CallFsmEvent=function(e,t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e,t),this.data=t}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallFsmEventData=function(){this.cpCall=T,this.callProvider=T}}(),function(e){"use strict";function t(){e.Providers.Call.CallFsmEvent.call(this),this.audioDevice=T,this.videoDevice=T}t.prototype={},e.Providers.Call.ReplaceVideoStreamWithContentEventData=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Call.CallFsmEvent.call(this),this.audioDevice=T,this.videoDevice=T}t.prototype={},e.Providers.Call.UpdateLocalStreamEventData=t}(AvayaClientServices),function(e){"use strict";function t(){this.event=T}t.prototype={handleEvent:function(e){throw new Error("Cannot call abstract method")}},e.Providers.Call.AbstractEventHandler=t}(AvayaClientServices),function(h){"use strict";h.Providers.Call.AcceptCallEventInInitialHandler=function(e){var t,i,o=e.data.cpCall,c=e.data.callProvider,l=o._callGatewayProvider,d=e.data.videoChannel,C=!1,u=!1,a=e.data.audioDevice?e.data.audioDevice.getDeviceId():T,r=e.data.videoResolution||o.getVideoResolution();c.hasVideoDevices()&&h.Base.Utils.isDefined(d)&&(d._getInternalRequestedDirection()===h.Services.Call.MediaDirection.INACTIVE||d.isDisabled()||(C=!0,i=d.getChannelId(),e.data.videoDevice&&(t=e.data.videoDevice.getDeviceId()))),o.isNailedUpVideoConnectionSupported()&&!h.Base.Utils.isDefined(d)&&(u=C=!0,t=e.data.videoDevice?e.data.videoDevice.getDeviceId():T,(d=c._createVideoChannel_VideoMode(h.Services.Call.VideoMode.DISABLE))._setChannelId("NailedUp_"+d.getChannelId()),i=d.getChannelId(),o.call._videoChannels.push(d)),c.triggerCallEstablishing(o.call);var s=e.data.audioDevice?e.data.audioDevice.toString():"Default Audio",e=e.data.videoDevice?e.data.videoDevice.toString():"Default Camera";return h.Base.Logger.info(h.Base.LoggerTags.CALL_PROVIDER,"Accepting call using",s,e),c.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(o.call.getCallId(),!0,C,a,t,i,r).then(function(e){var t=e.stream;e.videoResolution&&o._updateVideoResolution(e.videoResolution),h.Base.Logger.debug(h.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var i,a=null,r=null,s=[],n=h.Services.Call.MediaDirection.SEND_RECV;if(t.getTracks().forEach(function(e){if("audio"===e.kind)a=new h.Providers.Interfaces.AudioStream(e.id,h.Services.Call.MediaDirection.SEND_RECV);else if("video"===e.kind){var t;if(u)n=h.Services.Call.MediaDirection.RECV_ONLY,t=h.Services.Call.MediaDirection.INACTIVE;else if(o.incomingCallInfo.videoStreams&&0<o.incomingCallInfo.videoStreams.length){switch(o.incomingCallInfo.videoStreams[0].direction){case h.Services.Call.MediaDirection.SEND_ONLY:n=h.Services.Call.MediaDirection.RECV_ONLY;break;case h.Services.Call.MediaDirection.RECV_ONLY:n=h.Services.Call.MediaDirection.SEND_ONLY;break;default:n=o.incomingCallInfo.videoStreams[0].direction}t=n}r=new h.Providers.Interfaces.VideoStream(e.id,n),o.isNailedUpVideoConnectionSupported()&&(r.logicalDirection=t),s.push(r)}}),null===a)return h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.MICROPHONE_NOT_FOUND]);C&&0===s.length&&o.isNailedUpVideoConnectionSupported()&&(i=c.getActiveCallVideoTrack(),h.Base.Utils.isDefined(i)&&(t.addTrack(i.clone()),(r=new h.Providers.Interfaces.VideoStream(i.id,n)).logicalDirection=o.getReversedVideoChannelDirection(o.incomingCallInfo.videoStreams[0].logicalDirection),s.push(r))),(!C||0===s.length)&&d&&!d.isDisabled()&&o.incomingCallInfo.videoStreams&&0<o.incomingCallInfo.videoStreams.length&&o.incomingCallInfo.videoStreams[0].enabled&&(e.constraint&&o.call.getVideoChannels()[0]._setCameraConstraint(e.constraint),n=o.incomingCallInfo.videoStreams[0].direction===h.Services.Call.MediaDirection.INACTIVE||o.incomingCallInfo.videoStreams[0].direction===h.Services.Call.MediaDirection.RECV_ONLY?h.Services.Call.MediaDirection.INACTIVE:h.Services.Call.MediaDirection.RECV_ONLY,r=new h.Providers.Interfaces.VideoStream(1,n),o.isNailedUpVideoConnectionSupported()&&(r.logicalDirection=u?h.Services.Call.MediaDirection.INACTIVE:n),s.push(r)),o.setAVStreams(a,s),o.localStream=t;t=o._rtConnection;t&&(o.updateIceServers(o.incomingCallInfo.turnData)&&t.updatePeerConfiguration(o._rtcConfiguration),t.addStream(o.localStream),t.disableLocalStreams(),t.onAddStream=function(e){o.handleEvent(new h.Providers.Call.OnAddStreamEvent({newStream:e}))},t.createAnswer(o.incomingCallInfo.sdp,function(e){0<s.length&&!h.Base.SDPUtil.hasH264(e.sdp)&&o.isFirefoxBrowser()&&(h.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),o.disableVideoStreamsAndChannels(h.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),l.acceptCall(o.callId,e.type,e.sdp,o.getAudioStream(),o.getVideoStreams()).fail(function(e){h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Failed to send accept call",e),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.SEND_ERROR])})},function(e){h.Base.Utils.isDefined(e.errorCode)?(h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.INTERNAL_ERROR]))},function(e){return e=0<s.length&&s[0].enabled?h.Providers.Call.Utils.updateVideoSdp(s[0],e):h.Base.SDPUtil.rejectMedia(e,"m=video")}))},function(e){var t="Error while retrieving local stream: "+JSON.stringify(e);h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,t),e.getError&&e.getError()?o.callFailure(e.getError()):c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.MEDIA_CREATION_FAILURE])}),{nextState:h.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AcceptCallRequestEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=e.data.deferred;i.acceptCallRequest(t.callId,t.getCallRequestedTransactionalId(e.data.requestedType),e.data.action).done(function(){a.resolve()},function(e){a.reject(e)})}}(),function(l){"use strict";l.Providers.Call.AcceptSendVideoEventInActiveHandler=function(e){var i=e.data.cpCall,t=e.data.callProvider,a=i._callGatewayProvider,r=i.call.getVideoChannels(),s=i.getVideoStreams();if(clearTimeout(i.incomingVideoRequestTimer),t.isVideoConfigurationEnabled()&&t.hasVideoDevices()){var n,o=r[0].getChannelId();l.Base.Utils.isDefined(e.data.videoDevice)&&(n=e.data.videoDevice.getDeviceId()),0===(s=i.getVideoStreams()).length&&(s.push(new l.Providers.Interfaces.VideoStream(0,l.Services.Call.MediaDirection.RECV_ONLY)),0!==r.length&&r[0]._setNegotiatedDirection(l.Services.Call.MediaDirection.RECV_ONLY));var c=function(){var e=i.incomingCallInfo;s=i.getVideoStreams(),i.updateIceServers(e.turnData)&&i._rtConnection.updatePeerConfiguration(i._rtcConfiguration),s[0].direction!==l.Services.Call.MediaDirection.SEND_ONLY&&s[0].direction!==l.Services.Call.MediaDirection.DISABLE&&(s[0].direction=l.Services.Call.MediaDirection.SEND_RECV,i.isNailedUpVideoConnectionSupported()&&(s[0].logicalDirection=l.Services.Call.MediaDirection.SEND_RECV)),i._latestVideoModeDirection=s[0].direction,i.isLocalVideoMuted()&&i.muteLocalVideo(),a.updateVideo(i.callId,i.getAudioStream(),i.getVideoStreams()).then(function(){i.notifyCallServiceOfMediaChanges()},function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+e),i.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.SEND_ERROR)),i.revertFsmState(l.Providers.Call.States.ACTIVE)})}.bind(this);return i.isNailedUpVideoConnectionSupported()?c():(0<(r=i.localStream.getVideoTracks()).length&&(r[0].stop(),i.localStream.removeTrack(r[0])),t.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(n,o,i.localStream,e.data.videoResolution,i._rtConnection,i.backgroundBlur,i.backgroundImage).then(function(){l.Base.Logger.debug(l.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success"),c()},function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to add video to local media stream: ",e);var t=l.Services.Call.CallError.MEDIA_CREATION_FAILURE;e.getError()===l.Services.Call.CallError.CAMERA_PERMISSION_DENIED&&(t=l.Services.Call.CallError.CAMERA_PERMISSION_DENIED),i.rejectMediaTransaction(new l.Services.Call.CallException(t)),i.revertFsmState(l.Providers.Call.States.ACTIVE)})),{nextState:l.Providers.Call.States.ACTIVE_RENEGOTIATE}}l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to accept send video - no video configured"),i.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.VIDEO_DENIED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider;i._callGatewayProvider.addParticipantFromCall(i.callId,t.data.participantCallId,i.getAudioStream(),i.getVideoStreams()).then(function(){},function(e){a._updateConsultConferenceStatusHandler(t.data.participantCallId,"ERROR: "+e.errorMsg,i.callId)})}}(),function(d){"use strict";d.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=t.getVideoStreams(),r=e.data.videoStreams,s=e.data.audioStream,n=t.call.getVideoChannels(),o=r&&0<r.length?t.getStreamDirection(r[0]):T,s=t.getStreamDirection(s);if(o!==d.Services.Call.MediaDirection.INACTIVE&&t._rtConnection.enableRemoteVideoStreams(),s!==d.Services.Call.MediaDirection.INACTIVE&&t._rtConnection.enableRemoteAudioStream(),t.call.isAudioMuted()||e.data.action===d.Providers.Call.CallProvider.Constants.HOLD||t._rtConnection.enableLocalAudioStreams(),e.data.action===d.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)t.isNailedUpVideoConnectionSupported()||t.removeLocalVideoTracks(),(o===d.Services.Call.MediaDirection.INACTIVE||r&&0<r.length&&r[0].state===d.Providers.Call.CallProvider.Constants.DISABLE_STATE)&&(0<n.length&&(n[0]._setNegotiatedDirection(d.Services.Call.MediaDirection.INACTIVE),n[0]._setVideoDisabledReason(d.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),i.triggerVideoChannelUpdate(t.call));else{t.updateVideoStreamsDirection(r,e.data.action),t.updateVideoChannelDirection(r);for(var c=0;c<a.length;c++){var l=t.getStreamDirection(a[c]);l===d.Services.Call.MediaDirection.INACTIVE||l===d.Services.Call.MediaDirection.DISABLE?(n[c]._setNegotiatedDirection(l),n[c]._setVideoDisabledReason(d.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)):(t.setVideoChannelId(n[c].getChannelId()),l=n[c].getNegotiatedDirection(),e.data.action===d.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&l!==d.Services.Call.MediaDirection.SEND_RECV&&l!==d.Services.Call.MediaDirection.SEND_ONLY?t.isNailedUpVideoConnectionSupported()||t.removeLocalVideoTracks():l!==d.Services.Call.MediaDirection.SEND_RECV&&l!==d.Services.Call.MediaDirection.SEND_ONLY||e.data.action===d.Providers.Call.CallProvider.Constants.HOLD?l!==d.Services.Call.MediaDirection.RECV_ONLY&&l!==d.Services.Call.MediaDirection.INACTIVE||t.disableLocalVideoStreams(l):t.enableLocalVideoStreams(l),t._rtConnection.hasVideo(t.remoteStream)?i.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(n[c].getChannelId(),t.remoteStream):i.getMediaServiceFactory().getVideoInterfaceService().removeRemoteMediaStream(n[c].getChannelId())),i.triggerVideoChannelUpdate(t.call);break}}return t.resolveMediaTransaction(),{nextState:d.Providers.Call.States.ACTIVE,nextEvent:t.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(c){"use strict";c.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler=function(i){var a=i.data.cpCall,r=i.data.callProvider,e=a._rtConnection,s=a.getVideoStreams(),n=a.call.getVideoChannels(),o=a.call;return a.updateAudioVideoStreamsDirection(i.data.audioStream,i.data.videoStreams,i.data.action),c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+i.data.answer),e.receiveAnswer(i.data.answer,function(){if(a.notifyCallServiceOfMediaChanges(),i.data.action===c.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)a.removeLocalVideoTracks(),r.triggerVideoChannelUpdate(a.call);else if(0<i.data.videoStreams.length&&i.data.videoStreams[0].maxHeight!==a._videoResolution._height)a.adjustVideoConstraints.call(a,i.data.videoStreams[0].maxWidth,i.data.videoStreams[0].maxHeight,i.data.videoStreams[0].maxFrames);else if(o.getState()===c.Services.Call.CallStates.HOLDING||o.isHeldRemotely())for(var e=0;e<s.length;e++){var t=a.getStreamDirection(s[e]);t!==c.Services.Call.MediaDirection.INACTIVE&&t!==c.Services.Call.MediaDirection.DISABLE||(n[e]._setNegotiatedDirection(t),n[e]._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER))}a.resolveMediaTransaction()},function(e){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+e),a.rejectMediaTransaction(new c.Services.Call.CallException(c.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:c.Providers.Call.States.ACTIVE,nextEvent:a.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.AnswerSDPEventInMultipleHandler=function(e){var i=e.data.cpCall,t=(e.data.callProvider,i._callGatewayProvider),a=i._rtConnection;if(n.Base.Logger.debug(n.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+e.data.answer),0<(r=i.getVideoStreams()).length){var r=i.getStreamDirection(r[0]),s=i.getStreamDirection(e.data.videoStreams[0]);if(r!==n.Services.Call.MediaDirection.INACTIVE&&s===n.Services.Call.MediaDirection.INACTIVE&&n.Base.Utils.getBrowserType()===n.Base.BrowserType.EDGE)return void(e.data.action===n.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?i.callFailure(n.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,n.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):i.callFailure(n.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,n.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"))}(s=e.data.videoStreams)&&0<s.length&&(i.updateVideoChannelDirectionBasedOnVideoMode(s),i.updateVideoStreamsDirectionBasedOnVideoMode(s),s.forEach(function(e){var t=i.getStreamDirection(e);!n.Services.Call.MediaDirection._isDisabled(t)&&e.enabled||n.Base.Utils.getBrowserType()!==n.Base.BrowserType.EDGE&&i._hasReceivedCallEstablishedEvent&&i.removeLocalVideoTracks()})),e.data.audioStream&&!e.data.audioStream.enabled&&a.removeLocalAudioTrack(i.localStream),a.receiveAnswer(e.data.answer,function(){t.answerSDPResponse(i.callId,i.getAudioStream(),i.getVideoStreams()),0<e.data.videoStreams.length&&i._videoResolution._height!==e.data.videoStreams[0].maxHeight&&(i.adjustVideoConstraints(e.data.videoStreams[0].maxWidth,e.data.videoStreams[0].maxHeight,e.data.videoStreams[0].maxFrames),n.Base.Utils.isDefined(e.data.videoBandwidth)&&i._updateVideoBandwidth(e.data.videoBandwidth))},function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+e)})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.AttendedTransferEventInActiveHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.attendedTransfer(t.callId,e.data.targetCallId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t._transferPromise.reject(new i.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg))})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.AudioEndedEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&t._replaceAudioTrackIfNeeded(!0).always(function(){e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream])})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.BlockCameraEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;return t.disableLocalVideoStreams(a.Services.Call.MediaDirection.RECV_ONLY),e.data.deallocateCamera&&t._rtConnection.removeLocalVideoTrack(t.localStream),i.blockUnBlockCamera(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to block camera: "+e),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(d){"use strict";d.Providers.Call.CallEstablishedEventInMultipleHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;t.remoteStream&&t._rtConnection.enableRemoteStreams(),t.updateAudioStreamDirection(e.data.audioStream),t.updateAudioChannelDirection(t.getAudioStream()),t.execQueuedVideoMuteUnmuteFunctor(),t.call.isAudioMuted()||t.call.getAudioChannel().getRequestedDirection()===d.Services.Call.MediaDirection.DISABLE||t.call.getState()===d.Services.Call.CallStates.HELD||t._rtConnection.enableLocalAudioStreams();var a=t.getVideoStreams(),r=e.data.videoStreams,s=t.call.getVideoChannels();if(r&&0<r.length){t.updateVideoChannelDirectionBasedOnVideoMode(r),t.updateVideoStreamsDirectionBasedOnVideoMode(r);for(var n=0;n<s.length&&n<a.length;n++){var o=t.getStreamDirection(a[n]);if(!d.Services.Call.MediaDirection._isDisabled(o)){t.setVideoChannelId(s[n].getChannelId());var c=t.getStreamDirection(r[n]);d.Services.Call.MediaDirection._isDisabled(c)||!r[n].enabled?d.Base.Utils.getBrowserType()!==d.Base.BrowserType.EDGE&&t.removeLocalVideoTracks():(o!==d.Services.Call.MediaDirection.SEND_RECV&&o!==d.Services.Call.MediaDirection.SEND_ONLY||t.call.getState()===d.Services.Call.CallStates.HELD||t.enableLocalVideoStreams(),t._rtConnection.hasVideo(t.remoteStream)&&i.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(s[n].getChannelId(),t.remoteStream)),i.triggerVideoChannelUpdate(t.call,s[n]);break}}}var l=i.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return t.remoteStream&&!l.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())&&d.Base.Logger.info(d.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."),d.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),i.triggerCallEstablished(t.call,e.data.isConf,e.data.uccpUrl,e.data.webCollabUrl,e.data.isRemote,e.data.ucid,e.data.parentUcid,e.data.contextId),{nextState:d.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(c){"use strict";c.Providers.Call.CallFailureEventInActiveRenegotiateHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=i.getAudioStream(),s=i.getVideoStreams();if(i.getMediaTransactionInitialEvent())switch(i.getMediaTransactionInitialEvent().stringValue){case c.Providers.Call.EscalateVideoEvent.stringValue:i.removeLocalVideoTracks();break;case c.Providers.Call.DeEscalateVideoEvent.stringValue:case c.Providers.Call.BlockCameraEvent.stringValue:i.enableLocalVideoStreams();break;case c.Providers.Call.UnBlockCameraEvent.stringValue:i.disableLocalVideoStreams();break;case c.Providers.Call.HoldEvent.stringValue:i.enableLocalStreams(),r.direction=c.Services.Call.MediaDirection.SEND_RECV;for(var n=0;n<s.length;n++)i.call.getVideoChannels()[n]&&(s[n].direction=i.call.getVideoChannels()[n].getNegotiatedDirection());i.setAVStreams(r,s);break;case c.Providers.Call.UnHoldEvent.stringValue:i.disableLocalStreams(),r.direction=c.Services.Call.MediaDirection.SEND_ONLY;for(var o=0;o<s.length;o++)s[o].direction=c.Services.Call.MediaDirection.INACTIVE}return e.data.errorCode===c.Services.Call.CallError.MEDIA_PRESERVED&&i&&i.call&&(e.data.callProvider.triggerCallServiceUnavailable(i.call),e.data.callProvider._callsAnalyticsService.sendUnavailableEvent(c.Services.Analytics.AnalyticsErrorCode.MEDIA_PRESERVED_ERROR)),i.mediaTransactionDfd?(t=e.data.errorCode===c.Services.Call.CallError.VIDEO_DENIED?e.data.errorCode:c.Services.Call.CallError.CALL_STATE_MISMATCH,i.rejectMediaTransaction(new c.Services.Call.CallException(t))):a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason),{nextState:c.Providers.Call.States.ACTIVE,nextEvent:i.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(c){"use strict";function l(e){c.Base.Logger.info("Initiating ICE restart with relay only"),e.setIceRestartRelayType(c.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY),e.iceConnectionFailedHandler()}c.Providers.Call.CallFailureEventInMultipleHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=5e6===e.data.protocolErrorCode&&-1!==e.data.failureReason.indexOf("415 Media Failed"),s=422002===e.data.protocolErrorCode&&-1!==e.data.failureReason.indexOf("Notification rejected"),n=!c.Base.Utils.isUndefined(i.call.getEstablishedTime()),o=e.data.protocolErrorCode===c.Providers.CallServiceGateway.Constants.SEE_OTHER_RESOURCE;!n||r?(t="all"===i._rtcConfiguration.iceTransportPolicy,r=!!i._rtcConfiguration.iceServers&&0<i._rtcConfiguration.iceServers.length&&!!i._rtcConfiguration.iceServers[0].urls&&0<i._rtcConfiguration.iceServers[0].urls.length,r=t&&r&&i.getIceRestartRelayType()!==c.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY,n?i._hadMediaConnected?(c.Base.Logger.error("Initiating ICE restart with "+i.getIceRestartRelayType()),i._processIceConnectionStateChange(i.getIceConnectionState(),!0)):r?l(i):s||a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason):r?l(i):(c.Base.Logger.error("Initiating ICE restart with "+i.getIceRestartRelayType()),i._processIceConnectionStateChange(i.getIceConnectionState(),!0))):o?(i._rtConnection.updatePeerConnection(i._rtConnection._rtcConfig),c.Base.Logger.info("Initiating ICE restart due to the 303 See Other"),i.iceConnectionFailedHandler()):s||a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason)}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallRingingEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;a.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),t.call._isPrivateCallerID=!!a.Base.Utils.isDefined(e.data.isPrivate)&&e.data.isPrivate,t.call._isAuraAsserted=!!a.Base.Utils.isDefined(e.data.isAuraAsserted)&&e.data.isAuraAsserted,i.triggerCallRinging(t.call,e.data.earlyMedia)}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.CallRingingEventInStartingHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=t._rtConnection,r=i.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return s.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),t.call._isPrivateCallerID=!!s.Base.Utils.isDefined(e.data.isPrivate)&&e.data.isPrivate,t.call._isAuraAsserted=!!s.Base.Utils.isDefined(e.data.isAuraAsserted)&&e.data.isAuraAsserted,i.triggerCallRinging(t.call,e.data.earlyMedia,e.data.ucid,e.data.parentUcid,e.data.contextId),s.Base.Utils.isDefined(e.data.earlyMedia)&&(t._isEarlyMedia=e.data.earlyMedia,t._isEarlyMedia&&t.remoteStream&&!r.isPlaying(t.remoteStream)&&(a.enableRemoteStreams(),t.call.isAudioMuted()||a.enableLocalAudioStreams(),r.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())||s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."))),{nextState:s.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.DeEscalateVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,e=t._callGatewayProvider,a=t.call.getVideoChannels();t.disableLocalVideoStreams();for(var r=t.getVideoStreams(),s=0;s<r.length;s++)t.isNailedUpVideoConnectionSupported()?(r[s].direction=n.Services.Call.MediaDirection.RECV_ONLY,r[s].logicalDirection=n.Services.Call.MediaDirection.INACTIVE):r[s].direction=n.Services.Call.MediaDirection.INACTIVE,r[s].enabled=!1,i.triggerVideoChannelUpdate(t.call,a[s]);return e.deEscalateVideo(t.callId,t.getAudioStream(),r).then(function(){t.stopPerformanceMonitoring()},function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Failed to deescalate video: "+e),t.rejectMediaTransaction(new n.Services.Call.CallException(n.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(n.Providers.Call.States.ACTIVE)}),{nextState:n.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.DenySendVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;0<(e=t.getVideoStreams()).length&&(t._latestVideoModeDirection=e[0].direction,t._latestNonHoldingVideoDirection=e[0].direction),clearTimeout(t.incomingVideoRequestTimer),i.triggerIncomingAddVideoDenied(t.call)}}(),function(r){"use strict";r.Providers.Call.DevicesFailureHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=e.data.callError||r.Services.Call.CallError.DEVICES_NOT_FOUND;return i.trigger(r.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,a]),{nextState:e.data.nextState}}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.EndCallEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=new r.Providers.Call.EndCallResponseEvent;return a.data={},t.stopAllStreams(),t.setVideoChannelId(T),a.data.remote=e.data.remote,a.data.host=e.data.cpCall._callGatewayProvider._host,e.data.remote?(a.data.callReason=e.data.callReason,{nextState:r.Providers.Call.States.ENDING,nextEvent:t.prepareEvent(a)}):(i.endCall(t.callId,e.data.denialReason).then(function(){t.handleEvent(a)},function(e){t.handleEvent(a)}),{nextState:r.Providers.Call.States.ENDING})}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.EndCallResponseEventInEndingHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=i.popQueuedRemoteCallEstablishedEvent();i.localStream=null,i.remoteStream=null,i._rtConnection&&(i._rtConnection.close(),i._rtConnection=null),o.Base.Utils.isDefined(i.mediaTransactionDfd)&&"pending"===i.mediaTransactionDfd.state()&&i.mediaTransactionDfd.reject(new o.Services.Call.CallException(o.Services.Call.CallError.ENDED)),a.unRegisterCall(i.call)&&a.triggerCallEnded(i.call,e.data.remote,e.data.callReason),r&&(t=(n=r.data.cpCall).call,a.callEstablished(t.getCallId(),t.getRemoteAddress(),t.getRemoteDisplayName(),t.getSubject(),r.data.isRemote,t.isCallerIdentityPrivate(),t.getAlertType(),t._isAuraAsserted,n.getAudioStream(),n.getVideoStreams()));var s=i._callGatewayProvider._host,n=i.call._callService._callManager.getAllCalls().filter(function(e){return!!e.getCallId()&&(!!a._cpCalls[e.getCallId()]&&a._cpCalls[e.getCallId()]._callGatewayProvider._host===s)});return i.call._callCreationInfo&&i.call._callCreationInfo.getAuthorizationToken()!==T&&!n.length&&a.stop(e.data.host),{nextState:o.Providers.Call.States.ENDED}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.EscalateNailedUpVideoEventInActiveHandler=function(e){var t=e.data.cpCall,e=t._callGatewayProvider;return t.enableLocalVideoStreams(),e.escalateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t.disableLocalVideoStreams(),i.Base.Logger.error(i.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate nailedup video: "+e),t.rejectMediaTransaction(new i.Services.Call.CallException(i.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(i.Providers.Call.States.ACTIVE)}),{nextState:i.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler=function(t){var i=t.data.cpCall,e=i._rtConnection;return i.updateVideoStreamsDirection(t.data.videoStreams,t.data.action),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+t.data.answer),e.receiveAnswer(t.data.answer,function(){var e=i.getVideoStreams();0<e.length&&(i.adjustVideoConstraints(t.data.videoStreams[0].maxWidth,t.data.videoStreams[0].maxHeight,t.data.videoStreams[0].maxFrames),(e=i.getStreamDirection(e[0]))===a.Services.Call.MediaDirection.RECV_ONLY?i.disableLocalVideoStreams(e):e!==a.Services.Call.MediaDirection.SEND_RECV&&e!==a.Services.Call.MediaDirection.SEND_ONLY&&i.removeLocalVideoTracks()),i.notifyCallServiceOfMediaChanges(),i.resolveMediaTransaction(),i.sendMuteUnmuteVideo()},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Video escalation failed while receiving answer SDP: "+e),i.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:i.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.EscalateVideoEventInActiveHandler=function(e){var t,a=e.data.cpCall,i=e.data.callProvider,r=a._callGatewayProvider,s=a.call.getVideoChannels(),n=s[0].getChannelId();return o.Base.Utils.isDefined(e.data.videoDevice)&&(t=e.data.videoDevice.getDeviceId()),a.setVideoChannelId(s[0].getChannelId()),i.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(t,n,a.localStream,e.data.videoResolution,a._rtConnection,a.backgroundBlur,a.backgroundImage).then(function(e){o.Base.Logger.debug(o.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var t=a.getAudioStream(),i=[];e.getTracks().forEach(function(e){var t;e.kind===o.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&e.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(t=s[0]._getInternalRequestedDirection(),i.push(new o.Providers.Interfaces.VideoStream(e.id,t)))}),a.setAVStreams(t,i),a.isLocalVideoMuted()&&a.muteLocalVideo(),r.escalateVideo(a.callId,a.getAudioStream(),a.getVideoStreams()).then(function(){a.startPerformanceMonitoring()},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate video: "+e),a.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),a.removeLocalVideoTracks(),a.revertFsmState(o.Providers.Call.States.ACTIVE)})},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. "+e),e.getError()===o.Services.Call.CallError.CAMERA_PERMISSION_DENIED||e.getError()===o.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(a.rejectMediaTransaction(e),a.revertFsmState(o.Providers.Call.States.ACTIVE)):(s[0]._negotiatedDirection=o.Services.Call.MediaDirection.INACTIVE,a.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.MEDIA_CREATION_FAILURE)),a.deviceRetrievalFailure(o.Providers.Call.States.ACTIVE))}),{nextState:o.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(r){"use strict";function e(){r.Providers.Call.GetOfferSDPEventInMultipleHandler.call(this)}(e.prototype=Object.create(r.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){r.Providers.Call.GetOfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[e])},e.prototype.handleError=function(e){var t=this.event.data.cpCall,i=this.event.data.callProvider,a=t.call.getVideoChannels();t.removeLocalVideoTracks(),a[0]._setNegotiatedDirection(r.Services.Call.MediaDirection.DISABLE),a[0]._setVideoDisabledReason(r.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),i.triggerVideoChannelUpdate(t.call),t.rejectMediaTransaction(e),t.revertFsmState(r.Providers.Call.States.ACTIVE)},r.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler=e}(AvayaClientServices),function(a){"use strict";function e(){a.Providers.Call.OfferSDPEventInMultipleHandler.call(this)}(e.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){a.Providers.Call.OfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[e])},e.prototype.handleError=function(e){var t=this.event.data.cpCall,i=t.call.getVideoChannels();t.removeLocalVideoTracks(),i[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),i[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),t.rejectMediaTransaction(e),t.revertFsmState(a.Providers.Call.States.ACTIVE)},a.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler=e}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,e=t.call.getVideoChannels();return t.removeLocalVideoTracks(),e[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),e[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),i.triggerVideoChannelUpdate(t.call),t._rtConnection.rollbackLocalOfferState(),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.VIDEO_DENIED)),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:t.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(C){"use strict";function u(){C.Providers.Call.AbstractEventHandler.call(this)}(u.prototype=Object.create(C.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){var t=e.data.cpCall,i=null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&0<t.videoStreams.length&&t.videoStreams[0].enabled;t._replaceAudioTrackIfNeeded().always(function(){i&&e.data.videoResolution&&(t._videoResolution.getWidth()>e.data.videoResolution.getWidth()||t._videoResolution.getHeight()>e.data.videoResolution.getHeight())?t._rtConnection.isRTCRtpSenderSupported()?C.Providers.Call.CPUtils.updateVideoResolution(t,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,u.prototype.getOffer.bind(this),u.prototype.errorHandler.bind(this),e):C.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,u.prototype.getOffer.bind(this),u.prototype.errorHandler.bind(this),e):u.prototype.getOffer.call(this,t,e)}.bind(this))},u.prototype.getOffer=function(t,i){var a=i.data.callProvider,r=t._callGatewayProvider,e=t._rtConnection;i.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration,i.data.restartTurnGathering),e.onAddStream=function(e){t.handleEvent(new C.Providers.Call.OnAddStreamEvent({newStream:e,action:i.data.action}))};var s,n,o,c=t.getVideoStreams(),l=!1;switch(i.data.action){case C.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:a.triggerRemoteHold(t.call);break;case C.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:a.triggerRemoteUnhold(t.call);break;case C.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:0<i.data.videoStreams.length&&(i.data.videoStreams[0].direction===C.Services.Call.MediaDirection.SEND_RECV&&t._prevMediaAction===C.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?c[0].direction=C.Services.Call.MediaDirection.RECV_ONLY:(n=t.calculateUpdateVideoDirection(i.data.videoStreams[0]),C.Base.Utils.isDefined(n)&&(c[0].direction=n,t._latestNonHoldingVideoDirection=n)));break;case C.Providers.Call.CallProvider.Constants.UPDATE_VIDEO:s=t.getIceConnectionRestartTimestamp(),l=t.isCallServiceAvailable()&&!!s}var d=t.call.getVideoChannels();0<c.length?t.getStreamDirection(c[0])===C.Services.Call.MediaDirection.RECV_ONLY&&(o=C.Services.Call.MediaDirection.RECV_ONLY):0<d.length&&d[0].getNegotiatedDirection()===C.Services.Call.MediaDirection.DISABLE&&(o=C.Services.Call.MediaDirection.INACTIVE),e.createOffer(function(e){r.offerSDPResponse(t.callId,e,i.data.action,t.getAudioStream(),t.getVideoStreams()).then(function(){t.isIceRestartInProgress()&&t.setIceRestartInProgress(!1),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t)},function(e){C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while sending offer: "+e),this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.SEND_ERROR),t),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t)}.bind(this))}.bind(this),function(e){C.Base.Utils.isDefined(e.errorCode)?(C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer",e.errorMsg),a.trigger(C.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer: "+e),this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.INTERNAL_ERROR),t)),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t),l&&t.iceConnectionFailedHandler()}.bind(this),function(e){return e=0<c.length?C.Providers.Call.Utils.updateVideoSdp(c[0],e):C.Base.SDPUtil.rejectMedia(e,"m=video"),t.call.getState()===C.Services.Call.CallStates.HOLDING||t.call.getState()===C.Services.Call.CallStates.HELD||t.call.isHeldRemotely()?t.call.getState()!==C.Services.Call.CallStates.HELD&&t.call.getState()!==C.Services.Call.CallStates.HOLDING||(e=C.Providers.Call.Utils.updateAudioSdp(t.getAudioStream(),e)):e=C.Base.SDPUtil.updateAudioSdpSendRecv(e),e},o,l,s,i.data.useIPv6Candidates)},u.prototype.handleError=function(e,t){t.rejectMediaTransaction(e)},u.prototype.errorHandler=function(e){this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.MEDIA_CREATION_FAILURE),e),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,e)},u.prototype.resetFarEndRenegotiateStateIfNeeded=function(e){e.call.getState()===C.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.call._setState(C.Services.Call.CallStates.ESTABLISHED)},C.Providers.Call.GetOfferSDPEventInMultipleHandler=u}(AvayaClientServices),function(c){"use strict";c.Providers.Call.GetOfferSDPEventInStartingHandler=function(s){var e=s.data.cpCall,n=s.data.callProvider;e.setNailedUpVideoConnectionSupported(!1);var t=e.resetAudioOnlyNailedUpConnection();function i(e){e.deviceRetrievalFailure(c.Providers.Call.States.ACTIVE)}s.data.iceServerChanged&&e._rtConnection.updatePeerConfiguration(e._rtcConfiguration),e.updateAudioNoiseReduction(s.data.audioStream),e.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(s.data.videoStreams);var o=function(i){var a=i._callGatewayProvider,e=i._rtConnection;i._hasInitiatedMediaConnection=!0,e.onAddStream=function(e){i.handleEvent(new c.Providers.Call.OnAddStreamEvent({newStream:e}))};var t,r=i.getVideoStreams();0<r.length&&i.getStreamDirection(r[0])===c.Services.Call.MediaDirection.RECV_ONLY&&(t=c.Services.Call.MediaDirection.RECV_ONLY),e.createOffer(function(e){0<r.length&&!c.Base.SDPUtil.hasH264(e.sdp)&&i.isFirefoxBrowser()&&c.Base.Logger.warn(">>> H.264 video codec plugin is NOT installed <<<");var t=i.isMPaaSCall()?i.isLocalVideoMuted():T;a.getOfferSDPResponse(i.callId,e,i.getAudioStream(),i.getVideoStreams(),t).fail(function(e){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Failed to send get offer response",e),n.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,c.Services.Call.CallError.SEND_ERROR])})},function(e){c.Base.Utils.isDefined(e.errorCode)?(c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e.errorMsg),n.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e),e.includes("Failed to set local video description recv parameters")&&0<r.length?(i.videoStreams[0].direction===c.Services.Call.MediaDirection.SEND_RECV?(c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Retrying with recvonly video"),i.disableLocalVideoStreams(),i.videoStreams[0].direction=c.Services.Call.MediaDirection.RECV_ONLY):(c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Retrying with audio only"),i.removeLocalVideoTrack(i.localStream)),o(i)):n.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,c.Services.Call.CallError.INTERNAL_ERROR]))},function(e){return 0<r.length&&(e=c.Providers.Call.Utils.updateVideoSdp(r[0],e),r[0].enabled||(e=c.Base.SDPUtil.rejectMedia(e,"m=video"))),e},t,!1,0,s.data.useIPv6Candidates)},a=c.Base.Utils.isDefined(e.getNoiseSuppressionConstraints());e._replaceAudioTrackIfNeeded(!1,a).always(function(){null!==e.localStream&&e._rtConnection.hasVideo(e.localStream)&&(t||s.data.videoResolution&&s.data.videoResolution.getWidth()!==e._videoResolution.getWidth()&&s.data.videoResolution.getHeight()!==e._videoResolution.getHeight())?e._rtConnection.isRTCRtpSenderSupported()?c.Providers.Call.CPUtils.updateVideoResolution(e,s.data.callProvider.getMediaServiceFactory(),s.data.videoResolution,o,i,s):c.Providers.Call.CPUtils.createLocalMediaStream(s.data.audioDevice,s.data.videoDevice,e,s.data.callProvider.getMediaServiceFactory(),s.data.videoResolution,o,i,s):o(e)}.bind(this))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.HoldEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;t._rtConnection.disableLocalAudioStreams(),t.disableLocalVideoStreams();var e=t.getAudioStream(),a=t.getVideoStreams();t.isNailedUpVideoConnectionSupported()?e.logicalDirection=s.Services.Call.MediaDirection.SEND_ONLY:e.direction=s.Services.Call.MediaDirection.SEND_ONLY;for(var r=0;r<a.length;r++)t.isNailedUpVideoConnectionSupported()?(a[r].direction=s.Services.Call.MediaDirection.RECV_ONLY,a[r].logicalDirection=s.Services.Call.MediaDirection.INACTIVE):a[r].direction=s.Services.Call.MediaDirection.INACTIVE;return t.setAVStreams(e,a),i.holdCall(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to hold: "+e),t.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(s.Providers.Call.States.ACTIVE)}),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(C){"use strict";C.Providers.Call.IncomingAddVideoEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=i._callGatewayProvider,e=i._rtConnection,s=a._config.callUserConfiguration.incomingVideoRequestTimeout,n=a.isVideoConfigurationEnabled();C.Base.Utils.isDefined(s)||(s=C.Config.CallUserConfiguration.DefaultValues.INCOMING_VIDEO_REQUEST_TIMEOUT);var o,c,l=i.getAudioStream(),d=i.getVideoStreams();n&&(0===d.length?d.push(new C.Providers.Interfaces.VideoStream(0,C.Services.Call.MediaDirection.RECV_ONLY)):(d[0].enabled=t.data.videoStreams[0].enabled,d[0].direction=C.Services.Call.MediaDirection.RECV_ONLY),t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_RECV&&t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_ONLY&&i.updateVideoStreamsDirection(t.data.videoStreams,t.data.action),i._latestVideoModeDirection=d[0].direction,i._latestNonHoldingVideoDirection=d[0].direction,i.isNailedUpVideoConnectionSupported()&&(d[0].logicalDirection=d[0].direction,e.enableRemoteVideoStreams()),0===(c=i.call.getVideoChannels()).length?((o=a.createVideoChannel_MediaDirection(i.call,t.data.videoStreams[0].direction))._setNegotiatedDirection(C.Services.Call.MediaDirection.RECV_ONLY),c.push(o)):c[0]._setNegotiatedDirection(C.Services.Call.MediaDirection.RECV_ONLY),t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_RECV&&t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_ONLY&&i.updateVideoChannelDirection(t.data.videoStreams),a.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(c[0].getChannelId(),i.remoteStream),a.triggerVideoChannelUpdate(i.call)),e.createAnswer(t.data.offer,function(e){r.offerSDPResponse(i.callId,e,t.data.action,l,d).then(function(){n&&(i.incomingCallInfo={offer:t.data.offer,audioStream:t.data.audioStream,videoStreams:t.data.videoStreams,action:t.data.action},i.incomingVideoRequestTimer=setTimeout(function(){i.incomingVideoRequestTimedout()},s),a.triggerIncomingAddVideoRequest(i.call))})},function(e){C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"IncomingAddVideo error while creating answer: "+e)},function(e){return 0<d.length?C.Providers.Call.Utils.updateVideoSdp(d[0],e):C.Base.SDPUtil.rejectMedia(e,"m=video")})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Timed out waiting for incoming add video request to be accepted"),e.triggerIncomingAddVideoTimedout(t.call)}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.IncomingCallEstablishedEventInEndingHandler=function(e){var t=e.data.cpCall;e.data.isRemote&&t.setQueuedRemoteCallEstablishedEvent(e)}}(),function(o){"use strict";o.Providers.Call.IncomingGenericOfferSDPEventInActive=function(e){var t=e.data.cpCall,i=t.getVideoStreams(),a=t.call.getVideoChannels();switch(e.data.action){case o.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:var r=0===i.length||!1===i[0].enabled||t.isNailedUpVideoConnectionSupported()&&i[0].logicalDirection===o.Services.Call.MediaDirection.INACTIVE,s=0<a.length&&a[0].getNegotiatedDirection()===o.Services.Call.MediaDirection.DISABLE,n=r||s?new o.Providers.Call.IncomingAddVideoEvent(e.data):(i[0].enabled=!0,t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new o.Providers.Call.OfferSDPEvent(e.data));break;case o.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:n=e.data.videoStreams&&e.data.videoStreams[0].enabled?(i[0].enabled=!0,t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new o.Providers.Call.OfferSDPEvent(e.data)):new o.Providers.Call.IncomingRemoveVideoEvent(e.data);break;case o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:r=0===i.length||!1===i[0].enabled||t.isNailedUpVideoConnectionSupported()&&i[0].logicalDirection===o.Services.Call.MediaDirection.INACTIVE,s=0<a.length&&a[0].getNegotiatedDirection()===o.Services.Call.MediaDirection.DISABLE,n=r||s?(t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION,new o.Providers.Call.IncomingAddVideoEvent(e.data)):new o.Providers.Call.OfferSDPEvent(e.data);break;default:n=new o.Providers.Call.OfferSDPEvent(e.data)}return{nextState:T,nextEvent:n}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate=function(e){var t=e.data.cpCall;return i.Base.Logger.debug(i.Base.LoggerTags.CALL_PROVIDER,"Received incoming offer event while in ACTIVE_RENEGOTIATE. Queuing for later processing."),t.setQueuedActiveRenegotiateEvent(e),{nextState:T,nextEvent:T}}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.IncomingRemoveVideoEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=i._callGatewayProvider,e=i._rtConnection,s=i.call.getVideoChannels();function n(){i.call.getState()===o.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i.call._setState(o.Services.Call.CallStates.ESTABLISHED)}i.disableLocalVideoStreams(),e.disableRemoteVideoStreams(),i.updateVideoStreamsDirection(t.data.videoStreams,t.data.action),0<s.length&&(i.isNailedUpVideoConnectionSupported()||i.removeLocalVideoTracks(),s[0]._setNegotiatedDirection(o.Services.Call.MediaDirection.DISABLE),s[0]._setVideoDisabledReason(o.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)),a.triggerVideoChannelUpdate(i.call),e.createAnswer(t.data.offer,function(e){r.offerSDPResponse(i.callId,e,t.data.action,i.getAudioStream(),i.getVideoStreams()).then(function(){n()}.bind(this),function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",e),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,o.Services.Call.CallError.SEND_ERROR]),n()}.bind(this))},function(e){o.Base.Utils.isDefined(e.errorCode)?(o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,o.Services.Call.CallError.INTERNAL_ERROR])),n()})}}(AvayaClientServices),function(c){"use strict";c.Providers.Call.JoinRemoteCallEventInInitialHandler=function(e){var t,r=e.data.cpCall,i=e.data.callProvider,s=r._callGatewayProvider,a=e.data.audioDevice?e.data.audioDevice.getDeviceId():T,n=r._videoDevice?r._videoDevice.getDeviceId():T,o=r.isNailedUpVideoConnectionSupported()&&i.hasVideoDevices()&&i.isVideoAllowed();return o&&((e=i._createVideoChannel_VideoMode(c.Services.Call.VideoMode.DISABLE))._setInternalRequestedDirection(c.Services.Call.MediaDirection.RECV_ONLY),t="NailedUp_"+e.getChannelId(),e._setChannelId(t),r.call._videoChannels.push(e)),r._isReadyToReceiveMediaRequest=!0,i.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!0,o,a,n,t,r._videoResolution).then(function(e){e=e.stream;r.localStream=e,r._rtConnection.addStream(r.localStream),r._rtConnection.disableLocalStreams();var t,i=null,a=[];e.getTracks().forEach(function(e){"audio"===e.kind?i=new c.Providers.Interfaces.AudioStream(e.id,c.Services.Call.MediaDirection.SEND_RECV):"video"===e.kind&&r.isNailedUpVideoConnectionSupported()&&((e=new c.Providers.Interfaces.VideoStream(e.id,c.Services.Call.MediaDirection.RECV_ONLY)).logicalDirection=c.Services.Call.MediaDirection.INACTIVE,a.push(e),t=new c.Providers.Call.NailedUpVideoConnectionInfo(c.Services.Call.MediaDirection.INACTIVE,c.Services.Call.MediaDirection.RECV_ONLY))}),r.setAVStreams(i,a),s.joinRemoteCall(r.callId,r.getAudioStream(),r.getVideoStreams(),t).then(function(){r._joinRemotePromise.resolve()},function(e){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Failed to join to remote call: "+r.callId),r._joinRemotePromise.reject(new c.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg)),r.revertFsmState(c.Providers.Call.States.INITIAL)})},function(e){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams to join remote call. "+e),r._joinRemotePromise.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE)),r.revertFsmState(c.Providers.Call.States.INITIAL),r.handleEvent(new c.Providers.Call.DeviceRetrievalFailedEvent)}),{nextState:c.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.MuteAudioEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&(t.call._getIsContentVideoSharingStarted()?t.updateVideoSharingMicrophoneVolume(0):t._rtConnection.disableLocalAudioStreams(),e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.MuteSpeakerEventInMultipleHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;t.remoteStream&&e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().muteStream(t.remoteStream)}}(),function(a){"use strict";a.Providers.Call.MuteVideoEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;t.muteLocalVideo(),t.isMPaaSCall()?t.hasReceivedCallEstablishedEvent()?i.muteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).then(function(){t.noMediaTransactionDfd.resolve()},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+e),t.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))}):(t.queueMuteUnumteFunctor(function(){i.muteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).fail(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+e)})}),t.noMediaTransactionDfd.resolve()):t.noMediaTransactionDfd.resolve()}}(AvayaClientServices),function(u){"use strict";function h(){u.Providers.Call.AbstractEventHandler.call(this)}(h.prototype=Object.create(u.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){var t=(this.event=e).data.cpCall,i=e.data.callProvider,a=null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&0<t.videoStreams.length&&t.videoStreams[0].enabled;e.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration),u.Base.Utils.isDefined(e.data.videoBandwidth)&&t._updateVideoBandwidth(e.data.videoBandwidth),t._replaceAudioTrackIfNeeded().always(function(){a&&e.data.videoResolution&&(t._videoResolution.getWidth()>e.data.videoResolution.getWidth()||t._videoResolution.getHeight()>e.data.videoResolution.getHeight())?u.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,i.getMediaServiceFactory(),e.data.videoResolution,h.prototype.offerSDP.bind(this),h.prototype.errorHandler.bind(this),e):h.prototype.offerSDP.call(this,t,e)}.bind(this))},h.prototype.handleError=function(e){u.Base.Utils.isDefined(this.event.data.cpCall.mediaTransactionDfd)&&this.event.data.cpCall.rejectMediaTransaction(e)},h.prototype.errorHandler=function(e){this.handleError(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE)),h.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,e)},h.prototype.resetFarEndRenegotiateStateIfNeeded=function(e){e.call.getState()===u.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.call._setState(u.Services.Call.CallStates.ESTABLISHED)},h.prototype.offerSDP=function(i,a){var r=a.data.callProvider,s=i._callGatewayProvider,n=i._rtConnection,e=i.call.getVideoChannels();n.onAddStream=function(e){i.handleEvent(new u.Providers.Call.OnAddStreamEvent({newStream:e,action:a.data.action}))},i.updateAudioVideoStreamsDirection(a.data.audioStream,a.data.videoStreams,a.data.action);var t,o,c=i.getVideoStreams();if(!(0<c.length)||a.data.action!==u.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION&&(t=i._mediaAction,o=a.data.action,t!==u.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION||o!==u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION&&o!==u.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION)){if(0<c.length&&a.data.action===u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&0<a.data.videoStreams.length&&(a.data.videoStreams[0].direction===u.Services.Call.MediaDirection.INACTIVE||a.data.videoStreams[0].direction===u.Services.Call.MediaDirection.DISABLE))for(var l=0;l<c.length;l++)e[l]._setNegotiatedDirection(a.data.videoStreams[0].direction),e[l]._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}else{var d,C=i.getStreamDirection(c[0]);C===u.Services.Call.MediaDirection.SEND_RECV&&i._prevMediaAction===u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?C=u.Services.Call.MediaDirection.RECV_ONLY:0<a.data.videoStreams.length&&(d=i.calculateUpdateVideoDirection(a.data.videoStreams[0]),u.Base.Utils.isDefined(d)&&(C=d,i._latestNonHoldingVideoDirection=d)),i.isNailedUpVideoConnectionSupported()?c[0].logicalDirection=C:c[0].direction=C}n.createAnswer(a.data.offer,function(e){switch(a.data.action){case u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:i.call.isAudioMuted()||i.audioStream.direction!==u.Services.Call.MediaDirection.RECV_ONLY&&i.audioStream.direction!==u.Services.Call.MediaDirection.INACTIVE||n.disableLocalAudioStreams(),r.triggerRemoteHold(i.call);break;case u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:i.call.isAudioMuted()||i.audioStream.direction!==u.Services.Call.MediaDirection.SEND_RECV&&i.audioStream.direction!==u.Services.Call.MediaDirection.SEND_ONLY||n.enableLocalAudioStreams(),r.triggerRemoteUnhold(i.call)}var t;0<c.length&&((t=i.getStreamDirection(c[0]))!==u.Services.Call.MediaDirection.RECV_ONLY&&t!==u.Services.Call.MediaDirection.INACTIVE||i.disableLocalVideoStreams(t)),i.notifyCallServiceOfMediaChanges(a.data.action),s.offerSDPResponse(i.callId,e,a.data.action,i.getAudioStream(),i.getVideoStreams()).then(function(){h.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this),function(e){u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while sending answer: "+e),this.handleError(new u.Services.Call.CallException(u.Services.Call.CallError.SEND_ERROR)),h.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this))}.bind(this),function(e){u.Base.Utils.isDefined(e.errorCode)?(u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer",e.errorMsg),r.trigger(u.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer: "+e),this.handleError(new u.Services.Call.CallException(u.Services.Call.CallError.INTERNAL_ERROR))),h.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this),function(e){return e=0<c.length&&(c[0].enabled||i.isNailedUpVideoConnectionSupported())?u.Providers.Call.Utils.updateVideoSdp(c[0],e):u.Base.SDPUtil.rejectMedia(e,"m=video"),i.call.getState()===u.Services.Call.CallStates.HOLDING||i.call.getState()===u.Services.Call.CallStates.HELD||i.call.isHeldRemotely()||a.data.action===u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION?i.call.getState()!==u.Services.Call.CallStates.HELD&&i.call.getState()!==u.Services.Call.CallStates.HOLDING||(e=u.Providers.Call.Utils.updateAudioSdp(i.getAudioStream(),e)):e=a.data.audioStream.direction!==u.Services.Call.MediaDirection.SEND_ONLY?u.Base.SDPUtil.updateAudioSdpSendRecv(e):u.Providers.Call.Utils.updateAudioSdp(i.getAudioStream(),e),e})},u.Providers.Call.OfferSDPEventInMultipleHandler=h}(AvayaClientServices),function(n){"use strict";function a(t,i){var a=t._callGatewayProvider,r=i.data.callProvider,e=t._rtConnection;e.onAddStream=function(e){t.handleEvent(new n.Providers.Call.OnAddStreamEvent({newStream:e}))};var s=t.getVideoStreams();e.createAnswer(i.data.offer,function(e){0<s.length&&0<i.data.videoStreams.length&&!n.Base.SDPUtil.hasH264(e.sdp)&&t.isFirefoxBrowser()&&(n.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),t.disableVideoStreamsAndChannels(n.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),n.Base.Utils.isDefined(i.data.videoBandwidth)&&t._updateVideoBandwidth(i.data.videoBandwidth),a.offerSDPResponse(t.callId,e,i.data.action,t.getAudioStream(),s).fail(function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",e),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,n.Services.Call.CallError.SEND_ERROR])})},function(e){n.Base.Utils.isDefined(e.errorCode)?(n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,n.Services.Call.CallError.INTERNAL_ERROR]))})}function r(e){e.revertFsmState(n.Providers.Call.States.ACTIVE)}n.Providers.Call.OfferSDPEventInStartingHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;t.determineIfNailedUpVideoConnectionSupported(e.data.videoStreams),e.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration),t.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(e.data.videoStreams),t._replaceAudioTrackIfNeeded().always(function(){null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&e.data.videoResolution&&e.data.videoResolution.getWidth()!==t._videoResolution.getWidth()&&e.data.videoResolution.getHeight()!==t._videoResolution.getHeight()?n.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,i.getMediaServiceFactory(),e.data.videoResolution,a,r,e):a(t,e)}.bind(this))}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.OnAddRemoteTrackEventInActiveHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider;r.Base.Logger.debug(r.Base.LoggerTags.CALL_PROVIDER,">>> Add new remote track: "+e.data.newTrack.kind+" id: "+e.data.newTrack.id),e.data.newTrack.kind===r.Providers.Call.CallProvider.Constants.VIDEO_TRACK?0<(t=i.call.getVideoChannels()).length&&(i._rtConnection.enableRemoteVideoTrack(i.remoteStream,e.data.newTrack),a.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(t[0].getChannelId(),i.remoteStream),a.triggerVideoChannelUpdate(i.call)):(t=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),i.remoteStream&&!t.playAudioStream(i.remoteStream,i.call.isSpeakerMuted())&&r.Base.Logger.info(r.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not replay remote audio."),a.trigger(r.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream]))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.OnAddStreamEventInActiveHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=null===i.remoteStream;0<e.data.newStream.getAudioTracks().length&&((t=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput()).stopPlayingAudioStream(i.remoteStream),i.remoteStream=e.data.newStream,t.playAudioStream(i.remoteStream,i.call.isSpeakerMuted()),a.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(i.call.getCallId(),i.remoteStream),a.trigger(s.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream])),!r&&null!==i.remoteStream.onaddtrack||(s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+i.remoteStream.id),i._rtConnection.onAddRemoteTrack=function(e){i.handleEvent(new s.Providers.Call.OnAddRemoteTrackEvent({newTrack:e}))},i._rtConnection.onRemoveRemoteTrack=function(e){i.handleEvent(new s.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:e}))}),i._rtConnection.enableRemoteStreams(),s.Base.Utils.isDefined(e.data.action)&&e.data.action===s.Providers.Call.CallProvider.Constants.UNHOLD&&(i.call.isAudioMuted()?i.enableLocalVideoStreams():i.enableLocalStreams()),i.notifyCallServiceOfMediaChanges(e.data.action)}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.OnAddStreamEventPreActiveHandler=function(e){var t=e.data.cpCall,i=t._rtConnection,a=e.data.callProvider,r=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),s=null===t.remoteStream;t.remoteStream=e.data.newStream,a.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(t.call.getCallId(),t.remoteStream),a.trigger(n.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.remoteStream]),t._isEarlyMedia&&!r.isPlaying(t.remoteStream)?(i.enableRemoteStreams(),t.call.isAudioMuted()||i.enableLocalAudioStreams(),r.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())||n.Base.Logger.info(n.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found.  Could not play remote audio.")):i.disableRemoteStreams(),s&&(n.Base.Logger.info(n.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+t.remoteStream.id),t._rtConnection.onAddRemoteTrack=function(e){t.handleEvent(new n.Providers.Call.OnAddRemoteTrackEvent({newTrack:e}))},t._rtConnection.onRemoveRemoteTrack=function(e){t.handleEvent(new n.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:e}))})}}(AvayaClientServices),function(e){"use strict";e.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider;e.Base.Logger.debug(e.Base.LoggerTags.CALL_PROVIDER,">>> Removed remote track: "+t.data.newTrack.kind+" id: "+t.data.newTrack.id),t.data.newTrack.kind===e.Providers.Call.CallProvider.Constants.AUDIO_TRACK&&(i.remoteStream.getAudioTracks().forEach(function(e){e.id===t.data.newTrack.id&&a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().stopPlayingAudioStream(i.remoteStream,!1)}),a.trigger(e.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectCallRequestEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=e.data.deferred;i.rejectCallRequest(t.callId,t.getCallRequestedTransactionalId(e.data.requestedType),e.data.action).then(function(){a.resolve()},function(e){a.reject(e)})}}(),function(i){"use strict";i.Providers.Call.RejectMidCallEventInMultipleHandler=function(e){var t=e.data.cpCall;i.Base.Logger.error(i.Base.LoggerTags.CALL_PROVIDER,"Reject mid call event in invalid state: ",e.data.action),t.rejectMediaTransaction(new i.Services.Call.CallException(i.Services.Call.CallError.INVALID_STATE))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectOfferSDPEventInMultipleHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.rejectOfferSDPResponse(t.callId,e.data)}}(),function(){"use strict";AvayaClientServices.Providers.Call.RevertStateEventInMultipleHandler=function(e){return{nextState:e.data.state}}}(),function(){"use strict";AvayaClientServices.Providers.Call.SendDTMFEventInMultipleHandler=function(e){e.data.cpCall._rtConnection.sendDTMF(e.data.dtmf)}}(),function(){"use strict";AvayaClientServices.Providers.Call.ServiceAvailableEventInMultipleHandler=function(e){(e=e.data.cpCall).isIceConnectionStateFailed()?e.iceConnectionFailedHandler():e.initiateIceRecoveryIfDetectedMediaPathProblem()}}(),function(a){"use strict";a.Providers.Call.SetMediaProcessingEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t.getVideoSendResolution();if(t.hasVideoTracks()&&a.Base.Utils.isUndefined(t._videoSharingStream)&&t._getPreviousVideoDirection()!==a.Services.Call.MediaDirection.DISABLE)return a.Providers.Call.CPUtils.updateDevices(T,e.data.videoDevice,t,e.data.callProvider.getMediaServiceFactory(),t.getVideoResolution(),function(){t._getPreviousVideoDirection()===a.Services.Call.MediaDirection.SEND_RECV||t._getPreviousVideoDirection()===a.Services.Call.MediaDirection.SEND_ONLY?(t.mediaTransactionDfd.then(function(){i.getHeight()<t.getVideoResolution().getHeight()&&(a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Updating send video resolution to the previously set dynamic resolution. dynamic: "+i+" negotiated: "+t.getVideoResolution()),t.setVideoSendResolution(i))}),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Sending UPDATE_VIDEO request for change in media processing (blur)"),t._callGatewayProvider.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update local stream: "+t.getVideoResolution(),e),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(a.Providers.Call.States.ACTIVE)})):(t.resolveMediaTransaction(),t.revertFsmState(a.Providers.Call.States.ACTIVE))},function(){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Create local media error."),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),t.revertFsmState(a.Providers.Call.States.ACTIVE)},t.getNoiseSuppressionConstraints()),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE};t.resolveMediaTransaction()}}(AvayaClientServices),function(p){"use strict";p.Providers.Call.StartCallEventInInitialHandler=function(l){var e,t,i,d=l.data.cpCall,C=l.data.callProvider,u=d._callGatewayProvider,h=d.call.getVideoChannels(),a=d.call.getAudioChannel(),r=!0,_=!1,v=!1,s=l.data.audioDevice?l.data.audioDevice.getDeviceId():T;if(p.Base.Utils.isDefined(h))for(var n=0;n<h.length;n++){var o=h[n]._getInternalRequestedDirection();o===p.Services.Call.MediaDirection.SEND_ONLY||o===p.Services.Call.MediaDirection.SEND_RECV?(_=!0,l.data.videoDevice&&(e=l.data.videoDevice.getDeviceId())):o===p.Services.Call.MediaDirection.RECV_ONLY&&(v=!0,p.Base.Utils.getBrowserType()===p.Base.BrowserType.EDGE&&C.hasVideoDevices()&&(_=!0)),o!==p.Services.Call.MediaDirection.INACTIVE&&(t=h[n].getChannelId())}return(r=p.Base.Utils.isDefined(a)&&a.getRequestedDirection()===p.Services.Call.MediaDirection.DISABLE?!1:r)||_||!l.data.webCollab?r?(r=l.data.audioDevice?l.data.audioDevice.toString():"Default Audio",i=l.data.videoDevice?l.data.videoDevice.toString():"Default Camera",p.Base.Logger.info(p.Base.LoggerTags.CALL_PROVIDER,"Starting call using",r,i),C.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(d.call.getCallId(),!0,_,s,e,t,l.data.videoResolution,T,d.backgroundBlur,d.backgroundImage).then(function(e){if(d.call.getState()===p.Services.Call.CallStates.ENDING||d.call.getState()===p.Services.Call.CallStates.ENDED)return p.Base.Logger.info(p.Base.LoggerTags.CALL_PROVIDER,"Start call rejected for inactive call"),void e.stream.getTracks().forEach(function(e){e.stop()});var t=e.stream;e.videoResolution&&d._updateVideoResolution(e.videoResolution),p.Base.Logger.debug(p.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var i=0,a=null,r=[];if(t.getTracks().forEach(function(e){var t;"audio"===e.kind?a=new p.Providers.Interfaces.AudioStream(e.id,p.Services.Call.MediaDirection.SEND_RECV):"video"===e.kind&&(t=p.Services.Call.MediaDirection.SEND_RECV,i<h.length&&(t=h[i]._getInternalRequestedDirection(),i++),r.push(new p.Providers.Interfaces.VideoStream(e.id,t)))}),null===a)return p.Base.Logger.error(p.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void C.trigger(p.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,p.Services.Call.CallError.MICROPHONE_NOT_FOUND]);var s,n=l.data.nailedUpVideoConnection;if(_&&0===r.length&&n&&(s=C.getActiveCallVideoTrack(),p.Base.Utils.isDefined(s)&&(t.addTrack(s.clone()),r.push(new p.Providers.Interfaces.VideoStream(s.id,h[0]._getInternalRequestedDirection())))),0===r.length)if(_&&!v){e.constraint&&h[0]._setCameraConstraint(e.constraint);e=h[0]._getInternalRequestedDirection();if(e===p.Services.Call.MediaDirection.SEND_RECV)h[0]._setRequestedDirection(p.Services.Call.MediaDirection.RECV_ONLY),p.Base.Logger.warn(p.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY"),r.push(new p.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",p.Services.Call.MediaDirection.RECV_ONLY));else if(e===p.Services.Call.MediaDirection.SEND_ONLY)h[0]._setRequestedDirection(p.Services.Call.MediaDirection.INACTIVE),p.Base.Logger.warn(p.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE");else{if(!n){p.Base.Logger.error(p.Base.LoggerTags.CALL_PROVIDER,"Failed to get video media streams for call."),d._rtConnection.stopStream(t);var o=new p.Providers.Call.DeviceRetrievalFailedEvent;return void d.handleEvent(o)}C.triggerAllowedNailedUpVideoModes(d.call,[p.Services.Call.VideoMode.RECEIVE_ONLY,p.Services.Call.VideoMode.DISABLE]),d.hasNailedUpConnectionVideoChannel()?(h[0]._setRequestedDirection(p.Services.Call.MediaDirection.DISABLE),h[0]._setInternalRequestedDirection(p.Services.Call.MediaDirection.RECV_ONLY)):h[0]._setRequestedDirection(p.Services.Call.MediaDirection.RECV_ONLY),n._setLogicalDirection(p.Services.Call.MediaDirection.INACTIVE);var c=new p.Providers.Interfaces.VideoStream("nailedUpVideo",p.Services.Call.MediaDirection.RECV_ONLY);r.push(c)}n&&n._setRequiredDirection(h[0]._getInternalRequestedDirection())}else v&&r.push(new p.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",p.Services.Call.MediaDirection.RECV_ONLY));n&&0<r.length&&(r[0].logicalDirection=n.getLogicalDirection()),d.setAVStreams(a,r),d.localStream=t,d._rtConnection.addStream(d.localStream),d._rtConnection.disableLocalStreams();o=d.isMPaaSCall()?d.isLocalVideoMuted():T,c=d.call.getCallId();p.Base.Utils.isUndefined(c)&&(t=d.generateTemporarilyCallId(),C.registerCall(t,d.call,d)),u.startCall(l.data.remoteAddress,d.call.getSubject(),d.call._callCreationInfo,l.data.video,l.data.webCollab,d.getAudioStream(),d.getVideoStreams(),o,l.data.uccp,c,d.call._sessionId,n,d.call.getNoiseReductionSetting()).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(e));var t=new p.Providers.Call.StartCallResponseEvent;t.data={},t.data.callId=e.callId,t.data.videoResolution=l.data.videoResolution,t.data.audioDevice=l.data.audioDevice,t.data.videoDevice=l.data.videoDevice,t.data.clientCpuUsageMgmt=e.clientCpuUsageMgmt,d.handleEvent(t)},function(e){d._rtConnection.stopAllStreams(),C.trigger(p.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])})},function(e){p.Base.Logger.error(p.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",e);var t=new p.Providers.Call.DeviceRetrievalFailedEvent;e.getError&&e.getError()&&(t.data={callError:e.getError()}),d.handleEvent(t)})):(p.Base.Logger.error(p.Base.LoggerTags.CALL_PROVIDER,"Video only call is not supported"),C.trigger(p.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,p.Services.Call.CallError.VIDEO_ONLY_CALL_NOT_SUPPORTED])):(d.call._dataOnly=!0,d._isMPaaSCollabCall=d.isMPaaSCall(),p.Base.Logger.info(p.Base.LoggerTags.CALL_PROVIDER,"Starting Collaboration only call"),i=d.call.getCallId(),p.Base.Utils.isUndefined(i)&&(s=d.generateTemporarilyCallId(),C.registerCall(s,d.call,d)),u.startCall(l.data.remoteAddress,d.call.getSubject(),d.call._callCreationInfo,!1,l.data.webCollab,null,null,!1,l.data.uccp,i,d.call._sessionId).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(e));var t=new p.Providers.Call.StartCallResponseEvent;t.data={},t.data.callId=e.callId,d.handleEvent(t)},function(e){C.trigger(p.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])})),{nextState:p.Providers.Call.States.STARTING}}}(AvayaClientServices),function(d){"use strict";d.Providers.Call.StartCallResponseEventInStartingHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=t.data.callId;if(i.callId=r,i._isReadyToReceiveMediaRequest=!0,a.updateCpCall(i,r),i.call.getState()===d.Services.Call.CallStates.ENDING)a.stopCall(i.call);else{a.triggerCallStarted(i.call),d.Base.Utils.isDefined(t.data.clientCpuUsageMgmt)&&a.trigger(d.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[t.data.clientCpuUsageMgmt]),a.getMediaServiceFactory().getAudioInputInterfaceService().replaceLocalMediaStream(r,i.localStream);var e=a.getQueuedCallFailure(r);if(e)i.callFailure(e.errorCode,e.protocolType,e.protocolErrorCode,e.failureReason);else{var s=a.getQueuedCallEstablishedNotification(r);if(s){var n=i.buildCallEstablishedEvent(s.remoteAddress,s.remoteDisplayName,s.audioStream,s.videoStreams,s.isConference,s.uccpUrl,s.webCollabUrl,!1,s.ucid,s.parentUcid,s.contextId);return i.prepareEvent(n),{nextEvent:n}}var o,c=function(){var e=a.getQueuedMediaOfferNotification(r);e&&(d.Base.Utils.isDefined(e.offer)?i.offerSDP(e.offer,e.action,e.audioStream,e.videoStreams,e.videoBandwidth,e.turnData):i.getOfferSDP(e.action,e.audioStream,e.videoStreams,e.videoBandwidth,t.data.audioDevice,t.data.videoDevice,e.turnData,e.restartTurnGathering,e.useIPv6Candidates))},l=a.getQueuedVideoMuteState(),e=a.getQueuedAudioMuteState(),s=a.getQueuedSpeakerMuteState(),n=[];l&&(l===d.Services.Call.MediaMuteStates.MUTED?o=i.muteVideo():l===d.Services.Call.MediaMuteStates.UNMUTED&&(o=i.unmuteVideo()),n.push(o)),e&&(o=e?i.muteAudio():i.unmuteAudio(),n.push(o)),s&&(o=s?i.muteSpeaker():i.unmuteSpeaker(),n.push(o)),n.length?n.forEach(function(e){e?e.always(function(){c()}):c()}):c()}}}}(AvayaClientServices),function(l){"use strict";l.Providers.Call.StartContentVideoSharingHandler=function(i){var a,e,t,r=i.data.cpCall,s=[],n=r._callGatewayProvider,o=i.data.callProvider,c=r.getVideoStreams();r.isMPaaSCall()&&0<c.length?((a=c[0].direction===l.Services.Call.MediaDirection.RECV_ONLY)?c[0].direction=l.Services.Call.MediaDirection.SEND_RECV:(r._rtConnection.removeLocalVideoTrack(r.localStream),o.triggerVideoChannelUpdate(r.call)),i.data.stream.getTracks().forEach(function(e){var t;e.kind===l.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK?(r.localStream.getAudioTracks().forEach(function(e){r.setVideoSharingAudioConstraints(e.getConstraints())}),t=r.mixVideoSharingAudio(r.localStream,i.data.stream),s.push(r._rtConnection.replaceLocalMediaTrack(t))):a&&!r._rtConnection.hasVideoTracks()?r._rtConnection.addTrack(e,r.localStream):s.push(r._rtConnection.replaceLocalMediaTrack(e))}),e=function(){r.call._setIsContentVideoSharingStarted(!0),r.resolveMediaTransaction()},t=function(e,t){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,t),n.stopVideoSharing(r.callId,r.call._sessionId,c),r.rejectMediaTransaction(new l.Services.Call.CallException(e))},n.startVideoSharing(r.callId,r.call._sessionId,c).then(function(){S.when.apply(this,s).then(function(){a?n.updateVideo(r.call.getCallId(),r.getAudioStream(),c,!1).then(e,function(e){t(l.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+e)}):e()},function(e){n.stopVideoSharing(r.callId,r.call._sessionId,c),t(l.Services.Call.CallError.MEDIA_CREATION_FAILURE,"Failed to replace video sharing track: "+e)})},function(e){t(l.Services.Call.CallError.SEND_ERROR,"Failed to notify server of start video sharing: "+e)})):r.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.StartRingingEventInInitialHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.startRinging(t.callId).then(function(){t.setRingingStarted(!0)})}}(),function(o){"use strict";o.Providers.Call.StopContentVideoSharingHandler=function(e){var t,i,a=e.data.cpCall,r=a._callGatewayProvider,s=a.getVideoStreams(),n=a.getVideoSharingAudioConstraints();n&&(a.localStream.getAudioTracks().forEach(function(e){e.applyConstraints(n).catch(function(e){o.Base.Logger.info(o.Base.LoggerTags.CALL_PROVIDER,"Resetting "+n+" constraints rejected: "+e)})}.bind(this)),a.setVideoSharingAudioConstraints(T)),a.isMPaaSCall()&&0<s.length?((t="recvOnlyVideoStreamId"===s[0].id)&&(s[0].direction=o.Services.Call.MediaDirection.RECV_ONLY),i=function(e,t){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,t),r.stopVideoSharing(a.callId,a.call._sessionId,s),a.mediaTransactionDfd.reject(new o.Services.Call.CallException(e))},r.stopVideoSharing(a.callId,a.call._sessionId,a.getVideoStreams()).then(function(){a.call.isAudioMuted()&&(a.localStream.getAudioTracks()[0].enabled=!1),a.stopVideoSharingStream(),a.removeVideoSharingAudioContext(),a.call._setIsContentVideoSharingStarted(!1),t?(a._rtConnection.removeLocalVideoTrack(a.localStream),r.updateVideo(a.call.getCallId(),a.getAudioStream(),s,!1).then(function(){a.mediaTransactionDfd.resolve().promise()},function(e){i(o.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+e)})):a.replaceContentWithVideo()},function(e){i(o.Services.Call.CallError.SEND_ERROR,"Failed to notify server of stop video sharing: "+e)})):a.mediaTransactionDfd.reject(new o.Services.Call.CallException(o.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.TransferEventInActiveHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.transfer(t.callId,e.data.targetRemoteAddress,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t._transferPromise.reject(new i.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg))})}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.UnBlockCameraEventInActiveHandler=function(e){var t,a,i,r=e.data.cpCall,s=r._callGatewayProvider,n=r.localStream.getVideoTracks();return 0<n.length&&!r.hasVideoTrackStopStreaming(n[0])?(r.enableLocalVideoStreams(),s.blockUnBlockCamera(r.callId,r.getAudioStream(),r.getVideoStreams()).then(function(){},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+e),r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),r.revertFsmState(o.Providers.Call.States.ACTIVE)})):(0<n.length&&r.localStream.removeTrack(n[0]),t=e.data.callProvider,a=r.call.getVideoChannels(),i=o.Base.Utils.isDefined(e.data.videoDevice)?e.data.videoDevice.getDeviceId():T,n=a[0].getChannelId(),r.setVideoChannelId(a[0].getChannelId()),t.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(i,n,r.localStream,e.data.videoResolution,r._rtConnection,r.backgroundBlur,r.backgroundImage).then(function(e){o.Base.Logger.debug(o.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var t=r.getAudioStream(),i=[];e.getTracks().forEach(function(e){var t;e.kind===o.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&e.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(t=o.Services.Call.MediaDirection.SEND_RECV,i.push(new o.Providers.Interfaces.VideoStream(e.id,t)))}),r.setAVStreams(t,i),r.isLocalVideoMuted()&&r.muteLocalVideo(),s.blockUnBlockCamera(r.callId,r.getAudioStream(),r.getVideoStreams()).then(function(){},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+e),r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),r.revertFsmState(o.Providers.Call.States.ACTIVE)})},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",e);for(var t=r.getVideoStreams(),i=0;i<t.length;i++)t[i].direction=a[i].getNegotiatedDirection();e.getError()===o.Services.Call.CallError.CAMERA_PERMISSION_DENIED||e.getError()===o.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(r.rejectMediaTransaction(e),r.revertFsmState(o.Providers.Call.States.ACTIVE)):(r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.MEDIA_CREATION_FAILURE)),r.deviceRetrievalFailure(o.Providers.Call.States.ACTIVE))})),{nextState:o.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UnHoldEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;0===(e=t.call.getVideoChannels()).length||e[0]._getInternalRequestedDirection()!==s.Services.Call.MediaDirection.SEND_RECV&&e[0]._getInternalRequestedDirection()!==s.Services.Call.MediaDirection.SEND_ONLY?(t.call.isAudioMuted()||t._rtConnection.enableLocalAudioStreams(),0<e.length&&e[0]._getInternalRequestedDirection()===s.Services.Call.MediaDirection.RECV_ONLY&&t.enableLocalVideoStreams(e[0]._getInternalRequestedDirection())):(t.call.isAudioMuted()||t._rtConnection.enableLocalAudioStreams(),t.enableLocalVideoStreams());var e=t.getAudioStream(),a=t.getVideoStreams();e.direction=s.Services.Call.MediaDirection.SEND_RECV,t.isNailedUpVideoConnectionSupported()&&(e.logicalDirection=s.Services.Call.MediaDirection.SEND_RECV);for(var r=0;r<a.length;r++)t.isNailedUpVideoConnectionSupported()?(a[r].direction=s.Services.Call.MediaDirection.SEND_RECV,a[r].logicalDirection=t._latestNonHoldingVideoDirection):a[r].direction=t._latestNonHoldingVideoDirection;return t.setAVStreams(e,a),i.unholdCall(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to unhold: "+e),t.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(s.Providers.Call.States.ACTIVE)}),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.UnmuteAudioEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&(t.call._getIsContentVideoSharingStarted()?t.updateVideoSharingMicrophoneVolume(1):t._replaceAudioTrackIfNeeded(!0).always(function(){t._rtConnection.enableLocalAudioStreams(),e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream])}))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.UnmuteSpeakerEventInMultipleHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;t.remoteStream&&e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().unmuteStream(t.remoteStream)}}(),function(a){"use strict";a.Providers.Call.UnmuteVideoEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;t.unmuteLocalVideo(),t.isMPaaSCall()?t.hasReceivedCallEstablishedEvent()?i.unmuteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).then(function(){t.noMediaTransactionDfd.resolve()},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+e),t.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))}):(t.queueMuteUnumteFunctor(function(){i.unmuteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).fail(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+e)})}),t.noMediaTransactionDfd.resolve()):t.noMediaTransactionDfd.resolve()}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler=function(e){var t=e.data.cpCall;t.isMPaaSCall()?e.data.fromMicrophone?t.localStream.getAudioTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e).then(function(){i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Updated content video sharing audio from microphone"),t.mediaTransactionDfd.resolve()},function(e){t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.MEDIA_CREATION_FAILURE,i.Services.Call.CallProtocolType.APPLICATION,500,e))})}):e.data.stream.getAudioTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e).then(function(){i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Reverted content video sharing audio"),t.mediaTransactionDfd.resolve()},function(e){t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.MEDIA_CREATION_FAILURE,i.Services.Call.CallProtocolType.APPLICATION,500,e))})}):t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UpdateIceRestartMediaEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;if(t.isCallServiceAvailable()){t.setIceRestartInProgress(!0),s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var a="all"===t._rtcConfiguration.iceTransportPolicy,r=!!t._rtcConfiguration.iceServers&&0<t._rtcConfiguration.iceServers.length&&!!t._rtcConfiguration.iceServers[0].urls&&0<t._rtcConfiguration.iceServers[0].urls.length,e=t._rtcConfiguration._turnOfferType===s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return a&&r&&e&&1<t.getIceRestartAttemtps()&&(s.Base.Logger.info("Initiating ICE restart with relay only"),t.setIceRestartRelayType(s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),t._replaceAudioTrackIfNeeded().always(function(){i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams(),!0).then(function(){},function(e){t.setIceRestartInProgress(!1),t.revertFsmState(s.Providers.Call.States.ACTIVE),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+e)})}.bind(this)),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;if(t.isCallServiceAvailable()){t.setIceRestartInProgress(!0),s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var a="all"===t._rtcConfiguration.iceTransportPolicy,r=!!t._rtcConfiguration.iceServers&&0<t._rtcConfiguration.iceServers.length&&!!t._rtcConfiguration.iceServers[0].urls&&0<t._rtcConfiguration.iceServers[0].urls.length,e=t._rtcConfiguration._turnOfferType===s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return a&&r&&e&&(!t._hadMediaConnected||1<t.getIceRestartAttemtps())&&(s.Base.Logger.info("Initiating ICE restart with relay only"),t.setIceRestartRelayType(s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),t._replaceAudioTrackIfNeeded().always(function(){i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams(),!0).then(function(){},function(e){t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+e)})}.bind(this)),{nextState:s.Providers.Call.States.MEDIA_RECOVERY}}t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.UpdateLocalStreamHandler=function(e){function t(){n.Base.Logger.debug("Sending UPDATE_VIDEO request for new local stream"),s._callGatewayProvider.updateVideo(s.callId,s.getAudioStream(),s.getVideoStreams()).then(function(){n.Base.Utils.isDefined(e.data.videoResolutionChanged)||s.revertFsmState(n.Providers.Call.States.ACTIVE),e.data.selectedDevice&&e.data.selectedDevice._kind===n.Base.MediaTypes.AUDIO_INPUT&&e.data.callProvider.trigger(n.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[s.call,s.localStream])},function(e){n.Base.Logger.error("Failed to update local stream: "+s.getVideoResolution()),s.rejectMediaTransaction(new n.Services.Call.CallException(n.Services.Call.CallError.SEND_ERROR)),s.revertFsmState(n.Providers.Call.States.ACTIVE)})}function i(){n.Base.Logger.error("Create local media error: "+s.getVideoResolution()),s.rejectMediaTransaction(new n.Services.Call.CallException(n.Services.Call.CallError.MEDIA_CREATION_FAILURE)),s.revertFsmState(n.Providers.Call.States.ACTIVE)}var a,r,s=e.data.cpCall;if(null!==s.localStream)return s._rtConnection.isRTCRtpSenderSupported()?e.data.videoResolutionChanged?n.Providers.Call.CPUtils.updateVideoResolution(s,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,i):(e.data.selectedDevice._kind===n.Base.MediaTypes.VIDEO_INPUT?r=e.data.selectedDevice:a=e.data.selectedDevice,a&&s.isScreenSharingUsingVideo()?n.Providers.Call.CPUtils.updateDevices(a,r,s,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,function(){var e=s.mixVideoSharingAudio(s.localStream);s._rtConnection.replaceLocalMediaTrack(e).then(function(){t()},function(e){n.Base.Logger.error("Failed to replace new content video sharing audio track"),s.rejectMediaTransaction(new n.Services.Call.CallException(n.Services.Call.CallError.MEDIA_CREATION_FAILURE)),s.revertFsmState(n.Providers.Call.States.ACTIVE)})},i,s.getNoiseSuppressionConstraints()):n.Providers.Call.CPUtils.updateDevices(a,r,s,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,i,s.getNoiseSuppressionConstraints())):n.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,s,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,i),{nextState:n.Providers.Call.States.ACTIVE_RENEGOTIATE};t()}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler=function(e){var t,i=e.data.cpCall,a=i._callGatewayProvider;i.hasReceivedCallEstablishedEvent()?(t=(t=r.Base.VideoResolution[e.data.videoResolution]).getWidth()+"x"+t.getHeight(),a.updatePreferredReceiveResolution(i.callId,i.call._sessionId,i.getVideoStreams(),t).then(function(){i.call.getVideoChannels()[0]._preferredReceiveResolution=e.data.videoResolution,i.noMediaTransactionDfd.resolve()},function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution: "+e),i.noMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.SEND_ERROR))})):(r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution due to invalid state ",i.call.getState()),i.noMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateRemoteVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;return 0!==(e=t.getVideoStreams()).length&&e[0].enabled&&t._rtConnection.setLocalVideoDirection(e[0].direction),i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+e),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(t){"use strict";function e(e,t,i){this._verifySupportedLogicalDirection(e),this._verifySupportedGuidelinesDirection(t),this._verifySupportedGuidelinesDirection(i),this._logicalDirection=e,this._requiredDirection=t,this._permittedDirection=i}e.prototype={getLogicalDirection:function(){return this._logicalDirection},getRequiredDirection:function(){return this._requiredDirection},getPermittedDirection:function(){return this._permittedDirection},_setLogicalDirection:function(e){this._verifySupportedLogicalDirection(e),this._logicalDirection=e},_setRequiredDirection:function(e){this._verifySupportedGuidelinesDirection(e),this._requiredDirection=e},_setPermittedDirection:function(e){this._verifySupportedGuidelinesDirection(e),this._permittedDirection=e},_verifySupportedLogicalDirection:function(e){if(e===t.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported logical video direction: "+e)},_verifySupportedGuidelinesDirection:function(e){if(e&&e===t.Services.Call.MediaDirection.SEND_ONLY||e===t.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported video guidelines direction: "+e)}},t.Providers.Call.NailedUpVideoConnectionInfo=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i){r.Base.Observable.call(this),this._networkProvider=e,this._config={},this._notificationProvider=t,this._notificationParser=i}(e.prototype=Object.create(r.Base.Observable.prototype)).init=function(e){return this._config=e,this._networkProvider.onMessage=function(e){},this._networkProvider.onError=function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_GATEWAY_PROVIDER,e)},this._networkProvider.init(this._config),this._notificationProvider.onMessage=function(e){var t,i,a=e.data&&e.type!==r.Base.ProvidersEventTypes.PING?JSON.parse(e.data):e;try{t=JSON.parse(a.message),i=(i=this._notificationParser.parse(t))||t}catch(e){i=a}i.type?this.trigger("call."+i.type,[i]):this.trigger("call.message",[i])}.bind(this),this._notificationProvider.onError=function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_GATEWAY_PROVIDER,e)},this._notificationProvider.init(this._config),this},e.prototype.startCall=function(e){e=JSON.stringify({remoteAddress:e});return this._networkProvider.send(e,{sendType:"POST",urlSuffix:"/restgateway/calls",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return new r.Providers.CallGateway.StartCallData(e.callHref,e.callId)})},e.prototype.endCall=function(e){e={sendType:"DELETE",urlSuffix:"/restgateway/calls/"+e,dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json"}};return this._networkProvider.send(null,e)},e.prototype.acceptCall=function(e,t){t={sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json;"}};return this._networkProvider.send(null,t)},e.prototype.holdCall=function(e,t){t={sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t+"/hold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}};return this._networkProvider.send(null,t)},e.prototype.unholdCall=function(e,t){t={sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t+"/unhold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}};return this._networkProvider.send(null,t)},r.Providers.CallGateway.CallGatewayProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallGateway.ActiveCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="active",this.callEvent="ACTIVE",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AlertingCallMessage=function(e,t,i,a,r,s,n,o,c,l,d){this.type="alerting",this.callEvent="ALERTING",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l,this.alertingParticipant=d}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AnsweredCallMessage=function(e,t,i,a,r,s,n,o,c,l,d){this.type="answered",this.callEvent="ANSWERED",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l,this.answeringParticipant=d}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.FailedCallMessage=function(e,t,i,a,r,s,n,o){this.type="failed",this.callEvent="FAILED",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.address=n,this.reason=o}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.HeldCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="held",this.callEvent="HELD",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.ParticipantDroppedCallMessage=function(e,t,i,a,r){this.type="participantDropped",this.callEvent="PARTICIPANTDROPPED",this.participants=e,this.callId=t,this.callHref=i,this.address=a,this.droppingParticipant=r}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.StartCallData=function(e,t){this.callId=t,this.callHref=e}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.SubscriptionCallMessage=function(e,t,i){this.type="subscription",this.callEvent="SUBSCRIPTION",this.status=e,this.subscriptionId=t,this.additionalProperties=i}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.UnheldCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="unheld",this.callEvent="UNHELD",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")}},e.Providers.CallGateway.AbstractParser=t}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.ActiveCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.ActiveCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.AlertingCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations,e.alertingParticipant)},t.Providers.CallGateway.AlertingCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.AnsweredCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations,e.answeringParticipant)},t.Providers.CallGateway.AnsweredCallMessageParser=e}(AvayaClientServices),function(i){"use strict";function e(){this._parsers=[]}e.prototype={register:function(e,t){this._parsers[e]=t},unregister:function(e){this._parsers[e]=T},parse:function(e){return e.callEvent?this._delegateParser(e.callEvent,e):e.subscriptionId?this._delegateParser("subscription",e):e},_delegateParser:function(e,t){if(this._parsers[e]!==T)return this._parsers[e].parse(t);i.Base.Logger.error(i.Base.LoggerTags.CALL_GATEWAY_PROVIDER,"No parser specified!",e)}},i.Providers.CallGateway.CallNotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.FailedCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.address,e.reason)},t.Providers.CallGateway.FailedCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.HeldCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.HeldCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.ParticipantDroppedCallMessage(e.participants,e.callId,e.callHref,e.address,e.droppingParticipant)},t.Providers.CallGateway.ParticipantDroppedCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.SubscriptionCallMessage(e.status,e.subscriptionId,e.additionalProperties)},t.Providers.CallGateway.SubscriptionCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.UnheldCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.UnheldCallMessageParser=e}(AvayaClientServices),function(s){"use strict";function e(){this._csgCallsProviderMap={},this._csgProviderMap={},this._csgPresenceProvider=T,this._messageBuilder=new s.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder}e.prototype={getCSGCallsProvider:function(e){return this._csgCallsProviderMap.hasOwnProperty(e)||(this._csgCallsProviderMap[e]=new s.Providers.CallServiceGateway.CSGCallsProvider(this._getCSGProvider(e),this._messageBuilder,e)),this._csgCallsProviderMap[e]},getCSGCallsProviderAsArray:function(){var e,t=[];for(e in this._csgCallsProviderMap)this._csgCallsProviderMap.hasOwnProperty(e)&&t.push(this._csgCallsProviderMap[e]);return t},getCSGPresenceProvider:function(e){return this._csgPresenceProvider||(this._csgPresenceProvider=new s.Providers.CallServiceGateway.CSGPresenceProvider(this._getCSGProvider(e),this._messageBuilder)),this._csgPresenceProvider},_getCSGProvider:function(e){var t,i,a,r;return this._csgProviderMap.hasOwnProperty(e)||(a=[s.Providers.CallServiceGateway.CSGNotificationEventType.CAS_NOTIFICATION,s.Providers.CallServiceGateway.CSGNotificationEventType.PING],i=new s.Base.SSEProvider(a),t=new s.Base.RESTProvider,r=new s.Base.SSEIntegrationProvider(t,i),a=new s.Base.WebSocketProvider,t=new s.Base.NetworkProvider(a,r,s.Base.LoggerTags.CALL_GATEWAY_PROVIDER),i=new s.Base.NetworkProvider(new s.Base.RESTProvider,T,s.Base.LoggerTags.CALL_GATEWAY_PROVIDER),a=new s.Base.PollingRESTProvider,r=new s.Base.PollingRESTProvider,this._csgProviderMap[e]=new s.Providers.CallServiceGateway.CSGProvider(this._messageBuilder,i,t,a,r)),this._csgProviderMap[e]}},s.Providers.CallServiceGateway.CallServiceGatewayProviderFactory=e}(AvayaClientServices),function(c){"use strict";var o={CSA_RESOURCE:"application/vnd.avaya.csa.resources.v1+json",CSA_SERVICES:"application/vnd.avaya.csa.services.v1+json",CSA_ERROR:"application/vnd.avaya.csa.error.v1+json",CSA_CONFIGURATION:"application/vnd.avaya.csa.configuration.v1+json",CSA_CALL:"application/vnd.avaya.csa.call.v1+json",CSA_CALLS:"application/vnd.avaya.csa.calls.v1+json",CSA_CLIENT:"application/vnd.avaya.csa.client.v1+json",CSA_CLIENTS:"application/vnd.avaya.csa.clients.v1+json",CSA_CALL_ACTION:"application/vnd.avaya.csa.callaction.v1+json",CSA_CALL_PREFERENCE:"application/vnd.avaya.csa.callpreferences.v1+json",CSA_PRESENCE_CONTAINER:"application/vnd.avaya.presence-im.container.v1+json",CSA_PRESENCE_PUBLICATION:"application/vnd.avaya.presence.presence-pub.v1+json",CSA_PRESENCE_RESOURCE_LIST:"application/vnd.avaya.csa.resourcelist.v1+json",MPAAS_CALL_PROPERTIES:"application/vnd.avaya.mpaas.callproperties.v1+json"},a="://";function e(){this._requestCounter=0}e.prototype={buildStartCallOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:o.CSA_CALL,"Content-Type":o.CSA_CALL_PREFERENCE}}},buildActivateServiceOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:o.CSA_SERVICES,"Content-Type":o.CSA_SERVICES}}},buildActivateServiceData:function(e,t){e={action:c.Providers.CallServiceGateway.CallActionType.ACTIVATE,service:e,extendedData:{mode:c.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:c.Providers.CallServiceGateway.Constants.WEBRTC,register:t.isRegisterUser()}};return t.getMinBandwidth()&&(e.extendedData.videoBandwidth=t.getMinBandwidth()),t.getVideoChannelGuidelines()&&(t=t.getVideoChannelGuidelines(),e.extendedData.videoChannelGuidelines={},t.requiredDirection&&(e.extendedData.videoChannelGuidelines.requiredClientLegDirections=c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(t.requiredDirection)),t.permittedDirection&&(e.extendedData.videoChannelGuidelines.permittedLogicalDirections=c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(t.permittedDirection)),e.extendedData.audioChannelGuidelines={requiredClientLegDirections:c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(c.Services.Call.MediaDirection.SEND_RECV)}),e},buildDeactivateServiceOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:o.CSA_SERVICES,"Content-Type":o.CSA_SERVICES}}},buildDeactivateServiceData:function(e){return{action:c.Providers.CallServiceGateway.CallActionType.DEACTIVATE,service:e,extendedData:{mode:c.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:c.Providers.CallServiceGateway.Constants.WEBRTC,recoveryToken:null,register:!1}}},buildResourceDiscoveryOptions:function(e){return{urlSuffix:e||c.Providers.CallServiceGateway.Constants.CSA_RESOURCE_PATH,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[o.CSA_RESOURCE,o.CSA_ERROR].join(", ")}}},buildResourceDiscoveryData:function(e){var t={};return e&&(t.existingclientid=e),t},buildUpdateCallOptions:function(e,t){var i,e=c.Base.Utils.parseUrl(e);return e&&(i=e.protocol+a+e.host,i={urlSuffix:(e.path||"")+"/"+t,url:i,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,crossDomain:!0,headers:{"Content-Type":o.CSA_CALL_ACTION}}),i},buildGetCallsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[o.CSA_CALLS,o.CSA_ERROR].join(", ")}}},buildGetCallOptions:function(e,t){var i=c.Base.Utils.parseUrl(e),e=i.protocol+a+i.host;return{urlSuffix:i.path||"",url:e+"/"+t,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[o.CSA_CALL,o.CSA_ERROR].join(", ")}}},buildGetClientsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[o.CSA_CLIENTS,o.CSA_ERROR].join(", ")}}},buildGetClientOptions:function(e,t){var i=c.Base.Utils.parseUrl(e),e=i.protocol+a+i.host;return{urlSuffix:i.path||"",url:e+"/"+t,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[o.CSA_CLIENT,o.CSA_ERROR].join(", ")}}},buildKeepAliveOptions:function(e){var t={crossDomain:!0};return c.Base.Utils.isUndefined(e)||(c.Base.Utils.isDefined(e.credentialProvider)&&"string"==typeof e.credentialProvider.username&&"string"==typeof e.credentialProvider.password?t.authentication={type:c.Config.Authentication.Scheme.BASIC,username:e.credentialProvider.username,password:e.credentialProvider.password}:c.Base.Utils.isDefined(e.credentialProvider)&&"string"==typeof e.credentialProvider.token&&(t.authentication={type:c.Config.Authentication.Scheme.BEARER,bearer:e.credentialProvider.bearer,token:e.credentialProvider.token})),t},buildDeleteSessionOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_DELETE,crossDomain:!0}},buildSubscribeRequest:function(e,t){return{subscribe:{requestId:this._generateRequestId(),resources:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:e,resource:t}],version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildUnsubscribeRequest:function(e,t){return{unsubscribe:{requestId:this._generateRequestId(),resources:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:e,resource:t}],version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildSubscribeGenericEventsOptions:function(e){return this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_POST,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildUnsubscribeGenericEventsOptions:function(e,t){e=this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_DELETE,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE);return e.urlSuffix=e.urlSuffix+"?sessionId="+t,e},buildUpdateGenericEventsOptions:function(e){return this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_PUT,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildNotificationsOptions:function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},buildProcessMediaOfferResponseNotification:function(e,t,i,a,r,s,n){n={action:i,actionDetails:{targetCallId:null,participants:null,sdpType:a.toUpperCase(),sdp:r,audioChannel:c.Base.Utils.isDefined(s)?s:null,videoChannels:c.Base.Utils.isDefined(n)?n:null,conferenceData:null}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:o.CSA_CALL_ACTION,messageData:JSON.stringify(n)}}]}}},buildRejectOfferResponseNotification:function(e,t,i,a,r){r={error:[{errorCode:i,errorMsg:a,displayMsg:r}]};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:o.CSA_ERROR,messageData:JSON.stringify(r)}}]}}},buildProcessMediaAnswerResponseNotification:function(e,t,i,a){return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreateMediaResponseNotification:function(e,t,i,a,r,s){s={action:null,actionDetails:{targetCallId:null,participants:null,sdpType:i.toUpperCase(),sdp:a,audioChannel:c.Base.Utils.isDefined(r)?r:null,videoChannels:c.Base.Utils.isDefined(s)?s:null,conferenceData:null}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.CREATE_MEDIA_RESPONSE,messageDataType:o.CSA_CALL_ACTION,messageData:JSON.stringify(s)}}]}}},buildUpdateMediaRequestNotification:function(e,t,i,a,r,s){s=!!s,s={action:i,actionDetails:{targetCallId:null,participants:null,sdpType:null,sdp:null,audioChannel:c.Base.Utils.isDefined(a)?a:null,videoChannels:c.Base.Utils.isDefined(r)?r:null,conferenceData:null,forceIceRestart:s}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_REQUEST,messageDataType:o.CSA_CALL_ACTION,messageData:JSON.stringify(s)}}]}}},buildGetConfigurationOptions:function(e){return{url:e,sendType:"GET",dataType:"JSON",headers:{Accept:[o.CSA_CONFIGURATION,o.CSA_ERROR].join(", ")}}},buildAcceptCallResponse:function(e,t,i){return{notify:{requestId:c.Base.Utils.isDefined(i)&&null!==i?i:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.ACCEPT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildRejectCallResponse:function(e,t,i){return{notify:{requestId:c.Base.Utils.isDefined(i)&&null!==i?i:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.REJECT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreatePubSubContainerOptions:function(e){return{url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,headers:{Accept:[o.CSA_PRESENCE_CONTAINER,o.CSA_ERROR].join(", "),"Content-Type":o.CSA_PRESENCE_CONTAINER}}},buildDeletePubSubContainerOptions:function(e){return{url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_DELETE,headers:{Accept:o.CSA_ERROR}}},buildCreateOrExtendPubSubContainerData:function(e,t,i){if(!e||t||i)return JSON.stringify({pubSubContainer:{additionalResources:{presencePublication:t?{}:T,presenceSubscriptions:i?[{}]:T}}})},buildPublishPresenceOptions:function(e){return{url:e,sendType:"PUT",headers:{Accept:[o.CSA_ERROR,o.CSA_PRESENCE_PUBLICATION].join(", "),"Content-Type":o.CSA_PRESENCE_PUBLICATION}}},buildDeleteManualPresenceOptions:function(e){return{url:e,sendType:"DELETE",headers:{Accept:o.CSA_ERROR}}},buildPublishManualPresenceData:function(e,t){var i={presencePublication:{}};return e===c.Providers.CallServiceGateway.Constants.MANUAL_STATE?i.presencePublication.manualState={stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(t)}:e===c.Providers.CallServiceGateway.Constants.MODE?i.presencePublication.mode={modeEnum:c.Providers.CallServiceGateway.Utils.convertPresenceModeToCSGPresenceMode(t)}:e===c.Providers.CallServiceGateway.Constants.NOTE&&(i.presencePublication.note={content:t}),JSON.stringify(i)},buildPublishAutoPresenceData:function(e){var t=[],i=e.getEnterpriseIMState(),a=e.getEnterpriseIMContact(),r=e.getVideoState(),s=e.getVideoContact(),n=e.getPhoneState(),o=e.getPhoneContact(),e=c.Services.Presence.PresenceState;return r&&r!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"video",contact:s,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(r),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),i&&i!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"im",contact:a,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(i),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),n&&n!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"phone",contact:o,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(n),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),JSON.stringify({presencePublication:{channelPresence:t}})},buildPresenceSubscriptionData:function(e,t){var i=[];return t.forEach(function(e){i.push({userIdentity:{userId:e}})}),JSON.stringify({resourceList:{listDefaults:{action:e,aclConfirmHandling:"prompt",docType:"full"},presentities:i}})},buildPresenceSubscriptionOptions:function(e){return{url:e,sendType:"POST",dataType:"JSON",headers:{Accept:[o.CSA_ERROR,o.CSA_PRESENCE_RESOURCE_LIST].join(", "),"Content-Type":o.CSA_PRESENCE_RESOURCE_LIST}}},buildUpdateCallPropertiesNotification:function(e,t,i,a,r){i={sessionId:i,videoChannels:c.Base.Utils.isDefined(a)?a:null};return a&&0!==a.length&&(c.Base.Utils.isDefined(r.localVideoMute)?i.videoChannels[0].localVideoMute=r.localVideoMute:i.videoChannels[0].localVideoMute=null,c.Base.Utils.isDefined(r.preferredReceiveResolution)?i.videoChannels[0].preferredReceiveResolution=r.preferredReceiveResolution:i.videoChannels[0].preferredReceiveResolution=null,c.Base.Utils.isDefined(r.screenSharing)?i.videoChannels[0].screenSharing=r.screenSharing:i.videoChannels[0].screenSharing=null,i.videoChannels[0].maxFrames=null,i.videoChannels[0].bandwidth=null),{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.UPDATE_CALL_PROPERTIES,messageDataType:o.MPAAS_CALL_PROPERTIES,messageData:JSON.stringify(i)}}]}}},_generateRequestId:function(e){return e?"jscsdk."+e+".req-"+this._requestCounter++:"jscsdk.null.req-"+this._requestCounter++},_isFirefoxBrowser:function(){return c.Base.Utils.getBrowserType()===c.Base.BrowserType.FIREFOX},_generateCommonGenericEventsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:T,dataType:T,headers:T,crossDomain:!0}},_generateGenericEventsOptions:function(e,t,i,a){e=this._generateCommonGenericEventsOptions(e);return e.dataType=a,e.sendType=t,e.headers={"Content-type":i},e}},c.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGNotificationEventType={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGToneType={RINGBACK:"ringback",INTERCEPT:"intercept",REORDER:"reorder",FASTBUSY:"fastBusy"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallActionType={ACCEPT_AUDIO:"ACCEPT_AUDIO",ACCEPT_VIDEO:"ACCEPT_VIDEO",ACTIVATE:"ACTIVATE",ADD_PARTICIPANT:"ADD_PARTICIPANT",ADD_VIDEO:"ADD_VIDEO",ANSWER:"ANSWER",DEACTIVATE:"DEACTIVATE",DENY_AUDIO:"DENY_AUDIO",DENY_VIDEO:"DENY_VIDEO",END:"END",HOLD:"HOLD",INCOMING_ADD_VIDEO:"INCOMING_ADD_VIDEO",JOIN:"JOIN",MUTE_VIDEO:"MUTE_VIDEO",UNMUTE_VIDEO:"UNMUTE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",REMOTE_VIDEO_REMOVED_ACK:"REMOTE_VIDEO_REMOVED_ACK",RINGING:"RINGING",TRANSFER:"TRANSFER",UNHOLD:"UNHOLD",UPDATE_VIDEO:"UPDATE_VIDEO"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.Constants={TELEPHONY_SERVICE:"telephony",CSA_APPLICATION:"CSA",CREATE_MEDIA_RESPONSE:"createMediaResponse",PROCESS_MEDIA_REQUEST:"processMediaRequest",PROCESS_MEDIA_RESPONSE:"processMediaResponse",ACCEPT_CALL_RESPONSE:"acceptCallResponse",REJECT_CALL_RESPONSE:"rejectCallResponse",UPDATE_CALL_PROPERTIES:"updatecallproperties",MUTE_VIDEO:"muteVideo",UNMUTE_VIDEO:"unmuteVideo",HTTP:"HTTP",HTTP_POST:"POST",HTTP_GET:"GET",HTTP_DELETE:"DELETE",HTTP_PUT:"PUT",HTTP_BAD_REQUEST:400,JSON_DATA_TYPE:"json",TEXT_DATA_TYPE:"text",CSA_RESOURCE_PATH:"/csa/resources/tenants/default",CSA_VERSION_1:"1",COMPUTER:"COMPUTER",CALLS:"CALLS",PRESENCE:"PRESENCE",WEBRTC:"WEBRTC",STANDARD:"STANDARD",SEND:"SEND",RECEIVE:"RECEIVE",SEND_ONLY:"SEND_ONLY",RECV_ONLY:"RECEIVE_ONLY",SEND_RECV:"SEND_RECEIVE",INACTIVE:"INACTIVE",ENABLE:"ENABLE",DISABLE:"DISABLE",SDP_TYPE_ANSWER:"answer",SDP_TYPE_OFFER:"offer",ACTIVATED:"activated",CALL_STATE_FAILURE_ERROR_CODE:4220072,CALL_DOES_NOT_EXISTS:4040009,SEE_OTHER_RESOURCE:303e4,SVC_PRESENCE:"presence",MANUAL_STATE:"manualState",STATE:"state",MODE:"mode",NOTE:"note",SUBSCRIPTION_ADD:"add",SUBSCRIPTION_REMOVE:"remove",STATUS_ACTIVE:"active",AVAYA_COMMUNICATOR:"AVAYA_COMMUNICATOR",RESOURCE_DISCOVERY_USERNAME_MISMATCH:"Mismatch username",MWI_ON:"ON",MWI_OFF:"OFF",CLIENT_SESSION_EXPIRED:"CLIENT_SESSION_EXPIRED",DEACTIVATED_BY_CLIENT:"DEACTIVATED_BY_CLIENT",GUEST_SESSION_EXPIRED:"GUEST_SESSION_EXPIRED",PERMANENT_REGISTRATION_FAILURE:"PERMANENT_REGISTRATION_FAILURE",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",USER_DOES_NOT_MATCH:"USER_DOES_NOT_MATCH",TEMPORARY_REGISTRATION_FAILURE:"TEMPORARY_REGISTRATION_FAILURE",CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS:"application/vnd.avaya.mpaas.eventsubscription+json",CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS:"application/json"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ResourceType={Users:"users",Clients:"clients",Calls:"calls",Services:"services",KeepAlive:"keepalive",SessionManagement:"sessionManagement",Websocket:"websocket",SSE:"sse",iViewToken:"iviewtoken",RestSessionMgmt:"RestSessionMgmt",ClientKeepAlive:"ClientKeepAlive",ClientTerminate:"ClientTerminate",Configuration:"configuration",FastDelete:"fastDelete",UploadLogs:"upload-logs",PresenceSubscriptions:"presence-subscriptions",PresencePublications:"presence-publications",CreatePresenceContainer:"CreatePresenceContainer",PublishPresenceState:"PublishPresenceState",PublishPresenceMode:"PublishPresenceMode",PublishPresenceNote:"PublishPresenceNote",DeletePresenceState:"DeletePresenceState",DeletePresenceMode:"DeletePresenceMode",DeletePresenceNote:"DeletePresenceNote"}}(),function(s){"use strict";var n=s.Providers.CallServiceGateway.Constants;s.Providers.CallServiceGateway.Utils={convertToAudioChannel:function(e,t,i){var a=null;if(e&&((a={channelId:e.id}).state=e.enabled?n.ENABLE:n.DISABLE,a.direction=this.convertToChannelDirection(e.direction),t?a.logicalDirection=this.convertToChannelDirection(t.getLogicalDirection()):e.logicalDirection&&(a.logicalDirection=this.convertToChannelDirection(e.logicalDirection)),i))switch(i){case s.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case s.Services.Call.NoiseReductionSetting.ENABLED:a.serverNoiseReduction="ENABLE";break;case s.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case s.Services.Call.NoiseReductionSetting.DISABLE_ALL:a.serverNoiseReduction="DISABLE"}return a},convertToVideoChannels:function(e,i,a){var r=[];return e&&e.forEach(function(e){var t;e&&((t={channelId:e.id}).state=e.enabled?n.ENABLE:n.DISABLE,t.direction=this.convertToChannelDirection(e.direction),i?t.logicalDirection=this.convertToChannelDirection(i.getLogicalDirection()):e.logicalDirection&&(t.logicalDirection=this.convertToChannelDirection(e.logicalDirection)),s.Base.Utils.isDefined(a)&&(t.localVideoMute=a),r.push(t))}.bind(this)),r},convertToVideoChannelGuidelines:function(e){var t={};return e&&(e.getRequiredDirection()&&(t.requiredClientLegDirections=this.convertToChannelGuideLine(e.getRequiredDirection())),e.getPermittedDirection()&&(t.permittedLogicalDirections=this.convertToChannelGuideLine(e.getPermittedDirection()))),t},convertToChannelDirection:function(e){switch(e){case s.Services.Call.MediaDirection.SEND_ONLY:return n.SEND_ONLY;case s.Services.Call.MediaDirection.RECV_ONLY:return n.RECV_ONLY;case s.Services.Call.MediaDirection.SEND_RECV:return n.SEND_RECV;default:return n.INACTIVE}},convertToChannelGuideLine:function(e){switch(e){case s.Services.Call.MediaDirection.SEND_ONLY:return[n.SEND];case s.Services.Call.MediaDirection.RECV_ONLY:return[n.RECEIVE];case s.Services.Call.MediaDirection.SEND_RECV:return[n.SEND,n.RECEIVE];default:return[]}},convertToAudioStream:function(e,t){var i=null;return e&&((i=new s.Providers.Interfaces.AudioStream(e.channelId,this.convertToMediaDirection(e.direction))).enabled=e.state===n.ENABLE,t&&e.logicalDirection&&(i.logicalDirection=this.convertToMediaDirection(e.logicalDirection)),e.serverNoiseReduction&&(i.serverNoiseReduction=e.serverNoiseReduction)),i},convertToVideoStreams:function(e,i){var a=[];return e&&e.forEach(function(e){var t;e&&((t=new s.Providers.Interfaces.VideoStream(e.channelId,this.convertToMediaDirection(e.direction),e.maxHeight,e.maxWidth,e.maxFrames)).enabled=e.state===n.ENABLE,i&&e.logicalDirection&&(t.logicalDirection=this.convertToMediaDirection(e.logicalDirection)),a.push(t))}.bind(this)),a},convertToMediaDirection:function(e){switch(e){case n.SEND_ONLY:return s.Services.Call.MediaDirection.SEND_ONLY;case n.RECV_ONLY:return s.Services.Call.MediaDirection.RECV_ONLY;case n.SEND_RECV:return s.Services.Call.MediaDirection.SEND_RECV;default:return s.Services.Call.MediaDirection.INACTIVE}},convertAlertType:function(e){switch(e){case"ALERT_TYPE_UNSPECIFIED":return s.Services.Call.AlertType.UNSPECIFIED;case"ALERT_TYPE_NONE":return s.Services.Call.AlertType.NONE;case"ALERT_TYPE_INTERNAL":return s.Services.Call.AlertType.INTERNAL;case"ALERT_TYPE_EXTERNAL":return s.Services.Call.AlertType.EXTERNAL;case"ALERT_TYPE_PRIORITY":return s.Services.Call.AlertType.PRIORITY;case"ALERT_TYPE_INTERCOM":return s.Services.Call.AlertType.INTERCOM;case"ALERT_TYPE_AUTO_CALLBACK":return s.Services.Call.AlertType.AUTO_CALLBACK;case"ALERT_TYPE_HOLD_RECALL":return s.Services.Call.AlertType.HOLD_RECALL;case"ALERT_TYPE_DIRECT_AGENT_CALL_INTERNAL":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_INTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_EXTERNAL":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_EXTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_PRIORITY":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_PRIORITY;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_INTERNAL":return s.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_INTERNAL;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL":return s.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL;default:return s.Base.Logger.info(s.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled alert type: "+e),s.Services.Call.AlertType.UNSPECIFIED}},convertErrorCode:function(e){switch(e){case 4010001:return s.Services.Call.CallError.NOT_AUTHORIZED;case 4010003:return s.Services.Call.CallError.UNAUTHORIZED;case 4040009:return s.Services.Call.CallError.NOT_FOUND;case 4040011:return s.Services.Call.CallError.SESSION_ID_NOT_FOUND;case 4040013:return s.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED;case 4220072:return s.Services.Call.CallError.CALL_STATE_MISMATCH;case 4220078:return s.Services.Call.CallError.MEDIA_PRESERVED;case 5000010:return s.Services.Call.CallError.USER_NOT_FOUND;case 5000022:return s.Services.Call.CallError.BUSY;case 5000036:return s.Services.Call.CallError.VIDEO_DENIED;default:return s.Services.Call.CallError.INTERNAL_ERROR}},convertPresenceStateToCSGPresenceState:function(e){switch(e){case s.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE:return s.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE;case s.Services.Presence.PresenceState.PRESENCE_STATE_AWAY:return s.Providers.CallServiceGateway.CSGPresenceState.AWAY;case s.Services.Presence.PresenceState.PRESENCE_STATE_BUSY:return s.Providers.CallServiceGateway.CSGPresenceState.BUSY;case s.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB:return s.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB;case s.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE:return s.Providers.CallServiceGateway.CSGPresenceState.OFFLINE;case s.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL:return s.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL;case s.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE:return s.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE;default:return T}},convertCSGPresenceStateToPresenceState:function(e){switch(e){case s.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE:return s.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE;case s.Providers.CallServiceGateway.CSGPresenceState.AWAY:return s.Services.Presence.PresenceState.PRESENCE_STATE_AWAY;case s.Providers.CallServiceGateway.CSGPresenceState.BUSY:return s.Services.Presence.PresenceState.PRESENCE_STATE_BUSY;case s.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB:return s.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB;case s.Providers.CallServiceGateway.CSGPresenceState.OFFLINE:return s.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE;case s.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL:return s.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL;case s.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE:return s.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE;default:return s.Services.Presence.PresenceState.PRESENCE_STATE_UNSPECIFIED}},convertPresenceModeToCSGPresenceMode:function(e){switch(e){case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME:return s.Providers.CallServiceGateway.CSGPresenceMode.HOME;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE:return s.Providers.CallServiceGateway.CSGPresenceMode.MOBILE;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE:return s.Providers.CallServiceGateway.CSGPresenceMode.OFFICE;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING:return s.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING;default:return T}},convertCSGPresenceModeToPresenceMode:function(e){switch(e){case s.Providers.CallServiceGateway.CSGPresenceMode.HOME:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME;case s.Providers.CallServiceGateway.CSGPresenceMode.MOBILE:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE;case s.Providers.CallServiceGateway.CSGPresenceMode.OFFICE:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE;case s.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING;default:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_UNSPECIFIED}}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._registerUser=e||!1,this._minBandwidth=t||null,this._videoChannelGuidelines=i}t.prototype={isRegisterUser:function(){return this._registerUser},getMinBandwidth:function(){return this._minBandwidth},getVideoChannelGuidelines:function(){return this._videoChannelGuidelines}},e.Providers.CallServiceGateway.ServiceActivationParameters=t}(AvayaClientServices),function(e){"use strict";e.Providers.CallServiceGateway.AbstractCallMessage=function(){this.type=e.Providers.CallServiceGateway.CallMessageTypes.UNDEFINED}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallMessageTypes={UNDEFINED:"Undefined",SUBSCRIPTION:"Subscription",USER_CLIENTS:"UserClients",PROCESS_MEDIA_REQUEST:"ProcessMediaRequest"}}(),function(e){"use strict";function t(){this.vmnumber=T}t.prototype={},e.Providers.CallServiceGateway.ConfigurationMessage=t}(AvayaClientServices),function(e){"use strict";function t(){this.expires=T,this.containerResources={container:{get:{method:T,href:T},updateOrExtend:{method:T,href:T},delete:{method:T,href:T}}},this.additionalResources={presencePublication:{replace:{method:T,href:T}},presenceSubscriptions:[{update:{method:T,href:T},replace:{method:T,href:T}}]}}t.prototype={},e.Providers.CallServiceGateway.CSGPresenceContainer=t}(AvayaClientServices),function(e){"use strict";function t(){this.presenceDoc={userIdentity:{userId:T}},this.presenceSummary={stateEnum:T},this.manualState={stateEnum:T},this.mode={modeEnum:T},this.note={content:T},this.channelPresence=[]}t.prototype={},e.Providers.CallServiceGateway.CSGPresenceDocument=t}(AvayaClientServices),function(e){"use strict";e.Providers.CallServiceGateway.CSGPresenceState={AVAILABLE:"AVAILABLE",BUSY:"BUSY",DO_NOT_DISTURB:"DO_NOT_DISTURB",ON_A_CALL:"ON_A_CALL",AWAY:"AWAY",OUT_OF_OFFICE:"OUT_OF_OFFICE",OFFLINE:"OFFLINE"};e.Providers.CallServiceGateway.CSGPresenceMode={OFFICE:"OFFICE",HOME:"HOME",MOBILE:"MOBILE",TRAVELING:"TRAVELING"}}(AvayaClientServices),function(e){"use strict";function t(){this.applications=[],this.capabilities=[],this.commandURL=T,this.sessionManagement={href:T,timeout:T}}t.prototype={},e.Providers.CallServiceGateway.NotificationResources=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=i.Providers.CallServiceGateway.CallMessageTypes.PROCESS_MEDIA_REQUEST,this.callId=e,this.sdp=t}e.prototype=Object.create(i.Providers.CallServiceGateway.AbstractCallMessage.prototype),i.Providers.CallServiceGateway.ProcessMediaRequestMessage=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=t.Providers.CallServiceGateway.CallMessageTypes.CALLINFO,this.registrationId=e,this.href=T,this.mode="Computer"}e.prototype=Object.create(t.Providers.CallServiceGateway.AbstractCallMessage.prototype),t.Providers.CallServiceGateway.RegistrationInfoMessage=e}(AvayaClientServices),function(e){"use strict";function t(){this.resources={avayaRequestTimeout:{maximum:T,minimum:T,recommended:T},capabilities:[],clientId:T,notificationService:{websocket:{href:T},sse:{href:T}},resources:[],sessionManagement:{href:T,timeout:T,username:T},clientManagement:{timeout:T}}}t.prototype={},e.Providers.CallServiceGateway.RestResources=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=t.Providers.CallServiceGateway.CallMessageTypes.SUBSCRIPTION,this.isSubscribed=!1,this.subscriptionId=e,this.application=T,this.service=T,this.resource=T}e.prototype=Object.create(t.Providers.CallServiceGateway.AbstractCallMessage.prototype),t.Providers.CallServiceGateway.SubscriptionCallMessage=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.UserClient=function(e){this.clientId=e,this.version=T,this.endpointLabel=T,this.productName=T}}(),function(e){"use strict";function t(){e.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=e.Providers.CallServiceGateway.CallMessageTypes.USER_CLIENTS,this._clients=[]}(t.prototype=Object.create(e.Providers.CallServiceGateway.AbstractCallMessage.prototype)).add=function(e){this._clients.push(e)},t.prototype.getClients=function(){return this._clients},e.Providers.CallServiceGateway.UserClientsMessage=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ObservableEvents={ANSWER_CALL_REQUEST:"csgwprovider.answerCallRequest",CREATE_MEDIA_REQUEST:"csgwprovider.createMediaRequest",CALL_ENDED:"csgwprovider.call.ended",CALL_ESTABLISHED:"csgwprovider.call.established",CALL_FAILURE:"csgwprovider.call.failure",CALL_HELD:"csgwprovider.call.held",CALL_INCOMING:"csgwprovider.call.incoming",CALL_RINGING:"csgwprovider.call.ringing",CALL_STATE_FAILURE:"csgwprovider.call.stateFailure",CALL_UNHELD:"csgwprovider.call.unheld",CALLS_SERVICE_ACTIVATED:"csgwprovider.callsActivated",CALLS_SERVICE_DEACTIVATED:"csgwprovider.callsDeactivated",ICE_CONFIG_UPDATES:"csgwprovider.ice.config.updates",IVIEW_TOKEN_UPDATE:"csgwprovider.iviewTokenUpdate",MAKE_CALL_REQUEST:"csgwprovider.makeCallRequeset",MAX_NETWORK_RECONNECTION_ATTEMPTED:"csgwprovider.maxReconnectionAttempted",NETWORK_PROVIDER_IS_AVAILABLE:"csgwprovider.network.available",NETWORK_PROVIDER_IS_UNAVAILABLE:"csgwprovider.network.unavailable",PROCESS_ANSWER_REQUEST:"csgwprovider.processAnswerRequest",RINGBACK_TONE_URLS_CHANGED:"csgwprovider.ringbackToneUrlsChanged",SUPPORTED_CALL_ENHANCEMENTS:"csgwprovider.supportedCallEnhancements",TERMINATE_CALL_REQUEST:"csgwprovider.terminateCallRequest",UPDATE_TRANSFER_STATUS:"csgwprovider.update.transferStatus",UPDATE_CALL_DATA:"csgwprovider.update.callData",UPDATE_CALL_REQUEST:"csgwprovider.update.callRequest",UPDATE_CONSULT_CONFERENCE_STATUS:"csgwprovider.update.consultConferenceStatus",UPLOAD_LOGS_UPDATE:"csgwprovider.uploadlogs",VIDEO_LICENSE_UPDATED:"csgwprovider.videoLicenceUpdated"}}(),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=new i.Providers.Interfaces.Call;return t.callId=e.callId,t.capabilities=e.capabilities,t.clientCpuUsageMgmt=e.clientCpuUsageMgmt,t}},i.Providers.CallServiceGateway.CallInfoParser=e}(AvayaClientServices),function(e){"use strict";function t(e){this._callInfoParser=e}t.prototype={parse:function(e){for(var t=[],i=0;i<e.calls.length;i++)t.push(this._callInfoParser.parse(e.calls[i]));return t}},e.Providers.CallServiceGateway.ClientCallsParser=t}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return S.extend(new t.Providers.CallServiceGateway.ConfigurationMessage,e)}},t.Providers.CallServiceGateway.ConfigurationParser=e}(AvayaClientServices),function(p){"use strict";function e(e){this._provider=e}e.prototype={parse:function(t){var e=p.Base.Utils.isDefined(t.messageData)?JSON.parse(t.messageData):T;switch(t.messageType){case p.Providers.CallServiceGateway.NotificationType.CallFailure:var i=p.Base.Utils.queryJSONObject(e,"error[0].errorCode"),a=p.Providers.CallServiceGateway.Utils.convertErrorCode(i),r=p.Base.Utils.queryJSONObject(e,"error[0].displayMsg");i===p.Providers.CallServiceGateway.Constants.CALL_STATE_FAILURE_ERROR_CODE?this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,[t.callId,a,p.Services.Call.CallProtocolType.APPLICATION,i,r]):this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[t.callId,a,p.Services.Call.CallProtocolType.APPLICATION,i,r]);break;case p.Providers.CallServiceGateway.NotificationType.IncomingCall:s=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),n=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),o=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),c=p.Base.Utils.queryJSONObject(e,"actionDetails.answerMode"),this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,[t.callId,e.actionDetails.participants[0].remoteAddress,e.actionDetails.participants[0].remoteDisplayName,e.actionDetails.avayaAsserted,e.actionDetails.private,p.Providers.CallServiceGateway.Utils.convertAlertType(e.actionDetails.alertType),e.actionDetails.sdpType,e.actionDetails.sdp,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),e.actionDetails.subject,e.actionDetails.videoBandwidth,s,n,o,this.processTurnData(e.actionDetails.turnData),c]);break;case p.Providers.CallServiceGateway.NotificationType.CallRinging:var s=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),n=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),o=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),r=!1,c=p.Base.Utils.queryJSONObject(t,"alertingTypeEarlyMedia");p.Base.Utils.isDefined(c)&&("boolean"==typeof c?r=c:"string"==typeof c&&(r="true"===c.toLowerCase())),this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,[t.callId,e.actionDetails.participants[0].remoteAddress,e.actionDetails.participants[0].remoteDisplayName,e.actionDetails.avayaAsserted,e.actionDetails.private,p.Providers.CallServiceGateway.Utils.convertAlertType(e.actionDetails.alertType),r,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),s,n,o]);break;case p.Providers.CallServiceGateway.NotificationType.CallEstablished:var l=p.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.conference");l&&(h=e.actionDetails.conferenceData.uccpUrl),_=p.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.webCollaborationUrl"),s=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),n=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),o=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId");l=[t.callId,e.actionDetails.participants[0].remoteAddress,e.actionDetails.participants[0].remoteDisplayName,e.actionDetails.subject,e.actionDetails.remote,e.actionDetails.private,e.actionDetails.alertType,e.actionDetails.avayaAsserted,e.actionDetails.clientCpuUsageMgmt,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),l,h,_,e.actionDetails.videoBandwidth,s,n,o];this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,l);break;case p.Providers.CallServiceGateway.NotificationType.CallHeld:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_HELD,[t.callId]);break;case p.Providers.CallServiceGateway.NotificationType.CallUnheld:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_UNHELD,[t.callId]);break;case p.Providers.CallServiceGateway.NotificationType.CallEnded:var d=!1;if(t.endCallReason)try{var C=JSON.parse(t.endCallReason);C&&(C=new p.Providers.Call.CallReason(C.reasonProtocol,C.reasonCode,C.reasonText),this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[t.callId,C]),d=!0)}catch(e){p.Base.Logger.error(p.Base.LoggerTags.CALL_PROVIDER,"Failed to parse end call reason: "+t.endCallReason)}d||this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[t.callId]);break;case p.Providers.CallServiceGateway.NotificationType.CreateMediaRequest:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,[t.callId,e.action,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),e.actionDetails.videoBandwidth,this.processTurnData(e.actionDetails.turnData),e.actionDetails.usesIPv6Cand]);break;case p.Providers.CallServiceGateway.NotificationType.ProcessMediaRequest:this.processMediaRequestHandler(t.callId,e.action,e.actionDetails.sdpType,e.actionDetails.sdp,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),e.actionDetails.videoBandwidth,this.processTurnData(e.actionDetails.turnData),e.actionDetails.forceIceRestart,e.actionDetails.usesIPv6Cand);break;case p.Providers.CallServiceGateway.NotificationType.ProcessMediaResponse:this.processMediaResponseHandler(t.callId,e.action,e.actionDetails.sdpType,e.actionDetails.sdp,p.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),p.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()));break;case p.Providers.CallServiceGateway.NotificationType.UpdateTransferStatus:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,[t.callId,t.transferStatus]);break;case p.Providers.CallServiceGateway.NotificationType.UpdateCallData:var u,h=e.actionDetails.participants[0],_=p.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.conference"),l=!1;p.Base.Utils.isDefined(_)&&("boolean"==typeof _?l=_:"string"==typeof _&&(l="true"===_.toLowerCase()),u=e.actionDetails.conferenceData.uccpUrl,v=e.actionDetails.conferenceData.webCollaborationUrl),s=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),n=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),o=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,[t.callId,h.remoteAddress,h.remoteDisplayName,l,u,v,s,n,o]);break;case p.Providers.CallServiceGateway.NotificationType.MWIStatusChanged:var v=t.status;v===p.Providers.CallServiceGateway.Constants.MWI_OFF||v===p.Providers.CallServiceGateway.Constants.MWI_ON?this._provider.setVoicemailMWI(v):p.Base.Logger.warn(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received MWIStatusChanged notification in invalid format");break;case p.Providers.CallServiceGateway.NotificationType.EndpointConfigurationUpdate:this._provider.setVoicemailNumber(t.voiceMailNumber),this._provider.trigger(p.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,[t.voiceMailNumber]),t.IPVideoEnable&&this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,["true"===t.IPVideoEnable]);break;case p.Providers.CallServiceGateway.NotificationType.AddParticipantStatus:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,[t.callId,t.status]);break;case p.Providers.CallServiceGateway.NotificationType.AnswerCallRequest:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,[t.callId,t.requestId]);break;case p.Providers.CallServiceGateway.NotificationType.TerminateCallRequest:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,[t.callId,t.requestId]);break;case p.Providers.CallServiceGateway.NotificationType.UpdateCallRequest:this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,[t.callId,t.requestId,t.callactiontype]);break;case p.Providers.CallServiceGateway.NotificationType.MakeCallRequest:s=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),n=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),o=p.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),this._provider.trigger(p.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,[t.callId,t.dialToAddress,t.requestId,s,n,o]);break;case p.Providers.CallServiceGateway.NotificationType.ServiceStatusChanged:this._provider.activateService(t.service,t.status,t.deactivationReason);break;case p.Providers.CallServiceGateway.NotificationType.NetworkEvents:this._provider.networkEventNotification(e);break;default:p.Base.Logger.info(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Ignoring telephony notification: [Id:"+t.callId+",Type:"+t.messageType+"]")}},processMediaRequestHandler:function(e,t,i,a,r,s,n,o,c,l){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Request: ["+t+","+i+"]"),i&&i.toLowerCase()===p.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(e,t,a,r,s,n):a?this._provider.getCallProvider().offerSDP(e,t,a,r,s,n,o):(a=!1,p.Base.Utils.isDefined(c)&&(a=c),this._provider.getCallProvider().getOfferSDP(e,t,r,s,n,o,a,l))},processMediaResponseHandler:function(e,t,i,a,r,s){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Response: "+i),p.Base.Utils.isDefined(a)&&null!==a?i&&i.toLowerCase()===p.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(e,t,a,r,s):p.Base.Logger.info(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled SDP from process media response for ["+t+","+i+"]"):this._provider.getCallProvider().answerSdpAck(e,t,r,s)},processTurnData:function(e){if(e){var t=e.turnAddressDetails.turnAddress,i=e.sessionId,a=e.accessToken,r="relay";p.Base.Utils.isDefined(e.forceTurn)&&!1===e.forceTurn&&(r="all");for(var s=[],n=0;n<e.turnAddressDetails.turnTypesPriorities.length;n++){var o=e.turnAddressDetails.turnTypesPriorities[n],c=o.turnAddress||t,l="turn",d=o.port,C=o.transportType;"tls"===o.transportType&&(l="turns",C="tcp");d=new p.Providers.Call.TurnTransportType(c,l,C,d);this._provider.getCallProvider()._isTurnTlsHasHighestPriority()&&d._setTlsToHighestPriority(!0),s.push(d)}return new p.Providers.Call.TurnData(i,a,t,s,r,e.expiryTime)}return T}},p.Providers.CallServiceGateway.NotificationParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.NotificationType={CreateMediaRequest:"createMediaRequest",ProcessMediaRequest:"processMediaRequest",ProcessMediaResponse:"processMediaResponse",IncomingCall:"callIncoming",CallRinging:"callRinging",CallEstablished:"callEstablished",CallEnded:"callEnded",CallFailure:"callFailure",CallHeld:"onCallRemoteHeld",CallUnheld:"onCallRemoteUnheld",UpdateTransferStatus:"updateTransferStatus",UpdateCallData:"updateCallData",MWIStatusChanged:"MWIStatusChanged",EndpointConfigurationUpdate:"EndpointConfigurationUpdate",AddParticipantStatus:"addParticipantStatus",AnswerCallRequest:"answerCallRequest",AnswerCallResponse:"answerCallResponse",TerminateCallRequest:"terminateCallRequest",UpdateCallRequest:"updateCallRequest",MakeCallRequest:"makeCallRequest",ServiceStatusChanged:"serviceStatusChanged",NetworkEvents:"mpaasevents"}}(),function(r){"use strict";function e(){}e.prototype={parse:function(e){for(var t=new r.Providers.CallServiceGateway.UserClientsMessage,i=0;i<e.clients.length;i++){var a=this.parseClient(e.clients[i]);t.add(a)}return t},parseClient:function(e){var t=new r.Providers.CallServiceGateway.UserClient(e.clientId);return t.version=e.version,t.endpointLabel=e.endpointLabel,t.productName=e.productName,t}},r.Providers.CallServiceGateway.UserClientsParser=e}(AvayaClientServices),function(t){"use strict";t.Providers.ContentSharing.BandwidthManager=function(e){this._serverManager=e,this._queue=[],this._intervals=[],this._encodingTimes=[],this._run=!1,this._outstandingDataSize=0,this._isAcksActivated=!0,this._minimalInterval=100,this._lastIntervalsToConsiderCount=10,this._maxBytesPerSecond=37500,this._bytesSentLastSecond=0,this._queueSize=0,this._sendTimeout=T},t.Providers.ContentSharing.BandwidthManager.prototype={start:function(e){this._interval=e.captureInterval,this._maxBytesPerSecond=e.maxBytesPerSecond;for(var t=0;t<this._lastIntervalsToConsiderCount;t++)this._intervals.push(e.captureInterval);this._serverManager.onBandwidthAvailable=function(){this._process()}.bind(this),this._serverManager.start(e)},stop:function(){var e=S.Deferred();return this._queue=[],this._queueSize=0,this._outstandingDataSize=0,this._serverManager.stop(),clearTimeout(this._sendTimeout),e.resolve(),e.promise()},pause:function(){this._serverManager.stop()},resume:function(){var e={maxBytesPerSecond:this._maxBytesPerSecond};this._serverManager.start(e)},addToQueue:function(e){var t;e._keyFrame&&(this._lostSize=0,this._queue.forEach(function(e){this._lostSize+=e.byteLength}.bind(this)),t=(this._bytesSentLastSecond+this._lostSize)/this._maxBytesPerSecond,this._intervals.push(Math.floor(this._interval*t)),this._determineInterval(),this._queue=[]),this._queue.push(e),this._run||(this._run=!0,this._process())},onIntervalChanged:function(e){},setMaxUploadSpeed:function(e){this._maxBytesPerSecond=e/8*1e3},isFrameNeeded:function(e){if(this._queueSize=this._queue.reduce(function(e,t){return e+t.byteLength},0),this._isAcksActivated){var t=Math.min(this._serverManager.getActualBandwidth(),this._maxBytesPerSecond);this._maxCapacity=.333*t,this._outstandingDataSize=this._serverManager.getOutstandingDataSize();var i=t*e/1e3,t=t*this._getAverageEncodingTime()/1e3,t=this._maxCapacity+i+t>=this._queueSize+this._outstandingDataSize;return this._serverManager.setIsFrameNeeded(t),t}return(i=this._maxBytesPerSecond*e/1e3)>=this._queueSize},_determineInterval:function(){for(var e=0,t=this._intervals.length-this._lastIntervalsToConsiderCount;t<this._intervals.length;t++)e+=this._intervals[t];var i=e/this._lastIntervalsToConsiderCount;i<this._minimalInterval&&(i=this._minimalInterval),this._interval=Math.floor(i),this.onIntervalChanged(this._interval)},_process:function(){this._queueSize=this._queue.reduce(function(e,t){return e+t.byteLength},0),t.Base.Logger.debug(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Current screen sharing queue size: "+this._queueSize+" bytes.  Length: "+this._queue.length);var e=this._queue.shift();e?this._serverManager.canSend(e.byteLength)?(t.Base.Logger.debug(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Sending "+e.byteLength+" bytes from screen sharing queue."),this._send(e),this._process()):this._queue.unshift(e):this._run=!1},_send:function(e){this._serverManager.send(e),this._bytesSentLastSecond+=e.getByteLength(),this._sendTimeout=setTimeout(function(){this._bytesSentLastSecond-=e.getByteLength()}.bind(this),1e3)},addToEncodingTimes:function(e){100<this._encodingTimes.length&&this._encodingTimes.slice(this._encodingTimes.length-100),this._encodingTimes.push(e)},setAcksActivated:function(e){this._isAcksActivated=e,this._serverManager.setAcksActivated(this._isAcksActivated)},_getAverageEncodingTime:function(){return 0===this._encodingTimes.length?0:this._encodingTimes.reduce(function(e,t){return e+t/this._encodingTimes.length}.bind(this),0)}}}(AvayaClientServices),function(s){"use strict";function e(){this._jpegImageQuality=.35,this._messageId=1,this._maxMessageId=Math.pow(2,31)}e.prototype={createStartTag:function(e,t,i,a){var r=new s.Providers.WCS.ScreenSharingStartTag;return a&&(r.messageId=this._getMessageId()),r.isKeyFrame=e,r.width=t,r.height=i,r.creationTime=Date.now(),r},createBlockTag:function(e,t){var i=new s.Providers.WCS.ScreenSharingBlockTag;t&&(i.messageId=this._getMessageId()),i.x=e._x,i.y=e._y,i.width=e._width,i.height=e._height;t=this._jpegImageQuality;e._type?(e._type===s.Providers.WCS.ScreenSharingImageTypes.JPEG_RED_WITH_BLACK&&(e._type=s.Providers.WCS.ScreenSharingImageTypes.JPEG,t=Math.max(.8,t)),i.imageType=e._type):i.imageType=s.Providers.WCS.ScreenSharingImageTypes.JPEG;t=this._getImageData(e,e._type,t);return i.length=t.length,i.data=t,i},createEndTag:function(e){var t=new s.Providers.WCS.ScreenSharingEndTag;return e&&(t.messageId=this._getMessageId()),t},_getImageData:function(e,t,i){var a=document.createElement("canvas");a.width=e._width,a.height=e._height,a.getContext("2d").putImageData(e._imgData,0,0);t=t===s.Providers.WCS.ScreenSharingImageTypes.JPEG?"jpeg":"png",i=a.toDataURL("image/"+t,i);return this._getImageBuffer(i)},_getImageBuffer:function(e){for(var e=e.split(","),t=atob(e[1]),i=t.length,a=new Uint8Array(i);i--;)a[i]=t.charCodeAt(i);return a},setJpegImageQuality:function(e){e&&(this._jpegImageQuality=e)},_getMessageId:function(){var e=this._messageId;return this._setMessageId(),e},_setMessageId:function(){return this._messageId<this._maxMessageId-1?this._messageId++:this._messageId=1}},s.Providers.ContentSharing.ContentSharingTagBuilder=e}(AvayaClientServices),function(i,a){"use strict";var r="SCREEN_SHARING",s="PONG",n="START",o="Chrome",c="Firefox",e="message",l="CANCELED";i.Providers.ContentSharing.ExtensionNetworkProvider=function(e){this._pingTimer=T,this._pingTime=0,this._pongTime=0,this._pingInterval=500,this._requestBuilder=e,this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.INVALID,this._onMediaAvailableCallbacks=S.Callbacks(),this._onCapabilityChangeCallbacks=S.Callbacks(),this._onMediaCancelledCallbacks=S.Callbacks(),this._listenerFunction=T,this._isExtensionAvailable=!1},i.Providers.ContentSharing.ExtensionNetworkProvider.prototype={setExtensionAvailable:function(e){this._isExtensionAvailable=e,this._onCapabilityChangeCallbacks.fire(i.Providers.ContentSharing.InstalledExtensionType.CHROME,this._isExtensionAvailable)},start:function(){this._startWindowEventListener(),i.Base.Utils.getBrowserSubType()===i.Base.BrowserSubType.ELECTRON?this.setExtensionAvailable(!0):(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.INVALID,this._startPingTask())},send:function(e){a.postMessage(e,"*")},stop:function(){this._stopPingTimer(),this._removeWindowEventListener()},addOnMediaAvailableCallback:function(e){this._onMediaAvailableCallbacks.add(e)},removeOnMediaAvailableCallback:function(e){this._onMediaAvailableCallbacks.remove(e)},addOnMediaCancelledCallback:function(e){this._onMediaCancelledCallbacks.add(e)},removeOnMediaCancelledCallback:function(e){this._onMediaCancelledCallbacks.remove(e)},addOnCapabilityChange:function(e){this._onCapabilityChangeCallbacks.add(e)},removeOnCapabilityChange:function(e){this._onCapabilityChangeCallbacks.remove(e)},getInstalledExtensionType:function(){return this._installedExtensionType},_stopPingTimer:function(){this._pingTimer&&a.clearTimeout(this._pingTimer)},_startWindowEventListener:function(){this._listenerFunction=function(e){var t;e.source===a&&e.data.type&&(e.data.type===n?this._onMediaAvailableCallbacks.fire(e):e.data.type===l?this._onMediaCancelledCallbacks.fire(e):e.data.type===s&&e.data.app===r&&(this._pongTime=Date.now(),t=this._installedExtensionType,e.data.extension===o?this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.CHROME:e.data.extension===c&&(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.FIREFOX),t!==i.Providers.ContentSharing.InstalledExtensionType.CHROME&&t!==i.Providers.ContentSharing.InstalledExtensionType.FIREFOX&&(this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!0),this._pingInterval=2e3)))}.bind(this),a.addEventListener(e,this._listenerFunction,!1),this._pingTime=Date.now(),this.send(this._requestBuilder.createPingRequest()),i.Base.Logger.debug(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Started receiving pings from extension")},_removeWindowEventListener:function(){a.removeEventListener(e,this._listenerFunction,!1),i.Base.Logger.debug(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Stopped receiving pings from extension")},_startPingTask:function(){this._pingTimer&&a.clearTimeout(this._pingTimer),this._pingTimer=a.setTimeout(function(){var e;0===this._pongTime&&this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.INVALID?(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!1),this._pingInterval=2e3<=this._pingInterval?2e3:Math.max(2e3,2*this._pingInterval)):this._pingTime-this._pongTime>this._pingInterval&&(this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.CHROME||this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.FIREFOX)&&(e=this._installedExtensionType,this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(e,!1)),this._pingTime=Date.now(),!0===this._isExtensionAvailable?this._pongTime=Date.now():this.send(this._requestBuilder.createPingRequest()),this._startPingTask()}.bind(this),this._pingInterval)}}}(AvayaClientServices,window),function(e){"use strict";var t="SCREEN_SHARING_PAGE",i="STOP",a="START",r="PING";function s(){}s.prototype={createStartSharingRequest:function(e){return{type:t,text:a,capture:e}},createStopSharingRequest:function(e){return{type:t,text:i,mediaSourceId:e}},createPingRequest:function(){return{type:t,text:r}}},e.Providers.ContentSharing.ExtensionRequestBuilder=s}(AvayaClientServices),function(i){"use strict";i.Providers.ContentSharing.FeatureSupported={isSharingApplicationWindowAvailable:function(){var e=i.Base.Utils.getBrowserType();return e===i.Base.BrowserType.CHROME||e===i.Base.BrowserType.FIREFOX},isSharingFullScreenAvailable:function(){var e=i.Base.Utils.getBrowserType();return e===i.Base.BrowserType.CHROME||e===i.Base.BrowserType.FIREFOX},isSharingAnyTypeAvailable:function(){var e=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,t=i.Base.Utils.getBrowserType()===i.Base.BrowserType.SAFARI;return!0===e&&!1==t},isSharingContentVideoAvailable:function(){var e=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,t=i.Base.Utils.getBrowserType()===i.Base.BrowserType.SAFARI;return e&&!1==t}}}(AvayaClientServices),function(e){"use strict";function t(e){this._blocks=[],this.byteLength=0,this._keyFrame=e,this._processingTime=0}t.prototype={addBlock:function(e){this._blocks.push(e),this.byteLength+=e.byteLength},getBlocks:function(){return this._blocks},getByteLength:function(){return this.byteLength}},e.Providers.ContentSharing.FrameBlocks=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.InstalledExtensionType={CHROME:"Chrome",FIREFOX:"Firefox",NOT_INSTALLED:"Not Installed",INVALID:"Invalid"}}(),function(t){"use strict";function e(e){this._isStarted=!1,this._setInterval=T,this._framesCount=0,this._frametimeAcum=0,this._overloadsCount=0,this._frametimeThreshold=t.Base.Utils.isDefined(e)?e.frametimeThreshold:2e3,this._overloadsThreshold=t.Base.Utils.isDefined(e)?e.overloadsThreshold:2,this._interval=t.Base.Utils.isDefined(e)?e.evaluateInterval:15e3,this._startDelay=7e3,this.onPerformanceMonitorAlert=function(){}}e.prototype.start=function(){this._isStarted?t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager already started"):(t.Base.Logger.info(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager starting in - "+this._startDelay/1e3+"s"),setTimeout(function(){this._isStarted=!0,this._setInterval=setInterval(function(){0<this._framesCount&&this._evaluate()}.bind(this),this._interval)}.bind(this),this._startDelay))},e.prototype.stop=function(){this._isStarted?(this._isStarted=!1,this._clearMeasures(),clearInterval(this._setInterval),t.Base.Logger.info(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager stopped")):t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager is already stop")},e.prototype.registerMeasure=function(e){this._isStarted&&(t.Base.Utils.isDefined(e)?(this._framesCount++,this._frametimeAcum+=e):t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Invalid frametime measaure"))},e.prototype._evaluate=function(){var e=Math.round(this._frametimeAcum/this._framesCount);e>this._frametimeThreshold?(this._overloadsCount++,this._overloadsCount===this._overloadsThreshold&&(e="Average frametime ("+e+"ms) higher than maximum expected ("+this._frametimeThreshold+"ms), overloads acummulated: "+this._overloadsCount,this.onPerformanceMonitorAlert(t.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,e),this._overloadsCount=0)):this._overloadsCount=0,this._clearMeasures()},e.prototype._clearMeasures=function(){this._framesCount=0,this._frametimeAcum=0},t.Providers.ContentSharing.PerformanceManager=e}(AvayaClientServices),function(e){"use strict";var t={0:"Disabled",1:new e.Config.PerformanceManagerConfiguration(2500,2,15e3),2:new e.Config.PerformanceManagerConfiguration(2250,2,15e3),3:new e.Config.PerformanceManagerConfiguration(2e3,2,15e3),4:new e.Config.PerformanceManagerConfiguration(1750,2,15e3),5:new e.Config.PerformanceManagerConfiguration(1500,2,15e3)};e.Providers.ContentSharing.PerformanceManagerProfiles=t}(AvayaClientServices),function(c){"use strict";c.Providers.ContentSharing.ScreenBlock=function(e,t,i,a,r,s,n,o){this._x=e,this._y=t,this._row=i,this._column=a,this._height=s,this._width=r,this._imgData=n,this._previousBase64=T,this._blocks=o||[],this._type=c.Providers.WCS.ScreenSharingImageTypes.JPEG}}(AvayaClientServices),function(u){"use strict";function e(e){u.Base.Observable.call(this),this._config=T,this._video=T,this._videoTrack=T,this._screenScraper=e,this._capturingTimeout=T,this._delayInterval=T,this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._workerHealthCheckInterval=3e4,this._captureInterval=T,this._captureIntervalMinimum=250,this._lastWorkerHealthCheckTime=0,this._lastWorkerMessageLength=0,this._isFrameNeededCounter=0,this._isFrameNeededCounterMaxValue=33,this._isVideoResolutionSmallerCounter=0,this._isVideoResolutionSmallerMaxValue=99,this._processTimes=[],this._scaledWidth=0,this._scaledHeight=0,this._oldScale=T,this._performanceManager=T,this.onPerformanceMonitorAlert=function(){},this.isFrameNeeded=function(e){},this._visibleRect=T,this._masks=T}e.prototype=Object.create(u.Base.Observable.prototype),(u.Providers.ContentSharing.ScreenCapturer=e).prototype.start=function(t,e,i){var a=S.Deferred();return this._manuallyStopped=!1,this._config=e,this._captureInterval=this._config.captureInterval,this._delayInterval=T,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._startPerformanceManager(),this._worker=new Worker(this._config.contentSharingWorkerPath),this._worker.postMessage({type:u.Providers.ContentSharing.ScreenCapturerWorkerEvents.INITIALIZE,browser:i,config:e}),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),this._worker.onerror=function(e){t.getVideoTracks()[0].stop(),a.reject(e)},this._worker.onmessage=function(e){this._handleWorkerMessage(e,a,t)}.bind(this),a.promise()},e.prototype._handleWorkerMessage=function(e,t,i){switch(e.data.type){case u.Providers.ContentSharing.ScreenCapturerWorkerEvents.CHANGED_BLOCKS:this._handleChangedBlocksMessage(e.data);break;case u.Providers.ContentSharing.ScreenCapturerWorkerEvents.WORKER_STARTED:this._handleWorkerStartedMessage(e.data,t,i);break;default:u.Base.Logger.warn(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Unknown message data type received: {0}",e.data.type)}},e.prototype._calculateScale=function(e,t,i,a){var r=1,s=1;return i<e&&(r=i/e),a<t&&(s=a/t),Math.min(r,s)},e.prototype._handleChangedBlocksMessage=function(e){this._changedBlocksMessageReceived=!0,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._lastWorkerMessageLength=e.data.length,0<e.data.length&&(this._processTimes.unshift(e.meta.processingTime),this._registerFrametime(e.meta.processingTime),this.trigger(u.Providers.ContentSharing.ScreenCapturerEvents.BLOCKS_CHANGED,[e.data,e.meta.keyFrame,this._getAverageProcessingTime()])),this._capturingTimeout=setTimeout(function(){this._capture()}.bind(this),this._config.captureInterval)},e.prototype._handleWorkerStartedMessage=function(e,t,i){this._workerStartedMessageReceived=!0,this._videoTrack=i.getVideoTracks()[0];var a=this._videoTrack.getSettings();u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"displaySurface: "+a.displaySurface),this._videoTrack.onended=function(){this._manuallyStopped?u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was ended successfully"):(u.Base.Logger.info(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.trigger(u.Providers.ContentSharing.ScreenCapturerEvents.WINDOW_CLOSED,[]))}.bind(this),this._video=window.document.createElement("video"),this._video.setAttribute("hidden","true"),this._video.srcObject=i,this._video.play().then(function(){u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was successfully executed")}).catch(function(){u.Base.Logger.info(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was interrupted before completion")}),this._capture(),t.resolve()},e.prototype._getAverageProcessingTime=function(){return 100<this._processTimes.length&&this._processTimes.slice(this._processTimes.length-100),this._processTimes.reduce(function(e,t){return e+t/this._processTimes.length}.bind(this),0)},e.prototype.stop=function(){var e=S.Deferred();return this._removeListeners(),this._videoTrack&&(this._manuallyStopped=!0,this._videoTrack.stop(),this._videoTrack=T),this._video&&(this._video.srcObject=null,this._video=T),this._processTimes=[],this._worker&&this._worker.terminate(),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._delayInterval=T,this._stopPerformanceManager(),e.resolve(),e.promise()},e.prototype.pause=function(){var e=S.Deferred(),t=!0;return this._video&&!this._video.paused&&(t=!1,this._video.pause()),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._delayInterval=T,e.resolve(t),e.promise()},e.prototype.getWidth=function(){return this._scaledWidth},e.prototype.getHeight=function(){return this._scaledHeight},e.prototype.setScreenSharingVisibleRect=function(e){this._visibleRect=e},e.prototype.getScreenSharingVisibleRect=function(){return this._visibleRect},e.prototype.setScreenSharingMasks=function(e){this._masks=e},e.prototype.getScreenSharingMasks=function(){return this._masks},e.prototype.resume=function(){var e=S.Deferred(),t=!1;return this._video&&this._video.paused&&(t=!0,this._video.play(),this._capture(!0)),e.resolve(t),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),e.promise()},e.prototype._capture=function(e){var t=this._getAverageProcessingTime();this._captureInterval=this._captureInterval-t>this._captureIntervalMinimum?this._captureInterval-t:t>this._captureIntervalMinimum?t:this._captureIntervalMinimum;if(this._videoTrack&&"ended"!==this._videoTrack.readyState&&!this._video.paused)if(this.isFrameNeeded(this._getAverageProcessingTime()))if(8<=this._video.videoWidth&&8<=this._video.videoHeight){var i=window.document.createElement("canvas"),a=0,r=0,s=this._video.videoWidth,n=this._video.videoHeight,t=this._visibleRect;t instanceof u.Base.Rect&&(a=t.getX(),r=t.getY(),s=Math.min(t.getWidth(),s-a),n=Math.min(t.getHeight(),n-r));t=this._calculateScale(n,s,this._config.maxHeight,this._config.maxWidth);this._scaledWidth=+(t*s).toFixed(0),this._scaledHeight=+(t*n).toFixed(0),i.width=this._scaledWidth,i.height=this._scaledHeight;var o=i.getContext("2d");1!==t&&(o.scale(t,t),t!==this._oldScale&&(this._oldScale=t,u.Base.Logger.info(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Resolution of shared content is too high. Scaling down from  "+s+"x"+n+" to "+this._scaledWidth+"x"+this._scaledHeight))),o.drawImage(this._video,-a,-r);var c=this._masks;if(c instanceof Array)for(var l=0;l<c.length;++l){var d,C=c[l];C instanceof u.Base.Mask&&((d=C.getRect())instanceof u.Base.Rect&&(o.fillStyle=C.getColor(),o.fillRect(d.getX()-a,d.getY()-r,d.getWidth(),d.getHeight())))}n=o.getImageData(0,0,this._scaledWidth,this._scaledHeight).data;this._worker.postMessage({type:u.Providers.ContentSharing.ScreenCapturerWorkerEvents.SEND_IMAGE_DATA,imgData:n,config:this._config,width:this._scaledWidth,height:this._scaledHeight,forceKeyFrame:e},[n.buffer]),this._lastCapturedImageTime=(new Date).getTime()}else this._isVideoResolutionSmallerCounter++,this._isVideoResolutionSmallerCounter===this._isVideoResolutionSmallerMaxValue&&(u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Capture skipped due to low video resolution: "+{width:this._video.videoWidth,height:this._video.videoHeight}),this._isVideoResolutionSmallerCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=T,this._capture(!0)}.bind(this),this._captureInterval);else this._isFrameNeededCounter++,this._isFrameNeededCounter===this._isFrameNeededCounterMaxValue&&(u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"isFrameNeeded delaying the _capture method"),this._isFrameNeededCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=T,this._capture()}.bind(this),this._captureInterval);else{n=this._videoTrack?{enabled:this._videoTrack.enabled,kind:this._videoTrack.kind,muted:this._videoTrack.muted,readyState:this._videoTrack.readyState}:T;u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"videoTrack: "+JSON.stringify(n))}},e.prototype._registerFrametime=function(e){u.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.registerMeasure(e)},e.prototype._stopPerformanceManager=function(){u.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.stop()},e.prototype.setServerCapabilities=function(e){this._config=S.extend({},this._config,e)},e.prototype.setPerformanceManagerProfile=function(e){this._performanceManagerProfile=e},e.prototype._startPerformanceManager=function(){"Disabled"!==this._performanceManagerProfile&&(this._performanceManager=new u.Providers.ContentSharing.PerformanceManager(this._performanceManagerProfile),this._performanceManager.onPerformanceMonitorAlert=function(e,t){this.onPerformanceMonitorAlert(e,t)}.bind(this),this._performanceManager.start())},e.prototype._checkWorkerHealth=function(){var e=(new Date).getTime();e-this._lastWorkerHealthCheckTime>this._workerHealthCheckInterval&&u.Base.Logger.debug(u.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Worker not generating new blocks, block message length: "+this._lastWorkerMessageLength+", worker message received: "+this._workerStartedMessageReceived+", changed blocks message received: "+this._changedBlocksMessageReceived+", scaled width: "+this._scaledWidth+", scaled height: "+this._scaledHeight+", last captured time: "+(e-this._lastCapturedImageTime)+"ms ago, last changed block time: "+(e-this._lastWorkerHealthCheckTime)+"ms ago.")}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerConfig=function(){this.captureInterval=333,this.losslessColorLimit=32,this.blockSize=64,this.framesPerKeyFrame=75,this.maxBytesPerSecond=37500,this.maxWidth=1920,this.maxHeight=1080}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerEvents={BLOCKS_CHANGED:"blocks_changed",KEY_FRAME:"key_frame",WINDOW_CLOSED:"window_changed"}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerWorkerEvents={INITIALIZE:"initialize",CHANGED_BLOCKS:"changedBlocksMessage",SEND_IMAGE_DATA:"wholeImgData",WORKER_STARTED:"workerStarted"}}(),function(C){"use strict";C.Providers.ContentSharing.ScreenScraper=function(){this._previousBlocks=[],this._blockWidth=64,this._blockHeight=64,this._previousBase64=T,this._captureKeyFrame=!1},C.Providers.ContentSharing.ScreenScraper.prototype={getChangedBlocks:function(e,t,i){if(!e.videoWidth)return[];this._blockWidth=t,this._blockHeight=t;t=window.document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t=t.getContext("2d");t.drawImage(e,0,0);t=this._determineChangedBlocks(e,t);return 0<t.length&&(t=this._mergeBlocks(t),t=this._determineTypes(t,i)),t},_determineTypes:function(e,i){return e.forEach(function(e){var t=this._getColorsCount(e._imgData);e._type=i<t?C.Providers.WCS.ScreenSharingImageTypes.JPEG:C.Providers.WCS.ScreenSharingImageTypes.PNG}.bind(this)),e},_mergeBlocks:function(e){return e=this._sortByColumn(e),e=this._mergeByColumn(e),e=this._sortByRow(e),(e=this._mergeByRow(e)).map(this._createMergedBlock)},_createMergedBlock:function(t){var e=document.createElement("canvas");e.width=t._width,e.height=t._height;var i=e.getContext("2d");t._blocks.forEach(function(e){i.putImageData(e._imgData,e._x-t._x,e._y-t._y)});e=i.getImageData(0,0,t._width,t._height);return new C.Providers.ContentSharing.ScreenBlock(t._x,t._y,t._row,t._column,t._width,t._height,e)},_determineChangedBlocks:function(e,t){var i=[],a=[],r=Math.ceil(e.videoHeight/this._blockHeight);if(!this._imageChanged(e,t))return i;for(var s=0;s<e.videoWidth;s+=this._blockWidth)for(var n=s/this._blockWidth,o=s+this._blockWidth>e.videoWidth?e.videoWidth-s:this._blockWidth,c=0;c<e.videoHeight;c+=this._blockHeight){var l=c+this._blockHeight>e.videoHeight?e.videoHeight-c:this._blockHeight,d=t.getImageData(s,c,o,l),l=new C.Providers.ContentSharing.ScreenBlock(s,c,c/this._blockHeight,n,o,l,d);l._previousBase64=this._getBase64Image(l._imgData),0<this._previousBlocks.length&&!this._captureKeyFrame?(d=l._column*r+l._row,(d=this._previousBlocks[d])&&d._previousBase64===l._previousBase64||(d._previousBase64=T,a.push(l))):a.push(l),i.push(l)}return this._captureKeyFrame&&(this._captureKeyFrame=!1),this._previousBlocks=i,a},_imageChanged:function(e,t){var i=!0,e=t.getImageData(0,0,e.videoWidth,e.videoHeight),e=this._getBase64Image(e);return e!==this._previousBase64||this._captureKeyFrame?this._previousBase64=e:i=!1,i},_getColorsCount:function(e){for(var t={},i=new Uint32Array(e.data.buffer),a=0,r=i.length,s=0;s<r;s++){var n=""+(16777215&i[s]);t[n]||(t[n]=0,a++),t[n]++}return a},_getBase64Image:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")},_mergeByColumn:function(e){return this._merge(e,this._compareBlocksByColumn,function(e,t){e._height+=t._height})},_mergeByRow:function(e){return this._merge(e,this._compareBlocksByRow,function(e,t){e._width+=t._width})},_merge:function(e,t,i){for(var a=[],r=this._copyBlock(e[0]),s=1;s<e.length;s++)t(r,e[s])?(0<e[s]._blocks.length?this._copyBlocks(e,s,r):r._blocks.push(e[s]),i(r,e[s])):(a.push(r),r=this._copyBlock(e[s]));return a.push(r),a},_copyBlocks:function(e,t,i){e[t]._blocks.forEach(function(e){i._blocks.push(e)})},_copyBlock:function(e){var t;return 0===e._blocks.length?(t=new C.Providers.ContentSharing.ScreenBlock(e._x,e._y,e._row,e._column,e._width,e._height))._blocks.push(e):t=e,t},_sortByColumn:function(e){return e.sort(function(e,t){return e._column===t._column?e._row-t._row:e._column-t._column})},_sortByRow:function(e){return e.sort(function(e,t){return e._row===t._row?e._column-t._column:e._row-t._row})},_compareBlocksByColumn:function(e,t){return e._x===t._x&&e._width===t._width&&(e._y+e._height===t._y||t._y+t._height===e._y)},_compareBlocksByRow:function(e,t){return e._y===t._y&&e._height===t._height&&(e._x+e._width===t._x||t._x+t._width===e._x)}}}(AvayaClientServices),function(a){"use strict";function e(e,t){this._collaborationProvider=e,this._extensionNetworkProvider=new a.Providers.ContentSharing.ExtensionNetworkProvider(new a.Providers.ContentSharing.ExtensionRequestBuilder);var i=new a.Providers.ContentSharing.ScreenScraper;this._screenCapturer=new a.Providers.ContentSharing.ScreenCapturer(i),this._extensionRequestBuilder=new a.Providers.ContentSharing.ExtensionRequestBuilder,this._contentSharingTagBuilder=new a.Providers.ContentSharing.ContentSharingTagBuilder;e=new a.Providers.ContentSharing.ServerManager(e.sendBlocks.bind(e),e.getBufferedAmount.bind(e));this._bandwidthManager=new a.Providers.ContentSharing.BandwidthManager(e),this._screenSharingTagEncoder=new a.Providers.WCS.ScreenSharingTagEncoder,t.registerServer(e),t.registerScreenCapturer(this._screenCapturer)}e.prototype={getScreenSharingProvider:function(e){var t=a.Base.Utils.getBrowserType();return t===a.Base.BrowserType.CHROME?new a.Providers.ContentSharing.ChromeScreenSharingProvider(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,e,this._extensionNetworkProvider,this._extensionRequestBuilder):new(t===a.Base.BrowserType.FIREFOX?a.Providers.ContentSharing.FirefoxScreenSharingProvider:t===a.Base.BrowserType.EDGE?a.Providers.ContentSharing.EdgeScreenSharingProvider:a.Providers.ContentSharing.AbstractScreenSharingProvider)(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,e)}},a.Providers.ContentSharing.ScreenSharingProviderFactory=e}(AvayaClientServices),function(n){"use strict";function e(e,t){this._sentData=0,this._isFrameNeeded=!0,this._videoResolutionChangeThreshold=9,this._outstandingDataSize=0,this._videoStepDownBandwidthThreshold=.75,this._videoStepUpBandwidthThreshold=.95,this._idlePackageSizeThreshold=2e3,this._videoResolutionChangeMonitoringInterval=1e4,this._dataEntryMonitoringInterval=1e3,this._observationStartedTime=0,this._sentDataSum=0,this._cumulativeDataTransferred=0,this._lastCumulativeDataTransferred=0,this._isAcksActivated=!0,this._maxBytesPerSecond=5e4,this._sendingFunction=e,this._blocksSentHistory=[],this._dataEntryForVideoResolutionChange=[],this._monitoringFunction=t,this._checkBandwidthforVideoResolutionDelay=5e3,this.onPerformanceMonitorAlert=function(){},this._history=[{buffered:0,bufferedSum:0,sent:0,sentSum:0}],this._actualBandwidth=this._maxBytesPerSecond,this._observationInterval=5,this._onStop=function(){},this._onStart=function(){}}e.prototype={start:function(e){this._onStart(),this._blocksSentHistory.length=0,this.resetOutstandingDataSize(),this._maxBytesPerSecond=e.maxBytesPerSecond,this._observationStartedTime=(new Date).getTime();var n={};this._interval=setInterval(function(){var t,i,a,r,s,e=this._history[this._history.length-1],e={buffered:this._monitoringFunction()-e.bufferedSum,bufferedSum:this._monitoringFunction(),sent:this._sentDataSum-e.sentSum,sentSum:this._sentDataSum};this._history.push(e),0!==this._blocksSentHistory.length&&(a=!(i=e=t=0),s=r=0,this._blocksSentHistory.forEach(function(e){t+=e.size,n[e.started]=n[e.started]||{},n[e.started].remainingDataSize=e.remainingDataSize,n[e.started].finished=e.finished}.bind(this)),this._blocksSentHistory.length=0,Object.keys(n).forEach(function(e){var t=parseInt(e)>this._observationStartedTime?parseInt(e):this._observationStartedTime;!0===a?(r=t,s=n[e].finished,a=!1):(s<t&&(i+=s-t),s=n[e].finished),0===n[e].remainingDataSize&&delete n[e]}.bind(this)),e=s-r+i,0!==t&&(this._actualBandwidth=1e3*t/e)),this._observationStartedTime=(new Date).getTime()}.bind(this),1e3*this._observationInterval),this.checkBandwidthForVideoResolution()},getHistory:function(){return this._history},stop:function(){this._onStop(),this.resetOutstandingDataSize(),this._blocksSentHistory.length=0,this._dataEntryForVideoResolutionChange.length=0,clearInterval(this._interval),clearInterval(this._dataEntryInterval),clearInterval(this._videoResolutionChangeInterval)},send:function(e){this._sentDataSum+=e.getByteLength(),this._sentData+=e.getByteLength();var i,a,t=e.getByteLength()/this._maxBytesPerSecond*1e3;this._isAcksActivated?(i=e.getByteLength(),this._outstandingDataSize+=e.getByteLength(),a=(new Date).getTime(),e.getBlocks().forEach(function(t){var e=new n.Providers.WCS.ByteArray(t).readInt();this._sendingFunction(t,e).always(function(){this._cumulativeDataTransferred+=t.byteLength;var e={};e.started=a,e.finished=(new Date).getTime(),i-=t.byteLength,e.size=t.byteLength,e.remainingDataSize=i,this._blocksSentHistory.push(e),this._outstandingDataSize-=t.byteLength}.bind(this))}.bind(this))):e.getBlocks().forEach(function(e){this._sendingFunction(e)}.bind(this));var r=this._monitoringFunction();n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Sent frame WebSocket bufferedAmount: "+r);var s=function(){var e=this._monitoringFunction();e<this._maxBytesPerSecond?(n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Outgoing queue cleared, reporting bandwidth available.  WebSocket bufferedAmount: "+e),this.onBandwidthAvailable()):setTimeout(s,500)}.bind(this);setTimeout(function(){this._sentData-=e.getByteLength(),s()}.bind(this),t)},canSend:function(e){return 0===this._sentData||e+this._sentData<=this._maxBytesPerSecond},measureDataSentPerSecond:function(){if(0===this._lastCumulativeDataTransferred)return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,this._lastCumulativeDataTransferred;var e=this._cumulativeDataTransferred-this._lastCumulativeDataTransferred;return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,e},checkBandwidthForVideoResolution:function(){setTimeout(function(){this._isAcksActivated&&(this._dataEntryInterval=setInterval(this.addDataEntryEverySecond.bind(this),this._dataEntryMonitoringInterval),this._videoResolutionChangeInterval=setInterval(this.monitorBandwidthForVideoResolutionChange.bind(this),this._videoResolutionChangeMonitoringInterval))}.bind(this),this._checkBandwidthforVideoResolutionDelay)},addDataEntryEverySecond:function(){this._dataEntryForVideoResolutionChange.push({data:this.measureDataSentPerSecond(),bandwidth:this.getActualBandwidth(),isNeeded:this._isFrameNeeded})},monitorBandwidthForVideoResolutionChange:function(){var e,t=0,i=0;this._dataEntryForVideoResolutionChange.forEach(function(e){this._videoStepUpBandwidthThreshold*this._maxBytesPerSecond>=e.bandwidth&&(0===e.data&&!1===e.isNeeded||e.data>this._idlePackageSizeThreshold)&&(this._videoStepDownBandwidthThreshold*this._maxBytesPerSecond>=e.bandwidth?i++:t++)}.bind(this)),i>=this._videoResolutionChangeThreshold&&(e="Send screen sharing bandwidth is limited to "+(8*this.getActualBandwidth()/1e3).toFixed(2)+"kbps",this.onPerformanceMonitorAlert(n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD,e)),t>=this._videoResolutionChangeThreshold&&(e="Send screen sharing bandwidth is limited to "+(8*this.getActualBandwidth()/1e3).toFixed(2)+"kbps",this.onPerformanceMonitorAlert(n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING,e)),this._dataEntryForVideoResolutionChange.length=0},getOutstandingDataSize:function(){return this._outstandingDataSize<0&&this.resetOutstandingDataSize(),this._outstandingDataSize},getActualBandwidth:function(){return(!isFinite(this._actualBandwidth)||this._actualBandwidth<0)&&(this._actualBandwidth=this._maxBytesPerSecond),this._actualBandwidth},resetOutstandingDataSize:function(){this._outstandingDataSize=0},onBandwidthAvailable:function(){},setIsFrameNeeded:function(e){this._isFrameNeeded=e},setAcksActivated:function(e){this._isAcksActivated=e}},n.Providers.ContentSharing.ServerManager=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Base.Observable.call(this),this._networkProvider=e}(e.prototype=Object.create(t.Base.Observable.prototype)).init=function(e){this._networkProvider.init(e)},e.prototype.login=function(e){return this._networkProvider.send({loginId:e.username,password:e.password},{sendType:"GET"}).then(function(e){return this.trigger("focus.login.success",[e]),e}.bind(this),function(e){this.trigger("focus.login.error",[e])}.bind(this))},t.Providers.Focus.FocusProvider=e}(AvayaClientServices),function(e){"use strict";function t(){e.Base.Observable.call(this)}(t.prototype=Object.create(e.Base.Observable.prototype)).start=function(){},t.prototype.stop=function(){},e.Providers.Interfaces.AbstractProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.AbstractStream=function(e,t,i){this.type=e,this.id=t,this.enabled=!0,this.direction=i,this.logicalDirection=T}}(),function(i){"use strict";function e(e,t){this.serverNoiseReduction=T,i.Providers.Interfaces.AbstractStream.call(this,"audio",e,t)}e.prototype=Object.create(i.Providers.Interfaces.AbstractStream.prototype),i.Providers.Interfaces.AudioStream=e}(AvayaClientServices),function(e){"use strict";function t(){this.callId=T}t.prototype={},e.Providers.Interfaces.Call=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).accept=function(e,t,i,a){},t.prototype.setVideoMode=function(e,t,i){},t.prototype.ignore=function(){},t.prototype.deny=function(){},t.prototype.hold=function(e){},t.prototype.unhold=function(e){},t.prototype.sendDigits=function(){},t.prototype.getRemoteAddress=function(){},t.prototype.getAccessCode=function(){},t.prototype.getSessionDetails=function(){},t.prototype.isConference=function(){},t.prototype.isIncoming=function(){},t.prototype.canAutoAnswer=function(){},t.prototype.isRemote=function(){},t.prototype.isServiceAvailable=function(){},t.prototype.isCallerIdentityPrivate=function(){},t.prototype.getAlertType=function(){},t.prototype.getSubject=function(){},t.prototype.getState=function(){},t.prototype.join=function(){},t.prototype.addCall=function(e){},t.prototype.addParticipant=function(e){},t.prototype.muteAudio=function(e){},t.prototype.unmuteAudio=function(e){},t.prototype.muteVideo=function(e){},t.prototype.unmuteVideo=function(e){},t.prototype.muteSpeaker=function(e){},t.prototype.unmuteSpeaker=function(e){},t.prototype.updateDevices=function(e,t,i){},t.prototype.startContentVideoSharing=function(e,t){},t.prototype.stopContentVideoSharing=function(e){},t.prototype.setPreferredResolution=function(e,t,i){},t.prototype.setPreferredReceiveResolution=function(e,t,i){},t.prototype.setBackgroundBlur=function(e,t){},t.prototype.setBackgroundImage=function(e,t){},e.Providers.Interfaces.CallProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallProviderCallbackIds={ALLOWED_NAILEDUP_VIDEO_MODES:"allowedNailedUpVideoModes",ANSWER_CALL_REQUESTED:"answerCallRequested",AUDIO_STREAM_UPDATED:"audioStreamUpdated",CALL_STARTED:"callStarted",CALL_RINGING:"callRinging",CALL_ESTABLISHED:"callEstablished",CALL_ESTABLISHING:"callEstablishing",CALL_ENDED:"callEnded",CALL_FAILURE:"callFailure",CALL_SERVICE_AVAILABLE:"callServiceAvailable",CALL_SERVICE_ACTIVATED:"callServiceActivated",CALL_SERVICE_DEACTIVATED:"callServiceDeactivated",CALL_SERVICE_UNAVAILABLE:"callServiceUnavailable",CALL_SERVICE_UNSUPPORTED:"callServiceUnsupported",CALL_MEDIA_FAILED:"callMediaFailed",CONFERENCE_ESCALATION:"conferenceEscalation",ICE_CONNECTION_UPDATE:"iceConnectionUpdate",INCOMING_CALL:"incomingCall",INCOMING_ADD_VIDEO_REQUEST:"incomingAddVideoRequest",INCOMING_ADD_VIDEO_ACCEPTED:"incomingAddVideoAccepted",INCOMING_ADD_VIDEO_DENIED:"incomingAddVideoDenied",INCOMING_ADD_VIDEO_TIMEDOUT:"incomingAddVideoTimedout",INCOMING_HOLD:"incomingHold",INCOMING_UNHOLD:"incomingUnhold",INITIATING_MEDIA_RECOVERY:"initiatingMediaRecovery",MAKE_CALL_REQUESTED:"makeCallRequested",MAX_NETWORK_RECOVERY_ATTEMPTED:"maxNetworkRecoveryAttempted",MEDIA_CHANNEL_GUIDELINES_AVAILABLE:"mediaChannelGuidelinesAvailable",MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE:"mediaChannelGuidelinesUnavailable",REMOTE_ADDRESS_CHANGED:"remoteAddressChanged",REMOTE_CALL_CREATED:"remoteCallCreated",TERMINATE_CALL_REQUESTED:"terminateCallRequested",UPDATE_CALL_REQUESTED:"updateCallRequested",UPLOAD_LOGS_UPDATE:"uploadLogUpdate",VIDEO_CHANNEL_UPDATE:"videoChannelUpdate",VIDEO_ESCALATION_REJECTED:"videoEscalationRejected",VIDEO_LICENSE_UPDATED:"VIDEO_LICENSE_UPDATED",RINGBACK_TONE_URLS_CHANGED:"RINGBACK_TONE_URLS_CHANGED",PERFORMANCE_MANAGER_PROFILE_CHANGED:"PERFORMANCE_MANAGER_PROFILE_CHANGED",PERFORMANCE_MONITOR_ALERT:"PERFORMANCE_MONITOR_ALERT"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallServiceCallbackIds={INCOMING_CALL:"incomingCall",MAKE_CALL_REQUESTED:"makeCallRequested",PERFORMANCE_MANAGER_PROFILE_CHANGED:"performanceManagerProfileChanged",PERFORMANCE_MONITOR_ALERT:"performanceMonitorAlert",PERFORMANCE_MONITOR_START:"performanceMonitorStart",CAMERA_DEALLOCATED:"CameraDeallocated"}}(),function(s){"use strict";function e(e,t,i,a,r){s.Providers.Interfaces.AbstractStream.call(this,"video",e,t),this.maxHeight=i,this.maxWidth=a,this.maxFrames=r}e.prototype=Object.create(s.Providers.Interfaces.AbstractStream.prototype),s.Providers.Interfaces.VideoStream=e}(AvayaClientServices),function(e){"use strict";function t(){e.Base.Observable.call(this)}(t.prototype=Object.create(e.Base.Observable.prototype)).start=function(){},t.prototype.stop=function(){},t.prototype.startWhiteboard=function(e){},t.prototype.endWhiteboard=function(e){},t.prototype.addWhiteboardSurface=function(){},t.prototype.removeWhiteboardSurface=function(e){},t.prototype.observeCollaboration=function(){},t.prototype.addCircle=function(){},t.prototype.addShape=function(){},t.prototype.startDrawShape=function(){},t.prototype.discoverResources=function(e){},t.prototype.liveDrawShape=function(){},t.prototype.endDrawShape=function(){},t.prototype.addText=function(){},t.prototype.getReceivingBitrate=function(){},t.prototype.startScreenSharing=function(){},t.prototype.stopScreenSharing=function(){},t.prototype.pauseScreenSharing=function(){},t.prototype.sendBlocks=function(e){},t.prototype.sendLiveEvent=function(e){},t.prototype.removeShape=function(e,t){},t.prototype.clearContent=function(e){},t.prototype.getParticipants=function(){},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.isOpened=function(){},t.prototype.isFeatureAvailable=function(e){},t.prototype.getServerCapabilities=function(){},t.prototype.getAcksActivated=function(){},e.Providers.Interfaces.CollaborationProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CollaborationProviderCallbackIds={SERVER_CAPABILITIES:"server_capabilities"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.ConferenceCallbackIds={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).sendHandshake=function(e){},t.prototype.subscribeMeetingInfo=function(e){},t.prototype.subscribeRoster=function(e){},t.prototype.subscribeActiveTalker=function(e){},t.prototype.subscribePermissions=function(e){},t.prototype.subscribeSlider=function(e){},t.prototype.subscribeMeetingNote=function(e){},t.prototype.subscribeWebCollab=function(e){},t.prototype.subscribeAvailableLayouts=function(e){},t.prototype.getCurrentVideoLayout=function(e){},t.prototype.setAsLecturer=function(e,t){},t.prototype.disconnectParticipant=function(e,t){},t.prototype.terminateConference=function(e){},t.prototype.requestToBecomeModerator=function(e,t){},t.prototype.signIn=function(e,t){},t.prototype.videoPin=function(e,t,i,a,r,s){},t.prototype.extendMeeting=function(e,t){},t.prototype.addParticipant=function(e,t){},t.prototype.cancelDialoutParticipant=function(e,t){},t.prototype.unsetAsLecturer=function(e){},t.prototype.controlRemoteCamera=function(e,t,i){},t.prototype.muteUnmute=function(e,t,i,a){},t.prototype.sendChatMessage=function(e,t,i){},t.prototype.muteUnmuteAll=function(e,t){},t.prototype.raiseLowerHand=function(e,t){},t.prototype.moderatorLowerHand=function(e,t,i){},t.prototype.sendModeratorAdmissionRequest=function(e){},t.prototype.sendAdmissionRequest=function(e,t){},t.prototype.changeParticipantName=function(e,t,i){},e.Providers.Interfaces.ConferenceDataProvider=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.observeConference=function(e){},t.prototype.disconnectParticipant=function(e){},t.prototype.setAsLecturer=function(e){},t.prototype.setLocked=function(e){},t.prototype.setVideoLayoutTextOverlay=function(e){},t.prototype.setVideoLayoutSelfSee=function(e){},t.prototype.setVideoLayout=function(e){},t.prototype.terminateConference=function(){},t.prototype.removeLastParticipant=function(){},t.prototype.requestToBecomeModerator=function(e){},t.prototype.signIn=function(e){},t.prototype.videoPin=function(e,t,i,a,r){},t.prototype.extendMeeting=function(e){},t.prototype.addParticipant=function(e){},t.prototype.addParticipantFromCall=function(e){},t.prototype.cancelDialoutParticipant=function(e){},t.prototype.startRecording=function(e,t,i){},t.prototype.stopRecording=function(e){},t.prototype.pauseRecording=function(e){},t.prototype.resumeRecording=function(e){},t.prototype.unsetAsLecturer=function(){},t.prototype.controlRemoteCamera=function(e,t){},t.prototype.muteUnmute=function(e,t,i){},t.prototype.sendChatMessage=function(e,t){},t.prototype.muteUnmuteAll=function(e){},t.prototype.raiseLowerHand=function(e){},t.prototype.moderatorLowerHand=function(e,t){},t.prototype.getDialInInfo=function(){},t.prototype.changeParticipantName=function(e,t){},e.Providers.Interfaces.ConferenceProvider=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e,t){},t.prototype.stop=function(){},t.prototype.getProviderType=function(){},t.prototype.createContactForAdd=function(){},t.prototype.addContact=function(e){},t.prototype.updateContact=function(e){},t.prototype.deleteContact=function(e){},t.prototype.retrieveAllContacts=function(){},t.prototype.getContactsChanges=function(){},t.prototype.getAddContactCapability=function(){},t.prototype.getUpdateContactCapability=function(){},t.prototype.getDeleteContactCapability=function(){},t.prototype.getExtendedContactDetailsCapability=function(){},e.Providers.Interfaces.ContactsProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.ContactsProviderCallbackIds={CONTACT_ADDED:"contact_added",CONTACT_UPDATED:"contact_updated",CONTACT_DELETED:"contact_deleted",CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.stop=function(){},t.prototype.getProviderType=function(){},t.prototype.startDirectorySearch=function(e){},t.prototype.startResolvingContacts=function(e,t){},t.prototype.stopDirectorySearch=function(e){},t.prototype.getNetworkSearchContactCapability=function(){},t.prototype.getNetworkResolveContactsCapability=function(){},t.prototype.getNetworkSearchTerminalCapability=function(){},t.prototype.getSelfContact=function(){},e.Providers.Interfaces.DirectorySearchProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.DirectorySearchProviderCallbackIds={CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.logout=function(){},t.prototype.getRoutableDomains=function(){},t.prototype.getConversations=function(e){},t.prototype.getConversationIds=function(e){},t.prototype.getConversationsByQuery=function(e){},t.prototype.discoverResources=function(){},t.prototype.getResources=function(){},t.prototype.validateUsers=function(e){},t.prototype.getParticipants=function(e,t){},t.prototype.sendMessage=function(e,t){},t.prototype.sendMessageWithAttachments=function(e,t,i){},t.prototype.leaveConversation=function(e){},t.prototype.markAllAsRead=function(e){},t.prototype.changeSubject=function(e){},t.prototype.markAsReadBatch=function(e){},t.prototype.getMessages=function(e,t,i,a,r){},t.prototype.reportTyping=function(){},t.prototype.observeConversations=function(){},t.prototype.callEscalationEvent=function(e,t){},t.prototype.setLastAccessTime=function(e,t){},t.prototype.addParticipantsToConversation=function(e,t){},t.prototype.close=function(e){},t.prototype.isStarted=function(){},t.prototype.getMaxImageSize=function(){},t.prototype.getMaxVideoSize=function(){},t.prototype.getMaxAudioSize=function(){},t.prototype.getMaxTextLength=function(){},t.prototype.getMaxGenericAttachmentSize=function(){},e.Providers.Interfaces.MessagingProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.MessagingProviderHandlers={CONVERSATIONS_UPDATE:"conversations.update"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.stop=function(){},t.prototype.subscribeForPresence=function(e){},t.prototype.unsubscribeFromPresence=function(e){},t.prototype.unsubscribeFromAllAddressesPresence=function(){},t.prototype.publishManualState=function(e){},t.prototype.publishLocationMode=function(e){},t.prototype.publishNote=function(e){},t.prototype.publishAutomaticPresence=function(e){},e.Providers.Interfaces.PresenceProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.PresenceProviderCallbackIds={PRESENCE_NOTIFICATION:"PRESENCE_NOTIFICATION",PRESENCE_HANDLE_RECEIVED:"PRESENCE_HANDLE_RECEIVED"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).getVoicemailNumber=function(){},t.prototype.getVoicemailMWI=function(){},t.prototype.isServiceAvailable=function(){},e.Providers.Interfaces.VoiceMessagingProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.VoiceMessagingProviderCallbackIds={VOICEMAIL_NUMBER_CHANGED:"VOICEMAIL_NUMBER_CHANGED",MWI_STATUS_CHANGED:"MWI_STATUS_CHANGED"}}(),function(i){"use strict";var t="text/plain",a="POST";function e(e,t,i,a,r){this._href=e,this._bucketName=t,this._sessionId=i,this._clientId=a,this._displayName=r}e.prototype={buildMultipartOptions:function(){var e=i.Base.Utils.parseUrl(this._href),t=e.protocol+"://"+e.host;return{urlSuffix:e.path||"",url:t,contentType:!1,processData:!1,sendType:a,method:a,crossDomain:!0}},buildMultipartData:function(e){var t=new FormData;t.append("metadata",this._buildMetadata());e=this._buildLogfile(e);return t.append("logfile",e,this._logFilename(".log")),t},buildMultipartDataAsZip:function(e){var t=S.Deferred(),i=new FormData;return i.append("metadata",this._buildMetadata()),this._buildLogfileAsZip(e).then(function(e){i.append("logfile",e,this._logFilename(".zip")),t.resolve(i)}.bind(this),function(e){t.reject(e)}),t.promise()},_buildMetadata:function(){var e={bucketName:this._bucketName,contentType:t,sessionID:this._sessionId};return this._displayName&&(e.displayName=this._displayName),this._clientId&&(e.clientID=this._clientId),JSON.stringify(e)},_buildLogfile:function(e){return new Blob([e],{type:"text/plain; charset=UTF-8"})},_buildLogfileAsZip:function(e){var t=S.Deferred(),i=new JSZip;return i.file("jscsdk_upload.log",e),i.generateAsync({type:"blob",compression:"DEFLATE"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},_logFilename:function(e){var t=this._sessionId+"_"+this._clientId;return this._displayName&&(t+="_"+this._trimDisplayName()),t+=e},_trimDisplayName:function(){return this._displayName.replace(/\s/g,"")}},i.Providers.Mpaas.GoogleCloudMessageBuilder=e}(AvayaClientServices),function(o){"use strict";function e(){this.MAX_RETRIES=3,this.RETRY_WAIT_TIME=1e3,this._serverInfo=T,this._href=T,this._messageBuilder=T,this._credentialProvider=T,this._isStarted=!1,this._startPromise=T,this._uploadTimer=T,this._hasPendingUpload=!1,this._restProvider=new o.Base.NetworkProvider(new o.Base.RESTProvider)}(e.prototype={}).start=function(e,t,i,a,r,s){if(this._isStarted){if(this._href===t)return S.Deferred().resolve().promise();var n=S.Deferred();return this._stop().always(function(){this._startProvider().then(function(){n.resolve()},function(e){n.reject(e)})}.bind(this)),n.promise()}return this._serverInfo=e,this._href=t,this._credentialProvider=s,this._messageBuilder=new o.Providers.Mpaas.GoogleCloudMessageBuilder(t,i,a,r),this._startProvider()},e.prototype.stop=function(){return this._stopProvider()},e.prototype._startProvider=function(){return o.Base.Utils.isUndefined(this._serverInfo)?S.Deferred().reject("Uninitialized remote server").promise():(this._isStarted||(this._isStarted=!0,this._startPromise=S.Deferred(),this._restProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._restProvider.onConnectionUnavailable=function(e){o.Base.Logger.error("Error communicating with upload log server:",e),this._stopProvider()}.bind(this),this._restProvider.onOpen=function(){this._startPromise.resolve()}.bind(this),this._restProvider.onError=function(e){o.Base.Logger.error("Error encountered with upload log server:",e),this._stopProvider()}.bind(this),this._restProvider.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(e){o.Base.Logger.error("Unauthorized connection to upload log server:",e),this._stopProvider(),this._startPromise.reject(o.Base.NetworkProviderEvents.UNAUTHORIZED)}.bind(this)),this._restProvider.disableNetworkLogging(),this._restProvider.start(new o.Config.NetworkProviderConfiguration(this._serverInfo),this._credentialProvider)),this._startPromise.promise())},e.prototype._onCredentialsRequired=function(t,e){e&&e!==this._credentialProvider&&o.Base.Utils.deepMerge(this._credentialProvider,e),this._credentialProvider.onAuthenticationChallenge(void 0,function(e){this._onCredentialsRetrieved(e,t)}.bind(this))},e.prototype._onCredentialsRetrieved=function(e,t){o.Base.Utils.isDefined(t.options)&&(t.options.authentication=t.options.authentication||{},e.token?(e.bearer=e.bearer||o.Config.Authentication.TokenType.BEARER,this._credentialProvider.token!==e.token&&(this._credentialProvider.token=e.token),t.options.authentication.type=o.Config.Authentication.Scheme.BEARER,t.options.authentication.token=e.token,t.options.authentication.bearer=e.bearer):(t.options.authentication.type=o.Config.Authentication.Scheme.BASIC,t.options.authentication.username=e.username,t.options.authentication.password=e.password))},e.prototype._stopProvider=function(){return this._uploadTimer&&(clearTimeout(this._uploadTimer),this._uploadTimer=T),this._isStarted?this._restProvider.close().always(function(){this._isStarted=!1}.bind(this)):S.Deferred().reject("LoggerProvider: Provider is not started").promise()},e.prototype.upload=function(e){return this._hasPendingUpload?S.Deferred().reject("There is pending upload").promise():e?this._upload(e,this._sendLogs.bind(this)):S.Deferred().reject("Invalid logs").promise()},e.prototype.uploadZip=function(e){return this._hasPendingUpload?S.Deferred().reject("There is pending upload").promise():e?this._isZipLibraryInstalled()?this._upload(e,this._sendLogsAsZip.bind(this)):(o.Base.Logger.warn("Missing required JSZip library. Will upload as uncompressed file"),this._upload(e,this._sendLogs.bind(this))):S.Deferred().reject("Invalid logs").promise()},e.prototype._isZipLibraryInstalled=function(){return"undefined"!=typeof JSZip},e.prototype._upload=function(e,a){var r=S.Deferred();this._hasPendingUpload=!0;var s=function(t){var i;t++>=this.MAX_RETRIES?(this._hasPendingUpload=!1,r.reject("Max attempts reached")):(i=this.RETRY_WAIT_TIME*Math.pow(2,t),this._isStarted?a(e).then(function(){this._hasPendingUpload=!1,r.resolve()}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this)):this._startProvider().then(function(){a(e).then(function(){this._hasPendingUpload=!1,r.resolve()}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this))}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this)))}.bind(this);return s(0),r.promise()},e.prototype._sendLogs=function(e){var t=this._messageBuilder.buildMultipartOptions(),e=this._messageBuilder.buildMultipartData(e);return this._restProvider.send(e,t)},e.prototype._sendLogsAsZip=function(e){var t=S.Deferred(),i=this._messageBuilder.buildMultipartOptions();return this._messageBuilder.buildMultipartDataAsZip(e).then(function(e){this._restProvider.send(e,i).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this),function(e){t.reject(e)}),t.promise()},o.Providers.Mpaas.LoggerProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.CallbackIds={MAX_SIZE_REACHED:"maxSizeReached"}}(),function(r){"use strict";function e(){r.Base.Observable.call(this),this._output="",this._oldOutput=[],this._outputBytesCount=0,this._loggingLevel=r.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG,this._loggingEnabled=!0,this.MAX_LOG_SIZE=2097152,this.MAX_LOG_COUNT=5,this._maxSizeReachedCount=0}(e.prototype=Object.create(r.Base.Observable.prototype)).log=function(e,t){if(this._loggingEnabled)switch(e){case"debug":this._debug(t);break;case"info":this._info(t);break;case"trace":this._trace(t);break;case"warn":this._warn(t);break;case"error":this._error(t);break;case"fatal":this._fatal(t);break;default:this._info(t)}},e.prototype.getOutput=function(){var e=this._oldOutput.join("");return e+=this._output},e.prototype.clear=function(e){if(e)for(var t=e;0<t;){var i,a=this._oldOutput.shift();a?t-a.length<0?(i=a.substring(t),this._oldOutput.unshift(i),t=0):t-=a.length:(this._output=this._output.substring(t),this._outputBytesCount=r.Base.Utils.getBytesCount(this._output),t=0)}else this._output="",this._oldOutput=[],this._outputBytesCount=0},e.prototype.enableLogging=function(e){this._loggingEnabled=e},e.prototype.setLoggingLevel=function(e){this._loggingLevel=e},e.prototype._info=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.INFO&&this._prettyPrint("[I]",e)},e.prototype._error=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.ERROR&&this._prettyPrint("[E]",e)},e.prototype._fatal=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.FATAL&&this._prettyPrint("[F]",e)},e.prototype._debug=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG&&this._prettyPrint("[D]",e)},e.prototype._trace=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.TRACE&&this._prettyPrint("[T]",e)},e.prototype._warn=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.WARN&&this._prettyPrint("[W]",e)},e.prototype._prettyPrint=function(e,t){e=e+" "+t.shift();0<t.length&&(e+=" "+this._format(t)),e+="\n";t=r.Base.Utils.getBytesCount(e);this._output+=e,this._outputBytesCount+=t,this._outputBytesCount>=this.MAX_LOG_SIZE&&(this._oldOutput.push(this._output),this._oldOutput.length>=this.MAX_LOG_COUNT&&this._oldOutput.shift(),this._output="",this._outputBytesCount=0,this._triggerMaxSizeReached())},e.prototype._format=function(e){var t="",i=0;return e.forEach(function(e){switch(0!==i&&(t+=" "),typeof e){case"boolean":t+=e?"true":"false";break;case"object":t+=JSON.stringify(e);break;default:t+=e}i++}),t},e.prototype._triggerMaxSizeReached=function(){this.trigger(r.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,[])},r.Providers.RemoteLogger.Logger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.LOGGING_LEVELS={DEBUG:0,TRACE:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}(),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.Names={MPAAS:"MPaaS"}}(),function(i){"use strict";function e(){this._logger=new i.Providers.RemoteLogger.Logger,this._uploadProviders={},this._logger.on(i.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,function(){this.uploadLogs()}.bind(this))}(e.prototype={}).getLogger=function(){return this._logger},e.prototype.getProvider=function(e){var t;return this._uploadProviders.hasOwnProperty(e)?t=this._uploadProviders[e]:e===i.Providers.RemoteLogger.Names.MPAAS&&(t=new i.Providers.Mpaas.LoggerProvider,this._uploadProviders[i.Providers.RemoteLogger.Names.MPAAS]=t),t},e.prototype.uploadLogs=function(e){var t=this._logger.getOutput(),i=t.length;if(0===t.length)return S.Deferred().resolve().promise();var a,r,s=S.Deferred(),n=[];return e?this._upload(e,t,n):this._multipleUploads(t,n),0===n.length?s.reject("No upload logger provider found."):(r=a=0,n.forEach(function(e){e.then(function(){++a+r===n.length&&(this._logger.clear(i),s.resolve())}.bind(this),function(e){a+ ++r===n.length&&(0<a?(this._logger.clear(i),s.resolve()):s.reject(e))}.bind(this))}.bind(this))),s.promise()},e.prototype._upload=function(e,t,i){!this._uploadProviders.hasOwnProperty(e)||(e=this._uploadProviders[e])&&i.push(e.uploadZip(t))},e.prototype._multipleUploads=function(e,t){for(var i in this._uploadProviders)!this._uploadProviders.hasOwnProperty(i)||(i=this._uploadProviders[i])&&t.push(i.uploadZip(e))},i.Providers.RemoteLogger.RemoteLoggerProvider=e}(AvayaClientServices),function(s){"use strict";function e(){}e.prototype.updateMeetingInfo=function(t,i){var e,a=0<t._activeParticipants.length;s.Base.Utils.isDefined(i.eventConference)&&t._eventConference!==i.eventConference&&(t._eventConference=i.eventConference,t._onEventConferenceStatusChangedCallbacks.fire(t,t._eventConference)),i.meetingName&&i.meetingName!==t._subject&&(t._subject=i.meetingName,t._onConferenceSubjectChangedCallbacks.fire(t,i.meetingName)),i.lecturerId&&"none"!==i.lecturerId!==t._isLectureModeActive&&(t._isLectureModeActive="none"!==i.lecturerId,t._onConferenceLectureModeStatusChangedCallbacks.fire(t,t._isLectureModeActive)),i.lecturerId&&i.lecturerId!==t._lecturerId&&(a?((e=t._activeParticipants.filter(function(e){return!!e._participantId&&e._participantId===t._lecturerId})[0])&&(e._lecturer=!1,e._onParticipantUnsetAsLecturerCallbacks.fire(e)),t._lecturerId=i.lecturerId,(e=t._activeParticipants.filter(function(e){return e._participantId===t._lecturerId})[0])&&(e._lecturer=!0,e._onParticipantSetAsLecturerCallbacks.fire(e))):t._lecturerId=i.lecturerId),i.virtualRoomOwnerId&&i.virtualRoomOwnerId!==t._conferenceOwnerAddress&&(t._conferenceOwnerAddress=i.virtualRoomOwnerId,t._activeParticipants.forEach(function(e){e._isConferenceOwner=e._userId===i.virtualRoomOwnerId,e._recalculateAllCapabilities()}),t._onConferenceOwnerAddressChangedCallbacks.fire(t,i.virtualRoomOwnerId)),i.recorderAvailable&&i.recorderAvailable!==t._recorderStatus&&(t._recorderStatus=i.recorderAvailable),i.recording&&i.recording!==t._recordingStatus&&(t._recordingStatus=i.recording,t._onConferenceRecordingStatusChangedCallbacks.fire(t,t._recordingStatus)),!i.locked&&!1!==i.locked||i.locked===t._isLocked||(t._isLocked=i.locked,t._admissionPasscodeNeeded=i.locked,t._admissionPermissionNeeded=i.locked,t._onConferenceLockStatusChangedCallbacks.fire(t,t._isLocked,t._admissionPasscodeNeeded,t._admissionPermissionNeeded)),i.media&&"video"===i.media!==t._isVideoAllowed&&(t._isVideoAllowed="video"===i.media,t._onConferenceVideoStatusChangedCallbacks.fire(t,t._isVideoAllowed)),i.presenterId&&"none"!==i.presenterId!==t._isApplicationSharingActive&&(t._isApplicationSharingActive="none"!==i.presenterId,t._onConferencePresentationModeStatusChangedCallbacks.fire(t,t._isApplicationSharingActive)),i.presenterId&&i.presenterId!==t._presenterId&&(a?((a=t._activeParticipants.filter(function(e){return e._participantId===t._presenterId})[0])&&(a._presenter=!1,a._onParticipantUnsetAsPresenterCallbacks.fire(a)),t._presenterId=i.presenterId,(e=t._activeParticipants.filter(function(e){return e._participantId===t._presenterId})[0])&&(e._presenter=!0,e._onParticipantSetAsPresenterCallbacks.fire(e))):t._presenterId=i.presenterId),i.encrypted&&i.encrypted!==t._encryptionStatus&&(t._encryptionStatus=i.encrypted,t._onConferenceEncryptionStatusChangedCallbacks.fire(t,t._encryptionStatus)),i.streaming!==T&&i.streaming!==t._isStreamingActive&&(t._isStreamingActive=i.streaming,t._onConferenceStreamingStatusChangedCallbacks.fire(t,t._isStreamingActive)),i.terminationTime&&i.terminationTime!==t._terminationTime&&(t._terminationTime=i.terminationTime,t._onConferenceMeetingTerminationTimeChangedCallbacks.fire(t,t._terminationTime)),i.moderatorPinNeeded!==T&&i.moderatorPinNeeded!==t._isPasscodeRequiredToBecomeModerator&&(t._isPasscodeRequiredToBecomeModerator=i.moderatorPinNeeded),i.mediaStatus&&i.mediaStatus!==t._mediaStatus&&(t._mediaStatus?i.mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(t._mediaStatus=i.mediaStatus,t._onConferenceAllParticipantsMutedCallbacks.fire(t)):i.mediaStatus===s.Services.Conference.MediaStatus.ACTIVE&&t._mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(t._mediaStatus=i.mediaStatus,t._onConferenceAllParticipantsUnmutedCallbacks.fire(t)):i.mediaStatus===s.Services.Conference.MediaStatus.ACTIVE&&t._mediaStatus===s.Services.Conference.MediaStatus.WAITING_ROOM?(t._mediaStatus=i.mediaStatus,t._onConferenceStartingCallbacks.fire(t,t._mediaStatus)):t._mediaStatus=i.mediaStatus:(t._mediaStatus=i.mediaStatus,t._mediaStatus===s.Services.Conference.MediaStatus.WAITING_ROOM?t._onConferenceWaitingToStartCallbacks.fire(t,t._mediaStatus):t._mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO&&t._onConferenceAllParticipantsMutedCallbacks.fire(t)))},e.prototype.updateRoster=function(i,e){var t=[],a=[],r={};e.participants.forEach(function(e){r=this._buildActiveParticipant(e,i),a.push(r),0<i._activeParticipants.filter(function(e){return e._participantId===r._participantId}).length||(r._participantId===i._selfParticipantId&&(r._localUser=!0,i._selfParticipant=r,i.getInConferenceChat()._setSelfParticipant(r),r._isSelfParticipant=!0),t.push(r),i._activeParticipants.push(r))}.bind(this));e=i.getActiveParticipants().filter(function(t){return 0===a.filter(function(e){return e._participantId===t._participantId}).length});e.concat(i.getPendingParticipants().filter(function(t){return 0===a.filter(function(e){return e._participantId===t._participantId}).length})),e.forEach(function(e){var t=new s.Providers.UCCP.UCCPParticipantLeftEvent(e._participantId);s.Base.Logger.info("Dropping participant that is no longer in roster list: ",e._participantId),this.dropParticipant(i,t)}.bind(this)),i._activeParticipants.forEach(function(e){e._recalculateAllCapabilities()}),i._conferenceService._updateMatchedContactsForConference(i),0<t.length&&i._onConferenceParticipantsAddedCallbacks.fire(i,t),i._isLectureModeActive&&(r=i._activeParticipants.filter(function(e){return e._participantId===i._lecturerId})[0])&&(r._lecturer=!0,r._onParticipantSetAsLecturerCallbacks.fire(r)),i._isApplicationSharingActive&&(r=i._activeParticipants.filter(function(e){return e._participantId===i._presenterId})[0])&&(r._presenter=!0,r._onParticipantSetAsPresenterCallbacks.fire(r))},e.prototype.updateSlider=function(e,t){},e.prototype.addActiveParticipant=function(e,t){var i;0<e._activeParticipants.filter(function(e){return e._participantId===t.participantId}).length?this._buildActiveExistingParticipant(t,e):((i=this._buildActiveParticipant(t,e))._participantId===e._selfParticipantId&&(i._localUser=!0,e._selfParticipant=i,e.getInConferenceChat()._setSelfParticipant(i),i._isSelfParticipant=!0,e._recalculateAllCapabilities()),e._activeParticipants.push(i),e._onConferenceParticipantsAddedCallbacks.fire(e,[i]),e._conferenceService._updateMatchedContactsForParticipant(i),i._recalculateAllCapabilities())},e.prototype.addDialoutParticipant=function(e,t,i){if(0<e._activeParticipants.filter(function(e){return e._participantId===t.participantId}).length)return!1;var a=new s.Services.Conference.ActiveParticipant(e._participantService,e);return a._participantId=t.participantId,a._displayName=i,e._activeParticipants.push(a),a._connectionStatus=s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTING,!0},e.prototype.updateDialoutParticipant=function(e,t,i){t._connectionStatus=s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED,t._onParticipantConnectionStatusChangedCallbacks.fire(t,t._connectionStatus)},e.prototype.removeDialoutParticipant=function(e,t,i){var a=e._activeParticipants.filter(function(e){return e._participantId===t})[0];s.Base.Utils.isDefined(a)&&e._activeParticipants.splice(e._activeParticipants.indexOf(a),1)},e.prototype.addPendingParticipant=function(e,t){var i;0<e._pendingParticipants.filter(function(e){return e._participantId===t.participantId}).length||(i=this._buildPendingParticipant(t,e),e._pendingParticipants.push(i),e._conferenceService._updateMatchedContactsForParticipant(i),e._onConferencePendingParticipantCallbacks.fire(e,i))},e.prototype.removePendingParticipant=function(e,t){var i,a=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId||e._participantId===t._participantId})[0];s.Base.Utils.isDefined(a)&&(i=e._pendingParticipants.indexOf(a),e._pendingParticipants.splice(i,1),e._onConferencePendingParticipantRemovedCallbacks.fire(e,a))},e.prototype.pendingParticipantAccepted=function(e,t){e._onPendingParticipantAcceptedCallbacks.fire(e,t.anotherModerator),this.removePendingParticipant(e._conference,e)},e.prototype.pendingParticipantCancelled=function(e,t){e=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId})[0];s.Base.Utils.isDefined(e)&&(e._onPendingParticipantCancelledCallbacks.fire(e,t.reason,t.anotherModerator),this.removePendingParticipant(e._conference,e))},e.prototype.pendingParticipantDenied=function(e,t){e._onPendingParticipantDeniedCallbacks.fire(e,t.anotherModerator),this.removePendingParticipant(e._conference,e)},e.prototype.dropParticipant=function(e,t){var i,a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0],r=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId})[0];s.Base.Utils.isDefined(a)&&(e._activeParticipants.splice(e._activeParticipants.indexOf(a),1),i=this._buildDroppedParticipant(a,e),e._droppedParticipants.push(i),e._conferenceService._updateMatchedContactsForParticipant(i),e._onConferenceParticipantsRemovedCallbacks.fire(e,[a]),e._onConferenceDroppedParticipantAddedCallbacks.fire(e,i)),s.Base.Utils.isDefined(r)&&(e._pendingParticipants.splice(e._pendingParticipants.indexOf(r),1),e._onConferencePendingParticipantRemovedCallbacks.fire(e,r))},e.prototype.updateMeetingNote=function(e,t){},e.prototype.updateActiveTalker=function(t,i){var e;i.participantId!==t._activeTalkerId&&(e=t._activeParticipants.filter(function(e){return e._participantId===t._activeTalkerId})[0],s.Base.Utils.isDefined(e)&&e._onParticipantActiveTalkerStatusChangedCallbacks.fire(e,!1),e=t._activeParticipants.filter(function(e){return e._participantId===i.participantId})[0],s.Base.Utils.isDefined(e)&&(t._activeTalkerId=i.participantId,t._onConferenceActiveTalkersChangedCallbacks.fire(t,e),e._lastSpokenTime=new Date,e._onParticipantActiveTalkerStatusChangedCallbacks.fire(e,!0))),t._activeTalkerId&&e&&(t._recentTalkersList=t.getRecentTalkers().filter(function(e){return e._participantId!==t._activeTalkerId}),t.getRecentTalkers().push(e),t.getRecentTalkers().length>s.Services.Conference.RecentTalkersConfiguration.SIZE&&(t._recentTalkersList=t.getRecentTalkers().slice(-s.Services.Conference.RecentTalkersConfiguration.SIZE)))},e.prototype.updateWebCollab=function(e,t){s.Base.Utils.isDefined(t)&&s.Base.Utils.isDefined(t.webCollabUrl)&&0<t.webCollabUrl.length?e._collaborationURI=t.webCollabUrl+"/viewer.php?token="+t.token+"&participantId="+t.participantId+"&meeting_id="+t.meeting_id+"&mode="+t.mode+"&login="+t.login:e._collaborationURI="",e._onConferenceCollaborationURIChangedCallbacks.fire(e,e._collaborationURI)},e.prototype.updatePermissions=function(e,t){s.Base.Utils.isDefined(t.dialout)&&t.dialout!==e._dialoutPermissions&&(e._dialoutPermissions=t.dialout),s.Base.Utils.isDefined(t.recording)&&t.recording!==e._recordingPermissions&&(e._recordingPermissions=t.recording),s.Base.Utils.isDefined(t.lock)&&t.lock!==e._lockPermissions&&(e._lockPermissions=t.lock),s.Base.Utils.isDefined(t.unmuteSelf)&&t.unmuteSelf!==e._unmuteSelfPermissions&&(e._unmuteSelfPermissions=t.unmuteSelf),s.Base.Utils.isDefined(t.unmuteAll)&&t.unmuteAll!==e._unmuteAllPermissions&&(e._unmuteAllPermissions=t.unmuteAll),s.Base.Utils.isDefined(t.sendFecc)&&t.sendFecc!==e._sendFeccPermissions&&(e._sendFeccPermissions=t.sendFecc),s.Base.Utils.isDefined(t.allowVideo)&&t.allowVideo!==e._allowVideoDirection&&(e._allowVideoDirection=t.allowVideo,e._isAvailable&&s.Base.Utils.isDefined(e._selfParticipant)&&e._onConferenceAllowVideoDirectionChangedCallbacks.fire(e)),e._recalculateAllCapabilities()},e.prototype.updateAvailableLayouts=function(e,t){if(s.Base.Utils.isDefined(t.textOverlay)&&t.textOverlay!==e._isVideoParticipantNameDisplayChangeAllowed&&(e._isVideoParticipantNameDisplayChangeAllowed=t.textOverlay,e._recalculateAllCapabilities(),e._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.fire(e,e._isVideoParticipantNameDisplayChangeAllowed)),s.Base.Utils.isDefined(t.LPPOn)&&t.LPPOn!==e._isVideoPersonalLayoutActive&&(e._isVideoPersonalLayoutActive=t.LPPOn,e._recalculateAllCapabilities()),s.Base.Utils.isDefined(t.noSelfSee)&&t.noSelfSee!==e._isVideoSelfSeeChangeAllowed&&(e._isVideoSelfSeeChangeAllowed=t.noSelfSee,e._recalculateAllCapabilities(),e._onConferenceVideoSelfSeeAllowedCallbacks.fire(e,e._isVideoSelfSeeChangeAllowed)),s.Base.Utils.isDefined(t.videoPin)&&t.videoPin!==e._isVideoPinAllowed&&(e._isVideoPinAllowed=t.videoPin,e._recalculateAllCapabilities(),e._onConferenceVideoPinAllowedCallbacks.fire(e,e._isVideoPinAllowed)),s.Base.Utils.isDefined(t.geometries)){var i=e._supportedVideoLayouts.slice(0);e._supportedVideoLayouts=t.geometries.slice(0);var a=!1;if(i.length===e._supportedVideoLayouts.length){for(var r=0;r<i.length;r++)if(i[r]!==e._supportedVideoLayouts[r]){a=!0;break}}else a=!0;a&&(e._recalculateAllCapabilities(),e._onConferenceAvailableVideoLayoutsChangedCallbacks.fire(e,e._supportedVideoLayouts))}},e.prototype.updateCurrentLayout=function(e,t){var i;s.Base.Utils.isDefined(t.textOverlay)&&t.textOverlay!==e._isVideoParticipantNameDisplayActive&&(e._isVideoParticipantNameDisplayActive=t.textOverlay,e._onConferenceDisplayVideoParticipantNameChangedCallbacks.fire(e,e._isVideoParticipantNameDisplayActive)),s.Base.Utils.isDefined(t.LPPOn)&&t.LPPOn!==e._isVideoPersonalLayoutActive&&(e._isVideoPersonalLayoutActive=t.LPPOn),s.Base.Utils.isDefined(t.noSelfSee)&&(i=e._isVideoSelfSeeActive,e._isVideoSelfSeeActive=!t.noSelfSee,e._isVideoSelfSeeActive!==i&&e._onConferenceVideoSelfSeeChangedCallbacks.fire(e,e._isVideoSelfSeeActive)),s.Base.Utils.isDefined(t.geometry)&&t.geometry!==e._currentVideoLayout&&(e._currentVideoLayout=t.geometry,e._onConferenceVideoLayoutChangedCallbacks.fire(e,e._currentVideoLayout))},e.prototype.addChatMessage=function(e,t){var i=e.getInConferenceChat(),a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];t.participantId!==e._selfParticipantId&&(a=new s.Services.Conference.ChatMessage(t.text,a,i._selfParticipant,t.type===s.Services.Conference.ChatType.PRIVATE),i._addMessage(a))},e.prototype._buildActiveParticipant=function(e,t){var i=new s.Services.Conference.ActiveParticipant(t._participantService,t);return i._participantId=e.participantId,i._displayName=e.participantName,i._address=e.userId,i._userId=e.userId,i._joinTime=e.joinTime,i._sourceID=e.sourceID,i._status=e.status,i._handRaised=e.handRaised,i._role=e.role,i._feccRecvSupport=e.feccRecvSupport,i._audioFromParticipant=e.audioFromParticipant,i._audioToParticipant=e.audioToParticipant,i._videoFromParticipant=e.videoFromParticipant,i._videoToParticipant=e.videoToParticipant,i._contentFromParticipant=e.contentFromParticipant,i._contentToParticipant=e.contentToParticipant,i._canLecture=e.canLecture,i._wasPreviouslyNotVisibleInParticipantList=e.wasHidden,i._isConferenceOwner=e.userId===t._conferenceOwnerAddress,i},e.prototype._buildDroppedParticipant=function(e,t){t=new s.Services.Conference.DroppedParticipant(t._participantService,t);return t._participantId=e._participantId,t._userId=e._userId,t._displayName=e._displayName,t._address=e._address,t._localUser=!1,t._conference=e._conference,t._recalculateAllCapabilities(),t},e.prototype._buildPendingParticipant=function(e,t){var i=new s.Services.Conference.PendingParticipant(t._participantService,t);return i._participantId=e.participantId,i._userId=e.userId,i._displayName=e.participantName,i._address=e.userId,i._status=e.status,i._localUser=!1,i._conference=t,i._recalculateAllCapabilities(),i},e.prototype._buildActiveExistingParticipant=function(t,e){var i=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];return i._connectionStatus===s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED?(i._displayName=t.participantName,i._userId=t.userId,i._address=t.userId,i._joinTime=t.joinTime,i._sourceID=t.sourceID,i._status=t.status,i._handRaised=t.handRaised,i._role=t.role,i._feccRecvSupport=t.feccRecvSupport,i._audioFromParticipant=t.audioFromParticipant,i._audioToParticipant=t.audioToParticipant,i._videoFromParticipant=t.videoFromParticipant,i._videoToParticipant=t.videoToParticipant,i._contentFromParticipant=t.contentFromParticipant,i._contentToParticipant=t.contentToParticipant,i._canLecture=t.canLecture,i._wasPreviouslyNotVisibleInParticipantList=t.wasHidden,e._onConferenceParticipantsAddedCallbacks.fire(e,[i]),i._recalculateAllCapabilities()):this._updateParticipantsData(e,i,t),i},e.prototype.updateParticipant=function(e,t,i){var a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId});s.Base.Utils.isDefined(a[0])?(this._updateParticipantsData(e,a[0],t),e._conferenceService._updateMatchedContactsForParticipant(a[0])):(i=s.Base.Utils.isDefined(i)?i:0,s.Base.Logger.info(s.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"updateParticipant: Participant is not found."),i<2&&setTimeout(function(){this.updateParticipant(e,t,++i)}.bind(this),500))},e.prototype._updateParticipantsData=function(e,t,i){var a;s.Base.Utils.isDefined(i.audioFromParticipant)&&t._audioFromParticipant!==i.audioFromParticipant&&(t._audioFromParticipant=i.audioFromParticipant,t._isAudioMuted=i.audioFromParticipant!==s.Services.Conference.MediaFromParticipantStatus.ACTIVE,t._onParticipantAudioStatusChangedCallbacks.fire(t,t._audioFromParticipant),t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.videoFromParticipant)&&t._videoFromParticipant!==i.videoFromParticipant&&(t._videoFromParticipant=i.videoFromParticipant,t._isVideoBlocked=i.videoFromParticipant!==s.Services.Conference.MediaFromParticipantStatus.ACTIVE,t._onParticipantVideoStatusChangedCallbacks.fire(t,t._videoFromParticipant),t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.status)&&t._status!==i.status&&(t._status=i.status,t._onParticipantStatusChangedCallbacks.fire(t,t._status)),s.Base.Utils.isDefined(i.handRaised)&&t._handRaised!==i.handRaised&&(t._handRaised=i.handRaised,t.isLocalUser()&&(e._isHandRaised=i.handRaised),(t._handRaised?t._onParticipantHandRaisedCallbacks:t._onParticipantHandLoweredCallbacks).fire(t)),s.Base.Utils.isDefined(i.role)&&t._role!==i.role&&(a=t._role,t._role=i.role,t._role===s.Services.Conference.ParticipantRole.MODERATOR?t._onParticipantSetAsModeratorCallbacks.fire(t):a===s.Services.Conference.ParticipantRole.MODERATOR&&t._role!==s.Services.Conference.ParticipantRole.MODERATOR&&t._onParticipantUnsetAsModeratorCallbacks.fire(t),e._recalculate()),s.Base.Utils.isDefined(i.canLecture)&&t._canLecture!==i.canLecture&&(t._canLecture=i.canLecture,t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.participantName)&&t._displayName!==i.participantName&&(t._displayName=i.participantName,t._onParticipantDisplayNameChangedCallbacks.fire(t),t._onParticipantNameChangedCallbacks.fire(t)),s.Base.Utils.isDefined(i.feccRecvSupport)&&t._feccRecvSupport!==i.feccRecvSupport&&(t._feccRecvSupport=i.feccRecvSupport),s.Base.Utils.isDefined(i.audioToParticipant)&&t._audioToParticipant!==i.audioToParticipant&&(t._audioToParticipant=i.audioToParticipant),s.Base.Utils.isDefined(i.videoToParticipant)&&t._videoToParticipant!==i.videoToParticipant&&(t._videoToParticipant=i.videoToParticipant),s.Base.Utils.isDefined(i.contentFromParticipant)&&t._contentFromParticipant!==i.contentFromParticipant&&(t._contentFromParticipant=i.contentFromParticipant,t._onParticipantCollaborationStatusChangedCallbacks.fire(t)),s.Base.Utils.isDefined(i.contentToParticipant)&&t._contentToParticipant!==i.contentToParticipant&&(t._contentToParticipant=i.contentToParticipant),s.Base.Utils.isDefined(i.userId)&&t._userId!==i.userId&&(t._userId=i.userId)},e.prototype.updateDialInInfo=function(e,t){e._joinMeetingURI=t.webLink,e._streamingURI=t.streamingLink,e._dialInInformation=t.dialInInformation,e._dialInInformationHtml=t.dialInInformationHtml,e._onConferenceStreamingURIUpdatedCallbacks.fire(e),e._onConferenceJoinMeetingURIUpdatedCallbacks.fire(e),e._onConferenceDialInInfoUpdatedCallbacks.fire(e)},e.prototype.recordingFailed=function(e,t){e._onConferenceRecordingFailedCallbacks.fire(e)},e.prototype.meetingTerminationInProgress=function(e,t){e._onConferenceMeetingTerminationInProgressCallbacks.fire(e,t.reason,t.userName)},e.prototype.handleDisconnectEvent=function(e,t){s.Base.Logger.info(s.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference received disconnect event. Reason: "+t.reason),e._conferenceService._isDisconnecting=!0,e._onConferenceConnectionEndedCallbacks.fire(e,t.reason),e.stop()},e.prototype.networkFailureHandler=function(e){e._isAvailable&&(e._isAvailable=!1,e._inConferenceChatCapability.denialReason=s.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED,e._inConferenceChatCapability.isAllowed=!1,e._onConferenceServiceUnavailableCallbacks.fire(e,new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.NETWORK_UNAVAILABLE))),e._recalculate()},e.prototype.networkAvailabilityHandler=function(e){e._isAvailable||(e._isAvailable=!0,e._inConferenceChatCapability.denialReason=s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e._inConferenceChatCapability.isAllowed=!0,e._onConferenceServiceAvailableCallbacks.fire(e)),e._recalculate()},e.prototype.connectionRecoveryFailureHandler=function(e){e._isAvailable&&(e._isAvailable=!1),e._onConferenceServiceUnavailableCallbacks.fire(e,new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CONFERENCE_CONNECTION_FAILED_TO_RECOVER)),e._recalculate()},s.Providers.Scopia.ScopiaConferenceBuilder=e}(AvayaClientServices),function(r){"use strict";function e(e,t){r.Providers.Interfaces.ConferenceProvider.call(this),this._dataProvider=e,this._conferenceBuilder=t,this._transaction={id:1},this._isAvailable=!1,this._networkFailureTimer=T}(e.prototype=Object.create(r.Providers.Interfaces.ConferenceProvider.prototype)).start=function(a,e){if(this._isAvailable)return S.Deferred().resolve();var t=r.Base.Utils.queryJSONObject(e,"networkProviderConfiguration.webSocketConfig");return!1!==e.enabled&&r.Base.Utils.isDefined(t)?(this._startNetworkFailureTimer(a),this._dataProvider.start(e,a).then(function(){return this._dataProvider.sendHandshake(this._transaction.id++)}.bind(this)).then(function(e){var t=S.Deferred();this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._conferenceBuilder.networkAvailabilityHandler(a),a._selfParticipantId=e.participantId,a._admissionPermissionNeeded=e.admissionPermissionNeeded,a._admissionPasscodeNeeded=e.admissionPasscodeNeeded,a._knockDoorTimeout=e.knockDoorTimeout;var i=a._getPreEnteredPasscode();return e.admissionPermissionNeeded?(this._stopNetworkFailureTimer(),e.admissionPasscodeNeeded?t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission is needed"})):e.admissionPasscodeNeeded?(this._stopNetworkFailureTimer(),i?a.sendPasscode(i).then(function(){t.resolve()},function(){t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is needed"})):"fail"===e.responseCode?(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),t.reject({name:r.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),a._isAvailable=!0,a._onConferenceServiceAvailableCallbacks.fire(a),this._startListenersAndSubscribes(a),this._isAvailable=!0,t.resolve()),t.promise()}.bind(this),function(e){(e._data&&(502===e._data._status||403===e._data._status)||e.code&&"fail"===e.code)&&(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))):S.Deferred().reject({name:r.Services.Conference.ConferenceStartStatus.CONFERENCE_CONFIG_NOT_ENABLED,message:"Conference config is not enabled"})},e.prototype._startListenersAndSubscribes=function(e,t){return this.addConferenceEventListeners(e,t),this.observeConference(e),r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference service is started."),e},e.prototype.observeConference=function(t){this._dataProvider.getDialInInfo(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateDialInInfo(t,e),e}.bind(this)),this._dataProvider.subscribeMeetingInfo(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateMeetingInfo(t,e),t._recalculateAllCapabilities(),e}.bind(this)),this._dataProvider.subscribeRoster(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateRoster(t,e),t._recalculateAllCapabilities(),e}.bind(this)),this._dataProvider.subscribeActiveTalker(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateActiveTalker(t,e),e}.bind(this)),this._dataProvider.subscribeMeetingNote(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateMeetingNote(t,e),e}.bind(this)),this._dataProvider.subscribeWebCollab(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateWebCollab(t,e),e}.bind(this)),this._dataProvider.subscribeAvailableLayouts(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateAvailableLayouts(t,e),e}.bind(this)),this._dataProvider.subscribePermissions(this._transaction.id++).then(function(e){return this._conferenceBuilder.updatePermissions(t,e),e}.bind(this)),this._dataProvider.getCurrentVideoLayout(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateCurrentLayout(t,e),t._recalculateAllCapabilities(),e}.bind(this))},e.prototype.sendAdmissionRequest=function(t,e){return this._dataProvider.sendAdmissionRequest(this._transaction.id++,e).then(function(e){if(e.responseCode===r.Services.Conference.AdmissionResponseCode.SUCCESS)return t._isAvailable=!0,t._setConferenceStarted(!0),t._onConferenceServiceAvailableCallbacks.fire(t),t._admissionPasscodeNeeded=!1,this._isAvailable=!0,t.addOnConferenceRecordingStatusChangedCallback(t._conferenceService._recalculateConferenceRecordingStatuses),this._startListenersAndSubscribes(t)}.bind(this))},e.prototype.addConferenceEventListeners=function(t,e){var i;e||((i=this._dataProvider.getSelectedProvider()).on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,function(e){this._conferenceBuilder.addActiveParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,function(e){this._conferenceBuilder.dropParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,function(e){this._conferenceBuilder.updateActiveTalker(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,function(e){this._conferenceBuilder.handleDisconnectEvent(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,function(e){this._conferenceBuilder.updatePermissions(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,function(e){this._conferenceBuilder.updateParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,function(e){this._conferenceBuilder.updateMeetingInfo(t,e),t._recalculateInConferenceChatCapability()}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,function(e){this._conferenceBuilder.updateAvailableLayouts(t,e),e.geometries&&0<e.geometries.length&&i.getCurrentVideoLayout(this._transaction.id++).then(function(e){this._conferenceBuilder.updateCurrentLayout(t,e)}.bind(this),function(e){r.Base.Logger.error(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Failed to retrieve current layout",e)})}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,function(e){this._conferenceBuilder.updateCurrentLayout(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,function(e){this._conferenceBuilder.meetingTerminationInProgress(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,function(e){this._conferenceBuilder.addPendingParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,function(e){this._conferenceBuilder.pendingParticipantCancelled(t,e),this._conferenceBuilder.removePendingParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,function(e){this._conferenceBuilder.recordingFailed(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,function(e){this._conferenceBuilder.updateWebCollab(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,function(e){this._conferenceBuilder.addChatMessage(t,e)}.bind(this)),i.on(r.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._startNetworkFailureTimer(t),this._conferenceBuilder.networkFailureHandler(t)}.bind(this)),i.on(r.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_AVAILABLE,function(){this._resubscribe(t)}.bind(this)))},e.prototype.stop=function(){return this._isAvailable=!1,this._stopNetworkFailureTimer(),this._dataProvider.stop().fail(function(e){r.Base.Logger.error(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"failed to stop data provider: ",e)})},e.prototype._startNetworkFailureTimer=function(e){r.Base.Utils.isUndefined(this._networkFailureTimer)&&(this._networkFailureTimer=setTimeout(function(){this._conferenceBuilder.connectionRecoveryFailureHandler(e)}.bind(this),2e4))},e.prototype._stopNetworkFailureTimer=function(){this._networkFailureTimer&&(clearTimeout(this._networkFailureTimer),this._networkFailureTimer=T)},e.prototype._startLongPollHandshakeResponseTimer=function(){this._stopLongPollHandshakeResponseTimer(),this._longPollHandshakeResponseTimer=setTimeout(function(){this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&(r.Base.Logger.warn("UCCP long polling handshake timeout"),this._abortLongPollProvider(this._dataProvider.getSelectedProvider()),this._longPollHandshakeResponseTimer=T)}.bind(this),2e4)},e.prototype._abortLongPollProvider=function(e){this._isLongPollingUccpProvider(e)&&e._networkProvider._communicationAdapter.abort()},e.prototype._stopLongPollHandshakeResponseTimer=function(){this._longPollHandshakeResponseTimer&&(clearTimeout(this._longPollHandshakeResponseTimer),this._longPollHandshakeResponseTimer=T)},e.prototype._resubscribe=function(a){return this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._startLongPollHandshakeResponseTimer(),this._dataProvider.sendHandshake(this._transaction.id++).then(function(e){var t,i=S.Deferred();return this._stopLongPollHandshakeResponseTimer(),a._selfParticipantId=e.participantId,a._admissionPermissionNeeded=e.admissionPermissionNeeded,a._admissionPasscodeNeeded=e.admissionPasscodeNeeded,a._knockDoorTimeout=e.knockDoorTimeout,e.admissionPermissionNeeded||e.admissionPasscodeNeeded?(t=a._getPreEnteredPasscode(),this._stopNetworkFailureTimer(),e.admissionPermissionNeeded?e.admissionPasscodeNeeded?i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission is needed"}):e.admissionPasscodeNeeded&&(t?a.sendPasscode(t).then(function(){i.resolve()},function(){i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is needed"}))):"fail"===e.responseCode?(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),i.reject({name:r.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),this._conferenceBuilder.networkAvailabilityHandler(a),this._startListenersAndSubscribes(a,!0),i.resolve()),i.promise()}.bind(this),function(e){this._stopLongPollHandshakeResponseTimer(),(e._data&&(502===e._data._status||403===e._data._status)||e.code&&"fail"===e.code)&&(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))},e.prototype.setAsLecturer=function(e){return this._dataProvider.setAsLecturer(this._transaction.id++,e)},e.prototype.setLocked=function(e){return this._dataProvider.setLocked(this._transaction.id++,e)},e.prototype.unsetAsLecturer=function(){return this._dataProvider.unsetAsLecturer(this._transaction.id++)},e.prototype.disconnectParticipant=function(e){return this._dataProvider.disconnectParticipant(this._transaction.id++,e)},e.prototype.startRecording=function(e,t,i){return this._dataProvider.startRecording(this._transaction.id++,t,i)},e.prototype.stopRecording=function(e){return this._dataProvider.stopRecording(this._transaction.id++)},e.prototype.pauseRecording=function(e){return this._dataProvider.pauseRecording(this._transaction.id++)},e.prototype.resumeRecording=function(e){return this._dataProvider.resumeRecording(this._transaction.id++)},e.prototype.muteUnmute=function(e,t,i){return this._dataProvider.muteUnmute(this._transaction.id++,e,t,i)},e.prototype.controlRemoteCamera=function(e,t){return this._dataProvider.controlRemoteCamera(this._transaction.id++,e,t)},e.prototype.muteUnmuteAll=function(e){return this._dataProvider.muteUnmuteAll(this._transaction.id++,e)},e.prototype.sendLocalMuteEvent=function(e,t){return this._dataProvider.sendLocalMuteEvent(this._transaction.id++,e,t)},e.prototype.sendDisconnectEvent=function(e){return this._isAvailable?this._dataProvider.sendDisconnectEvent(this._transaction.id++,e):S.Deferred().reject("Service unavailable")},e.prototype.setVideoLayout=function(e){return this._dataProvider.setVideoLayout(this._transaction.id++,e)},e.prototype.setVideoLayoutSelfSee=function(e){return this._dataProvider.setVideoLayoutSelfSee(this._transaction.id++,e)},e.prototype.setVideoLayoutTextOverlay=function(e){return this._dataProvider.setVideoLayoutTextOverlay(this._transaction.id++,e)},e.prototype.getCurrentVideoLayout=function(){return this._dataProvider.getCurrentVideoLayout(this._transaction.id++)},e.prototype.terminateConference=function(){return this._dataProvider.terminateConference(this._transaction.id++)},e.prototype.removeLastParticipant=function(){var e=S.Deferred();return r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"removeLastParticipant method is not implemented"),e.reject(new r.Services.Conference.ConferenceException(r.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"removeLastParticipant method is not implemented")),e.promise()},e.prototype.requestToBecomeModerator=function(e){return this._dataProvider.requestToBecomeModerator(this._transaction.id++,e)},e.prototype.signIn=function(e){return this._dataProvider.signIn(this._transaction.id++,e)},e.prototype.videoPin=function(e,t,i,a,r){return this._dataProvider.videoPin(this._transaction.id++,e,t,i,a,r)},e.prototype.extendMeeting=function(e){return this._dataProvider.extendMeeting(this._transaction.id++,e)},e.prototype.addParticipantFromCall=function(e){var t=S.Deferred();return r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"addParticipantFromCall method is not implemented"),t.reject(new r.Services.Conference.ConferenceException(r.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"addParticipantFromCall method is not implemented")),t.promise()},e.prototype.addParticipant=function(i,t){var a=S.Deferred();return this._dataProvider.addParticipant(this._transaction.id++,t).then(function(e){this._conferenceBuilder.addDialoutParticipant(i,e,t)&&a.notify(e),this._dataProvider.getSelectedProvider().on(r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,function(t){var e=i._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];r.Base.Utils.isDefined(e)?t.result===r.Services.Conference.DialoutStatus.CONNECT?(this._conferenceBuilder.updateDialoutParticipant(i,e,t),a.resolve(t)):(i._activeParticipants.splice(i._activeParticipants.indexOf(e),1),a.reject({name:"UCCPServerError",code:t.result,message:"UCCP server responded with "+t.result,type:r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT})):r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Update dialout participant: unknown or canceled participant with participantId",t.participantId),this._dataProvider.getSelectedProvider().off(r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,this._dataProvider.getSelectedProvider()._listeners[r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT][0])}.bind(this))}.bind(this),function(e){a.reject(e)}.bind(this)),a.promise()},e.prototype.cancelDialoutParticipant=function(t,i){var a=S.Deferred();return this._dataProvider.cancelDialoutParticipant(this._transaction.id++,i).then(function(e){this._conferenceBuilder.removeDialoutParticipant(t,i,e),a.resolve(e)}.bind(this),function(e){a.reject(e)}.bind(this)),a.promise()},e.prototype.sendChatMessage=function(e,t){return this._dataProvider.sendChatMessage(this._transaction.id++,e,t)},e.prototype.moderatorAdmission=function(t,i){return this._dataProvider.moderatorAdmission(this._transaction.id++,t.getParticipantId(),i).then(function(e){switch(i){case r.Services.Conference.ModeratorAdmissionActions.ADMIT:this._conferenceBuilder.pendingParticipantAccepted(t,e);break;case r.Services.Conference.ModeratorAdmissionActions.REJECT:this._conferenceBuilder.pendingParticipantDenied(t,e);break;default:r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Unknown action value received: {0}",i)}return e}.bind(this))},e.prototype.raiseLowerHand=function(e){return this._dataProvider.raiseLowerHand(this._transaction.id++,e)},e.prototype.moderatorLowerHand=function(e,t){return this._dataProvider.moderatorLowerHand(this._transaction.id++,e,t)},e.prototype.getDialInInfo=function(){return this._dataProvider.getDialInInfo(this._transaction.id++)},e.prototype.recalculateAddParticipantFromCallCapability=function(e,t){},e.prototype.recalculateAddParticipantFromCallCapabilityByCallId=function(e,t){},e.prototype._isLongPollingUccpProvider=function(e){return!(!e||!e._networkProvider)&&e._networkProvider._communicationAdapter instanceof r.Providers.UCCP.UCCPLongPollingProvider},e.prototype.changeParticipantName=function(e,t){return this._dataProvider.changeParticipantName(this._transaction.id++,e,t)},r.Providers.Scopia.ScopiaConferenceProvider=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={getScopiaConferenceProvider:function(e){if(a.Base.Utils.isDefined(e)&&e.enabled){var t=new a.Providers.UCCP.UCCPMessageBuilder,i=new a.Providers.UCCP.UCCPMessageParser;i.register(a.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_RESPONSE,new a.Providers.UCCP.UCCPHandshakeResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeRosterResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE,new a.Providers.UCCP.UCCPSubscribePermissionsResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_RESPONSE,new a.Providers.UCCP.UCCPSubscribeWebCollabResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE,new a.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,new a.Providers.UCCP.UCCPParticipantJoinedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,new a.Providers.UCCP.UCCPParticipantLeftEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,new a.Providers.UCCP.UCCPActiveTalkerChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,new a.Providers.UCCP.UCCPPermissionsChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPMeetingInfoChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPParticipantInfoChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStartResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStopResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.FECC_RESPONSE,new a.Providers.UCCP.UCCPFeccResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE,new a.Providers.UCCP.UCCPMuteAllResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_RESPONSE,new a.Providers.UCCP.UCCPDisconnectParticipantResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,new a.Providers.UCCP.UCCPDisconnectEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,new a.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_RESPONSE,new a.Providers.UCCP.UCCPTerminateMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_RESPONSE,new a.Providers.UCCP.UCCPDialInInfoResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_RESPONSE,new a.Providers.UCCP.UCCPDialoutResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,new a.Providers.UCCP.UCCPDialoutCompletedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_RESPONSE,new a.Providers.UCCP.UCCPDialoutCancelResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE,new a.Providers.UCCP.UCCPStartModerationResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE,new a.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_RESPONSE,new a.Providers.UCCP.UCCPChatResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,new a.Providers.UCCP.UCCPChatEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_RESPONSE,new a.Providers.UCCP.UCCPLockMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_RESPONSE,new a.Providers.UCCP.UCCPRecordingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_RESPONSE,new a.Providers.UCCP.UCCPExtendMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,new a.Providers.UCCP.UCCPRecordingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_RESPONSE,new a.Providers.UCCP.UCCPCurrentLayoutResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,new a.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,new a.Providers.UCCP.UCCPCurrentLayoutChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE,new a.Providers.UCCP.UCCPVideoPinResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE,new a.Providers.UCCP.UCCPRaiseHandResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE,new a.Providers.UCCP.UCCPModeratorLowerHandResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPAdmissionResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPModeratorAdmissionResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,new a.Providers.UCCP.UCCPRecordingFailedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,new a.Providers.UCCP.UCCPWebCollabChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,new a.Providers.UCCP.UCCPKeepAliveRequestEventParser);e=this._createUccpNetworkProvider(i),t=new a.Providers.UCCP.UCCPProviderFactory(e,t,i).getUCCPProvider(),i=new a.Providers.Scopia.ScopiaConferenceBuilder;return new a.Providers.Scopia.ScopiaConferenceProvider(t,i)}},_createUccpNetworkProvider:function(e){var t=new a.Base.TransactionalWebSocketProvider(a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER),e=new a.Providers.UCCP.UCCPLongPollingProvider(e);return new a.Base.NetworkProvider(t,e,a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER)}},a.Providers.Scopia.ScopiaConferenceProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessage=function(e){this.protocolType="UCCP",this.name=e}}(),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT),this.participantId=e,this.reason=t,this.anotherModerator=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT),this.participantId=e,this.participantName=t,this.userId=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionEvent=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE),this.transId=e,this.responseCode=t,this.anotherModerator=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPModeratorLowerHandResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,r.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE),this.transId=e,this.responseCode=t,this.audioMute=i,this.videoMute=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPModeratorMuteResponse=e}(AvayaClientServices),function(i){"use strict";i.Providers.UCCP.UCCPMuteAllResponse=function(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE),this.transId=e,this.responseCode=t}}(AvayaClientServices),function(_){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h){_.Providers.UCCP.UCCPMessage.call(this,"participantInfoChangedEvent"),this.participantId=t,this.participantName=e,this.status=i,this.handRaised=a,this.role=r,this.feccRecvSupport=s,this.audioFromParticipant=n,this.audioToParticipant=o,this.videoFromParticipant=c,this.videoToParticipant=l,this.contentFromParticipant=d,this.contentToParticipant=C,this.userId=u,this.canLecture=h}e.prototype=Object.create(_.Providers.UCCP.UCCPMessage.prototype),_.Providers.UCCP.UCCPParticipantInfoChangedEvent=e}(AvayaClientServices),function(g){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p){g.Providers.UCCP.UCCPMessage.call(this,"participantJoinedEvent"),this.participantId=e,this.participantName=t,this.userId=i,this.sourceID=a,this.status=r,this.handRaised=s,this.role=n,this.feccRecvSupport=o,this.audioFromParticipant=c,this.audioToParticipant=l,this.videoFromParticipant=d,this.videoToParticipant=C,this.contentFromParticipant=u,this.contentToParticipant=h,this.joinTime=_,this.canLecture=v,this.wasHidden=p}e.prototype=Object.create(g.Providers.UCCP.UCCPMessage.prototype),g.Providers.UCCP.UCCPParticipantJoinedEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.UCCP.UCCPMessage.call(this,"participantLeftEvent"),this.participantId=e}e.prototype=Object.create(t.Providers.UCCP.UCCPMessage.prototype),t.Providers.UCCP.UCCPParticipantLeftEvent=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){o.Providers.UCCP.UCCPMessage.call(this,o.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT),this.dialout=e,this.recording=t,this.lock=i,this.unmuteSelf=a,this.unmuteAll=r,this.sendFecc=s,this.allowVideo=n}e.prototype=Object.create(o.Providers.UCCP.UCCPMessage.prototype),o.Providers.UCCP.UCCPPermissionsChangedEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPRaiseHandResponse=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.UCCP.UCCPMessage.call(this,"recordingFailedEvent")}t.prototype=Object.create(e.Providers.UCCP.UCCPMessage.prototype),e.Providers.UCCP.UCCPRecordingFailedEvent=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"recordingResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPRecordingResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPStartModerationResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeActiveTalkerResponse"),this.transId=e,this.responseCode=t,this.participantId=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeActiveTalkerResponse=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){o.Providers.UCCP.UCCPMessage.call(this,o.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE),this.transId=e,this.responseCode=t,this.textOverlay=i,this.noSelfSee=a,this.videoPin=r,this.geometries=s,this.LPPOn=n}e.prototype=Object.create(o.Providers.UCCP.UCCPMessage.prototype),o.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse=e}(AvayaClientServices),function(A){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S,f,E){A.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingInfoResponse"),this.transId=e,this.responseCode=t,this.meetingId=i,this.meetingName=a,this.virtualRoomName=r,this.virtualRoomOwnerId=s,this.media=n,this.eventConference=o,this.locked=c,this.mediaStatus=l,this.lecturerId=d,this.lecturerName=C,this.presenterId=u,this.presenterName=h,this.recording=_,this.streaming=v,this.encrypted=p,this.moderatorPinNeeded=g,this.slidesAvailable=S,this.recorderAvailable=f,this.terminationTime=E}e.prototype=Object.create(A.Providers.UCCP.UCCPMessage.prototype),A.Providers.UCCP.UCCPSubscribeMeetingInfoResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingNoteResponse"),this.transId=e,this.responseCode=t,this.notes=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeMeetingNoteResponse=e}(AvayaClientServices),function(l){"use strict";function e(e,t,i,a,r,s,n,o,c){l.Providers.UCCP.UCCPMessage.call(this,l.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE),this.transId=e,this.responseCode=t,this.dialout=i,this.recording=a,this.lock=r,this.unmuteSelf=s,this.unmuteAll=n,this.sendFecc=o,this.allowVideo=c}e.prototype=Object.create(l.Providers.UCCP.UCCPMessage.prototype),l.Providers.UCCP.UCCPSubscribePermissionsResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,"subscribeRosterResponse"),this.transId=e,this.responseCode=t,this.fragmentation=i,this.participants=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPSubscribeRosterResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeSliderResponse"),this.transId=e,this.responseCode=t,this.slides=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeSliderResponse=e}(AvayaClientServices),function(l){"use strict";function e(e,t,i,a,r,s,n,o,c){l.Providers.UCCP.UCCPMessage.call(this,"subscribeWebCollabResponse"),this.transId=e,this.responseCode=t,this.webCollabUrl=i,this.token=o,this.participantId=n,this.meeting_id=r,this.mode=s,this.login=a,this.gsid=c}e.prototype=Object.create(l.Providers.UCCP.UCCPMessage.prototype),l.Providers.UCCP.UCCPSubscribeWebCollabResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"terminateMeetingResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPTerminateMeetingResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPUpdateCredentialsTokenResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPVideoPinResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,r.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT),this.webCollabUrl=e,this.token=t,this.participantId=i,this.meeting_id=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPWebCollabChangedEvent=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPActiveTalkerChangedEvent(e.params.participantId)}},t.Providers.UCCP.UCCPActiveTalkerChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPAdmissionResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPAdmissionResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPAvailableLayoutsChangedEvent(e.params.textOverlay?"true"===e.params.textOverlay:T,e.params.noSelfSee?"true"===e.params.noSelfSee:T,e.params.videoPin?"true"===e.params.videoPin:T,e.params.geometries,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutGeometryResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutTextOverlayResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t="";return i.Base.Utils.isDefined(e.params.time)&&(t=e.params.time),new i.Providers.UCCP.UCCPChatEvent(e.params.participantId,e.params.type,t,e.params.text)}},i.Providers.UCCP.UCCPChatEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChatResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChatResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPCurrentLayoutChangedEvent(e.params.textOverlay?"true"===e.params.textOverlay:T,e.params.noSelfSee?"true"===e.params.noSelfSee:T,e.params.geometry,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPCurrentLayoutChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPCurrentLayoutResponse(e.params.transId,e.params.responseCode,"true"===e.params.textOverlay,"true"===e.params.noSelfSee,e.params.geometry,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPCurrentLayoutResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialInInfoResponse(e.params.transId,e.params.responseCode,e.params.webLink,e.params.streamingLink,e.params.dialInInformation,e.params.dialInInformationHtml)}},t.Providers.UCCP.UCCPDialInInfoResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutCancelResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPDialoutCancelResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutCompletedEvent(e.params.participantId,e.params.result)}},t.Providers.UCCP.UCCPDialoutCompletedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutResponse(e.params.transId,e.params.responseCode,e.params.participantId)}},t.Providers.UCCP.UCCPDialoutResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDisconnectEvent(e.params.reason)}},t.Providers.UCCP.UCCPDisconnectEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDisconnectParticipantResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPDisconnectParticipantResponseParser=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={parse:function(e){return new AvayaClientServices.Providers.UCCP.UCCPExtendMeetingResponse(e.params.transId,e.params.responseCode)}},e.Providers.UCCP.UCCPExtendMeetingResponseParser=t}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPFeccResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPFeccResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.currentTime?new Date(Date.parse(e.params.currentTime)):T;return new i.Providers.UCCP.UCCPHandshakeResponse(e.params.transId,e.params.responseCode,e.params.version,e.params.participantId,"true"===e.params.externalAdmissionNeeded,"true"===e.params.admissionPasscodeNeeded,"true"===e.params.admissionPermissionNeeded,e.params.commands,t,e.params.longPollEmptyResponseTimeout,isNaN(parseInt(e.params.knockDoorTimeout))?T:parseInt(e.params.knockDoorTimeout))}},i.Providers.UCCP.UCCPHandshakeResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPKeepAliveRequestEvent(e.params.transId)}},t.Providers.UCCP.UCCPKeepAliveRequestEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLectureModeStartResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLectureModeStartResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLectureModeStopResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLectureModeStopResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLockMeetingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLockMeetingResponseParser=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.terminationTime?new Date(Date.parse(e.params.terminationTime)):T,i=e.params.locked?"true"===e.params.locked:T;return new a.Providers.UCCP.UCCPMeetingInfoChangedEvent(e.params.media,i,e.params.mediaStatus,e.params.lecturerId,e.params.lecturerName,e.params.presenterId,e.params.presenterName,e.params.recording,e.params.streaming?"enabled"===e.params.streaming:T,e.params.encrypted,"true"===e.params.slidesAvailable,t)}},a.Providers.UCCP.UCCPMeetingInfoChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPMeetingTerminationInProgressEvent(e.params.reason,e.params.userName)}},t.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent(e.params.participantId,e.params.reason,e.params.anotherModerator)}},t.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionEvent(e.params.participantId,e.params.name,e.params.userId)}},t.Providers.UCCP.UCCPModeratorAdmissionEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionResponse(e.params.transId,e.params.responseCode,e.params.anotherModerator)}},t.Providers.UCCP.UCCPModeratorAdmissionResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorLowerHandResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPModeratorLowerHandResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorMuteResponse(e.params.transId,e.params.responseCode,"true"===e.params.audioMute,"true"===e.params.videoMute)}},t.Providers.UCCP.UCCPModeratorMuteResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPMuteAllResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPMuteAllResponseParser=e}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={parse:function(e){var t,i,a;return r.Base.Utils.isDefined(e.params.handRaised)&&(t="true"===e.params.handRaised),r.Base.Utils.isDefined(e.params.feccRecvSupport)&&(i="true"===e.params.feccRecvSupport),r.Base.Utils.isDefined(e.params.canLecture)&&(a="true"===e.params.canLecture),new r.Providers.UCCP.UCCPParticipantInfoChangedEvent(e.params.name,e.params.participantId,e.params.status,t,e.params.role,i,e.params.audioFromParticipant,e.params.audioToParticipant,e.params.videoFromParticipant,e.params.videoToParticipant,e.params.contentFromParticipant,e.params.contentToParticipant,e.params.userId,a)}},r.Providers.UCCP.UCCPParticipantInfoChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPParticipantJoinedEvent(e.params.participantId,e.params.name,e.params.userId,e.params.sourceID,e.params.status,"true"===e.params.handRaised,e.params.role,"true"===e.params.feccRecvSupport,e.params.audioFromParticipant,e.params.audioToParticipant,e.params.videoFromParticipant,e.params.videoToParticipant,e.params.contentFromParticipant,e.params.contentToParticipant,new Date(Date.parse(e.params.joinTime)),e.params.canLecture?"true"===e.params.canLecture:T,e.params.wasHidden)}},t.Providers.UCCP.UCCPParticipantJoinedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPParticipantLeftEvent(e.params.participantId)}},t.Providers.UCCP.UCCPParticipantLeftEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPPermissionsChangedEvent(e.params.dialout,e.params.recording,e.params.lock,e.params.unmuteSelf,e.params.unmuteAll,e.params.sendFecc,e.params.allowVideo)}},t.Providers.UCCP.UCCPPermissionsChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRaiseHandResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPRaiseHandResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRecordingFailedEvent}},t.Providers.UCCP.UCCPRecordingFailedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRecordingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPRecordingResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPStartModerationResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPStartModerationResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeActiveTalkerResponse(e.params.transId,e.params.responseCode,e.params.participantId)}},t.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse(e.params.transId,e.params.responseCode,"true"===e.params.textOverlay,"true"===e.params.noSelfSee,"true"===e.params.videoPin,e.params.geometries,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=new Date(Date.parse(e.params.terminationTime));return new i.Providers.UCCP.UCCPSubscribeMeetingInfoResponse(e.params.transId,e.params.responseCode,e.params.meetingId,e.params.meetingName,e.params.virtualRoomName,e.params.virtualRoomOwnerId,e.params.media,"true"===e.params.eventConference,"true"===e.params.locked,e.params.mediaStatus,e.params.lecturerId,e.params.lecturerName,e.params.presenterId,e.params.presenterName,e.params.recording,"enabled"===e.params.streaming,e.params.encrypted,"true"===e.params.moderatorPinNeeded,"true"===e.params.slidesAvailable,e.params.recorderAvailable,t)}},i.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.notes.map(function(e){return{participantId:e.participantId,participantDisplayName:e.participantDisplayName,noteId:e.noteId,text:e.text,time:new Date(Date.parse(e.time))}});return new i.Providers.UCCP.UCCPSubscribeMeetingNoteResponse(e.params.transId,e.params.responseCode,t)}},i.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribePermissionsResponse(e.params.transId,e.params.responseCode,e.params.dialout,e.params.recording,e.params.lock,e.params.unmuteSelf,e.params.unmuteAll,e.params.sendFecc,e.params.allowVideo)}},t.Providers.UCCP.UCCPSubscribePermissionsResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.participants.map(function(e){return this._buildActiveParticipant(e)}.bind(this));return new i.Providers.UCCP.UCCPSubscribeRosterResponse(e.params.transId,e.params.responseCode,e.params.fragmentation,t)},_buildActiveParticipant:function(e){var t,i,a,r={},s="";return r.participantId=e.participantId,r.participantName=e.name,r.userId=e.userId,e.joinTime&&(i=new RegExp(/(\d{2}:\d{2}:\d{2})\s(\d{2})-(\d{2})-(\d{4})\s(-?\+?\d{4})/),a=new RegExp(/(\d{4}-\d{2}-\d{2})[a-zA-Z](\d{2}:\d{2}:\d{2})(-?\+?\d{2}:\d{2})/),i.test(e.joinTime)?s=(t=i.exec(e.joinTime))[4]+"-"+t[3]+"-"+t[2]+" "+t[1]+" GMT"+t[5]:a.test(e.joinTime)&&(s=e.joinTime),s&&(r.joinTime=new Date(Date.parse(s)))),r.sourceID=e.sourceID,r.status=e.status,r.handRaised="true"===e.handRaised,r.role=e.role,r.feccRecvSupport="true"===e.feccRecvSupport,r.audioFromParticipant=e.audioFromParticipant,r.audioToParticipant=e.audioToParticipant,r.videoFromParticipant=e.videoFromParticipant,r.videoToParticipant=e.videoToParticipant,r.contentFromParticipant=e.contentFromParticipant,r.contentToParticipant=e.contentToParticipant,r.canLecture=e.canLecture?"true"===e.canLecture:T,r}},i.Providers.UCCP.UCCPSubscribeRosterResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeSliderResponse(e.params.transId,e.params.responseCode,e.params.slides)}},t.Providers.UCCP.UCCPSubscribeSliderResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeWebCollabResponse(e.params.transId,e.params.responseCode,e.params.webCollabUrl,e.params.login,e.params.meeting_id,e.params.mode,e.params.participantId,e.params.token,e.params.gsid)}},t.Providers.UCCP.UCCPSubscribeWebCollabResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPTerminateMeetingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPTerminateMeetingResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPUpdateCredentialsTokenResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPVideoPinResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPVideoPinResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPWebCollabChangedEvent(e.params.webCollabUrl,e.params.token,e.params.participantId,e.params.meeting_id)}},t.Providers.UCCP.UCCPWebCollabChangedEventParser=e}(AvayaClientServices),function(n){"use strict";var t=n.Base.Storage,i="JSCSDK_UCCP_ClientId";function e(){}e.prototype={buildHandshakeRequest:function(e){var t=new Date,i=-t.getTimezoneOffset(),a=0<=i?"+":"-",i=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+"T"+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+a+("0"+parseInt(Math.abs(i/60))).slice(-2)+":"+("0"+Math.abs(i%60)).slice(-2),i={clientId:this._getClientID(),transId:e.toString(),clientType:"Web Client",clientUserAgent:navigator.userAgent,version:"1.0",features:[{featureName:"passcode",version:"1.0"},{featureName:"knockOnTheDoorParticipant",version:"1.0"},{featureName:"knockOnTheDoorModerator",version:"1.0"}],currentTime:i};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_REQUEST,i)},buildSubscribeMeetingInfoRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_REQUEST,e)},buildSubscribeSliderRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_SLIDER_REQUEST,e)},buildSubscribeActiveTalkerRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_REQUEST,e)},buildSubscribePermissionsRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_REQUEST,e)},buildSubscribeMeetingNoteRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_REQUEST,e)},buildSubscribeRosterRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_REQUEST,e)},buildSubscribeWebCollabRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_REQUEST,e)},buildSubscribeAvailableLayoutsRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST,e)},buildSetAsLecturerRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_REQUEST,t)},buildUnsetAsLecturerRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_REQUEST,e)},buildMuteAllRequest:function(e,t){t={transId:e.toString(),audioMute:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_REQUEST,t)},buildModeratorMuteRequest:function(e,t,i,a){a={transId:e.toString(),participantId:t,mediaType:i,mute:a.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_REQUEST,a)},buildFeccRequest:function(e,t,i){i={transId:e.toString(),participantId:t,action:i.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.FECC_REQUEST,i)},buildDisconnectParticipantRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_REQUEST,t)},buildLocalMuteEvent:function(e,t,i){i={transId:e.toString(),participantId:t,audioMute:i.toString(),videoMute:"false"};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LOCAL_MUTE_EVENT,i)},buildDisconnectEvent:function(e,t){t={transId:e.toString(),reason:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,t)},buildTerminateMeetingRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_REQUEST,e)},buildStartModerationRequest:function(e,t){e={transId:e.toString()};return n.Base.Utils.isDefined(t)&&(e.pin=t),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.START_MODERATION_REQUEST,e)},buildUpdateCredentialsTokenRequest:function(e,t){t={transId:e.toString(),token:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_REQUEST,t)},buildDialoutRequest:function(e,t){t={transId:e.toString(),dialTo:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIALOUT_REQUEST,t)},buildCancelDialoutRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_REQUEST,t)},buildSendChatMessage:function(e,t,i){i={transId:e.toString(),text:t.toString(),participantId:i||"public"};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHAT_REQUEST,i)},buildExtendMeetingRequest:function(e,t){t={transId:e.toString(),additionalTimeInMinutes:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_REQUEST,t)},buildLockMeetingRequest:function(e,t){t={transId:e.toString(),lock:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_REQUEST,t)},buildCurrentLayoutRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_REQUEST,e)},buildChangeLayoutGeometryRequest:function(e,t){t={transId:e.toString(),geometry:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_REQUEST,t)},buildChangeLayoutTextOverlayRequest:function(e,t){t={transId:e.toString(),textOverlay:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_REQUEST,t)},buildChangeLayoutNoSelfSeeRequest:function(e,t){t={transId:e.toString(),enableNoSelfSee:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_REQUEST,t)},buildSetRecordingRequest:function(e,t,i,a){t={transId:e.toString(),recording:t};return n.Base.Utils.isDefined(i)&&(t.name=i),n.Base.Utils.isDefined(a)&&(t.description=a),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,t)},buildVideoPinRequest:function(e,t,i,a,r,s){s={transId:e.toString(),destXCord:r.toString(),destYCord:s.toString()};return n.Base.Utils.isDefined(t)?s.sourceParticipantId=t:n.Base.Utils.isDefined(i)&&n.Base.Utils.isDefined(a)&&(s.sourceXCord=i.toString(),s.sourceYCord=a.toString()),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_REQUEST,s)},buildRaiseHandRequest:function(e,t){t={transId:e.toString(),action:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_REQUEST,t)},buildModeratorLowerHandRequest:function(e,t,i){i={transId:e.toString(),participantId:t.toString(),unmuteAudio:i.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_REQUEST,i)},buildAdmissionRequest:function(e,t){e={transId:e.toString()};return n.Base.Utils.isDefined(t)&&(e.passcode=t),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.ADMISSION_REQUEST,e)},buildModeratorAdmissionRequest:function(e,t,i){i={transId:e.toString(),participantId:t,action:i};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_REQUEST,i)},buildDialInInfoRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_REQUEST,e)},buildKeepaliveRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,e)},buildKeepAliveResponse:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_RESPONSE,e)},_getClientID:function(){var e=t.get(t.TYPES.LOCAL,i);return n.Base.Utils.isUndefined(e)&&(e=n.Base.Utils.generateUUID(),t.set(t.TYPES.LOCAL,i,e)),e},_wrapParams:function(e,t){return{protocolType:"UCCP",name:e,params:t}},buildChangeParticipantNameRequest:function(e,t,i){t={transId:e.toString(),participantName:i,participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_PARTICIPANT_NAME_REQUEST,t)}},n.Providers.UCCP.UCCPMessageBuilder=e}(AvayaClientServices),function(e){"use strict";function t(){this._parsers={}}t.prototype={parse:function(e){return this._parsers[e.name]?this._parsers[e.name].parse(e):e},register:function(e,t){this._parsers[e]=t}},e.Providers.UCCP.UCCPMessageParser=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessageTypes={HANDSHAKE_REQUEST:"handshakeRequest",HANDSHAKE_RESPONSE:"handshakeResponse",SUBSCRIBE_MEETING_INFO_REQUEST:"subscribeMeetingInfoRequest",SUBSCRIBE_MEETING_INFO_RESPONSE:"subscribeMeetingInfoResponse",SUBSCRIBE_ROSTER_REQUEST:"subscribeRosterRequest",SUBSCRIBE_ROSTER_RESPONSE:"subscribeRosterResponse",SUBSCRIBE_ACTIVE_TALKER_REQUEST:"subscribeActiveTalkerRequest",SUBSCRIBE_ACTIVE_TALKER_RESPONSE:"subscribeActiveTalkerResponse",SUBSCRIBE_PERMISSIONS_REQUEST:"subscribePermissionsRequest",SUBSCRIBE_PERMISSIONS_RESPONSE:"subscribePermissionsResponse",SUBSCRIBE_SLIDER_REQUEST:"subscribeSliderInfoRequest",SUBSCRIBE_SLIDER_RESPONSE:"subscribeSliderInfoResponse",SUBSCRIBE_MEETING_NOTE_REQUEST:"subscribeMeetingNoteRequest",SUBSCRIBE_MEETING_NOTE_RESPONSE:"subscribeMeetingNoteResponse",SUBSCRIBE_WEB_COLLAB_REQUEST:"subscribeWebCollabRequest",SUBSCRIBE_WEB_COLLAB_RESPONSE:"subscribeWebCollabResponse",SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"subscribeAvailableLayoutsRequest",SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"subscribeAvailableLayoutsResponse",START_MODERATION_REQUEST:"startModerationRequest",START_MODERATION_RESPONSE:"startModerationResponse",TERMINATE_MEETING_REQUEST:"terminateMeetingRequest",TERMINATE_MEETING_RESPONSE:"terminateMeetingResponse",DIRECTORY_LOOKUP_REQUEST:"directoryLookupRequest",DIRECTORY_LOOKUP_NOTE_RESPONSE:"directoryLookupResponse",DIAL_IN_INFO_REQUEST:"dialInInfoRequest",DIAL_IN_INFO_RESPONSE:"dialInInfoResponse",DIALOUT_REQUEST:"dialoutRequest",DIALOUT_RESPONSE:"dialoutResponse",DIALOUT_CANCEL_REQUEST:"dialoutCancelRequest",DIALOUT_CANCEL_RESPONSE:"dialoutCancelResponse",DISCONNECT_PARTICIPANT_REQUEST:"disconnectParticipantRequest",DISCONNECT_PARTICIPANT_RESPONSE:"disconnectParticipantResponse",LECTURE_MODE_START_REQUEST:"lectureModeStartRequest",LECTURE_MODE_START_RESPONSE:"lectureModeStartResponse",LECTURE_MODE_STOP_REQUEST:"lectureModeStopRequest",LECTURE_MODE_STOP_RESPONSE:"lectureModeStopResponse",RECORDING_REQUEST:"recordingRequest",RECORDING_RESPONSE:"recordingResponse",LOCK_MEETING_REQUEST:"lockMeetingRequest",LOCK_MEETING_RESPONSE:"lockMeetingResponse",EXTEND_MEETING_REQUEST:"extendMeetingRequest",EXTEND_MEETING_RESPONSE:"extendMeetingResponse",MUTE_ALL_REQUEST:"muteAllRequest",MUTE_ALL_RESPONSE:"muteAllResponse",MODERATOR_MUTE_REQUEST:"moderatorMuteRequest",MODERATOR_MUTE_RESPONSE:"moderatorMuteResponse",RAISE_HAND_REQUEST:"raiseHandRequest",RAISE_HAND_RESPONSE:"raiseHandResponse",MODERATOR_LOWER_HAND_REQUEST:"moderatorLowerHandRequest",MODERATOR_LOWER_HAND_RESPONSE:"moderatorLowerHandResponse",CURRENT_LAYOUT_REQUEST:"currentLayoutRequest",CURRENT_LAYOUT_RESPONSE:"currentLayoutResponse",CHANGE_LAYOUT_GEOMETRY_REQUEST:"changeLayoutGeometryRequest",CHANGE_LAYOUT_GEOMETRY_RESPONSE:"changeLayoutGeometryResponse",CHANGE_LAYOUT_NO_SELF_SEE_REQUEST:"changeLayoutNoSelfSeeRequest",CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE:"changeLayoutNoSelfSeeResponse",VIDEO_PIN_REQUEST:"videoPinRequest",VIDEO_PIN_RESPONSE:"videoPinResponse",FECC_REQUEST:"feccRequest",FECC_RESPONSE:"feccResponse",CHANGE_LAYOUT_OVERLAY_REQUEST:"changeLayoutTextOverlayRequest",CHANGE_LAYOUT_OVERLAY_RESPONSE:"changeLayoutTextOverlayResponse",CHAT_REQUEST:"chatRequest",CHAT_RESPONSE:"chatResponse",ADD_MEETING_NOTE_REQUEST:"addMeetingNoteRequest",ADD_MEETING_NOTE_RESPONSE:"addMeetingNoteResponse",UPDATE_MEETING_NOTE_REQUEST:"updateMeetingNoteRequest",UPDATE_MEETING_NOTE_RESPONSE:"updateMeetingNoteResponse",DELETE_MEETING_NOTE_REQUEST:"deleteMeetingNoteRequest",DELETE_MEETING_NOTE_RESPONSE:"deleteMeetingNoteResponse",LOGGING_REQUEST:"loggingRequest",LOGGING_RESPONSE:"loggingResponse",ADMISSION_REQUEST:"admissionRequest",ADMISSION_RESPONSE:"admissionResponse",MODERATOR_ADMISSION_REQUEST:"moderatorAdmissionRequest",MODERATOR_ADMISSION_RESPONSE:"moderatorAdmissionResponse",MOBILE_LINK_ID_REQUEST:"mobileLinkIdRequest",MOBILE_LINK_ID_RESPONSE:"mobileLinkIdResponse",MOBILE_LINK_ROOM_SYSTEM_LIST_REQUEST:"mobileLinkRoomSystemListRequest",MOBILE_LINK_ROOM_SYSTEM_LIST_RESPONSE:"mobileLinkRoomSystemListResponse",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkChooseRoomSystemRequest",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkChooseRoomSystemResponse",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkManualChooseRoomSystemRequest",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkManualChooseRoomSystemResponse",MOBILE_LINK_DISCONNECT_REQUEST:"mobileLinkDisconnectRequest",MOBILE_LINK_DISCONNECT_RESPONSE:"mobileLinkDisconnectResponse",UPDATE_CREDENTIALS_TOKEN_REQUEST:"updateCredentialsTokenRequest",UPDATE_CREDENTIALS_TOKEN_RESPONSE:"updateCredentialsTokenResponse",UNSUBSCRIBE_MEETING_INFO_REQUEST:"unsubscribeMeetingInfoRequest",UNSUBSCRIBE_MEETING_INFO_RESPONSE:"unsubscribeMeetingInfoResponse",UNSUBSCRIBE_ROSTER_REQUEST:"unsubscribeRosterRequest",UNSUBSCRIBE_ROSTER_RESPONSE:"unsubscribeRosterResponse",UNSUBSCRIBE_SLIDER_REQUEST:"unsubscribeSliderInfoRequest",UNSUBSCRIBE_SLIDER_RESPONSE:"unsubscribeSliderInfoResponse",UNSUBSCRIBE_ACTIVE_TALKER_REQUEST:"unsubscribeActiveTalkerRequest",UNSUBSCRIBE_ACTIVE_TALKER_RESPONSE:"unsubscribeActiveTalkerResponse",UNSUBSCRIBE_PERMISSIONS_REQUEST:"unsubscribePermissionsRequest",UNSUBSCRIBE_PERMISSIONS_RESPONSE:"unsubscribePermissionsResponse",UNSUBSCRIBE_MEETING_NOTE_REQUEST:"unsubscribeMeetingNoteRequest",UNSUBSCRIBE_MEETING_NOTE_RESPONSE:"unsubscribeMeetingNoteResponse",UNSUBSCRIBE_WEB_COLLAB_REQUEST:"unsubscribeWebCollabRequest",UNSUBSCRIBE_WEB_COLLAB_RESPONSE:"unsubscribeWebCollabResponse",UNSUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"unsubscribeAvailableLayoutsRequest",UNSUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"unsubscribeAvailableLayoutsResponse",KEEPALIVE_REQUEST:"keepaliveRequest",KEEPALIVE_RESPONSE:"keepaliveResponse",CHANGE_PARTICIPANT_NAME_REQUEST:"changeParticipantNameRequest",PARTICIPANT_JOINED_EVENT:"participantJoinedEvent",PARTICIPANT_LEFT_EVENT:"participantLeftEvent",ACTIVE_TALKER_CHANGED_EVENT:"activeTalkerChangedEvent",PERMISSIONS_CHANGED_EVENT:"permissionsChangedEvent",CHAT_EVENT:"chatEvent",MEETING_NOTE_ADDED_EVENT:"meetingNoteAddedEvent",MEETING_NOTE_UPDATED_EVENT:"meetingNoteUpdatedEvent",MEETING_NOTE_DELETED_EVENT:"meetingNoteDeletedEvent",LOGGING_EVENT:"loggingEvent",MEETING_INFO_CHANGED_EVENT:"meetingInfoChangedEvent",MEETING_TERMINATION_IN_PROGRESS_EVENT:"meetingTerminationInProgressEvent",NEW_SLIDE_EVENT:"newSlideEvent",PARTICIPANT_INFO_CHANGED_EVENT:"participantInfoChangedEvent",USER_MOVED_EVENT:"userMovedEvent",DIALOUT_COMPLETED_EVENT:"dialoutCompletedEvent",LOCAL_MUTE_EVENT:"localMuteEvent",AVAILABLE_LAYOUTS_CHANGED_EVENT:"availableLayoutsChangedEvent",CURRENT_LAYOUT_CHANGED_EVENT:"currentLayoutChangedEvent",RECORDING_FAILED_EVENT:"recordingFailedEvent",MODERATOR_ADMISSION_EVENT:"moderatorAdmissionEvent",MODERATOR_ADMISSION_CANCELED_EVENT:"moderatorAdmissionCanceledEvent",WEB_COLLAB_CHANGED_EVENT:"webCollabChangedEvent",DISCONNECT_EVENT:"disconnectEvent"}}(),function(t){"use strict";function e(e,t,i){this._networkProvider=e,this._messageBuilder=t,this._messageParser=i,this._uccpProvider={}}e.prototype={getUCCPProvider:function(){var e;return S.isEmptyObject(this._uccpProvider)&&(e=this._createUCCP1Provider(),this._uccpProvider=new t.Providers.UCCP.UCCPProvider,this._uccpProvider.registerUCCPProvider(1,e)),this._uccpProvider},_createUCCP1Provider:function(){return new t.Providers.UCCP.UCCP1Provider(this._networkProvider,this._messageBuilder,this._messageParser)}},t.Providers.UCCP.UCCPProviderFactory=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={_validateTagLength:function(e,t){var i=0;switch(t){case a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:case a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:i=14;break;case a.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG:i=13;break;case a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:i=1;break;case a.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG:i=5}return i<=e||(a.Base.Logger.warn(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Byte array size: {0} < Min Tag length: {1} Tag type: {2}",e,i,t),!1)},_get64bitNumber:function(e){e=e.readBytes(8);return 4294967296*e.readUnsignedInt()+e.readUnsignedInt()}},a.Providers.WCS.AbstractBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray,e=e.id;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG))return T;t=new i.Providers.WCS.ScreenSharingAcknowledgementTag;return t.messageId=e,t},i.Providers.WCS.AcknowledgementTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG))return T;e=new i.Providers.WCS.ScreenSharingBlockTag;if(e.width=t.readShort(),e.height=t.readShort(),e.x=t.readShort(),e.y=t.readShort(),e.imageType=t.readByte(),e.length=t.readInt(),e.length===t.getBytesAvailable())e.data=t.readBytes(e.length);else{if(e.length+4!==t.getBytesAvailable())return i.Base.Logger.error(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Invalid type "+i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG+". Tried to read: "+e.length+". BytesAvailable "+t.getBytesAvailable()),T;t.readInt(),e.data=t.readBytes(e.length)}return e},i.Providers.WCS.BlockTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG))return T;e=new i.Providers.WCS.ScreenSharingCursorTag;return e.x=t.readShort(),e.y=t.readShort(),e.creationTime=this._get64bitNumber(t),e},i.Providers.WCS.CursorTagBinaryParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){e=e.byteArray;return this._validateTagLength(e.length,t.Providers.WCS.WCSScreenSharingTagTypes.END_TAG)?new t.Providers.WCS.ScreenSharingEndTag:T},t.Providers.WCS.EndTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(e.byteArray.length,i.Providers.WCS.WCSScreenSharingTagTypes.START_TAG))return T;e=new i.Providers.WCS.ScreenSharingStartTag;e.isKeyFrame=Boolean(t.readByte()),e.width=t.readShort(),e.height=t.readShort(),e.creationTime=this._get64bitNumber(t);t=(new Date).getTime();return i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Start Tag [keyframe={0}]: {1}x{2} isKeyFrame: "+e.isKeyFrame+". width: "+e.width+". height: "+e.height+". creationTime: "+e.creationTime+". TimeDiff: "+(t-e.creationTime)),e},i.Providers.WCS.StartTagBinaryParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.AbstractEvent=function(e){this.type=e}}(),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractEvent.call(this,e),t&&(this.from=t.from,this.fromname=t.fromname,this.eventId=t.eventId,this.senderId=t.senderId,this.senderName=t.senderName,this.time=t.time,this.useragent=t.useragent,this.wsConnectionId=t.wsConnectionId,this.data={})}(e.prototype=Object.create(i.Providers.WCS.AbstractEvent)).isServerInitiated=function(){return"Web Collaboration Server"===this.from},i.Providers.WCS.AbstractLiveEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.ADD_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.AddNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r){this.noteType=e,this.text=t,this.meetingOwner=i,this.isPersonal=a,r&&(this.targetId=r)}t.prototype={},e.Providers.WCS.AddNoteEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.AddWhiteboardEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.AllowPresentingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.targetId=e,this.targetName=t}t.prototype={},e.Providers.WCS.AllowPresentingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.CLEAR_DRAWING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.ClearDrawingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.groupId=e,this.layerType=t}t.prototype={},e.Providers.WCS.ClearDrawingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.noteId=e}t.prototype={},e.Providers.WCS.DeleteNoteEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_SELECTION),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteSelectionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r){this.groupId=e,this.layerType=t,this.shapeId=i,this.selectionX=a,this.selectionY=r}t.prototype={},e.Providers.WCS.DeleteSelectionEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteWhiteboardEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.id=e}t.prototype={},e.Providers.WCS.DeleteWhiteboardEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.REQUEST_CONTROL),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.DenyControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DENY_PRESENTING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DenyPresentingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.targetId=e,this.targetName=t}t.prototype={},e.Providers.WCS.DenyPresentingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_CIRCLE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawCircleEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l,d,C){this.alpha=e,t&&(this.fillColor=t),i&&(this.color=i),d&&(this.filled=d),C&&(this.contour=C),this.groupId=a,this.layerType=r,this.width=s,this.x0=n,this.x1=o,this.y0=c,this.y1=l}t.prototype={},e.Providers.WCS.DrawCircleEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawShapeEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l){e&&(this.alpha=e),t&&(this.fillColor=t),i&&(this.color=i),a&&(this.groupId=a),r&&(this.layerType=r),!s&&0!==s||(this.width=s),!n&&0===n.length||(this.l=n),!o&&0===o.length||(this.m=o),l&&(this.contour=l),c&&(this.filled=c)}t.prototype={},e.Providers.WCS.DrawShapeEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_TEXT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawTextEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.fillColor=e,this.fontSize=t,this.groupId=i,this.layerType=a,this.text=r||"",this.x=s,this.y=n}t.prototype={},e.Providers.WCS.DrawTextEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.EjectParticipantEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.targetId=e,this.targetName=t,this.targetParticipantId=i,this.time=a}t.prototype={},e.Providers.WCS.EjectParticipantEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_CONTROL),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.EndDrawShapeEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.groupId=e,this.layerType=t}t.prototype={},e.Providers.WCS.EndDrawShapeEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_MEETING),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndMeetingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndScreenSharingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndVideoSharingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_WHITEBOARD),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndWhiteboardEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.ERROR),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.ErrorEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.code=e,this.message=t,this.requestId=i,this.wsConnectionId=a}t.prototype={},e.Providers.WCS.ErrorEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.FRAME_REPORT),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.FrameReportEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this.droppedFrames=e,this.droppedFramesPercentageRounded=t,this.period=i,this.successfulFrames=a,this.timeEnd=r,this.timeStart=s}t.prototype={},e.Providers.WCS.FrameReportEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.GRANT_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.GrantControlEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.osType=e}t.prototype={},e.Providers.WCS.GrantControlEventData=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o){this.attendeeId=e,this.clientVersion=t,this.privateChatSupported=i,this.startTime=a,this.userAgent=r,this.userIp=s,this.userName=n,this.wsConnectionId=o}t.prototype={},e.Providers.WCS.LiveAttendeeEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveAttendeesEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveCapabilitiesEvent=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={},e.Providers.WCS.LiveCapabilitiesEventData=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.LiveEventCommonData=function(e,t,i,a,r,s,n,o,c){this.from=e,this.fromname=t,this.eventId=i,this.senderId=a,this.senderName=r,this.time=s,this.type=n,this.useragent=o,this.wsConnectionId=c}}(),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_SESSION),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveSessionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.requestId=e,this.idleTimeout=t,this.serverTimeDiff=i,this.wsConnectionId=a,this.meeting=r,this.liveAttendee=s,this.features=n}t.prototype={},e.Providers.WCS.LiveSessionEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_VIEWER),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveViewerEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l,d,C,u){this.brandId=e,this.wcsVersion=t,this.websocketPath=i,this.websocketCacheSize=a,this.uploadSize=r,this.uploadMaxImageSize=s,this.uploadMaxImageResolution=n,this.uploadTypes=o,this.maxDuration=c,this.eventWaitTime=l,this.uploadMaxFile=d,this.themesLocation=C,this.internalUiControls=u}t.prototype={},e.Providers.WCS.LiveViewerEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.MOVE_SELECTION),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.MoveSelectionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.groupId=e,this.layerType=t,this.shapeId=i,this.moveToX=a,this.moveToY=r,this.selectionX=s,this.selectionY=n}t.prototype={},e.Providers.WCS.MoveSelectionEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.PauseScreenSharingEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_DOCUMENT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendDocumentEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this.filename=e,this.filesize=t,this.fileurl=i}t.prototype={},e.Providers.WCS.SendDocumentEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_MESSAGE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendMessageEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.message=e,this.targetName=t,this.isPrivate=i,a&&(this.targetId=a)}t.prototype={},e.Providers.WCS.SendMessageEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_SLIDE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendSlideEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o){this.count=e,this.index=t,this.title=i,this.presentationId=a,this.slideUrl=r,this.slideBaseUrl=s,this.tocUrl=n,this.includeToc=o}t.prototype={},e.Providers.WCS.SendSlideEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.ServerCapabilitiesEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.maxHeight=e,this.maxWidth=t}t.prototype={},e.Providers.WCS.ServerCapabilitiesEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SET_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SetNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this.noteId=e,this.noteType=t,this.text=i,this.attendeeId=a,this.isPersonal=r,s&&(this.targetId=s)}t.prototype={},e.Providers.WCS.SetNoteEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.SLIDER_EMPTY),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.SliderEmptyEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SLIDER_SLIDE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SliderSlideEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.slideURL=e,this.thumbUrl=t}t.prototype={},e.Providers.WCS.SliderSlideEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartDrawShapeEvent=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.StartDrawShapeEventData=function(e,t,i,a,r){this.alpha=e,this.color=t,this.groupId=i,this.layerType=a,this.width=r}}(),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_MEETING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartMeetingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.userkey=e}t.prototype={},e.Providers.WCS.StartMeetingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,e),this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartScreenSharingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.transportVersion=e}t.prototype={},e.Providers.WCS.StartScreenSharingEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.StartVideoSharingEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_WHITEBOARD),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartWhiteboardEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.id=e}t.prototype={},e.Providers.WCS.StartWhiteboardEventData=t}(AvayaClientServices),function(s){"use strict";function e(){this.lastStartScreenSharingWsId="",this.latestKeyEvents={sharing:T,slider:T}}e.prototype={getOptimizedQueue:function(e){var t=[];if(e.length<=1)t=e;else{for(var i=e.length-1;0<=i;i--){var a=e[i];this.isEventValid(a)?(e[i].type!==s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&e[i].type!==s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||e[i].wsConnectionId!==this.lastStartScreenSharingWsId)&&t.push(a):s.Base.Logger.debug(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Event is not relevant: ",a.type)}t.reverse()}for(var r=0;r<=t.length-1;r++)t[r].type!==s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&t[r].type!==s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||(this.lastStartScreenSharingWsId=t[r].wsConnectionId);return this.latestKeyEvents={sharing:T,videoSharing:T,slider:T},t},isEventValid:function(e){return this.isStartContentSharingEvent(e)?this.isStartSharingEventValid(e):this.isEndContentSharingEvent(e)?this.isEndSharingEventValid(e):this.isStartContentVideoSharingEvent(e)?this.isStartVideoSharingEventValid(e):this.isEndContentVideoSharingEvent(e)?this.isEndVideoSharingEventValid(e):this.isMidSharingEvent(e)?this.isMidSharingEventValid():this.isSliderEvent(e)?this.isSliderEventValid():!this.isEmptySliderEvent(e)||this.isEmptySliderEventValid(e)},isStartContentSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING},isEndContentSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING||e.type===s.Providers.WCS.WCSEventTypes.END_PRESENTATION},isStartContentVideoSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING},isEndContentVideoSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING},isMidSharingEvent:function(e){switch(e.type){case s.Providers.WCS.WCSEventTypes.REQUEST_CONTROL:case s.Providers.WCS.WCSEventTypes.GRANT_CONTROL:case s.Providers.WCS.WCSEventTypes.DECLINE_CONTROL:case s.Providers.WCS.WCSEventTypes.DENY_CONTROL:case s.Providers.WCS.WCSEventTypes.START_CONTROL:case s.Providers.WCS.WCSEventTypes.END_CONTROL:case s.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING:case s.Providers.WCS.WCSEventTypes.DENY_PRESENTING:case s.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING:case s.Providers.WCS.WCSEventTypes.SEND_SLIDE:return!0;default:return!1}},isSliderEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.SLIDER_SLIDE},isEmptySliderEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.SLIDER_EMPTY},isStartSharingEventValid:function(e){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=e,!0)},isEndSharingEventValid:function(e){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=e,!0)},isStartVideoSharingEventValid:function(e){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=e,!0)},isEndVideoSharingEventValid:function(e){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=e,!0)},isMidSharingEventValid:function(){return!this.latestKeyEvents.sharing},isEmptySliderEventValid:function(e){return this.latestKeyEvents.slider||(this.latestKeyEvents.slider=e),!1},isSliderEventValid:function(){return!this.latestKeyEvents.slider}},s.Providers.WCS.LiveEventQueueOptimizer=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")},colorHexToInt:function(e){return parseInt("0x".concat(e.slice(1))).toString()},stringToCamel:function(e){return e.replace(/(_[a-z])/g,function(e){return e.toUpperCase().replace("_","")})}},e.Providers.WCS.AbstractParser=t}(AvayaClientServices),function(e){"use strict";function t(){this._onMessageParsedCallbacks=S.Callbacks(),this.msgHeaderDetails={headerSize:8,msgSize:3,flagSize:1,lengthIndicatorSize:4,msgTxt:"msg",textFlagValue:128},this._activeMsg=T}t.prototype.parse=function(e){var t;e instanceof ArrayBuffer&&(0<(t=e.byteLength)&&this._extractDataFromMsg(0,e,t))},t.prototype.addOnMessageParsedCallback=function(e){this._onMessageParsedCallbacks.add(e)},t.prototype.removeOnMessageParsedCallback=function(e){this._onMessageParsedCallbacks.remove(e)},t.prototype._parseToString=function(e){for(var t=new Uint8Array(e),i="",a=0;a<t.length;a++)i+=String.fromCharCode(t[a]);return i},t.prototype._utf8Decoder=function(e){for(var t,i=new Uint8Array(e),a="",r=i.length,s=0;s<r;s++)t=i[s],a+=String.fromCharCode(251<t&&t<254&&s+5<r?1073741824*(t-252)+(i[++s]-128<<24)+(i[++s]-128<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:247<t&&t<252&&s+4<r?(t-248<<24)+(i[++s]-128<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:239<t&&t<248&&s+3<r?(t-240<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:223<t&&t<240&&s+2<r?(t-224<<12)+(i[++s]-128<<6)+i[++s]-128:191<t&&t<224&&s+1<r?(t-192<<6)+i[++s]-128:t);return a},t.prototype._extractDataFromMsg=function(e,t,i){var a,r;e<i&&(i-this.msgHeaderDetails.headerSize>=this.msgHeaderDetails.headerSize+1?this._utf8Decoder(t.slice(e,e+this.msgHeaderDetails.msgSize))===this.msgHeaderDetails.msgTxt?(r=this._getMessageLength(t.slice(e+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize,e+this.msgHeaderDetails.headerSize)),a=t.slice(e+this.msgHeaderDetails.headerSize,e+this.msgHeaderDetails.headerSize+r),this._isMsgBinary(t.slice(e+this.msgHeaderDetails.msgSize,e+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize))||(a=this._utf8Decoder(a)),r+this.msgHeaderDetails.headerSize+e<=i?(this._onMessageParsedCallbacks.fire({data:a}),this._extractDataFromMsg(r+this.msgHeaderDetails.headerSize+e,t,i)):this._activeMsg=t.slice(e,i)):(r=this._concatBuffers(this._activeMsg,t),this._extractDataFromMsg(0,r,r.byteLength)):this._activeMsg=t.slice(e,i))},t.prototype._isMsgBinary=function(e){return 0===new Uint8Array(e)[0]},t.prototype._getMessageLength=function(e){for(var t=new Uint8Array(e),i=0,a=0;a<this.msgHeaderDetails.lengthIndicatorSize;++a)i+=t[a],a<this.msgHeaderDetails.lengthIndicatorSize-1&&(i<<=8);return i},t.prototype._concatBuffers=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer},e.Providers.WCS.CometParser=t}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t={};t.droppedFrames=i.Base.Utils.queryJSONObject(e,"dropped_frames[0]._text"),t.droppedFramesPercentageRounded=i.Base.Utils.queryJSONObject(e,"dropped_frames_percentage_rounded[0]._text"),t.period=i.Base.Utils.queryJSONObject(e,"period[0]._text"),t.successfulFrames=i.Base.Utils.queryJSONObject(e,"successful_frames[0]._text"),t.timeEnd=i.Base.Utils.queryJSONObject(e,"time_end[0]._text"),t.timeStart=i.Base.Utils.queryJSONObject(e,"time_start[0]._text");t=new i.Providers.WCS.FrameReportEventData(t.droppedFrames,t.droppedFramesPercentageRounded,t.period,t.successfulFrames,t.timeEnd,t.timeStart);return new i.Providers.WCS.FrameReportEvent(t)},i.Providers.WCS.FrameReportParser=e}(AvayaClientServices),function(C){"use strict";function e(){}(e.prototype=Object.create(C.Providers.WCS.AbstractParser.prototype)).parse=function(e){for(var t={liveAttendees:[]},i=0;i<e.live_attendee.length;i++){var a=C.Base.Utils.queryJSONObject(e.live_attendee[i],"attendee_id[0]._text"),r=C.Base.Utils.queryJSONObject(e.live_attendee[i],"client_version[0]._text"),s=C.Base.Utils.queryJSONObject(e.live_attendee[i],"private_chat_supported[0]._text"),n=C.Base.Utils.queryJSONObject(e.live_attendee[i],"start_time[0]._text"),o=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_agent[0]._text"),c=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_ip[0]._text"),l=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_name[0]._text"),d=C.Base.Utils.queryJSONObject(e.live_attendee[i],"ws_connection_id[0]._text");t.liveAttendees.push(new C.Providers.WCS.LiveAttendeeEventData(a,r,s,n,o,c,l,d))}return new C.Providers.WCS.LiveAttendeesEvent(t)},C.Providers.WCS.LiveAttendeesParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t=new i.Providers.WCS.LiveCapabilitiesEventData;return new i.Providers.WCS.LiveCapabilitiesEvent(t)},i.Providers.WCS.LiveCapabilitiesParser=e}(AvayaClientServices),function(t){"use strict";function e(){}var r={whiteboard:"whiteboard_",slide:"slide_"};(e.prototype=Object.create(t.Providers.WCS.AbstractParser.prototype)).stripCommonData=function(e){var i={};return S.each(e._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),new t.Providers.WCS.LiveEventCommonData(i.from,i.fromname,i.id,i.senderId,i.senderName,i.time,i.type,i.useragent,i.wsConnectionId)},e.prototype.convertGroup=function(i){var a;if(S.each(r,function(e,t){if(0===i.indexOf(t))return!(a={groupId:parseInt(i.split(t)[1]),layerType:e})}.bind(this)),a)return a;t.Base.Logger.error(t.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown group prefix type!")},t.Providers.WCS.LiveEventParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t={request_id:i.Base.Utils.queryJSONObject(e,"request_id[0]._text"),idle_timeout:i.Base.Utils.queryJSONObject(e,"idle_timeout[0]._text"),ws_connection_id:i.Base.Utils.queryJSONObject(e,"ws_connection_id[0]._text"),server_time_diff:i.Base.Utils.queryJSONObject(e,"server_time_diff[0]._text")},e={attendeeId:i.Base.Utils.queryJSONObject(e,"attendee_id[0]._text"),userName:i.Base.Utils.queryJSONObject(e,"username[0]._text")},e=new i.Providers.WCS.LiveSessionEventData(t.request_id,t.idle_timeout,t.ws_connection_id,t.server_time_diff,{},e,{});return new i.Providers.WCS.LiveSessionEvent(e)},i.Providers.WCS.LiveSessionParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.AbstractParser.prototype)).parse=function(e){e=new t.Providers.WCS.LiveViewerEventData(t.Base.Utils.queryJSONObject(e,"brand_id[0]._text"),t.Base.Utils.queryJSONObject(e,"wcs_version[0]._text"),t.Base.Utils.queryJSONObject(e,"websocket_path[0]._text"),+t.Base.Utils.queryJSONObject(e,"websocket_cache_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_image_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_image_resolution[0]._text"),t.Base.Utils.queryJSONObject(e,"upload_types[0]._text"),+t.Base.Utils.queryJSONObject(e,"max_duration[0]._text"),+t.Base.Utils.queryJSONObject(e,"event_wait_time[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_file[0]._text"),t.Base.Utils.queryJSONObject(e,"themes_location[0]._text"),"true"===t.Base.Utils.queryJSONObject(e,"internal_ui_controls[0]._text"));return new t.Providers.WCS.LiveViewerEvent(e)},t.Providers.WCS.LiveViewerParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.selection[0]._attr&&S.each(e.selection[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.MoveSelectionEventData(i.groupId,i.layerType,i.id,i.moveToX,i.moveToY,i.selectionX,i.selectionY);return new a.Providers.WCS.MoveSelectionEvent(this.stripCommonData(e),t)},a.Providers.WCS.MoveSelectionParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.PauseScreenSharingEvent(this.stripCommonData(e))},t.Providers.WCS.PauseScreenSharingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.filename=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.filename._value"),t.filesize=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.filesize._value"),t.fileurl=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.fileurl._value");t=new i.Providers.WCS.SendDocumentEventData(t.filename,t.filesize,t.fileurl);return new i.Providers.WCS.SendDocumentEvent(this.stripCommonData(e),t)},i.Providers.WCS.SendDocumentParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.message&&(t.message=i.Base.Utils.queryJSONObject(e,"message[0]._text")),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value"),e._attr.target_id?(t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.private=!0):t.private=!1;t=new i.Providers.WCS.SendMessageEventData(t.message,t.targetName,t.private,t.targetId);return new i.Providers.WCS.SendMessageEvent(this.stripCommonData(e),t)},i.Providers.WCS.SendMessageParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={},i=a.Base.Utils.queryJSONObject(e,"slide[0]._attr");t.count=i.count._value,t.index=i.index._value,t.title=i.title._value,t.presentationId=i.presentationid._value,t.slideUrl=i.slideurl._value,t.slideBaseUrl=i.slideurl._value,t.tocUrl=i.toc._value,t.includeToc="true"===i.includetoc._value;t=new a.Providers.WCS.SendSlideEventData(t.count,t.index,t.title,t.presentationId,t.slideUrl,t.slideBaseUrl,t.tocUrl,t.includeToc);return new a.Providers.WCS.SendSlideEvent(this.stripCommonData(e),t)},a.Providers.WCS.SendSlideParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"server_capabilities[0].max_frame_height[0]._text"),e=i.Base.Utils.queryJSONObject(e,"server_capabilities[0].max_frame_width[0]._text"),e=new i.Providers.WCS.ServerCapabilitiesEventData(t,e);return new i.Providers.WCS.ServerCapabilitiesEvent(e)},i.Providers.WCS.ServerCapabilitiesParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.note&&(t.type=i.Base.Utils.queryJSONObject(e,"note[0]._attr.type._value"),t.text=i.Base.Utils.queryJSONObject(e,"note[0]._text"),t.noteId=i.Base.Utils.queryJSONObject(e,"note[0]._attr.event_id._value"),t.attendeeId=i.Base.Utils.queryJSONObject(e,"note[0]._attr.attende_id._value")),e._attr.target_id?(t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.personal=!0):t.personal=!1;t=new i.Providers.WCS.SetNoteEventData(t.noteId,t.type,t.text,t.attendeeId,t.personal,t.targetId);return new i.Providers.WCS.SetNoteEvent(this.stripCommonData(e),t)},i.Providers.WCS.SetNoteParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.SliderEmptyEvent(this.stripCommonData(e))},t.Providers.WCS.SliderEmptyParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};i.Base.Utils.queryJSONObject(e,"data[0].slide_url[0]")?(t.slideURL=i.Base.Utils.queryJSONObject(e,"data[0].slide_url[0]._text"),t.thumbUrl=i.Base.Utils.queryJSONObject(e,"data[0].thumbnail_url[0]._text")):(t.slideURL=i.Base.Utils.queryJSONObject(e,"data[0].sliderUrl[0]._text"),t.thumbUrl=i.Base.Utils.queryJSONObject(e,"data[0].thumbUrl[0]._text"));t=new i.Providers.WCS.SliderSlideEventData(t.slideURL,t.thumbUrl);return new i.Providers.WCS.SliderSlideEvent(this.stripCommonData(e),t)},i.Providers.WCS.SliderSlideParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.lines[0]._attr&&S.each(e.lines[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),a.Base.Utils.isDefined(i.color)&&(i.color=a.Base.Utils.colorIntToHex(i.color)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.StartDrawShapeEventData(i.alpha,i.color,i.groupId,i.layerType,i.width);return new a.Providers.WCS.StartDrawShapeEvent(this.stripCommonData(e),t)},a.Providers.WCS.StartDrawShapeParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=new i.Providers.WCS.StartMeetingEventData("173621");return new i.Providers.WCS.StartMeetingEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartMeetingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"transport_version[0]._text"),t=new i.Providers.WCS.StartScreenSharingEventData(t);return new i.Providers.WCS.StartScreenSharingEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartScreenSharingParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.StartVideoSharingEvent(this.stripCommonData(e))},t.Providers.WCS.StartVideoSharingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"whiteboard[0]._attr.index._value"),t=new i.Providers.WCS.StartWhiteboardEventData(t);return new i.Providers.WCS.StartWhiteboardEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartWhiteboardParser=e}(AvayaClientServices),function(i){"use strict";function e(e){this._position=0,this._buffer=e,this.length=this._buffer.byteLength}e.prototype={getBuffer:function(){return this._buffer},setPosition:function(e){this._position=e},getPosition:function(){return this._position},getBytesAvailable:function(){return this._buffer.byteLength-this._position},readBytes:function(e){var t=new i.Providers.WCS.ByteArray(this._buffer.slice(this._position,this._position+e));return this._position+=e,t},readByte:function(){var e=new Int8Array(this._buffer.slice(this._position,this._position+1));return this._position++,e[0]},readUnsignedInt:function(){var e=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,e.getUint32(0)},readShort:function(){var e=new DataView(this._buffer.slice(this._position,this._position+2));return this._position+=2,e.getInt16(0)},readInt:function(){var e=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,e.getInt32(0)}},i.Providers.WCS.ByteArray=e}(AvayaClientServices),function(e){"use strict";function t(){this._bitmapElements=[],this.width=0,this.height=0,this.isKeyFrame=!1}t.prototype={setStartTag:function(e){return this.width=e.width,this.height=e.height,this.isKeyFrame=e.isKeyFrame,this},addBitmapElement:function(e){return this._bitmapElements.push(e),this}},e.Providers.WCS.Frame=t}(AvayaClientServices),function(e){"use strict";function t(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.bitmapData=e.data.getBuffer(),this.imageType=e.imageType}t.prototype={},e.Providers.WCS.FrameBitmapLoader=t}(AvayaClientServices),function(i){"use strict";function e(){this._frame=T}e.prototype={processTag:function(e,t){switch(e.type){case i.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:this._startFrame(e);break;case i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:this._addBinaryBlock(e);break;case i.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:this._endFrame(t);break;default:i.Base.Logger.warn(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",e.type)}},_startFrame:function(e){i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add start Tag"),this._frame=new i.Providers.WCS.Frame,this._frame.setStartTag(e)},_addBinaryBlock:function(e){this._frame&&0<e.data.length&&(e=new i.Providers.WCS.FrameBitmapLoader(e),this._frame.addBitmapElement(e))},_endFrame:function(e){this._frame?(i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add End Tag - end Frame",this._frame._bitmapElements.length),e(this._frame),this._frame=T):i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"There was no Start Tag for this End Tag")}},i.Providers.WCS.FrameBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingImageTypes={JPEG:0,PNG:1,JPEG_RED_WITH_BLACK:2}}(),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingKeyFrameTypes={INTRA_FRAME:0,KEY_FRAME:1}}(),function(n){"use strict";n.Providers.WCS.ScreenSharingTagEncoder=function(){},n.Providers.WCS.ScreenSharingTagEncoder.prototype={encodeTag:function(e){switch(e.type){case n.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:return this._encodeStartFrame(e);case n.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:return this._encodeBinaryBlock(e);case n.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:return this._encodeEndFrame(e);default:n.Base.Logger.warn(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",e.type)}},_encodeStartFrame:function(e){var t,i,a=0;0!==e.messageId?(a=4,t=new ArrayBuffer(14+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(14+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.START_TAG),i.setInt8(1+a,e.isKeyFrame?n.Providers.WCS.ScreenSharingKeyFrameTypes.KEY_FRAME:n.Providers.WCS.ScreenSharingKeyFrameTypes.INTRA_FRAME),i.setInt16(2+a,e.width),i.setInt16(4+a,e.height);for(var r=this._getCurrentTimeStamp(e.creationTime),s=0;s<r.length;s++)i.setInt8(6+a+s,r[s]);return t},_encodeBinaryBlock:function(e){var t,i,a,r=0;return 0!==e.messageId?(r=4,t=new ArrayBuffer(18+r+e.data.length),i=new Uint8Array(t),(a=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(18+r+e.data.length),i=new Uint8Array(t),a=new DataView(t)),a.setInt8(0+r,n.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG),a.setInt16(1+r,e.width),a.setInt16(3+r,e.height),a.setInt16(5+r,e.x),a.setInt16(7+r,e.y),a.setInt8(9+r,e.imageType),0===e.length?a.setInt32(10+r,e.data.length):a.setInt32(10+r,e.length),a.setInt32(14+r,0),i.set(e.data,18+r),t},_encodeEndFrame:function(e){var t,i,a=0;return 0!==e.messageId?(a=4,t=new ArrayBuffer(1+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(1+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.END_TAG),t},_getCurrentTimeStamp:function(e){e=this._longToByteArray(e);return e.reverse(),e},_longToByteArray:function(e){for(var t=[0,0,0,0,0,0,0,0],i=0;i<t.length;i++){var a=255&e;e=(e-(t[i]=a))/256}return t}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSScreenSharingTagTypes={START_TAG:0,BLOCK_TAG:1,CURSOR_TAG:2,END_TAG:3,ACK_TAG:4}}(),function(){"use strict";AvayaClientServices.Providers.WCS.WCSSharingTag=function(e){this.type=e,this.messageId=0}}(),function(s){"use strict";function e(){this._parsers={},this._ackPackageSize=5}e.prototype={parse:function(e){var t,i,a,r={};return 0<e.byteLength?(i=new s.Providers.WCS.ByteArray(e),e.byteLength===this._ackPackageSize&&(r.id=i.readInt()),e=(a=i.readByte())>>4,a=15&a,r.byteArray=i,this._parsers[e]&&this._parsers[e][a]&&(t=this._parsers[e][a].parse(r))):s.Base.Logger.warn(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Buffer length = 0. Parse process skipped."),t},registerParser:function(e,t,i){this._parsers[e]||(this._parsers[e]={}),this._parsers[e][t]=i}},s.Providers.WCS.WCSBinaryParser=e}(AvayaClientServices),function(a){"use strict";function e(e){this._frameBuilder=e,this._lastPoint=T,this._timeout=T,this._isKeyFrameArrived=!1}e.prototype={updateFrame:function(i,e){this._frameBuilder.processTag(e,function(e){var t=e._bitmapElements.map(function(e){return new a.Services.Collaboration.Bitmap(e.x,e.y,e.width,e.height,e.imageType,e.bitmapData)}),e=new a.Services.Collaboration.Frame(e.width,e.height,t,e.isKeyFrame);e.isKeyFrame()?(this._isKeyFrameArrived=!0,i._contentSharing._onFrameReceivedCallbacks.fire(i._contentSharing,e)):this._isKeyFrameArrived?i._contentSharing._onFrameChangedCallbacks.fire(i._contentSharing,e):a.Base.Logger.warn(a.Base.LoggerTags.WCS_CONTENT_SHARING_HANDLER,"A normal frame has arrived before the key frame")}.bind(this))},updateCursor:function(e,t){this._lastPoint=new a.Services.Collaboration.Point(t.x,t.y),this._timeout||(this._timeout=setTimeout(function(){e._contentSharing._onCursorReceivedCallbacks.fire(e._contentSharing,this._lastPoint),this._timeout=T}.bind(this),100))},startScreenSharing:function(e,t){var i=this._getParticipant(e,t),t=e._contentSharing._contentSharingService._sharingState;e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.SHARING,!0===e._contentSharing._isPaused&&t!==a.Services.Collaboration.ContentSharingState.NOT_SHARING?(e._contentSharing._isPaused=!1,e._contentSharing._onContentSharingResumedCallbacks.fire(e._contentSharing,i)):(e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.SHARING,e._contentSharing._onContentSharingStartedCallbacks.fire(e._contentSharing,i))},pauseScreenSharing:function(e,t){e._contentSharing._isPaused=!0;t=this._getParticipant(e,t);e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.PAUSED,e._contentSharing._onContentSharingPausedCallbacks.fire(e._contentSharing,t)},endScreenSharing:function(e,t){this._isKeyFrameArrived=!1;t=this._getParticipant(e,t);e._contentSharing._isPaused=!1,e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.NOT_SHARING,e._contentSharing._onContentSharingEndedCallbacks.fire(e._contentSharing,t)},endScreenSharingByParticipant:function(e,t){this._isKeyFrameArrived=!1,e._contentSharing._isPaused=!1,e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.NOT_SHARING,e._contentSharing._onContentSharingEndedCallbacks.fire(e._contentSharing,t)},startVideoSharing:function(e,t){t=this._getParticipant(e,t);e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.SHARING,e._contentSharing._onScreenSharingUsingVideoStartedCallbacks.fire(e._contentSharing,t)},endVideoSharing:function(e,t){var i=this._getParticipant(e,t);this.endVideoSharingByParticipant(e,i,t.isServerInitiated())},endVideoSharingByParticipant:function(e,t,i){e._contentSharing._contentSharingService.isScreenSharingUsingVideo()?e._contentSharing._contentSharingService._sharingState=a.Services.Collaboration.ContentSharingState.NOT_SHARING:t.isLocalUser()&&e._contentSharing._contentSharingService.stopScreenSharingUsingVideo(e._contentSharing,!1),e._contentSharing._onScreenSharingUsingVideoEndedCallbacks.fire(e._contentSharing,t,i)},frameReport:function(e,t){e._contentSharing._onFrameReportReceivedCallbacks.fire(e._contentSharing,t)},_getParticipant:function(e,t){var i=e._participants.filter(function(e){return e.getParticipantId()===t.senderId})[0];return i||(i=new a.Services.Collaboration.Participant(t.senderId,t.senderName),e._participants.push(i)),i}},a.Providers.WCS.WCSContentSharingHandler=e}(AvayaClientServices),function(s,n){"use strict";function e(){this.parsers=[],this.optimizer=new s.Providers.WCS.LiveEventQueueOptimizer}e.prototype={register:function(e,t){this.parsers[e]=t},unregister:function(e){this.parsers[e]=T},parse:function(e){"string"==typeof e?r=n.parseString(e):"object"==typeof e&&(r=e);var t=r.response[0],i=[],e=[];if(t.error){var a=s.Providers.WCS.WCSEventTypes.ERROR,r=t.error[0];return i.push(this.delegateParser(a,r)),i}if(t.live_events)return t.live_events[0]&&t.live_events[0].event&&(S.each(t.live_events[0].event,function(e,t){a=t._attr.type._value;t=this.delegateParser(a,t);t!==T&&i.push(t)}.bind(this)),e=this.optimizer.getOptimizedQueue(i)),e;if(t.live_event||t.live_ping)return[];if(t.live_session)return a=s.Providers.WCS.WCSEventTypes.LIVE_SESSION,i.push(this.delegateParser(a,t.live_session[0])),i;if(t.frame_report)return a=s.Providers.WCS.WCSEventTypes.FRAME_REPORT,i.push(this.delegateParser(a,t.frame_report[0])),i;if(t.live_viewer)return a=s.Providers.WCS.WCSEventTypes.LIVE_VIEWER,i.push(this.delegateParser(a,t.live_viewer[0])),i;if(t.live_capabilities)return a=s.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,i.push(this.delegateParser(a,t.live_capabilities[0])),i;if(t.live_attendees)return a=s.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,i.push(this.delegateParser(a,t.live_attendees[0])),i;throw new Error("No parser specified!")},delegateParser:function(e,t){if(this.parsers[e]!==T)return this.parsers[e].parse(t);s.Base.Logger.error(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"No parser specified!",e)}},s.Providers.WCS.WCSEventsParser=e}(AvayaClientServices,xmlToJSON),function(){"use strict";AvayaClientServices.Providers.WCS.WCSEventTypes={START_WHITEBOARD:"StartWhiteboard",ADD_WHITEBOARD:"AddWhiteboard",DELETE_WHITEBOARD:"DeleteWhiteboard",START_DRAW_SHAPE:"StartDrawShape",DRAW_SHAPE:"DrawShape",END_DRAW_SHAPE:"EndDrawShape",DRAW_CIRCLE:"DrawCircle",DRAW_TEXT:"DrawText",MOVE_SELECTION:"MoveSelection",DELETE_SELECTION:"DeleteSelection",CLEAR_DRAWING:"ClearDrawing",END_WHITEBOARD:"EndWhiteboard",SEND_SLIDE:"SendSlide",END_PRESENTATION:"EndPresentation",SEND_MESSAGE:"SendMessage",ADD_NOTE:"AddNote",SET_NOTE:"SetNote",DELETE_NOTE:"DeleteNote",START_SCREEN_SHARING:"StartScreenSharing",PAUSE_SCREEN_SHARING:"PauseScreenSharing",END_SCREEN_SHARING:"EndScreenSharing",REQUEST_CONTROL:"RequestControl",GRANT_CONTROL:"GrantControl",START_CONTROL:"StartControl",DECLINE_CONTROL:"DeclineControl",DENY_CONTROL:"DenyControl",SEND_DOCUMENT:"SendDocument",END_CONTROL:"EndControl",ALLOW_PRESENTING:"AllowPresenting",DENY_PRESENTING:"DenyPresenting",EJECT_PARTICIPANT:"EjectParticipant",START_MEETING:"StartMeeting",END_MEETING:"EndMeeting",DRAW_CURSOR:"DrawCursor",DRAW_FRAME:"DrawFrame",LIVE_VIEWER:"LiveViewer",FRAME_REPORT:"FrameReport",START_VIDEO_SHARING:"StartVideoSharing",END_VIDEO_SHARING:"EndVideoSharing",ERROR:"Error",LIVE_SESSION:"LiveSession",LIVE_ATTENDEES:"LiveAttendees",LIVE_ATTENDEE:"LiveAttendee",LIVE_CAPABILITIES:"LiveCapabilities",SERVER_CAPABILITIES:"ServerCapabilities",SLIDER_SLIDE:"SliderSlide",SLIDER_EMPTY:"SliderEmpty"}}(),function(o){"use strict";function e(){this._config=T,this._participant=T,this._meetingId=T}e.prototype={buildDrawCircleMessage:function(e,t,i,a,r){t=this._buildDrawCircleEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,i,a,r,t)},buildResourceDiscoveryMessage:function(e,t,i,a,r){return{mode:e,meeting_id:t,participant_id:i,username:a,token:r}},buildMoveSelectionMessage:function(e,t,i,a,r,s,n){a=this._buildMoveSelectionEventData(e,t,i,a);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.MOVE_SELECTION,r,s,n,a)},buildDrawShapeMessage:function(e,t,i,a,r){t=this._buildDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,i,a,r,t)},buildLiveDrawShapeMessage:function(e,t,i,a,r){t=this._buildLiveDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,i,a,r,t)},buildFirstPointLiveDrawShapeMessage:function(e,t,i,a){e=this._buildFirstPointLiveDrawShapeEventData(e);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,t,i,a,e)},buildStartDrawShapeMessage:function(e,t,i,a,r){t=this._buildStartDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,i,a,r,t)},buildEndDrawShapeMessage:function(e,t,i,a,r){t=this._buildEndDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,i,a,r,t)},buildDrawTextMessage:function(e,t,i,a,r){t=this._buildDrawTextEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_TEXT,i,a,r,t)},buildAddWhiteboardMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,e,t,i)},buildEndWhiteboardMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_WHITEBOARD,e,t,i)},buildRemoveWhiteboardMessage:function(e,t,i,a){e='<whiteboard index="'+e+'"/>';return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,t,i,a,e)},buildStartWhiteboardMessage:function(e,t,i,a){var r='<whiteboard index="';return o.Base.Utils.isDefined(a)&&(r+=a),r+='"/>',this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_WHITEBOARD,e,t,i,r)},buildLiveEventMessage:function(e,t,i,a){return this._decorateRequest(e,t,i,a)},buildStartScreenSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,e,t,i,"<transport_version>1</transport_version>")},buildStopScreenSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,e,t,i)},buildPauseScreenSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,e,t,i)},buildStartVideoSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,e,t,i)},buildStopVideoSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,e,t,i)},buildClearContentMessage:function(e,t,i,a){e='<selection group="whiteboard_'+e+'"/>';return this._decorateRequest(o.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,t,i,a,e)},buildGetParticipantsMessage:function(e){return"live_attendees?rc_only="+!!e+"&request_id="+o.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},buildMaxDownloadMessage:function(e){return"live_capabilities?max_download_bandwidth="+e+"&request_id="+o.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},_buildMoveSelectionEventData:function(e,t,i,a){var r=e.getTranslation();return'<selection group="whiteboard_'+t+'" id="'+e.getId()+'" moveToX="'+r.getX()+'" moveToY="'+r.getY()+'" selectionX="'+i+'" selectionY="'+a+'"/>'},buildDeleteSelectionMessage:function(e,t,i,a,r,s,n){a=this._buildDeleteSelectionEventData(e,t,i,a);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DELETE_SELECTION,r,s,n,a)},buildPauseMessage:function(){return"live_capabilities?sharing_reception=false&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef")},buildResumeMessage:function(){return"live_capabilities?sharing_reception=true&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef")},_buildDeleteSelectionEventData:function(e,t,i,a){return'<selection group="whiteboard_'+t+'" id="'+e._id+'" selectionX="'+i+'" selectionY="'+a+'"/>'},_buildDrawCircleEventData:function(e,t){t='<circle alpha="'+e.getAlpha()+'" group="whiteboard_'+t+'" x0="'+e.getTopLeft().getX()+'" x1="'+e.getBottomRight().getX()+'" y0="'+e.getTopLeft().getY()+'" y1="'+e.getBottomRight().getY()+'"';return e.isFilled()?t+=' fillColor="'+e.getColor()+'"':t+=' color="'+e.getColor()+'"',t=t+' width="'+e.getWidth()+'" />'},_buildDrawShapeEventData:function(e,t){var i='<lines group="whiteboard_'+t+'" alpha="'+e.getAlpha()+'" width="'+e.getWidth()+'"';e.isFilled()?i+=' fillColor="'+e.getColor()+'"':i+=' color="'+e.getColor()+'"',i+=">";for(var a=0,r=e.getPoints();a<r.length;a++){var s=r[a];s.isMove?i+='<m x="'+s.point.getX()+'" y="'+s.point.getY()+'"/>':i+='<l x="'+s.point.getX()+'" y="'+s.point.getY()+'"/>'}return i+="</lines>"},_buildFirstPointLiveDrawShapeEventData:function(e){return'<m x="'+e.getX()+'" y="'+e.getY()+'"/>'},_buildLiveDrawShapeEventData:function(e,t){var i="",a=0;for(e[0].isMove&&(a=1,i+='<m x="'+e[0].point.getX()+'" y="'+e[0].point.getY()+'"/>'),i+='<lines group="whiteboard_'+t+'">';a<e.length;a++){var r=e[a];r.isMove?i+='<m x="'+r.point.getX()+'" y="'+r.point.getY()+'"/>':i+='<l x="'+r.point.getX()+'" y="'+r.point.getY()+'"/>'}return i+="</lines>"},_buildStartDrawShapeEventData:function(e,t){t='<lines group="whiteboard_'+t+'" alpha="'+e.getAlpha()+'" width="'+e.getWidth()+'"';return e.isFilled()?t+=' fillColor="'+e.getColor()+'"':t+=' color="'+e.getColor()+'"',t+="/>"},_buildEndDrawShapeEventData:function(e,t){return'<lines group="whiteboard_'+t+'"/>'},_buildDrawTextEventData:function(e,t){return'<drawText fillColor="'+e.getColor()+'" fontSize="'+e.getFontSize()+'" group="whiteboard_'+t+'" text="'+this._escapeXMLSpecialChars(e.getContent())+'" x="'+e.getPosition().getX()+'" y="'+e.getPosition().getY()+'"/>'},_translateColor:function(e){return parseInt("0x".concat(e.slice(1))).toString()},_decorateRequest:function(e,t,i,a,r){return"live_event"+(r?"?event_data="+encodeURIComponent(r)+"&":"?")+"event_type="+e+"&meeting_id="+t+"&sender_id="+i+"&sender_name="+encodeURIComponent(a)+"&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef")},_escapeXMLSpecialChars:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"&#xA;")}},o.Providers.WCS.WCSMessageBuilder=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.CollaborationProvider.call(this),this._providers=[],this._selectedProvider=T,this._config={}}(t.prototype=Object.create(e.Providers.Interfaces.CollaborationProvider.prototype)).stop=function(){return e.Base.Utils.isDefined(this._selectedProvider)?this._selectedProvider.stop():S.Deferred().resolve().promise()},t.prototype.registerWCSProvider=function(e,t){this._providers.push({version:e,provider:t})},t.prototype.start=function(e,t){return S.isEmptyObject(e)||this._config===e||(this._config=e.wcsConfiguration),this._selectedProvider=this._providers[0].provider,this._selectedProvider.start(e.wcsConfiguration,t)},t.prototype.on=function(e,t){this._selectedProvider.on(e,t)},t.prototype.off=function(e,t){this._selectedProvider.off(e,t)},t.prototype.getReceivingBitrate=function(){return this._selectedProvider.getReceivingBitrate()},t.prototype.getBufferedAmount=function(){return this._selectedProvider.getBufferedAmount()},t.prototype.addCircle=function(e,t){return this._selectedProvider.addCircle(e,t)},t.prototype.pause=function(){return this._selectedProvider.pause()},t.prototype.resume=function(){return this._selectedProvider.resume()},t.prototype.addText=function(e,t){return this._selectedProvider.addText(e,t)},t.prototype.addShape=function(e,t){return this._selectedProvider.addShape(e,t)},t.prototype.discoverResources=function(e){return this._selectedProvider.discoverResources(e)},t.prototype.startDrawShape=function(e,t){return this._selectedProvider.startDrawShape(e,t)},t.prototype.liveDrawShape=function(e,t){return this._selectedProvider.liveDrawShape(e,t)},t.prototype.endDrawShape=function(e,t){return this._selectedProvider.endDrawShape(e,t)},t.prototype.moveSelection=function(e,t,i){return this._selectedProvider.moveSelection(e,t,i)},t.prototype.observeCollaboration=function(e){this._selectedProvider.observeCollaboration(e)},t.prototype.startWhiteboard=function(e){return this._selectedProvider.startWhiteboard(e)},t.prototype.endWhiteboard=function(e){return this._selectedProvider.endWhiteboard(e)},t.prototype.addWhiteboardSurface=function(){return this._selectedProvider.addWhiteboardSurface()},t.prototype.removeWhiteboardSurface=function(e){return this._selectedProvider.removeWhiteboardSurface(e)},t.prototype.sendBlocks=function(e,t){return this._selectedProvider.sendBlocks(e,t)},t.prototype.startScreenSharing=function(){return this._selectedProvider.startScreenSharing()},t.prototype.stopScreenSharing=function(){return this._selectedProvider.stopScreenSharing()},t.prototype.startVideoSharing=function(){return this._selectedProvider.startVideoSharing()},t.prototype.stopVideoSharing=function(){return this._selectedProvider.stopVideoSharing()},t.prototype.pauseScreenSharing=function(){return this._selectedProvider.pauseScreenSharing()},t.prototype.sendLiveEvent=function(e){return this._selectedProvider.sendLiveEvent(e)},t.prototype.removeShape=function(e,t,i){return this._selectedProvider.removeShape(e,t,i)},t.prototype.clearContent=function(e){return this._selectedProvider.clearContent(e)},t.prototype.getParticipants=function(){return this._selectedProvider.getParticipants()},t.prototype.isOpened=function(){return this._selectedProvider&&this._selectedProvider.isOpened()},t.prototype.isFeatureAvailable=function(e){return this._selectedProvider&&this._selectedProvider.isFeatureAvailable(e)},t.prototype.run=function(e){return this._selectedProvider.run(e)},t.prototype.getServerCapabilities=function(){return this._selectedProvider.getServerCapabilities()},t.prototype.isWhiteboardActive=function(){return this._selectedProvider.isWhiteboardActive()},t.prototype.getAcksActivated=function(){return this._selectedProvider.getAcksActivated()},e.Providers.WCS.WCSProvider=t}(AvayaClientServices),function(l){"use strict";function e(){this._collaborationProvider={}}e.prototype={getWCSProvider:function(e){if(l.Base.Utils.isDefined(e)&&e.enabled)return S.isEmptyObject(this._collaborationProvider)&&(e=this._createWCSv1_1Provider(),this._collaborationProvider=new l.Providers.WCS.WCSProvider,this._collaborationProvider.registerWCSProvider("1.1",e)),this._collaborationProvider},_createWCSv1_1Provider:function(){var e=new l.Base.RESTProvider,t=new l.Base.NetworkProvider(e,T,l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),i=new l.Providers.WCS.CometParser,a=new l.Providers.WCS.WCSCometProvider(i),r=new l.Providers.WCS.WCSTransactionalWebSocketProvider,s=new l.Base.NetworkProvider(r,a,l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),n=this._createEventsParser(),o=this._createBinaryParser(),c=new l.Providers.WCS.FrameBuilder,e=new l.Providers.WCS.WCSMessageBuilder,i=new l.Providers.WCS.WCSContentSharingHandler(c),r=new l.Providers.WCS.WCSShapeConverter,a=new l.Providers.WCS.WCSWhiteboardHandler(r),c=new l.Services.Analytics.CollaborationsAnalyticsService,r=new l.Providers.WCS.WCSSliderHandler;return new l.Providers.WCS.WCSv1_1Provider(t,n,o,e,i,a,r,s,c)},_createEventsParser:function(){var e=new l.Providers.WCS.WCSEventsParser;return e.register(l.Providers.WCS.WCSEventTypes.ERROR,new l.Providers.WCS.ErrorParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_SESSION,new l.Providers.WCS.LiveSessionParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_VIEWER,new l.Providers.WCS.LiveViewerParser),e.register(l.Providers.WCS.WCSEventTypes.SEND_MESSAGE,new l.Providers.WCS.SendMessageParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_SHAPE,new l.Providers.WCS.DrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,new l.Providers.WCS.DrawCircleParser),e.register(l.Providers.WCS.WCSEventTypes.MOVE_SELECTION,new l.Providers.WCS.MoveSelectionParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_SELECTION,new l.Providers.WCS.DeleteSelectionParser),e.register(l.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,new l.Providers.WCS.ClearDrawingParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_TEXT,new l.Providers.WCS.DrawTextParser),e.register(l.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,new l.Providers.WCS.StartDrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,new l.Providers.WCS.EndDrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.START_WHITEBOARD,new l.Providers.WCS.StartWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,new l.Providers.WCS.AddWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,new l.Providers.WCS.DeleteWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.END_WHITEBOARD,new l.Providers.WCS.EndWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.START_MEETING,new l.Providers.WCS.StartMeetingParser),e.register(l.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,new l.Providers.WCS.StartScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,new l.Providers.WCS.StartVideoSharingParser),e.register(l.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,new l.Providers.WCS.PauseScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,new l.Providers.WCS.EndScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,new l.Providers.WCS.EndVideoSharingParser),e.register(l.Providers.WCS.WCSEventTypes.GRANT_CONTROL,new l.Providers.WCS.GrantControlParser),e.register(l.Providers.WCS.WCSEventTypes.ADD_NOTE,new l.Providers.WCS.AddNoteParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_NOTE,new l.Providers.WCS.DeleteNoteParser),e.register(l.Providers.WCS.WCSEventTypes.SET_NOTE,new l.Providers.WCS.SetNoteParser),e.register(l.Providers.WCS.WCSEventTypes.DENY_CONTROL,new l.Providers.WCS.DenyControlParser),e.register(l.Providers.WCS.WCSEventTypes.END_CONTROL,new l.Providers.WCS.EndControlParser),e.register(l.Providers.WCS.WCSEventTypes.END_MEETING,new l.Providers.WCS.EndMeetingParser),e.register(l.Providers.WCS.WCSEventTypes.SEND_DOCUMENT,new l.Providers.WCS.SendDocumentParser),e.register(l.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING,new l.Providers.WCS.AllowPresentingParser),e.register(l.Providers.WCS.WCSEventTypes.DENY_PRESENTING,new l.Providers.WCS.DenyPresentingParser),e.register(l.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT,new l.Providers.WCS.EjectParticipantParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,new l.Providers.WCS.LiveAttendeesParser),e.register(l.Providers.WCS.WCSEventTypes.FRAME_REPORT,new l.Providers.WCS.FrameReportParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,new l.Providers.WCS.LiveCapabilitiesParser),e.register(l.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES,new l.Providers.WCS.ServerCapabilitiesParser),e.register(l.Providers.WCS.WCSEventTypes.SLIDER_SLIDE,new l.Providers.WCS.SliderSlideParser),e.register(l.Providers.WCS.WCSEventTypes.SLIDER_EMPTY,new l.Providers.WCS.SliderEmptyParser),e},_createBinaryParser:function(){var e=new l.Providers.WCS.WCSBinaryParser;return e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.START_TAG,new l.Providers.WCS.StartTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG,new l.Providers.WCS.BlockTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG,new l.Providers.WCS.CursorTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.END_TAG,new l.Providers.WCS.EndTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG,new l.Providers.WCS.AcknowledgementTagBinaryParser),e}},l.Providers.WCS.WCSProviderFactory=e}(AvayaClientServices),function(d){"use strict";function e(){}e.prototype={convertShape:function(e,t){var i=this._determineColor(e.data),a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=e.data.alpha,t=e.data.width,o=new d.Services.Collaboration.Shape(a,r,s,i,n,t);if(o.setId(e.liveEventCommonData.eventId),d.Base.Utils.isDefined(e.data.m))for(var c=0;c<e.data.m.length;c++)o.addMovePoint(new d.Services.Collaboration.Point(e.data.m[c].x,e.data.m[c].y));if(d.Base.Utils.isDefined(e.data.l))for(var l=0;l<e.data.l.length;l++)o.addLinePoint(new d.Services.Collaboration.Point(e.data.l[l].x,e.data.l[l].y));return o},convertLiveShape:function(e,t){var i=e.liveEventCommonData.fromname,a=e.liveEventCommonData.senderId===t,r=this._convertColor(e.data.color),s=e.data.alpha,t=e.data.width,t=new d.Services.Collaboration.Shape(i,!1,a,r,s,t);return t.setId(e.liveEventCommonData.eventId),t},convertText:function(e,t){var i=e.data.text,a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=this._convertColor(e.data.fillColor),t=e.data.fontSize,n=new d.Services.Collaboration.WhiteboardText(i,t,a,r,s,n,void 0);return n.setId(e.liveEventCommonData.eventId),n.setPosition(new d.Services.Collaboration.Point(e.data.x,e.data.y)),n},convertCircle:function(e,t){var i=this._determineColor(e.data),a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=e.data.width,o=e.data.alpha,t=this._calculatePoints(e.data),n=new d.Services.Collaboration.Circle(t.topLeft,t.bottomRight,a,r,s,i,o,n);return n.setId(e.liveEventCommonData.eventId),n},_determineColor:function(e){return e.filled&&e.fillColor?this._convertColor(e.fillColor):e.contour&&e.color?this._convertColor(e.color):void 0},_convertColor:function(e){return 0===e.indexOf("#")?parseInt(e.slice(1),16):parseInt(e,16)},_calculatePoints:function(e){var t,e=e.x0<e.x1&&e.y0<e.y1?(t=new d.Services.Collaboration.Point(e.x0,e.y0),new d.Services.Collaboration.Point(e.x1,e.y1)):e.x0>=e.x1&&e.y0>=e.y1?(t=new d.Services.Collaboration.Point(e.x1,e.y1),new d.Services.Collaboration.Point(e.x0,e.y0)):e.x0<e.x1&&e.y0>=e.y1?(t=new d.Services.Collaboration.Point(e.x0,e.y1),new d.Services.Collaboration.Point(e.x1,e.y0)):(t=new d.Services.Collaboration.Point(e.x1,e.y0),new d.Services.Collaboration.Point(e.x0,e.y1));return{topLeft:t,bottomRight:e}}},d.Providers.WCS.WCSShapeConverter=e}(AvayaClientServices),function(n){"use strict";function e(){}e.prototype={handleSliderSlide:function(e,t){n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderSlide");var i=e.getSlider(),a=e._config.wcsConfiguration.networkProviderConfiguration.restConfig,r=i.getSlides().length+1,s=a.getUrl(!1)+t.data.slideURL,a=a.getUrl(!1)+t.data.thumbUrl,t=new Date(t.liveEventCommonData.time),t=new n.Services.Collaboration.SliderSlide(r,s,a,t);i._addSlides(t),i._onSlidesAddedCallbacks.fire(t),e._recalculateSliderCapability()},handleSliderEmpty:function(e,t){n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderEmpty");var i=e.getSlider(),a=i.getSlides();i._removeSlides(),i._onSlidesRemovedCallbacks.fire(a),e._recalculateSliderCapability()}},n.Providers.WCS.WCSSliderHandler=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSTransmissionTypes={SCREEN_SHARING:0,SLIDE_SHARING:2}}(),function(o){"use strict";function e(e){this._shapeConverter=e}e.prototype={addWhiteboard:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"addWhiteboard");var i,a,r=e.getWhiteboard(),s=r.getSurfaceById(t.liveEventCommonData.eventId);o.Base.Utils.isDefined(s)?this.startWhiteboard(e,t):(i=this._createNewSurface(r,t.liveEventCommonData.eventId),a=r.getActiveSurface(),s=this._getParticipant(e,t),o.Base.Utils.isDefined(a)&&(a._active=!1),i._active=!0,r._activeSurface=i,r._onWhiteboardSurfaceAddedCallbacks.fire(t,i,s),r._onWhiteboardSurfaceSetActiveCallbacks.fire(r,i,s),r._recalculateRemoveWhiteboardCapability(e),r._recalculateAddWhiteboardCapability(e))},startWhiteboard:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startWhiteboard");var i,a=t.data&&t.data.id?t.data.id:t.liveEventCommonData.eventId,r=e.getWhiteboard(),s=r.getSurfaceById(a),n=r.getActiveSurface()||r._recentlyActiveSurface,a=this._getParticipant(e,t);o.Base.Utils.isDefined(n)&&(n._active=!1),o.Base.Utils.isDefined(s)?(s._active=!0,r._activeSurface=s,r._onWhiteboardSurfaceSetActiveCallbacks.fire(r,s,a)):((i=this._createNewSurface(r,t.liveEventCommonData.eventId))._active=!0,r._activeSurface=i,r._onWhiteboardSurfaceAddedCallbacks.fire(r,i,a),r._onWhiteboardSurfaceSetActiveCallbacks.fire(r,i,a)),r._onWhiteboardStartedCallbacks.fire(r,i,a),r._recalculateRemoveWhiteboardCapability(e),r._recalculateAddWhiteboardCapability(e)},endWhiteboard:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endWhiteboard");var i=e.getWhiteboard(),t=this._getParticipant(e,t);i._recentlyActiveSurface=i._activeSurface,i._activeSurface=T,i._onWhiteboardEndedCallbacks.fire(i,t),i._recalculateRemoveWhiteboardCapability(e),i._recalculateAddWhiteboardCapability(e)},deleteWhiteboard:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteWhiteboard");var i,a=e.getWhiteboard(),r=a.getSurfaceById(t.data.id),s=this._getParticipant(e,t);r&&((i=r).isActive()&&(a._activeSurface=this._chooseNewActiveSurface(a,t.data.id)),-1<(r=a.getSurfaces().indexOf(r))&&a.getSurfaces().splice(r,1),a._onWhiteboardSurfaceRemovedCallbacks.fire(a,i,s),a._onWhiteboardSurfaceSetActiveCallbacks.fire(a,a.getActiveSurface(),s)),a._recalculateRemoveWhiteboardCapability(e)},startDrawShape:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startDrawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);a&&((e=this._shapeConverter.convertLiveShape(t,e._selfParticipant.getParticipantId()))._tempId=t.liveEventCommonData.eventId,a._appendShape(t.liveEventCommonData.eventId,e),i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId]=t.data.groupId,i._currentLiveDrawingShapes[t.liveEventCommonData.senderId]=e,a._onShapeAddedCallbacks.fire(a,e))},drawShape:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);if(o.Base.Utils.isDefined(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])){var r=(a=i.getSurfaceById(i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId]))._getShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),s=t.liveEventCommonData.senderId===e._selfParticipant.getParticipantId();if(r&&!s){if(0<t.data.m.length&&i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].addMovePoint(new o.Services.Collaboration.Point(t.data.m[0].x,t.data.m[0].y)),0<t.data.l.length)for(var n=0;n<t.data.l.length;n++)i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].addLinePoint(new o.Services.Collaboration.Point(t.data.l[n].x,t.data.l[n].y));a._onShapeUpdatedCallbacks.fire(a,i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])}}else o.Base.Utils.isDefined(a)&&(e=this._shapeConverter.convertShape(t,e._selfParticipant.getParticipantId()),a._appendShape(t.liveEventCommonData.eventId,e),a._onShapeAddedCallbacks.fire(a,e))},endDrawShape:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endDrawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);a&&i._currentLiveDrawingShapes[t.liveEventCommonData.senderId]&&(e=a._getShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),a._removeShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),e.setId(t.liveEventCommonData.eventId),a._appendShape(t.liveEventCommonData.eventId,e),a._onShapeUpdatedCallbacks.fire(a,e),e._tempId=t.liveEventCommonData.eventId,delete i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId],i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].finishDrawing(),delete i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])},drawCircle:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawCircle");var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&(e=this._shapeConverter.convertCircle(t,e._selfParticipant.getParticipantId()),i._appendShape(t.liveEventCommonData.eventId,e),i._onShapeAddedCallbacks.fire(i,e))},drawText:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawText");var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&(e=this._shapeConverter.convertText(t,e._selfParticipant.getParticipantId()),i._appendShape(t.liveEventCommonData.eventId,e),i._onShapeAddedCallbacks.fire(i,e))},clearDrawing:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"clearDrawing");t=e.getWhiteboard().getSurfaceById(t.data.groupId);t&&(t._clearShapes(),t._onSurfaceClearedCallbacks.fire(t))},moveSelection:function(e,t){var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&((e=i._getShapeById(t.data.shapeId)).setTranslation(new o.Services.Collaboration.Point(t.data.moveToX,t.data.moveToY)),i._onShapeUpdatedCallbacks.fire(i,e))},deleteSelection:function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteSelection");e=e.getWhiteboard().getSurfaceById(t.data.groupId);!e||(t=e._getShapeById(t.data.shapeId))&&(e._onShapeDeletedCallbacks.fire(e,t),e._removeShapeById(t.getId()))},_createNewSurface:function(e,t){var i=new o.Services.Collaboration.WhiteboardSurface(e,e._whiteboardService);return e.getSurfaces().push(i),i._surfaceId=t,i},_chooseNewActiveSurface:function(e,t){var i=e.getSurfaces(),t=e.getSurfaceById(t),t=i.indexOf(t);return o.Base.Utils.isDefined(e.getActiveSurface())&&(e.getActiveSurface()._active=!1),0===t?1<i.length?(i[1]._active=!0,i[1]):(i[0]._active=!0,i[0]):(i[t-1]._active=!0,i[t-1])},_getParticipant:function(e,t){var i=(t.liveEventCommonData||t).senderId,a=(t.liveEventCommonData||t).senderName,t=e._participants.filter(function(e){return e.getParticipantId()===i})[0];return t||(t=new o.Services.Collaboration.Participant(i,a),e._participants.push(t)),t}},o.Providers.WCS.WCSWhiteboardHandler=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Analytics.AnalyticsErrorCode={NOTIFICATION_ERROR:"Notification failed",UNAUTHORIZED:"Unauthorized status",NETWORK_ERROR:"Network Error",MESSAGE_SENDING_ERROR:"Message sending error",CONNECTION_BACKOFF_ALGORITHM_ERROR:"connection Backoff Algorithm error",GETTING_CONVERSATIONS_ERROR:"Getting conversations error",SEARCHING_CONVERSATIONS_ERROR:"Searching conversations error",STARTING_COLLABORATION_ERROR:"Starting Collaboration is error",HOLD_CALL_ERROR:"Hold call error",TRANSFER_CALL_ERROR:"Transfer call error",ATTENDED_TRANSFER_CALL_ERROR:"Attended transfer call error",JOIN_CALL_ERROR:"Join call error",STARTING_CALL_ERROR:"Starting call is error",STOPPING_CALL_ERROR:"Stopping call is error",GETTING_CALL_STATISTICS_ERROR:"Getting call statistics error",SETTING_VIDEO_MODE_ERROR:"Setting video mode error",DENY_SEND_VIDEO_ERROR:"Deny send video error",ACCEPT_SEND_VIDEO_ERROR:"Accept send video error",MUTE_AUDIO_ERROR:"Mute audio error",UNMUTE_AUDIO_ERROR:"Unmute audio error",MUTE_VIDEO_ERROR:"Mute video error",UNMUTE_VIDEO_ERROR:"Unmute video error",MUTE_SPEAKER_ERROR:"Mute speaker error",UNMUTE_SPEAKER_ERROR:"Unmute speaker error",ACCEPT_CALL_ERROR:"accept call error",MEDIA_PRESERVED_ERROR:"Media preserved error",SEND_DTMF_ERROR:"send dtmf error",WEBRTC_NOT_SUPPORTED:"WebRTC not supported",NO_CALL_WAS_CREATED_ERROR:"No call was created"}}(),function(){"use strict";AvayaClientServices.Services.Call.AlertType={AUTO_CALLBACK:"AUTO_CALLBACK",AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL",AUTOMATIC_CALL_DISTRIBUTION_INTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_INTERNAL",DIRECT_AGENT_CALL_EXTERNAL:"DIRECT_AGENT_CALL_EXTERNAL",DIRECT_AGENT_CALL_INTERNAL:"DIRECT_AGENT_CALL_INTERNAL",DIRECT_AGENT_CALL_PRIORITY:"DIRECT_AGENT_CALL_PRIORITY",EXTERNAL:"EXTERNAL",HOLD_RECALL:"HOLD_RECALL",INTERCOM:"INTERCOM",INTERNAL:"INTERNAL",NONE:"NONE",PRIORITY:"PRIORITY",TRANSFER_RECALL:"TRANSFER_RECALL",UNSPECIFIED:"UNSPECIFIED"}}(),function(e){"use strict";function t(){this._requestedDirection=T,this._negotiatedDirection=T}t.prototype={getRequestedDirection:function(){return this._requestedDirection},_getNegotiatedDirection:function(){return this._negotiatedDirection},_setRequestedDirection:function(e){this._requestedDirection=e},_setNegotiatedDirection:function(e){this._negotiatedDirection=e}},e.Services.Call.AudioChannel=t}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Services.Call.AudioDetails=function(e){this.bytesTransmitted=e.bytesTransmitted,this.bytesReceived=e.bytesReceived,this.rtcBytesReceived=e.transportBytesReceived,this.packetsTransmitted=e.packetsTransmitted,this.packetsReceived=e.packetsReceived,this.roundTripTimeMilliseconds=e.roundTripTimeMilliseconds,this.packetLossTotalTransmitted=e.packetLossTotalTransmitted,this.packetLossTotalReceived=e.packetLossTotalReceived,this.jitterMillisecondsReceived=e.jitterMillisecondsReceived,this.totalAudioEnergyTransmitted=e.totalAudioEnergyTransmitted,this.totalAudioEnergyReceived=e.totalAudioEnergyReceived,this.audioLevelTransmitted=e.audioLevelTransmitted,this.audioLevelReceived=e.audioLevelReceived,this.codec=e.codec,this.fractionLostLocal=e.fractionLostLocal}}(),function(){"use strict";AvayaClientServices.Services.Call.AudioMode={SEND_RECEIVE:"SEND_RECEIVE",DISABLE:"DISABLE",ENABLE:"ENABLE"}}(),function(a){"use strict";function e(e,t,i){this._remoteAddress=e,this._presentationModeOnly=!!a.Base.Utils.isDefined(t)&&!!t,this._subject=i,this._avayaLineId=T,this._avayaLineOwner=T,this._conferenceID=T,this._conferencePasscode=T,this._portalToken=T,this._meetMeUserName=T,this._serviceGatewayURL=T,this._uccpURL=T,this._callType=a.Services.Call.CallType.CallTypeDefaultRegisteredService,this._authorizationToken=T,this._contextId=T}e.prototype={getRemoteAddress:function(){return this._remoteAddress},isPresentationModeOnly:function(){return a.Base.Utils.isDefined(this._presentationModeOnly)&&!!this._presentationModeOnly},getSubject:function(){return this._subject},getConferenceID:function(){return this._conferenceID},setConferenceID:function(e){this._conferenceID=e},getPasscode:function(){return this._conferencePasscode},setPasscode:function(e){this._conferencePasscode=e},getContextId:function(){return this._contextId},setContextId:function(e){this._contextId=e},getPortalToken:function(){return this._portalToken},setPortalToken:function(e){this._portalToken=e},getMeetMeUserName:function(){return this._meetMeUserName},setMeetMeUserName:function(e){this._meetMeUserName=e},getCallType:function(){return this._callType},setCallType:function(e){this._callType=e},getServiceGatewayURL:function(){return this._serviceGatewayURL},setServiceGatewayURL:function(e){this._serviceGatewayURL=e},setUccpURL:function(e){this._uccpURL=e},getUccpURL:function(){return this._uccpURL},getAvayaLineId:function(){return this._avayaLineId},getAvayaLineOwner:function(){return this._avayaLineOwner},setAuthorizationToken:function(e){this._authorizationToken=e},getAuthorizationToken:function(){return this._authorizationToken}},a.Services.Call.CallCreationInfo=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallDenialReason={BUSY:"BUSY",FORBIDDEN:"FORBIDDEN",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallDetails=function(e,t,i,a,r,s){this.callId=e,this.callingParticipant=t,this.calledParticipant=i,this.participants=a,this.connectionId=r,this.status=s}}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._reason=e,this._reasonProtocol=t,this._reasonCause=i,this._reasonText=a}t.prototype={getReason:function(){return this._reason},getReasonProtocol:function(){return this._reasonProtocol},getReasonCause:function(){return this._reasonCause},getReasonText:function(){return this._reasonText},_setReason:function(e){this._reason=e}},e.Services.Call.CallEndEvent=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallEndReason={CALL_DISCONNECTED:"CALL_DISCONNECTED",CALL_DISCONNECTED_UNKNOWN_REASON:"CALL_DISCONNECTED_UNKNOWN_REASON",CALL_ENDED_LOCALLY:"CALL_ENDED_LOCALLY",DISCONNECTED_BY_CONFERENCE_MODERATOR:"DISCONNECTED_BY_CONFERENCE_MODERATOR",CONFERENCE_TERMINATED:"CONFERENCE_TERMINATED",DTLS_FAILURE:"DTLS_FAILURE",ICE_FAILURE:"ICE_FAILURE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallError={AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTO_HOLD_FAILED:"AUTO_HOLD_FAILED",BUSY:"BUSY",CALL_STATE_MISMATCH:"CALL_STATE_MISMATCH",CALL_NOT_FOUND:"CALL_NOT_FOUND",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CODEC_MISMATCH:"CODEC_MISMATCH",DEVICES_NOT_FOUND:"DEVICES_NOT_FOUND",MICROPHONE_NOT_FOUND:"MICROPHONE_NOT_FOUND",MICROPHONE_PERMISSION_DENIED:"MICROPHONE_PERMISSION_DENIED",MICROPHONE_NOT_ACCESSIBLE:"MICROPHONE_NOT_ACCESSIBLE",SPEAKERS_NOT_FOUND:"SPEAKERS_NOT_FOUND",CAMERA_NOT_FOUND:"CAMERA_NOT_FOUND",CAMERA_PERMISSION_DENIED:"CAMERA_PERMISSION_DENIED",CAMERA_NOT_ACCESSIBLE:"CAMERA_NOT_ACCESSIBLE",FAILED:"FAILED",TCP_TLS_TURN_NOT_SUPPORTED:"TCP_TLS_TURN_NOT_SUPPORTED",ENDED:"ENDED",IN_PROGRESS:"IN_PROGRESS",INTERNAL_ERROR:"INTERNAL_ERROR",INVALID_PARAMETER:"INVALID_PARAMETER",LINE_RESERVATION_ERROR:"LINE_RESERVATION_ERROR",MEDIA_CREATION_FAILURE:"MEDIA_CREATION_FAILURE",MEDIA_START_FAILURE:"MEDIA_START_FAILURE",MULTIPLE_CALLS_NOT_SUPPORTED:"MULTIPLE_CALLS_NOT_SUPPORTED",MEDIA_PATH_FAILURE:"MEDIA_PATH_FAILURE",MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED:"MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED",MUTE_STATE_MISMATCH:"MUTE_STATE_MISMATCH",NO_AVAILABLE_CALL_APPEARANCE:"NO_AVAILABLE_CALL_APPEARANCE",NOT_AUTHORIZED:"NOT_AUTHORIZED",NOT_FOUND:"NOT_FOUND",NOT_LICENSED:"NOT_LICENSED",NOT_REGISTERED:"NOT_REGISTERED",OVERCONSTRAINED:"OVERCONSTRAINED",REDIRECTED:"REDIRECTED",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",REMOTE_CALL_NOT_ALERTING:"REMOTE_CALL_NOT_ALERTING",REMOTE_MEDIA_PROCESSING_FAILURE:"REMOTE_MEDIA_PROCESSING_FAILURE",SEND_ERROR:"SEND_ERROR",SERVER_ERROR:"SERVER_ERROR",SESSION_ID_NOT_FOUND:"SESSION_ID_NOT_FOUND",SESSION_ID_ALREADY_CONNECTED:"SESSION_ID_ALREADY_CONNECTED",SUCCESS:"SUCCESS",TIMEOUT:"TIMEOUT",TRANSPORT_ERROR:"TRANSPORT_ERROR",UNDEFINED:"UNDEFINED",UNHANDLED_VIDEO_DIRECTION:"UNHANDLED_VIDEO_DIRECTION",USER_NOT_FOUND:"USER_NOT_FOUND",USER_TEMPORARILY_UNAVAILABLE:"USER_TEMPORARILY_UNAVAILABLE",VIDEO_DENIED:"VIDEO_DENIED",VIDEO_DEESCALATION_NOT_SUPPORTED:"VIDEO_DEESCALATION_NOT_SUPPORTED",WEBRTC_NOT_SUPPORTED:"WEBRTC_NOT_SUPPORTED",STATISTICS_UNAVAILABLE:"STATISTICS_UNAVAILABLE",MEDIA_PRESERVED:"MEDIA_PRESERVED",SERVICE_TEMPORARILY_UNAVAILABLE:"SERVICE_TEMPORARILY_UNAVAILABLE",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",VIDEO_ONLY_CALL_NOT_SUPPORTED:"VIDEO_ONLY_CALL_NOT_SUPPORTED",VIDEO_REJECTION_NOT_SUPPORTED:"VIDEO_REJECTION_NOT_SUPPORTED",COLLABORATION_ONLY_CALL_NOT_SUPPORTED:"COLLABORATION_ONLY_CALL_NOT_SUPPORTED",NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE:"NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE",NETWORK_EVENTS_SUBSCRIPTION_FAILED:"NETWORK_EVENTS_SUBSCRIPTION_FAILED",MEDIA_SERVICE_UNAVAILABLE:"MEDIA_SERVICE_UNAVAILABLE",INVALID_ACCEPTED_EVENTS:"INVALID_ACCEPTED_EVENTS"}}(),function(){"use strict";function e(e,t,i,a){this._error=e,this._protocolType=t,this._protocolErrorCode=i,this._protocolErrorReason=a}e.prototype={getError:function(){return this._error},getProtocolType:function(){return this._protocolType},getProtocolErrorCode:function(){return this._protocolErrorCode},getProtocolErrorReason:function(){return this._protocolErrorReason}},AvayaClientServices.Services.Call.CallException=e}(AvayaClientServices),function(s){"use strict";function e(e,t,i,a,r){this._providerFactory=e,this._mediaServiceFactory=t,this._callService={},this._callManager=new s.Services.Call.CallManager,this.calls=T,this._callProvider={},this._participantService=T,this._conferenceService=T,this._contactsIntegrationService=i,this._callsAnalyticsService=a,this._callPerformanceManager=r}e.prototype={init:function(e){this._callProvider=this._providerFactory.getCallProviders(e,this._mediaServiceFactory,this._callsAnalyticsService)[0],this._callService=new s.Services.Call.CallService(e,this._callProvider,this._callManager,this._mediaServiceFactory,this._contactsIntegrationService,this._callsAnalyticsService,this._providerFactory.getRemoteLoggerProvider()),this._callPerformanceManager.setCallService(this._callService),this.calls=new s.Services.Call.Calls(this._callManager,this._callService)},getCalls:function(){return this.calls},getCallService:function(){return this._callService},getCallManager:function(){return this._callManager}},s.Services.Call.CallFactory=e}(AvayaClientServices),function(_){"use strict";function e(){this._callsObject=T,this._calls=[],this._lastMissedCall=T}e.prototype={setCalls:function(e){this._callsObject=e},createCall:function(e){var t=new _.Services.Call.Call(e);return t._setServiceAvailability(e.isServiceAvailable()),e._config.sgConfiguration&&e._config.sgConfiguration.credentialProvider&&t._setIsGuestUser(e._config.sgConfiguration.credentialProvider.isGuest),this._calls.push(t),this._callsObject._callCreatedCallbacks.fire(t),t},createRemoteOrIncomingCall:function(e,t,i,a,r,s,n,o,c,l,d,C,u){var h=new _.Services.Call.Call(e);return h._setServiceAvailability(e.isServiceAvailable()),h._setCallId(t),h._setRemoteAddress(i),h._setRemoteDisplayName(a),h._setIsAutoAnswerEnabled(u),h._isPrivateCallerID=!!_.Base.Utils.isDefined(s)&&s,h._isAuraAsserted=!!_.Base.Utils.isDefined(r)&&r,h._alertType=o,h._subject=c,n&&(h._incomingVideoOffered=_.Services.Call.VideoNetworkSignalingType.SUPPORTED),h._setRemote(!!_.Base.Utils.isDefined(d)&&d),h._setState(l),h._incoming=!!_.Base.Utils.isDefined(C)&&C,h.isRemote()&&this._lastMissedCall&&(this._lastMissedCall.getRemoteAddress()===i&&h._setIsMissed(!0),this._lastMissedCall=T),_.Base.Utils.isDefined(e._config.wcsConfiguration)&&_.Base.Utils.isDefined(e._config.wcsConfiguration.enabled)&&(h._webCollaboration=e._config.wcsConfiguration.enabled),this._calls.push(h),this._callsObject._callCreatedCallbacks.fire(h),h},createMakeCall:function(e,t,i,a,r,s){var n=new _.Services.Call.Call(e);return n._setServiceAvailability(e.isServiceAvailable()),n._setCallId(t),n._setRemoteAddress(i),_.Base.Utils.isDefined(a)&&n._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this._calls.push(n),this._callsObject._callCreatedCallbacks.fire(n),n},deleteCall:function(e){var t=this._calls.indexOf(e);-1<t&&(this._calls.splice(t,1),this._callsObject._callRemovedCallbacks.fire(e))},getCallCount:function(){return this._calls.length},_getLiveCallCount:function(){for(var e=0,t=0;t<this._calls.length;t++){var i=this._calls[t];i.getState()!==_.Services.Call.CallStates.ENDED&&i.getState()!==_.Services.Call.CallStates.ENDING&&e++}return e},setLastMissedCall:function(e){this._lastMissedCall=e},getLastMissedCall:function(){return this._lastMissedCall},getAllCalls:function(){return this._calls},getActiveCall:function(){for(var e=0;e<this._calls.length;e++){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.ESTABLISHED&&!t.isRemote()||t.getState()===_.Services.Call.CallStates.RENEGOTIATING||t.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING)return t}return T},getIgnoredCalls:function(){return this._calls.filter(function(e){return e.getState()===_.Services.Call.CallStates.IGNORED})},getCallById:function(e){for(var t=0;t<this._calls.length;t++)if(this._calls[t].getCallId()===e)return this._calls[t];return T},getEndingCall:function(){if(this._calls&&this._calls.length)for(var e=this._calls.length-1;0<=e;e--){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.ENDING)return t}},hasHeldCall:function(){for(var e=0;e<this._calls.length;e++)if(this._calls[e].getState()===_.Services.Call.CallStates.HELD)return!0;return!1},hasInitiatingCall:function(){for(var e=0;e<this._calls.length;e++){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.INITIATING||t.getState()===_.Services.Call.CallStates.REMOTE_ALERTING||t.getState()===_.Services.Call.CallStates.IDLE)return!0}return!1},setCallMode:function(e,t){e=this._calls.indexOf(e);this._calls[e]._modes.push(t)},getCallModes:function(e){e=this._calls.indexOf(e);return e<0?[]:this._calls[e]._modes}},_.Services.Call.CallManager=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallModes={CONFERENCE_CALL:"conferenceCall",AV_COLLABORATION_CALL:"avCollaborationCall"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallProtocolType={APPLICATION:"APPLICATION",HTTP:"HTTP"}}(),function(_){"use strict";function e(e,t,i,a,r,s,n){_.Base.Observable.call(this),this._config=e,this._callProvider=t,this._callManager=i,this._mediaServicesFactory=a,this._remoteLoggerProvider=n,this._isServiceAvailable=!1,this._mediaServices=a.getMediaServices(),this._scopiaConferenceProviderFactory=new _.Providers.Scopia.ScopiaConferenceProviderFactory,this._contactsIntegrationService=r,this._onContactListChanged=T,this._videoLicenseEnabled=!0,this.videoResolution={},this._videoCapability=new _.Base.Capability(_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._calls=T,this._callsAnalyticsService=s,this._uploadLoggerProvider=T,this._isUploadedOnServiceUnavailable=!1,this._isRegistrationTerminated=!1,this._uploadIntervalTimer=T}(e.prototype=Object.create(_.Base.Observable.prototype)).setCollaborations=function(e){this._collaborations=e},e.prototype.startCall=function(t){if(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Call Service is starting..."),!this._isMakeCallAllowed(t))return this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),void this._notifyCallFailure(t,_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED);if(t.getState()!==_.Services.Call.CallStates.IDLE){var e=this._config._mediaServiceConfiguration?_.Services.Call.CallError.MULTIPLE_CALLS_NOT_SUPPORTED:_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("start",e),void this._notifyCallFailure(t,e)}if(t._setState(_.Services.Call.CallStates.INITIATING),t._callCreationInfo&&t._callCreationInfo.getAuthorizationToken()&&this._registerCallbacks(),t.addOnCallEndedCallback(function(e){this._stopCollaboration(e)}.bind(this)),t._isDataOnly()){_.Base.Utils.isUndefined(t.getAudioChannel())&&(t._audioChannel=this._callProvider.createAudioChannel_AudioMode(_.Services.Call.AudioMode.DISABLE));for(var i=this._callManager.getCallModes(t),a=0;a<i.length;a++){var r=i[a];if(r.id===_.Services.Call.CallModes.CONFERENCE_CALL)return void r.startCall(t)}}else{var s=t.getRemoteAddress();null!==s.match(/sips?:.*/)||-1!==(h=s.search(/,/))&&(t._setDtmfString(s.substring(h).split("")),t._setRemoteAddress(s.substring(0,h)))}var n=this._getMicrophoneAvailability(),o=this._getSpeakersAvailability(),c=this._getCameraAvailability(t),l=0<t.getVideoChannels().length;this._setupVideoResolution(t),this._setupDevicesListeners(t),this._setupAnalyticsListeners(t),this._setupStatisticsLogger(t);var d,C,u=_.Services.Call.MediaDirection.RECV_ONLY,e=_.Services.Call.MediaDirection.SEND_RECV,s=_.Services.Call.MediaDirection.SEND_RECV,h=t.getAudioChannel()&&t.getAudioChannel().getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE;n||h?o||h?(this.isVideoEnabled()?l?(s=u=l=(h=t.getVideoChannels())[0]._getInternalRequestedDirection(),c||(l===_.Services.Call.MediaDirection.SEND_RECV?(h[0]._setRequestedDirection(_.Services.Call.MediaDirection.RECV_ONLY),_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_RECV video direction to RECV_ONLY"),s=_.Services.Call.MediaDirection.RECV_ONLY):l===_.Services.Call.MediaDirection.SEND_ONLY&&(h[0]._setRequestedDirection(_.Services.Call.MediaDirection.INACTIVE),s=_.Services.Call.MediaDirection.INACTIVE,_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_ONLY video direction to INACTIVE")))):this._isCollabCall(t)||this._setupNailedUpVideoConnection(t,_.Services.Call.VideoMode.RECEIVE_ONLY)&&(u=_.Services.Call.MediaDirection.RECV_ONLY,s=_.Services.Call.MediaDirection.INACTIVE):(u=_.Services.Call.MediaDirection.INACTIVE,e=_.Services.Call.MediaDirection.INACTIVE,s=_.Services.Call.MediaDirection.INACTIVE),!this._callProvider.isNailedUpVideoConnectionRequired()||t._isDataOnly()||this._isCollabCall(t)||(d=new _.Providers.Call.NailedUpVideoConnectionInfo(s,u,e)),_.Base.Utils.isUndefined(t.getAudioChannel())&&(t._audioChannel=this._callProvider.createAudioChannel_AudioMode(_.Services.Call.AudioMode.SEND_RECEIVE)),C=function(){return this._callProvider.startCall(t,this.isVideoEnabled(),this.isWebCollaborationEnabled(t),this.isUccpEnabled(),this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice(),this.videoResolution,d).fail(function(e){_.Base.Logger.warn("Failed to start call.",e),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.FAILED)}.bind(this))}.bind(this),(e=this._callManager.getActiveCall())!==T?(this._callProvider.setActiveCallVideoTrack(e.getCallId()),e.hold().then(function(){C()}.bind(this),function(e){_.Base.Logger.warn("Auto hold failed when starting call.",e),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.AUTO_HOLD_FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.AUTO_HOLD_FAILED)}.bind(this))):C()):(_.Base.Logger.warn("Speaker is not available"),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.SPEAKERS_NOT_FOUND)):(_.Base.Logger.warn("Microphone is not available"),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.MICROPHONE_NOT_FOUND))},e.prototype._setupNailedUpVideoConnection=function(e,t){if(e._isDataOnly()||!this._callProvider.isNailedUpVideoConnectionRequired())return!1;var i=this._callProvider._createVideoChannel_VideoMode(_.Services.Call.VideoMode.DISABLE);return i._setInternalRequestedDirection(_.Providers.Call.Utils.getVideoDirection(t)),i._setChannelId("NailedUp_"+i.getChannelId()),e._videoChannels.push(i),!0},e.prototype._getMicrophoneAvailability=function(){var e=this._mediaServices.getAudioInterface().getInputInterface();return!e.getSelectDeviceCapability().isAllowed||e.hasAvailableDevices()},e.prototype._getSpeakersAvailability=function(){var e=this._mediaServices.getAudioInterface().getOutputInterface(),t=e.getSelectDeviceCapability().isAllowed,i=_.Base.Utils.getBrowserType(),e=i===_.Base.BrowserType.FIREFOX||i===_.Base.BrowserType.SAFARI||e.hasAvailableDevices();return!t||e},e.prototype._getCameraAvailability=function(e){var t=!1;0<e.getVideoChannels().length&&(t=e.getVideoChannels().reduce(function(e,t){return e&&t._getInternalRequestedDirection()===_.Services.Call.MediaDirection.RECV_ONLY},!0));var i=this._mediaServices.getVideoInterface(),e=i.getSelectDeviceCapability().isAllowed,i=i.hasAvailableDevices();return t||!e||i},e.prototype._setupDevicesListeners=function(e){var t=this._handleOnSelectedDeviceChanged(e).bind(this);this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceChangedCallback(t),this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(t);var i=this._handleOnSelectedDeviceRemoved;this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceRemovedCallback(i),this._mediaServices.getAudioInterface().getOutputInterface().addOnSelectedDeviceRemovedCallback(i),this._mediaServices.getVideoInterface().addOnSelectedDeviceRemovedCallback(i),e.addOnCallEndedCallback(function(){this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceChangedCallback(t),this._mediaServices.getVideoInterface().removeOnSelectedDeviceChangedCallback(t),this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceRemovedCallback(i),this._mediaServices.getAudioInterface().getOutputInterface().removeOnSelectedDeviceRemovedCallback(i),this._mediaServices.getVideoInterface().removeOnSelectedDeviceRemovedCallback(i)}.bind(this))},e.prototype._setupAnalyticsListeners=function(e){var t;e.addOnCallEstablishedCallback(function(){t=this._callsAnalyticsService.startTimingMetric(),this._callsAnalyticsService.setCallMediaTypes(Boolean(e._videoChannels.length))}.bind(this)),e.addOnCallVideoChannelsUpdatedCallback(function(){this._callsAnalyticsService.setCallMediaTypes(!0)}.bind(this)),e.addOnCallEndedCallback(function(){this._callsAnalyticsService.callTimeEnd(t),this._callsAnalyticsService.sendCallMediaTypes()}.bind(this))},e.prototype._setupStatisticsLogger=function(e){e.addOnCallEstablishedCallback(function(){e._isDataOnly()||e.startLoggingStatistics()}.bind(this)),e.addOnCallEndedCallback(function(){e._isDataOnly()||e.stopLoggingStatistics()}.bind(this))},e.prototype._setupVideoResolution=function(s){s.addOnCallEstablishedCallback(function(){var e=_.Base.Storage,t=e.get(e.TYPES.LOCAL,e.KEYS.VIDEO_RESOLUTIONS),i=new _.Base.VideoResolutionDetails,e=this.getVideoResolution(s),a=i.convertToConfigVideoResolution(e),r=(r=t?t.find(function(e){return e.negotiate===a}):r)&&r.limited||[a],r=this._getAverageLimitedResolution(r);this.setVideoSendResolution(s,r),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,[])}.bind(this))},e.prototype._initAnalyticsMetrics=function(){var t,i;this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(e){t=this._callsAnalyticsService.startTimingMetric();e=e&&e.getState()===_.Services.Call.CallStates.ESTABLISHED;i=this._callsAnalyticsService.callPreservationTimeStart(e)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){this._callsAnalyticsService.serviceUnavailableTimeEnd(t);var e=this._callsAnalyticsService.callPreservationTimeEnd(i);this._callsAnalyticsService.sendPreservationEvent(!0,e)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,function(){var e=this._callsAnalyticsService.callPreservationTimeEnd(i);this._callsAnalyticsService.sendPreservationEvent(!1,e)}.bind(this))},e.prototype._handleOnSelectedDeviceRemoved=function(e){var t=e.getAvailableDevices();e.getSelectDeviceCapability().isAllowed&&t.length&&e.setSelectedDevice(t[0])},e.prototype._handleOnSelectedDeviceChanged=function(i){return function(e,t){i.isRemote()||i.getState()!==_.Services.Call.CallStates.ESTABLISHED&&i.getState()!==_.Services.Call.CallStates.HELD&&i.getState()!==_.Services.Call.CallStates.RENEGOTIATING&&i.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING||(i.getState()===_.Services.Call.CallStates.ESTABLISHED&&i._setState(_.Services.Call.CallStates.RENEGOTIATING),this._callProvider.updateDevices(i,t).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",_.Services.Call.CallError.FAILED)}.bind(this)).always(function(){i.getState()===_.Services.Call.CallStates.RENEGOTIATING&&i._setState(_.Services.Call.CallStates.ESTABLISHED)}))}.bind(this)},e.prototype._updateVideoResolution=function(e,t){if(e.isRemote()||e.getState()!==_.Services.Call.CallStates.ESTABLISHED&&e.getState()!==_.Services.Call.CallStates.HELD&&e.getState()!==_.Services.Call.CallStates.RENEGOTIATING&&e.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING){var i=S.Deferred();return i.reject(),i.promise()}return this._callProvider.updateVideoResolution(e,t).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("updateVideoResolution",_.Services.Call.CallError.FAILED)}.bind(this))},e.prototype.endCall=function(t,e){if(t){if(t._isDataOnly())for(var i=this._callManager.getCallModes(t),a=0;a<i.length;a++){var r=i[a];if(r.id===_.Services.Call.CallModes.CONFERENCE_CALL)return void r.endCall(t)}return this._callProvider._cpCalls[t.getCallId()]&&t.isConference()&&this._disconnectCallFromConference(t),this._limitedVideoResolutionStoring(t),this._callProvider.stopCall(t,e).then(function(){this._triggerCallbacksAsync(t._remoteVideoRemovedCallbacks,t)}.bind(this),function(e){e.getError()===_.Services.Call.CallError.CALL_NOT_FOUND&&(e._error=_.Services.Call.CallError.ENDED,t._setState(_.Services.Call.CallStates.ENDED),this._callManager.deleteCall(t),this._callProvider.stopExternalGatewayProvider(t)),this._triggerCallbacksAsync(t._callFailedCallbacks,t,e),this._callsAnalyticsService.sendOperationFailureEvent("end",_.Services.Call.CallError.FAILED)}.bind(this))}},e.prototype.mute=function(e){return e.getMuteCapability().isAllowed?this._callProvider.muteAudio(e).then(function(){e._isAudioMuted=!0,this._triggerCallbacksAsync(e._onCallAudioMuteStatusChangedCallbacks,e,!0)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("mute",_.Services.Analytics.AnalyticsErrorCode.MUTE_AUDIO_ERROR),S.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not mute call: "+e.getCallId()+": "+e.getMuteCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("mute",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.unmute=function(e){return e.getUnmuteCapability().isAllowed?this._callProvider.unmuteAudio(e).then(function(){e._isAudioMuted=!1,this._triggerCallbacksAsync(e._onCallAudioMuteStatusChangedCallbacks,e,!1)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("unmute",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_AUDIO_ERROR),S.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-mute call: "+e.getCallId()+": "+e.getUnmuteCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unmute",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.muteVideo=function(e){return e.getMuteVideoCapability().isAllowed?this._callProvider.muteVideo(e).then(function(){this._triggerCallbacksAsync(e._onCallVideoMuteStatusChangedCallbacks,e,!0)}.bind(this)).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("muteVideo",_.Services.Analytics.AnalyticsErrorCode.MUTE_VIDEO_ERROR)}.bind(this)):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect mute video capability: "+e.getCallId()+": "+e.getMuteVideoCapability().denialReason),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.unmuteVideo=function(e){return e.getUnmuteVideoCapability().isAllowed?this._callProvider.unmuteVideo(e).then(function(){this._triggerCallbacksAsync(e._onCallVideoMuteStatusChangedCallbacks,e,!1)}.bind(this)).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("unmuteVideo",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_VIDEO_ERROR)}.bind(this)):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect unmute video: "+e.getCallId()+": "+e.getUnmuteVideoCapability().denialReason),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.muteSpeaker=function(e){if(e.getMuteSpeakerCapability().isAllowed)return this._callProvider.muteSpeaker(e).then(function(){e._isSpeakerMuted=!0,this._triggerCallbacksAsync(e._onCallSpeakerMuteStatusChangedCallbacks,e,!0)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",_.Services.Analytics.AnalyticsErrorCode.MUTE_SPEAKER_ERROR),S.Deferred().reject(e).promise()}.bind(this));_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not mute speakers for call: "+e.getCallId()+": "+e.getMuteSpeakerCapability().denialReason);var t=_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",t),S.Deferred().reject(new _.Services.Call.CallException(t)).promise()},e.prototype.unmuteSpeaker=function(e){return e.getUnmuteSpeakerCapability().isAllowed?this._callProvider.unmuteSpeaker(e).then(function(){e._isSpeakerMuted=!1,this._triggerCallbacksAsync(e._onCallSpeakerMuteStatusChangedCallbacks,e,!1)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_SPEAKER_ERROR),S.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-mute speakers for call: "+e.getCallId()+": "+e.getUnmuteSpeakerCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.hold=function(t){if(t.getHoldCapability().isAllowed){t._setState(_.Services.Call.CallStates.HOLDING);var e=this._callProvider.hold(t);return e.then(function(){t._heldTime=new Date,t._setState(_.Services.Call.CallStates.HELD),this._triggerCallbacksAsync(t._onCallHeldCallbacks,t)}.bind(this),function(e){return t.getState()===_.Services.Call.CallStates.HOLDING&&t._setState(_.Services.Call.CallStates.ESTABLISHED),this._callsAnalyticsService.sendOperationFailureEvent("hold",_.Services.Analytics.AnalyticsErrorCode.HOLD_CALL_ERROR),S.Deferred().reject(e).promise()}.bind(this)),e}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not hold call: "+t.getCallId()+": "+t.getHoldCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("hold",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.unhold=function(t){var e=this._callManager.getActiveCall(),i=function(){t._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(t._onCallUnheldCallbacks,t)}.bind(this),a=function(e){return t.getState()===_.Services.Call.CallStates.UNHOLDING&&t._setState(_.Services.Call.CallStates.HELD),this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.FAILED),S.Deferred().reject(e).promise()}.bind(this);return t.getUnholdCapability().isAllowed?e!==T?(t._setState(_.Services.Call.CallStates.UNHOLDING),e.hold().then(function(){return this._callProvider.unhold(t).then(i,a)}.bind(this),function(){var e=S.Deferred();return this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.AUTO_HOLD_FAILED),e.reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED)),e.promise()}.bind(this))):this._callProvider.unhold(t).then(i,a):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-hold call: "+t.getCallId()+": "+t.getUnholdCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.ignore=function(e){var t=S.Deferred();return e.getState()===_.Services.Call.CallStates.ALERTING?(e._setState(_.Services.Call.CallStates.IGNORED),this._triggerCallbacksAsync(e._onCallIgnoredCallbacks,e),t.resolve()):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not ignore call: "+e.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("ignore",_.Services.Call.CallError.CALL_STATE_MISMATCH),t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH))),t.promise()},e.prototype._triggerCallbacksAsync=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();t&&setTimeout(function(){t.fire.apply(null,e)},0)},e.prototype._notifyCallFailure=function(e,t,i,a,r){e._setState(_.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(e._callFailedCallbacks,e,new _.Services.Call.CallException(t,i,a,r))},e.prototype._stopCollaboration=function(e){var t;this._collaborations&&(this._collaborations._isCollaborationForCall(e.getCallId())?(t=this._collaborations.getCollaborationForCall(e.getCallId())).stop().always(function(){this._collaborations._deleteCollaboration(t._collaborationId)}.bind(this)):this._collaborations._isCollaborationForCall("standalone")&&(t=this._collaborations.getCollaborationForCall("standalone")).stop().always(function(){this._collaborations._deleteCollaboration(t._collaborationId)}.bind(this)))},e.prototype.accept=function(t){t._setIsMissed(!1),t.getServiceQualityScoreCapability()._recalculate(),t.addOnCallEndedCallback(function(e){this._stopCollaboration(e)}.bind(this));var e=this._getMicrophoneAvailability(),i=this._getSpeakersAvailability();if(this._setupVideoResolution(t),this._setupDevicesListeners(t),this._setupAnalyticsListeners(t),this._setupStatisticsLogger(t),e){if(i){if(t.getState()!==_.Services.Call.CallStates.ALERTING&&t.getState()!==_.Services.Call.CallStates.IGNORED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.CALL_STATE_MISMATCH),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();0<t.getVideoChannels().length&&(this._getCameraAvailability(t)||t.getVideoChannels()[0]._setRequestedDirection(_.Services.Call.MediaDirection.RECV_ONLY));i=this._callManager.getActiveCall();return i!==T?i.hold().then(function(){return this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))}.bind(this),function(e){if(e&&e.getError()===_.Services.Call.CallError.ENDED)return this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this));e=S.Deferred();return this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.AUTO_HOLD_FAILED),e.reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED)),e.promise()}.bind(this)):this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": Speakers not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.SPEAKERS_NOT_FOUND),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.SPEAKERS_NOT_FOUND))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": Microphone not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.MICROPHONE_NOT_FOUND),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.MICROPHONE_NOT_FOUND))},e.prototype.acceptSendVideo=function(i,e){if(i.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i.getState()!==_.Services.Call.CallStates.ESTABLISHED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not acceptSendVideo for call: "+i.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",_.Services.Call.CallError.AUTO_HOLD_FAILED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(function(e,t){this._callProvider.updateDevices(i,t).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",_.Services.Call.CallError.FAILED)}.bind(this))}.bind(this)),this._getCameraAvailability(i)||(e=_.Services.Call.VideoMode.RECEIVE_ONLY);function t(){i.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i._setState(_.Services.Call.CallStates.ESTABLISHED)}var a=function(e){return t(),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_SEND_VIDEO_ERROR),S.Deferred().reject(e).promise()}.bind(this);return this._callProvider.acceptSendVideo(i,this._mediaServices.getVideoInterface().getSelectedDevice(),e).then(t,a)},e.prototype.denySendVideo=function(e){if(e.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.getState()!==_.Services.Call.CallStates.ESTABLISHED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not denySendVideo for call: "+e.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",_.Services.Call.CallError.CALL_STATE_MISMATCH),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();function t(){e.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)}var i=function(e){return t(),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",_.Services.Analytics.AnalyticsErrorCode.DENY_SEND_VIDEO_ERROR),S.Deferred().reject(e).promise()}.bind(this);return this._callProvider.denySendVideo(e).then(t,i)},e.prototype.transfer=function(t,e){if(t.getTransferCapability().isAllowed){var i=t.getState();return t._setState(_.Services.Call.CallStates.TRANSFERRING),this._callProvider.transfer(t,e).then(function(){t._setState(_.Services.Call.CallStates.ESTABLISHED)},function(e){return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Unattended transfer failed: "+e),t._setState(i),this._callsAnalyticsService.sendOperationFailureEvent("transfer",_.Services.Analytics.AnalyticsErrorCode.TRANSFER_CALL_ERROR),S.Deferred().reject(e).promise()}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not transfer call: "+t.getCallId()+": "+t.getTransferCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("transfer",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.attendedTransfer=function(t,e){if(t.getTransferCapability().isAllowed&&e.getTransferToCapability().isAllowed){var i=t.getState();return t._setState(_.Services.Call.CallStates.TRANSFERRING),this._callProvider.attendedTransfer(t,e).then(function(){t._setState(_.Services.Call.CallStates.ESTABLISHED)},function(e){return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Attended transfer failed: "+e),t._setState(i),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",_.Services.Analytics.AnalyticsErrorCode.ATTENDED_TRANSFER_CALL_ERROR),S.Deferred().reject(e).promise()}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not attended transfer call: "+t.getCallId()+": "+t.getTransferCapability().denialReason+" "+e.getTransferToCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.join=function(e){if(!e.getJoinCapability().isAllowed)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not join call: "+e.getCallId()+": "+e.getJoinCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var t=this._getMicrophoneAvailability(),i=this._getSpeakersAvailability();if(this._setupDevicesListeners(e),this._setupAnalyticsListeners(e),this._setupStatisticsLogger(e),t){if(i){e.getServiceQualityScoreCapability()._recalculate();i=this._callManager.getActiveCall();return i!==T&&i.getCallId()!==e.getCallId()?i.hold().then(function(){return this._callProvider.join(e,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this))}.bind(this),function(){return this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.AUTO_HOLD_FAILED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED))}.bind(this)):this._callProvider.join(e,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this))}this._notifyCallFailure(e,_.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.SPEAKERS_NOT_FOUND)}else this._notifyCallFailure(e,_.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.MICROPHONE_NOT_FOUND)},e.prototype.start=function(i){return this._startDfd=S.Deferred(),this._calls=i,this._config.mediaConfiguration&&this._config.mediaConfiguration.voipConfigurationVideo&&this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork&&(this.videoResolution=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork,_.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution])||_.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution]),this._recalculateVideoCapability(),this._registerCallbacks(),this._callProvider.on(_.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(_.Base.Utils.isUndefined(i._isAvailable)||i._isAvailable)&&(i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i))}.bind(this)),this._callProvider.on(_.Base.NetworkProviderEvents.AUTHORIZED,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i))}.bind(this)),this._initAnalyticsMetrics(),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i),this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest&&i._triggerRegistrationStatus(!0)),i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNSUPPORTED,function(){this._isServiceAvailable=!1,i._isAvailable=!1,i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i),this.trigger(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[])}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&!i._isAvailable&&this._isServiceAvailable||(i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i)),i._voipCallingCapability._recalculate(),this._startDfd.state()===_.Base.DeferredStates.PENDING&&this._startDfd.reject()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,function(){i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,function(){i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,function(e,t,i){var a=_.Base.Utils.parseUrl(e);a&&(_.Base.Logger.info("Initializing remote logger provider"),a=new _.Config.ServerInfo(a.hostname,a.port,a.isSecure,a.path),this._uploadLoggerProvider=this._remoteLoggerProvider.getProvider(_.Providers.RemoteLogger.Names.MPAAS),this._uploadLoggerProvider.start(a,e,t,this._config._mediaServiceConfiguration.sessionId,i,this._config.sgConfiguration.credentialProvider).then(function(){this.uploadLogs()}.bind(this)))}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,function(e,t){this._triggerCallbacksAsync(e._onAudioStreamUpdatedCallback,e,t)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,function(e){i._triggerRegistrationStatus(!0)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,function(e,t){i._triggerRegistrationStatus(!1),"REGISTRATION_TERMINATED"===t&&(this._isRegistrationTerminated=!0,i._voipCallingCapability._recalculate(),this._callProvider.stop().always(function(){this._isServiceAvailable=!1,i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i)}.bind(this)))}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,function(e){e.getEstablishedTime()&&e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING)}),this._callProvider.start(this._config,this.videoResolution).then(function(e){return this._onContactListChanged=function(){this._callManager.getAllCalls().forEach(this._updateMatchedContactsForCall,this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),this._startDfd.state()===_.Base.DeferredStates.PENDING&&this._startDfd.resolve(),!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i)),e}.bind(this),function(e){this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Analytics.AnalyticsErrorCode.STARTING_CALL_ERROR),this._startDfd.reject(e)}.bind(this)),this._startDfd.promise()},e.prototype.stop=function(){return this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer),this._limitedVideoResolutionStoring(),this._callProvider.stop().then(function(e){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,this._calls=T,e}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("stop",_.Services.Analytics.AnalyticsErrorCode.STOPPING_CALL_ERROR),S.Deferred().reject(e).promise()}.bind(this))},e.prototype.stopImmediately=function(){return this._limitedVideoResolutionStoring(),this._callProvider.stopImmediately().fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("stopImmediately",_.Services.Call.CallError.FAILED)}.bind(this))},e.prototype.sendDTMF=function(e,t){return e.getSendDTMFCapability().isAllowed?this._callProvider.sendDTMF(e,t).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",_.Services.Analytics.AnalyticsErrorCode.SEND_DTMF_ERROR)}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not send DTMF for call: "+e.getCallId()+": "+e.getSendDTMFCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.isVideoEnabled=function(){var e=_.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");return this._videoLicenseEnabled&&(!!e||_.Base.Utils.isUndefined(e))},e.prototype.isWebCollaborationEnabled=function(e){return e._webCollaboration},e.prototype.isUccpEnabled=function(){return!(!_.Base.Utils.isDefined(this._config.uccpConfiguration)||!_.Base.Utils.isDefined(this._config.uccpConfiguration.enabled))&&this._config.uccpConfiguration.enabled},e.prototype.setVideoChannels=function(e,t){return 0===t.length?this.setVideoMode(e,_.Services.Call.VideoMode.DISABLE):this.setVideoMode(e,this._getVideoMode(t[0].direction))},e.prototype._getVideoMode=function(e){switch(e){case _.Services.Call.MediaDirection.SEND_RECV:return _.Services.Call.VideoMode.SEND_RECEIVE;case _.Services.Call.MediaDirection.SEND_ONLY:return _.Services.Call.VideoMode.SEND_ONLY;case _.Services.Call.MediaDirection.RECV_ONLY:return _.Services.Call.VideoMode.RECEIVE_ONLY;case _.Services.Call.MediaDirection.DISABLE:return _.Services.Call.VideoMode.DISABLE;default:return _.Services.Call.VideoMode.INACTIVE}},e.prototype.setVideoMode=function(t,e,i){if(t.getState()===_.Services.Call.CallStates.IDLE||t.getState()===_.Services.Call.CallStates.ALERTING||t.getState()===_.Services.Call.CallStates.IGNORED||t.getUpdateVideoChannelsCapability().isAllowed){if(!this._isSetVideoModeCapabilityAllowed(t,e))return S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));t.getState()===_.Services.Call.CallStates.ESTABLISHED&&t._setState(_.Services.Call.CallStates.RENEGOTIATING);var a=function(){t.getState()===_.Services.Call.CallStates.RENEGOTIATING&&t._setState(_.Services.Call.CallStates.ESTABLISHED)},r=function(e){return a(),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",_.Services.Analytics.AnalyticsErrorCode.SETTING_VIDEO_MODE_ERROR),S.Deferred().reject(e).promise()}.bind(this),e=this._callProvider.setVideoMode(t,e,this._mediaServices.getVideoInterface().getSelectedDevice(),i);return e.then(function(){var e;a(),this._collaborations&&this._collaborations._isCollaborationForCall(t.getCallId())&&(e=this._collaborations.getCollaborationForCall(t.getCallId())).getContentSharing()._recalculateShareContentVideoCapability(e)}.bind(this),r),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,[i]),e}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setVideoMode for call: "+t.getCallId()+": "+t.getUpdateVideoChannelsCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.setVideoSendResolution=function(e,t){var i,a=e.getVideoChannels();if(0<a.length){a=a[0].getNegotiatedDirection();return a===_.Services.Call.MediaDirection.SEND_ONLY||a===_.Services.Call.MediaDirection.SEND_RECV?this._callProvider.setVideoSendResolution(e,t):(i="The call does not have an active send video channel",S.Deferred().reject(i).promise())}return i="The call does not have a video channel",S.Deferred().reject(i).promise()},e.prototype.getVideoSendBandwidth=function(e){return this._callProvider.getVideoSendBandwidth(e)},e.prototype.getVideoBandwidth=function(e){return this._callProvider.getVideoBandwidth(e)},e.prototype.getVideoResolution=function(e){return this._callProvider.getVideoResolution(e)},e.prototype.getNegotiatedVideoResolutionByCallId=function(e){e=this._callManager.getCallById(e);return e?this._callProvider.getVideoResolution(e):this.getDefaultVideoResolution()},e.prototype.getVideoSendResolution=function(e){return this._callProvider.getVideoSendResolution(e)},e.prototype.hasVideoTracks=function(e){return this._callProvider.hasVideoTracks(e)},e.prototype._isSetVideoModeCapabilityAllowed=function(e,t){switch(t){case _.Services.Call.VideoMode.SEND_RECEIVE:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeSendReceiveCapability().isAllowed;case _.Services.Call.VideoMode.SEND_ONLY:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeSendOnlyCapability().isAllowed;case _.Services.Call.VideoMode.RECEIVE_ONLY:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeReceiveOnlyCapability().isAllowed;case _.Services.Call.VideoMode.INACTIVE:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeInactiveCapability().isAllowed;case _.Services.Call.VideoMode.DISABLE:return e.getUpdateVideoModeDisableCapability().isAllowed;default:return!1}},e.prototype.setAudioMode=function(e,t){return e.getUpdateAudioModeCapability().isAllowed||t===_.Services.Call.AudioMode.DISABLE?this._callProvider.setAudioMode(e,t):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setAudioMode for call: "+e.getUpdateAudioModeCapability().denialReason),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},e.prototype.setWebCollaboration=function(e,t){return e.getUpdateWebCollaborationCapability().isAllowed||this._isCollabCallCapable(e)?(e._webCollaboration=t,this._callProvider.setWebCollaboration(e,t)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setWebCollaboration for call: "+e.getUpdateWebCollaborationCapability().denialReason),S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},e.prototype.isServiceAvailable=function(){return this._isServiceAvailable},e.prototype.getVideoCapability=function(){return this._videoCapability},e.prototype.getDefaultVideoResolution=function(){return this._config.mediaConfiguration.voipConfigurationVideo.videoResolution},e.prototype._recalculateVideoCapability=function(){var e=!0,t=_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this.isServiceAvailable()&&this.isVideoEnabled()&&this._config.mediaConfiguration.mediaEngineEnabled||(e=!1,t=_.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._videoCapability._updateIfChanged(e,t)},e.prototype.startRinging=function(e){return this._callProvider.startRinging(e)},e.prototype.acceptAnswerCallRequest=function(e){return this._callProvider.acceptAnswerCallRequest(e)},e.prototype.acceptTerminateCallRequest=function(e){return this._callProvider.acceptTerminateCallRequest(e)},e.prototype.acceptUpdateCallRequest=function(e,t){return this._callProvider.acceptUpdateCallRequest(e,t)},e.prototype.acceptMakeCallRequest=function(e){return this._callProvider.acceptMakeCallRequest(e)},e.prototype.rejectAnswerCallRequest=function(e){return this._callProvider.rejectAnswerCallRequest(e)},e.prototype.rejectTerminateCallRequest=function(e){return this._callProvider.rejectTerminateCallRequest(e)},e.prototype.rejectUpdateCallRequest=function(e,t){return this._callProvider.rejectUpdateCallRequest(e,t)},e.prototype.rejectMakeCallRequest=function(e){return this._callProvider.rejectMakeCallRequest(e)},e.prototype.isAudioOrDataOnly=function(e){if(e){var t=this._callManager.getCallById(e);if(t){e=t.getVideoChannels();return t._sessionId&&(t._isDataOnly()||0===e.length||e[0].isDisabled())}}return!1},e.prototype.isMPaasCall=function(e){if(e){e=this._callManager.getCallById(e);return e&&e._sessionId}return!1},e.prototype.startContentVideoSharing=function(e,t){return this.isMPaasCall(e)&&!this.isAudioOrDataOnly(e)?this._callProvider.startContentVideoSharing(e,t):S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.stopContentVideoSharing=function(e){var t=this._callManager.getCallById(e);return t&&t.muteVideo(),this._callProvider.stopContentVideoSharing(e)},e.prototype.updateAudioSourceForVideoSharing=function(e,t){return this._callProvider.updateAudioSourceForVideoSharing(e,t)},e.prototype._registerCallbacks=function(){this._callProvider._removeListeners(),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,this._conferenceEscalationHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,this._callStartedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,this._callRingingHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,this._callEstablishingHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,this._iceConnectionUpdateHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,this._incomingCallHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,this._incomingAddVideoRequestHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,this._incomingAddVideoAcceptedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,this._incomingAddVideoDeniedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,this._incomingAddVideoTimedOutHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,this._incomingHoldHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,this._incomingUnholdHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,this._videoChannelUpdateHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,this._callEndedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,this._callFailureHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,this._callServiceUnavailableHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,this._callServiceAvailableHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,this._remoteAddressChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,this._remoteCallCreatedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,this._performanceManagerProfileChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,this._performanceMonitorAlertHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,this._answerCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,this._terminateCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,this._updateCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,this._makeCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,this._allowedNailedUpVideoModesHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,this._callMediaFailedHandler.bind(this))},e.prototype._conferenceEscalationHandler=function(e,t,i,a){var r,s,n,o;i=e._webCollaboration&&_.Base.Utils.isNotEmptyString(i)?i:T,a?(e.isConference()?_.Base.Utils.isDefined(t)&&null!==t&&(this._config.uccpConfiguration.enabled?e._conference._isStarted?e._conference.stop().then(function(){r=this._parseUccpUrl(t),e._conference._setConfiguration(r)}.bind(this)):(r=this._parseUccpUrl(t),e._conference._setConfiguration(r),!_.Base.Utils.isUndefined(i)&&0!==i.length||this.watchForWebCollaborationURIChanges(e)):t=T,e._conference._collaborationURI=i,_.Base.Utils.isDefined(i)&&0<i.length&&this.createCollaborationForConference(e,i)):_.Base.Utils.isDefined(t)&&null!==t?(this._config.uccpConfiguration.enabled?(r=this._parseUccpUrl(t),o=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(r),s=new _.Services.Conference.Chat(this.createChatService(o)),n=this.createParticipantService(o),o=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,o,this._contactsIntegrationService),e._setConference(new _.Services.Conference.Conference(o,n,s)),e._conference._isUccpConference=!0,e._conference._setConfiguration(r),!_.Base.Utils.isUndefined(i)&&0!==i.length||this.watchForWebCollaborationURIChanges(e)):(t=T,o=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.SCOPIA_CONFERENCE),e._setConference(new _.Services.Conference.Conference(o)),e._conference._isUccpConference=!1),e._conference._collaborationURI=i,_.Base.Utils.isDefined(i)&&0<i.length&&this.createCollaborationForConference(e,i)):_.Base.Utils.isDefined(i)&&0<i.length?(a=!1,this.createCollaborationForCall(e,i)):e._createCMConference(),this._triggerCallbacksAsync(e._onCallConferenceStatusChangedCallbacks,e,a,t,i)):_.Base.Utils.isDefined(i)&&0<i.length&&(this.createCollaborationForCall(e,i),this._triggerCallbacksAsync(e._onCallConferenceStatusChangedCallbacks,e,a,t,i))},e.prototype.getScopiaConferenceProvider=function(e){e=_.Base.Utils.isDefined(e)?e:this._config.uccpConfiguration;return this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(e)},e.prototype.createChatService=function(e){return new _.Services.Conference.ChatService(e)},e.prototype.createParticipantService=function(e){return new _.Services.Conference.ParticipantService(e)},e.prototype.createCollaborationForConference=function(e,t){this._collaborations&&(e.getCallId()?e._conference._setCollaboration(this._collaborations.getCollaborationForCall(e.getCallId())):e._conference._setCollaboration(this._collaborations.getCollaborationForCall("standalone")),_.Base.Utils.isDefined(t)&&0<t.length&&(t=this._parseWebCollabUrl(t),this._config.wcsConfiguration=t,e._conference._collaboration._setConfiguration(this._config,t.meetingId)),this.watchForWebCollaborationURIChanges(e))},e.prototype.watchForWebCollaborationURIChanges=function(a){this._collaborations&&a._conference.addOnConferenceCollaborationURIChangedCallback(function(e,t){var i;_.Base.Utils.isDefined(t)&&0<t.length&&(i=this._parseWebCollabUrl(t),_.Base.Utils.isUndefined(e._collaboration)&&(a.getCallId()?e._setCollaboration(this._collaborations.getCollaborationForCall(a.getCallId())):e._setCollaboration(this._collaborations.getCollaborationForCall("standalone"))),e._collaborationURI===t&&!_.Base.Utils.isUndefined(e._collaboration._config)||(e._collaboration._isStarted?e._collaboration.stop().then(function(){this._config.wcsConfiguration=i,e._collaboration._setConfiguration(this._config,i.meetingId),e._collaboration.start()}.bind(this)):(this._config.wcsConfiguration=i,e._collaboration._setConfiguration(this._config,i.meetingId))))}.bind(this))},e.prototype.createCollaborationForCall=function(e,t){e.getCallId()&&(e=this._collaborations.getCollaborationForCall(e.getCallId()),_.Base.Utils.isDefined(t)&&0<t.length&&(t=this._parseWebCollabUrl(t),this._config.wcsConfiguration=t,e._setConfiguration(this._config,t.meetingId)))},e.prototype._parseUccpUrl=function(e){e=_.Base.Utils.parseUrl(e);return _.Base.Utils.isDefined(e)?{enabled:!0,networkProviderConfiguration:{webSocketConfig:new _.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path,e.credentials,e.query)}}:T},e.prototype._parseWebCollabUrl=function(e){var t,i,a,r,s;return _.Base.Utils.isDefined(e)&&0<e.length&&(t=(r=_.Base.Utils.parseUrl(e)).path.indexOf("/viewer.php"),a=r.path.substring(0,t),i="https:"===document.location.protocol||"chrome-extension:"===document.location.protocol,s=new _.Config.ServerInfo(r.hostname,r.port,i,a),(e=r.query.split("&").map(function(e){e=e.split("=");return{key:e[0],value:e[1]}})).getValue=function(t){var e=this.filter(function(e){return e.key===t});return 0!==e.length?e[0].value:null},t=e.getValue("token"),i=e.getValue("meeting_id"),a=e.getValue("mode"),r=e.getValue("login"),e=e.getValue("participantId"),s={enabled:!0,meetingId:i,credentialProvider:new _.Config.WCSCredentialTokenProvider(t,r,e,T,a),networkProviderConfiguration:{restConfig:s}}),s},e.prototype._callStartedHandler=function(e){this._triggerCallbacksAsync(e._onCallStartedCallbacks,e)},e.prototype._callRingingHandler=function(e,t,i,a,r){e.getState()===_.Services.Call.CallStates.ESTABLISHED?e._setState(_.Services.Call.CallStates.BEING_TRANSFERRED):e.getState()!==_.Services.Call.CallStates.HELD&&e._setState(_.Services.Call.CallStates.REMOTE_ALERTING),(i||a||r)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(i,a,r)),e._isEarlyMedia=t,e._sendDTMFCapability._recalculate(t),this._triggerCallbacksAsync(e._onCallRemoteAlertingCallbacks,e,t),_.Base.Utils.isDefined(e._dtmfString)&&t&&this._handleDTMFString(e)},e.prototype._callEstablishedHandler=function(e,t,i,a,r,s){e._heldRemotely=!1,e._establishedTime=new Date,e.getState()!==_.Services.Call.CallStates.HELD&&e._setState(_.Services.Call.CallStates.ESTABLISHED),_.Base.Utils.isDefined(a)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this.uploadLogs(),this._triggerCallbacksAsync(e._onCallEstablishedCallbacks,e);s=e.getAudioChannel();e.getState()!==_.Services.Call.CallStates.HELD&&s&&s._getNegotiatedDirection()===_.Services.Call.MediaDirection.RECV_ONLY&&this._incomingHoldHandler(e),e.isRemote()&&!1===i&&(this._callManager.setLastMissedCall(T),e._setRemote(!1),e._setIsMissed(!1),this._triggerCallbacksAsync(e._onCallJoinedCallbacks,e)),_.Base.Utils.isDefined(e._dtmfString)&&!e._isEarlyMedia&&this._handleDTMFString(e),this._callsAnalyticsService.sendCallInfo(e._incoming,e._videoChannels.length),this._callsAnalyticsService.sendCallType(t)},e.prototype._callEstablishingHandler=function(e){var t=e.getUserToUserInfo();t&&_.Base.Utils.isDefined(t.getUCID())&&this._triggerCallbacksAsync(e._onCallEstablishingCallbacks,e)},e.prototype._remoteCallCreatedHandler=function(e,t,i,a,r,s,n,o){o=this._callManager.createRemoteOrIncomingCall(this,e,t,i,a,r,s,n,o,_.Services.Call.CallStates.ESTABLISHED,!0,!1);this._callProvider.registerIncomingOrRemoteCall(o)},e.prototype._performanceManagerProfileChangedHandler=function(e){this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[e])},e.prototype._performanceMonitorAlertHandler=function(e,t){this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,[e,t])},e.prototype._incomingCallHandler=function(e,t,i,a,r,s,n,o,c,l,d,C){var u;this._isWebRTCSupportedBrowser()&&((u=this._callManager.getActiveCall())!==T&&this._callProvider.setActiveCallVideoTrack(u.getCallId()),C=this._callManager.createRemoteOrIncomingCall(this,e,t,i,a,r,s,n,o,_.Services.Call.CallStates.ALERTING,!1,!0,C),_.Base.Utils.isDefined(c)&&C._setUserToUserInfo(new _.Services.Call.UserToUserInfo(c,l,d)),this._callProvider.registerIncomingOrRemoteCall(C),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.INCOMING_CALL,[C]),(_.Base.Utils.isUndefined(this._config.callUserConfiguration.startRingingOnIncomingCall)||this._config.callUserConfiguration.startRingingOnIncomingCall)&&this.startRinging(C))},e.prototype._incomingAddVideoRequestHandler=function(e,t){e._setState(_.Services.Call.CallStates.FAR_END_RENEGOTIATING),this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestReceivedCallbacks,e,t)},e.prototype._incomingAddVideoAcceptedHandler=function(e){this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestAcceptedCallbacks,e)},e.prototype._incomingAddVideoDeniedHandler=function(e){this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestDeniedCallbacks,e)},e.prototype._incomingAddVideoTimedOutHandler=function(e){e.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestTimedOutCallbacks,e)},e.prototype._incomingHoldHandler=function(e){e._heldTime=new Date,e._heldRemotely=!0,this._triggerCallbacksAsync(e._onCallHeldRemotelyCallbacks,e)},e.prototype._incomingUnholdHandler=function(e){e._heldRemotely=!1,this._triggerCallbacksAsync(e._onCallUnheldRemotelyCallbacks,e)},e.prototype._videoChannelUpdateHandler=function(e){e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._recalculateVideoModeCapabilities(),this._triggerCallbacksAsync(e._onCallVideoChannelsUpdatedCallback,e,e._videoChannels)},e.prototype._callEndedHandler=function(e,t,i){e.isConference()&&this._stopConferenceCall(e),e.getState()!==_.Services.Call.CallStates.ALERTING&&e.getState()!==_.Services.Call.CallStates.IGNORED||(e._setIsMissed(!0),this._callManager.setLastMissedCall(e)),e.getState()!==_.Services.Call.CallStates.ENDING||i&&i.getCause()||(t=!1);i=this._createEndCallEvent(t,i);e._setState(_.Services.Call.CallStates.ENDED),this._triggerCallbacksAsync(e._onCallEndedCallbacks,e,i),this._callManager.deleteCall(e),this._callProvider.stopExternalGatewayProvider(e).always(function(){this.uploadLogs()}.bind(this))},e.prototype._callFailureHandler=function(e,t,i,a,r){var s=t;t!==_.Services.Call.CallError.NOT_FOUND||e.getState()!==_.Services.Call.CallStates.ENDING&&e.getState()!==_.Services.Call.CallStates.ENDED||(s=_.Services.Call.CallError.ENDED),t!==_.Services.Call.CallError.SESSION_ID_NOT_FOUND&&t!==_.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED||_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Received MPaaS session failure:",t),this.uploadLogs(),this._notifyCallFailure(e,s,i,a,r),this._callsAnalyticsService.sendDroppedCallEvent(s)},e.prototype._callServiceUnavailableHandler=function(e){this._isServiceAvailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),this._isUploadedOnServiceUnavailable||(this._isUploadedOnServiceUnavailable=!0,this.uploadLogs()),_.Base.Utils.isDefined(e)&&(e._setServiceAvailability(!1),this._triggerCallbacksAsync(e._callServiceUnavailableCallbacks,e))},e.prototype._callServiceAvailableHandler=function(e){this._isServiceAvailable=!0,this._isUploadedOnServiceUnavailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),_.Base.Utils.isDefined(e)&&(e._setServiceAvailability(!0),this._triggerCallbacksAsync(e._callServiceAvailableCallbacks,e))},e.prototype._maxNetworkRecoveryAttemptedHandler=function(i){this._callManager.getAllCalls().forEach(function(e){var t;this._callProvider.isExternalGatewayCall(e,i)&&((t=e.getState())!==_.Services.Call.CallStates.INITIATING&&t!==_.Services.Call.CallStates.REMOTE_ALERTING||(this.uploadLogs(),this._notifyCallFailure(e,_.Services.Call.CallError.SERVICE_UNAVAILABLE)))}.bind(this))},e.prototype._remoteAddressChangedHandler=function(e,t,i,a,r,s){_.Base.Utils.isDefined(e)&&(_.Base.Utils.isDefined(t)&&e._setRemoteAddress(t),_.Base.Utils.isDefined(i)&&e._setRemoteDisplayName(i),_.Base.Utils.isDefined(a)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this._triggerCallbacksAsync(e._onCallRemoteAddressChangedCallbacks,e))},e.prototype._videoLicenseUpdatedHandler=function(e){this._videoLicenseEnabled!==e&&(this._videoLicenseEnabled=e,this._recalculateVideoCapability())},e.prototype._allowedNailedUpVideoModesHandler=function(e,t){e._setAllowedNailedUpVideoModes(t)},e.prototype._iceConnectionUpdateHandler=function(e,t){t?(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Media path connected"),e.getEstablishedTime()&&e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(e._mediaConnectedCallbacks,e)):(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Media path disconnected"),this._triggerCallbacksAsync(e._mediaDisconnectedCallbacks,e))},e.prototype._buildUccpConfig=function(e){var t=this._config.uccpConfiguration,e=_.Base.Utils.parseUrl(e);return t.networkProviderConfiguration.webSocketConfig.hostName=e.hostname,t.networkProviderConfiguration.webSocketConfig.port=e.port,t.networkProviderConfiguration.webSocketConfig.isSecure=e.isSecure,t.networkProviderConfiguration.webSocketConfig.path=e.path,t},e.prototype._updateMatchedContactsForCall=function(e){e&&this._contactsIntegrationService.updateMatchedContactsForParticipant(e.getRemoteParticipant())},e.prototype._handleDTMFString=function(t){var i,a=function(){var e;0===t._dtmfString.length?clearTimeout(i):(e=t._dtmfString.shift(),i=","!==e?(this.sendDTMF(t,this._convertToDtmf(e)),setTimeout(a.bind(this),200)):setTimeout(a.bind(this),2e3))};setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Handle DTMF string passed as part of dial string"),i=setTimeout(a.bind(this),200)}.bind(this),2e3)},e.prototype._convertToDtmf=function(e){var t;switch(e){case"1":t=_.Services.Call.DTMFTone.ONE;break;case"2":t=_.Services.Call.DTMFTone.TWO;break;case"3":t=_.Services.Call.DTMFTone.THREE;break;case"4":t=_.Services.Call.DTMFTone.FOUR;break;case"5":t=_.Services.Call.DTMFTone.FIVE;break;case"6":t=_.Services.Call.DTMFTone.SIX;break;case"7":t=_.Services.Call.DTMFTone.SEVEN;break;case"8":t=_.Services.Call.DTMFTone.EIGHT;break;case"9":t=_.Services.Call.DTMFTone.NINE;break;case"0":t=_.Services.Call.DTMFTone.ZERO;break;case"A":t=_.Services.Call.DTMFTone.A;break;case"B":t=_.Services.Call.DTMFTone.B;break;case"C":t=_.Services.Call.DTMFTone.C;break;case"D":t=_.Services.Call.DTMFTone.D;break;case"*":t=_.Services.Call.DTMFTone.STAR;break;case"#":t=_.Services.Call.DTMFTone.POUND;break;default:_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"{0} is not a DTMF symbol",e)}return t},e.prototype.createCMConference=function(e){e=new _.Providers.CM.CMConferenceProvider(this._callProvider,e.getCallId()),e=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.CM_CONFERENCE,e,this._contactsIntegrationService);return new _.Services.Conference.Conference(e)},e.prototype._disconnectCallFromConference=function(e){e.isConference()&&e.getConference()._disconnect()},e.prototype._stopConferenceCall=function(e){e.isConference()&&(e.getConference()._removeOnConferenceAllowVideoDirectionChangedCallback(e._recalculateVideoModeCapabilities.bind(e)),e.getConference()._disconnect(),e.getConference()._isAvailable&&(this._triggerCallbacksAsync(e.getConference()._onConferenceConnectionEndedCallbacks,e.getConference()),e.getConference().stop()),e.getConference()._setCollaboration(T),e._setConference(T))},e.prototype.getAudioDetails=function(e){return this._getCallStatistics(e).then(function(e){return e.audioStatistics})},e.prototype.getVideoDetails=function(e){return this._getCallStatistics(e).then(function(e){return e.videoStatistics})},e.prototype._getCallStatistics=function(e){return this._callProvider.getCallStatistics(e).then(function(e){return{audioStatistics:new _.Services.Call.AudioDetails(e.audioStatistics),videoStatistics:new _.Services.Call.VideoDetails(e.videoStatistics)}}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("_getCallStatistics",_.Services.Analytics.AnalyticsErrorCode.GETTING_CALL_STATISTICS_ERROR),_.Base.Logger.debug(_.Base.LoggerTags.CALL_SERVICE,"Call statistics download fail: ",e.getError()),S.Deferred().reject(e).promise()}.bind(this))},e.prototype.getActiveCall=function(){return this._callManager.getActiveCall()},e.prototype._parseChromeStatistics=function(e){var i,a,r,s,t,n,o;return e.result().forEach(function(e){var t=e.stat("mediaType");"ssrc"===e.type&&-1<e.id.indexOf("send")&&"audio"===t&&(i=e),"ssrc"===e.type&&-1<e.id.indexOf("send")&&"video"===t&&(r=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"audio"===t&&(a=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"video"===t&&(s=e)}),(a||i)&&(t={bytesReceived:parseInt(a?a.stat("bytesReceived"):0),rtcBytesReceived:parseInt(a?a.stat("transportBytesReceived"):0),packetsReceived:parseInt(a?a.stat("packetsReceived"):0),packetsLost:parseInt(a?a.stat("packetsLost"):0),googJitterReceived:parseInt(a?a.stat("googJitterReceived"):0)},n={bytesSent:parseInt(i?i.stat("bytesSent"):0),packetsSent:parseInt(i?i.stat("packetsSent"):0),googRtt:parseInt(i?i.stat("googRtt"):0),packetsLost:parseInt(i?i.stat("packetsLost"):0)},i&&""===i.stat("packetsLost")&&(n.packetsLost=0),i&&""===i.stat("googRtt")&&(n.googRtt=0),n=new _.Services.Call.AudioDetails(t.bytesReceived,n.bytesSent,t.packetsReceived,n.packetsSent,n.googRtt,n.packetsLost,t.packetsLost,t.googJitterReceived)),(s||r)&&(o={bytesReceived:parseInt(s?s.stat("bytesReceived"):0),actualBitRateReceived:T,packetsReceived:parseInt(s?s.stat("packetsReceived"):0),packetsLost:parseInt(s?s.stat("packetsLost"):0),googFrameRateReceived:parseInt(s?s.stat("googFrameRateReceived"):0)},_.Base.Utils.isUndefined(o.packetsLost)&&(o.packetsLost=0),_.Base.Utils.isUndefined(o.packetsReceived)&&(o.packetsReceived=0),0===o.packetsReceived?o.packetsLossFractionReceived=0:o.packetsLossFractionReceived=s.stat("packetsLost")/s.stat("packetsReceived"),t={bytesSent:parseInt(r?r.stat("bytesSent"):0),actualBitRateTransmitted:T,packetsSent:parseInt(r?r.stat("packetsSent"):0),packetsLost:parseInt(r?r.stat("packetsLost"):0),googFrameRateSent:parseInt(r?r.stat("googFrameRateSent"):0)},_.Base.Utils.isUndefined(t.packetsLost)&&(t.packetsLost=0),_.Base.Utils.isUndefined(t.packetsSent)&&(t.packetsSent=0),0===t.packetsSent?t.packetsLossFractionTransmitted=0:t.packetsLossFractionTransmitted=r.stat("packetsLost")/r.stat("packetsSent"),o=new _.Services.Call.VideoDetails(t.bytesSent,o.bytesReceived,t.actualBitRateTransmitted,o.actualBitRateReceived,t.packetsSent,o.packetsReceived,t.packetsLost,o.packetsLost,t.packetsLossFractionTransmitted,o.packetsLossFractionReceived,t.googFrameRateSent,o.googFrameRateReceived)),{audioStatistics:n,videoStatistics:o}},e.prototype._parseFirefoxStatistics=function(e){var t={},i={},a={},r={};return e.forEach(function(e){"audio"===e.mediaType?e.id.includes("inbound_rtp_audio")?(t.bytesReceived=e.bytesReceived,t.packetsReceived=e.packetsReceived,t.packetsLost=e.packetsLost,t.jitterReceived=e.jitter):e.id.includes("outbound_rtp_audio")?(i.bytesSent=e.bytesSent,i.packetsSent=e.packetsSent):e.id.includes("outbound_rtcp_audio")&&(i.mozRtt=e.mozRtt,i.packetsLost=e.packetsLost):"video"===e.mediaType&&(e.id.includes("inbound_rtp_video")?(a.bytesReceived=e.bytesReceived,a.actualBitRateReceived=e.bitrateMean,a.packetsReceived=e.packetsReceived,a.packetsLost=e.packetsLost,a.frameRateReceived=e.framerateMean):e.id.includes("outbound_rtcp_video")?r.packetsLost=e.packetsLost:e.id.includes("outbound_rtp_video")&&(r.bytesSent=e.bytesSent,r.actualBitRateTransmitted=e.bitrateMean,r.packetsSent=e.packetsSent,r.frameRateSent=e.framerateMean))}),_.Base.Utils.isUndefined(i.packetsLost)&&(i.packetsLost=0),_.Base.Utils.isUndefined(i.mozRtt)&&(i.mozRtt=0),e=new _.Services.Call.AudioDetails(t.bytesReceived,i.bytesSent,t.packetsReceived,i.packetsSent,i.mozRtt,i.packetsLost,t.packetsLost,t.jitterReceived),_.Base.Utils.isUndefined(a.packetsLost)&&(a.packetsLost=0),_.Base.Utils.isUndefined(a.packetsReceived)&&(a.packetsReceived=0),0===a.packetsReceived?a.packetsLossFractionReceived=0:a.packetsLossFractionReceived=a.packetsLost/a.packetsReceived,_.Base.Utils.isUndefined(r.packetsLost)&&(r.packetsLost=0),_.Base.Utils.isUndefined(r.packetsSent)&&(r.packetsSent=0),0===r.packetsSent?r.packetsLossFractionTransmitted=0:r.packetsLossFractionTransmitted=r.packetsLost/r.packetsSent,{audioStatistics:e,videoStatistics:new _.Services.Call.VideoDetails(r.bytesSent,a.bytesReceived,r.actualBitRateTransmitted,a.actualBitRateReceived,r.packetsSent,a.packetsReceived,r.packetsLost,a.packetsLost,r.packetsLossFractionTransmitted,a.packetsLossFractionReceived,r.frameRateSent,a.frameRateReceived)}},e.prototype._parseEdgeStatistics=function(e){var t={},i={},a={},r={};return _.Base.Utils.isDefined(e.rtp_audio)&&(t.bytesReceived=T,t.packetsReceived=e.rtp_audio.packetsReceived,t.packetsLost=e.rtp_audio.packetsLost,t.jitterReceived=e.rtp_audio.jitter),_.Base.Utils.isDefined(e.rtp_audio)&&(i.bytesSent=T,i.packetsSent=e.rtp_audio.packetsSent,i.packetsLost=e.rtp_audio.packetsLost),t=new _.Services.Call.AudioDetails(t.bytesReceived,i.bytesSent,t.packetsReceived,i.packetsSent,i.mozRtt,i.packetsLost,t.packetsLost,t.jitterReceived),_.Base.Utils.isDefined(e.rtp_video)&&(a.bytesReceived=T,a.packetsReceived=e.rtp_video.packetsReceived,a.packetsLost=e.rtp_video.packetsLost,a.frameRateReceived=e.rtp_video.frameRateReceived),a.packetsLossFractionReceived=e.rtp_video.fractionLost,_.Base.Utils.isDefined(e.rtp_video)&&(r.packetsLost=e.rtp_video.packetsLost,r.bytesSent=T,r.packetsSent=e.rtp_video.packetsSent,r.frameRateSent=e.rtp_video.frameRateSent),r.packetsLossFractionTransmitted=T,{audioStatistics:t,videoStatistics:new _.Services.Call.VideoDetails(r.bytesSent,a.bytesReceived,r.actualBitRateTransmitted,a.actualBitRateReceived,r.packetsSent,a.packetsReceived,r.packetsLost,a.packetsLost,r.packetsLossFractionTransmitted,a.packetsLossFractionReceived,r.frameRateSent,a.frameRateReceived)}},e.prototype._ringbackToneURLsChangedHandler=function(e){this._calls&&this._triggerCallbacksAsync(this._calls._onRingbackToneURLsChangedCallback,e)},e.prototype._answerCallRequestedHandler=function(e){this._triggerCallbacksAsync(e._answerCallRequestedCallbacks,e)},e.prototype._terminateCallRequestedHandler=function(e){this._triggerCallbacksAsync(e._terminateCallRequestedCallbacks,e)},e.prototype._updateCallRequestedHandler=function(e,t){this._triggerCallbacksAsync(e._updateCallRequestedCallbacks,e,t)},e.prototype._makeCallRequestedHandler=function(e,t,i,a,r){r=this._callManager.createMakeCall(this,e,t,i,a,r);this._callProvider.registerIncomingOrRemoteCall(r),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.MAKE_CALL_REQUESTED,[r])},e.prototype._callMediaFailedHandler=function(e){e._setState(_.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(e._mediaFailedCallbacks,e)},e.prototype._isMakeCallAllowed=function(e){return!!(e._isDataOnly()||this._isCollabCall(e)||this._isWebRTCSupportedBrowser()&&this._config.mediaConfiguration.mediaEngineEnabled)},e.prototype._isCollabCallCapable=function(e){var t=e.getVideoChannels(),e=e.getAudioChannel(),e=!!e&&e.getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE,t=!t||0===t.length||t[0].getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE;return e&&t},e.prototype._isCollabCall=function(e){return this.isWebCollaborationEnabled(e)&&this._isCollabCallCapable(e)},e.prototype._isWebRTCSupportedBrowser=function(){var e=_.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),e=_.Base.Utils.isWebRTC_SupportedBrowser(e);return this._callProvider.isNailedUpVideoConnectionRequired()?e&&this._callProvider.isServerSupportsNailedUpVideoConnection():e},e.prototype._createEndCallEvent=function(e,t){var i;if(e)if(t&&t.getCause()){if(i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_DISCONNECTED_UNKNOWN_REASON,t.getProtocol(),t.getCause(),t.getText()),"avaya-action"===t.getProtocol())switch(t.getCause()){case 200:i._setReason(_.Services.Call.CallEndReason.DISCONNECTED_BY_CONFERENCE_MODERATOR);break;case 201:i._setReason(_.Services.Call.CallEndReason.CONFERENCE_TERMINATED);break;case 202:i._setReason(_.Services.Call.CallEndReason.CALL_DISCONNECTED);break;case 450:i._setReason(_.Services.Call.CallEndReason.DTLS_FAILURE);break;case 451:i._setReason(_.Services.Call.CallEndReason.ICE_FAILURE)}}else i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_DISCONNECTED);else i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_ENDED_LOCALLY);return i},e.prototype.uploadLogs=function(){if(this._config.mediaServiceContext){if(this._uploadLoggerProvider){this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer);var e=function(){return this._remoteLoggerProvider.uploadLogs(_.Providers.RemoteLogger.Names.MPAAS).fail(function(e){_.Base.Logger.error("Failed to upload logs",e)})}.bind(this);return this._uploadIntervalTimer=setInterval(function(){e()},72e5),e()}return _.Base.Logger.error("Uninitialized remote logger provider"),S.Deferred().reject("Uninitialized remote logger provider").promise()}},e.prototype.isRegistrationTerminated=function(){return this._isRegistrationTerminated},e.prototype.setOnNetworkEvents=function(e,t){return this._callProvider.setOnNetworkEvents(e,t)},e.prototype.isNetworkEventsUrlDefined=function(){return this._callProvider.isNetworkEventsUrlDefined()},e.prototype.removeOnNetworkEvents=function(){return this._callProvider.removeOnNetworkEvents()},e.prototype.isMediaConnected=function(e){return this._callProvider.isMediaConnected(e)},e.prototype.updatePreferredResolution=function(e,t){return!1===this._isSupportedResolution(t)?S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.FAILED)).promise():!1===e._call._preferredResolutionCapability.isAllowed?S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise():this._callProvider.updatePreferredResolution(e,t)},e.prototype.setPreferredReceiveResolution=function(e,t,i){return e._preferredReceiveResolutionCapability.isAllowed?0<S.map(_.Base.VideoResolution,function(e,t){return t===i?e:T}).length?this._callProvider.setPreferredReceiveResolution(e,t,i):S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.NOT_FOUND)).promise():S.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype._isSupportedResolution=function(e){return e in _.Base.VideoResolution},e.prototype._limitedVideoResolutionStoring=function(e){if(!e){if(!this._calls||!this._calls.getCalls().length||!this._callManager.getActiveCall()&&!this._callManager.getEndingCall())return;e=this._callManager.getActiveCall()||this._callManager.getEndingCall()}var t=new _.Base.VideoResolutionDetails,i=this.getVideoResolution(e)&&t.convertToConfigVideoResolution(this.getVideoResolution(e)),a=this.getVideoSendResolution(e)&&t.convertToConfigVideoResolution(this.getVideoSendResolution(e)),t=_.Base.Utils;this.isEnoughCallMinutesPassed(e,10)&&a&&t.toNumber(t.cutNumberFromString(a))<=t.toNumber(t.cutNumberFromString(i))&&this._setVideoResolutionToLocalStorage(i,a)},e.prototype.isEnoughCallMinutesPassed=function(e,t){e=e.getEstablishedTime(),e=new Date-e;return t<=Math.round(e%864e5%36e5/6e4)},e.prototype._setVideoResolutionToLocalStorage=function(t,e){var i=_.Base.Storage,a=i.get(i.TYPES.LOCAL,i.KEYS.VIDEO_RESOLUTIONS),r=(a=!Array.isArray(a)?[]:a).find(function(e){return e.negotiate===t});r&&Array.isArray(r.limited)||(r={negotiate:t,limited:[]}),Array.isArray(r.limited)&&5<=r.limited.length&&r.limited.shift(),r.limited.push(e);e=a.findIndex(function(e){return e.negotiate===t});-1<e?a[e]=r:a.push(r),i.set(i.TYPES.LOCAL,i.KEYS.VIDEO_RESOLUTIONS,a)},e.prototype._getAverageLimitedResolution=function(e){var i=_.Base.Utils.getAverageValueFromArray(e),e=Object.keys(_.Base.VideoResolution).reduce(function(e,t){return"number"!=typeof e&&(e=_.Base.Utils.toNumber(_.Base.Utils.cutNumberFromString(e))),"number"!=typeof t&&(t=_.Base.Utils.toNumber(_.Base.Utils.cutNumberFromString(t))),Math.abs(t-i)!==Math.abs(e-i)&&Math.abs(t-i)<Math.abs(e-i)?t:e});return _.Base.VideoResolution["resolution"+e+"p"]},e.prototype.setNoiseReduction=function(e,t){var i=S.Deferred();return e.getSetNoiseReductionCapability().isAllowed?(e._noiseReductionSetting=t,i.resolve()):i.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),i.promise()},e.prototype.setBackgroundBlur=function(e,t){if(e.getSetBackgroundBlurCapability().isAllowed){t&&(e._backgroundImage=T),e._backgroundBlur=t,e.getSetBackgroundBlurCapability()._recalculate(),e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING);return this._callProvider.setBackgroundBlur(e,t).always(function(){e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)})}t=S.Deferred();return t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),t.promise()},e.prototype.setBackgroundImage=function(e,t){if(e.getSetBackgroundImageCapability().isAllowed){t&&(e._backgroundBlur=!1),e._backgroundImage=t,e.getSetBackgroundImageCapability()._recalculate(),e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING);return this._callProvider.setBackgroundImage(e,t).always(function(){e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)})}t=S.Deferred();return t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),t.promise()},e.prototype.isMediaProcessingSupported=function(){return this._mediaServicesFactory.getMediaServicesService().isMediaProcessingSupported()},_.Services.Call.CallService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallStates={FAR_END_RENEGOTIATING:"far_end_renegotiating",IDLE:"idle",IGNORED:"ignored",INITIATING:"initiating",REMOTE_ALERTING:"remote_alerting",RENEGOTIATING:"renegotiating",FAILED:"failed",ALERTING:"alerting",HELD:"held",ENDED:"ended",ENDING:"ending",HOLDING:"holding",UNHOLDING:"unholding",ESTABLISHED:"established",BEING_TRANSFERRED:"being_transferred",TRANSFERRING:"transferring"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallType={CallTypeDefaultRegisteredService:"DefaultRegisteredService",CallTypeHttpMeetMe:"HttpMeetMe"}}(),function(n){"use strict";function e(e,t,i,a,r,s){-1===t.indexOf(e.getState())?n.Base.Capability.call(this,n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):n.Base.Capability.call(this,n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._call=e,this._validCallStates=t,this._mediaPreservedAllowed=i,this._validForRemote=a,this._validForLocal=r,this._validForBrowsers=s,e._addOnCallStateChangedCallback(this._recalculate.bind(this)),e.addOnCallServiceAvailableCallback(this._recalculate.bind(this)),e.addOnCallServiceUnavailableCallback(this._recalculate.bind(this)),e.addOnCallJoinedCallback(this._recalculate.bind(this))}(e.prototype=Object.create(n.Base.Capability.prototype))._recalculateDenialReason=function(){var e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return-1===this._validCallStates.indexOf(this._call.getState())||!this._mediaPreservedAllowed&&!this._call.isServiceAvailable()&&this._call.getState()!==n.Services.Call.CallStates.IDLE?e=n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE:this._call.isRemote()&&!this._validForRemote?e=n.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_REMOTE:this._call.isRemote()||this._validForLocal?this._isSupportedBrowser()?this._call._isDataOnly()&&(e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED:e=n.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_NOT_REMOTE,e},e.prototype._recalculate=function(){var e=this._recalculateDenialReason(),t=e===n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._updateIfChanged(t,e)},e.prototype._isSupportedBrowser=function(){var e=n.Base.Utils.getBrowserType();return!this._validForBrowsers||-1!==this._validForBrowsers.indexOf(e)},n.Services.Call.Capabilities.AbstractCallStateCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){r.Base.Capability.call(this,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._callService=e}(e.prototype=Object.create(r.Base.Capability.prototype))._recalculate=function(){var e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=!0,i=this._callService.isServiceAvailable(),a=this._callService.isNetworkEventsUrlDefined();i&&a||(t=!1,e=r.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.AbstractNetworkEventsCapability=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallHeldRemotelyCallback(this._recalculate.bind(this)),e.addOnCallUnheldRemotelyCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),o.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,a,r,s,n)}(e.prototype=Object.create(o.Services.Call.Capabilities.AbstractCallStateCapability.prototype)).isAllowedNailedUpVideoMode=function(e){var t=this._call._getAllowedNailedUpVideoModes();return!(0<t.length)||t.includes(e)},e.prototype._recalculate=function(){var e=o.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=this._call._conference,i=i?i._allowVideoDirection:T;t&&this._call._getIsContentVideoSharingStarted()&&(t=!1,e=o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),t&&o.Base.Utils.isDefined(i)&&o.Base.Utils.isDefined(this._allowVideoDirections)&&(e=-1<this._allowVideoDirections.indexOf(i)?(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED));i=this._isDirectionAllowed();!t||!this._call.isHeldRemotely()&&this._videoCapability.isAllowed&&i||(t=!1,e=this._videoCapability.isAllowed?o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason);i=!o.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==o.Services.Call.MediaDirection.DISABLE;t&&!i&&(t=!1,e=o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},o.Services.Call.Capabilities.AbstractUpdateVideoModeCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){var i=[a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!0,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._denyDataOnlyConference=function(e,t){e&&this._call._isDataOnly()&&(e=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},e.prototype._recalculateDenialReason=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return this._denyDataOnlyConference(t,e),this._updateIfChanged(t,e),e},a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.ESTABLISHED],i=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0,i)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.HoldCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.ESTABLISHED,r.Services.Call.CallStates.HELD];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!0,!1)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.JoinCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&this._call._videoMuteState===i.Services.Call.MediaMuteStates.MUTED&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.MuteVideoCapability=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,e)}e.prototype=Object.create(t.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),t.Services.Call.Capabilities.RemoveOnNetworkEventsCapability=e}(AvayaClientServices),function(s){"use strict";function e(e){var t=[s.Services.Call.CallStates.ESTABLISHED,s.Services.Call.CallStates.RENEGOTIATING,s.Services.Call.CallStates.FAR_END_RENEGOTIATING],i=[s.Base.BrowserType.CHROME,s.Base.BrowserType.FIREFOX];s.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0,i)}(e.prototype=Object.create(s.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(e){var t=s.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),i=t===s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,a=!s.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==s.Services.Call.MediaDirection.DISABLE,r=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==s.Services.Call.MediaDirection.DISABLE;!i&&e&&this._call.getState()===s.Services.Call.CallStates.REMOTE_ALERTING&&(i=!0,t=s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),!i||a||r||(i=!1,t=s.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(i,t)},s.Services.Call.Capabilities.SendDTMFCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Base.Capability.call(this,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._call=e}(e.prototype=Object.create(i.Base.Capability.prototype))._recalculate=function(){var e=!1,t=i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED;this._isSupportedByBrowser()&&this._isSupportedByCallType()&&(e=!0,t=i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateIfChanged(e,t)},e.prototype._isSupportedByBrowser=function(){var e=i.Base.Utils.getBrowserType();return e!==i.Base.BrowserType.IE&&e!==i.Base.BrowserType.EDGE},e.prototype._isSupportedByCallType=function(){return!1===this._call._isDataOnly()},i.Services.Call.Capabilities.ServiceQualityScoreCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.INITIATING,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED,r.Services.Call.CallStates.HELD],a=[r.Base.BrowserType.CHROME];this._callService=t,r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!1,!1,!0,a),this._recalculate()}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this);return e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED&&(this._callService.isMediaProcessingSupported()||this._call.isBackgroundBlur()?window.navigator.hardwareConcurrency&&window.navigator.hardwareConcurrency<4&&(e=r.Base.CapabilityDenialReason.CAPABILITY_HARDWARE_NOT_SUPPORTED):e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),e},r.Services.Call.Capabilities.SetBackgroundBlurCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE],i=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0,i)}e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype),a.Services.Call.Capabilities.SetNoiseReductionCapability=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,e)}e.prototype=Object.create(t.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),t.Services.Call.Capabilities.SetOnNetworkEventsCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){var t=[i.Services.Call.CallStates.ESTABLISHED,i.Services.Call.CallStates.HELD];e.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),i.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&(this._call.isConference()||i.Base.Utils.isDefined(this._call._sessionId))&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===t&&!1===this._isAllowedByProvider()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},e.prototype._isAllowedByProvider=function(){if(this._call._callCreationInfo===T||typeof this._call._callCreationInfo.getServiceGatewayURL!=typeof Function.prototype)return!0;var e=this._call._callCreationInfo.getServiceGatewayURL();if(e===T)return!0;e=i.Base.Utils.parseUrl(e),e=i.Base.Utils.getHost(e),e=this._call._callService._callProvider._csgwProviderFactory.getCSGCallsProvider(e);return null===e||e.isAllowedToTransfer(this._call.getCallId())},i.Services.Call.Capabilities.TransferCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){var t=[i.Services.Call.CallStates.ESTABLISHED,i.Services.Call.CallStates.HELD];e.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),i.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&(this._call.isConference()||i.Base.Utils.isDefined(this._call._sessionId))&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===t&&!1===this._isAllowedByProvider()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},e.prototype._isAllowedByProvider=i.Services.Call.Capabilities.TransferCapability.prototype._isAllowedByProvider,i.Services.Call.Capabilities.TransferToCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.HELD],i=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0,i)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.UnholdCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&this._call._videoMuteState!==i.Services.Call.MediaMuteStates.MUTED&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.UnmuteVideoCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=a.Base.Utils.isDefined(this._call._callCreationInfo)&&a.Base.Utils.isDefined(this._call._callCreationInfo.getUccpURL());!t||a.Base.Utils.isDefined(this._call._sessionId)||i||(t=!1,e=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},a.Services.Call.Capabilities.UpdateAudioModeCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e,t=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),i=t===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return i&&(this._videoCapability.isAllowed?0<(e=this._call.getVideoChannels()).length&&(e[0].getNegotiatedDirection()===r.Services.Call.MediaDirection.SEND_RECV||e[0].getNegotiatedDirection()===r.Services.Call.MediaDirection.RECV_ONLY)||(i=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):(i=!1,t=this._videoCapability.denialReason)),this._updateIfChanged(i,t),t},r.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.prototype))._save=function(e,t){return this._updateIfChanged(e,t),t},e.prototype._recalculateDenialReason=function(){if(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this)!==i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)return this._save(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);if(!0!==this._videoCapability.isAllowed)return this._save(!1,this._videoCapability.denialReason);var e=this._call.getVideoChannels();if(0<e.length&&~[i.Services.Call.MediaDirection.RECV_ONLY,i.Services.Call.MediaDirection.SEND_RECV,i.Services.Call.MediaDirection.SEND_ONLY].indexOf(e[0].getNegotiatedDirection()))return this._save(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);return this._save(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},i.Services.Call.Capabilities.UpdatePreferredResolutionCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this));t=[r.Services.Call.CallStates.ESTABLISHED];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||!this._call._isDataOnly()&&this._videoCapability.isAllowed&&(i||a)||(t=!1,e=this._call._isDataOnly()?r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.UpdateVideoChannelsCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.IGNORED,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI,r.Base.BrowserType.IE];r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=0<e.length&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.INACTIVE&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,e=r.Base.Utils.getBrowserType()===r.Base.BrowserType.SAFARI;return t&&!(e&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(r.Services.Call.VideoMode.DISABLE)},r.Services.Call.Capabilities.UpdateVideoModeDisableCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.SEND_ONLY,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY,a.Services.Conference.AllowVideoDirection.INACTIVE];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels();return 0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.INACTIVE&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.INACTIVE)},a.Services.Call.Capabilities.UpdateVideoModeInactiveCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels();return(0===e.length&&this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED||0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.RECV_ONLY)&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.RECEIVE_ONLY)},a.Services.Call.Capabilities.UpdateVideoModeReceiveOnlyCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){this._allowVideoDirections=[r.Services.Conference.AllowVideoDirection.SEND_RECEIVE,r.Services.Conference.AllowVideoDirection.SEND_ONLY];var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.IGNORED,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=0===e.length&&this._call.getState()!==r.Services.Call.CallStates.ESTABLISHED||0<e.length&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.SEND_ONLY&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.RECV_ONLY,e=r.Base.Utils.getBrowserType()===r.Base.BrowserType.SAFARI;return t&&!(e&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(r.Services.Call.VideoMode.SEND_ONLY)},r.Services.Call.Capabilities.UpdateVideoModeSendOnlyCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=-1!==[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI].indexOf(a.Base.Utils.getBrowserType()),i=0===e.length&&(t||this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED)||0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.SEND_RECV,t=!1;return a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI&&0!==e.length&&(t=e[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.SEND_ONLY&&this._call.getEstablishedTime()),i&&!t&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.SEND_RECEIVE)},a.Services.Call.Capabilities.UpdateVideoModeSendReceiveCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=this._call._callService._config&&this._call._callService._config.wcsConfiguration&&this._call._callService._config.wcsConfiguration.enabled;t&&!i&&(t=!1,e=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},a.Services.Call.Capabilities.UpdateWebCollaborationCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){r.Base.Capability.call(this,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._calls=e}(e.prototype=Object.create(r.Base.Capability.prototype))._recalculate=function(){var e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=!0,i=this._calls._isWebRTCSupportedBrowser(),a=this._calls._isRegistrationTerminated();this._calls._isAvailable&&i&&!a||(t=!1,e=a?r.Services.Call.CallError.REGISTRATION_TERMINATED:i?r.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE:r.Services.Call.CallError.WEBRTC_NOT_SUPPORTED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.VoipCallingCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){this._token=e,this._isOTT=!!r.Base.Utils.isDefined(t)&&t,this._meetingId=r.Base.Utils.isDefined(i)?i:null,this._passcode=r.Base.Utils.isDefined(a)?a:null}e.prototype={getToken:function(){return this._token},setToken:function(e){this._token=e},isOTT:function(){return this._isOTT},enableOTT:function(e){this._isOTT=e,this._isWebRTCAbleConf=this._isOTT},getMeetingId:function(){return this._meetingId},setMeetingId:function(e){this._meetingId=e},getPasscode:function(){return this._passcode},setPasscode:function(e){this._passcode=e}},r.Services.Call.ConferenceEntryOptions=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.DTMFTone={A:"A",B:"B",C:"C",D:"D",STAR:"*",POUND:"#",ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,ZERO:0}}(),function(t){"use strict";var e={RECV_ONLY:"recvonly",SEND_ONLY:"sendonly",SEND_RECV:"sendrecv",INACTIVE:"inactive",DISABLE:"disable",UNDEFINED:"undefined",_isDisabled:function(e){return e===t.Services.Call.MediaDirection.DISABLE||e===t.Services.Call.MediaDirection.UNDEFINED}};t.Services.Call.MediaDirection=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.MediaMuteStates={UNDEFINED:0,MUTED:1,UNMUTED:2}}(),function(e){"use strict";function t(e,t){this.call=e,this.id=t}t.prototype.startCall=function(e){},t.prototype.endCall=function(e){},e.Services.Call.Modes.AbstractCallMode=t}(AvayaClientServices),function(r){"use strict";function e(e,t,i){r.Services.Call.Modes.AbstractCallMode.call(this,e,t),this._contactsIntegrationService=i}(e.prototype=Object.create(r.Services.Call.Modes.AbstractCallMode.prototype)).startCall=function(e){if(this._createDataOnlyConference(e),r.Base.Utils.isDefined(e._callCreationInfo)&&r.Base.Utils.isDefined(e._callCreationInfo.getUccpURL())){var t=e._callCreationInfo.getUccpURL(),i=e._callService._parseUccpUrl(t);if(!r.Base.Utils.isDefined(i))return r.Base.Logger.error(r.Base.LoggerTags.CALL_SERVICE,"Failed to parse UCCP url: "+t),void e._callService._notifyCallFailure(e,r.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE);e._onCallStartedCallbacks.fire(e),e._onCallEstablishedCallbacks.fire(e),e._conference._setConfiguration(i)}e._callService.createCollaborationForConference(e),e._onCallConferenceStatusChangedCallbacks.fire(e,!0,t)},e.prototype.endCall=function(e){e.getConference()._conferenceService.sendDisconnectEvent(),e.getConference().stop(),e._setState(r.Services.Call.CallStates.ENDED);var t=new r.Services.Call.CallEndEvent(r.Services.Call.CallEndReason.CALL_DISCONNECTED);e._onCallEndedCallbacks.fire(e,t),e._callService._callManager.deleteCall(e)},e.prototype._createDataOnlyConference=function(e){var t=e._callService.getScopiaConferenceProvider(),i=e._callService.createChatService(t),a=e._callService.createParticipantService(t),i=new r.Services.Conference.Chat(i),t=new r.Services.Conference.ConferenceService(r.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,t,this._contactsIntegrationService);e._setConference(new r.Services.Conference.Conference(t,a,i)),e._conference._isUccpConference=!0;i=e._callCreationInfo.getPasscode();e._conference._setPreEnteredPasscode(i)},r.Services.Call.Modes.ConferenceCallMode=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.NoiseReductionSetting={ENABLED:"ENABLED",DISABLE_CLIENT:"DISABLE_CLIENT",PREFER_CLIENT:"PREFER_CLIENT",DISABLE_ALL:"DISABLE_ALL"}}(),function(e){"use strict";function t(){this.ringback=T,this.intercept=T,this.reorder=T,this.fastBusy=T}t.prototype._setRingbackToneUrl=function(e){this.ringback=e},t.prototype.getRingbackToneUrl=function(){return this.ringback},t.prototype._setInterceptToneUrl=function(e){this.intercept=e},t.prototype.getInterceptToneUrl=function(){return this.intercept},t.prototype._setReorderToneUrl=function(e){this.reorder=e},t.prototype.getReorderToneUrl=function(){return this.reorder},t.prototype._setFastBusyToneUrl=function(e){this.fastBusy=e},t.prototype.getFastBusyToneUrl=function(){return this.fastBusy},e.Services.Call.RingbackToneURLs=t}(AvayaClientServices),function(t){"use strict";var i=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,max:3},{score:t.Base.AbsoluteCategoryRating.GOOD,max:7},{score:t.Base.AbsoluteCategoryRating.FAIR,max:10},{score:t.Base.AbsoluteCategoryRating.POOR,max:15},{score:t.Base.AbsoluteCategoryRating.BAD}],a=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,max:1},{score:t.Base.AbsoluteCategoryRating.GOOD,max:3},{score:t.Base.AbsoluteCategoryRating.FAIR,max:5},{score:t.Base.AbsoluteCategoryRating.POOR,max:10},{score:t.Base.AbsoluteCategoryRating.BAD}],r=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,min:95},{score:t.Base.AbsoluteCategoryRating.GOOD,min:75},{score:t.Base.AbsoluteCategoryRating.FAIR,min:50},{score:t.Base.AbsoluteCategoryRating.POOR,min:25},{score:t.Base.AbsoluteCategoryRating.BAD}];function e(e){this._call=e,this._bound=!1,this._score=T,this._onScoreChangedCallbacks=S.Callbacks(),this._updateScoreInterval=T,this._previousAudioReport=T,this._previousVideoReport=T,this._previousTimestamp=T,this._allowedStates=[t.Services.Call.CallStates.ESTABLISHED,t.Services.Call.CallStates.RENEGOTIATING,t.Services.Call.CallStates.FAR_END_RENEGOTIATING],this._allowedIncomingVideoModes=[t.Services.Call.MediaDirection.SEND_RECV,t.Services.Call.MediaDirection.RECV_ONLY],this._allowedOutgoingVideoModes=[t.Services.Call.MediaDirection.SEND_RECV,t.Services.Call.MediaDirection.SEND_ONLY]}e.prototype.watch=function(){return this._canBeBound()&&(this._call.addOnCallStartedCallback(this._start.bind(this)),this._call.addOnCallEstablishedCallback(this._start.bind(this)),this._call.addOnCallHeldCallback(this._stop.bind(this)),this._call.addOnCallUnheldCallback(this._start.bind(this)),this._call.addOnCallEndedCallback(this._stop.bind(this)),this._bound=!0),this._bound},e.prototype.getScore=function(){return this._score},e.prototype.addOnScoreChangedCallback=function(e){this._onScoreChangedCallbacks.add(e)},e.prototype.removeOnScoreChangedCallback=function(e){this._onScoreChangedCallbacks.remove(e)},e.prototype._canBeBound=function(){return!0===this._call.getServiceQualityScoreCapability().isAllowed&&!1===this._bound},e.prototype._start=function(){var e=S.Deferred();e.then(function(){t.Base.Utils.isUndefined(this._updateScoreInterval)&&(this._updateScoreInterval=setInterval(this._updateScore.bind(this),5e3))}.bind(this)),this._updateScore(e)},e.prototype._stop=function(){clearInterval(this._updateScoreInterval),this._updateScoreInterval=T,this._previousAudioReport=T,this._previousVideoReport=T,this._previousTimestamp=T,this._setScore(T)},e.prototype._updateScore=function(e){this._call._callService._getCallStatistics(this._call).then(function(e){var t=Date.now(),i=this._getScoreForAudio(e.audioStatistics,t),e=this._getScoreForVideo(e.videoStatistics,t);this._previousTimestamp=t,this._setScore(this._getTotalScore(i,e))}.bind(this)).always(function(){e!==T&&e.resolve()})},e.prototype._getScoreForAudio=function(e){var t=this._getPacketLossScore(e,this._previousAudioReport,i);return this._previousAudioReport=e,t},e.prototype._getScoreForVideo=function(e,t){var i=this._getPacketLossScore(e,this._previousVideoReport,a),t=this._getBitrateScore(e,this._previousVideoReport,r,t),t=this._getTotalScore(i,t);return this._previousVideoReport=e,t},e.prototype._getPacketLossScore=function(e,t,i){var a=this._getIncomingLosses(e,t),t=this._getOutgoingLosses(e,t);return a===T&&t===T?T:a===T?this._packetLossToScore(t,i):t===T?this._packetLossToScore(a,i):this._packetLossToScore(Math.max(a,t),i)},e.prototype._getBitrateScore=function(e,t,i,a){var r=this._getIncomingBitrate(e,t,a),a=this._getOutgoingBitrate(e,t,a);return r===T&&a===T?T:r===T?this._bitrateRatioToScore(a,i):a===T?this._bitrateRatioToScore(r,i):this._bitrateRatioToScore(Math.min(r,a),i)},e.prototype._getIncomingLosses=function(e,t){var i,a;return t!==T&&(i=t.packetsReceived,a=t.packetLossTotalReceived),this._getLosses(e.packetsReceived,e.packetLossTotalReceived,i,a)},e.prototype._getOutgoingLosses=function(e,t){var i,a;return t!==T&&(i=t.packetsTransmitted,a=t.packetLossTotalTransmitted),this._getLosses(e.packetsTransmitted,e.packetLossTotalTransmitted,i,a)},e.prototype._getLosses=function(e,t,i,a){return t===T||0===t?t:t===a?0:("number"==typeof i&&"number"==typeof a&&(e-=i,t-=a),t/e*100)},e.prototype._packetLossToScore=function(e,t){for(var i=0;i<t.length;++i)if(t[i].max===T||e<=t[i].max)return t[i].score;return T},e.prototype._getOutgoingBitrate=function(e,t,i){var a;return this._isOutgoingVideoActive()?(i=e.availableTransmitBitrate!==T?(a=this._getAvailableOutgoingBitrate(e),this._getExpectedVideoBitrate()):(a=this._getBitrateTrasmitted(e,t,i),this._getExpectedVideoSendBitrate()),a===T||i===T?T:this._getBitrateRatio(a,i)):T},e.prototype._getIncomingBitrate=function(e,t,i){if(!this._isIncomingVideoActive())return T;if(!this._call.isMediaConnected())return 0;var a=this._getExpectedVideoBitrate();return(i=e.availableReceiveBitrate!==T?this._getAvailableIncomingBitrate(e):this._getBitrateReceived(e,t,i))===T||a===T||0<(a=this._getBitrateRatio(i,a))&&a<=10?T:a},e.prototype._getAvailableOutgoingBitrate=function(e){return e.availableTransmitBitrate},e.prototype._getAvailableIncomingBitrate=function(e){return e.availableReceiveBitrate},e.prototype._getBitrateTrasmitted=function(e,t,i){var a;return t&&(a=t.bytesTransmitted),this._getBitrate(e.bytesTransmitted,a,i)},e.prototype._getBitrateReceived=function(e,t,i){var a;return t&&(a=t.bytesReceived),this._getBitrate(e.bytesReceived,a,i)},e.prototype._getBitrate=function(e,t,i){return e===T||t===T?T:e===t?0:(e-t)/((i-this._previousTimestamp)/1e3)*8},e.prototype._getBitrateRatio=function(e,t){return e===T||t===T?T:e/t*100},e.prototype._bitrateRatioToScore=function(e,t){for(var i=0;i<t.length;++i)if(t[i].min===T||e>=t[i].min)return t[i].score;return T},e.prototype._getExpectedVideoBitrate=function(){var e=this._call._callService.getVideoBandwidth(this._call);return e!==T?1e3*e:T},e.prototype._isVideoActive=function(e,t){var i=this._call.getVideoChannels();if(0<i.length){i=i[0].getNegotiatedDirection();if(-1!==e.indexOf(this._call.getState())&&-1!==t.indexOf(i))return!0}return!1},e.prototype._isIncomingVideoActive=function(){return this._isVideoActive(this._allowedStates,this._allowedIncomingVideoModes)},e.prototype._isOutgoingVideoActive=function(){return this._call._videoMuteState!==t.Services.Call.MediaMuteStates.MUTED&&this._isVideoActive(this._allowedStates,this._allowedOutgoingVideoModes)},e.prototype._getExpectedVideoSendBitrate=function(){var e=this._call._callService.getVideoSendBandwidth(this._call);return e!==T?1e3*e:T},e.prototype._getTotalScore=function(e,t){return e===T&&t===T?T:e===T?t:t===T?e:Math.min(e,t)},e.prototype._setScore=function(e){this._score!==e&&(this._score=e,this._onScoreChangedCallbacks.fire(e))},t.Services.Call.ServiceQuality=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.TransferProgressCode={ACCEPTED:"ACCEPTED",NONE:"NONE",REMOTE_CALL_ESTABLISHED:"REMOTE_CALL_ESTABLISHED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",REMOTE_CALL_STARTED:"REMOTE_CALL_STARTED",STARTED:"STARTED"}}(),function(){"use strict";function e(e,t,i){this._ucid=e,this._parentUcid=t,this._contextId=i}e.prototype={getUCID:function(){return this._ucid},getParentUCID:function(){return this._parentUcid},getContextId:function(){return this._contextId},setContextId:function(e){this._contextId=e},_setUCID:function(e){this._ucid=e},_setParentUCID:function(e){this._parentUcid=e}},AvayaClientServices.Services.Call.UserToUserInfo=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.VideoChannelDisabledReason={NONE:"none",DISABLED_BY_LOCAL_USER:"disabledByLocalUser",DISABLED_BY_REMOTE_USER:"disabledByRemoteUser",DISABLED_DUE_TO_CPU_OVERLOAD:"disabledDueToCpuOverload",DISABLED_DUE_TO_INSUFFICIENT_BANDWIDTH:"disabledDueToInsufficientBandwidth",DISABLED_DUE_TO_LOCAL_PLATFORM_LIMITATIONS:"disabledDueToLocalPlatformLimitations",DISABLED_DUE_TO_LOCAL_LAYOUT_SELECTION:"disabledDueToLocalLayoutSelection",DISABLED_DUE_TO_MISSING_H264_PLUGIN:"disabledDueToMissingH264Plugin"}}(),function(){"use strict";(AvayaClientServices||{}).Services.Call.VideoDetails=function(e){this.bytesTransmitted=e.bytesTransmitted,this.bytesReceived=e.bytesReceived,this.actualBitRateTransmitted=e.actualBitRateTransmitted,this.actualBitRateReceived=e.actualBitRateReceived,this.packetsTransmitted=e.packetsTransmitted,this.packetsReceived=e.packetsReceived,this.packetLossTotalTransmitted=e.packetLossTotalTransmitted,this.packetLossTotalReceived=e.packetLossTotalReceived,this.packetsLossFractionTransmitted=e.packetsLossFractionTransmitted,this.packetsLossFractionReceived=e.packetsLossFractionReceived,this.actualFrameRateTransmitted=e.actualFrameRateTransmitted,this.actualFrameRateReceived=e.actualFrameRateReceived,this.codec=e.codec,this.roundTripTimeMillis=e.roundTripTimeMillis,this.heightTransmitted=e.heightTransmitted,this.heightReceived=e.heightReceived,this.widthTransmitted=e.widthTransmitted,this.widthReceived=e.widthReceived,this.firCountTransmitted=e.firCountTransmitted,this.firCountReceived=e.firCountReceived,this.pliCountTransmitted=e.pliCountTransmitted,this.pliCountReceived=e.pliCountReceived,this.framesTransmitted=e.framesTransmitted,this.framesReceived=e.framesReceived,this.nackCountTransmitted=e.nackCountTransmitted,this.nackCountReceived=e.nackCountReceived,this.availableTransmitBitrate=e.availableTransmitBitrate,this.availableReceiveBitrate=e.availableReceiveBitrate,this.jitterMillisecondsReceived=e.jitterMillisecondsReceived,this.framesEncoded=e.framesEncoded,this.framesDecoded=e.framesDecoded,this.totalEncodeTime=e.totalEncodeTime,this.totalDecodeTime=e.totalDecodeTime}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoMode={SEND_RECEIVE:"SEND_RECEIVE",RECEIVE_ONLY:"RECEIVE_ONLY",SEND_ONLY:"SEND_ONLY",INACTIVE:"INACTIVE",DISABLE:"DISABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoNetworkSignalingType={INDEFINITE:"indefinite",OFF:"off",SUPPORTED:"supported"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="CollaborationError"}e.prototype=Object.create(i.Base.BaseError.prototype),i.Services.Collaboration.CollaborationError=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.CollaborationErrorReason={COLLABORATION_START_FAILURE:"Failed to start collaboration.",COLLABORATION_STOP_FAILURE:"Failed to stop collaboration.",COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",BROWSER_NOT_SUPPORTED:"Browser is not supported",WHITEBOARD_REMOVE_LAST_SURFACE:"Failed to remove surface. You cannot remove last surface.",WHITEBOARD_REMOVE_SURFACE_FAILED:"Failed to remove surface.",WHITEBOARD_REMOVE_SHAPE_NOT_MINE:"Failed to remove shape. You can only remove shapes that you drew.",WHITEBOARD_ALREADY_ACTIVE:"Failed to start whiteboard surface. Surface is already started.",WHITEBOARD_INACTIVE:"Whiteboard is not started.",SHARING_INACTIVE:"Sharing is not started",INTERNAL_ERROR:"An internal error occurred."}}(),function(o){"use strict";function e(e,t,i,a,r){this._userConfig=e,this._providerFactory=t,this._callPerformanceManager=a,this._colaborationsAnalyticsService=i,this._callService=r}e.prototype={create:function(e,t,i,a){a=a||this._userConfig;var r=this._providerFactory.createCollaborationProviders(a)[0],s=this._createCollaborationService(r),n=this._createWhiteboard(r),a=this._createContentSharing(r,a,e,i),e=new o.Services.Collaboration.Slider,i=new o.Services.Collaboration.Collaboration(s,n,a,e,t,i,this._callService);return n._setCollaboration(i),a._setCollaboration(i),i},_createCollaborationService:function(e){return this._identity=T,this._collaborationProviderInitialized=!1,new o.Services.Collaboration.CollaborationService(e,this._colaborationsAnalyticsService)},_createWhiteboard:function(e){e=new o.Services.Collaboration.WhiteboardService(e,this._colaborationsAnalyticsService);return new o.Services.Collaboration.Whiteboard(e)},_createContentSharing:function(e,t,i,a){a=this._createContentSharingService(e,t.collaborationConfiguration,a);return this._callPerformanceManager.setContentSharingService(a),new o.Services.Collaboration.ContentSharing(a,i)},_createContentSharingService:function(e,t,i){(o.Base.Utils.isUndefined(t)||o.Base.Utils.isUndefined(t.contentSharingWorkerPath))&&o.Base.Logger.warn(o.Base.LoggerTags.COLLABORATION_SERVICE,"Web worker path is undefined. Content sharing will not be enabled.");var a=new o.Providers.ContentSharing.ScreenSharingProviderFactory(e,this._callPerformanceManager);return new o.Services.Collaboration.ContentSharingService(e,a.getScreenSharingProvider(t),this._colaborationsAnalyticsService,this._callService,i)}},o.Services.Collaboration.CollaborationFactory=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this._x=e,this._y=t,this._width=i,this._height=a,this._bitmapData=s,this._imageType=r}t.prototype={getXOffset:function(){return this._x},getYOffset:function(){return this._y},getRawBitmapData:function(){return this._bitmapData},getBlobData:function(){var e=new Blob([this._bitmapData],{type:"image/"+(0===this._imageType?"jpeg":"png")});return window.URL.createObjectURL(e)},getBase64BitmapData:function(){return"data:image/"+(0===this._imageType?"jpeg":"png")+";base64,"+this._toBase64(this._bitmapData)},getWidth:function(){return this._width},getHeight:function(){return this._height},_toBase64:function(e){for(var t,i="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),s=r.byteLength,e=s%3,n=s-e,o=0;o<n;o+=3)i+=a[(16515072&(t=r[o]<<16|r[o+1]<<8|r[o+2]))>>18]+a[(258048&t)>>12]+a[(4032&t)>>6]+a[63&t];return 1==e?i+=a[(252&(t=r[n]))>>2]+a[(3&t)<<4]+"==":2==e&&(i+=a[(64512&(t=r[n]<<8|r[1+n]))>>10]+a[(1008&t)>>4]+a[(15&t)<<2]+"="),i}},e.Services.Collaboration.Bitmap=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.FeaturesAvailable={LIBRARY:"LIBRARY",POLLING:"POLLING",MINUTES:"MINUTES",WHITEBOARD:"WHITEBOARD",MESSAGES:"MESSAGES",REPORTS:"REPORTS",SCREEN_SHARING:"SCREEN_SHARING",SLIDER:"SLIDER",REMOTE_CONTROL:"REMOTE_CONTROL",VIDEO_SHARING_CONTROL_MESSAGING:"VIDEO_SHARING_CONTROL_MESSAGING"}}(),function(e){"use strict";function t(e,t,i,a){this._keyFrame=a,this._height=t,this._width=e,this._bitmaps=i}t.prototype={getBitmaps:function(){return this._bitmaps},getWidth:function(){return this._width},getHeight:function(){return this._height},isKeyFrame:function(){return this._keyFrame}},e.Services.Collaboration.Frame=t}(AvayaClientServices),function(e){"use strict";function t(e,t){this._x=e,this._y=t}t.prototype={getX:function(){return this._x},getY:function(){return this._y},setX:function(e){this._x=e},setY:function(e){this._y=e}},e.Services.Collaboration.Point=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.SelectionStatus={PENDING:"PENDING",CONFIRMED:"CONFIRMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardLineWidths={SMALL:4,MEDIUM:8,LARGE:12}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTextSizes={SMALL:19,MEDIUM:23,LARGE:27}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolModes={STROKE:"STROKE",FILLED:"FILLED"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolTypes={SELECTION:"SELECTION",RECTANGLE:"RECTANGLE",CIRCLE:"CIRCLE",MARKER:"MARKER",PEN:"PEN",LINE:"LINE",STAMP:"STAMP",TEXT:"TEXT",DELETE:"DELETE",CLEAR:"CLEAR"}}(),function(s){"use strict";function e(e,t,i,a,r){this._collaborationProvider=e,this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._sharingState=s.Services.Collaboration.ContentSharingState.NOT_SHARING,this._screenSharingProvider=t,this._isScreenScraperActive=!1,this._collaborationsAnalyticsService=i,this.onPerformanceMonitorAlert=function(){},this._callService=a,this._callId=r,this._videoSharingStream=T,this._endVideoSharingStreamTimer=T}e.prototype={start:function(e){this._screenSharingProvider.start(),this._initSharingEventHandler(e),this.getShareAnyTypeCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(e)}.bind(this)),this.getStartSharingUsingVideoCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(e)}.bind(this))},stop:function(e){this._screenSharingProvider.stop(),this._removeSharingEventHandler(e)},setExtensionAvailable:function(e){this._screenSharingProvider.setExtensionAvailable(e)},isDisplayMediaAvailable:function(){return this._screenSharingProvider.isDisplayMediaAvailable()},startScreenSharingFullScreen:function(t,e,i){if(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start full screen sharing..."),t.getShareFullScreenCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){t._collaborationEnd=!1,this._contentSharingType=s.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING;var a=t._getCollaborations();return this._screenSharingProvider.startFullScreen(e,i).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),S.Deferred().reject(e).promise()}.bind(this))}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},isSharingFullScreen:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?T:this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===s.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING},startSharingApplicationWindow:function(t,e,i){if(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start appl window sharing..."),t.getShareApplicationWindowCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){t._collaborationEnd=!1,this._contentSharingType=s.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING;var a=t._getCollaborations();return this._screenSharingProvider.startApplicationWindow(e,i).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),S.Deferred().reject(e).promise()}.bind(this))}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenCapture:function(t){return s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen capturing Service: Start screen capture any type..."),t.getStartScreenSharingCapability().isAllowed?this.getShareAnyTypeCapability().isAllowed?this._screenSharingProvider.startCapture().then(function(e){return 0<e.getVideoTracks().length&&(e.getVideoTracks()[0].onended=function(){s.Base.Logger.warn(s.Base.LoggerTags.COLLABORATION_SERVICE,"Screen capture stopped by the user manually"),this.stopScreenCapture(),t._onCaptureEndedCallbacks.fire()}.bind(this)),e}.bind(this),function(e){return S.Deferred().reject(e).promise()}.bind(this)):S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise():S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingAnyType:function(t,e){if(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing any type..."),t.getStartScreenSharingCapability().isAllowed){if(this.getShareAnyTypeCapability().isAllowed){this._screenSharingProvider.clearOutgoingScreenSharingStream(),t._collaborationEnd=!1,this._contentSharingType=s.Services.Collaboration.ContentSharingType.ANY_TYPE;var i=t._getCollaborations();return this._screenSharingProvider.startSharingAnyType(e).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,i._activeContentSharing=t,i._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,i._activeContentSharing=T,i._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),S.Deferred().reject(e).promise()}.bind(this))}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingUsingVideo:function(t,e,i){if(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing USING VIDEO any type..."),t.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()){if(this.getStartSharingUsingVideoCapability().isAllowed){this._screenSharingProvider.clearOutgoingVideoSharingStream(),t._collaborationEnd=!1,this._contentSharingType=s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var a=t._getCollaborations();return this._screenSharingProvider.startSharingWithVideo(this,e,i).then(function(e){return 0<e.getVideoTracks().length&&(e.getVideoTracks()[0].onended=function(){s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.stopScreenSharingUsingVideo(t)}.bind(this)),0<e.getAudioTracks().length&&t._onAudioAddedToScreenSharingUsingVideoCallback.fire(t,e.getAudioTracks()[0]),this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),S.Deferred().reject(e).promise()}.bind(this))}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},restartScreenSharingUsingVideo:function(t,e){s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Restarting screen sharing USING VIDEO any type..."),t.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()&&this.getStartSharingUsingVideoCapability().isAllowed&&this._screenSharingProvider._collaborationProvider.startVideoSharing().then(function(){t._collaborationEnd=!1,this._contentSharingType=s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var e=t._getCollaborations();this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,e._activeContentSharing=t,e._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0)}.bind(this),function(e){s.Base.Logger.error(s.Base.LoggerTags.COLLABORATION_SERVICE,"Failed to send StartVideoSharing event to WCS: ",e)})},stopScreenSharingUsingVideo:function(e,t){var i=e._collaboration;if(i&&(!i._selfParticipant||!i._selfParticipant._presenter)||!this.isScreenSharingUsingVideoInProgress())return s.Base.Logger.warn(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: presenter parameter is false."),S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise();if(this._stopAllVideoSharingStreams(),this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING)return s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Video content Sharing Service: Stop sharing..."),this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&(this._sharingState=s.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,(i=e._getCollaborations())._activeContentSharing=T,i._onActiveContentSharingChangedCallback.fire()),this._recalculateAllContentSharingCapabilities(e),s.Base.Utils.isUndefined(t)&&(t=!0),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,t);s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: sharing is inactive");t=S.Deferred();return t.resolve(),t.promise()},stopScreenCapture:function(){this._screenSharingProvider.isCapturing()&&this._screenSharingProvider.clearOutgoingCapturedStream()},setVideoSharingStream:function(e){this._videoSharingStream=e},sendContentVideoSharingStream:function(e){return this._callService.startContentVideoSharing(this._callId,e)},isScreenSharingUsingVideoWithAudio:function(){return!!this._videoSharingStream&&0<this._videoSharingStream.getAudioTracks().length},isScreenSharingUsingVideoInProgress:function(){return!!this._videoSharingStream},getNegotiatedVideoResolution:function(){return this._callService.getNegotiatedVideoResolutionByCallId(this._callId)},updateAudioSourceForVideoSharing:function(e){return this._callService.updateAudioSourceForVideoSharing(this._callId,e)},isSharingApplicationWindow:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?T:this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===s.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING},isScreenSharingUsingVideo:function(){return this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE},_isSharingAnyType:function(){return this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===s.Services.Collaboration.ContentSharingType.ANY_TYPE},end:function(e,t){var i=t._collaboration;if(!i||!!i._selfParticipant&&i._selfParticipant._presenter){if(this.stopScreenCapture(),this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING){if(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing..."),this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE)return this.stopScreenSharingUsingVideo(t);this._sharingState=s.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,!0===e&&(t._isPaused=!1,t._onContentSharingEndedCallbacks.fire(t,i._selfParticipant)),this._recalculateAllContentSharingCapabilities(t);t=t._getCollaborations();return t._activeContentSharing=T,t._onActiveContentSharingChangedCallback.fire(),this._isScreenScraperActive=!1,this.setScreenSharingVisibleRect(T),this.setScreenSharingMasks(T),this._screenSharingProvider.stopScreenSharing(e)}s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: sharing is inactive");e=S.Deferred();return e.resolve(),e.promise()}return s.Base.Logger.warn(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: presenter parameter is false."),S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},isPresenting:function(){return this._contentSharingType!==s.Services.Collaboration.ContentSharingType.NONE},isContentSharingActive:function(){return this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING},isContentSharingPaused:function(){return this._sharingState===s.Services.Collaboration.ContentSharingState.PAUSED},pause:function(){return this._sharingState===s.Services.Collaboration.ContentSharingState.SHARING?this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise():(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Pause sharing..."),this._sharingState=s.Services.Collaboration.ContentSharingState.PAUSED,this._screenSharingProvider.pause()):S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},resume:function(){return this._sharingState===s.Services.Collaboration.ContentSharingState.PAUSED?(s.Base.Logger.info(s.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Resume sharing..."),this._sharingState=s.Services.Collaboration.ContentSharingState.SHARING,this._screenSharingProvider.resume()):S.Deferred().reject(s.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},getShareApplicationWindowCapability:function(){return this._screenSharingProvider.getShareApplicationWindowCapability()},getReceivingBitrate:function(){return this._collaborationProvider.getReceivingBitrate()},getOutgoingScreenSharingStream:function(){return this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?this._screenSharingProvider.getOutgoingVideoSharingStream():this._screenSharingProvider.getOutgoingScreenSharingStream()},getOutgoingCapturedStream:function(){return this._screenSharingProvider.getOutgoingCapturedStream()},getShareFullScreenCapability:function(){return this._screenSharingProvider.getShareFullScreenCapability()},getShareAnyTypeCapability:function(){return this._screenSharingProvider.getShareAnyTypeCapability()},getStartSharingUsingVideoCapability:function(){return this._screenSharingProvider.getStartSharingUsingVideoCapability()},isOpened:function(){return this._screenSharingProvider.isOpened()},isFeatureAvailable:function(e){return this._collaborationProvider.isFeatureAvailable(e)},setImageQuality:function(e){this._screenSharingProvider.setImageQuality(e)},getImageQuality:function(e){return this._screenSharingProvider.getImageQuality()},setScreenSharingVisibleRect:function(e){this._screenSharingProvider.setScreenSharingVisibleRect(e)},getScreenSharingVisibleRect:function(){return this._screenSharingProvider.getScreenSharingVisibleRect()},setScreenSharingMasks:function(e){this._screenSharingProvider.setScreenSharingMasks(e)},getScreenSharingMasks:function(){return this._screenSharingProvider.getScreenSharingMasks()},setMaxUploadSpeed:function(e){this._screenSharingProvider.setMaxUploadSpeed(e)},getMaxUploadSpeed:function(e){return this._screenSharingProvider.getMaxUploadSpeed()},notifyPerformanceMonitorAlert:function(e,t){this.onPerformanceMonitorAlert(e,t)},isScreenSharingUsingVideoAllowed:function(){return this._callService.isMPaasCall(this._callId)&&!this._callService.isAudioOrDataOnly(this._callId)},_initSharingEventHandler:function(e){this._startScreenSharingEventHandler=this._startScreenSharingHandler(),this._endScreenSharingEventHandler=this._endScreenSharingHandler(),this._startVideoSharingEventHandler=this._startVideoSharingHandler(),this._endVideoSharingEventHandler=this._endVideoSharingHandler(),e.addOnContentSharingStartedCallback(this._startScreenSharingEventHandler),e.addOnContentSharingEndedCallback(this._endScreenSharingEventHandler),e.addOnScreenSharingUsingVideoStartedCallback(this._startVideoSharingEventHandler),e.addOnScreenSharingUsingVideoEndedCallback(this._endVideoSharingEventHandler)},_removeSharingEventHandler:function(e){this._startScreenSharingEventHandler&&this._endScreenSharingEventHandler&&(e.removeOnContentSharingStartedCallback(this._startScreenSharingEventHandler),e.removeOnContentSharingEndedCallback(this._endScreenSharingEventHandler)),this._startVideoSharingEventHandler&&this._endVideoSharingEventHandler&&(e.removeOnContentSharingStartedCallback(this._startVideoSharingEventHandler),e.removeOnContentSharingEndedCallback(this._endVideoSharingEventHandler))},_startScreenSharingHandler:function(){return function(e){}.bind(this)},_endScreenSharingHandler:function(){return function(e){var t=this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;if(t||(this._sharingState=s.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE),this._isScreenScraperActive)return this._isScreenScraperActive=!1,this._screenSharingProvider.stopScreenSharing(!0,t)}.bind(this)},_pauseScreenSharingHandler:function(t){return function(e){t._onContentSharingPausedCallbacks.fire(e)}},_startVideoSharingHandler:function(){return function(e,t){t.isLocalUser()&&clearTimeout(this._endVideoSharingStreamTimer)}.bind(this)},_endVideoSharingHandler:function(){return function(e,t,i){var a=function(){if(this._contentSharingType===s.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&this.isScreenSharingUsingVideoInProgress())return this._contentSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._stopAllVideoSharingStreams(),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,!1)}.bind(this);i?this._endVideoSharingStreamTimer=setTimeout(a,500):a()}.bind(this)},_endActiveScreenSharing:function(e,t){this._sharingState!==s.Services.Collaboration.ContentSharingState.NOT_SHARING&&(e._isPaused=!1,this._sharingState=s.Services.Collaboration.ContentSharingState.NOT_SHARING,e._onContentSharingEndedCallbacks.fire(e,t))},_stopAllVideoSharingStreams:function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(e){e.stop()}),this._videoSharingStream=T),this._screenSharingProvider.clearOutgoingVideoSharingStream()},_recalculateAllContentSharingCapabilities:function(e){e._recalculateShareApplicationWindowCapability(e._collaboration),e._recalculateShareFullScreenCapability(e._collaboration),e._recalculateShareAnyTypeCapability(e._collaboration),e._recalculateShareContentVideoCapability(e._collaboration)}},s.Services.Collaboration.ContentSharingService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingState={NOT_SHARING:"not sharing",SHARING:"sharing",PAUSED:"paused"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingType={NONE:"none",FULL_SCREEN_SHARING:"full screen",APP_WINDOW_SHARING:"application window",ANY_TYPE:"any type",VIDEO_ANY_TYPE:"video any type"}}(),function(i){"use strict";function e(){this._slides=[],this._onSlidesAddedCallbacks=S.Callbacks(),this._onSlidesRemovedCallbacks=S.Callbacks()}e.prototype={getSlides:function(){var t=[];return this._slides.forEach(function(e){t.push(new i.Services.Collaboration.SliderSlide(e.getNumber(),e.getSlideURL(),e.getThumbnailURL(),e.getCreateTime()))}),t},_addSlides:function(e){this._slides.push(new i.Services.Collaboration.SliderSlide(e.getNumber(),e.getSlideURL(),e.getThumbnailURL(),e.getCreateTime()))},_removeSlides:function(){this._slides=[]}},i.Services.Collaboration.Slider=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Collaboration.Slider.prototype,{addOnSlidesAddedCallback:function(e){this._onSlidesAddedCallbacks.add(e)},removeOnSlidesAddedCallback:function(e){this._onSlidesAddedCallbacks.remove(e)},addOnSlidesRemovedCallback:function(e){this._onSlidesRemovedCallbacks.add(e)},removeOnSlidesRemovedCallback:function(e){this._onSlidesRemovedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._number=e,this._slideURL=t,this._thumbnailURL=i,this._createTime=a}t.prototype={getSlideURL:function(){return this._slideURL},getThumbnailURL:function(){return this._thumbnailURL},getNumber:function(){return this._number},getCreateTime:function(){return this._createTime}},e.Services.Collaboration.SliderSlide=t}(AvayaClientServices),function(s){"use strict";function e(e,t){this._collaborationProvider=e,this._checkOnNewPoints=T,this._throttlingInterval=100,this._collaborationsAnalyticsService=t}e.prototype={start:function(e,t){var i=S.Deferred();if(e._collaboration.getWhiteboardCapability().isAllowed){var a=function(){this._collaborationsAnalyticsService.sendStartupEvent(!0)}.bind(this),r=function(){this._collaborationsAnalyticsService.sendStartupEvent(!1)}.bind(this);if(s.Base.Utils.isDefined(t))return t.isActive()?(i.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_ALREADY_ACTIVE)),i.promise()):(e.getSurfaces().forEach(function(e){e._active=!1}),this._collaborationProvider.startWhiteboard(t.getSurfaceId()).then(a,r));t=e.getSurfaces();if(0===t.length)return this._collaborationProvider.startWhiteboard().then(a,r);e=t.filter(function(e){return e.isActive()})[0];return(e?this._collaborationProvider.startWhiteboard(e.getSurfaceId()):this._collaborationProvider.startWhiteboard(t[0].getSurfaceId())).then(a,r)}return i.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)),i},end:function(e){var t=S.Deferred();if(e.getActiveSurface()){if(e._collaboration.getWhiteboardCapability().isAllowed)return this._collaborationProvider.endWhiteboard(e);t.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED))}else t.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE));return t},stop:function(e){var t=S.Deferred();return e._currentLiveDrawingWhiteboardIds=[],e._currentLiveDrawingShapes=[],e._activeSurface=T,e._recentlyActiveSurface=T,e._surfaces.length=0,e._onWhiteboardStartedCallbacks.empty(),e._onWhiteboardEndedCallbacks.empty(),e._onWhiteboardSurfaceAddedCallbacks.empty(),e._onWhiteboardSurfaceRemovedCallbacks.empty(),e._onWhiteboardSurfaceSetActiveCallbacks.empty(),e._removeWhiteboardCapability=new s.Base.Capability(s.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),t.resolve(),t.promise()},requestNewSurface:function(e){var t=S.Deferred();return e.getActiveSurface()?e.getAddWhiteboardCapability().isAllowed?this._collaborationProvider.addWhiteboardSurface().then(function(e){t.resolve(e)},function(e){t.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,e))}):t.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):t.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),t.promise()},removeSurface:function(e,t){var i=S.Deferred();return e.getActiveSurface()?1<e.getSurfaces().length?e.getRemoveWhiteboardCapability().isAllowed?this._collaborationProvider.removeWhiteboardSurface(t.getSurfaceId()).then(function(e){i.resolve(e)},function(e){i.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,e))}):i.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):i.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_LAST_SURFACE)):i.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),i.promise()},addCircle:function(i,a){return this._collaborationProvider.addCircle(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e})},addShape:function(i,a){return a.isFinished()?this._collaborationProvider.addShape(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e}):(a._readyToSendCallbacks.add(this._throttleLiveDrawing.bind(this,a,i)),this._collaborationProvider.startDrawShape(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e}))},addText:function(i,a){return this._collaborationProvider.addText(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e})},moveSelection:function(e,t){return t instanceof s.Services.Collaboration.Shape?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getPoints()[0].point):t instanceof s.Services.Collaboration.Circle?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getTopLeft()):t instanceof s.Services.Collaboration.WhiteboardText?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getPosition()):this._collaborationProvider.moveSelection(t,e.getSurfaceId())},removeShape:function(e,t){if(t.isMine())return t instanceof s.Services.Collaboration.Shape?i=t.getPoints()[0].point:t instanceof s.Services.Collaboration.Circle?i=t.getTopLeft():t instanceof s.Services.Collaboration.WhiteboardText&&(i=t.getPosition()),this._collaborationProvider.removeShape(t,e.getSurfaceId(),i);var i=S.Deferred();return i.reject(new s.Services.Collaboration.CollaborationError(s.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SHAPE_NOT_MINE)),i.promise()},clearContent:function(e){return this._collaborationProvider.clearContent(e.getSurfaceId())},endDrawShape:function(e,t){return t._hasPointsToSend()&&this._collaborationProvider.liveDrawShape(t,e.getSurfaceId()),this._collaborationProvider.endDrawShape(t,e.getSurfaceId())},_throttleLiveDrawing:function(e,t){if(e._hasPointsToSend())return this._collaborationProvider.liveDrawShape(e,t.getSurfaceId())}},s.Services.Collaboration.WhiteboardService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTools=function(){this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION]={name:"Selection",type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN,name:"Pen",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER,name:"Marker",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE,name:"Line",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardLineWidths,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE,name:"Rect",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE,name:"Circle",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP,name:"Stamp",drag:!1,live:!1,drawFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT,name:"Text",drag:!1,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardTextSizes},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE,name:"Delete"},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR,name:"Clear All"}}}(),function(a){"use strict";function r(e,t,i,a){this._messageContent=e,this._sender=t,this._recipient=i,this._isPrivate=a,this._time=new Date,r._idCounter===Number.MAX_SAFE_INTEGER&&(r._idCounter=1e5),this._id=""+ ++r._idCounter,this.status=T}Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=Math.pow(2,53)-1),r._idCounter=1e5,r.prototype={setStatus:function(e){var t,i=!1;for(t in a.Services.Conference.ChatMessageStatus)if(a.Services.Conference.ChatMessageStatus.hasOwnProperty(t)&&e===a.Services.Conference.ChatMessageStatus[t]){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.status=e,i=!0;break}return i},getSender:function(){return this._sender},getMessageContent:function(){return this._messageContent},isPrivate:function(){return this._isPrivate},getRecipient:function(){return this._recipient},getTime:function(){return this._time},getId:function(){return this._id}},a.Services.Conference.ChatMessage=r}(AvayaClientServices),function(n){"use strict";function e(e){this._conferenceProvider=e,this._enableSendingMessages=!0}e.prototype={sendMessage:function(e,t,i){if(this._enableSendingMessages){var a=i?i._participantId:T,r=!!i,s=new n.Services.Conference.ChatMessage(t,e._selfParticipant,i,r);return s.getRecipient()&&s.getRecipient().addOnParticipantNameChangedCallback(function(e){s._recipient=e}),s.setStatus(n.Services.Conference.ChatMessageStatus.PENDING),this.addMessage(e,s),this._conferenceProvider.sendChatMessage(t,a).then(function(){s.setStatus(n.Services.Conference.ChatMessageStatus.CONFIRMED)}.bind(this),function(e){return s.setStatus(n.Services.Conference.ChatMessageStatus.ERROR),S.Deferred().reject(e).promise()}.bind(this))}a="Sending messages is disabled while conference is in WAITING_ROOM state";n.Base.Logger.error(n.Base.LoggerTags.CHAT_SERVICE,a);a=new n.Services.Conference.ConferenceException(n.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,a);return S.Deferred().reject(a).promise()},addMessage:function(e,t){(t.isPrivate()?e._privateMessages:e._publicMessages).push(t),e._allMessages.push(t),e._onChatMessageReceivedCallbacks.fire(e,t)},_setEnableSendingMessages:function(e){this._enableSendingMessages=e}},n.Services.Conference.ChatService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceException=function(e,t){this.name=e,this.message=t}}(),function(s){"use strict";function e(e,t,i){this._conferenceType=e,this._conferenceProvider=t,this._contactsIntegrationService=i,this._onContactListChanged=T,this._isDisconnecting=!1}e.prototype={start:function(t,e){if(s.Base.Utils.isDefined(this._conferenceProvider))return s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is starting..."),t._isStarting=!0,this._conferenceProvider.start(t,e).then(function(){this._conferenceProvider.on(s.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(s.Base.Utils.isUndefined(t._isAvailable)||t._isAvailable)&&(t._isAvailable=!1,t._onConferenceServiceUnavailableCallbacks.fire(t))}.bind(this)),this._conferenceProvider.on(s.Base.NetworkProviderEvents.AUTHORIZED,function(){!s.Base.Utils.isUndefined(t._isAvailable)&&t._isAvailable||(t._isAvailable=!0,t._onConferenceServiceAvailableCallbacks.fire(t))}.bind(this)),this._onContactListChanged=function(){this._updateMatchedContactsForConference(t)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),!s.Base.Utils.isUndefined(t._isAvailable)&&t._isAvailable||(t._isAvailable=!0,t._onConferenceServiceAvailableCallbacks.fire(t)),t._setConferenceStarted(!0),t._recalculateAllAddParticipantFromCallCapability(),t.addOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses)}.bind(this),function(e){return t._isStarting=!1,t._setConferenceStarted(!1),S.Deferred().reject(e).promise()});e=S.Deferred();return s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is not enabled"),e.reject({name:s.Services.Conference.ConferenceStartStatus.CONFERENCE_SERVICE_NOT_ENABLED,message:"Conference Service is not enabled"}),e.promise()},stop:function(t){return t._isAvailable&&(t._isAvailable=!1,t._recalculateInConferenceChatCapability(),t._onConferenceServiceUnavailableCallbacks.fire(t)),t._isStarting=!1,t._setConferenceStarted(!1),s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stop().then(function(e){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,t.removeOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses),t._selfParticipantId="",t._activeTalkerId="",t._lecturerId="",t._presenterId="",t._conferenceOwnerAddress="",t._mediaStatus="",t._activeParticipants=[],t._droppedParticipants=[],t._pendingParticipants=[],t._isLectureModeActive=!1,t._isHandRaised=!1,t._recordingStatus=s.Services.Conference.RecordingStatus.OFF,t._isVideoAllowed=!1,t._isWebCollaborationActive=!1,t._isLocked=!1,t._isPasscodeRequiredToBecomeModerator=!1,t._isVideoParticipantNameDisplayActive=!1,t._isVideoPersonalLayoutActive=T,t._isVideoSelfSeeActive=!1,t._isVideoSelfSeeChangeAllowed=!1,t._isVideoPinAllowed=!1,t._isVideoParticipantNameDisplayChangeAllowed=!1,t._currentVideoLayout="",t._supportedVideoLayouts=[],t._subject="",t._sipURI="",t._isApplicationSharingActive=!1,t._brandName="",t._collaborationURI="",t._joinMeetingURI="",t._streamingURI="",t._dialInInformation="",t._dialInInformationHtml="",t._admissionPermissionNeeded=!1,t._admissionPasscodeNeeded=!1,e}.bind(this)):S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.PROVIDER_UNAVAILABLE,"ConferenceProvider")).promise()},stopImmediately:function(e){return e._isAvailable&&(e._isAvailable=!1,e._onConferenceServiceUnavailableCallbacks.fire(e)),e._isStarting=!1,e._setConferenceStarted(!1),S.Deferred().resolve().promise()},terminateConference:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.terminateConference():S.Deferred().reject().promise()},getType:function(){return this._conferenceType},removeLastParticipant:function(){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.removeLastParticipant():S.Deferred().reject().promise()},sendAdmissionRequest:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendAdmissionRequest(e,t):S.Deferred().reject().promise()},requestToBecomeModerator:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.requestToBecomeModerator(t):S.Deferred().reject().promise()},signIn:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.signIn(t):S.Deferred().reject().promise()},videoPin:function(e,t,i,a,r){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.videoPin(e,t,i,a,r):S.Deferred().reject().promise()},extendMeeting:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.extendMeeting(e):S.Deferred().reject().promise()},addParticipant:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipant(e,t):S.Deferred().reject().promise()},addParticipantFromCall:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipantFromCall(e):S.Deferred().reject().promise()},cancelDialoutParticipant:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.cancelDialoutParticipant(e,t._participantId):S.Deferred().reject().promise()},setAsLecturer:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setAsLecturer(e._participantId):S.Deferred().reject().promise()},setLocked:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setLocked(t):S.Deferred().reject().promise()},startRecording:function(e,t,i){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.startRecording(e,t,i):S.Deferred().reject().promise()},stopRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stopRecording(e):S.Deferred().reject().promise()},pauseRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.pauseRecording(e):S.Deferred().reject().promise()},resumeRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.resumeRecording(e):S.Deferred().reject().promise()},setVideoLayout:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return S.Deferred().reject().promise();e=e.getUpdateVideoLayoutCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayout(t);e=e.denialReason;return S.Deferred().reject(e).promise()},setVideoLayoutSelfSee:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return S.Deferred().reject().promise();e=e.getUpdateVideoSelfSeeCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayoutSelfSee(t);e=e.denialReason;return S.Deferred().reject(e).promise()},setVideoLayoutTextOverlay:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return S.Deferred().reject().promise();e=e.getUpdateDisplayVideoParticipantNameCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayoutTextOverlay(t);e=e.denialReason;return S.Deferred().reject(e).promise()},getCurrentVideoLayout:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.getCurrentVideoLayout():S.Deferred().reject().promise()},muteAllParticipants:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!0):S.Deferred().reject().promise()},unmuteAllParticipants:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!1):S.Deferred().reject().promise()},raiseLowerHand:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?e?this._conferenceProvider.raiseLowerHand(s.Services.Conference.ParticipantHandState.RAISE):this._conferenceProvider.raiseLowerHand(s.Services.Conference.ParticipantHandState.LOWER):S.Deferred().reject().promise()},disconnectParticipant:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.disconnectParticipant(e):S.Deferred().reject().promise()},sendDisconnectEvent:function(){return s.Base.Utils.isDefined(this._conferenceProvider)?this._isDisconnecting?S.Deferred().resolve():(this._isDisconnecting=!0,s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference sent disconnect event"),this._conferenceProvider.sendDisconnectEvent(s.Services.Conference.DisconnectReason.CALL_DISCONNECTED)):S.Deferred().reject().promise()},sendLocalMuteEvent:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendLocalMuteEvent(e,t):S.Deferred().reject().promise()},changeParticipantName:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.changeParticipantName(e._participantId,t):S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError,"Conference provider is not defined")).promise()},_recalculateAllCapabilities:function(e){e._recalculateSetLockCapability(),e._recalculateDisplayVideoParticipantNameCapability(),e._recalculateVideoSelfSeeCapability(),e._recalculateSetVideoLayoutCapability(),e._recalculateStartStopRecordingCapability(),e._recalculatePauseResumeRecordingCapability(),e._recalculateMuteUnmuteAllCapability(),e._recalculateRaiseHandSupportCapability(),e._recalculateLowerHandSupportCapability(),e._recalculateRequestToBecomeModeratorCapability(),e._recalculateVideoPinCapability(),e._recalculateRemoveSelectParticipantCapability(),e._recalculateAddParticipantViaDialoutCapability(),e._recalculateSignInCapability(),e._recalculateModerateConferenceCapability(),e._recalculateActiveTalkerCapability(),e._recalculateMuteSelfAudioCapability(),e._recalculateUnmuteSelfAudioCapability(),e._recalculateSendFeccCapability(),e._recalculateTerminateConferenceCapability(),e._recalculateAcceptPendingParticipantCapability(),e._recalculateDenyPendingParticipantCapability(),e._recalculateExtendMeetingCapability(),e._recalculateRetrieveParticipantListCapability(),e._recalculateInConferenceChatCapability()},_updateMatchedContactsForParticipant:function(e){this._contactsIntegrationService.updateMatchedContactsForParticipant(e,!0)},_updateMatchedContactsForConference:function(e){var t;this._contactsIntegrationService.isStarted()&&e&&(t=[],e.getActiveParticipants().forEach(function(e){t.push(e)}),e.getPendingParticipants().forEach(function(e){t.push(e)}),e.getDroppedParticipants().forEach(function(e){t.push(e)}),t.forEach(function(e){this._updateMatchedContactsForParticipant(e)},this))},_recalculateAddParticipantFromCallCapability:function(e,t){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapability(e,t)},_recalculateAddParticipantFromCallCapabilityByCallId:function(e,t){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapabilityByCallId(e,t)},_recalculateConferenceRecordingStatuses:function(e){e._recalculateStartStopRecordingCapability(),e._recalculatePauseResumeRecordingCapability()}},s.Services.Conference.ConferenceService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceType={CM_CONFERENCE:"CM",SCOPIA_CONFERENCE:"Scopia"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AdmissionResponseCode={SUCCESS:"success",INCORRECT_PASSCODE_TRY_AGAIN:"incorrectPasscodeTryAgain",INCORRECT_PASSCODE_DISCONNECTING:"incorrectPasscodeDisconnecting",PENDING_APPROVAL:"pendingApproval",REJECTED:"rejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AllowVideoDirection={SEND_RECEIVE:"biDirectional",RECEIVE_ONLY:"serverToClient",SEND_ONLY:"clientToServer",INACTIVE:"none"}}(),function(){"use strict";AvayaClientServices.Services.Conference.CameraControl={CAMERA_CONTROL_UP:"up",CAMERA_CONTROL_DOWN:"down",CAMERA_CONTROL_RIGHT:"right",CAMERA_CONTROL_LEFT:"left",CAMERA_CONTROL_ZOOM_IN:"in",CAMERA_CONTROL_ZOOM_OUT:"out"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatMessageStatus={PENDING:"pending",CONFIRMED:"confirmed",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatType={PRIVATE:"private",PUBLIC:"public"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceError={CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",INVALID_ARGUMENT:"INVALID_ARGUMENT",NETWORK_UNAVAILABLE:"NETWORK_UNAVAILABLE",CONFERENCE_CONNECTION_FAILED_TO_RECOVER:"CONFERENCE_CONNECTION_FAILED_TO_RECOVER",PROVIDER_UNAVAILABLE:"PROVIDER_UNAVAILABLE",NOT_SUPPORTED:"NOT_SUPPORTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceStartStatus={ADMISSION_NEEDED:"admissionNeeded",CONFERENCE_SERVICE_NOT_ENABLED:"conferenceServiceNotEnabled",CONFERENCE_CONFIG_NOT_ENABLED:"conferenceConfigIsNotEnabled",HANDSHAKE_REJECTED:"handshakeRejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ContentFromParticipantStatus={ACTIVE:"active",ALLOWED:"allowed",NOT_ALLOWED:"notAllowed"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DialoutStatus={DIALING:"dialing",UNAUTHORIZED:"unauthorized",FAIL:"fail",NOT_ADMITTED:"notAdmitted",NOT_ALLOWED:"notAllowed",CONNECT:"connect",BUSY:"busy",NO_ANSWER:"noAnswer",CANCELED:"canceled"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DisconnectReason={CALL_DISCONNECTED:"callDisconnected",CONFERENCE_TERMINATED:"conferenceTerminated",DISCONNECTED_BY_MODERATOR_OR_ADMIN:"disconnectedByModeratorOrAdmin",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaFromParticipantStatus={ACTIVE:"active",NA:"na",SELF_MUTED:"selfMuted",MODERATOR_MUTED:"moderatorMuted",BOTH_MUTED:"bothMuted"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaStatus={WAITING_ROOM:"waitingRoom",ACTIVE:"active",MUTE_ALL_AUDIO:"muteAllAudio"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaToParticipantStatus={AVAILABLE:"available",NA:"na"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaType={AUDIO:"audio",VIDEO:"video"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MeetingEncryptionStatus={YES:"yes",NO:"no",PARTIAL:"partial"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ModeratorAdmissionActions={ADMIT:"admit",REJECT:"reject"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantAuthorizationStatus={ACTIVE:"active",AUTHORIZING:"authorizing"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantConnectionStatus={CONNECTION_STATUS_UNKNOWN:"CONNECTION_STATUS_UNKNOWN",CONNECTION_STATUS_CONNECTING:"CONNECTION_STATUS_CONNECTING",CONNECTION_STATUS_CONNECTED:"CONNECTION_STATUS_CONNECTED",CONNECTION_STATUS_DISCONNECTING:"CONNECTION_STATUS_DISCONNECTING",CONNECTION_STATUS_DISCONNECTED:"CONNECTION_STATUS_DISCONNECTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantDisconnectionReason={DISCONNECT_REASON_UNKNOWN:"DISCONNECT_REASON_UNKNOWN",DISCONNECT_REASON_DEPARTED:"DISCONNECT_REASON_DEPARTED",DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR:"DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantHandState={RAISE:"raise",LOWER:"lower"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantMediaState={MEDIA_STATUS_NO_MEDIA:"MEDIA_STATUS_NO_MEDIA",MEDIA_STATUS_INACTIVE:"MEDIA_STATUS_INACTIVE",MEDIA_STATUS_RECEIVE_ONLY:"MEDIA_STATUS_RECEIVE_ONLY",MEDIA_STATUS_SEND_ONLY:"MEDIA_STATUS_SEND_ONLY",MEDIA_STATUS_SEND_RECEIVE:"MEDIA_STATUS_SEND_RECEIVE"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantRole={MODERATOR:"moderator",PARTICIPANT:"participant",GUEST:"guest",OPERATOR:"operator",RESTRICTED_PARTICIPANT:"restrictedParticipant"}}(),function(){"use strict";AvayaClientServices.Services.Conference.PermissionStatus={ALLOWED:"allowed",NOT_ALLOWED:"notAllowed",NEED_SIGNIN:"needSignin",NEED_MODERATOR:"needModerator",NEED_SIGNIN_OR_MODERATOR:"needSigninOrModerator"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecorderStatus={NONE:"none",START_STOP:"start/stop",WITH_PAUSE:"withPause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingOperation={START:"start",STOP:"stop",PAUSE:"pause",RESUME:"resume"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingStatus={ON:"on",OFF:"off",PAUSE:"pause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.VideoLayout={LAYOUT_AUTOMATIC:"1",LAYOUT_SINGLE_SCREEN:"10",LAYOUT_DOUBLE_SCREEN_HORIZONTAL:"21",LAYOUT_DOUBLE_SCREEN_VERTICAL:"22",LAYOUT_DOUBLE_SCREEN_4_TO_1:"27",LAYOUT_1_HOST_1_PIP:"28",LAYOUT_PYRAMID_3:"32",LAYOUT_LANDSCAPE_PLUS_2_ASYM:"33",LAYOUT_1_HOST_2_PIP:"34",LAYOUT_3x1:"35",LAYOUT_2x2:"40",LAYOUT_4_PYRAMID:"41",LAYOUT_3_PLUS_1:"42",LAYOUT_1_HOST_3_PIP:"43",LAYOUT_5_PYRAMID:"51",LAYOUT_1_HOST_4_PIP:"52",LAYOUT_5_PLUS_1:"60",LAYOUT_3x2:"61",LAYOUT_6_PLUS_1_1:"75",LAYOUT_7_PLUS_1_NEW:"81",LAYOUT_4x2:"82",LAYOUT_3x3:"90",LAYOUT_9_PYRAMID:"91",LAYOUT_8_PLUS_2_1_2:"101",LAYOUT_4x3:"120",LAYOUT_12_PLUS_1_1:"131",LAYOUT_12_PLUS_1_5:"135",LAYOUT_4x4:"160",LAYOUT_20_PLUS_1:"210",LAYOUT_20_PLUS_1_LEFT:"211",LAYOUT_1_PLUS_27:"280"}}(),function(a){"use strict";function e(e){this._conferenceProvider=e}e.prototype={setAsLecturer:function(e){return this._conferenceProvider.setAsLecturer(e.getParticipantId())},unsetAsLecturer:function(){return this._conferenceProvider.unsetAsLecturer()},controlRemoteCamera:function(e,t){return this._conferenceProvider.controlRemoteCamera(e.getParticipantId(),t)},mute:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!0)},unmute:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!1)},accept:function(e){return this._conferenceProvider.moderatorAdmission(e,a.Services.Conference.ModeratorAdmissionActions.ADMIT)},deny:function(e){return this._conferenceProvider.moderatorAdmission(e,a.Services.Conference.ModeratorAdmissionActions.REJECT)},blockVideo:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!0)},unblockVideo:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!1)},lowerHand:function(e,t){return this._conferenceProvider.moderatorLowerHand(e.getParticipantId(),t)},changeParticipantName:function(e,t){var i=e._conference.getSelfParticipant();if(i.getChangeParticipantNameCapability().isAllowed)return this._conferenceProvider.changeParticipantName(e._participantId,t);i="Cannot change participant name. Reason: "+i.getChangeParticipantNameCapability().denialReason;return a.Base.Logger.error(a.Base.LoggerTags.PARTICIPANT_SERVICE,i),S.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,i)).promise()},recalculateAllCapabilities:function(e){e._recalculateBlockUnblockVideoCapability(),e._recalculateMuteUnmuteCapability(),e._recalculateLowerHandCapability(),e._recalculateSetAsLecturerCapability(),e._recalculateRemoteCameraControlCapability(),e._recalculateChangeParticipantNameCapability()}},a.Services.Conference.ParticipantService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.RecentTalkersConfiguration={SIZE:4}}(),function(e){"use strict";function t(){this._writeCapability=new e.Base.Capability(e.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}t.prototype={getWriteCapability:function(){return this._writeCapability},_setWriteCapability:function(e){this._writeCapability=e}},e.Services.Contacts.ContactField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._values=[]}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValues=function(){return this._values},t.prototype.isEmpty=function(){return!this._values||0===this._values.length},t.prototype.getSize=function(){return this._values?this._values.length:0},e.Services.Contacts.ContactFieldList=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._address=T,this._imAddressType=e.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER,this._default=!1,this._avayaAdministered=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getAddress=function(){return this._address},t.prototype.getIMAddressType=function(){return this._imAddressType},t.prototype.isDefault=function(){return this._default},t.prototype.setAvayaAdministered=function(e){this._avayaAdministered=e},t.prototype.isAvayaAdministered=function(){return this._avayaAdministered},e.Services.Contacts.ContactIMAddressField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._value=0}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},e.Services.Contacts.ContactNumberField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._phoneNumber=T,this._label1=T,this._label2=T,this._phoneNumberType=e.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK,this._speedDialEnabled=!1,this._default=!1,this._avayaAdministered=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getPhoneNumber=function(){return this._phoneNumber},t.prototype.getLabel1=function(){return this._label1},t.prototype.getLabel2=function(){return this._label2},t.prototype.getPhoneNumberType=function(){return this._phoneNumberType},t.prototype.isSpeedDialEnabled=function(){return this._speedDialEnabled},t.prototype.isDefault=function(){return this._default},t.prototype.setAvayaAdministered=function(e){this._avayaAdministered=e},t.prototype.isAvayaAdministered=function(){return this._avayaAdministered},e.Services.Contacts.ContactPhoneField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._value=T}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},e.Services.Contacts.ContactStringField=t}(AvayaClientServices),function(a){"use strict";function e(){a.Services.Contacts.ContactIMAddressField.call(this)}(e.prototype=Object.create(a.Services.Contacts.ContactIMAddressField.prototype)).setAddress=function(e){this._address=e},e.prototype.setIMAddressType=function(e){var t,i=!1;for(t in a.Services.Contacts.ContactIMAddressType)if(a.Services.Contacts.ContactIMAddressType.hasOwnProperty(t)&&e===a.Services.Contacts.ContactIMAddressType[t]){this._imAddressType=e,this._default=this._imAddressType===a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK,i=!0;break}return i},a.Services.Contacts.EditableContactIMAddressField=e}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactNumberField.call(this)}(t.prototype=Object.create(e.Services.Contacts.ContactNumberField.prototype)).setValue=function(e){this._value=e},e.Services.Contacts.EditableContactNumberField=t}(AvayaClientServices),function(a){"use strict";function e(){a.Services.Contacts.ContactPhoneField.call(this)}(e.prototype=Object.create(a.Services.Contacts.ContactPhoneField.prototype)).setPhoneNumber=function(e){this._phoneNumber=e},e.prototype.setLabel1=function(e){this._label1=e},e.prototype.setLabel2=function(e){this._label2=e},e.prototype.setPhoneNumberType=function(e){var t,i=!1;for(t in a.Services.Contacts.ContactPhoneNumberType)if(a.Services.Contacts.ContactPhoneNumberType.hasOwnProperty(t)&&e===a.Services.Contacts.ContactPhoneNumberType[t]){this._phoneNumberType=e,i=!0;break}return i},e.prototype.setSpeedDialEnabled=function(e){this._speedDialEnabled=e},e.prototype.setDefault=function(e){this._default=e},a.Services.Contacts.EditableContactPhoneField=e}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactStringField.call(this)}(t.prototype=Object.create(e.Services.Contacts.ContactStringField.prototype)).setValue=function(e){this._value=e},e.Services.Contacts.EditableContactStringField=t}(AvayaClientServices),function(g){"use strict";function e(){this._cacheKeys=[g.Services.Contacts.ContactCacheKeys.FIRST_NAME,g.Services.Contacts.ContactCacheKeys.LAST_NAME,g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,g.Services.Contacts.ContactCacheKeys.ALIAS,g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,g.Services.Contacts.ContactCacheKeys.HANDLE,g.Services.Contacts.ContactCacheKeys.LOGIN_ID,g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,g.Services.Contacts.ContactCacheKeys.CITY,g.Services.Contacts.ContactCacheKeys.DEPARTMENT,g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING,g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME],this._imdb=new g.Base.SimpleIMDB(this._cacheKeys)}e.prototype={addContact:function(e){var t=this._buildKeys(e);try{this._imdb.addElement(t,e)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to add contact to cache ("+e.message+")")}},updateContact:function(e){var t=this._buildKeysWithMatchingAddressOnly(e),i=this._buildKeys(e);try{this._imdb.updateElement(t,i,e)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to update contact in cache ("+e.message+")")}},deleteContact:function(e){var t=this._buildKeysWithMatchingAddressOnly(e);try{this._imdb.deleteElements(t)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to delete contact from cache ("+e.message+")")}},searchContacts:function(e,t,i){e=e.trim();if(t===g.Services.Contacts.SearchFieldType.NAME)return this.searchByName(e,i);if(t===g.Services.Contacts.SearchFieldType.HANDLE)return this.searchByHandle(e,i);if(t===g.Services.Contacts.SearchFieldType.LOGIN_ID)return this.searchByLoginId(e,i);if(t===g.Services.Contacts.SearchFieldType.TERMINAL)return this.searchByTerminal(e,i);if(t===g.Services.Contacts.SearchFieldType.ALL)return this.searchAll(e,i);throw new g.Services.Contacts.ContactsError(g.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+t)},resolveContacts:function(e,t,i){e=e.trim();if(t===g.Services.Contacts.ResolveContactsFieldType.HANDLE)return this.searchByHandle(e,i);if(t===g.Services.Contacts.ResolveContactsFieldType.PHONE_NUMBER)return this.resolveContactsByPhone(e,i);throw new g.Services.Contacts.ContactsError(g.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+t)},searchAll:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e).split(/[,]+/);2<(i=1===(i=i.filter(function(e){return""!==e.trim()})).length?i.toString().split(/[\s]+/):i).length&&(i[2]=i.slice(2).toString().trim());var r=new Array(i.length);if(r[0]=this._imdb.searchByAllKeys(i[0].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH),r[0]===T)return T;for(var s=1;s<i.length&&s<3;s++)if(r[s]=this._imdb.searchByAllKeys(i[s].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH),r[s]===T)return T;e=g.Base.Utils.removeDuplicatesFromArray(r[0]).filter(function(e){for(s=1;s<r.length;s++){for(var t=r[s],i=!1,a=0;a<t.length;a++)e===t[a]&&(i=!0);if(!i)return!1}return!0});if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByName:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e).split(/[,]+/);2<(i=1===(i=i.filter(function(e){return""!==e.trim()})).length?i.toString().split(/[\s]+/):i).length&&(i[2]=i.slice(2).toString().trim());for(var a=new Array(i.length),r=[g.Services.Contacts.ContactCacheKeys.FIRST_NAME,g.Services.Contacts.ContactCacheKeys.LAST_NAME,g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,g.Services.Contacts.ContactCacheKeys.ALIAS],s=0;s<i.length&&s<3;s++){a[s]=[];for(var n=0;n<r.length;n++){var o=this._imdb.searchBySingleKey(r[n],i[s].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH);a[s]=a[s].concat(o)}if(0===a[s].length)return T}e=g.Base.Utils.removeDuplicatesFromArray(a[0]).filter(function(t){function e(e){return t===e}for(s=1;s<a.length;s++)if(!a[s].some(e))return!1;return!0});if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByHandle:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeHandle(e),e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.HANDLE,i),i=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,i),i=e.concat(i),i=g.Base.Utils.removeDuplicatesFromArray(i);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<i.length&&(t._exactType1Contacts=i,t._allContacts=i,t._empty=!1),t}return i},searchByLoginId:function(e,t){e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.LOGIN_ID,e),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByTerminal:function(e,t){e=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e),e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME,e,g.Base.IMDBSearchOptions.CONTAINS),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByPhone:function(e,t){for(var i=this._imdb.getAllElements(),a=new g.Services.Contacts.MatchedContactsWithMatchLevel,r=!1,s=function(e,t,i){t=g.Services.Contacts.ContactsUtils.comparePhoneStrings(e,t);t===g.Services.Contacts.ContactMatchTypes.EXACT_TYPE1?(a._exactType1Contacts.push(i),r=!0):t===g.Services.Contacts.ContactMatchTypes.EXACT_TYPE2?a._exactType2Contacts.push(i):t===g.Services.Contacts.ContactMatchTypes.PARTIAL_TYPE1&&a._partialType1Contacts.push(i)}.bind(this),n=0;n<i.length&&!r;n++){for(var o=i[n],c=o.getPhoneNumbers().getValues(),l=0;l<c.length&&!r;l++)s(e,c[l].getPhoneNumber(),o);for(var d=o.getEmailAddresses().getValues(),l=0;l<d.length&&!r;l++)s(e,d[l].getAddress(),o);var C=o.getEmailAddresses().getValues();for(l=0;l<C.length&&!r;l++)s(e,C[l].getAddress(),o);s(e,o.getFirstName().getValue(),o),s(e,o.getLastName().getValue(),o),s(e,o.getDisplayName().getValue(),o),s(e,o.getASCIIFirstName().getValue(),o),s(e,o.getASCIILastName().getValue(),o),s(e,o.getASCIIDisplayName().getValue(),o),s(e,o.getAlias().getValue(),o),s(e,o.getManager().getValue(),o),s(e,o.getCompany().getValue(),o),s(e,o.getDepartment().getValue(),o),s(e,o.getNotes().getValue(),o),s(e,o.getLocation().getValue(),o),s(e,o.getStreetAddress().getValue(),o),s(e,o.getCity().getValue(),o),s(e,o.getState().getValue(),o),s(e,o.getCountry().getValue(),o),s(e,o.getPostalCode().getValue(),o),s(e,o.getWorkRoomNumber().getValue(),o);var u=o.getCustom1().getValues();for(l=0;l<u.length&&!r;l++)s(e,u[n].getValue(),o);var h=o.getCustom2().getValues();for(l=0;l<h.length&&!r;l++)s(e,h[n].getValue(),o);var _=o.getCustom3().getValues();for(l=0;l<_.length&&!r;l++)s(e,_[n].getValue(),o)}return a._allContacts=a._exactType1Contacts.concat(a._exactType2Contacts).concat(a._partialType1Contacts),a._allContacts=g.Base.Utils.removeDuplicatesFromArray(a._allContacts),t?(0<a._allContacts.length&&(a._empty=!1),a):a._allContacts},resolveContactsByPhone:function(e,t){e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,e,g.Base.IMDBSearchOptions.EXACT_MATCH),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},empty:function(){this._imdb=new g.Base.SimpleIMDB(this._cacheKeys)},_buildKeys:function(e){var t=e.getUniqueAddressForMatching();if(!this.hasUniqueAddressForMatching(t))return T;var i=[],a=e.getFirstName().getValue(),r=e.getASCIIFirstName().getValue();a!==T&&""!==a&&i.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(a)),r!==T&&""!==r&&r!==a&&i.push(r);var s=[],n=e.getLastName().getValue(),a=e.getASCIILastName().getValue();n!==T&&""!==n&&s.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(n)),a!==T&&""!==a&&a!==n&&s.push(a);r=[],n=e.getDisplayName().getValue(),a=e.getASCIIDisplayName().getValue();n!==T&&""!==n&&r.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(n)),a!==T&&""!==a&&a!==n&&r.push(a);for(var o=[],c=e.getPhoneNumbers().getValues(),l=0;l<c.length;l++){var d=c[l].getPhoneNumber();d!==T&&""!==d&&-1===o.indexOf(d)&&o.push(d)}for(var C=[],u=e.getEmailAddresses().getValues(),l=0;l<u.length;l++){var h=u[l].getAddress();h!==T&&""!==h&&-1===C.indexOf(h)&&C.push(h)}var _=[],v=e.getIMAddresses().getValues();for(l=0;l<v.length;l++){var p=v[l].getAddress();p!==T&&""!==p&&-1===_.indexOf(p)&&_.push(p)}a={};a[g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[t];t=e.getAlias().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.ALIAS]=[g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(t)]);t=e.getCity().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.CITY]=[t]);t=e.getAlias().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.DEPARTMENT]=[t]),!g.Base.Utils.isDefined(e.getTerminal())||(t=e.getTerminal().getTerminalName())!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME]=[t]),0<i.length&&(a[g.Services.Contacts.ContactCacheKeys.FIRST_NAME]=i),0<s.length&&(a[g.Services.Contacts.ContactCacheKeys.LAST_NAME]=s),0<r.length&&(a[g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME]=r),0<o.length&&(a[g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER]=o),0<C.length&&(a[g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS]=C),0<_.length&&(a[g.Services.Contacts.ContactCacheKeys.HANDLE]=_);e=e.getScopiaLoginId().getValue();return e!==T&&""!==e&&(a[g.Services.Contacts.ContactCacheKeys.LOGIN_ID]=[e]),a},_buildKeysWithMatchingAddressOnly:function(e){var t=e.getUniqueAddressForMatching();if(!this.hasUniqueAddressForMatching(t))return T;e={};return e[g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[t],e},hasUniqueAddressForMatching:function(e){return!(!g.Base.Utils.isDefined(e)||""===e)||(g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to build keys for contact without unique address"),!1)},isContactInCache:function(e){if(!this.hasUniqueAddressForMatching(e))return!1;var t=g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING;return 0<this._imdb.searchBySingleKey(t,e).length}},g.Services.Contacts.ContactsCache=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r,s){this._uniqueSearchId=n.Base.Utils.makeId(16),this._searchString=e,this._searchField=t,this._searchSource=i,this._maxResults=a,this._maxChunkSize=r,this._searchNetworkSource=s}e.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_generateNewUniqueSearchId:function(){this._uniqueSearchId=n.Base.Utils.makeId(16)},getSearchString:function(){return this._searchString},_setSearchString:function(e){this._searchString=e},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource},getSearchNetworkSource:function(){return this._searchNetworkSource},getMaxResults:function(){return this._maxResults},getMaxChunkSize:function(){return this._maxChunkSize}},n.Services.Contacts.ContactSearchRequest=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this),this._reason=e,this.name="ContactError",this.message=t}(e.prototype=Object.create(i.Base.BaseError.prototype)).getReason=function(){return this._reason},i.Services.Contacts.ContactsError=e}(AvayaClientServices),function(s){"use strict";function e(){this._contactsService=T,this._contacts=T,this._started=!1,this._onContactsChangedCallback=T,this._externalContactListChangesCallbacks=S.Callbacks()}e.prototype={start:function(e,t){!this._started&&e&&t&&(this._started=!0,this._contactsService=e,this._contacts=t,this._registerCallbacks())},stop:function(){this._started&&(this._started=!1,this._unregisterCallbacks())},isStarted:function(){return this._started},addOnContactListChangedCallback:function(e){e&&this._externalContactListChangesCallbacks.add(e)},removeOnContactListChangedCallback:function(e){e&&this._externalContactListChangesCallbacks.remove(e)},updateMatchedContactsForParticipant:function(e,t){var i,a=s.Services.Contacts.SearchFieldType.HANDLE,r=s.Services.Contacts.SearchFieldType.ALL;this._started&&e&&((i=e.getAddress())&&(a=this._contactsService.findLocalMatchingContacts(i,a),t&&a.isEmpty()&&(i=s.Services.Contacts.ContactsUtils.parseSipUri(i).userpart,s.Base.Utils.isDefined(i)&&(a=this._contactsService.findLocalMatchingContacts(i,r))),e.setMatchedContacts(a)))},_registerCallbacks:function(){this._onContactsChangedCallback=function(){this._externalContactListChangesCallbacks.fire()}.bind(this),this._contactsService.getDataSet().addOnDataSetChangedCallback(this._onContactsChangedCallback)},_unregisterCallbacks:function(){this._contactsService.getDataSet().removeOnDataSetChangedCallback(this._onContactsChangedCallback)}},s.Services.Contacts.ContactsIntegrationService=e}(AvayaClientServices),function(c){"use strict";function e(e,t,i,a,r,s){this._presenceService=a,this._contactsService=r,this._directorySearchProvider=t,this._contactsCache=i,this._searchRequest=e,this._dataSet=new c.Base.DataSet,this._dataRetrieval=new c.Base.DataRetrieval(this._dataSet),this._dataRetrieval._onCancel=this._cancel.bind(this),this._resultsCounter=0,this._maxResults=T,this._currentUniqueSearchId=T,this._searchCompletionDate=T,this._contactsAnalyticsService=s}e.prototype={start:function(){var e=this._searchRequest.getSearchSource(),r=this._searchRequest.getUniqueSearchId();this._maxResults=0<this._searchRequest.getMaxResults()?Math.min(this._searchRequest.getMaxResults(),this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal()):this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal(),this._currentUniqueSearchId=r,this._searchCompletionDate=T,this._resultsCounter=0;var t=function(e,t,i){this._isResultValid(r)&&(!0===t?this._dataRetrieval._dataRetrievalDone.fire(t,i):this._dataRetrieval._dataRetrievalDone.fire(t,T),this._searchCompletionDate=new Date)}.bind(this),i=function(e){this._isResultValid(r)&&(this._dataRetrieval._dataRetrievalFailed.fire(e),this._searchCompletionDate=new Date)}.bind(this),a=function(e,t,i,a){this._isResultValid(r)&&this._handleResults(e,t,i,a)}.bind(this);(e===c.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():e===c.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(t,i,a)},updateRequest:function(e){this._searchRequest._setSearchString(e),this._searchRequest._generateNewUniqueSearchId(),this._dataSet.onDataSetChanged(this._dataSet.splice(0,this._dataSet.length),c.Base.DataSetChangeTypes.REMOVED),this._searchFinished=!1,this.start()},getDataRetrieval:function(){return this._dataRetrieval},getSearchCompletionDate:function(){return this._searchCompletionDate},_isResultValid:function(e){return!this._searchCompletionDate&&this._currentUniqueSearchId===e},_handleResults:function(e,t,i,a){for(var r=!1,s=function(t){try{return this._findInArray(this._dataSet,function(e){return e.getUniqueAddressForMatching()===t.getUniqueAddressForMatching()})}catch(e){return null}}.bind(this),n=0;n<e.length&&!this._searchFinished;n++){r=!0,e[n]._setPresenceService(this._presenceService),e[n]._setContactsService(this._contactsService);var o=!1;(o=a?s(e[n]):o)?this._mergeContacts(o,e[n]):this._dataSet.push(e[n]),this._searchFinished=this._maxResults!==T&&0!==this._maxResults&&++this._resultsCounter>=this._maxResults}void 0===t&&(t=!1),r&&(this._dataSet.onDataSetChanged(e.slice(0,n),c.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,t,i))},_mergeContacts:function(e,t){this._updateContactField(e.getFirstName(),t.getFirstName()),this._updateContactField(e.getLastName(),t.getLastName()),this._updateContactField(e.getDisplayName(),t.getDisplayName()),this._updateContactField(e.getASCIIFirstName(),t.getASCIIFirstName()),this._updateContactField(e.getASCIILastName(),t.getASCIILastName()),this._updateContactField(e.getASCIIDisplayName(),t.getASCIIDisplayName()),this._updateContactField(e.getAlias(),t.getAlias()),this._updateContactField(e.getLocation(),t.getLocation()),this._updateContactField(e.getWorkRoomNumber(),t.getWorkRoomNumber()),this._updateContactField(e.getStreetAddress(),t.getStreetAddress()),this._updateContactField(e.getCity(),t.getCity()),this._updateContactField(e.getState(),t.getState()),this._updateContactField(e.getCountry(),t.getCountry()),this._updateContactField(e.getPostalCode(),t.getPostalCode()),this._updateContactField(e.getCompany(),t.getCompany()),this._updateContactField(e.getManager(),t.getManager()),this._updateContactField(e.getDepartment(),t.getDepartment()),this._updateContactField(e.getLanguage(),t.getLanguage()),this._updateContactField(e.getNotes(),t.getNotes()),this._updateContactField(e.getScopiaUserId(),t.getScopiaUserId()),this._updateContactField(e.getScopiaLoginId(),t.getScopiaLoginId()),this._updateContactField(e.getRank(),t.getRank()),this._updateContactField(e.isBuddy(),t.isBuddy()),this._updateContactField(e.isFavorite(),t.isFavorite()),this._updateContactField(e.isVideoCapable(),t.isVideoCapable());var i=function(t,e){return this._findInArray(e,function(e){return e.getPhoneNumber()===t.getPhoneNumber()})}.bind(this);this._mergeContactArrayField(e.getPhoneNumbers().getValues(),t.getPhoneNumbers().getValues(),i);i=function(t,e){return this._findInArray(e,function(e){return e.getAddress()===t.getAddress()})}.bind(this);this._mergeContactArrayField(e.getEmailAddresses().getValues(),t.getEmailAddresses().getValues(),i),this._mergeContactArrayField(e.getIMAddresses().getValues(),t.getIMAddresses().getValues(),i);i=function(t,e){return this._findInArray(e,function(e){return e.getValue()===t.getValue()})}.bind(this);this._mergeContactArrayField(e.getCustom1().getValues(),t.getCustom1().getValues(),i),this._mergeContactArrayField(e.getCustom2().getValues(),t.getCustom2().getValues(),i),this._mergeContactArrayField(e.getCustom3().getValues(),t.getCustom3().getValues(),i)},_updateContactField:function(e,t){c.Base.Utils.isDefined(t._value)&&e._value!==t._value&&(e._value=t._value)},_mergeContactArrayField:function(e,t,i){for(var a=0;a<t.length;a++)i(t[a],e)||e.push(t[a])},_findInArray:function(e,t){if(!e||"function"!=typeof t)return null;for(var i=0;i<e.length;){var a=e[i];if(t(a))return a;i++}return null},_cancel:function(){this._searchCompletionDate=new Date,this._dataRetrieval._dataRetrievalFailed.fire(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_CANCELED)),this._searchRequest.getSearchSource()!==c.Services.Contacts.SearchSourceType.LOCAL&&this._directorySearchProvider.stopDirectorySearch(this._searchRequest.getUniqueSearchId())},_limitExceeded:function(e){return this._maxResults!==T&&0!==this._maxResults&&e>this._maxResults},_resolveSearch:function(e,t,i){this._limitExceeded(t)?e.resolve(t,!1):e.resolve(t,i,t)},_searchNetworkContacts:function(){var a=this._contactsAnalyticsService.startTimingMetric(),e=this._directorySearchProvider.startDirectorySearch(this._searchRequest);return e.then(function(e,t,i){this._contactsAnalyticsService.sendNumDirectorySearches(this._searchRequest.getSearchField()),this._contactsAnalyticsService.directorySearchTimeEnd(a)}.bind(this)),e},_searchLocalContacts:function(){var e=S.Deferred(),t=this._contactsAnalyticsService.startTimingMetric(),i=this._contactsCache.searchContacts(this._searchRequest.getSearchString(),this._searchRequest.getSearchField(),!1);return this._contactsAnalyticsService.cachedContactsSearchTimeEnd(t),this._contactsAnalyticsService.sendNumCachedContactSearches(this._searchRequest.getSearchField()),setTimeout(function(){i?e.notify(i,!0,0):i=[],this._resolveSearch(e,i.length,!0)}.bind(this),0),e.promise()},_searchAllContacts:function(){function s(e,t,i){t?n=r.length+e.length:e.forEach(function(e){r.push(e.getUniqueAddressForMatching())});var a=!i&&0!==i?!1:!0;o.notify(e,a,i,t)}var n,o=S.Deferred(),r=[],t=function(e,t,i,a,r){return this._searchLocalContacts().then(function(){a?o.reject(r):this._resolveSearch(o,n,t)}.bind(this),function(e){o.reject(e)},function(e){s(e,!0,i)})}.bind(this);return this._searchNetworkContacts().then(t,function(e){c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts search failed",e),t(0,!1,0,!0,e)},s),o.promise()}},c.Services.Contacts.ContactsSearch=e}(AvayaClientServices),function(P){"use strict";function e(e,t,i,a,r){this._started=!1,this._starting=!1,this._contactsModule=T,this._contactsIntegrationService=i,this._presenceService=a,this._contactsProvider=e,this._directorySearchProvider=t,this._contactsCache=new P.Services.Contacts.ContactsCache,this._contactsDataSet=new P.Base.DataSet,this._contactsRetrieval=new P.Base.DataRetrieval(this._contactsDataSet),this._retrievalFinished=!1,this._selfContact=T,this._activeSearches={},this._activeResolveContactsRequests={},this._searchAuditIntervalId=T,this._deniedCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._addContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._updateContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._deleteContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchTerminalCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._resolveContactsCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._conferenceSearchCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._contactsAnalyticsService=r,this._selfContactBackoffPromise=T,this._selfContactBackoffTimeout=T}e.prototype={start:function(t,e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Starting the service");var i,a=this._contactsAnalyticsService.startTimingMetric();t.addOnContactsServiceUnavailableCallback(function(){i=this._contactsAnalyticsService.startTimingMetric()}.bind(this)),t.addOnContactsServiceAvailableCallback(function(){this._contactsAnalyticsService.durationContactProviderOutagesEnd(i)}.bind(this)),this._contactsModule=t,this._starting=!0,this._selfContactBackoffPromise=S.Deferred();var r=function(){return this._contactsProvider.on(P.Base.NetworkProviderEvents.UNAUTHORIZED,function(){t._fireContactsUnavailableCallback(t)}.bind(this)),this._directorySearchProvider.start(e,t)}.bind(this),s=function(){return this._directorySearchProvider.getSelfContact().then(function(e){e._setContactsService(this),e._setPresenceService(this._presenceService),e._setSelfContact(!0),this._selfContact=e,this._starting=!1,this._started=!0,t._fireContactsAvailableCallback(t),P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service started successfully")}.bind(this),function(e){return P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Self contact cannot be found",e),S.Deferred().reject(e).promise()}.bind(this))}.bind(this),n=function(t){var i=this._selfContactBackoffPromise;return this._selfContactBackoffTimeout=setTimeout(function(){t().then(function(){i.resolve()},function(e){e&&e.getReason&&e.getReason()===P.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT?n(t):i.reject(e)})}.bind(this),3e4),i}.bind(this),o=function(){return r().then(function(){this._registerContactChangesCallbacks(),this._recalculateCapabilities(),this._contactsIntegrationService.start(this,t)}.bind(this)).then(s).fail(function(e){t._fireContactsUnavailableCallback(t),this._starting=!1,this._started=!1,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",e),e&&e.getReason&&e.getReason()===P.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT&&(P.Base.Logger.warn(P.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Starting backoff algorithm for populateSelfContact."),n(s))}.bind(this)).then(function(){this._contactsAnalyticsService.contactsLoadTimeEnd(a)}.bind(this))}.bind(this);return function(){return this._contactsProvider.on(P.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.isStarted()||this.isStarting()||o()}.bind(this)),this._contactsProvider.on(P.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new P.Base.NetworkError(P.Base.ErrorReasons.NETWORK_ERROR)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout)}.bind(this)),this._contactsProvider.start(e,t)}.bind(this)().then(o,function(e){this._starting=!1,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",e)}.bind(this))},stop:function(e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var t=S.Deferred();this._started||t.reject(new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),e._fireContactsUnavailableCallback(e),this._started=!1,this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new P.Base.NetworkError(P.Base.ErrorReasons.NETWORK_CANCELED)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout);var i=function(e){this._started=!0,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to stop service",e),t.reject(e)}.bind(this),a=function(){return this._contactsProvider.stop().fail(i)}.bind(this),e=function(){return this._cleanupResources(),this._directorySearchProvider.stop().fail(i)}.bind(this);return a().then(e).then(function(){this._contactsIntegrationService.stop(),this._selfContact=T,P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),t.resolve()}.bind(this),i.bind(this)),t.promise()},stopImmediately:function(e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var t=S.Deferred();return this._started||t.reject(new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),e._fireContactsUnavailableCallback(e),this._started=!1,P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),t.resolve(),t.promise()},isStarted:function(){return this._started},isStarting:function(){return this._starting},createEditableContact:function(){var e=this._contactsProvider.createContactForAdd();return e._setContactsService(this),e},createEditableContactFromContact:function(e){if(e.getTerminal()&&""!==e.getTerminal().getTerminalId())throw new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.EDIT_TERMINAL_NOT_SUPPORTED);var t=new P.Services.Contacts.EditableContact,i=this._contactsProvider.createContactForAdd();t._setContactsService(this),t._setInContactList(e._isInContactList()),t._isInContactList()&&t._setUniqueAddressForMatching(e._getUniqueAddressWithoutChanges()),t.getFirstName().setValue(e.getFirstName().getValue()),t.getLastName().setValue(e.getLastName().getValue()),t.getDisplayName().setValue(e.getDisplayName().getValue()),t.getASCIIFirstName().setValue(e.getASCIIFirstName().getValue()),t.getASCIILastName().setValue(e.getASCIILastName().getValue()),t.getASCIIDisplayName().setValue(e.getASCIIDisplayName().getValue()),t.getAlias().setValue(e.getAlias().getValue()),t.getLocation().setValue(e.getLocation().getValue()),t.getWorkRoomNumber().setValue(e.getWorkRoomNumber().getValue()),t.getStreetAddress().setValue(e.getStreetAddress().getValue()),t.getCity().setValue(e.getCity().getValue()),t.getState().setValue(e.getState().getValue()),t.getCountry().setValue(e.getCountry().getValue()),t.getPostalCode().setValue(e.getPostalCode().getValue()),t.getCompany().setValue(e.getCompany().getValue()),t.getManager().setValue(e.getManager().getValue()),t.getDepartment().setValue(e.getDepartment().getValue()),t.getLanguage().setValue(e.getLanguage().getValue()),t.getNotes().setValue(e.getNotes().getValue()),t.getScopiaUserId().setValue(e.getScopiaUserId().getValue()),t.getScopiaLoginId().setValue(e.getScopiaLoginId().getValue()),t.getRank().setValue(e.getRank().getValue()),t.isBuddy().setValue(e.isBuddy().getValue()),t.isFavorite().setValue(e.isFavorite().getValue()),t.isVideoCapable().setValue(e.isVideoCapable().getValue()),t.getFirstName()._setWriteCapability(e.getFirstName().getWriteCapability()),t.getLastName()._setWriteCapability(e.getLastName().getWriteCapability()),t.getDisplayName()._setWriteCapability(e.getDisplayName().getWriteCapability()),t.getASCIIFirstName()._setWriteCapability(e.getASCIIFirstName().getWriteCapability()),t.getASCIILastName()._setWriteCapability(e.getASCIILastName().getWriteCapability()),t.getASCIIDisplayName()._setWriteCapability(e.getASCIIDisplayName().getWriteCapability()),t.getAlias()._setWriteCapability(e.getAlias().getWriteCapability()),t.getLocation()._setWriteCapability(e.getLocation().getWriteCapability()),t.getWorkRoomNumber()._setWriteCapability(e.getWorkRoomNumber().getWriteCapability()),t.getStreetAddress()._setWriteCapability(e.getStreetAddress().getWriteCapability()),t.getCity()._setWriteCapability(e.getCity().getWriteCapability()),t.getState()._setWriteCapability(e.getState().getWriteCapability()),t.getCountry()._setWriteCapability(e.getCountry().getWriteCapability()),t.getPostalCode()._setWriteCapability(e.getPostalCode().getWriteCapability()),t.getCompany()._setWriteCapability(e.getCompany().getWriteCapability()),t.getManager()._setWriteCapability(e.getManager().getWriteCapability()),t.getDepartment()._setWriteCapability(e.getDepartment().getWriteCapability()),t.getLanguage()._setWriteCapability(e.getLanguage().getWriteCapability()),t.getNotes()._setWriteCapability(e.getNotes().getWriteCapability()),t.getScopiaUserId()._setWriteCapability(e.getScopiaUserId().getWriteCapability()),t.getScopiaLoginId()._setWriteCapability(e.getScopiaLoginId().getWriteCapability()),t.getRank()._setWriteCapability(e.getRank().getWriteCapability()),t.isBuddy()._setWriteCapability(e.isBuddy().getWriteCapability()),t.isFavorite()._setWriteCapability(e.isFavorite().getWriteCapability()),t.isVideoCapable()._setWriteCapability(e.isVideoCapable().getWriteCapability());for(var a=e.getPhoneNumbers().getValues(),r=t.getPhoneNumbers().getValues(),s=0;s<a.length;s++){var n=new P.Services.Contacts.EditableContactPhoneField;n.setPhoneNumber(a[s].getPhoneNumber()),n.setPhoneNumberType(a[s].getPhoneNumberType()),n.setSpeedDialEnabled(a[s].isSpeedDialEnabled()),n.setLabel1(a[s].getLabel1()),n.setLabel2(a[s].getLabel2()),n.setDefault(a[s].isDefault()),n._setWriteCapability(a[s].getWriteCapability()),r.push(n)}for(var o=e.getEmailAddresses().getValues(),c=t.getEmailAddresses().getValues(),s=0;s<o.length;s++){var l=new P.Services.Contacts.EditableContactEmailAddressField;l.setAddress(o[s].getAddress()),l.setEmailAddressType(o[s].getEmailAddressType()),l._setWriteCapability(o[s].getWriteCapability()),c.push(l)}var d=e.getIMAddresses().getValues(),C=t.getIMAddresses().getValues();for(s=0;s<d.length;s++){var u=new P.Services.Contacts.EditableContactIMAddressField;u.setAddress(d[s].getAddress()),u.setIMAddressType(d[s].getIMAddressType()),u._setWriteCapability(d[s].getWriteCapability()),C.push(u)}var h=e.getCustom1().getValues(),_=t.getCustom1().getValues();for(s=0;s<h.length;s++){var v=new P.Services.Contacts.EditableContactStringField;v.setValue(h[s].getValue()),v._setWriteCapability(h[s].getWriteCapability()),_.push(v)}var p=e.getCustom2().getValues(),g=t.getCustom2().getValues();for(s=0;s<p.length;s++){var S=new P.Services.Contacts.EditableContactStringField;S.setValue(p[s].getValue()),S._setWriteCapability(p[s].getWriteCapability()),g.push(S)}var f=e.getCustom3().getValues(),E=t.getCustom3().getValues();for(s=0;s<f.length;s++){var A=new P.Services.Contacts.EditableContactStringField;A.setValue(f[s].getValue()),A._setWriteCapability(f[s].getWriteCapability()),E.push(A)}return e.getPhoneNumbers()._setWriteCapability(i.getPhoneNumbers().getWriteCapability()),e.getEmailAddresses()._setWriteCapability(i.getEmailAddresses().getWriteCapability()),e.getIMAddresses()._setWriteCapability(i.getIMAddresses().getWriteCapability()),e.getCustom1()._setWriteCapability(i.getCustom1().getWriteCapability()),e.getCustom2()._setWriteCapability(i.getCustom2().getWriteCapability()),e.getCustom3()._setWriteCapability(i.getCustom3().getWriteCapability()),t},addContact:function(e){return this._contactsProvider.addContact(e)},updateContact:function(e){return this._contactsProvider.updateContact(e)},deleteContact:function(e){return this._contactsProvider.deleteContact(e)},getContacts:function(){var e,t,i;return this._retrievalFinished?setTimeout(function(){this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this)):(e=function(){this._retrievalFinished=!0,this._contactsAnalyticsService.sendNumContactsLoaded(this._contactsDataSet.length),this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this),t=function(e){this._contactsRetrieval._dataRetrievalFailed.fire(e)}.bind(this),i=function(e){this._contactsRetrieval._dataRetrievalProgress.fire(this._contactsDataSet.length,!0,e.length)}.bind(this),this._contactsProvider.retrieveAllContacts().then(e,t,i)),this._contactsRetrieval},searchContacts:function(e){var t=e.getUniqueSearchId();if(this._activeSearches[t])return P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Contact search with provided requestId is already in progress - returning associated DataRetrieval"),this._activeSearches[t].getDataRetrieval();e=new P.Services.Contacts.ContactsSearch(e,this._directorySearchProvider,this._contactsCache,this._presenceService,this,this._contactsAnalyticsService);return(this._activeSearches[t]=e).start(),e.getDataRetrieval()},resolveContacts:function(e){var t=e.getUniqueSearchId();if(this._activeResolveContactsRequests[t])return P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution with provided requestId is already in progress - returning associated DataRetrieval"),this._activeResolveContactsRequests[t].getDataRetrieval();e=new P.Services.Contacts.ResolveContacts(e,this._directorySearchProvider,this._contactsCache,this._contactsAnalyticsService);return(this._activeResolveContactsRequests[t]=e).start(),e.getDataRetrieval()},changeSearchContactsRequest:function(e,t){var i,a;for(a in this._activeSearches)if(this._activeSearches.hasOwnProperty(a)&&this._activeSearches[a].getDataRetrieval()===e){i=this._activeSearches[a];break}if(!i)throw new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.SEARCH_REQUEST_NOT_FOUND);i.updateRequest(t)},_startSearchRequestsAudit:function(){this._searchAuditIntervalId=setInterval(function(){var e,t,i=new Date;for(e in this._activeSearches)!this._activeSearches.hasOwnProperty(e)||(t=this._activeSearches[e].getSearchCompletionDate())&&12e4<i-t&&delete this._activeSearches[e]}.bind(this),12e4)},_stopSearchRequestsAudit:function(){clearInterval(this._searchAuditIntervalId),this._searchAuditIntervalId=T},findLocalMatchingContacts:function(e,t){return this._contactsCache.searchContacts(e,t,!0)},getAddContactCapability:function(){return this._addContactCapability},getUpdateContactCapability:function(e){return e&&e._isInContactList()?this._updateContactCapability:this._deniedCapability},getDeleteContactCapability:function(e){return e&&e._isInContactList()?this._deleteContactCapability:this._deniedCapability},getNetworkSearchContactCapability:function(){return this._searchContactCapability},getNetworkResolveContactsCapability:function(){return this._resolveContactsCapability},getNetworkSearchTerminalCapability:function(){return this._searchTerminalCapability},getExtendedContactDetailsCapability:function(){return this._extendedDetailsCapability},getConferenceSearchCapability:function(){return this._conferenceSearchCapability},_recalculateCapabilities:function(){var e=!1,t=this._contactsProvider.getAddContactCapability();this._addContactCapability!==t&&(this._addContactCapability=t,e=!0);t=this._contactsProvider.getUpdateContactCapability();this._updateContactCapability!==t&&(this._updateContactCapability=t,e=!0);t=this._contactsProvider.getDeleteContactCapability();this._deleteContactCapability!==t&&(this._deleteContactCapability=t,e=!0);t=this._directorySearchProvider.getNetworkSearchContactCapability();this._searchContactCapability!==t&&(this._searchContactCapability=t,e=!0);t=this._directorySearchProvider.getNetworkResolveContactsCapability();this._resolveContactsCapability!==t&&(this._resolveContactsCapability=t,e=!0);t=this._directorySearchProvider.getNetworkSearchTerminalCapability();this._searchTerminalCapability!==t&&(this._searchTerminalCapability=t,e=!0);t=this._directorySearchProvider.getConferenceSearchCapability();this._conferenceSearchCapability!==t&&(this._conferenceSearchCapability=t,e=!0);t=this._contactsProvider.getExtendedContactDetailsCapability();this._extendedDetailsCapability!==t&&(this._extendedDetailsCapability=t,e=!0),e&&this._contactsModule._onCapabilitiesChangedCallbacks.fire(this)},_registerContactChangesCallbacks:function(){var e=P.Providers.Interfaces.ContactsProviderCallbackIds;this._contactsProvider.on(e.CONTACT_ADDED,function(e){for(var t=0;t<e.length;t++)e[t]._setInContactList(!0),e[t]._setPresenceService(this._presenceService),e[t]._setContactsService(this),this._contactsDataSet.push(e[t]),this._contactsCache.addContact(e[t]);this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.ADDED)}.bind(this));var a=function(e){for(var t=0;t<this._contactsDataSet.length;t++)if(e.getUniqueAddressForMatching()===this._contactsDataSet[t].getUniqueAddressForMatching())return t}.bind(this);this._contactsProvider.on(e.CONTACT_UPDATED,function(e){var t=a(e);P.Base.Utils.isDefined(t)?(this._contactsDataSet[t]=e,this._contactsDataSet.onDataSetChanged([e],P.Base.DataSetChangeTypes.UPDATED)):(P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Updated contact was not found in DataSet",e),this._contactsDataSet.push(e),this._contactsDataSet.onDataSetChanged([e],P.Base.DataSetChangeTypes.ADDED)),e._setInContactList(!0),e._setPresenceService(this._presenceService),e._setContactsService(this),this._contactsCache.updateContact(e)}.bind(this)),this._contactsProvider.on(e.CONTACT_DELETED,function(e){for(var t=0;t<e.length;t++){var i=a(e[t]);this._contactsDataSet.splice(i,1),e[t]._setInContactList(!1),e[t]._setPresenceService(this._presenceService),e[t]._setContactsService(this),this._contactsCache.deleteContact(e[t])}this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.REMOVED)}.bind(this)),this._contactsProvider.on(e.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this)),this._directorySearchProvider.on(e.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this))},getContactsModule:function(){return this._contactsModule},isContactInCache:function(e){return this._contactsCache.isContactInCache(e.getUniqueAddressForMatching())},getSelfContact:function(){return this._selfContact},getDataSet:function(){return this._contactsDataSet},_cleanupResources:function(){this._contactsCache.empty();var e=this._contactsDataSet.splice(0,this._contactsDataSet.length);0<e.length&&this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.REMOVED),this._contactsDataSet.dataSetChangeCallbacks.empty(),this._contactsDataSet.dataSetInvalidatedCallbacks.empty(),this._contactsRetrieval._dataRetrievalProgress.empty(),this._contactsRetrieval._dataRetrievalDone.empty(),this._contactsRetrieval._dataRetrievalFailed.empty(),this._activeSearches={},this._activeResolveContactsRequests={}}},P.Services.Contacts.ContactsService=e}(AvayaClientServices),function(c){"use strict";var e="\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*",t="(\\*|#|\\d)\\d{0,3}",i=new RegExp("^"+e+"$","i"),a=new RegExp("^"+t+"$","i"),r=new RegExp("^((\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*)|((\\*|#|\\d)\\d{0,3}))[#\\*,;]{1}[#\\*,;0-9]*$","i"),s=new RegExp("^(([^:/?#]+):)?(([^/?@#]*)@)?([^/?;#\\s]*)?","i"),n=new RegExp("^\\++[1-9]\\d{1,14}$","i"),o=new RegExp("^.+\\@.+$","i"),l=new RegExp("^\\+?[0-9a-z]+[0-9a-z\\(\\)\\.\\-]*$","i"),d={getPhoneStringType:function(e){return e&&""!==e.trim()?d.isPhoneNumber(e)?c.Services.Contacts.PhoneStringTypes.PHONE_NUMBER:d.isDialString(e)?c.Services.Contacts.PhoneStringTypes.DIALSTRING:d.isFeatureAccessCode(e)?c.Services.Contacts.PhoneStringTypes.FEATURE_ACCESS_CODE:d.isSipUri(e)?c.Services.Contacts.PhoneStringTypes.SIP_URI:c.Services.Contacts.PhoneStringTypes.UNKNOWN:c.Services.Contacts.PhoneStringTypes.UNKNOWN},isSipUri:function(e){return!!e&&!!d.parseSipUri(e).userpart},isPhoneNumber:function(e){return i.test(e)},isFeatureAccessCode:function(e){return a.test(e)},isDialString:function(e){return r.test(e)},isPhoneWithDomain:function(e){return o.test(e)},isE164Userpart:function(e){return n.test(d.parseSipUri(e).userpart)},isAlphanumericUserpart:function(e){return l.test(d.parseSipUri(e).userpart)},isNumericUserpart:function(e){return d.isPhoneNumber(d.parseSipUri(e).userpart)},normalizePhoneString:function(e){e=e.replace(/^(\+)+|([\s\-\(\)\.])+/g,"");return d.mapAlphabeticalToITU(e)},normalizeHandle:function(e){return e.replace(/^([a-z]+[a-z0-9+.-]*\:)/g,"")},normalizeAndSimplifyNameString:function(e){return e.toLowerCase().replace(/\u1E9E/g,"sz").replace(/\u00DF/g,"sz").replace(/\u00F8/g,"o").normalize("NFD").replace(/[\u0080-\u036F]/g,"").replace("ss","sz").replace("ue","u").replace("ae","a").replace("oe","o")},mapAlphabeticalToITU:function(e){return e.replace(/[ABC]{1}/i,"2").replace(/[DEF]{1}/i,"3").replace(/[GHI]{1}/i,"4").replace(/[JKL]{1}/i,"5").replace(/[MNO]{1}/i,"6").replace(/[PQRS]{1}/i,"7").replace(/[TUV]{1}/i,"8").replace(/[WXYZ]{1}/i,"9")},parseSipUri:function(e){e=e.match(s);return{scheme:e[2],userpart:e[4],host:e[5]}},comparePhoneStrings:function(e,t){var i,a,r=c.Services.Contacts.PhoneStringTypes,s=c.Services.Contacts.ContactMatchTypes,n=d.getPhoneStringType(e),o=d.getPhoneStringType(t);return n===r.UNKNOWN||o===r.UNKNOWN?s.NO_MATCH:(e=n===r.SIP_URI?(i=d.parseSipUri(e),d.normalizePhoneString(i.userpart)):d.normalizePhoneString(e),t=o===r.SIP_URI?(a=d.parseSipUri(t),d.normalizePhoneString(a.userpart)):d.normalizePhoneString(t),n!==r.SIP_URI||o!==r.SIP_URI||i.scheme===a.scheme&&i.host===a.host?e===t?n===r.SIP_URI&&o!==r.SIP_URI||n!==r.SIP_URI&&o===r.SIP_URI?s.EXACT_TYPE2:s.EXACT_TYPE1:d._trimPhoneString(e)===d._trimPhoneString(t)?s.PARTIAL_TYPE1:s.NO_MATCH:s.NO_MATCH)},_trimPhoneString:function(e){return e.substr(e.length-10)},getPhoneAndVideoChannelPresenceAddress:function(e){var t=e.getPhoneNumbers().getValues().filter(function(e){return e.isAvayaAdministered()&&e.getPhoneNumberType()===c.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}),i=t.filter(function(e){return d.isPhoneWithDomain(e.getPhoneNumber())}),e=i.filter(function(e){return d.isE164Userpart(e.getPhoneNumber())});if(e[0])return c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first E.164 phone number as Phone/Video channel presence address"),e[0];e=i.filter(function(e){return d.isNumericUserpart(e.getPhoneNumber())});if(e[0])return c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first numeric phone number as Phone/Video channel presence address"),e[0];e=i.filter(function(e){return d.isAlphanumericUserpart(e.getPhoneNumber())});return e[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first alphanumeric phone number as Phone/Video channel presence address"),e[0]):i[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first phone number with domain as Phone/Video channel presence address"),i[0]):t[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first Avaya administered phone number as Phone/Video channel presence address"),t[0]):void c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"No suitable Phone/Video channel presence address found in self contact. Channel presence publications might not work as expected.")}};c.Services.Contacts.ContactsUtils=d}(AvayaClientServices),function(e){"use strict";function t(){this._uniqueAddressForMatching=T,this._firstName=new e.Services.Contacts.EditableContactStringField,this._lastName=new e.Services.Contacts.EditableContactStringField,this._displayName=new e.Services.Contacts.EditableContactStringField,this._asciiFirstName=new e.Services.Contacts.EditableContactStringField,this._asciiLastName=new e.Services.Contacts.EditableContactStringField,this._asciiDisplayName=new e.Services.Contacts.EditableContactStringField,this._alias=new e.Services.Contacts.EditableContactStringField,this._company=new e.Services.Contacts.EditableContactStringField,this._location=new e.Services.Contacts.EditableContactStringField,this._workRoomNumber=new e.Services.Contacts.EditableContactStringField,this._streetAddress=new e.Services.Contacts.EditableContactStringField,this._city=new e.Services.Contacts.EditableContactStringField,this._state=new e.Services.Contacts.EditableContactStringField,this._country=new e.Services.Contacts.EditableContactStringField,this._postalCode=new e.Services.Contacts.EditableContactStringField,this._manager=new e.Services.Contacts.EditableContactStringField,this._department=new e.Services.Contacts.EditableContactStringField,this._language=new e.Services.Contacts.EditableContactStringField,this._emailAddresses=new e.Services.Contacts.ContactFieldList,this._phoneNumbers=new e.Services.Contacts.ContactFieldList,this._imAddresses=new e.Services.Contacts.ContactFieldList,this._buddy=new e.Services.Contacts.EditableContactBooleanField,this._favorite=new e.Services.Contacts.EditableContactBooleanField,this._videoCapable=new e.Services.Contacts.EditableContactBooleanField,this._rank=new e.Services.Contacts.EditableContactNumberField,this._notes=new e.Services.Contacts.EditableContactStringField,this._custom1=new e.Services.Contacts.ContactFieldList,this._custom2=new e.Services.Contacts.ContactFieldList,this._scopiaUserId=new e.Services.Contacts.EditableContactStringField,this._scopiaLoginId=new e.Services.Contacts.EditableContactStringField,this._custom3=new e.Services.Contacts.ContactFieldList,this._inContactList=!1,this._contactsService=T}t.prototype={getUniqueAddressForMatching:function(){var e,t=this._uniqueAddressForMatching;return t=-1<t.indexOf("/")?(e=t.split("/"))[e.length-1]:t},_getUniqueAddressWithoutChanges:function(){return this._uniqueAddressForMatching},_setUniqueAddressForMatching:function(e){this._uniqueAddressForMatching=e},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getDisplayName:function(){return this._displayName},getASCIIFirstName:function(){return this._asciiFirstName},getASCIILastName:function(){return this._asciiLastName},getASCIIDisplayName:function(){return this._asciiDisplayName},getAlias:function(){return this._alias},getLocation:function(){return this._location},getWorkRoomNumber:function(){return this._workRoomNumber},getStreetAddress:function(){return this._streetAddress},getCity:function(){return this._city},getState:function(){return this._state},getCountry:function(){return this._country},getPostalCode:function(){return this._postalCode},getCompany:function(){return this._company},getManager:function(){return this._manager},getDepartment:function(){return this._department},getLanguage:function(){return this._language},getEmailAddresses:function(){return this._emailAddresses},getPhoneNumbers:function(){return this._phoneNumbers},getIMAddresses:function(){return this._imAddresses},isBuddy:function(){return this._buddy},isFavorite:function(){return this._favorite},isVideoCapable:function(){return this._videoCapable},getNotes:function(){return this._notes},getRank:function(){return this._rank},getCustom1:function(){return this._custom1},getCustom2:function(){return this._custom2},getCustom3:function(){return this._custom3},getScopiaUserId:function(){return this._scopiaUserId},getScopiaLoginId:function(){return this._scopiaLoginId},_isInContactList:function(){return this._inContactList},_setInContactList:function(e){this._inContactList=e},_setContactsService:function(e){this._contactsService=e}},e.Services.Contacts.EditableContact=t}(AvayaClientServices),function(r){"use strict";var e={getUpdateContactCapability:function(){return this._contactsService.getUpdateContactCapability(this)},getDeleteContactCapability:function(){return this._contactsService.getDeleteContactCapability(this)},getContactSavableCapability:function(){var e=this.getLastName()&&this.getLastName().getValue()&&""!==this.getLastName().getValue().trim(),t=this.getFirstName()&&this.getFirstName().getValue()&&""!==this.getFirstName().getValue().trim(),i=this.getPhoneNumbers().getValues()[0]&&this.getPhoneNumbers().getValues()[0].getPhoneNumber()&&""!==this.getPhoneNumbers().getValues()[0].getPhoneNumber().trim(),a=this.getEmailAddresses().getValues()[0]&&this.getEmailAddresses().getValues()[0].getAddress()&&""!==this.getEmailAddresses().getValues()[0].getAddress().trim(),a=t&&e&&(i||a)?r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED;return new r.Base.Capability(a)}};S.extend(r.Services.Contacts.EditableContact.prototype,e)}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ContactCacheKeys={ADDRESS_FOR_MATCHING:"ADDRESS_FOR_MATCHING",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",ALIAS:"ALIAS",CITY:"CITY",DEPARTMENT:"DEPARTMENT",PHONE_NUMBER:"PHONE_NUMBER",EMAIL_ADDRESS:"EMAIL_ADDRESS",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL_NAME:"TERMINAL_NAME"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactEmailAddressType={EMAIL_ADDRESS_WORK:"EMAIL_ADDRESS_WORK",EMAIL_ADDRESS_OTHER:"EMAIL_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactIMAddressType={IM_ADDRESS_WORK:"IM_ADDRESS_WORK",IM_ADDRESS_OTHER:"IM_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactMatchTypes={EXACT_TYPE1:"EXACT_TYPE1",EXACT_TYPE2:"EXACT_TYPE2",PARTIAL_TYPE1:"PARTIAL_TYPE1",NO_MATCH:"NO_MATCH"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPhoneNumberType={PHONE_NUMBER_WORK:"PHONE_NUMBER_WORK",PHONE_NUMBER_HANDLE:"PHONE_NUMBER_HANDLE",PHONE_NUMBER_MOBILE:"PHONE_NUMBER_MOBILE",PHONE_NUMBER_HOME:"PHONE_NUMBER_HOME",PHONE_NUMBER_FAX:"PHONE_NUMBER_FAX",PHONE_NUMBER_PAGER:"PHONE_NUMBER_PAGER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPictureSize={XSMALL:"XSMALL",SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",XLARGE:"XLARGE",XXLARGE:"XXLARGE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactsErrorReason={UNKNOWN_REASON:"UNKNOWN_REASON",INTERNAL_ERROR:"INTERNAL_ERROR",RETRY:"RETRY",SERVER_UNAVAILABLE:"SERVER_UNAVAILABLE",INVALID_SERVER_RESPONSE:"INVALID_SERVER_RESPONSE",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED",AUTHENTICATION_CANCELLED:"AUTHENTICATION_CANCELLED",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",REQUEST_CANCELED:"REQUEST_CANCELED",DUPLICATE_CONTACT:"DUPLICATE_CONTACT",INVALID_CONTACT:"INVALID_CONTACT",REQUIRED_DATA_MISSING:"REQUIRED_DATA_MISSING",DELETE_CONTACT_NOT_AVAILABLE:"DELETE_CONTACT_NOT_AVAILABLE",ADD_CONTACT_NOT_AVAILABLE:"ADD_CONTACT_NOT_AVAILABLE",UPDATE_CONTACT_NOT_AVAILABLE:"UPDATE_CONTACT_NOT_AVAILABLE",SEARCH_CONTACTS_NOT_AVAILABLE:"SEARCH_CONTACTS_NOT_AVAILABLE",SEARCH_TERMINALS_NOT_AVAILABLE:"SEARCH_TERMINALS_NOT_AVAILABLE",GET_CONTACTS_NOT_AVAILABLE:"GET_CONTACTS_NOT_AVAILABLE",CONTACT_NOT_FOUND:"CONTACT_NOT_FOUND",INVALID_SEARCH_REQUEST:"INVALID_SEARCH_REQUEST",INVALID_SEARCH_STRING:"INVALID_SEARCH_STRING",INVALID_SEARCH_STRINGS:"INVALID_SEARCH_STRINGS",INVALID_SEARCH_SOURCE:"INVALID_SEARCH_SOURCE",INVALID_SEARCH_FIELD:"INVALID_SEARCH_FIELD",SEARCH_REQUEST_NOT_FOUND:"SEARCH_REQUEST_NOT_FOUND",SEARCH_STRINGS_TOO_LARGE:"SEARCH_STRINGS_TOO_LARGE",EDIT_TERMINAL_NOT_SUPPORTED:"EDIT_TERMINAL_NOT_SUPPORTED",CONTACTS_NOTIFICATIONS_CHANNEL_FAILED:"CONTACTS_NOTIFICATIONS_CHANNEL_FAILED",INCOMPATIBLE_SERVER_VERSION:"INCOMPATIBLE_SERVER_VERSION"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.PhoneStringTypes={PHONE_NUMBER:"PHONE_NUMBER",DIALSTRING:"DIALSTRING",FEATURE_ACCESS_CODE:"FEATURE_ACCESS_CODE",SIP_URI:"SIP_URI",UNKNOWN:"UNKNOWN"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactsFieldType={HANDLE:"HANDLE",PHONE_NUMBER:"PHONE_NUMBER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchFieldType={NAME:"NAME",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL:"TERMINAL",ALL:"ALL"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchNetworkSource={CONFERENCE_ONLY:"CONFERENCE_ONLY",ANYWHERE:"ANYWHERE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchSourceType={LOCAL:"LOCAL",NETWORK:"NETWORK",ALL:"ALL"}}(),function(e){"use strict";function t(){this._exactType1Contacts=[],this._exactType2Contacts=[],this._partialType1Contacts=[],this._allContacts=[],this._empty=!0}t.prototype={getExactType1Contacts:function(){return this._exactType1Contacts},getExactType2Contacts:function(){return this._exactType2Contacts},getPartialType1Contacts:function(){return this._partialType1Contacts},getAllContacts:function(){return this._allContacts},isEmpty:function(){return this._empty},_setExactType1Contacts:function(e){this._exactType1Contacts=e},_setExactType2Contacts:function(e){this._exactType2Contacts=e},_setPartialType1Contacts:function(e){this._partialType1Contacts=e},_setAllContacts:function(e){this._allContacts=e},_setEmpty:function(e){this._empty=e},_equals:function(e){return e&&this.empty===e.empty&&this._areArraysEqual(this._exactType1Contacts,e._exactType1Contacts)&&this._areArraysEqual(this._exactType2Contacts,e._exactType2Contacts)&&this._areArraysEqual(this._partialType1Contacts,e._partialType1Contacts)},_areArraysEqual:function(e,i){return e.length===i.length&&e.every(function(e,t){return e===i[t]})}},e.Services.Contacts.MatchedContactsWithMatchLevel=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactResult=function(e,t,i){this.searchString=e,this.searchScope=t,this.contacts=i}}(),function(s){"use strict";function e(e,t,i,a){this._directorySearchProvider=t,this._contactsCache=i,this._resolveContactsRequest=e,this._dataSet=new s.Base.DataSet,this._dataRetrieval=new s.Base.DataRetrieval(this._dataSet),this._uniqueSearchStrings=s.Base.Utils.removeDuplicatesFromArray(e.getSearchStrings()),this._contactsAnalyticsService=a}e.prototype={start:function(){var e=this._resolveContactsRequest.getSearchSource(),t=function(){this._dataRetrieval._dataRetrievalDone.fire()}.bind(this),i=function(e){this._dataRetrieval._dataRetrievalFailed.fire(e)}.bind(this),a=function(e){this._handleResults(e)}.bind(this);(e===s.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():e===s.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(t,i,a)},getDataRetrieval:function(){return this._dataRetrieval},_handleResults:function(e){var t=!1;e.forEach(function(e){e.contacts.length&&(t=!0,this._dataSet.push(e))}.bind(this)),t&&(this._dataSet.onDataSetChanged(e.slice(),s.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,!1))},_searchNetworkContacts:function(e){var e=e||this._uniqueSearchStrings,t=this._contactsAnalyticsService.startTimingMetric(),i=this._resolveContactsRequest.getSearchField(),e=this._directorySearchProvider.startResolvingContacts(e,i);return e.then(function(){this._contactsAnalyticsService.sendNumResolveContacts(i),this._contactsAnalyticsService.resolveContactsTimeEnd(t)}.bind(this)),e},_searchLocalContacts:function(){var e=S.Deferred(),a=this._resolveContactsRequest.getSearchField(),t=this._uniqueSearchStrings.reduce(function(e,t){var i=this._contactsCache.resolveContacts(t,a,!1);return e.push(new s.Services.Contacts.ResolveContactResult(t,a,i)),e}.bind(this),[]);return setTimeout(function(){t&&e.notify(t),e.resolve()},0),e.promise()},_searchAllContacts:function(){function t(e){e.forEach(function(e){e.contacts.length&&a.push(e.searchString)}),i.notify(e)}var i=S.Deferred(),a=[],r=function(){var e=this._uniqueSearchStrings.filter(function(e){return-1===a.indexOf(e)});if(e.length)return this._searchNetworkContacts(e).then(function(){i.resolve()},function(e){s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts quick search failed",e),i.reject(e)},function(e){t(e)});i.resolve()}.bind(this);return this._searchLocalContacts().then(r,function(e){s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"Local contacts quick search failed",e),r()},t),i.promise()}},s.Services.Contacts.ResolveContacts=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){this._uniqueSearchId=a.Base.Utils.makeId(16),this._searchStrings=e,this._searchField=t,this._searchSource=i}e.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_setSearchStrings:function(e){this._searchStrings=e},_setSearchField:function(e){this._searchField=e},_setSearchSource:function(e){this._searchSource=e},getSearchStrings:function(){return this._searchStrings},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource}},a.Services.Contacts.ResolveContactsRequest=e}(AvayaClientServices),function(e){"use strict";function t(){this._terminalId="",this._terminalName=""}t.prototype={getTerminalId:function(){return this._terminalId},getTerminalName:function(){return this._terminalName}},e.Services.Contacts.Terminal=t}(AvayaClientServices),function(e){"use strict";function t(e){this._attachmentBuilder=e}t.prototype={_resizeImage:function(e,t){var i,a=document.createElement("canvas"),t=t.scale?(i=e.width*t.scale,e.height*t.scale):t.width&&!t.height?(i=t.width,parseInt(t.width*e.height/e.width)):t.height&&!t.width?(i=parseInt(t.height*e.width/e.height),t.height):(i=e.width,e.height);return a.height=t,a.width=i,a.getContext("2d").drawImage(e,0,0,i,t),a.toDataURL("image/jpeg")},create:function(){}},e.Services.Messaging.AbstractThumbnailCreator=t}(AvayaClientServices),function(a){"use strict";function e(e){this._thumbnailCreator=e}e.prototype={build:function(e,t){var i=new a.Services.Messaging.Attachment(this._thumbnailCreator);return e=e||{},i.disposition=e.disposition,i.duration=e.duration,i.mimeType=e.mimeType,i.id=e.partId,i.location=e.location||e.media,i.size=e.size,i.name=i.getName(),i.file=t,i.status=e.status||a.Services.Messaging.ResourceStatus.PUBLISHED,this._recalculateCapabilities(i),i},update:function(e,t){t.thumbnail&&(e.thumbnail.location=t.thumbnail.location),e.id=t.partId,e.location=t.location||t.media,e.duration!==t.duration&&(e.duration=t.duration,e._onDurationChangedCallbacks.fire(e,t.duration)),e.status!==a.Services.Messaging.ResourceStatus.PUBLISHED&&(e.status=a.Services.Messaging.ResourceStatus.PUBLISHED,e._onStatusChangedCallbacks.fire(e,a.Services.Messaging.ResourceStatus.PUBLISHED)),e.file&&(e.file=T)},_recalculateCapabilities:function(e){e._recalculateUpdateNameCapability(),e._recalculateUpdateMimeTypeCapability(),e._recalculateUpdateDurationCapability(),e._recalculateUpdateIsSelfGeneratedCapability(),e._recalculateCreateThumbnailCapability(),e._recalculateRemoveThumbnailCapability(),e._recalculateRemoveCapability()}},a.Services.Messaging.AttachmentBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentStatus={READY_TO_DOWNLOAD:"READY_TO_DOWNLOAD",DOWNLOADING:"DOWNLOADING",READY_TO_CONSUME:"READY_TO_CONSUME",CONSUMED:"CONSUMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentType={MAIN:"MAIN",THUMBNAIL:"THUMBNAIL"}}(),function(e){"use strict";function t(e,t){this.action=e&&e.action||"typing",this.participant=t,this.state=e&&e.state||"paused",this.timestamp=e?e.timestamp:T}t.prototype={getAction:function(){return this.action},getParticipant:function(){return this.participant},getState:function(){return this.state},getTimestamp:function(){return this.timestamp}},e.Services.Messaging.ChatStateEvent=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ConversationType={THREAD:"THREAD"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageImportance={HIGH:"HIGH",LOW:"LOW",NORMAL:"NORMAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageType={MESSAGE:"MESSAGE",JOINED:"JOINED",LEFT:"LEFT",SESSION:"SESSION",SUBJECT_CHANGE:"SUBJECT_CHANGE",CLOSED:"CLOSED",START:"START"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="MessagingError",this.message=e}e.prototype=Object.create(i.Base.BaseError.prototype),i.Services.Messaging.MessagingError=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.MessagingErrorReason={MESSAGING_NOTIFICATIONS_DISABLED:"Notification channel is disabled.",MESSAGING_CLOSE_FAILED:"Server failed to be closed.",MESSAGING_SEND_ATTACHMENT_FAILED:"Failed to send attachment.",MESSAGING_FEATURE_NOT_AVAILABLE:"Feature is not available in determined server version.",MESSAGING_SERVER_ERROR:"Action failed due to server error.",MESSAGING_NOTIFICATION_FAILED:"Notification failed.",MESSAGING_PARTICIPANT_ADDRESS_INVALID:"Failed to add Participant to Conversation.",MESSAGING_LEAVE_CONVERSATION_FAILED:"Failed to leave one or more conversations.",MESSAGING_NOT_STARTED:"Failed to perform selected action. Messaging is not started.",MESSAGING_CREATE_ATTACHMENT_FAILED:"Failed to create attachment. Internal browser error.",MESSAGING_BODY_LENGTH_EXCEEDED:"Failed to send message. Maximum message body length exceeded.",MESSAGING_SUBJECT_LENGTH_EXCEEDED:"Failed to send message. Maximum message subject length exceeded.",MESSAGING_INVALID_STATE:"Invalid state.",MESSAGING_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",MESSAGING_INTERNAL_ERROR:"An internal error occurred.",MESSAGING_TIMEOUT:"An operation has timed out"}}(),function(e){"use strict";function t(){this._searchBody=!1,this._searchParticipants=!1,this._searchSubject=!1,this._resultsPerConversation=0,this._query="",this._after=T}t.prototype={isSearchParticipants:function(){return this._searchParticipants},isSearchSubject:function(){return this._searchSubject},isSearchBody:function(){return this._searchBody},getQueryAfter:function(){return this._after},getQuery:function(){return this._query},getNumberResultsPerConversation:function(){return this._resultsPerConversation},searchParticipants:function(e){this._searchParticipants=e},searchSubject:function(e){this._searchSubject=e},searchBody:function(e){this._searchBody=e},setQueryAfter:function(e){this._after=e},setQuery:function(e){this._query=e.toLowerCase()},setNumberResultsPerConversation:function(e){this._resultsPerConversation=e}},e.Services.Messaging.MessagingQuery=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ResourceStatus={DRAFT_UNSENT:"DRAFT_UNSENT",DRAFT_SENDING:"DRAFT_SENDING",DRAFT_REMOVING:"DRAFT_REMOVING",DRAFT_ERROR:"DRAFT_ERROR",PUBLISHED:"PUBLISHED",PUBLISHED_LEAVING:"PUBLISHED_LEAVING",PUBLISHED_LEFT:"PUBLISHED_LEFT"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SensitivityLevel={NORMAL:"NORMAL",PERSONAL:"PERSONAL",PRIVATE:"PRIVATE",CONFIDENTIAL:"CONFIDENTIAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SessionType={AUDIO:"AUDIO",VIDEO:"VIDEO"}}(),function(e){"use strict";function t(e){this._href=e&&e.href||"",this._id=e&&e.id||"",this._lastAccessedTime=e&&e.lastAccessedTime||"",this._lastUpdated=e&&e.lastUpdated||""}t.prototype={getHref:function(){return this._href},getId:function(){return this._id},getLastAccessedTime:function(){return this._lastAccessedTime},getLastUpdatedTime:function(){return this._lastUpdated}},e.Services.Messaging.ConversationId=t}(AvayaClientServices),function(_){"use strict";function e(e,t,i,a,r,s,n){this._provider=e,this._messageService=t,this._participantsService=i,this._escalationService=a,this._messageBuilder=r,this._messagingService=T,this._conversationBuilder=s,this._messagingAnalyticsService=n}e.prototype={getParticipants:function(e,t,i){return e.participants},createMessage:function(a){var e={subject:a.subject,threadId:a.id,to:a.participants,event:{type:_.Services.Messaging.MessageType.MESSAGE},resourceStatus:_.Services.Messaging.ResourceStatus.DRAFT_UNSENT,flags:{sensitivity:a.getSensitivity()}},r=this._messageBuilder.build(e,this._participantsService.getSelfParticipant(),this._messageService,a);return this._provider.on(_.Providers.AMM.ProviderStates.AVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),this._provider.on(_.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),a._getLastMessage()&&(r.coalesced=this._messageBuilder.isMessageCoalesced(r,a._getLastMessage())),r.addOnStatusChangedCallback(function(e,t){var i;t===_.Services.Messaging.ResourceStatus.PUBLISHED?(i=a._draftMessages.indexOf(e),a._draftMessages.splice(i,1),a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.id=e.threadId,a.getParticipants(),a._setStatus(_.Services.Messaging.ResourceStatus.PUBLISHED))):t===_.Services.Messaging.ResourceStatus.DRAFT_ERROR?(a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_ERROR),a.messages.onDataSetChanged([r],_.Base.DataSetChangeTypes.UPDATED)):t===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_SENDING),a._onMessagesAddedCallbacks.fire(a,[r]),a.messages.onDataSetChanged([r],_.Base.DataSetChangeTypes.UPDATED)),this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),a._draftMessages.push(r),a.messages.unshift(r),r},getMessageById:function(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t)return e[i]},createNewClientMessage:function(e,t){return this._messageBuilder.build(e,this._participantsService.getOrCreateParticipant(e.from),this._messageService,t)},leave:function(t){var i=S.Deferred();return _.Base.Utils.isDefined(t.id)?this._provider.leaveConversation(t.id).then(function(){var e=this._messagingService.conversations.indexOf(t);0<=e&&(this._messagingService.conversations.splice(e,1),this._messagingService.conversations.onDataSetChanged([t],_.Base.DataSetChangeTypes.REMOVED)),i.resolve(!0)}.bind(this),function(e){i.reject(e)}):i.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED)),i.promise()},changeSubject:function(e,t){for(var i={threadId:e.id,body:"",event:{type:"SUBJECT_CHANGE"},subject:t,to:[]},a=e.getParticipants(),r=0;r<a.length;r++)i.to.push({address:a[r].getAddress(),type:a[r].getType()});return this._provider.changeSubject(i)},getOtherMessages:function(e,t,i,a){var r,s=new _.Base.DataRetrieval,n=s.getDataSet(),o=this._provider.getMaxMessageCount();return i&&o<i?this._getMoreOtherMessages(e,t,i,a,o,s):(r={cancel:function(){}},this._provider.getMessages(r,a.getId(),i,e,t).done(function(e){0<a.getMessages().length&&(e=this._conversationBuilder.update(a,e,this),n.push(e),n.onDataSetChanged(e,_.Base.DataSetChangeTypes.ADDED),s._dataRetrievalProgress.fire(e.length,!0,e.length),s.isCompleted=!0,s._dataRetrievalDone.fire())}.bind(this)).fail(function(e){s._dataRetrievalFailed.fire(e)}),s._onCancel=function(){r.cancel()}),s},_getMoreOtherMessages:function(e,t,i,a,n,o){var c=[],l={},d=o.getDataSet(),C=0,u=Math.floor(i/n),h=i%n;h&&(u+=1);for(var r=function(t,i,a,r){var s,e;o.isCancelled||o.isCompleted||(e={cancel:function(){}},this._provider.getMessages(e,r.id,a,t,i).done(function(e){0===C?l=e:l.messages=l.messages.concat(e.messages),t?t=e.messages[e.messages.length-1]:i=e.messages[e.messages.length-1],(C+=1)<u&&e.messages.length===n?(C===u-1&&h?c[C](t,i,h,r):c[C](t,i,a,r),s=this._conversationBuilder.updateMessages(r,l,this),d.push(s),d.onDataSetChanged(s,_.Base.DataSetChangeTypes.ADDED),o._dataRetrievalProgress.fire(e.messages.length,!1)):(s=this._conversationBuilder.updateMessages(r,l,this),d.push(s),d.onDataSetChanged(s,_.Base.DataSetChangeTypes.ADDED),o._dataRetrievalProgress.fire(e.messages.length,!1),o.isCompleted=!0,o._dataRetrievalDone.fire())}.bind(this)).fail(function(e){o._dataRetrievalFailed.fire(e)}),o._onCancel=function(){e.cancel()})}.bind(this),s=0;s<u;s++)c.push(r);c[0](e,t,T,a)},markAllAsRead:function(e){return this._provider.markAllAsRead(e.id)},markMultipleAsRead:function(e,t,i){return this._provider.markAllAsRead(e.id,t,i)},removeMessage:function(e,t,i){var a,r=S.Deferred();return i?i.getRemoveCapability().isAllowed?(0<=(a=e.indexOf(i))&&(e.splice(a,1),e.onDataSetChanged([i],_.Base.DataSetChangeTypes.REMOVED)),0<=(a=t.indexOf(i))&&t.splice(a,1),r.resolve()):r.reject(i.getRemoveCapability().denialReason):r.reject(),r.promise()},createEscalation:function(i){var e={type:_.Services.Messaging.MessageType.SESSION,extensions:{},conversation:i},a=new _.Services.Messaging.Escalation(e,this._escalationService);return this._provider.on(_.Providers.AMM.ProviderStates.AVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),this._provider.on(_.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),a.addParticipants(this.getParticipants(i)),a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_UNSENT),a.addOnStatusChangedCallback(function(e,t){t===_.Services.Messaging.ResourceStatus.PUBLISHED?(e=i._draftEscalations.indexOf(e),i._draftEscalations.splice(e,1)):t===_.Services.Messaging.ResourceStatus.DRAFT_ERROR&&i.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING?i._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_ERROR):t===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&i.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&i._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),a},removeEscalation:function(e,t){var i,a=S.Deferred();return e?e.getRemoveCapability().isAllowed?(0<=(i=t.indexOf(e))&&t.splice(i,1),a.resolve()):a.reject(e.getRemoveCapability().denialReason):a.reject(),a.promise()},addParticipantAddresses:function(s,e){var n=S.Deferred();_.Base.Utils.clean(e,"");var t=S.map(s.getActiveParticipants(),function(e,t){return e.getAddress()}),i=e.filter(function(e){return-1===t.indexOf(e)}),o=e.filter(function(e){return-1!==t.indexOf(e)}),a=function(e){var t=[];if(s.getStatus()===_.Services.Messaging.ResourceStatus.PUBLISHED){for(var i={participants:[]},a=0;a<e.length;a++)i.participants.push({address:e[a]._address,type:"CONTACT"}),t.push(e[a]._address);this._provider.addParticipantsToConversation(s.getId(),i).then(function(e){this._updateParticipantsList(s,e.participants),n.resolve(t)}.bind(this),function(e){n.reject(e)})}else if(s.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var r=0;r<e.length;r++)t.push(e[r]._address);this._updateParticipantsList(s,e),n.resolve(t)}}.bind(this),e=function(e,t){if(t&&0<t.length){for(var i=[],a={participants:[]},r=0;r<t.length;r++)a.participants.push({address:t[r]._address,type:t[r].type}),i.push(t[r]._address);s.getStatus()===_.Services.Messaging.ResourceStatus.PUBLISHED?this._provider.addParticipantsToConversation(s.getId(),a).then(function(e){this._updateParticipantsList(s,e.participants),n.resolve(i)}.bind(this),function(e){n.reject(e)}):s.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(this._updateParticipantsList(s,t),n.resolve(i))}else e._data=e.getData().concat(o),n.reject(e)}.bind(this);return this.validateUsers(i).then(a,e.bind(this)),n.promise()},validateUsers:function(e){var t,a=S.Deferred(),i=this._provider.getRoutableDomains(),r=[],s=[];for(var n,o,c=0;c<e.length;c++){if(t=l=!1,n=e[c],/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(n)){for(var l=!0,d=0;d<i.length;d++)if(null!==e[c].match(i[d])){r.push(e[c]),t=!0;break}t||0}l&&t||(s.push(e[c]),_.Base.Logger.debug(_.Base.LoggerTags.MESSAGING_SERVICE,"Invalid address email:",e[c]))}return 0<r.length?(o=this._messagingAnalyticsService.startTimingMetric(),this._provider.validateUsers(r).then(function(e){this._messagingAnalyticsService.trackTimeRequestsValidateAddressesEnd(o);for(var t=[],i=0;i<e.validatedAddresses.length;i++)0<e.validatedAddresses[i].addresses.length?t.push(e.validatedAddresses[i].addresses[0]):s.push(e.validatedAddresses[i].query);0<s.length?a.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,s),t):a.resolve(t)}.bind(this),function(e){var t=_.Services.Messaging.MessagingErrorReason.MESSAGING_SERVER_ERROR;this._messagingAnalyticsService.trackErrorsResponseValidateAddresses(t),a.reject(new _.Services.Messaging.MessagingError(t,e))}.bind(this))):a.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,s)),a.promise()},addParticipants:function(e,t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].address);return this.addParticipantAddresses(e,i)},_updateParticipantsList:function(e,t){for(var i=[],a=[],r=0;r<t.length;r++){for(var s,n=!0,o=0;o<e.participants.length;o++)if(t[r]._address===e.participants[o]._address){n=!1;break}n&&(s=this._participantsService.getOrCreateParticipant(t[r]),i.push(s),e.participants.push(s),a.push(s))}return 0<a.length&&(e.participants.onDataSetChanged(a,_.Base.DataSetChangeTypes.ADDED),e._onParticipantsAddedCallbacks.fire(e,a)),e.participants},getParticipantsFromMessage:function(e){for(var t=new _.Base.DataSet,i=0;i<e.to.length;i++){var a=this._participantsService.getOrCreateParticipant(e.to[i]);t.push(a)}if(_.Base.Utils.isDefined(e.event)&&e.event.type===_.Services.Messaging.MessageType.LEFT)for(var r=0;r<e.event.participants.length;r++){var s=this._participantsService.getOrCreateParticipant(e.event.participants[r]),s=t.indexOf(s);t.splice(s,1)}return t},removeParticipantAddresses:function(e,t){var i=S.Deferred(),a=!1,r=[];if(_.Base.Utils.clean(t,""),e.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var s=0;s<t.length;s++)for(var n=e.participants.length-1;0<=n;n--)if(e.participants[n]._address===t[s]){r.push(e.participants.splice(n,1)[0]),a=!0;break}a&&(e.participants.onDataSetChanged(r,_.Base.DataSetChangeTypes.REMOVED),e._onParticipantsRemovedCallbacks.fire(e,r)),i.resolve()}else i.reject("Could not remove participants");return i.promise()},removeParticipants:function(e,t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].address);return this.removeParticipantAddresses(e,i)},close:function(t){return this._provider.close(t.id).then(function(e){return t.closed=!0,t._onClosedStatusChangedCallbacks.fire(t,t.closed),e}.bind(this))},setLastAccessTime:function(e){this._provider.setLastAccessTime(e.id,{}).then(function(){e._onLastAccessTimeChangedCallbacks.fire(e,e.lastAccessTime)})},subscribeForTypingEvents:function(i,a){var e=function(e){var t;a&&(t=new _.Services.Messaging.ChatStateEvent(e,this._participantsService._getParticipant(e.address)),a(t)),"composing"===e.state?this.addComposingParticipantToConversation(i,this._participantsService._getParticipant(e.address)):"paused"===e.state&&this.removeComposingParticipantFromConversation(i,this._participantsService._getParticipant(e.address))}.bind(this);return this._provider.subscribeForTypingEventsInConversation(i.getId(),e).then(function(e){return i._isSubscribed=!0,this._recalculateAllConversationCapabilities(i),e}.bind(this))},unsubscribeForTypingEvents:function(t){return this._provider.unsubscribeForTypingEventsInConversation(t.getId()).then(function(e){return t._isSubscribed=!1,this._recalculateAllConversationCapabilities(t),e}.bind(this))},reportTyping:function(e,t){var i=this._participantsService.getSelfParticipant();t?this._provider.reportTyping(e.threadId,t).then(function(){this.addComposingParticipantToConversation(e.conversation,i)}.bind(this),function(e){_.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report typing: ",e)}.bind(this)):this._provider.reportTyping(e.conversation.id,t).then(function(){this.removeComposingParticipantFromConversation(e.conversation,i)}.bind(this),function(e){_.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report paused typing: ",e)}.bind(this))},reportCustomChatNotification:function(t,e,i){var a=this._participantsService.getSelfParticipant();return i?this._provider.reportCustomChatNotification(t.getId(),e,i).then(function(e){return this.addComposingParticipantToConversation(t,a),e}.bind(this),function(e){return _.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report custom chat notification: ",e),S.Deferred().reject(e).promise()}.bind(this)):this._provider.reportCustomChatNotification(t.getId(),e,i).then(function(e){return this.removeComposingParticipantFromConversation(t,a),e}.bind(this),function(e){return _.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report pause custom chat notification: ",e),S.Deferred().reject(e).promise()}.bind(this))},addComposingParticipantToConversation:function(e,t){e.getComposingParticipants().indexOf(t)<0&&(e.composingParticipants.push(t),e._onIsComposingStatusChangedCallbacks.fire(e,!0))},removeComposingParticipantFromConversation:function(e,t){t=e.composingParticipants.indexOf(t);0<=t&&(e.composingParticipants.splice(t,1),e._onIsComposingStatusChangedCallbacks.fire(e,!0))},isOpened:function(){return this._provider.isOpened()},isServiceAvailable:function(){return this._provider.isAvailable()},getMaxMessageCount:function(){return this._provider.getMaxMessageCount()},_recalculateAllConversationCapabilities:function(e){e._recalculateUpdateSubjectCapability(),e._recalculateUpdateLastAccessTimeCapability(),e._recalculateUpdateSensitivityCapability(),e._recalculateOlderContentCapability(),e._recalculateAddParticipantsCapability(),e._recalculateRemoveParticipantsCapability(),e._recalculateCreateMessageCapability(),e._recalculateCreateEscalationCapability(),e._recalculateMarkAllContentAsReadCapability(),e._recalculateLeaveCapability(),e._recalculateRemoveCapability(),e._recalculateStartCapability(),e._recalculateIsTypingCapability()},isUpdateSubjectSupported:function(){return this._provider.isUpdateSubjectSupported()},isMarkAllContentAsReadSupported:function(){return this._provider.isMarkAllContentAsReadSupported()},getNumberOfMessagesWithUnreadContentSinceLastAccess:function(t){var e=t.getMessages();return(t.getLastAccessTime().getTime()?e.filter(function(e){return!e.isRead()&&e.getReceivedDate()>t.getLastAccessTime()}):e).length}},_.Services.Messaging.ConversationService=e}(AvayaClientServices),function(c){"use strict";function e(e){this._provider=e}e.prototype={start:function(t){for(var e={extensions:t.extensions,sessionType:t.sessionType||c.Services.Messaging.SessionType.AUDIO,type:t.type,participants:[]},i=0;i<t.participants.length;i++)e.participants.push({address:t.participants[i]._address});return t._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._provider.callEscalationEvent(e,t.conversation.id).then(function(e){return t._setStatus(c.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllEscalationCapabilities(t),t._onStartSuccessCallbacks.fire(t),e}.bind(this),function(e){this._recalculateAllEscalationCapabilities(t),t._onStartFailedCallbacks.fire(t,e)}.bind(this))},addParticipantAddresses:function(e,t){var i=S.Deferred(),a=this._provider.getRoutableDomains();if(e.getAddParticipantsCapability().isAllowed){for(var r=[],s=0;s<t.length;s++)for(var n,o=0;o<a.length;o++)null!==t[s].match(a[o])&&(n={_address:t[s]},e.participants.push(n),r.push(n));0<r.length&&e.participants.onDataSetChanged(r,c.Base.DataSetChangeTypes.ADDED),i.resolve(e)}else i.reject(e.getAddParticipantsCapability().denialReason);return i.promise()},addParticipants:function(e,t){var i=S.Deferred();if(e.getAddParticipantsCapability().isAllowed){for(var a=!1,r=0;r<t.length;r++)e.participants.push(t[r]),a=!0;a&&e.participants.onDataSetChanged(t,c.Base.DataSetChangeTypes.ADDED),i.resolve(e)}else i.reject(e.getAddParticipantsCapability().denialReason);return i.promise()},removeParticipantAddresses:function(e,t){var i=S.Deferred();if(e.getRemoveParticipantsCapability().isAllowed){for(var a=[],r=e.participants.length-1;0<=r;r--)for(var s=t.length-1;0<=s;s--)if(e.participants[r]._address===t[s]){a.push(e.participants[r]),e.participants.splice(r,1),t.splice(s,1);break}0<a.length&&e.participants.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED),i.resolve(e)}else i.reject(e.getRemoveParticipantsCapability().denialReason);return i.promise()},removeParticipants:function(e,t){var i=S.Deferred(),a=[];if(e.getRemoveParticipantsCapability().isAllowed){for(var r=e.participants.length-1;0<=r;r--)for(var s=t.length-1;0<=s;s--)if(e.participants[r]._address===t[s]._address){a.push(e.participants[r]),e.participants.splice(r,1),t.splice(s,1);break}0<a.length&&e.participants.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED),i.resolve(e)}else i.reject(e.getRemoveParticipantsCapability().denialReason);return i.promise()},setSessionType:function(e,t){if(!c.Base.Utils.isDefined(c.Services.Messaging.SessionType[t]))throw e._onSessionTypeChangedFailedCallbacks.fire(this,t),new Error("Unknown Session type");e.sessionType=t,e._onSessionTypeChangedSuccessCallbacks.fire(this,t)},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllEscalationCapabilities:function(e){e._recalculateStartCapability(),e._recalculateAddParticipantsCapability(),e._recalculateRemoveParticipantsCapability(),e._recalculateUpdateSessionTypeCapability(),e._recalculateRemoveCapability()}},c.Services.Messaging.EscalationService=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Messaging.AbstractThumbnailCreator.call(this,e)}(e.prototype=Object.create(t.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(i,a){var r=S.Deferred(),s={disposition:i.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:i.status},e=new FileReader;return e.onloadend=function(){var t=new Image;t.src=e.result,t.onload=function(){var e=new Blob([this._resizeImage(t,a)],{type:"image/jpeg"});s.size=e.size,i.thumbnail=this._attachmentBuilder.build(s,e),r.resolve(i.thumbnail)}.bind(this)}.bind(this),e.onerror=function(e){r.reject(e)}.bind(this),e.readAsDataURL(i.file),r.promise()},t.Services.Messaging.ImageThumbnailCreator=e}(AvayaClientServices),function(n){"use strict";function e(e,t){this._attachmentBuilder=e,this._participantService=t}e.prototype={build:function(e,t,i,a){var r,s=new n.Services.Messaging.Message(i,a);return s.resourceStatus=e.resourceStatus||n.Services.Messaging.ResourceStatus.PUBLISHED,s.body=e.body,n.Base.Utils.isDefined(e.htmlBody)&&(s.htmlBody=e.htmlBody),e.event&&(s.type=e.event.type,s.eventRelatedParticipants=e.event.participants,s._sessionType=e.event.sessionType),e.flags&&(s.sensitivity=e.flags.sensitivity,s.importance=e.flags.importance,s.read=e.flags.read,s.doNotForward=e.flags.doNotForward),s.from=t,s.inReplyTo=e.inReplyTo,s.href=e.href,s.id=e.id,s.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):new Date,s.receivedDate=new Date(e.receivedDate),s.subject=e.subject,s.threadId=e.threadId,s.to=[],e.to&&e.to.forEach&&(e.to.forEach(function(e){s.to.push(this._participantService.getOrCreateParticipant(e))}.bind(this)),a._updateParticipantsList(s.to)),e.parts&&(r=[],e.parts.forEach(function(e){r.push(this._attachmentBuilder.build(e))}.bind(this)),s.parts=this.pairThumbnailsAndAttachments(r)),i._recalculateAllMessageCapabilities(s),s},update:function(i,e){i.body!==e.body&&(i.body=e.body,i._onBodyChangedCallbacks.fire(i,i.body)),i.type!==e.event.type&&(i.type=e.event.type,i._onTypeChangedCallbacks.fire(i,i.type)),i.doNotForward!==e.flags.doNotForward&&(i.doNotForward=e.flags.doNotForward,i._onDoNotForwardStatusChangedCallbacks.fire(i,i.doNotForward)),i.importance!==e.flags.importance&&(i.importance=e.flags.importance,i._onImportanceChangedCallbacks.fire(i,i.importance)),i.sensitivity!==e.flags.sensitivity&&(i.sensitivity=e.flags.sensitivity,i._onSensitivityChangedCallbacks.fire(i,i.sensitivity)),i.read!==e.flags.read&&(i.read=e.flags.read,i._onIsReadStatusChangedCallbacks.fire(i,i.read)),i.href!==e.href&&(i.href=e.href);var t=new Date(e.lastModifiedDate);i.lastModifiedDate&&i.lastModifiedDate.toISOString()===t.toISOString()||(i.lastModifiedDate=t,i._onLastModifiedDateChangedCallbacks.fire(i,t)),t=new Date(e.receivedDate),i.receivedDate&&"Invalid Date"!==i.receivedDate.toString()&&i.receivedDate.toISOString()===t.toISOString()||(i.receivedDate=t),i.subject!==e.subject&&(i.subject=e.subject),i.id!==e.id&&(i.id=e.id),i.threadId!==e.threadId&&(i.threadId=e.threadId),i.getInReplyTo()!==e.inReplyTo&&(i.inReplyTo=e.inReplyTo,i._onInReplyToChangedCallbacks(i,i.getInReplyTo()));var a=[];e.parts.forEach(function(e){a.push(this._attachmentBuilder.build(e))}.bind(this)),this.pairThumbnailsAndAttachments(a).forEach(function(t){var e=i.parts.filter(function(e){return e.disposition===t.disposition})[0];e&&this._attachmentBuilder.update(e,t)}.bind(this)),0<i._attachments.length&&i._attachments.splice(0,i._attachments.length)},isMessageCoalesced:function(e,t){if(null===e||e===T)return!1;if(null===t||t===T)return!1;if(e.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_ERROR)return!1;if(t.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_ERROR)return!1;if(e.getFromParticipant()!==T&&e.getFromParticipant().getAddress()!==t.getFromParticipant().getAddress())return!1;if(e.hasAttachment())return!1;if(e.getType()===n.Services.Messaging.MessageType.JOINED||e.getType()===n.Services.Messaging.MessageType.LEFT||e.getType()===n.Services.Messaging.MessageType.CLOSED||e.getType()===n.Services.Messaging.MessageType.START)return!1;if(t.getType()===n.Services.Messaging.MessageType.JOINED||t.getType()===n.Services.Messaging.MessageType.LEFT||t.getType()===n.Services.Messaging.MessageType.CLOSED||t.getType()===n.Services.Messaging.MessageType.START)return!1;if(e.getSensitivity()!==t.getSensitivity())return!1;if(t.hasAttachment())return!1;if(e.getReceivedDate()<t.getReceivedDate())return!1;t=e.getReceivedDate()-t.getReceivedDate();return!(isNaN(t)||6e4<t)},pairThumbnailsAndAttachments:function(e){for(var t,i={},a=[],r=0;r<e.length;r++)i[e[r].getName()]=e.filter(function(t){return function(e){return e.getName()===t}}(e[r].getName()));for(t in i)if(i.hasOwnProperty(t))if(2===i[t].length){var s=i[t][0]._isThumbnail()?i[t][0]:i[t][1],n=i[t][0]._isThumbnail()?i[t][1]:i[t][0];n.thumbnail=s,a.push(n)}else for(r=0;r<i[t].length;r++)a.push(i[t][r]);return a}},n.Services.Messaging.MessageBuilder=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a){this._provider=e,this._attachmentBuilder=i,this._messageBuilder=t,this._messagesToRead=[],this._promises=[],this._messagingAnalyticsService=a}e.prototype={_prepareMessage:function(e){var t={body:e.getBody(),subject:e.subject,threadId:e.threadId,flags:{sensitivity:e.getSensitivity(),importance:e.getImportance()},to:[]};n.Base.Utils.isUndefined(e.inReplyTo)||(t.inReplyTo=e.inReplyTo);for(var i=e.conversation.getParticipants(),a=0;a<i.length;a++)t.to.push({address:i[a].getAddress(),type:i[a].type});return t},send:function(i){var e=S.Deferred();if(i.subject.length>this._provider.getMaxSubjectLength())return e.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_SUBJECT_LENGTH_EXCEEDED)),e.promise();if(i.getBody().length>this._provider.getMaxTextLength())return e.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_BODY_LENGTH_EXCEEDED)),e.promise();var a=this._messagingAnalyticsService.startTimingMetric();i.conversation.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(i.subject=i.conversation.getSubject());function t(e){this._messagingAnalyticsService.trackTimeRequestsSendMessageEnd(a),this._messageBuilder.update(i,e),i.lastModifiedDate=new Date,i._setStatus(n.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllMessageCapabilities(i);var t=i.getAttachments().length;return 0<t&&i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.PUBLISHED),this._messagingAnalyticsService.trackMessageAttachmentSize(e.size,e.mimeType)}.bind(this)),e=i.getBody().length,this._messagingAnalyticsService.trackNumMessagesSent(e,t),i}function r(e){return this._messagingAnalyticsService.trackErrorsResponseSendMessage(n.Services.Analytics.AnalyticsErrorCode.MESSAGE_SENDING_ERROR),i._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_ERROR),this._recalculateAllMessageCapabilities(i),0<i.getAttachments().length&&i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_ERROR)}.bind(this)),S.Deferred().reject(e).promise()}var s=this._prepareMessage(i),e=0<i.getAttachments().length?(i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_SENDING)}.bind(this)),this._provider.sendMessageWithAttachments(s,i.getAttachments()).then(t.bind(this),r.bind(this))):this._provider.sendMessage(s).then(t.bind(this),r.bind(this));return i._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_SENDING),e},getPartById:function(e,t){return e.filter(function(e){return e.id===t})[0]},markAsRead:function(e){var t=S.Deferred();return 0===this._messagesToRead.length&&setTimeout(function(){var t=[];this._messagesToRead.forEach(function(e){t.push(e.id)}),this._provider.markAsReadBatch(t).then(function(t){this._messagesToRead.forEach(function(e){e._recalculateMarkAsReadCapability()}),this._promises.forEach(function(e){e.resolve(t)}),this._messagesToRead=[],this._promises=[]}.bind(this),function(t){this._messagesToRead.forEach(function(e){e._recalculateMarkAsReadCapability()}),this._promises.forEach(function(e){e.reject(t)}),this._messagesToRead=[],this._promises=[]}.bind(this))}.bind(this),2e3),this._messagesToRead.push(e),this._promises.push(t),t.promise()},removeDraftAttachment:function(e,t){var i=e.parts.indexOf(t);-1!==i&&(e.parts.splice(i,1),e.parts.onDataSetChanged([t],n.Base.DataSetChangeTypes.REMOVED)),-1!==(i=e._attachments.indexOf(t))&&e._attachments.splice(e._attachments.indexOf(t),1)},removeAllDraftAttachments:function(i){var a=[];i._attachments.forEach(function(e){var t=i.parts.indexOf(e);-1!==t&&(i.parts.splice(t,1),a.push(e))}.bind(i)),0<a.length&&i.parts.onDataSetChanged(a,n.Base.DataSetChangeTypes.REMOVED),i._attachments.splice(0,i._attachments.length)},createAttachment:function(e,t){if(this._validateAttachmentSize(t)){var i={disposition:'attachment; filename="'+t.name+'"',mimeType:""!==t.type?t.type:"application/octet-stream",size:t.size,status:n.Services.Messaging.ResourceStatus.DRAFT_UNSENT},a=this._attachmentBuilder.build(i,t);return e._attachments.push(a),e.parts.push(a),e.parts.onDataSetChanged([a],n.Base.DataSetChangeTypes.ADDED),a.addOnStatusChangedCallback(function(){this._recalculateAllAttachmentCapabilities(a)}.bind(this)),a}throw new Error("Size not valid.")},stop:function(){this._messagesToRead=[],this._promises=[]},setBodyAndReportTyping:function(e,t,i){var a=S.Deferred();return e.getUpdateBodyCapability().isAllowed?(e.body=i,e._onBodyChangedCallbacks.fire(e,i),t.getStatus()===n.Services.Messaging.ResourceStatus.PUBLISHED&&t.getIsTypingCapability().isAllowed&&t._conversationService.reportTyping(e,!0),a.resolve(this._provider.getMaxTextLength()-e.body.length)):a.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_INVALID_STATE)),a.promise()},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllMessageCapabilities:function(e){e._recalculateUpdateBodyCapability(),e._recalculateUpdateSensitivityCapability(),e._recalculateUpdateInReplyToCapability(),e._recalculateUpdateDoNotForwardCapability(),e._recalculateUpdateImportanceCapability(),e._recalculateCreateAttachmentCapability(),e._recalculateSendCapability(),e._recalculateMarkAsReadCapability(),e._recalculateRemoveCapability()},_recalculateAllAttachmentCapabilities:function(e){e._recalculateUpdateNameCapability(),e._recalculateUpdateMimeTypeCapability(),e._recalculateUpdateDurationCapability(),e._recalculateUpdateIsSelfGeneratedCapability(),e._recalculateCreateThumbnailCapability(),e._recalculateRemoveThumbnailCapability(),e._recalculateRemoveCapability()},_validateAttachmentSize:function(e){return!e.type||!(-1!==e.type.indexOf("image")&&this._provider.getMaxImageSize()&&e.size>this._provider.getMaxImageSize()||-1!==e.type.indexOf("video")&&this._provider.getMaxVideoSize()&&e.size>this._provider.getMaxVideoSize()||-1!==e.type.indexOf("audio")&&this._provider.getMaxAudioSize()&&e.size>this._provider.getMaxAudioSize())&&!(-1===e.type.indexOf("image")&&-1===e.type.indexOf("video")&&-1===e.type.indexOf("audio")&&this._provider.getMaxGenericAttachmentSize()&&e.size>this._provider.getMaxGenericAttachmentSize())}},n.Services.Messaging.MessageService=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i){this._contactsIntegrationService=i;i=new o.Services.Messaging.ThumbnailCreator,e=t.getMessagingProviders(e)[0];this._messagingService=this._createMessagingService(e,i)}e.prototype={create:function(){var e=new o.Services.Messaging.Messaging(this._messagingService);return this._messagingService._recalculateAllMessagingCapabilities(e),e},_createMessagingService:function(e,t){var i=new o.Services.Messaging.ParticipantService,a=new o.Services.Messaging.AttachmentBuilder(t);t.registerCreator("image/*",new o.Services.Messaging.ImageThumbnailCreator(a)),t.registerCreator("video/*",new o.Services.Messaging.VideoThumbnailCreator(a));var r=new o.Services.Messaging.MessageBuilder(a,i),s=new o.Services.Analytics.MessagingAnalyticsService,n=new o.Services.Messaging.MessageService(e,r,a,s),t=new o.Services.Messaging.EscalationService(e),a=new o.Services.Messaging.ConversationBuilder(r),r=new o.Services.Messaging.ConversationService(e,n,i,t,r,a,s),s=new o.Services.Messaging.MessagingService(e,r,n,i,a,this._contactsIntegrationService,s);return r._messagingService=s}},o.Services.Messaging.MessagingFactory=e}(AvayaClientServices),function(d){"use strict";function e(e,t,i,a,r,s,n){this._hasStarted=!1,this._conversationsSubscribed=!1,this._provider=e,this._messageService=i,this._conversationService=t,this.conversations=new d.Base.DataSet,this._draftConversations=[],this._identity={},this._participantsService=a,this._conversationBuilder=r,this._updateByIdDataSetFnc=T,this._contactsIntegrationService=s,this._onContactListChanged=T,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=T,this._unreadConversationsCounter=T,this._messagingAnalyticsService=n}e.prototype={getActiveConversations:function(t){var i=new d.Base.DataRetrieval(this.conversations),a=this._messagingAnalyticsService.startTimingMetric(),e=function(e){this._messagingAnalyticsService.trackTimeRequestsGetConversationsEnd(a),this._updateConversationsContainer(e,this.conversations,t),0===this.conversations.length&&this.conversations.onDataSetChanged(this.conversations,d.Base.DataSetChangeTypes.ADDED),this._subscribeForConversationsUpdates(t),i.isCompleted=!0,i._dataRetrievalProgress.fire(this.conversations.length,!1),i._dataRetrievalDone.fire()}.bind(this),r=function(e){this._messagingAnalyticsService.trackErrorsResponseGetConversations(d.Services.Analytics.AnalyticsErrorCode.GETTING_CONVERSATIONS_ERROR),i._dataRetrievalFailed.fire(e)}.bind(this),s={cancel:function(){}},n=this._provider.getConversations(s);return i._onCancel=function(){s.cancel()},n.then(e,r,function(e){i._dataRetrievalProgress.fire(e,!1)}),i},getDraftConversations:function(){return this._draftConversations},leaveAllConversations:function(){return this.leaveConversations(this.conversations)},leaveConversations:function(e){for(var t=this._messagingAnalyticsService.startTimingMetric(),i=[],a=S.Deferred(),r=e.length,s=0;s<r;s++)i.push(e[s].leave());return S.when.apply(this,i).then(function(){this._messagingAnalyticsService.trackTimeRequestsLeaveConversationsEnd(t),a.resolve(!0)}.bind(this),function(){var e=d.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED;this._messagingAnalyticsService.trackErrorsResponseLeaveConversations(e),a.reject(new d.Services.Messaging.MessagingError(e))}.bind(this)),a.promise()},createConversation:function(e){var t=this._conversationBuilder.build({resourceStatus:d.Services.Messaging.ResourceStatus.DRAFT_UNSENT},this._conversationService);return t.participants.push(this._participantsService.getSelfParticipant()),this.conversations.push(t),this.conversations.onDataSetChanged([t],d.Base.DataSetChangeTypes.ADDED),this._draftConversations.push(t),this._provider.on(d.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(t)}.bind(this)),this._provider.on(d.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(t)}.bind(this)),t.addOnStatusChangedCallback(function(e,t){t===d.Services.Messaging.ResourceStatus.PUBLISHED&&(t=this._draftConversations.indexOf(e),this._draftConversations.splice(t,1)),this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.addOnActiveStatusChangedCallback(function(e){this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.addOnClosedStatusChangedCallback(function(e,t){var i=this.conversations.indexOf(e);-1<i&&(this.conversations.splice(i,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.REMOVED)),this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.lastUpdated=new Date,t},start:function(t,e){return d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Messaging Service is starting..."),this._serviceUnavailableAnalyticsInit(t),this._hasStarted=!0,this._provider.on(d.Base.NetworkProviderEvents.UNAUTHORIZED,function(){t._fireMessagingUnavailableCallback(d.Services.Analytics.AnalyticsErrorCode.UNAUTHORIZED)}.bind(this)),this._provider.on(d.Base.NetworkProviderEvents.AUTHORIZED,function(){t._fireMessagingAvailableCallback()}.bind(this)),this._provider.start(e.ammConfiguration,t).then(function(){return this.validateUsers([this._provider.getSelfAddress()])}.bind(this)).then(function(e){e=this._participantsService.getOrCreateParticipant(e[0]);this._identity.participant=e,this._participantsService.setSelfParticipant(e),this._recalculateAllMessagingCapabilities(t),this._onContactListChanged=function(){this.conversations.forEach(function(e){this._updateMatchedContactsForConversation(e)},this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),t.addOnMessagingServiceAvailableCallback(function(){this._recalculateAllMessagingCapabilities(t)}.bind(this)),t.addOnMessagingServiceUnavailableCallback(function(){this._recalculateAllMessagingCapabilities(t)}.bind(this))}.bind(this),function(e){return this._hasStarted=!1,this._recalculateAllMessagingCapabilities(t),S.Deferred().reject(e).promise()}.bind(this))},_serviceUnavailableAnalyticsInit:function(e){var t;e.addOnMessagingServiceUnavailableCallback(function(e){e._messagingUnavailableReason&&(t=this._messagingAnalyticsService.startTimingMetric(),this._messagingAnalyticsService.trackServiceUnavailable(e._messagingUnavailableReason))}.bind(this)),e.addOnMessagingServiceAvailableCallback(function(){this._messagingAnalyticsService.trackDurationServiceUnavailableEnd(t)}.bind(this))},stop:function(l){l._isAvailable&&(l._isAvailable=T,l._onMessagingServiceUnavailableCallbacks.fire(l));var e=function(){if(this._hasStarted)return this._provider.stop().then(function(e){this._messageService.stop(),this._participantsService.stop(),this._draftConversations=[];for(var t=this.conversations.length,i=0;i<t;i++){for(var a=this.conversations[i].messages.length,r=0;r<a;r++){for(var s=this.conversations[i].messages[r].parts.length,n=0;n<s;n++)delete this.conversations[i].messages[r].parts[n];delete this.conversations[i].messages[r]}for(var o=this.conversations[i]._draftEscalations.length,c=0;c<o;c++)delete this.conversations[i]._draftEscalations[c];delete this.conversations[i]}return this.conversations=new d.Base.DataSet,this._hasStarted=!1,l._onMessagingLimitsChangedCallbacks.empty(),l._onNumberOfConversationsWithUnreadContentChangedCallbacks.empty(),l._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.empty(),l._onRoutableDomainsChangedCallbacks.empty(),this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,this._unreadConversationsCounter=T,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=T,this._recalculateAllMessagingCapabilities(l),e}.bind(this));var e=S.Deferred(),t=new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED);return e.reject(t),e.promise()}.bind(this);return this.logout().then(e,e)},_stopImmediately:function(e){d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Stopping the Service"),e._isAvailable&&e._onMessagingServiceUnavailableCallbacks.fire(e);e=S.Deferred();return this._hasStarted?(d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Service stopped successfully"),e.resolve()):(d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Service failed to stop"),e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED))),e.promise()},logout:function(){return this._provider.logout()},getNumberOfConversationsWithUnreadContent:function(){return this.conversations.filter(function(e){return 0<e.getUnreadMessageCount()||0<e.getUnreadAttachmentCount()}).length},getNumberOfConversationsWithUnreadContentSinceLastAccess:function(){return this.conversations.filter(function(e){return e.hasUnreadMessagesSinceLastAccess()}).length},validateUsers:function(e){return this._conversationService.validateUsers(e)},searchConversations:function(e,t){var i=this._messagingAnalyticsService.startTimingMetric(),a=new d.Base.DataRetrieval,r=a.getDataSet(),s={cancel:function(){}},n={q:e.getQuery(),subject:e.isSearchSubject(),participants:e.isSearchParticipants(),body:e.isSearchBody()};e.getQueryAfter()&&(n.after=e.getQueryAfter().toISOString());var o=function(e){this._messagingAnalyticsService.trackTimeRequestsSearchConversationsEnd(i),this._updateConversationsContainer(e,r,t),a.isCompleted=!0,a._dataRetrievalProgress.fire(r.length,!1),a._dataRetrievalDone.fire(),this._messagingAnalyticsService.trackNumConversationSearchRequests(n.body,n.subject,n.participants)}.bind(this),c=function(e){this._messagingAnalyticsService.trackErrorsResponseSearchConversations(d.Services.Analytics.AnalyticsErrorCode.SEARCHING_CONVERSATIONS_ERROR),a._dataRetrievalFailed.fire(e)}.bind(this),l=function(e){a._dataRetrievalProgress.fire(e,!1)}.bind(this);return this._provider.getConversationsByQuery(n,null,s).then(o,c,l),a._onCancel=function(){s.cancel()},this._searchLocalConversations(this.conversations,e).forEach(function(e){r.push(e)}),setTimeout(function(){r.onDataSetChanged(r,d.Base.DataSetChangeTypes.ADDED),l(r,!1)},0),a},_createNewConversation:function(e,t){var i=this._conversationBuilder.build(e,this._conversationService);return this._provider.on(d.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(i)}.bind(this)),this._provider.on(d.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(i)}.bind(this)),this._conversationBuilder.update(i,e,this._conversationService),i.addOnClosedStatusChangedCallback(function(e,t){var i=this.conversations.indexOf(e);-1<i&&(this.conversations.splice(i,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.ADDED))}.bind(this)),i},_getById:function(e,t){return e.filter(function(e){return e.id===t})[0]},_updateConversationsContainer:function(e,t,i){if(e&&e.conversations&&0<e.conversations.length){for(var a=[],r=[],s=0;s<e.conversations.length;s++){var n=e.conversations[s],o=this._getById(t,n.id);o?(this._conversationBuilder.update(o,n,this._conversationService),a.push(o),this._updateMatchedContactsForConversation(o)):n.flags.active&&((o=this._createNewConversation(n,i)).participants=this._conversationService.getParticipantsFromMessage(n.messages[0]),t.unshift(o),r.push(o),this._updateMatchedContactsForConversation(o))}0<r.length&&t.onDataSetChanged(r,d.Base.DataSetChangeTypes.ADDED),0<a.length&&t.onDataSetChanged(a,d.Base.DataSetChangeTypes.UPDATED),this._updateNumberOfConversationsWithUnreadContent(i),this._updateNumberOfConversationsWithUnreadContentSinceLastAccessTime(i)}},_searchLocalConversations:function(e,s){var n=[];return e.forEach(function(e){var t=!1;s.isSearchSubject()&&-1!==e.getSubject().toLowerCase().indexOf(s.getQuery())&&(t=!0),s.isSearchParticipants()&&e.getParticipants().forEach(function(e){-1===e.givenName.toLowerCase().indexOf(s.getQuery())&&-1===e.surname.toLowerCase().indexOf(s.getQuery())||(t=!0)});var i=e.getMessages();s.isSearchBody()&&(i=e.getMessages().filter(function(e){if(s.isSearchBody()&&e.body&&-1!==e.body.toLowerCase().indexOf(s.getQuery()))return t=!0}));var a,r=s.getQueryAfter();(t=r&&t?e.getLastUpdatedTime()>=r:t)&&((a=S.extend(new d.Services.Messaging.Conversation,e)).messages=new d.Base.DataSet,i.forEach(function(e){a.messages.push(S.extend(new d.Services.Messaging.Message(this._messageService,a),e))}.bind(this)),this._conversationBuilder._updatePreviewText(a),n.push(a))}.bind(this)),n},_subscribeForConversationsUpdates:function(t){this._conversationsSubscribed||this._provider.observeConversations().then(function(){this._provider.on(d.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,function(e){this._updateConversationsContainer(e,this.conversations,t)}.bind(this)),this._conversationsSubscribed=!0}.bind(this))},_updateConversationsByIdDataSet:function(e,i,t){var a={conversations:[]};e.forEach(function(t){var e=i.filter(function(e){return e.id===t.id})[0];e&&a.conversations.push(e)}.bind(this)),0<a.conversations.length&&this._updateConversationsContainer(a,e,t)},removeConversation:function(e){var t,i=S.Deferred();return e.getRemoveCapability().isAllowed?(0<=(t=this.conversations.indexOf(e))&&(this.conversations.splice(t,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.REMOVED)),0<=(t=this._draftConversations.indexOf(e))&&this._draftConversations.splice(t,1),i.resolve()):i.reject(new d.Base.BaseError(e.getRemoveCapability().denialReason)),i.promise()},removeAllDraftConversations:function(){for(var e=this._draftConversations.length-1;0<=e;e--)this.removeConversation(this._draftConversations[e])},serviceIsAvailable:function(){return!!this._provider.isAvailable()&&this._hasStarted},_recalculateAllMessagingCapabilities:function(e){e._recalculateRetrieveConversationsCapability(),e._recalculateStartServiceCapability(),e._recalculateCreateConversationCapability(),e._recalculateSearchConversationsCapability(),e._recalculateValidateParticipantAddressCapability(),e._recalculateMarkContentAsReadCapability()},getRoutableDomains:function(){return this._provider.getRoutableDomains()},getSelfAddress:function(){return this._provider.getSelfAddress()},getConversationResource:function(){return this._provider.getSelfAddress()},getValidateAddressResource:function(){return this._provider.getValidateAddressResource()},getMarkAsReadResource:function(){return this._provider.getMarkAsReadResource()},_updateMatchedContactsForConversation:function(e){this._contactsIntegrationService.isStarted()&&e.getParticipants().forEach(function(e){this._updateMatchedContactsForParticipant(e)},this)},_updateMatchedContactsForParticipant:function(e){this._contactsIntegrationService.updateMatchedContactsForParticipant(e)},_updateNumberOfConversationsWithUnreadContent:function(e){var t=this.getNumberOfConversationsWithUnreadContent(),i=d.Base.Utils.isDefined(this._unreadConversationsCounter);this._unreadConversationsCounter!==t&&(this._unreadConversationsCounter=t,i&&e._onNumberOfConversationsWithUnreadContentChangedCallbacks.fire(e,t))},_updateNumberOfConversationsWithUnreadContentSinceLastAccessTime:function(e){var t=this.getNumberOfConversationsWithUnreadContentSinceLastAccess(),i=d.Base.Utils.isDefined(this._numberOfConversationsWithUnreadContentSinceLastAccessTime);this._numberOfConversationsWithUnreadContentSinceLastAccessTime!==t&&(this._numberOfConversationsWithUnreadContentSinceLastAccessTime=t,i&&e._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.fire(e,t))}},d.Services.Messaging.MessagingService=e}(AvayaClientServices),function(a){"use strict";function e(){this._participants=[],this._selfParticipant=T}e.prototype={getOrCreateParticipant:function(e){var t=e._address||e.address||e.from._address||e.from.address,i=this._getParticipant(t);return i||(t=!!this._selfParticipant&&this._selfParticipant.getAddress()===t,i=new a.Services.Messaging.Participant(e,t),this._participants.push(i)),i},_getParticipant:function(t){return this._participants.filter(function(e){return e.getAddress()===t})[0]},setSelfParticipant:function(e){this._selfParticipant=e,this._selfParticipant.self=!0},getSelfParticipant:function(){return this._selfParticipant},stop:function(){this._selfParticipant=T,this._participants=[]}},a.Services.Messaging.ParticipantService=e}(AvayaClientServices),function(e){"use strict";function t(e){this._config=e||{width:128},this._creators={}}t.prototype={getConfig:function(){return this._config},setConfig:function(e){this._config=e},registerCreator:function(e,t){this._creators[e]=t},unregisterCreator:function(e){this._creators[e]=T},create:function(e,t){if(t=t||this._config,e.getCreateThumbnailCapability().isAllowed){var i=this._creators[e.getMimeType()]?e.getMimeType():e.getMimeType().slice(0,e.getMimeType().indexOf("/")+1)+"*";return this._creators[i].create(e,t)}}},e.Services.Messaging.ThumbnailCreator=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Messaging.AbstractThumbnailCreator.call(this,e)}(e.prototype=Object.create(t.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(i,a){var r=S.Deferred(),s={disposition:i.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:i.status},e=new FileReader;return e.onloadend=function(){this._getFirstFrameFromVideo(e.result,function(e){var t=new Image;t.src=e;t=new Blob([this._resizeImage(t,a)],{type:"image/jpeg"});s.size=t.size,i.thumbnail=this._attachmentBuilder.build(s,t),r.resolve(i.thumbnail)}.bind(this))}.bind(this),e.readAsDataURL(i.file),r.promise()},e.prototype._getFirstFrameFromVideo=function(e,t){var i,a,r=document.createElement("canvas"),s=document.createElement("video"),n=document.createElement("source");n.src=e,n.type="video/mp4",s.appendChild(n),S(s).on("loadedmetadata",function(){r.height=a=s.videoHeight,r.width=i=s.videoWidth}),S(s).on("loadeddata",function(){r.getContext("2d").drawImage(s,0,0,i,a),t(r.toDataURL("image/jpeg"))}),S(s).on("error",function(){throw new Error}),s.load()},t.Services.Messaging.VideoThumbnailCreator=e}(AvayaClientServices),function(e){"use strict";function t(){this._address="",this._participantId=T,this._displayName="",this._localUser=!1,this._joinTime=Date.now(),this._matchedContacts=new e.Services.Contacts.MatchedContactsWithMatchLevel,this._onParticipantMatchedContactsChangedCallbacks=S.Callbacks()}t.prototype={getAddress:function(){return this._address},setAddress:function(e){this._address=e},getDisplayName:function(){return this._displayName},setDisplayName:function(e){this._displayName=e},getParticipantId:function(){return this._participantId},isLocalUser:function(){return this._localUser},getBestContactMatch:function(){if(this._matchedContacts&&!this._matchedContacts.empty)return 0<this._matchedContacts._exactType1Contacts.length?this._matchedContacts._exactType1Contacts[0]:0<this._matchedContacts._exactType2Contacts.length?this._matchedContacts._exactType2Contacts[0]:0<this._matchedContacts._partialType1Contacts.length?this._matchedContacts._partialType1Contacts[0]:void 0},getAllPossibleContactMatches:function(){return this._matchedContacts},setMatchedContacts:function(e){(e&&!e._equals(this._matchedContacts)||!e&&this._matchedContacts)&&(this._matchedContacts=e,this._onParticipantMatchedContactsChangedCallbacks.fire(this))}},e.Services.Participant=t}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Participant.prototype,{addOnParticipantMatchedContactsChangedCallback:function(e){this._onParticipantMatchedContactsChangedCallbacks.add(e)},removeOnParticipantMatchedContactsChangedCallback:function(e){this._onParticipantMatchedContactsChangedCallbacks.remove(e)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Presence.PresenceErrorReason={UNKNOWN:"UNKNOWN",UNSUPPORTED:"UNSUPPORTED",CANCELED:"CANCELED",INVALID_REQUEST:"INVALID_REQUEST",INVALID_STATE:"INVALID_STATE",INTERNAL_ERROR:"INTERNAL_ERROR",SEND_ERROR:"SEND_ERROR",TIMEOUT:"TIMEOUT",RETRY_LIMIT_EXCEEDED:"RETRY_LIMIT_EXCEEDED",INVALID_RESPONSE:"INVALID_RESPONSE",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",SERVER_ERROR:"SERVER_ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Presence.PresenceLocationMode={PRESENCE_LOCATION_MODE_UNSPECIFIED:"PRESENCE_LOCATION_MODE_UNSPECIFIED",PRESENCE_LOCATION_MODE_OFFICE:"PRESENCE_LOCATION_MODE_OFFICE",PRESENCE_LOCATION_MODE_HOME:"PRESENCE_LOCATION_MODE_HOME",PRESENCE_LOCATION_MODE_MOBILE:"PRESENCE_LOCATION_MODE_MOBILE",PRESENCE_LOCATION_MODE_TRAVELING:"PRESENCE_LOCATION_MODE_TRAVELING"}}(),function(e){"use strict";var t={PRESENCE_STATE_UNKNOWN:"PRESENCE_STATE_UNKNOWN",PRESENCE_STATE_UNSPECIFIED:"PRESENCE_STATE_UNSPECIFIED",PRESENCE_STATE_AVAILABLE:"PRESENCE_STATE_AVAILABLE",PRESENCE_STATE_ON_A_CALL:"PRESENCE_STATE_ON_A_CALL",PRESENCE_STATE_BUSY:"PRESENCE_STATE_BUSY",PRESENCE_STATE_AWAY:"PRESENCE_STATE_AWAY",PRESENCE_STATE_DO_NOT_DISTURB:"PRESENCE_STATE_DO_NOT_DISTURB",PRESENCE_STATE_OUT_OF_OFFICE:"PRESENCE_STATE_OUT_OF_OFFICE",PRESENCE_STATE_OFFLINE:"PRESENCE_STATE_OFFLINE"},i={PRESENCE_STATE_UNKNOWN:(e.Services.Presence.PresenceState=t).PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_BUSY:t.PRESENCE_STATE_BUSY,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:t.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE};e.Services.Presence.ManualPresenceState=i;i={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:t.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:t.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE};e.Services.Presence.PhonePresenceState=i;i={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:t.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE};e.Services.Presence.VideoPresenceState=i;i={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE};e.Services.Presence.IMPresenceState=i;t={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE};e.Services.Presence.CalendarPresenceState=t}(AvayaClientServices),function(e){"use strict";function t(e){this._presentity=e,this._locationMode=T,this._note=T,this._calendarStartTime=T,this._calendarEndTime=T,this._calendarState=T,this._manualState=T,this._overallState=T,this._enterpriseIMState=T,this._phoneState=T,this._videoState=T,this._enterpriseIMContact=T,this._phoneContact=T,this._videoContact=T}t.prototype={getPresentity:function(){return this._presentity},getOverallState:function(){return this._overallState},_setOverallState:function(e){this._overallState=e},getManualState:function(){return this._manualState},_setManualState:function(e){this._manualState=e},getPhoneState:function(){return this._phoneState},_setPhoneState:function(e){this._phoneState=e},getPhoneContact:function(){return this._phoneContact},_setPhoneContact:function(e){this._phoneContact=e},getVideoState:function(){return this._videoState},_setVideoState:function(e){this._videoState=e},getVideoContact:function(){return this._videoContact},_setVideoContact:function(e){this._videoContact=e},getEnterpriseIMState:function(){return this._enterpriseIMState},_setEnterpriseIMState:function(e){this._enterpriseIMState=e},getEnterpriseIMContact:function(){return this._enterpriseIMContact},_setEnterpriseIMContact:function(e){this._enterpriseIMContact=e},getCalendarState:function(){return this._calendarState},_setCalendarState:function(e){this._calendarState=e},getCalendarStartTime:function(){return this._calendarStartTime},_setCalendarStartTime:function(e){this._calendarStartTime=e},getCalendarEndTime:function(){return this._calendarEndTime},_setCalendarEndTime:function(e){this._calendarEndTime=e},getLocationMode:function(){return this._locationMode},_setLocationMode:function(e){this._locationMode=e},getNote:function(){return this._note},_setNote:function(e){this._note=e}},e.Services.Presence.Presence=t}(AvayaClientServices),function(e){"use strict";function t(e){Error.call(this),this._reason=e}(t.prototype=Object.create(Error.prototype)).getReason=function(){return this._reason},e.Services.Presence.PresenceError=t}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Services.Presence.Presence.prototype)).setPhoneState=function(e){var t,i=!1;for(t in a.Services.Presence.PhonePresenceState)if(a.Services.Presence.PhonePresenceState.hasOwnProperty(t)&&e===a.Services.Presence.PhonePresenceState[t]){this._setPhoneState(e),i=!0;break}return i},e.prototype.setVideoState=function(e){var t,i=!1;for(t in a.Services.Presence.VideoPresenceState)if(a.Services.Presence.VideoPresenceState.hasOwnProperty(t)&&e===a.Services.Presence.VideoPresenceState[t]){this._setVideoState(e),i=!0;break}return i},e.prototype.setEnterpriseIMState=function(e){var t,i=!1;for(t in a.Services.Presence.IMPresenceState)if(a.Services.Presence.IMPresenceState.hasOwnProperty(t)&&e===a.Services.Presence.IMPresenceState[t]){this._setEnterpriseIMState(e),i=!0;break}return i},a.Services.Presence.SelfPresence=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getCallLogId:function(){},getParticipantList:function(){},getStartTime:function(){},getCallDuration:function(){},isCallerIdPrivate:function(){},getSubject:function(){},getRemoteAddress:function(){},getLocalAddress:function(){},getCallType:function(){},getWebConferenceAddress:function(){},getChannelTypeList:function(){},isBridged:function(){},isIncoming:function(){},isMissed:function(){},isDeclined:function(){},isFailed:function(){},isRead:function(){},getCorrelatedCallLogIdList:function(){}},e.Services.SessionLogs.CallLogItem=t}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getUnreadCount:function(){}},e.Services.SessionLogs.CallLogsDataSet=t}(AvayaClientServices),function(e){"use strict";e.Services.SessionLogs.create=function(){return new e.Services.SessionLogs.SessionLogs}}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getCurrentCallLogItemList:function(){},markAsRead:function(e,t){},deleteCallLogItemList:function(e,t){}},e.Services.SessionLogs.SessionLogs=t}(AvayaClientServices),function(i){"use strict";function e(){this._vmProvider=T,this._available=T,this._starting=!1,this._started=!1,this._vmNumber=T,this._vmStatus=new i.Services.VoiceMessaging.VoiceMessagingStatusParameters(!1),this._onVoicemailNumberChange=T,this._onMWIStatusChange=T,this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._onVoicemailNumberChangedCallbacks=S.Callbacks(),this._onVoiceMessagingStatusChangedCallbacks=S.Callbacks(),this._onVoiceMessagingServiceAvailableCallbacks=S.Callbacks(),this._onVoiceMessagingServiceUnavailableCallbacks=S.Callbacks(),this._serviceAvailableCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)}e.prototype={getVoicemailNumber:function(){return this._vmNumber},getVoiceMessagingStatus:function(){return this._vmStatus},start:function(e,t){return t&&(this._vmProvider=t),e.sgConfiguration.credentialProvider.isGuest?(i.Base.Logger.warn(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Cannot start service for guest"),S.Deferred().reject(new i.Services.Call.CallException(i.Services.Call.CallError.USER_NOT_FOUND)).promise()):(this.startDfd=S.Deferred(),i.Base.Utils.isWebRTC_SupportedBrowser(e.sgConfiguration._disableWebRTCForTheseBrowsers)?(i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Starting the service"),this._subscribeForProvidersNotifications(),this._starting=!0,this._vmProvider.start(T,e.sgConfiguration).fail(function(e){this._starting=!1,this._available=!1,i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service",e),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.reject(e)}.bind(this)),i.Base.Utils.isDefined(this._vmProvider.isServiceAvailable)&&this._vmProvider.isServiceAvailable()&&this._onServiceAvailable(),this.startDfd.promise()):(this._available=!1,this._started=!0,this._onVoiceMessagingServiceUnavailableCallbacks.fire(this),this._serviceAvailableCapability._updateIfChanged(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),S.Deferred().reject(new i.Services.Call.CallException(i.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)).promise()))},stop:function(){i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._unsubscribeFromProvidersNotifications(),this._onServiceUnavailable();var t=function(){this._started=!1,this._onVoicemailNumberChangedCallbacks.empty(),this._onVoiceMessagingStatusChangedCallbacks.empty(),this._onVoiceMessagingServiceAvailableCallbacks.empty(),this._onVoiceMessagingServiceUnavailableCallbacks.empty()}.bind(this);return this._vmProvider.stop().then(function(){t(),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully")}.bind(this),function(e){return t(),i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to stop service",e),S.Deferred().reject(e).promise()}.bind(this))},_stopImmediately:function(){return i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._started=!1,this._onServiceUnavailable(),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully"),S.Deferred().resolve().promise()},_onServiceAvailable:function(){var e;this._available||(this._started||(this._starting=!1,this._started=!0,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service started successfully"),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.resolve()),this._serviceAvailableCapability._updateIfChanged(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._available=!0,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is available"),this._onVoiceMessagingServiceAvailableCallbacks.fire(this),e=this._vmProvider.getVoicemailMWI(),this._vmStatus.isMessageWaiting()!==e&&(this._vmStatus._setMessageWaiting(e),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New MWI is "+e)),e=this._vmProvider.getVoicemailNumber(),this._vmNumber!==e&&(this._vmNumber=e,this._onVoicemailNumberChangedCallbacks.fire(e),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New voicemail number is "+e)))},_onServiceUnavailable:function(){(this._available||this._starting)&&(this._starting&&(this._starting=!1,i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service"),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.reject()),this._serviceAvailableCapability._updateIfChanged(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._available=!1,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is unavailable"),this._onVoiceMessagingServiceUnavailableCallbacks.fire(this))},_subscribeForProvidersNotifications:function(){this._started||this._starting||(this._onVoicemailNumberChange=function(e){this._vmNumber!==e&&(this._vmNumber=e,this._onVoicemailNumberChangedCallbacks.fire(e))}.bind(this),this._onMWIStatusChange=function(e){this._vmStatus.isMessageWaiting()!==e&&(this._vmStatus._setMessageWaiting(e),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus))}.bind(this),this._onNetworkAvailable=this._onServiceAvailable.bind(this),this._onNetworkUnavailable=this._onServiceUnavailable.bind(this),this._vmProvider.on(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.on(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.on(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.on(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._onNetworkUnavailable))},_unsubscribeFromProvidersNotifications:function(){this._started&&(this._vmProvider.off(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.off(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.off(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.off(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._onVoicemailNumberChange=T,this._onMWIStatusChange=T)}},i.Services.VoiceMessaging.VoiceMessaging=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.VoiceMessaging.VoiceMessaging.prototype,{addOnVoiceMessagingServiceUnavailableCallback:function(e){this._onVoiceMessagingServiceUnavailableCallbacks.add(e)},removeOnVoiceMessagingServiceUnavailableCallback:function(e){this._onVoiceMessagingServiceUnavailableCallbacks.remove(e)},addOnVoiceMessagingServiceAvailableCallback:function(e){this._onVoiceMessagingServiceAvailableCallbacks.add(e)},removeOnVoiceMessagingServiceAvailableCallback:function(e){this._onVoiceMessagingServiceAvailableCallbacks.remove(e)},addOnVoicemailNumberChangedCallback:function(e){this._onVoicemailNumberChangedCallbacks.add(e)},removeOnVoicemailNumberChangedCallback:function(e){this._onVoicemailNumberChangedCallbacks.remove(e)},addOnVoiceMessagingStatusChangedCallback:function(e){this._onVoiceMessagingStatusChangedCallbacks.add(e)},removeVoiceMessagingStatusChangedCallback:function(e){this._onVoiceMessagingStatusChangedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.VoiceMessaging.VoiceMessaging.prototype,{getSubscribeForVoicemailNumberChangesCapability:function(){return this._serviceAvailableCapability},getSubscribeForVoiceMessagingStatusChangesCapability:function(){return this._serviceAvailableCapability}})}(AvayaClientServices),function(e){"use strict";function t(e){this._messageWaiting=e}t.prototype={isMessageWaiting:function(){return this._messageWaiting},_setMessageWaiting:function(e){this._messageWaiting=e}},e.Services.VoiceMessaging.VoiceMessagingStatusParameters=t}(AvayaClientServices),function(l){"use strict";var d={createLogAPICallAdvice:function(r){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.BEFORE,function(e,t,i,a){l.Base.Logger.info(r,"API called: "+t+"."+i)})},createWrapCaughtErrorInPromiseAdvice:function(o,c){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.AROUND,function(e,t,i,a,r,s){try{var n=r.apply(a,s);return n&&"function"==typeof n.fail&&n.fail(function(e){d._isSupportedExceptionClass(e)&&(l.Base.Logger.warn(o,"Caught error inside promise handler",e),l.Base.AOPTools.triggerExceptionCallback(e))}),n}catch(e){return l.Base.Logger.warn(o,"Caught error in execution of function returning promise",e),l.Base.AOPTools.triggerExceptionCallback(e),S.Deferred().reject(c).promise()}})},_isSupportedExceptionClass:function(e){return e instanceof Error||e instanceof l.Base.BaseError||e instanceof l.Services.Conference.ConferenceException||e instanceof l.Services.Collaboration.CollaborationError||e instanceof l.Services.Call.CallException||e instanceof l.Services.Contacts.ContactsError||e instanceof l.Services.Presence.PresenceError},createWrapCaughtErrorInAdvice:function(n){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.AROUND,function(e,t,i,a,r,s){try{return r.apply(a,s)}catch(e){throw l.Base.Logger.warn(n,"Caught error in execution of function",e),l.Base.AOPTools.triggerExceptionCallback(e),e}})}};d.LOG_CALL_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CALL_SERVICE),d.LOG_PRESENCE_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.PRESENCE_SERVICE),d.LOG_CONTACTS_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CONTACTS_SERVICE),d.LOG_MESSAGING_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.MESSAGING_SERVICE),d.LOG_COLLABORATION_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.COLLABORATION_SERVICE),d.LOG_CONFERENCE_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CONFERENCE_SERVICE),d.LOG_USER_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.USER_SERVICE),d.WRAP_CAUGHT_CALL_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CALL_SERVICE,new l.Services.Call.CallException(l.Services.Call.CallError.INTERNAL_ERROR)),d.WRAP_CAUGHT_CALL_EXCEPTION=d.createWrapCaughtErrorInAdvice(l.Base.LoggerTags.CALL_SERVICE,new l.Services.Call.CallException(l.Services.Call.CallError.INTERNAL_ERROR)),d.WRAP_CAUGHT_PRESENCE_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.PRESENCE_SERVICE,new l.Services.Presence.PresenceError(l.Services.Presence.PresenceErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_CONTACTS_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CONTACTS_SERVICE,new l.Services.Contacts.ContactsError(l.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_MESSAGING_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.MESSAGING_SERVICE,new l.Services.Messaging.MessagingError(l.Services.Messaging.MessagingErrorReason.MESSAGING_INTERNAL_ERROR)),d.WRAP_CAUGHT_COLLABORATION_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.COLLABORATION_SERVICE,new l.Services.Collaboration.CollaborationError(l.Services.Collaboration.CollaborationErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_CONFERENCE_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CONFERENCE_SERVICE,new l.Services.Conference.ConferenceException(l.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"An internal error occurred.")),d.WRAP_CAUGHT_USER_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.USER_SERVICE,new l.Base.BaseError(l.Base.ErrorReasons.INTERNAL_ERROR)),l.Base.AOPCommonAdvices=d}(AvayaClientServices),function(l){"use strict";function e(e){l.Base.Observable.call(this),this._elements={},this._appliedElementIds=[],this._elementsIds=[],this._elementAdditionDates=[],this._options=e||new l.Base.CacheOptions,this.auditIntervald=T,this._startAudit()}(e.prototype=Object.create(l.Base.Observable.prototype)).getElement=function(e){return e=this._cutIdFromUrl(e),this._elements[e]},e.prototype.getAllElements=function(){var e,t=[];for(e in this._elements)this._elements.hasOwnProperty(e)&&t.push(this._elements[e]);return l.Base.Utils.removeDuplicatesFromArray(t)},e.prototype.addElement=function(e,t){return!!this._addElement(e,t)&&(this.trigger(l.Base.ElementCacheEvents.ELEMENT_ADDED,[[t]]),!0)},e.prototype.addElements=function(e){var t=this._makeRoomForNewElements(e);if(t.length)for(var i=0;i<t.length;i++)this.addElement(t[i].elementId,t[i].element)||l.Base.Logger.error(l.Base.LoggerTags.CACHE,"The element was not added",t[i]);return t},e.prototype.updateElement=function(e,t){if(e&&t){e=this._cutIdFromUrl(e);var i=this.getElement(e);if(i&&!this._areElementsEqual(i,t)){i=this._getIndexOfElementId(e);return-1<i&&(this._elements[e]=t,this._elementAdditionDates.splice(i,1),this._elementsIds.splice(i,1),this._elementAdditionDates.push(new Date),this._elementsIds.push(e)),this.trigger(l.Base.ElementCacheEvents.ELEMENT_UPDATED,[t]),!0}}return!1},e.prototype.deleteElement=function(e){e=this._deleteElement(e);return!!e&&(this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[[e]]),!0)},e.prototype.empty=function(){var e,t,i=[];for(e in this._elements)!this._elements.hasOwnProperty(e)||(t=this._deleteElement(e))&&i.push(t);this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[i])},e.prototype.applyElements=function(e,t){for(var i,a,r,s=e.length,n=[],o=[],c=0;c<s;c++)i=e[c].elementId,a=e[c].element,i&&a&&(this._addElement(i,a)?(this._appliedElementIds.push(i),n.push(a)):this.updateElement(i,a)||this.getElement(i)?this._appliedElementIds.push(i):l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Failed to add or update cache element",a));if(0<n.length&&this.trigger(l.Base.ElementCacheEvents.ELEMENT_ADDED,[n]),!t){for(i in this._elements)-1!==S.inArray(i,this._appliedElementIds)||(r=this._deleteElement(i))&&o.push(r);this._appliedElementIds=[]}0<o.length&&this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[o])},e.prototype.getCacheSize=function(){return this._elementsIds.length},e.prototype.getCacheMaxSize=function(){return this._options.maxElements},e.prototype._addElement=function(e,t){if(e&&t&&!this.getElement(e)){t=this._makeRoomForNewElements([{elementId:e,element:t}]);if(t.length)return this._elements[t[0].elementId]=t[0].element,this._elementsIds.push(t[0].elementId),this._elementAdditionDates.push(new Date),this._startAudit(),!0}return!1},e.prototype._deleteElement=function(e){var t=this.getElement(e);if(t){var i=this._getIndexOfElementId(e);return-1<i&&(e=this._cutIdFromUrl(e),delete this._elements[e],this._elementAdditionDates.splice(i,1),this._elementsIds.splice(i,1)),this.getCacheSize()||this._stopAudit(),t}return T},e.prototype._deleteElements=function(e){for(var t=!0,i=e.length,a=0;a<i;a++)this._deleteElement(e[a])||(t=!1,l.Base.Logger.error(l.Base.LoggerTags.CACHE,"The element was not deleted",e[a]));return t},e.prototype._areElementsEqual=function(e,t){return e===t||"function"==typeof e.equals&&e.equals(t)},e.prototype._makeRoomForNewElements=function(e){var t=this.getCacheSize(),i=this.getCacheMaxSize(),a=void 0!==i?i-t:T,r=e.length,t=void 0!==a?r-a:T,a=e.slice();return i&&i<r?(this.empty(),a=e.slice(-i),l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Some elements can not be added, because the size of adding data more then max cache size",e.slice(0,-i))):t&&0<t&&this._deleteElements(this._elementsIds.slice(0,t)),a},e.prototype._startAudit=function(){this._options.auditInterval?this.auditIntervald||(this.auditIntervald=setInterval(function(){this._audit()}.bind(this),this._options.auditInterval)):this._stopAudit()},e.prototype._audit=function(){if(this._options.timeToLive)for(var e,t=new Date,i=this._elementAdditionDates.length,a=0;a<i;a++)t-this._elementAdditionDates[a]>this._options.timeToLive&&(e=this._elementsIds[a],this._deleteElement(e))},e.prototype._stopAudit=function(){this.auditIntervald&&(clearInterval(this.auditIntervald),this.auditIntervald=T)},e.prototype._getIndexOfElementId=function(e){e=this._cutIdFromUrl(e);var t=this._elementsIds.indexOf(e);return-1===t&&l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Can not find index of element",e),t},e.prototype._cutIdFromUrl=function(e){var t;return e=e&&"string"==typeof e&&-1<e.indexOf("/")?(t=e.split("/"))[t.length-1]:e},l.Base.ElementCache=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this._rect=e,this._color=t}t.prototype={getRect:function(){return this._rect},getColor:function(){return this._color},toString:function(){return"rect:{"+this._rect+"} color:"+this._color}},e.Base.Mask=t}(AvayaClientServices),function(t){"use strict";function e(e){this._audioInputInterfaceService=e,t.Base.MediaInterface.call(this,e)}(e.prototype=Object.create(t.Base.MediaInterface.prototype)).setVolume=function(e){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: setVolume.")},e.prototype.getVolume=function(){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: getVolume.")},e.prototype._canPickDevices=function(){return!0},e.prototype.toString=function(){return"Mic"},t.Base.AudioInputInterface=e}(AvayaClientServices),function(t){"use strict";function e(){t.Base.MediaInterfaceService.call(this),this._deviceIdentifier=t.Base.MediaTypes.AUDIO_INPUT,this._audioInputVolumeController=T,this._localStreamMap={}}(e.prototype=Object.create(t.Base.MediaInterfaceService.prototype)).start=function(e){return!1===this._isStarted&&(this._audioInputVolumeController=new t.Base.AudioInputVolumeController),t.Base.MediaInterfaceService.prototype.start.call(this,e)},e.prototype.stop=function(e){return this._audioInputVolumeController&&(this._audioInputVolumeController.stop(),this._audioInputVolumeController=T),this._localStreamMap={},t.Base.MediaInterfaceService.prototype.stop.call(this,e)},e.prototype._buildDevice=function(e){return new t.Base.AudioDevice(e.deviceId,e.groupId,e.label,t.Base.MediaTypes.AUDIO_INPUT)},e.prototype.localMediaStreamCreated=function(e,t){e&&t&&0<t.getAudioTracks().length&&(this._localStreamMap[e]=t)},e.prototype.setVolume=function(e){this._audioInputVolumeController.setVolume(e)},e.prototype.getVolume=function(){return this._audioInputVolumeController.getVolume()},e.prototype.getAudioInputVolumeController=function(){return this._audioInputVolumeController},e.prototype.replaceLocalMediaStream=function(e,t){this._localStreamMap[e]=t},e.prototype.removeLocalMediaStream=function(e){delete this._localStreamMap[e]},e.prototype.getLocalMediaStream=function(e){return this._localStreamMap[e]},t.Base.AudioInputInterfaceService=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this._inputInterface=e,this._outputInterface=t,this._localStreamMap={}}(t.prototype=Object.create(e.Base.MediaInterface.prototype)).getInputInterface=function(){return this._inputInterface},t.prototype.start=function(){return S.when(this._inputInterface.start(),this._outputInterface.start())},t.prototype.stop=function(){return S.when(this._inputInterface.stop(),this._outputInterface.stop())},t.prototype.getOutputInterface=function(){return this._outputInterface},t.prototype.getLocalMediaStream=function(e){if(this._inputInterface.getMediaAccessCapability().isAllowed)return this._inputInterface._audioInputInterfaceService.getLocalMediaStream(e);throw new Error("AudioInterface.getLocalMediaStream(): Capability not allowed")},t.prototype.getRemoteMediaStream=function(e){if(this._outputInterface.getMediaAccessCapability().isAllowed)return this._outputInterface._audioOutputInterfaceService.getRemoteMediaStream(e);throw new Error("AudioInterface.getRemoteMediaStream(): Capability not allowed")},e.Base.AudioInterface=t}(AvayaClientServices),function(i){"use strict";function e(e){this._audioOutputInterfaceService=e,i.Base.MediaInterface.call(this,e),this.addOnSelectedDeviceChangedCallback(e.onSelectedDeviceChanged.bind(e))}(e.prototype=Object.create(i.Base.MediaInterface.prototype)).mute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.mute: Capability not allowed");this._audioOutputInterfaceService.mute()},e.prototype.unmute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.unmute: Capability not allowed");this._audioOutputInterfaceService.unmute()},e.prototype.isMuted=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.isMuted();throw new Error("AudioOutputInterface.isMuted(): Capability not allowed")},e.prototype.setVolume=function(e){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.setVolume(): Capability not allowed");this._audioOutputInterfaceService.setVolume(e)},e.prototype.getVolume=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.getVolume();throw new Error("AudioOutputInterface.getVolume(): Capability not allowed")},e.prototype.addOnGestureRequiredCallback=function(e){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().addOnGestureRequiredCallback(e)},e.prototype.removeOnGestureRequiredCallback=function(e){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().removeOnGestureRequiredCallback(e)},e.prototype._canPickDevices=function(){var e=i.Base.Utils.getBrowserType(),t=[i.Base.BrowserType.CHROME];return!0===i.Base.Utils.includes(e,t)&&!0===i.Base.Utils.hasProperty("audio","setSinkId")},e.prototype.toString=function(){return"Speaker"},i.Base.AudioOutputInterface=e}(AvayaClientServices),function(t){"use strict";function e(){t.Base.MediaInterfaceService.call(this),this._deviceIdentifier=t.Base.MediaTypes.AUDIO_OUTPUT,this._audioOutput=T,this._remoteStreamMap={}}(e.prototype=Object.create(t.Base.MediaInterfaceService.prototype)).start=function(e){return!1===this._isStarted&&(t.Base.Utils.getBrowserType()===t.Base.BrowserType.SAFARI?this._audioOutput=new t.Base.SafariAudioOutput:this._audioOutput=new t.Base.AudioOutput),t.Base.MediaInterfaceService.prototype.start.call(this,e)},e.prototype.stop=function(e){return this._audioOutput&&(this._audioOutput.stop(),this._audioOutput=T),this._remoteStreamMap={},t.Base.MediaInterfaceService.prototype.stop.call(this,e)},e.prototype._buildDevice=function(e){return new t.Base.AudioDevice(e.deviceId,e.groupId,e.label,t.Base.MediaTypes.AUDIO_OUTPUT)},e.prototype.mute=function(){this._audioOutput.mute()},e.prototype.unmute=function(){this._audioOutput.unmute()},e.prototype.isMuted=function(){return this._audioOutput.isMuted()},e.prototype.setVolume=function(e){this._audioOutput.setVolume(e)},e.prototype.getVolume=function(){return this._audioOutput.getVolume()},e.prototype.onSelectedDeviceChanged=function(e,t){this._audioOutput.onSelectedDeviceChanged(t)},e.prototype.getAudioOutput=function(){return this._audioOutput},e.prototype.getRemoteMediaStream=function(e){return this._remoteStreamMap[e]},e.prototype.setRemoteMediaStream=function(e,t){this._remoteStreamMap[e]=t},e.prototype.removeRemoteMediaStream=function(e){delete this._remoteStreamMap[e]},t.Base.AudioOutputInterfaceService=e}(AvayaClientServices);!function(C){"use strict";var u=[30,40,50,60,80,100,120,200,500,1e3],h=[7,8,8,9,12,15,30,50,125,250],_=[5,5,5,5,8,8,10,24,40,100];function e(e,t,i,a,r){C.Base.MediaStreamVideoProcessor.call(this,e,t,i),this._selfieFactory=a,this._selfieSegmentation=T,this._maskCanvas=T,this._backgroundCanvas=T,this._webglMaskProgram=T,this._blurAmount=30,this._frameData={index:3,deltaList:[],previousTime:0,highVarianceCount:0,lowVarianceCount:0,previousPerfTime:0,videoWidth:0,videoHeight:0},this._minIndex=0,r.registerPerformanceSource(this)}(e.prototype=Object.create(C.Base.MediaStreamVideoProcessor.prototype)).init=function(){this._selfieSegmentation=this._selfieFactory.take(),this._selfieSegmentation.onResults=function(e){this._postProcessMask(e.segmentationMask),this._canvasCtxt.save(),this._canvasCtxt.clearRect(0,0,this._canvas.width,this._canvas.height),this._canvasCtxt.filter="blur(2px)",this._canvasCtxt.drawImage(this._maskCanvas,0,0,this._canvas.width,this._canvas.height),this._canvasCtxt.filter="none",this._canvasCtxt.globalCompositeOperation="source-in",this._canvasCtxt.drawImage(e.image,0,0,this._canvas.width,this._canvas.height),this._createBackground(e),this._canvasCtxt.globalCompositeOperation="destination-over",this._canvasCtxt.drawImage(this._backgroundCanvas,0,0,this._canvas.width,this._canvas.height),this._requestingFrames&&this._outputStream.getVideoTracks()[0].requestFrame(),this._canvasCtxt.restore(),this._updateFrameData(),setTimeout(function(){this._runLoop()}.bind(this),u[this._frameData.index])}.bind(this),this._maskCanvas=document.createElement("canvas"),this._backgroundCanvas=document.createElement("canvas"),this._webglMaskProgram=this._createWebGLMaskProgram(),window.addEventListener("resize",e.prototype._resizeHandler.bind(this));var t=S.Deferred();return this._webglMaskProgram?this._selfieSegmentation.getInitPromise().then(function(){t.resolve()}.bind(this),function(e){t.reject(e)}.bind(this)):t.reject("webgl error"),t.promise()},e.prototype._runLoop=function(){this._isStreamAlive()?(this._updateCanvasSize(),this._selfieSegmentation.isStarted()?this._selfieSegmentation.send({image:this._inputVideo}):this._deliverUnsegmentedVideo()):this.cleanup()},e.prototype.cleanup=function(){C.Base.MediaStreamVideoProcessor.prototype.cleanup.call(this),C.Base.Logger.debug(C.Base.LoggerTags.MEDIA_ENGINE,"Cleaning up MediaPipeVideoProcessor ",this._origStream,this._outputStream),this._selfieFactory.return(this._selfieSegmentation),this._selfieSegmentation=T,window.removeEventListener("resize",e.prototype._resizeHandler.bind(this)),this._resetFrameData(),this._maskCanvas&&this._webglMaskProgram&&(this._maskCanvas.getContext("webgl").deleteProgram(this._webglMaskProgram),this._webglMaskProgram=T),this._maskCanvas=T,this._backgroundCanvas=T},e.prototype._postProcessMask=function(e){this._maskCanvas.width=this._canvas.width,this._maskCanvas.height=this._canvas.height;var t=this._maskCanvas.getContext("webgl");t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(this._webglMaskProgram),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},e.prototype._createWebGLMaskProgram=function(){var e=this._maskCanvas.getContext("webgl");if(!e)return null;var t=this._createShader(e,e.VERTEX_SHADER,"attribute vec2 a_position; attribute vec2 a_texCoord; varying vec2 v_texCoord; void main() { gl_Position = vec4(a_position, 0, 1); v_texCoord = a_texCoord; }"),i=this._createShader(e,e.FRAGMENT_SHADER,"precision mediump float; uniform sampler2D u_image; varying vec2 v_texCoord; void main() { vec4 pix = texture2D(u_image, v_texCoord); float lowerBound = 0.5; float upperBound = 0.9; float range = upperBound - lowerBound; if(pix.a < lowerBound) { pix.a = 0.0; } else if(pix.a > upperBound) { pix.a = 1.0; } else { pix.a = lowerBound + ((pix.a-lowerBound)/range)*range; } gl_FragColor = pix; } "),a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))return e.deleteProgram(a),null;var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,1,1,-1,-1,1,-1]),e.STATIC_DRAW);t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),e.STATIC_DRAW);i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);i=e.getAttribLocation(a,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);i=e.getAttribLocation(a,"a_texCoord");return e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,t),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),a},e.prototype._createShader=function(e,t,i){t=e.createShader(t);return e.shaderSource(t,i),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)?t:(e.deleteShader(t),null)},e.prototype._createBackground=function(e){this._backgroundCanvas.width=this._canvas.width,this._backgroundCanvas.height=this._canvas.height;var t=this._backgroundCanvas.getContext("2d"),e=this._backgroundImage||e.image;t.save(),this._backgroundBlur&&(t.filter="blur("+this._blurAmount+"px)"),t.drawImage(e,0,0,this._backgroundCanvas.width,this._backgroundCanvas.height),t.restore()},e.prototype._updateFrameData=function(){if("visible"===document.visibilityState){if(this._frameData.videoWidth!==this._inputVideo.videoWidth&&this._frameData.videoHeight!==this._inputVideo.videoHeight){if(0<this._inputVideo.srcObject.getVideoTracks().length)for(var e=this._inputVideo.srcObject.getVideoTracks()[0].getSettings(),t=1e3/e.frameRate,i=0;i<u.length;++i)if(t-u[i]<u[i]+h[i]){this._minIndex=i,C.Base.Logger.debug(C.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - new resolution: "+this._inputVideo.videoWidth+"x"+this._inputVideo.videoHeight+", input framerate: "+e.frameRate+", minimum timeout: "+u[this._minIndex]);break}this._frameData.videoWidth=this._inputVideo.videoWidth,this._frameData.videoHeight=this._inputVideo.videoHeight}var a=performance.now();if(0!==this._frameData.previousTime){var r=a-this._frameData.previousTime;if(this._frameData.deltaList.push(r),20===this._frameData.deltaList.length){for(var s=null,n=0,o=0,c=this._frameData.deltaList.length;o<c;++o)n+=this._frameData.deltaList[o];var l=(n/=this._frameData.deltaList.length)-u[this._frameData.index];this._frameData.deltaList.length=0;var d=h[this._frameData.index],r=_[this._frameData.index];d<l?(s=C.Base.PerformanceAlertType.CPU_USAGE_WARNING,this._frameData.lowVarianceCount=0,this._frameData.highVarianceCount++,3<=this._frameData.highVarianceCount&&((this._frameData.index<4||this._inputVideo.videoHeight<=360)&&(d=3*d<l?2:1,this._frameData.index=Math.min(this._frameData.index+d,u.length-1),C.Base.Logger.debug(C.Base.LoggerTags.MEDIA_ENGINE,"Media pipe new frameTimeout(high): "+u[this._frameData.index]+", avg: "+l)),this._frameData.highVarianceCount=0)):l<r?(this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount++,3<=this._frameData.lowVarianceCount&&(this._frameData.index>this._minIndex&&(this._frameData.index--,C.Base.Logger.debug(C.Base.LoggerTags.MEDIA_ENGINE,"Media pipe new frameTimeout(low): "+u[this._frameData.index]+", avg: "+l)),this._frameData.lowVarianceCount=0)):(this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount=0),4<=this._frameData.index&&this._frameData.index>this._minIndex&&(s=C.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,this.onPerformanceMonitorAlert(s,"Media pipe - frame processing time(ms) greater than "+u[this._frameData.index])),null!==s&&(s=C.Base.PerformanceAlertType.CPU_USAGE_WARNING,5e3<a-this._frameData.previousPerfTime&&(C.Base.Logger.debug(C.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - warning("+this._inputVideo.videoWidth+"x"+this._inputVideo.videoHeight+"), avg: "+l+", timeout: "+u[this._frameData.index]),this.onPerformanceMonitorAlert(s,"Media pipe - frame processing time(ms) is high: "+(u[this._frameData.index]+l)),this._frameData.previousPerfTime=a))}}this._frameData.previousTime=a}else this._frameData.previousTime=0},e.prototype._resetFrameData=function(){this._frameData.deltaList.length=0,this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount=0,this._frameData.previousTime=0},e.prototype._resizeHandler=function(){var e=this._frameData.previousTime;this._resetFrameData(),this._frameData.previousTime=e},e.prototype._deliverUnsegmentedVideo=function(){var e={image:this._inputVideo};this._createBackground(e),this._canvasCtxt.drawImage(this._backgroundCanvas,0,0,this._canvas.width,this._canvas.height),setTimeout(function(){this._runLoop()}.bind(this),u[this._frameData.index])},e.prototype.onPerformanceMonitorAlert=function(e,t){},C.Base.MediaPipeVideoProcessor=e}(AvayaClientServices),function(i){"use strict";function e(){i.Base.Observable.call(this),this._config=T,this._credentialProvider=T,this._csrfSupport=!1,this._protocolTypes={secure:"",nonSecure:""}}(e.prototype=Object.create(i.Base.Observable.prototype)).start=function(e,t,i,a,r,s){var n=S.Deferred();return this._config=e,this._credentialProvider=t,this.onOpen(),n.resolve(),n.promise()},e.prototype.send=function(e,t,i){},e.prototype.getBufferedAmount=function(){return 0},e.prototype._onCredentialsRequired=function(e){},e.prototype.onInvalidCredentialsProvided=function(e,t){},e.prototype._getServerURL=function(e){var t="";return e&&i.Base.Utils.isDefined(e.url)?t=e.url:this._config&&(t+=(this._config.isSecure?this._protocolTypes.secure:this._protocolTypes.nonSecure)+"://",this._config.credentials&&(t+=this._config.credentials+"@"),t+=this._config.hostName,this._config.port&&(t+=":"+this._config.port)),e&&e.urlSuffix?t+=e.urlSuffix:this._config&&this._config.path&&(t+=this._config.path),e&&e.query?t+="?"+e.query:this._config&&this._config.query&&(t+="?"+this._config.query),t},e.prototype.run=function(e){},e.prototype.close=function(){this.onClose()},e.prototype.onOpen=function(){},e.prototype.onClose=function(){},e.prototype.onMessage=function(e){},e.prototype.onError=function(e){},e.prototype.onConnectionUnavailable=function(){},e.prototype.setCSRFSupport=function(e){this._csrfSupport=!!e},e.prototype._addCSRFSupport=function(e){return i.Base.Utils.isDefined(e)&&(i.Base.Utils.isDefined(e.headers)||(e.headers={}),e.headers["X-Avaya-Requested-With"]="XMLHttpRequest"),e},e.prototype.setTriggerUnauthorizedError=function(){},i.Base.AbstractNetworkProvider=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i){function a(e,s){e.onOpen=function(e){s.onOpen(e)},e.onMessage=function(i,a){var r={};r.receivedTime=(new Date).getTime(),s.wsConnectionId&&(r.wsConnectionId=s.wsConnectionId),setTimeout(function(){try{var e=i.data||i,t=!!this._failoverPingData&&"wsIsPingMessage"in this._failoverPingData&&this._failoverPingData.wsIsPingMessage(e);i.type===n.Base.ProvidersEventTypes.PING||(n.Base.Utils.isDefined(this._failoverPingData)&&this._failoverPingData.wsKeepAliveEnabled&&(this._failoverPingData.wsIsPongMessage(e)||t)?t?s._log(n.Base.Logger.debug,"Received ping request."):s._log(n.Base.Logger.debug,"Received pong response."):s._networkLogger.logRecvMessage(i,a,r))}catch(e){s._log(n.Base.Logger.error,"Error caught while logging. ",e)}s.onMessage(i,a)}.bind(this))},e.onClose=function(e){s.onClose(e)},e.onError=function(e){s.onError(e)},e.on(n.Base.NetworkErrorCodes.HTTP_REDIRECTION,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_MOVED_PERMANENTLY,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_FOUND,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_SEE_OTHER,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_NOT_MODIFIED,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_USE_PROXY,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_TEMPORARY_REDIRECT,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_PERMANENT_REDIRECT,s._handleRedirect.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_BAD_REQUEST,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_UNAUTHORIZED,s._handleUnauthorized.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_PAYMENT_REQUIRED,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_FORBIDDEN,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_NOT_FOUND,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_METHOD_NOT_ALLOWED,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_NOT_ACCEPTABLE,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_PROXY_AUTHENTICATION_REQUIRED,s._handleUnauthorized.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_REQUEST_TIMEOUT,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_CONFLICT,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_GONE,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_LENGTH_REQUIRED,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_PRECONDITION_FAILED,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_PAYLOAD_TO_LARGE,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_URI_TOO_LONG,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_UNSUPPORTED_MEDIA_TYPE,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR,s._handleNetworkError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_INTERNAL_SERVER_ERROR,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_NOT_IMPLEMENTED,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_BAD_GATEWAY,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_SERVICE_UNAVAILABLE,s._retry.bind(s)),e.on(n.Base.NetworkErrorCodes.HTTP_GATEWAY_TIMEOUT,s._handleError.bind(s)),e.on(n.Base.NetworkErrorCodes.WEBSOCKET_UNAUTHORIZED,s._handleUnauthorized.bind(s))}n.Base.AbstractNetworkProvider.apply(this),this._parentLoggerTag=i,this._networkLogger=new n.Base.NetworkLogger(i),this._communicationAdapter={},this._mainProvider=e,this._fallbackProvider=t,this._config=T,this._credentialProvider=T,this._failoverCallback=T,this._reconnectionMainProvider=!1,this._unauthorizedCount=0,this._closing=!1,this._failoverPromise=T,this._onCredentialsRequired=function(){},this.onConnectionUnavailable=function(){!this._closing&&this._failoverCallback&&this._fallbackProvider&&!this._failoverPromise?(this._log(n.Base.Logger.debug,"onConnectionUnavailable Callback - Reconnection process start with fallback provider","Reconnection main provider: "+this._reconnectionMainProvider),this._reconnectionMainProvider?this._fallbackProvider&&(this._reconnectionMainProvider=!1,this._communicationAdapter=this._fallbackProvider,this._executeFailoverCallback()):(this._reconnectionMainProvider=!0,this._communicationAdapter=this._mainProvider,this._executeFailoverCallback().then(function(){this._reconnectionMainProvider=!1}.bind(this)))):this._closing||!this._failoverCallback||this._failoverPromise||(this._log(n.Base.Logger.debug,"onConnectionUnavailable Callback - Reconnection process start without fallback provider"),this._executeFailoverCallback())}.bind(this),a(this._mainProvider,this),this._mainProvider.onConnectionUnavailable=this.onConnectionUnavailable,this._fallbackProvider&&(a(this._fallbackProvider,this),this._fallbackProvider.onConnectionUnavailable=this.onConnectionUnavailable),this._communicationAdapter=this._mainProvider}(e.prototype=Object.create(n.Base.AbstractNetworkProvider.prototype)).start=function(e,t,i,a,r,s){this._failoverCallback=r,this._config=e,this._credentialProvider=t,this._closing=!1,this._failoverPromise&&"pending"!==this._failoverPromise.state()&&(this._failoverPromise=T);e={message:T,options:i||{}};return this._credentialProvider&&this._onCredentialsRequired(e),a=a||new n.Base.NetworkRequestRetryHelper(function(){return this._closing?S.Deferred().reject().promise():this.start(this._config,t,i,a,r,s)}.bind(this)),this._communicationAdapter.start(this._config,this._credentialProvider,e.options,a,s)},e.prototype.send=function(e,t,i,a){a||this._networkLogger.logSendMessage(e,t,this._communicationAdapter);a={message:e,options:t};return this._credentialProvider&&this._onCredentialsRequired(a,this._credentialProvider),i=i||new n.Base.NetworkRequestRetryHelper(function(){return this.send(e,t,i)}.bind(this)),this._communicationAdapter.send(a.message,a.options,i)},e.prototype.close=function(e){return this._closing=!0,e=e||new n.Base.NetworkRequestRetryHelper(function(){return this.close()}.bind(this)),this._communicationAdapter.close(e)},e.prototype._handleUnauthorized=function(t){var i=t.getDeferred(),e=new n.Config.InvalidCredentialsEvent(this._unauthorizedCount,function(e){e!==T&&(this._credentialProvider=e),t.getRequestRetryHelper().getRetryCallback()().then(function(e){this._unauthorizedCount=0,i.resolve(e),this.trigger(n.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this),function(e){i.reject(new n.Base.NetworkError(n.Base.ErrorReasons.NETWORK_UNAUTHORIZED,e))})}.bind(this),function(){i.reject(new n.Base.NetworkError(n.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED))}.bind(this));this.trigger(n.Base.NetworkProviderEvents.UNAUTHORIZED,[e]),this._unauthorizedCount++,this._credentialProvider?(this._log(n.Base.Logger.warn," invalid credentials event"),this._credentialProvider._onInvalidCredentialsProvidedCallbacks.fire(e)):i.reject(new n.Base.NetworkError(n.Base.ErrorReasons.NETWORK_UNAUTHORIZED))},e.prototype._handleRedirect=function(e){n.Base.Utils.isDefined(e.getRetryAfter())?(this._log(n.Base.Logger.warn,"Request failed. Retrying after "+e.getRetryAfter()),this._retry(e)):this._handleError(e)},e.prototype._handleError=function(e){var t=new n.Base.NetworkError(n.Base.ErrorReasons.NETWORK_ERROR,e);this._log(n.Base.Logger.error,"Network error occurred. Status: "+e.getStatus()),e.getDeferred().reject(t),this.onError(t)},e.prototype._handleNetworkError=function(e){var t=new n.Base.NetworkError(n.Base.ErrorReasons.NETWORK_ERROR,e);this._log(n.Base.Logger.error,"Network error occurred. Status: "+e.getStatus()),e.getDeferred().reject(t),this.onError(t)},e.prototype.registerBlackList=function(e){this._networkLogger.registerBlackList(e),this._mainProvider&&"function"==typeof this._mainProvider.registerBlackList&&this._mainProvider.registerBlackList(e),this._fallbackProvider&&"function"==typeof this._fallbackProvider.registerBlackList&&this._fallbackProvider.registerBlackList(e)},e.prototype._retry=function(e){e.getRequestRetryHelper().incrementCounter();var t=e.getDeferred(),i=e.getRetryAfter(),a=e.getRequestRetryHelper().getRetryCounter();i&&a<this._config.maxConnectionErrorCount?(setTimeout(function(){e.getRequestRetryHelper().getRetryCallback()().then(t.resolve,t.reject)},i),t.notify(n.Base.NetworkProviderEvents.RETRYING)):this._handleError(e)},e.prototype.isOpened=function(){return this._communicationAdapter.isOpened()},e.prototype.getBufferedAmount=function(){return this._communicationAdapter.getBufferedAmount()},e.prototype.run=function(e){return this._communicationAdapter.run(e)},e.prototype.stopMonitorFallback=function(){this._fallbackProvider&&(this._fallbackProvider.close(),this._fallbackProvider=T),this._failoverCallback=T},e.prototype._executeFailoverCallback=function(){return this._closing||this._failoverPromise||"function"!=typeof this._failoverCallback||(this._failoverPromise=this._failoverCallback().always(function(){this._failoverPromise=T}.bind(this))),this._failoverPromise},e.prototype._log=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this._parentLoggerTag),e.call(T,n.Base.LoggerTags.NETWORK_PROVIDER,t)},e.prototype.disableNetworkLogging=function(){this._networkLogger.logSendMessage=function(){},this._networkLogger.logRecvMessage=function(){}},e.prototype.disableOptionsLogging=function(e){this._networkLogger.disableOptionsLogging(e)},e.prototype.setCSRFSupport=function(e){this._mainProvider.setCSRFSupport(e),this._fallbackProvider&&this._fallbackProvider.setCSRFSupport(e)},e.prototype.setHandleWebSocketUnauthorized=function(e){this._mainProvider.setTriggerUnauthorizedError(!!e),this._fallbackProvider&&this._fallbackProvider.setTriggerUnauthorizedError(!!e)},n.Base.NetworkProvider=e}(AvayaClientServices),function(n){"use strict";function e(){var r;this.startPolling=function(e,t,i,a){r=setInterval(function(){n.Base.Logger.info(n.Base.LoggerTags.REST_NETWORK_PROVIDER,"polling "+e),this._poll(e,i,a,function(e){this.onMessage({data:e})}.bind(this),function(e){this.onError(e)}.bind(this))}.bind(this),t)},this.stopPolling=function(){clearInterval(r)},this._poll=function(e,t,i,a,r){var s,e={type:"GET",url:e,dataType:"text",data:S.param(t),headers:{}};return this._csrfSupport&&(e=this._addCSRFSupport(e)),n.Base.Utils.isDefined(i)&&(i.crossDomain&&!0===i.crossDomain&&(e.xhrFields={withCredentials:!0},e.crossDomain=!0),t=[n.Config.Authentication.Scheme.BASIC,n.Config.Authentication.Scheme.BEARER],i.authentication&&n.Base.Utils.includes(i.authentication.type,t)&&(s=i.authentication.type===n.Config.Authentication.Scheme.BASIC?n.Config.Authentication.Header.basic(i.authentication.username,i.authentication.password):(t=i.authentication.bearer||n.Config.Authentication.TokenType.BEARER,n.Config.Authentication.Header.bearer(t,i.authentication.token)),e.beforeSend=function(e){e.setRequestHeader("Authorization",s)})),S.ajax(e).then(a,r)}}n.Providers=n.Providers||{},e.prototype=Object.create(n.Base.AbstractNetworkProvider.prototype),n.Base.PollingRESTProvider=e}(AvayaClientServices),function(o){"use strict";function e(){o.Base.AbstractNetworkProvider.call(this),this.type=o.Base.ProviderTypes.REST_PROVIDER,this._xhrPool=[],this._protocolTypes={secure:"https",nonSecure:"http"}}(e.prototype=Object.create(o.Base.AbstractNetworkProvider.prototype)).defaultOptions={url:T,sendType:"POST",timeout:3e4,urlSuffix:"",dataType:"text",processData:!0},e.prototype.start=function(e,t,i,a){return o.Base.AbstractNetworkProvider.prototype.start.call(this,e.restConfig,t,i,a)},e.prototype.send=function(e,t,i){var a,r=S.extend({},this.defaultOptions,t),s={url:this._getServerURL(r),type:r.sendType,timeout:r.timeout,dataType:r.dataType,jsonp:!1,headers:r.headers,processData:r.processData,beforeSend:function(e){e.withCredentials=!0,this._xhrPool.push(e),a=e}.bind(this)};r.binaryProgressCallback&&(s.binaryProgressCallback=r.binaryProgressCallback),o.Base.Utils.isDefined(t.requestId)&&(s.requestId=t.requestId),r.keepAliveCallback&&(s.keepAliveCallback=r.keepAliveCallback),r.responseType&&(s.responseType=r.responseType),e&&(s.data=e),r.crossDomain&&!0===r.crossDomain&&(s.crossDomain=!0),o.Base.Utils.isDefined(r.async)&&!0!==r.async||(s.xhrFields={withCredentials:!0}),o.Base.Utils.isDefined(r.contentType)&&(s.contentType=r.contentType),this._csrfSupport&&(s=this._addCSRFSupport(s));var n,e=[o.Config.Authentication.Scheme.BASIC,o.Config.Authentication.Scheme.BEARER];return r.authentication&&o.Base.Utils.includes(r.authentication.type,e)&&(n=r.authentication.type===o.Config.Authentication.Scheme.BASIC?o.Config.Authentication.Header.basic(r.authentication.username,r.authentication.password):(e=r.authentication.bearer||o.Config.Authentication.TokenType.BEARER,o.Config.Authentication.Header.bearer(e,r.authentication.token)),s.beforeSend=function(e){e.withCredentials=!0,e.setRequestHeader("Authorization",n),this._xhrPool.push(e),a=e}.bind(this)),r.cancel&&(s.cancel=function(){a.abort(new o.Base.NetworkError(o.Base.ErrorReasons.NETWORK_CANCELED))}),o.Base.Utils.isDefined(r.async)&&!1===r.async?(s.async=!1,this._sendSync(s)):this._sendAsync(s,i)},e.prototype._sendAsync=function(a,r){var s=S.Deferred();return S.ajax(a).then(function(e,t,i){this._ajaxOnSuccess(e,t,i,s,a)}.bind(this),function(e,t,i){0===e.status&&(e.status=o.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR),this._ajaxOnError(e,t,i,s,r)}.bind(this)),s.promise()},e.prototype._sendSync=function(e){var a=S.Deferred();return e.success=function(e,t,i){this._ajaxOnSuccess(e,t,i,a)}.bind(this),e.error=function(e,t,i){0===e.status&&(e.status=o.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR),this._ajaxOnError(e,t,i,a)}.bind(this),S.ajax(e),a.promise()},e.prototype._ajaxOnSuccess=function(e,t,i,a){return this._removeXhrFromPool(i),this.onMessage(e,i),a.resolve(e,i),e},e.prototype._ajaxOnError=function(e,t,i,a,r){r=new o.Base.NetworkErrorEvent(r,a,e.status,e.responseText,e.getResponseHeader("Retry-After"));return this.hasListeners(e.status)?this.trigger(e.status,[r]):(this.onError(t),t=new o.Base.NetworkError(o.Base.ErrorReasons.NETWORK_ERROR,new o.Base.NetworkErrorEvent(T,T,e.status,e.responseText)),a.reject(t,e)),this._removeXhrFromPool(e),e},e.prototype.close=function(){return this._xhrPool.forEach(function(e){e.abort()}),this._xhrPool=[],this.onClose(),S.Deferred().resolve().promise()},e.prototype.abort=function(){this._xhrPool.forEach(function(e){e.abort()}),this._xhrPool=[]},e.prototype._removeXhrFromPool=function(e){-1<this._xhrPool.indexOf(e)&&this._xhrPool.splice(this._xhrPool.indexOf(e),1)},o.Base.RESTProvider=e}(AvayaClientServices),function(a){"use strict";function e(e,t){function i(e,i){for(var t in e.onOpen=function(e){i.onOpen(e)},e.onMessage=function(e,t){e&&e.type===a.Base.ProvidersEventTypes.PING&&i._keepAlive(),i.onMessage(e,t)},e.onClose=function(e){i.onClose(e)},e.onError=function(e){i.onError(e)},e.onConnectionUnavailable=function(e){i.onConnectionUnavailable(e)},a.Base.NetworkErrorCodes)a.Base.NetworkErrorCodes.hasOwnProperty(t)&&e.on(a.Base.NetworkErrorCodes[t],i._triggerErrors.bind(i))}a.Base.AbstractNetworkProvider.apply(this),this.type=a.Base.ProviderTypes.SSE_PROVIDER,this._restProvider=e,this._sseProvider=t,this._onCredentialsRequired=function(){},i(this._restProvider,this),i(this._sseProvider,this),this._config={},this._credentialProvider={},this._keepAliveTimeout=T,this._failoverPingData=T}(e.prototype=Object.create(a.Base.AbstractNetworkProvider.prototype)).onConnectionUnavailable=function(){},e.prototype.start=function(e,t,i,a,r){this._config=e,this._credentialProvider=t,this._failoverPingData=r;r={message:T,options:i};this._credentialProvider&&this._onCredentialsRequired(r);i=this._sseProvider.start(this._config,this._credentialProvider,r.options,a),a=this._restProvider.start(this._config,this._credentialProvider,r.options,a);return S.when(i,a).done(function(){this._keepAlive()}.bind(this)).fail(function(){this.close(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this))},e.prototype.send=function(e,t,i){t={message:e,options:t};return this._credentialProvider&&this._onCredentialsRequired(t),this._restProvider.send(t.message,t.options,i)},e.prototype.close=function(){return S.when(this._restProvider.close(),this._sseProvider.close())},e.prototype.isOpened=function(){return this._sseProvider.isOpened()},e.prototype._triggerErrors=function(e){this.trigger(e._status,[e])},e.prototype._keepAlive=function(){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._failoverPingData&&this._failoverPingData.ssePingInterval&&(this._keepAliveTimeout=setTimeout(function(){this.close(),clearTimeout(this._keepAliveTimeout),this.onConnectionUnavailable()}.bind(this),this._failoverPingData.ssePingInterval))},a.Base.SSEIntegrationProvider=e}(AvayaClientServices),function(a){"use strict";function e(e){a.Base.AbstractNetworkProvider.apply(this),this._stream=T,this._isOpened=!1,this._isShutdown=!1,this._eventTypes=e||[],this._protocolTypes={secure:"https",nonSecure:"http"}}(e.prototype=Object.create(a.Base.AbstractNetworkProvider.prototype)).start=function(e,t,i){var a=S.Deferred();return this._isOpened?(this.onOpen(),a.resolve()):(this._maxConnectionErrorCount=e.maxConnectionErrorCount,this._config=e.sseConfig,this._isShutdown=!1,this._credentialProvider=t,this._createStream(i,a)),a.promise()},e.prototype.close=function(){this._isShutdown=!0,this._stream&&(this._stream.close(),this._stream=T),this._isOpened?this._isOpened=!1:this.onClose()},e.prototype.isOpened=function(){return this._isOpened&&1===this._stream.readyState},e.prototype._createStream=function(e,t){this._isOpening=!0,this._stream=new EventSource(this._getServerURL(e),{withCredentials:!0}),this._stream.onopen=function(){this._isOpening=!1,this._isShutdown?(this._stream.close(),t.reject()):(this._isOpened=!0,this.onOpen(),t.resolve())}.bind(this),this._stream.onerror=function(e){(a.Base.Utils.isUndefined(e.readyState)||e.readyState===EventSource.CLOSED&&!this._isOpening)&&(this._isOpened=!1,this._stream.close(),this._stream=T,this.onClose()),this.onError(e),t.reject()}.bind(this);for(var i=0;i<this._eventTypes.length;i++)this._stream.addEventListener(this._eventTypes[i],function(e){this.onMessage(e)}.bind(this))},a.Base.SSEProvider=e}(AvayaClientServices),function(s){"use strict";function e(){s.Base.AbstractNetworkProvider.apply(this),this.type=s.Base.ProviderTypes.WEB_SOCKET_PROVIDER,this._socket=T,this._isOpened=!1,this._isShutdown=!1,this._isOnConnectionUnavailableShutdown=!1,this._triggerUnauthorizedError=!0,this._protocolTypes={secure:"wss",nonSecure:"ws"},this._failoverPingData=T,this._keepAliveTimeout=T,this._keepAliveAnswerWaitingTimeout=T}(e.prototype=Object.create(s.Base.AbstractNetworkProvider.prototype)).onConnectionUnavailable=function(){},e.prototype.start=function(e,t,i,a,r,s){var n=S.Deferred();return this._failoverPingData=r,this._isOpened?(n.resolve(),this.onOpen()):(this._config=e.webSocketConfig,this._maxConnectionErrorCount=e.maxConnectionErrorCount,this._isShutdown=!1,this._isOnConnectionUnavailableShutdown=!1,this._credentialProvider=t,window.WebSocket===T?(n.reject(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))):this._createSocket(i,a,s,n)),n.promise()},e.prototype.send=function(e,t,i){var a=S.Deferred();return this.isOpened()?(this._socket.send(e),a.resolve()):a.reject("Socket is not opened!"),a.promise()},e.prototype.close=function(){this._isShutdown=!0,this._isOpened&&(this._stopKeepAlive(),this._socket.onmessage=T,this._socket.onclose=T,this._socket.onerror=T,s.Base.Logger.debug(s.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Closing WebSocket by local request"),this._socket.close(),this._isOpened=!1),this.onClose(),this._socket=T},e.prototype.isOpened=function(){return this._isOpened&&1===this._socket.readyState},e.prototype.getBufferedAmount=function(){return this._socket?this._socket.bufferedAmount:0},e.prototype._createSocket=function(e,a,t,r){this._isOpening=!0;var i=e?e.wsSecureProtocolData:T;this._socket=new WebSocket(this._getServerURL(e),i),this._socket.binaryType="arraybuffer",this._socket.onmessage=t||function(e){this.checkForPong(e.data),this.onMessage(e)}.bind(this),this._socket.onopen=function(){this._isOpening=!1,this._isShutdown?this._socket&&this._socket.close():(this._isOpened=!0,r.resolve(),s.Base.Utils.isDefined(this._failoverPingData)&&this._failoverPingData.wsKeepAliveEnabled&&this._keepAlive(),this.onOpen())}.bind(this),this._socket.onclose=function(e){this._stopKeepAlive();var t,i=!1;e.code!==s.Base.NetworkErrorCodes.WEBSOCKET_UNAUTHORIZED||this._isOnConnectionUnavailableShutdown||!this._isOpened&&this._triggerUnauthorizedError?e.code!==s.Base.NetworkErrorCodes.WEBSOCKET_CLOSE_NORMAL&&!this._isOnConnectionUnavailableShutdown&&this.hasListeners(e.code)&&(t=new s.Base.NetworkErrorEvent(a,r,e.code),this.trigger(e.code,[t])):(i=!0,setTimeout(function(){this.onConnectionUnavailable()}.bind(this),0)),this._isOpening||(r.reject(),this._isOpened=!1,this._socket=T,this.onClose()),this._isOpened||this._isShutdown||(r.reject(),i||setTimeout(function(){this.onConnectionUnavailable()}.bind(this)))}.bind(this),this._socket.onerror=function(e){r.reject(),this.onError(e),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this)},e.prototype.checkForPong=function(e){var t=!1;return s.Base.Utils.isDefined(this._failoverPingData)&&((t=this._failoverPingData.wsKeepAliveEnabled&&this._failoverPingData.wsIsPongMessage(e)?!0:t)||this._failoverPingData.allowAnyPong)&&s.Base.Utils.isDefined(this._keepAliveAnswerWaitingTimeout)&&(clearTimeout(this._keepAliveAnswerWaitingTimeout),this._keepAliveAnswerWaitingTimeout=T,this._keepAlive()),t},e.prototype._keepAlive=function(){s.Base.Utils.isDefined(this._failoverPingData)&&s.Base.Utils.isDefined(this._failoverPingData.wsPingInterval)&&(this._keepAliveTimeout=setTimeout(function(){var e=this._failoverPingData.wsGeneratePingMessage(),t=this.getBufferedAmount();this.send(e),t=t<1024?function(){this._isOnConnectionUnavailableShutdown=!0,s.Base.Logger.debug(s.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Closing WebSocket due to failed ping"),this.close(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this):(s.Base.Logger.debug(s.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Disabling ping timeout due to the WebSocket already having a buffer of data to send.  Prior buffer: "+t),function(){}),this._keepAliveAnswerWaitingTimeout=setTimeout(t,this._failoverPingData.keepAliveAnswerWaitingTime)}.bind(this),this._failoverPingData.wsPingInterval))},e.prototype._stopKeepAlive=function(){s.Base.Utils.isDefined(this._keepAliveTimeout)&&(clearTimeout(this._keepAliveTimeout),this._keepAliveTimeout=T),s.Base.Utils.isDefined(this._keepAliveAnswerWaitingTimeout)&&(clearTimeout(this._keepAliveAnswerWaitingTimeout),this._keepAliveAnswerWaitingTimeout=T)},e.prototype.setTriggerUnauthorizedError=function(e){this._triggerUnauthorizedError=!!e},s.Base.WebSocketProvider=e}(AvayaClientServices),function(e){"use strict";function t(){this.defaultMessage="One or more elements in provided array are not compatible with required type."}(t.prototype=Object.create(e.Base.Validators.BaseValidator.prototype)).validate=function(e,t,i){var a=e.filter(function(e){return typeof e===t.expected||"object"==typeof e&&e instanceof t.expected}).length===e.length;return this._processCondition(a,e,t,i)},e.Base.Validators.ArrayElementTypeValidator=t}(AvayaClientServices),function(e){"use strict";var t={resolution1080p:new e.Base.VideoResolutionDetails(1920,1080,1792,9999),resolution720p:new e.Base.VideoResolutionDetails(1280,720,1024,1792),resolution480p:new e.Base.VideoResolutionDetails(848,480,640,1024),resolution360p:new e.Base.VideoResolutionDetails(640,360,384,640),resolution240p:new e.Base.VideoResolutionDetails(416,240,256,384),resolution180p:new e.Base.VideoResolutionDetails(320,180,128,256)};e.Base.VideoResolution=t}(AvayaClientServices),function(s){"use strict";function e(e,t,i){s.Providers.Interfaces.AbstractProvider.call(this),this._acsNetworkProvider=e,this._contactsConverter=t,this._requestBuilder=i,this._state=s.Providers.ACS.ACSProviderStates.STOPPED,this._allowedCapability=new s.Base.Capability(s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._deniedCapability=new s.Base.Capability(s.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._contactsCapability=this._deniedCapability,this._resolveContactsCapability=this._deniedCapability,this._terminalCapability=this._deniedCapability,this._conferenceSearchCapability=this._deniedCapability,this._blackListedWords=["userEmail","contactIdentifier","contactUrl","surName","givenName","displayName","asciiGivenName","asciiSurName","asciiDisplayName","isBuddy","favourite","notes","instantConnection","videoCapable","phoneNumberList","emailAddresses","preferredLanguage","type","rank","updatedTimestamp","alias","imaddresses","company","location","streetAddress","city","state","country","postalCode","manager","department","workRoomNo","value","Authorization","editable","isPrimary","searchCriteria","maxResults","data","contacts","username","self"]}(e.prototype=Object.create(s.Providers.Interfaces.AbstractProvider.prototype)).getProviderType=function(){return"ACS"},e.prototype.start=function(e,t){var i=S.Deferred();return this._changeState(s.Providers.ACS.ACSProviderStates.STARTING).then(function(){this._acsNetworkProvider.registerBlackList(this._blackListedWords),this._acsNetworkProvider.on(s.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._acsNetworkProvider.on(s.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._acsNetworkProvider.on(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.trigger(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this)),this._acsNetworkProvider.on(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this.trigger(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this)),t.addOnContactsServiceAvailableCallback(function(){this.recalculateCapabilities()}.bind(this)),t.addOnContactsServiceUnavailableCallback(function(){this.recalculateCapabilities()}.bind(this)),this._acsNetworkProvider.start(e.acsConfiguration,t).then(function(){this._changeState(s.Providers.ACS.ACSProviderStates.STARTED).then(function(){this.recalculateCapabilities(),this._acsNetworkProvider.on("acs_availability_changed",this.recalculateCapabilities.bind(this)),i.resolve()}.bind(this),function(e){i.reject(e)})}.bind(this),function(e){s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to start ACSNetworkProvider",e),i.reject(e)})}.bind(this),function(e){i.reject(e)}),i.promise()},e.prototype.stop=function(){var t=S.Deferred();return this._changeState(s.Providers.ACS.ACSProviderStates.STOPPING).always(function(){this._acsNetworkProvider.stopIfNoSubscriptions().then(function(){this._changeState(s.Providers.ACS.ACSProviderStates.STOPPED),t.resolve()}.bind(this),function(e){s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"acsNetworkProvider stop if no subscriptions was failed",e),t.reject(e)})}.bind(this)),t.promise().always(function(){this.recalculateCapabilities(),this._removeListeners()}.bind(this))},e.prototype._changeState=function(t){return t!==this._state?(this._state=t,this._handleStateChange(t).fail(function(e){s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to change state to "+t,e)})):S.Deferred().resolve().promise()},e.prototype._handleStateChange=function(e){return S.Deferred().resolve().promise()},e.prototype.recalculateCapabilities=function(){var e=this._deniedCapability,t=this._deniedCapability,i=this._deniedCapability,a=this._deniedCapability,r=this._acsNetworkProvider.getResources();this._acsNetworkProvider.isAcsAvailable()&&(r.capabilities&&0<=r.capabilities.indexOf("contacts")&&(e=this._allowedCapability,!0===r.v2MediaType&&(t=this._allowedCapability)),r.contactSearchCapabilities&&0<=r.contactSearchCapabilities.indexOf("terminal")&&(i=this._allowedCapability),r.resources&&r.resources.contacts&&r.resources.contacts.GET&&r.resources.contacts.GET.searchIViewContacts&&r.resources.contacts.GET.searchIViewContacts.href&&(a=this._allowedCapability)),this._contactsCapability===e&&this._resolveContactsCapability===t&&this._terminalCapability===i&&this._conferenceSearchCapability===a||(this._contactsCapability=e,this._resolveContactsCapability=t,this._terminalCapability=i,this._conferenceSearchCapability=a,this.trigger(s.Providers.Interfaces.ContactsProviderCallbackIds.CAPABILITIES_CHANGED))},e.prototype.getMaxSearchResultsTotal=function(){return this._acsNetworkProvider.getMaxSearchResultsTotal()},s.Providers.ACS.ACSBaseProviderV1=e}(AvayaClientServices),function(i){"use strict";function e(){i.Providers.Interfaces.ContactsProvider.call(this),this._providers={},this._selectedProvider=T,this._userConfig={}}(e.prototype=S.extend({},i.Providers.Interfaces.ContactsProvider.prototype)).registerACSContactsProvider=function(e,t){t.on(i.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(i.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),t.on(i.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(i.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),t.on(i.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.trigger(i.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this)),t.on(i.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this.trigger(i.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this)),this._providers[e]=t},e.prototype.start=function(e,t){S.isEmptyObject(e)||this._userConfig===e||(this._userConfig=e);var i=this._determineServerVersion();return this._selectedProvider=this._providers[i],this._selectedProvider.start(e,t)},e.prototype._determineServerVersion=function(){return 1},e.prototype.getProviderType=function(){return this._selectedProvider.getProviderType()},e.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():S.Deferred().resolve().promise()},e.prototype.createContactForAdd=function(){return this._selectedProvider.createContactForAdd()},e.prototype.addContact=function(e){return this._selectedProvider.addContact(e)},e.prototype.updateContact=function(e){return this._selectedProvider.updateContact(e)},e.prototype.deleteContact=function(e){return this._selectedProvider.deleteContact(e)},e.prototype.retrieveAllContacts=function(){return this._selectedProvider.retrieveAllContacts()},e.prototype.getContactsChanges=function(){return this._selectedProvider.getContactsChanges()},e.prototype.getAddContactCapability=function(){return this._selectedProvider.getAddContactCapability()},e.prototype.getUpdateContactCapability=function(){return this._selectedProvider.getUpdateContactCapability()},e.prototype.getDeleteContactCapability=function(){return this._selectedProvider.getDeleteContactCapability()},e.prototype.getExtendedContactDetailsCapability=function(){return this._selectedProvider.getExtendedContactDetailsCapability()},e.prototype.addOnContactAddedCallback=function(e){return this._selectedProvider.addOnContactAddedCallback(e)},e.prototype.removeOnContactAddedCallback=function(e){return this._selectedProvider.removeOnContactAddedCallback(e)},e.prototype.addOnContactUpdatedCallback=function(e){return this._selectedProvider.addOnContactUpdatedCallback(e)},e.prototype.removeOnContactUpdatedCallback=function(e){return this._selectedProvider.removeOnContactUpdatedCallback(e)},e.prototype.addOnContactDeletedCallback=function(e){return this._selectedProvider.addOnContactDeletedCallback(e)},e.prototype.removeOnContactDeletedCallback=function(e){return this._selectedProvider.removeOnContactDeletedCallback(e)},e.prototype.on=function(e,t){return this._selectedProvider?this._selectedProvider.on(e,t):i.Providers.Interfaces.ContactsProvider.prototype.on.call(this,e,t)},e.prototype.off=function(e,t){return this._selectedProvider.off(e,t)},i.Providers.ACS.ACSContactsProvider=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i){o.Providers.Interfaces.ContactsProvider.call(this),o.Providers.ACS.ACSBaseProviderV1.call(this,e,t,i),this._subscribedForNotifications=!1,this._contactsCache=new o.Base.ElementCache,this._contactsCache.on(o.Base.ElementCacheEvents.ELEMENT_ADDED,function(e){e=e.map(function(e){return this._contactsConverter.convertACSContactV1toContact(e)}.bind(this));this.trigger(o.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_ADDED,[e,this])}.bind(this)),this._contactsCache.on(o.Base.ElementCacheEvents.ELEMENT_UPDATED,function(e){this.trigger(o.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_UPDATED,[this._contactsConverter.convertACSContactV1toContact(e),this])}.bind(this)),this._contactsCache.on(o.Base.ElementCacheEvents.ELEMENT_DELETED,function(e){e=e.map(function(e){return this._contactsConverter.convertACSContactV1toContact(e)}.bind(this));this.trigger(o.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_DELETED,[e,this])}.bind(this))}(e.prototype=S.extend({},o.Providers.Interfaces.ContactsProvider.prototype,o.Providers.ACS.ACSBaseProviderV1.prototype)).createContactForAdd=function(){var e=new o.Services.Contacts.EditableContact,t=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);return e.getCustom1()._setWriteCapability(t),e.getCustom2()._setWriteCapability(t),e.getCustom3()._setWriteCapability(t),e.getScopiaUserId()._setWriteCapability(t),e.getScopiaLoginId()._setWriteCapability(t),e},e.prototype.addContact=function(e){var t=this._contactsConverter.convertContactToACSContactV1(e),e=this._requestBuilder.buildAddUpdateContactData(t),t=this._requestBuilder.buildAddContactOptions();return o.Base.Utils.isUndefined(t)?S.Deferred().reject(new o.Services.Contacts.ContactsError(o.Services.Contacts.ContactsErrorReason.ADD_CONTACT_NOT_AVAILABLE)):this._acsNetworkProvider.send(e,t).then(this._onContactAdded.bind(this))},e.prototype._onContactAdded=function(e){(e=this._contactsConverter.extendAcsContact(e)).id&&e.id.value&&this._contactsCache.addElement(e.id.value,e)},e.prototype.updateContact=function(e){var t=this._contactsCache.getElement(e._uniqueAddressForMatching);if(!t)return o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Can not update contact because its old version is not found in cache"),S.Deferred().reject(new o.Services.Contacts.ContactsError(o.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR));e=this._contactsConverter.mergeContactWithACSContactV1(e,t),t=this._requestBuilder.buildAddUpdateContactData(e),e=this._requestBuilder.buildUpdateContactOptions();return o.Base.Utils.isUndefined(e)?S.Deferred().reject(new o.Services.Contacts.ContactsError(o.Services.Contacts.ContactsErrorReason.UPDATE_CONTACT_NOT_AVAILABLE)):this._acsNetworkProvider.send(t,e).then(this._onContactUpdated.bind(this))},e.prototype._onContactUpdated=function(e){(e=this._contactsConverter.extendAcsContact(e)).id&&e.id.value&&this._contactsCache.updateElement(e.id.value,e)},e.prototype.deleteContact=function(e){var t=this._requestBuilder.buildDeleteContactOptions(e._uniqueAddressForMatching);return this._acsNetworkProvider.send(null,t).then(function(){this._onContactDeleted(e.getUniqueAddressForMatching())}.bind(this))},e.prototype._onContactDeleted=function(e){e&&this._contactsCache.deleteElement(e)},e.prototype.retrieveAllContacts=function(){return this._getContacts().then(function(){this._subscribeForContactChangesNotifications()}.bind(this),function(e){return S.Deferred().reject(e).promise()},function(e){return this._applyContactsToCache(e.contacts,!0),this._contactsConverter.convertACSContactArraytoContactArray(e.contacts)}.bind(this))},e.prototype._subscribeForContactChangesNotifications=function(){var e;this._subscribedForNotifications||(this._subscribedForNotifications=!0,e=this._requestBuilder.buildSubscribeForACSNotifications(o.Providers.ACS.ACSConstants.SVC_GET_CONTACTS),this._acsNetworkProvider.subscribeForNotifications(e,this._onContactChangeNotification.bind(this)).fail(function(e){this._subscribedForNotifications=!1,o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for contact changes notifications",e)}.bind(this)))},e.prototype._unsubscribeFromContactChangesNotifications=function(){var e;return this._subscribedForNotifications?(this._subscribedForNotifications=!1,e=this._requestBuilder.buildUnsubscribeFromACSNotifications(o.Providers.ACS.ACSConstants.SVC_GET_CONTACTS),this._acsNetworkProvider.unsubscribeFromNotifications(e).fail(function(e){this._subscribedForNotifications=!0,o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to unsubscribe from contact changes notifications: "+JSON.stringify(e))}.bind(this))):S.Deferred().resolve().promise()},e.prototype._onContactChangeNotification=function(e){if(this._isContactChangeNotificationValid(e))if(e.action===o.Providers.ACS.ACSContentsActions.DELETE)this._onContactDeleted(e.url);else if(e.action===o.Providers.ACS.ACSContentsActions.REFRESH)this.retrieveAllContacts();else{var t;if(e.action===o.Providers.ACS.ACSContentsActions.ADD)t=this._onContactAdded;else if(e.action===o.Providers.ACS.ACSContentsActions.UPDATE){if(!this._contactsCache.getElement(e.url))return void o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification for unknown contact");t=this._onContactUpdated}e=this._requestBuilder.buildGetContactOptions(e.url);this._acsNetworkProvider.send(null,e).then(t.bind(this),function(e){o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to download contact list updates: "+JSON.stringify(e))})}},e.prototype._isContactChangeNotificationValid=function(t){if(!t||!t.action||!t.url)return o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification in unexpected format: "+JSON.stringify(t)),!1;if(""===t.url)return o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification with empty URL"),!1;return!!function(){for(var e in o.Providers.ACS.ACSContentsActions)if(o.Providers.ACS.ACSContentsActions.hasOwnProperty(e)&&t.action===o.Providers.ACS.ACSContentsActions[e])return!0;return!1}()||(o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification with unknown or empty type: "+t.action),!1)},e.prototype._applyContactsToCache=function(e,t){for(var i=e.length,a=[],r=0;r<i;r++)e[r].id&&e[r].id.value?a.push({elementId:e[r].id.value,element:this._contactsConverter.extendAcsContact(e[r])}):o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received contact does not have id set, ignoring it",e[r]);this._contactsCache.applyElements(a,t)},e.prototype._getContacts=function(){var a=S.Deferred(),r=this._requestBuilder.buildGetContactsOptions();if(o.Base.Utils.isUndefined(r))return a.reject(new o.Services.Contacts.ContactsError(o.Services.Contacts.ContactsErrorReason.GET_CONTACTS_NOT_AVAILABLE));function s(e){o.Base.Logger.error(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to retrieve contacts",e),a.reject(e)}var n=function(e){if(!e)return a.resolve();if(a.notify(e),e.hasMoreResults){var t=e.contacts.length-1,i=e.contacts[t].id.value;if(!i)return o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,'Last contact of the partial response to retrieve contacts request does not have "id" property set (required for consequent requests)',e.contacts[t]),a.reject(new o.Services.Contacts.ContactsError(o.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));r=this._requestBuilder.buildGetContactsOptions(i),this._acsNetworkProvider.send(null,r).then(n.bind(this),s)}else a.resolve()};return this._acsNetworkProvider.send(null,r).then(n.bind(this),s),a.promise()},e.prototype.getContactsChanges=function(){},e.prototype.getAddContactCapability=function(){return this._contactsCapability},e.prototype.getUpdateContactCapability=function(){return this._contactsCapability},e.prototype.getDeleteContactCapability=function(){return this._contactsCapability},e.prototype.getExtendedContactDetailsCapability=function(){return this._contactsCapability},e.prototype._handleStateChange=function(e){var t;switch(e){case o.Providers.ACS.ACSProviderStates.STOPPING:t=this._unsubscribeFromContactChangesNotifications();break;case o.Providers.ACS.ACSProviderStates.STOPPED:this._contactsCache.empty(),t=S.Deferred().resolve().promise();break;default:t=S.Deferred().resolve().promise()}return t},o.Providers.ACS.ACSContactsProviderV1=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.DirectorySearchProvider.call(this),this._providers={},this._selectedProvider=T,this._userConfig={}}(t.prototype=S.extend({},e.Providers.Interfaces.DirectorySearchProvider.prototype)).registerACSDirectorySearchProvider=function(e,t){this._providers[e]=t},t.prototype.start=function(e,t){S.isEmptyObject(e)||this._userConfig===e||(this._userConfig=e);var i=this._determineServerVersion();return this._selectedProvider=this._providers[i],this._selectedProvider.start(e,t)},t.prototype._determineServerVersion=function(){return 1},t.prototype.getProviderType=function(){return this._selectedProvider.getProviderType()},t.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():S.Deferred().resolve().promise()},t.prototype.startDirectorySearch=function(e){return this._selectedProvider.startDirectorySearch(e)},t.prototype.stopDirectorySearch=function(e){return this._selectedProvider.stopDirectorySearch(e)},t.prototype.startResolvingContacts=function(e,t){return this._selectedProvider.startResolvingContacts(e,t)},t.prototype.getNetworkSearchContactCapability=function(){return this._selectedProvider.getNetworkSearchContactCapability()},t.prototype.getNetworkResolveContactsCapability=function(){return this._selectedProvider.getNetworkResolveContactsCapability()},t.prototype.getNetworkSearchTerminalCapability=function(){return this._selectedProvider.getNetworkSearchTerminalCapability()},t.prototype.getConferenceSearchCapability=function(){return this._selectedProvider.getConferenceSearchCapability()},t.prototype.on=function(e,t){return this._selectedProvider.on(e,t)},t.prototype.off=function(e,t){return this._selectedProvider.off(e,t)},t.prototype.getSelfContact=function(){return this._selectedProvider.getSelfContact()},e.Providers.ACS.ACSDirectorySearchProvider=t}(AvayaClientServices),function(u){"use strict";function e(e,t,i,a,r){u.Providers.Interfaces.DirectorySearchProvider.call(this),u.Providers.ACS.ACSBaseProviderV1.call(this,e,t,i),this._activeSearches={},this._searchResultsQueue=new u.Base.ElementCache({maxElements:50}),this._acsContactsCache=r,this._contactsAnalyticsService=a}(e.prototype=S.extend({},u.Providers.Interfaces.DirectorySearchProvider.prototype,u.Providers.ACS.ACSBaseProviderV1.prototype)).startDirectorySearch=function(i){var a=S.Deferred(),e={},t="{}";if(i.getSearchNetworkSource()===u.Services.Contacts.SearchNetworkSource.CONFERENCE_ONLY){if(e=this._requestBuilder.buildSearchContactsIViewOnlyOptions(),t=this._requestBuilder.buildSearchContactsIViewOnlyData(i),!(this._acsNetworkProvider._acsConfig&&this._acsNetworkProvider._acsConfig.credentialProvider&&this._acsNetworkProvider._acsConfig.credentialProvider&&this._acsNetworkProvider._acsConfig.credentialProvider.token))return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Can't make conference only search - authorization token is not provided",new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.AUTHORIZATION_FAILED)),a.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.AUTHORIZATION_FAILED))}else e=this._requestBuilder.buildSearchContactsOptions(),t=this._requestBuilder.buildSearchContactsData(i);return e.url?(this._acsNetworkProvider.send(t,e).then(function(e){if(i.getSearchNetworkSource()===u.Services.Contacts.SearchNetworkSource.CONFERENCE_ONLY){if(!e||!e.results)return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to search contacts request",e),this._contactsAnalyticsService.trackContactProvidersUnavailable(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),a.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));for(var t=0;t<e.results.length;t++)a.notify(this._contactsConverter.convertACSContactArraytoContactArray([e.results[t]]),T,e.totalresults);a.resolve(e.results.length,!0,e.totalresults)}else{if(!e||!e.searchId)return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to search contacts request",e),this._contactsAnalyticsService.trackContactProvidersUnavailable(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),a.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));this._activeSearches[e.searchId]={searchRequestId:i.getUniqueSearchId(),deferred:a,retrievedCount:0,searchRequest:i},this.startSearchTimer(e.searchId),this._processQueuedNotifications(e.searchId)}}.bind(this),function(e){return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Search contacts request failed",e),a.reject(e)}.bind(this)),a.promise()):(u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Search contacts request failed",new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE)),a.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE)))},e.prototype.startResolvingContacts=function(e,t){for(var i=[],a=this._requestBuilder.buildQuickSearchContactsOptions(),r=[],s=[],n=S.Deferred(),o=0;o<e.length;o++){var c=this._acsContactsCache.getQuickSearchResultsFromCache(e[o],t);if(0<c.length)for(var l=0;l<c.length;l++)s.push(c[l]);else r.push(e[o])}s.length&&n.notify(s),n.resolve(),i.push(n.promise());var d=this._splitQuickSearchCriteriaStrings(r,50);for(o=0;o<d.length;o++){var C=this._sendQuickSearchRequest(d[o],t,a);i.push(C)}return u.Base.Utils.waitForAllPromisesCompletion(i)},e.prototype._sendQuickSearchRequest=function(e,a,t){var r=S.Deferred(),i=this._requestBuilder.buildQuickSearchContactsData(e,a);return this._acsNetworkProvider.send(i,t).then(function(t){var i;try{i=JSON.parse(t).searchId}catch(e){i="string"==typeof t?t:null}return i?this._activeSearches[i]?(u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned duplicate searchId",i),r.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE))):(this._activeSearches[i]={deferred:r,quickSearch:!0,searchStrings:e,searchScope:a,retrievedCount:0,searchRequest:T},this.startSearchTimer(i),void this._processQueuedNotifications(i)):(u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to quick search contacts request",i),r.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE)))}.bind(this),function(e){return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Quick search contacts request failed",e),r.reject(e)}),r.promise()},e.prototype._splitQuickSearchCriteriaStrings=function(e,t){for(var i=[],a=0;a<e.length;a+=t)i.push(e.slice(a,a+t));return i},e.prototype.startSearchTimer=function(t){setTimeout(function(){var e;this._activeSearches.hasOwnProperty(t)&&(u.Base.Logger.warn(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Result for search with ID "+t+" wasn't received in time."),e=this._activeSearches[t].deferred,delete this._activeSearches[t],e.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT)))}.bind(this),3e4)},e.prototype.stopDirectorySearch=function(e){var t,i,a;for(a in this._activeSearches)if(this._activeSearches.hasOwnProperty(a)&&this._activeSearches[a].searchRequestId===e){i=a,t=this._activeSearches[a];break}t?delete this._activeSearches[i]:u.Base.Logger.warn(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Unable to cancel contact search. Search is already cancelled, completed or doesn't exist.")},e.prototype.getNetworkSearchContactCapability=function(){return this._contactsCapability},e.prototype.getNetworkResolveContactsCapability=function(){return this._resolveContactsCapability},e.prototype.getNetworkSearchTerminalCapability=function(){return this._terminalCapability},e.prototype.getConferenceSearchCapability=function(){return this._conferenceSearchCapability},e.prototype._subscribeForNotifications=function(){var e=this._requestBuilder.buildSubscribeForACSNotifications(u.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS);return this._acsNetworkProvider.subscribeForNotifications(e,this._onSearchNotification.bind(this)).fail(function(e){u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for notifications",e)})},e.prototype._unsubscribeFromNotifications=function(){var e=this._requestBuilder.buildUnsubscribeFromACSNotifications(u.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS);return this._acsNetworkProvider.unsubscribeFromNotifications(e).fail(function(e){u.Base.Logger.warn(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to unsubscribe from notifications",e)})},e.prototype._onSearchNotification=function(e){this._isSearchNotificationValid(e)&&(this._activeSearches[e.searchId]?this._processSearchNotification(e):(u.Base.Logger.debug(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received search notification with unknown ID "+e.searchId+", caching it"),this._searchResultsQueue.getElement(e.searchId)||this._searchResultsQueue.addElement(e.searchId,[]),this._searchResultsQueue.getElement(e.searchId).push(e)))},e.prototype._processSearchNotification=function(e){var t,i=this._activeSearches[e.searchId],a=i.deferred;try{t=JSON.parse(e.data)}catch(e){return u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to parse search results",e),this._contactsAnalyticsService.trackContactProvidersUnavailable(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),void a.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE))}i.quickSearch?(r=this._contactsConverter.convertQuickSearchResults(t,i.searchStrings,i.searchScope),a.notify(r),this._acsContactsCache.addQuickSearchResultsToCache(r)):a.notify(this._contactsConverter.convertACSContactArraytoContactArray(t)),t&&0<t.length&&this._activeSearches[e.searchId].retrievedCount++;var r=this.getMaxSearchResultsTotal();i.searchRequest&&(r=0<i.searchRequest.getMaxResults()?Math.min(i.searchRequest.getMaxResults(),this.getMaxSearchResultsTotal()):this.getMaxSearchResultsTotal()),"false"===e.hasMoreResults?(a.resolve(this._activeSearches[e.searchId].retrievedCount,!0,this._activeSearches[e.searchId].retrievedCount),delete this._activeSearches[e.searchId]):this._activeSearches[e.searchId].retrievedCount===r&&(a.resolve(this._activeSearches[e.searchId].retrievedCount,!1),delete this._activeSearches[e.searchId])},e.prototype._processQueuedNotifications=function(e){var t=this._searchResultsQueue.getElement(e);if(t){for(var i=0;i<t.length;i++)this._processSearchNotification(t[i]);this._searchResultsQueue.deleteElement(e)}},e.prototype._isSearchNotificationValid=function(e){return!!(e&&e.searchId&&e.data&&e.hasMoreResults)||(u.Base.Logger.error(u.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received invalid search results",e),!1)},e.prototype._handleStateChange=function(e){var t;switch(e){case u.Providers.ACS.ACSProviderStates.STARTED:t=this._subscribeForNotifications();break;case u.Providers.ACS.ACSProviderStates.STOPPING:this._activeSearches={},this._searchResultsQueue.empty(),t=this._unsubscribeFromNotifications();break;default:t=S.Deferred().resolve().promise()}return t},e.prototype.getSelfContact=function(){var t=S.Deferred(),e=new u.Services.Contacts.ContactSearchRequest(this._acsNetworkProvider.getResources().self,u.Services.Contacts.SearchFieldType.ALL,u.Services.Contacts.SearchSourceType.NETWORK,1,0,u.Services.Contacts.SearchNetworkSource.ANYWHERE);return this.startDirectorySearch(e).then(function(){}.bind(this),function(e){return t.reject(e)},function(e){return e&&e[0]?void t.resolve(e[0]):t.reject(new u.Services.Contacts.ContactsError(u.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR))}),t.promise()},u.Providers.ACS.ACSDirectorySearchProviderV1=e}(AvayaClientServices),function(i){"use strict";var e=i.Providers.Call;e.StartCallEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.StartCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.StartCallEvent.stringValue="START_CALL",e.StartCallResponseEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.StartCallResponseEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.StartCallResponseEvent.stringValue="START_CALL_RESPONSE",e.DeviceRetrievalFailedEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.DeviceRetrievalFailedEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.DeviceRetrievalFailedEvent.stringValue="DEVICE_RETRIEVAL_FAILED",e.GetOfferSDPEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.GetOfferSDPEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.GetOfferSDPEvent.stringValue="GET_OFFER_SDP",e.OfferSDPEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.OfferSDPEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.OfferSDPEvent.stringValue="OFFER_SDP",e.RejectOfferSDPEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.RejectOfferSDPEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.RejectOfferSDPEvent.stringValue="REJECT_OFFER_SDP",e.OfferSDPFirefoxMidcallEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.OfferSDPFirefoxMidcallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.OfferSDPFirefoxMidcallEvent.stringValue="OFFER_SDP_FIREFOX",e.CallRingingEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.CallRingingEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.CallRingingEvent.stringValue="CALL_RINGING",e.AnswerSDPEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.AnswerSDPEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AnswerSDPEvent.stringValue="ANSWER_SDP",e.CallEstablishedEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.CallEstablishedEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.CallEstablishedEvent.stringValue="CALL_ESTABLISHED",e.EndCallEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EndCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EndCallEvent.stringValue="END_CALL",e.EndCallResponseEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EndCallResponseEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EndCallResponseEvent.stringValue="END_CALL_RESPONSE",e.OnAddStreamEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.OnAddStreamEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.OnAddStreamEvent.stringValue="ON_ADD_STREAM",e.IncomingCallEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.IncomingCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.IncomingCallEvent.stringValue="INCOMING_CALL",e.AcceptCallEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.AcceptCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AcceptCallEvent.stringValue="ACCEPT_CALL",e.AcceptSendVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.AcceptSendVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AcceptSendVideoEvent.stringValue="ACCEPT_SEND_VIDEO",e.MuteAudioEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.MuteAudioEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.MuteAudioEvent.stringValue="MUTE_AUDIO",e.UnmuteAudioEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.UnmuteAudioEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UnmuteAudioEvent.stringValue="UNMUTE_AUDIO",e.MuteVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.MuteVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.MuteVideoEvent.stringValue="MUTE_VIDEO",e.UnmuteVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.UnmuteVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UnmuteVideoEvent.stringValue="UNMUTE_VIDEO",e.MuteSpeakerEvent=function e(){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,{})},e.MuteSpeakerEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.MuteSpeakerEvent.stringValue="MUTE_SPEAKER",e.UnmuteSpeakerEvent=function e(){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,{})},e.UnmuteSpeakerEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UnmuteSpeakerEvent.stringValue="UNMUTE_SPEAKER",e.BlockCameraEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.BlockCameraEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.BlockCameraEvent.stringValue="BLOCK_CAMERA",e.UnBlockCameraEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.UnBlockCameraEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UnBlockCameraEvent.stringValue="UNBLOCK_CAMERA",e.HoldEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.HoldEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.HoldEvent.stringValue="HOLD",e.UnHoldEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.UnHoldEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UnHoldEvent.stringValue="UNHOLD",e.EscalateVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateVideoEvent.stringValue="ESCALATE_VIDEO",e.EscalateNailedUpVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateNailedUpVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateNailedUpVideoEvent.stringValue="ESCALATE_NAILED_UP_VIDEO",e.EscalateVideoAnswerEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateVideoAnswerEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateVideoAnswerEvent.stringValue="ESCALATE_VIDEO_GETOFFER",e.EscalateVideoGetOfferEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateVideoGetOfferEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateVideoGetOfferEvent.stringValue="ESCALATE_VIDEO_ANSWER",e.EscalateVideoOfferEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateVideoOfferEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateVideoOfferEvent.stringValue="ESCALATE_VIDEO_OFFER",e.EscalateVideoRejectedEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.EscalateVideoRejectedEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.EscalateVideoRejectedEvent.stringValue="ESCALATE_VIDEO_REJECTED",e.DeEscalateVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.DeEscalateVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.DeEscalateVideoEvent.stringValue="DEESCALATE_VIDEO",e.AnswerSdpAckEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.AnswerSdpAckEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AnswerSdpAckEvent.stringValue="ANSWER_SDP_ACK",e.DenySendVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.DenySendVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.DenySendVideoEvent.stringValue="DENY_SEND_VIDEO",e.AcceptVideoTimedOutEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.AcceptVideoTimedOutEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AcceptVideoTimedOutEvent.stringValue="ACCEPT_VIDEO_TIMED_OUT",e.SendDTMFEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.SendDTMFEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.SendDTMFEvent.stringValue="SEND_DTMF",e.IncomingAddVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.IncomingAddVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.IncomingAddVideoEvent.stringValue="INCOMING_ADD_VIDEO",e.IncomingAddVideoTimedoutEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.IncomingAddVideoTimedoutEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.IncomingAddVideoTimedoutEvent.stringValue="INCOMING_ADD_VIDEO_TIMEDOUT",e.IncomingRemoveVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.IncomingRemoveVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.IncomingRemoveVideoEvent.stringValue="INCOMING_REMOVE_VIDEO",e.IncomingGenericOfferSDPEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.IncomingGenericOfferSDPEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.IncomingGenericOfferSDPEvent.stringValue="INCOMING_GENERIC_OFFER",e.RevertStateEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.RevertStateEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.RevertStateEvent.stringValue="REVERT_STATE",e.OnAddRemoteTrackEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.OnAddRemoteTrackEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.OnAddRemoteTrackEvent.stringValue="ON_ADD_REMOTE_TRACK",e.OnRemoveRemoteTrackEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.OnRemoveRemoteTrackEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.OnRemoveRemoteTrackEvent.stringValue="ON_REMOVE_REMOTE_TRACK",e.UpdateRemoteVideoEvent=function e(t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,t)},e.UpdateRemoteVideoEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UpdateRemoteVideoEvent.stringValue="UPDATE_REMOTE_VIDEO",e.UpdateLocalStreamEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.UpdateLocalStreamEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UpdateLocalStreamEvent.stringValue="UPDATE_LOCAL_STREAM",e.StartContentVideoSharingEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.StartContentVideoSharingEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.StartContentVideoSharingEvent.stringValue="START_VIDEO_SHARING",e.StopContentVideoSharingEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.StopContentVideoSharingEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.StopContentVideoSharingEvent.stringValue="STOP_VIDEO_SHARING",e.UpdateContentVideoSharingAudioEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.UpdateContentVideoSharingAudioEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UpdateContentVideoSharingAudioEvent.stringValue="UPDATE_VIDEO_SHARING_AUDIO",e.TransferEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.TransferEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.TransferEvent.stringValue="TRANSFER",e.AttendedTransferEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.AttendedTransferEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AttendedTransferEvent.stringValue="ATTENDED_TRANSFER",e.AddParticipantFromExistingCallEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.AddParticipantFromExistingCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AddParticipantFromExistingCallEvent.stringValue="ADD_PARTICIPANT_FROM_EXISTING_CALL",e.JoinRemoteCallEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.JoinRemoteCallEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.JoinRemoteCallEvent.stringValue="JOIN_REMOTE_CALL",e.CallStateFailureEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.CallStateFailureEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.CallStateFailureEvent.stringValue="CALL_STATE_FAILURE",e.CallFailureEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.CallFailureEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.CallFailureEvent.stringValue="CALL_FAILURE",e.StartRingingEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.StartRingingEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.StartRingingEvent.stringValue="START_RINGING",e.AcceptCallRequestEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.AcceptCallRequestEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AcceptCallRequestEvent.stringValue="ACCEPT_CALL_REQUEST",e.RejectCallRequestEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.RejectCallRequestEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.RejectCallRequestEvent.stringValue="REJECT_CALL_REQUEST",e.UpdateIceRestartMediaEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.UpdateIceRestartMediaEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UpdateIceRestartMediaEvent.stringValue="UPDATE_ICE_RESTART_MEDIA_REQUEST",e.ServiceAvailableEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.ServiceAvailableEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.ServiceAvailableEvent.stringValue="SERVICE_AVAILABLE",e.UpdatePreferredReceiveResolutionEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.UpdatePreferredReceiveResolutionEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.UpdatePreferredReceiveResolutionEvent.stringValue="PREFERRED_RESOLUTION",e.AudioEndedEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.AudioEndedEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.AudioEndedEvent.stringValue="AUDIO_ENDED",e.SetBackgroundBlurEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.SetBackgroundBlurEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.SetBackgroundBlurEvent.stringValue="SET_BACKGROUND_BLUR",e.SetBackgroundImageEvent=function e(t){i.Providers.Call.CallFsmEvent.call(this,e.stringValue,t)},e.SetBackgroundImageEvent.prototype=Object.create(i.Base.SimpleFsm.SimpleFsmEvent.prototype),e.SetBackgroundImageEvent.stringValue="SET_BACKGROUND_IMAGE"}(AvayaClientServices),function(p){"use strict";var o=p.Providers.CallServiceGateway.Constants,g="0",i="1",a="2",r="3",s="4";function e(e,t,i){p.Base.Observable.call(this),this._csgProvider=e,this._callProvider=T,this._messageBuilder=t,this._host=i,this._startPromise=T,this._stopPromise=T,this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._networkProviderUnavailableCounter=0,this._started=!1,this._isNetworkAvailable=!1,this._isServiceAvailable=T,this._isExternalGateway=!1,this._parsers=[],this._registerParsers(),this._ringbackToneURLs=T,this._voicemailMWI=!1,this._voicemailNumber=T,this._eventsSubscription=T,this._onNetworkEventCallback=T,this._isServerSupportsNailedUpVideoConnection=!1,this._isSupportUpdateCallProperties=!1,this._notificationQueue=[]}(e.prototype=Object.create(p.Base.Observable.prototype)).getCallProvider=function(){return this._callProvider},e.prototype.isServiceAvailable=function(){return this._isServiceAvailable},e.prototype.start=function(t,i,a,r,s,e){if(this._startPromise)return this._startPromise;this._callProvider=t;var n=S.Deferred();return this._started=!0,this._networkProviderUnavailableCounter=0,p.Base.Utils.isDefined(e)&&(this._isExternalGateway=e),this._onNetworkAvailable&&this._onNetworkUnavailable||(this._onNetworkAvailable=function(){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is available. Subscribing for notifications"),this._isNetworkAvailable=!0,this._networkProviderUnavailableCounter=0,this._csgProvider.restProviderOnErrorHandler(function(e){p.Base.Logger.warn(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"REST provider error: "+e)}.bind(this)),this._subscribeForNotifications().then(function(){var e=r?r.getMinBandwidth():null,e=new p.Providers.CallServiceGateway.ServiceActivationParameters(a,e,s);return!s||this._isServerSupportsNailedUpVideoConnection||t.supportsMPaaSCollabCall()?this._csgProvider.activateService(o.CALLS,e):(p.Base.Logger.info(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Skipped service activation because a nailed up video connection is required and the server doesn't support it",o.CALLS),S.Deferred().resolve().promise())}.bind(this)).then(function(){this._isServiceAvailable=!0,this.trigger(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,[this._host]),this._setRingbackToneList(),p.Base.Utils.isDefined(n)&&(n.state()===p.Base.DeferredStates.PENDING?n.resolve(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.iViewToken]):n.state()===p.Base.DeferredStates.RESOLVED&&this.trigger(p.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,[this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.iViewToken]])),this._sendPendingNotifications()}.bind(this),function(e){return e instanceof p.Base.NetworkError&&this.trigger(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,e.name,e.message]),n.state()===p.Base.DeferredStates.PENDING&&n.reject(e),S.Deferred().reject(e).promise()}.bind(this)),p.Base.Utils.isDefined(this._onNetworkEventCallback)&&this._csgProvider.setOnNetworkEvents(this._eventsSubscription)}.bind(this),this._onNetworkUnavailable=function(e,t){p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is unavailable: "+e),this._isNetworkAvailable=!1,this._isServiceAvailable=!1,this._isExternalGateway&&(("Notification"!==e||t.target&&t.target.url&&t.target.url.includes("http"))&&this._networkProviderUnavailableCounter++,0<=i.maxCallStartReconnectionAttempts&&i.maxCallStartReconnectionAttempts<this._networkProviderUnavailableCounter&&(p.Base.Logger.warn(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Maximum network recovery attempted: "+this._networkProviderUnavailableCounter),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.MAX_NETWORK_RECONNECTION_ATTEMPTED,[this._host]))),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,e,t])}.bind(this),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,function(e){this.trigger(p.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,[e])}.bind(this)),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,function(e){e&&e.includes("mediaChannelGuidelines")&&(this._isServerSupportsNailedUpVideoConnection=!0),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[e])}.bind(this)),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,function(e,t,i){this.trigger(p.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,[e,t,i])}.bind(this)),this._csgProvider.on(p.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,function(e,t,i,a,r){this.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[e,t,i,a,r])}.bind(this)),this._csgProvider.on(p.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(p.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._stopPromise=T),this._startPromise=S.when(n,this._csgProvider.start(i)),this._startPromise},e.prototype.stop=function(){if(!this._started)return S.Deferred().resolve().promise();if(p.Base.Utils.isDefined(this._stopPromise))return this._stopPromise;var e=function(){this._started=!1,this._removeListeners(),this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._networkProviderUnavailableCounter=0,this._startPromise=T,this._isExternalGateway=!1,this._onNetworkEventCallback=T,this._eventsSubscription=T}.bind(this);this._stopPromise=S.Deferred();var t=function(){this._csgProvider.stop().always(e).then(function(){p.Base.Utils.isDefined(this._stopPromise)&&(this._stopPromise.resolve(),this._stopPromise=T)}.bind(this),function(e){p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"stop error.",e),p.Base.Utils.isDefined(this._stopPromise)&&(this._stopPromise.reject(e),this._stopPromise=T)}.bind(this))}.bind(this);return this._isNetworkAvailable?this._unsubscribeFromNotifications().always(function(){this._csgProvider.deactivateService(o.CALLS).always(t)}.bind(this)):t(),this._isNetworkAvailable=!1,this._isServiceAvailable=!1,this._stopPromise.promise()},e.prototype.stopImmediately=function(){return this._started?this._stopPromise||(this._stopPromise=S.Deferred(),this._csgProvider.stopImmediately().then(function(){this._stopPromise.resolve()}.bind(this),function(e){this._stopPromise.reject(e)}.bind(this)),this._stopPromise.promise()):S.Deferred().resolve().promise()},e.prototype._subscribeForNotifications=function(){var e=this._messageBuilder.buildSubscribeRequest(p.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls]),t=this._parsers[r],t=t.parse.bind(t),t=this._csgProvider.subscribeForNotifications(e,t).then(function(){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed for calls notifications")},function(e){return p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for calls notifications: "+JSON.stringify(e)),S.Deferred().reject(e).promise()}.bind(this));return p.Base.Utils.rejectIfPromiseNotResolvedInTime(t,3e4,new p.Services.Call.CallException(p.Services.Call.CallError.TIMEOUT),function(){p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Calls subscription confirmation was not received in time"),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,"Notification","Unavailable"])}.bind(this))},e.prototype._unsubscribeFromNotifications=function(){var e=this._messageBuilder.buildUnsubscribeRequest(p.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls]);return this._csgProvider.unsubscribeFromNotifications(e).then(function(){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unsubscribed from calls notifications")},function(e){return p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from calls notifications: "+JSON.stringify(e)),S.Deferred().reject(e).promise()}.bind(this))},e.prototype.getCalls=function(){var t=S.Deferred(),e=this._messageBuilder.buildGetCallsOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls]);return this._csgProvider.send(T,e).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get calls response");e=this._parsers[i].parse(e);t.resolve(e)}.bind(this),function(e){this._handleError("getCalls() network provider failed - "+e.statusText),t.reject(e)}.bind(this)),t.promise()},e.prototype.getCall=function(e){var t=S.Deferred(),e=this._messageBuilder.buildGetCallOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e);return this._csgProvider.send(null,e).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get call response");e=this._parsers[g].parse(e);t.resolve(e)}.bind(this),function(e){this._handleError("getCall() network provider failed - "+e.statusText),t.reject(e)}.bind(this)),t.promise()},e.prototype.getClients=function(){var t=S.Deferred(),e=this._messageBuilder.buildGetClientsOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Clients]);return this._csgProvider.send(null,e).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get clients response");e=this._parsers[a].parse(e);t.resolve(e)}.bind(this),function(e){this._handleError("getClients() network provider failed - "+e.statusText),t.reject(e)}.bind(this)),t.promise()},e.prototype.getClient=function(e){var t=S.Deferred(),e=this._messageBuilder.buildGetClientOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Clients],e);return this._csgProvider.send(null,e).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get client response");e=this._parsers[a].parseClient(e);t.resolve(e)}.bind(this),function(e){this._handleError("getClient() network provider failed - "+e.statusText),t.reject(e)}.bind(this)),t.promise()},e.prototype.startCall=function(e,t,i,a,r,s,n,o,c,l,d,C,u){var h=S.Deferred(),_=this._messageBuilder.buildStartCallOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls]),v="",r={subject:"",priority:null,privacy:null,participants:[{participantId:null,remoteDisplayName:v=this._csgProvider.getCredentials().isGuest?this._csgProvider.getCredentials().displayName:v,remoteAddress:e}],conferenceData:{userAgentCalling:null,video:a,webCollaboration:r}};p.Base.Utils.isDefined(t)&&0<t.length&&(r.subject=t),p.Base.Utils.isDefined(l)?(r.callId=l,r.conferenceData=null):(c=!!p.Base.Utils.isDefined(c)&&c,r.conferenceData.uccp=c,i&&(r.conferenceData.ott=i.getCallType()===p.Services.Call.CallType.CallTypeHttpMeetMe,r.conferenceData.meetingToken=i.getPortalToken()||null,r.conferenceData.meetingId=i.getConferenceID()||null,r.conferenceData.meetingPasscode=i.getPasscode()||null)),p.Base.Utils.isDefined(d)&&(r.sessionId=d),i&&p.Base.Utils.isDefined(i.getContextId)&&(r.userToUserData={contextId:i.getContextId()}),C&&(r.videoChannelGuidelines=p.Providers.CallServiceGateway.Utils.convertToVideoChannelGuidelines(C));u=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(s,T,u),o=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(n,C,o),r=S.extend({},r,{audioChannel:u},{videoChannels:o});return p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending StartCall"),this._csgProvider.send(JSON.stringify(r),_).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received make call response");e=this._parsers[g].parse(e);this._updateGatewayCapabilities(e.capabilities),h.resolve(e)}.bind(this),function(e){this._handleError("startCall() network provider failed - "+e.statusText);e=this._handleCsgProviderSendError(e);h.reject({errorCode:e.errorCode,protocolType:e.protocolType,protocolErrorCode:e.protocolErrorCode,errorMsg:e.errorMsg})}.bind(this)),h.promise()},e.prototype.offerSDPResponse=function(e,t,i,a,r){var s=S.Deferred(),n=this._messageBuilder.buildNotificationsOptions(),a=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(a),r=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(r),o=this._messageBuilder.buildProcessMediaOfferResponseNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,i,t.type,t.sdp,a,r);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending offer notification");try{this._csgProvider.sendNotification(JSON.stringify(o),n),s.resolve()}catch(e){s.reject(e)}return s.promise()},e.prototype.rejectOfferSDPResponse=function(e,t){var i=S.Deferred(),a=this._messageBuilder.buildNotificationsOptions(),r=this._messageBuilder.buildRejectOfferResponseNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t.errorCode,t.errorMsg,t.displayMsg);try{this._csgProvider.sendNotification(JSON.stringify(r),a),i.resolve()}catch(e){i.reject(e)}return i.promise()},e.prototype.answerSDPResponse=function(e,t,i){var a=S.Deferred(),r=this._messageBuilder.buildNotificationsOptions(),t=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(t),i=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(i),s=this._messageBuilder.buildProcessMediaAnswerResponseNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t,i);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending answer notification");try{this._csgProvider.sendNotification(JSON.stringify(s),r),a.resolve()}catch(e){a.reject(e)}return a.promise()},e.prototype.getOfferSDPResponse=function(e,t,i,a,r){var s=S.Deferred(),n=this._messageBuilder.buildNotificationsOptions(),i=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(i),r=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(a,T,r),o=this._messageBuilder.buildCreateMediaResponseNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t.type,t.sdp,i,r);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending getOffer notification:\n"+t.sdp),p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,JSON.stringify(o));try{this._csgProvider.sendNotification(JSON.stringify(o),n),s.resolve()}catch(e){s.reject(e)}return s.promise()},e.prototype.blockUnBlockCamera=function(e,t,i){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.UPDATE_VIDEO,t,i)},e.prototype.updateVideo=function(e,t,i,a){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.UPDATE_VIDEO,t,i,a)},e.prototype.escalateVideo=function(e,t,i){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.ADD_VIDEO,t,i)},e.prototype.deEscalateVideo=function(e,t,i){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.REMOVE_VIDEO,t,i)},e.prototype.updateMediaRequest=function(e,t,i,a,r){var s=S.Deferred(),n=this._messageBuilder.buildNotificationsOptions(),i=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(i),a=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(a),o=this._messageBuilder.buildUpdateMediaRequestNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t,i,a,r);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Update media request: "+t);try{this._csgProvider.sendNotification(JSON.stringify(o),n),s.resolve()}catch(e){s.reject(e)}return s.promise()},e.prototype.updateCallProperties=function(e,t,i,a){if(this._isSupportUpdateCallProperties){var r=S.Deferred(),s=this._messageBuilder.buildNotificationsOptions(),i=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(i),n=this._messageBuilder.buildUpdateCallPropertiesNotification(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t,i,a);return p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Update local video call properties: ",a),this._csgProvider.sendNotification(JSON.stringify(n),s).done(function(){r.resolve()}).fail(function(e){this._notificationQueue.push({data:JSON.stringify(n),options:s}),r.reject(e)}.bind(this)),r.promise()}return S.Deferred().reject("Gateway does not support UpdateCallProperties").promise()},e.prototype.endCall=function(e,t){var i={actionDetails:{targetCallId:null,subject:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:null,videoChannels:[]}};return p.Base.Utils.isDefined(t)&&(i.actionDetails.denyCallReason=t),this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.END,i)},e.prototype.transfer=function(e,t,i,a){if(!1===this.isAllowedToTransfer(e))return S.Deferred().reject().promise();i=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(i),a=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(a),a={actionDetails:{targetRemoteAddress:t,targetCallId:null,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:i,videoChannels:p.Base.Utils.isDefined(a)?a:[]}};return this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.TRANSFER,a)},e.prototype.isAllowedToTransfer=function(e){if(this._callProvider._cpCalls[e].call===T)return!1;e=this._csgProvider.getCredentials();return!(e!==T&&e.bearer!==T&&e.bearer===p.Config.Authentication.TokenType.ESGTOKEN)},e.prototype.attendedTransfer=function(e,t,i,a){if(!1===this.isAllowedToTransfer(e))return S.Deferred().reject().promise();i=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(i),a=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(a),a={actionDetails:{targetRemoteAddress:null,targetCallId:t,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:i,videoChannels:p.Base.Utils.isDefined(a)?a:[]}};return this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.TRANSFER,a)},e.prototype.addParticipantFromCall=function(e,t,i,a){i=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(i),a=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(a),a={actionDetails:{targetRemoteAddress:null,targetCallId:t,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:i,videoChannels:p.Base.Utils.isDefined(a)?a:[]}};return this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.ADD_PARTICIPANT,a)},e.prototype.joinRemoteCall=function(e,t,i,a){t=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(t),i=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(i,a),i={actionDetails:{targetRemoteAddress:null,targetCallId:null,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:t,videoChannels:p.Base.Utils.isDefined(i)?i:[]}};return a&&(i.actionDetails.videoChannelGuidelines=p.Providers.CallServiceGateway.Utils.convertToVideoChannelGuidelines(a)),this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.JOIN,i)},e.prototype.acceptCall=function(e,t,i,a,r){a=p.Providers.CallServiceGateway.Utils.convertToAudioChannel(a),r=p.Providers.CallServiceGateway.Utils.convertToVideoChannels(r),r={actionDetails:{targetCallId:null,subject:null,participants:null,conferenceData:null,sdpType:t.toUpperCase(),sdp:i,audioChannel:a,videoChannels:p.Base.Utils.isDefined(r)?r:[]}};return this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.ANSWER,r)},e.prototype.holdCall=function(e,t,i){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.HOLD,t,i)},e.prototype.unholdCall=function(e,t,i){return this.updateMediaRequest(e,p.Providers.CallServiceGateway.CallActionType.UNHOLD,t,i)},e.prototype.muteVideo=function(e,t,i){return this.updateCallProperties(e,t,i,{localVideoMute:!0})},e.prototype.unmuteVideo=function(e,t,i){return this.updateCallProperties(e,t,i,{localVideoMute:!1})},e.prototype.startVideoSharing=function(e,t,i){return this.updateCallProperties(e,t,i,{screenSharing:!0,localVideoMute:!1})},e.prototype.stopVideoSharing=function(e,t,i){return this.updateCallProperties(e,t,i,{screenSharing:!1,localVideoMute:!0})},e.prototype.updatePreferredReceiveResolution=function(e,t,i,a){return this.updateCallProperties(e,t,i,{preferredReceiveResolution:a})},e.prototype.startRinging=function(e){return this._updateCall(e,p.Providers.CallServiceGateway.CallActionType.RINGING)},e.prototype.acceptCallRequest=function(e,t,i){var a=S.Deferred(),r=this._messageBuilder.buildNotificationsOptions(),s=this._messageBuilder.buildAcceptCallResponse(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSGCallProvider: Sending accept call request");try{this._csgProvider.sendNotification(JSON.stringify(s),r).done(function(){a.resolve()}).fail(function(e){a.reject(e)})}catch(e){a.reject(e)}return a.promise()},e.prototype.rejectAnswerCallRequest=function(e,t){return this._rejectCallRequest(e,t)},e.prototype.rejectTerminateCallRequest=function(e,t){return this._rejectCallRequest(e,t)},e.prototype.rejectUpdateCallRequest=function(e,t,i){return this._rejectCallRequest(e,t)},e.prototype.rejectMakeCallRequest=function(e,t){return this._rejectCallRequest(e,t)},e.prototype._rejectCallRequest=function(e,t){var i=S.Deferred(),a=this._messageBuilder.buildNotificationsOptions(),r=this._messageBuilder.buildRejectCallResponse(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e,t);p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSGCallProvider: Sending reject call request");try{this._csgProvider.sendNotification(JSON.stringify(r),a).done(function(){i.resolve()}).fail(function(e){i.reject(e)})}catch(e){i.reject(e)}return i.promise()},e.prototype._handleError=function(e){p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error detected: "+e)},e.prototype._handleCsgProviderSendError=function(e){var t={};if(200<=e.status&&e.status<300)return t;t.errorCode=p.Services.Call.CallError.TRANSPORT_ERROR,t.protocolType=p.Services.Call.CallProtocolType.HTTP,t.protocolErrorCode=e.getData().getStatus(),t.errorMsg=e.message;var i=p.Base.Utils.queryJSONObject(e,"_data._responseText");if(i){t.protocolType=p.Services.Call.CallProtocolType.APPLICATION;try{var a=JSON.parse(i);a&&(t.errorCode=p.Providers.CallServiceGateway.Utils.convertErrorCode(a.error[0].errorCode),t.errorMsg=a.error[0].errorMsg)}catch(e){}}return t},e.prototype._updateCall=function(e,t,i){var a=this._messageBuilder.buildUpdateCallOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Calls],e);if(p.Base.Utils.isUndefined(a))return S.Deferred().reject().promise();var r=S.Deferred(),e={action:t};return i&&(e=S.extend(e,i)),this._csgProvider.send(JSON.stringify(e),a).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sent call action: "+t),r.resolve()}.bind(this),function(e){e=this._handleCsgProviderSendError(e);p.Base.Utils.queryJSONObject(e,"errorCode")?(404===e.protocolErrorCode&&e.errorCode===p.Services.Call.CallError.NOT_FOUND?e.errorCode=p.Services.Call.CallError.CALL_NOT_FOUND:this._handleError(t+" call action network provider failed - "+e.errorMsg),r.reject({errorCode:e.errorCode,protocolType:e.protocolType,protocolErrorCode:e.protocolErrorCode,errorMsg:e.errorMsg})):(p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sent call action: "+t),r.resolve())}.bind(this)),r.promise()},e.prototype.getConfiguration=function(){var t=S.Deferred(),e=this._messageBuilder.buildGetConfigurationOptions(this._csgProvider.getResourceHrefs()[p.Providers.CallServiceGateway.ResourceType.Configuration]);return this._csgProvider.send(null,e).then(function(e){p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get configuration response");e=this._parsers[s].parse(e);t.resolve(e)}.bind(this),function(e){this._handleError("getConfiguration() network provider failed - "+e.statusText),t.reject(e)}.bind(this)),t.promise()},e.prototype.getVoicemailNumber=function(){return this._voicemailNumber},e.prototype.setVoicemailNumber=function(e){this._voicemailNumber=e},e.prototype.setVoicemailMWI=function(e){this._voicemailMWI=e===p.Providers.CallServiceGateway.Constants.MWI_ON,this.trigger(p.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,[e===p.Providers.CallServiceGateway.Constants.MWI_ON])},e.prototype.getVoicemailMWI=function(){return this._voicemailMWI},e.prototype.activateService=function(e,t,i){e.toUpperCase()===o.CALLS&&(p.Base.Logger.debug(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Calls activated status: "+t),t===o.ACTIVATED?this.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,[this._host]):i===o.DEACTIVATED_BY_CLIENT?p.Base.Utils.isUndefined(this._stopPromise)?(p.Base.Logger.error("Unexpected deactivation notification when service is not stopping: "+i),this._cancelOrRestartDiscovery(i),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,[this._host,i])):p.Base.Logger.info("Unexpected deactivation notification when service is stopping: "+i):(this._cancelOrRestartDiscovery(i),this.trigger(p.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,[this._host,i])))},e.prototype._cancelOrRestartDiscovery=function(e){switch(e){case o.REGISTRATION_TERMINATED:this._csgProvider.cancelDiscovery();break;case o.USER_DOES_NOT_MATCH:p.Base.Logger.error(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Invalidates client session due to mismatch username"),this._csgProvider.invalidateClient(),this._csgProvider.forceNetworkRecovery();break;default:this._csgProvider.forceNetworkRecovery()}},e.prototype._registerParsers=function(){this._parsers[g]=new p.Providers.CallServiceGateway.CallInfoParser,this._parsers[r]=new p.Providers.CallServiceGateway.NotificationParser(this),this._parsers[i]=new p.Providers.CallServiceGateway.ClientCallsParser(this._parsers[g]),this._parsers[a]=new p.Providers.CallServiceGateway.UserClientsParser,this._parsers[s]=new p.Providers.CallServiceGateway.ConfigurationParser},e.prototype._setRingbackToneList=function(){var e=p.Providers.CallServiceGateway.CSGToneType,a=this._csgProvider.getRestResources(),r={};a.ringbackTones&&S.each(e,function(e,t){var i=a.ringbackTones[t];i&&i.href&&(r[t]=i.href)});var t=new p.Services.Call.RingbackToneURLs;t._setRingbackToneUrl(r[e.RINGBACK]),t._setInterceptToneUrl(r[e.INTERCEPT]),t._setReorderToneUrl(r[e.REORDER]),t._setFastBusyToneUrl(r[e.FASTBUSY]),this._ringbackToneURLs&&JSON.stringify(this._ringbackToneURLs)===JSON.stringify(t)||(this._ringbackToneURLs=t,this.trigger(p.Providers.CallServiceGateway.ObservableEvents.RINGBACK_TONE_URLS_CHANGED,[t]))},e.prototype.setOnNetworkEvents=function(t,e){return this._netWorkEventsPromise=S.Deferred(),this._eventsSubscription=t,this._onNetworkEventCallback?this._csgProvider.updateOnNetworkEvents(t).then(function(e){this._validateEventsInResponse(e,t),this._netWorkEventsPromise.resolve(e)}.bind(this),function(e){e=this._buildNetworkEventsErrorMessage(e);this._netWorkEventsPromise.reject(e)}.bind(this)):this._csgProvider.setOnNetworkEvents(t).then(function(e){this._validateEventsInResponse(e,t),this._netWorkEventsPromise.resolve(e)}.bind(this),function(e){this._onNetworkEventCallback=T;e=this._buildNetworkEventsErrorMessage(e);this._netWorkEventsPromise.reject(e)}.bind(this)),this._onNetworkEventCallback=e,this._netWorkEventsPromise},e.prototype._buildNetworkEventsErrorMessage=function(e){var t=e._data._status===o.HTTP_BAD_REQUEST?p.Services.Call.CallError.INVALID_ACCEPTED_EVENTS:p.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_FAILED;return new p.Services.Call.CallException(t,o.HTTP,e._data._status,e._data._responseText)},e.prototype._validateEventsInResponse=function(t,i){t.subscribedEvents.events||(t.subscribedEvents.events=[]);var e=i.acceptedEvents.events.filter(function(e){return i.acceptedEvents.excludedEvents.indexOf(e)<0});0<(e=e.filter(function(e){return t.subscribedEvents.events.indexOf(e)<0})).length&&"*"!==e[0]&&p.Base.Logger.warn(p.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Some events couldn't be subscribed: "+JSON.stringify(e))},e.prototype.isNetworkEventsUrlDefined=function(){return this._csgProvider.isNetworkEventsUrlDefined()},e.prototype.removeOnNetworkEvents=function(e){return this._removeNetWorkEventsPromise=S.Deferred(),this._csgProvider.removeOnNetworkEvents(e).then(function(e){this._onNetworkEventCallback=T,this._removeNetWorkEventsPromise.resolve(e)}.bind(this),function(e){this._removeNetWorkEventsPromise.reject(e)}.bind(this)),this._removeNetWorkEventsPromise.promise()},e.prototype.networkEventNotification=function(e){this._onNetworkEventCallback(e)},e.prototype._sendPendingNotifications=function(){var t=this._notificationQueue.shift();t&&this._csgProvider.sendNotification(t.data,t.options).then(function(){this._sendPendingNotifications()}.bind(this),function(e){this._notificationQueue.unshift(t)})},e.prototype._updateGatewayCapabilities=function(e){e&&e.updatecallpropertiesCapability&&(this._isSupportUpdateCallProperties=e.updatecallpropertiesCapability.allowed)},p.Providers.CallServiceGateway.CSGCallsProvider=e}(AvayaClientServices),function(o){"use strict";var i=o.Providers.CallServiceGateway.ObservableEvents,r=o.Providers.CallServiceGateway.Constants;function e(e,t){o.Base.Observable.call(this),this._csgProvider=e,this._messageBuilder=t,this._started=!1,this._subscriptionStatusUnknown=!1,this._presenceContainer=T,this._presenceContainerExpirationDate=T,this._presenceContainerRefreshTimeoutId=T,this._subscribePresenceTimeoutId=T,this._addressSubscriptionTimeoutId=T,this._userSubscriptions=[],this._subscriptionsDeferredMap={},this._unsubscriptionsDeferredMap={},this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._subscribedForPresence=!1,this._deletePresenceContainerPromise=T,this._createOrExtendPresenceContainerPromise=T,this._timeoutForSubscribe=1e3,this._timeoutForUnsubscribe=7e3,this._resuscribeFnRetryInterval=1e3,this._presenceStateAlreadyChanged=!1}(e.prototype=Object.create(o.Providers.Interfaces.PresenceProvider.prototype)).start=function(e){if(this._started)return S.Deferred().resolve();var t=S.Deferred();this._onNetworkAvailable&&this._onNetworkUnavailable||(this._onNetworkAvailable=function(){o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is available. Subscribing for notifications"),this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]?this._subscribeForNotifications().then(function(){var e=new o.Providers.CallServiceGateway.ServiceActivationParameters(!0);return this._csgProvider.activateService(r.PRESENCE,e).then(function(e){try{var t=JSON.parse(e);t.presenceData&&t.presenceData.presenceHandle?this.trigger(o.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,[t.presenceData.presenceHandle]):o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error parsing presence activation response")}catch(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error parsing presence activation response")}}.bind(this))}.bind(this)).then(function(){0<this._userSubscriptions.length?this.subscribeForPresence(this._userSubscriptions).always(function(){t.resolve()}):t.resolve(),this._started=!0,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this),function(e){t.reject(e)}):(o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription URL is not found. Cannot subscribe for presence notifications."),t.reject(new o.Services.Presence.PresenceError(o.Services.Presence.PresenceErrorReason.UNSUPPORTED))),t.state()!==o.Base.DeferredStates.PENDING&&this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this),this._onNetworkUnavailable=function(){o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSG presence provider is unavailable"),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this),this._csgProvider.on(i.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._csgProvider.on(i.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._csgProvider.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._csgProvider.on(o.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)));e=this._csgProvider.start(e.sgConfiguration).then(function(){if(!this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions])return this._started=!1,o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence is not supported for this user"),S.Deferred().reject(new o.Services.Presence.PresenceError(o.Services.Presence.PresenceErrorReason.UNSUPPORTED))}.bind(this));return S.when(e,t).then(function(){this._started=!0}.bind(this))},e.prototype.stop=function(){if(!this._started)return S.Deferred().resolve().promise();var t=S.Deferred(),e=function(){this._started=!1,this._presenceContainer=T,this._onNetworkAvailable=T,this._onNetworkUnavailable=T}.bind(this),i=function(){return this._csgProvider.stop().always(function(){e(),this._removeListeners()}.bind(this)).then(function(){t.resolve()},function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to stop CSGPresenceProvider",e),t.reject(e)})}.bind(this),a=function(){return clearTimeout(this._presenceContainerRefreshTimeoutId),clearTimeout(this._subscribePresenceTimeoutId),clearTimeout(this._addressSubscriptionTimeoutId),this._csgProvider.deactivateService(r.PRESENCE)}.bind(this);return this._csgProvider.isNetworkAvailable()?this._unsubscribeFromNotifications().always(function(){this.unsubscribeFromAllAddressesPresence().always(function(){a().always(function(){i()}.bind(this))}.bind(this))}.bind(this)):i(),t.promise()},e.prototype._subscribeForNotifications=function(){var e=this._messageBuilder.buildSubscribeRequest(o.Providers.CallServiceGateway.Constants.SVC_PRESENCE,this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]),e=this._csgProvider.subscribeForNotifications(e,this._onNotification.bind(this)).then(function(){o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed for presence notifications")},function(e){return o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for presence notifications",e),S.Deferred().reject(e).promise()}.bind(this));return o.Base.Utils.rejectIfPromiseNotResolvedInTime(e,3e4,new o.Services.Presence.PresenceError(o.Services.Presence.PresenceErrorReason.TIMEOUT),function(){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription confirmation was not received in time"),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this))},e.prototype._unsubscribeFromNotifications=function(){var e=this._messageBuilder.buildUnsubscribeRequest(o.Providers.CallServiceGateway.Constants.SVC_PRESENCE,this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]);return this._csgProvider.unsubscribeFromNotifications(e).then(function(){o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unsubscribed from presence notifications")},function(e){return o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from presence notifications: "+JSON.stringify(e)),S.Deferred().reject(e).promise()}.bind(this))},e.prototype._onNotification=function(e){if(o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received notification",e),e&&e.rlPresenceUpdatedEvent){var t;try{t=JSON.parse(e.rlPresenceUpdatedEvent)}catch(e){return void o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to parse notification",e)}this._onPresenceUpdatedEvent(t)}},e.prototype._onPresenceUpdatedEvent=function(e){e.serviceContainerEvent&&e.serviceContainerEvent.terminatedResources?this._handleTerminatedResources(e.serviceContainerEvent.terminatedResources):e.presentities&&0!==e.presentities.length?e.presenceDocuments?e.presenceDocuments.forEach(this._processPresenceDocument.bind(this)):e.presentities&&e.presentities.forEach(this._processPresentities.bind(this)):o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received empty presence updated notification")},e.prototype._handleTerminatedResources=function(e){o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Handling terminated resources  error"),e.container?(o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to resource error",e.container.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*e.container.retryAfter)):e.presenceSubscription?(o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to subscription resource error",e.presenceSubscription.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*e.presenceSubscription.retryAfter)):e.presencePublication&&(o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to publication resource error",e.presencePublication.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*e.presencePublication.retryAfter))},e.prototype._processPresenceDocument=function(e){var t=o.Base.Utils,i=o.Providers.CallServiceGateway.Utils,a=t.queryJSONObject(e,"presenceDoc.userIdentity.userId").replace("pres:","");o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Processing presence document for User ID",a);var r=this._subscriptionsDeferredMap[a];if(r)r.resolve(),delete this._subscriptionsDeferredMap[a],-1===this._userSubscriptions.indexOf(a)&&this._userSubscriptions.push(a);else if(-1===this._userSubscriptions.indexOf(a))return void o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscription list does not include address "+a+", the presence information for this user will be ignored.");var s=new o.Services.Presence.Presence(a),r=t.queryJSONObject(e,"presenceSummary.stateEnum");s._setOverallState(i.convertCSGPresenceStateToPresenceState(r));r=t.queryJSONObject(e,"manualState.stateEnum");s._setManualState(i.convertCSGPresenceStateToPresenceState(r));r=t.queryJSONObject(e,"mode.modeEnum");s._setLocationMode(i.convertCSGPresenceModeToPresenceMode(r)),s._setNote(t.queryJSONObject(e,"note.content"));r=e.channelPresence[0],e=t.queryJSONObject(r,"video.stateEnum");s._setVideoState(i.convertCSGPresenceStateToPresenceState(e)),s._setVideoContact(t.queryJSONObject(r,"video.contact"));e=t.queryJSONObject(r,"phone.stateEnum");s._setPhoneState(i.convertCSGPresenceStateToPresenceState(e)),s._setPhoneContact(t.queryJSONObject(r,"phone.contact"));e=t.queryJSONObject(r,"im.stateEnum");s._setEnterpriseIMState(i.convertCSGPresenceStateToPresenceState(e)),s._setEnterpriseIMContact(t.queryJSONObject(r,"im.contact"));e=t.queryJSONObject(r,"calendar.stateEnum");s._setCalendarState(i.convertCSGPresenceStateToPresenceState(e));e=t.queryJSONObject(r,"calendar.compoundFrom");e&&s._setCalendarStartTime(new Date(e));r=t.queryJSONObject(r,"calendar.compoundUntil");r&&s._setCalendarEndTime(new Date(r)),o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received presence status of "+a),setTimeout(function(){this.trigger(o.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,[s])}.bind(this),0)},e.prototype._processPresentities=function(e){var t=o.Base.Utils,i=t.queryJSONObject(e,"userIdentity.userId");"terminated"!==t.queryJSONObject(e,"status")||(e=this._subscriptionsDeferredMap[i])&&(o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription terminated. Provided address might be invalid.",i),e.reject(new o.Services.Presence.PresenceError(o.Services.Presence.PresenceErrorReason.INVALID_REQUEST)),delete this._subscriptionsDeferredMap[i])},e.prototype.subscribeForSingleAddressPresence=function(e){var t=this._subscriptionsDeferredMap[e];return t||(t=S.Deferred(),this._subscriptionsDeferredMap[e]=t,this._sendSubscribeRequest()),t.promise()},e.prototype.subscribeForPresence=function(e){return e.forEach(function(e){this._subscriptionsDeferredMap[e]||(this._subscriptionsDeferredMap[e]=S.Deferred())}.bind(this)),this._sendSubscribeRequest()},e.prototype._sendSubscribeRequest=function(){return Object.keys(this._subscriptionsDeferredMap).forEach(function(e){this._unsubscriptionsDeferredMap[e]&&(this._unsubscriptionsDeferredMap[e].reject(),delete this._unsubscriptionsDeferredMap[e])}.bind(this)),this._dfdPresenceSubscription||(this._dfdPresenceSubscription=S.Deferred(),this._subscribePresenceTimeoutId=setTimeout(function(){var e=this._dfdPresenceSubscription;this._dfdPresenceSubscription=T;var i=Object.keys(this._subscriptionsDeferredMap);i.length&&this._updatePresenceSubscription(r.SUBSCRIPTION_ADD,i).done(function(){this._subscribedForPresence=!0,this._userSubscriptions=this._userSubscriptions.concat(i),e.resolve()}.bind(this)).fail(function(t){i.forEach(function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for "+e+" presence",t),this._subscriptionsDeferredMap[e].reject(t),delete this._subscriptionsDeferredMap[e]}.bind(this)),e.reject(t)}.bind(this))}.bind(this),this._timeoutForSubscribe)),this._dfdPresenceSubscription.promise()},e.prototype.unsubscribeFromSingleAddressPresence=function(e){var t=this._unsubscriptionsDeferredMap[e];return t||(t=S.Deferred(),this._unsubscriptionsDeferredMap[e]=t,this._sendUnsubscribeRequest()),t.promise()},e.prototype.unsubscribeFromPresence=function(e){return e.forEach(function(e){this._unsubscriptionsDeferredMap[e]||(this._unsubscriptionsDeferredMap[e]=S.Deferred())}.bind(this)),this._sendUnsubscribeRequest()},e.prototype._sendUnsubscribeRequest=function(){return Object.keys(this._unsubscriptionsDeferredMap).forEach(function(e){this._subscriptionsDeferredMap[e]&&(this._subscriptionsDeferredMap[e].reject(),delete this._subscriptionsDeferredMap[e])}.bind(this)),this._dfdPresenceUnsubscription||(this._dfdPresenceUnsubscription=S.Deferred(),setTimeout(function(){var e=this._dfdPresenceUnsubscription;this._dfdPresenceUnsubscription=T;var i=Object.keys(this._unsubscriptionsDeferredMap);i.length&&this._updatePresenceSubscription(r.SUBSCRIPTION_REMOVE,i).then(function(){this._userSubscriptions=this._userSubscriptions.filter(function(e){return-1===i.indexOf(e)}),0===this._userSubscriptions.length&&(this._subscribedForPresence=!1),i.forEach(function(e){this._unsubscriptionsDeferredMap[e].resolve(),delete this._unsubscriptionsDeferredMap[e]}.bind(this)),e.resolve()}.bind(this),function(t){i.forEach(function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from "+e+" presence",t),this._unsubscriptionsDeferredMap[e].reject(t),delete this._unsubscriptionsDeferredMap[e]}.bind(this)),e.reject(t)}.bind(this))}.bind(this),this._timeoutForUnsubscribe)),this._dfdPresenceUnsubscription.promise()},e.prototype.unsubscribeFromAllAddressesPresence=function(){return 0===this._userSubscriptions.length?S.Deferred().resolve():this._updatePresenceSubscription(r.SUBSCRIPTION_REMOVE,this._userSubscriptions).then(function(){this._userSubscriptions=[],this._subscribedForPresence=!1}.bind(this))},e.prototype._updatePresenceSubscription=function(i,a){o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Updating presence subscriptions list",[i,a]);var t=S.Deferred(),e=function(e){this._onSubscriptionSucceeded(),t.resolve(e)}.bind(this),r=function(e){o.Base.Utils.queryJSONObject(e,"_data._status")===o.Base.NetworkErrorCodes.HTTP_SERVICE_UNAVAILABLE?setTimeout(function(){this._onSubscriptionFailed(),n()}.bind(this),0):t.reject(e)}.bind(this),s=function(e){e===o.Base.NetworkProviderEvents.RETRYING&&this._onSubscriptionFailed()}.bind(this),n=function(){this._getContainerAndSend(function(e){var t=this._messageBuilder.buildPresenceSubscriptionData(i,a),e=this._messageBuilder.buildPresenceSubscriptionOptions(e.additionalResources.presenceSubscriptions[0].replace.href);return this._csgProvider.send(t,e)}.bind(this)).done(e).fail(r).progress(s)}.bind(this);return n(),t.promise()},e.prototype._onSubscriptionFailed=function(){this._subscriptionStatusUnknown||(this._subscriptionStatusUnknown=!0,this._userSubscriptions.forEach(function(e){e=this._buildUnknownPresence(e);this.trigger(o.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,[e])}.bind(this)))},e.prototype._onSubscriptionSucceeded=function(){var e,t;this._subscriptionStatusUnknown&&(this._subscriptionStatusUnknown=!1,0<this._userSubscriptions.length&&(e=this._userSubscriptions.slice(0),t=function(){return this.unsubscribeFromAllAddressesPresence().then(function(){this.subscribeForPresence(e)}.bind(this))}.bind(this),o.Base.Utils.connectionBackoffAlgorithm(t,T,this._resuscribeFnRetryInterval)))},e.prototype.publishAutomaticPresence=function(i){return this._getContainerAndSend(function(e){var t=e.additionalResources.presencePublication.replace.href,e=this._messageBuilder.buildPublishPresenceOptions(t),t=this._messageBuilder.buildPublishAutoPresenceData(i);return this._csgProvider.send(t,e)}.bind(this))},e.prototype.publishManualState=function(e){var t,i,a;return this._presenceStateAlreadyChanged||(this.publishOfflineManualState(),this._presenceStateAlreadyChanged=!0),e&&e!==o.Services.Presence.PresenceState.PRESENCE_STATE_UNSPECIFIED?(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PublishPresenceState],t=this._messageBuilder.buildPublishPresenceOptions(a),i=this._messageBuilder.buildPublishManualPresenceData(r.MANUAL_STATE,e)):(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.DeletePresenceState],t=this._messageBuilder.buildDeleteManualPresenceOptions(a)),this._getContainerAndSend(function(){return this._csgProvider.send(i,t)}.bind(this))},e.prototype.publishOfflineManualState=function(){var e=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PublishPresenceState],t=this._messageBuilder.buildPublishPresenceOptions(e),i=this._messageBuilder.buildPublishManualPresenceData(r.MANUAL_STATE,o.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE);return this._getContainerAndSend(function(){return this._csgProvider.send(i,t)}.bind(this))},e.prototype.publishLocationMode=function(e){var t,i,a;return e&&e!==o.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_UNSPECIFIED?(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PublishPresenceMode],t=this._messageBuilder.buildPublishPresenceOptions(a),i=this._messageBuilder.buildPublishManualPresenceData(r.MODE,e)):(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.DeletePresenceMode],t=this._messageBuilder.buildDeleteManualPresenceOptions(a)),this._getContainerAndSend(function(){return this._csgProvider.send(i,t)}.bind(this))},e.prototype.publishNote=function(e){var t,i,a;return e&&""!==e?(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.PublishPresenceNote],t=this._messageBuilder.buildPublishPresenceOptions(a),i=this._messageBuilder.buildPublishManualPresenceData(r.NOTE,e)):(a=this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.DeletePresenceNote],t=this._messageBuilder.buildDeleteManualPresenceOptions(a)),this._getContainerAndSend(function(){return this._csgProvider.send(i,t)}.bind(this))},e.prototype._getContainerAndSend=function(e){var t=S.Deferred(),i=function(){this._started?this._getPresenceContainer().then(e).then(function(e){t.resolve(e)},function(e){this._onErrorGetPresenceContainer(e).then(function(){setTimeout(i,0)}.bind(this),function(e){t.reject(e)}.bind(this))}.bind(this),function(e){t.notify(e)}):t.reject("Presence service has NOT started")}.bind(this);return i(),t.promise()},e.prototype._onErrorGetPresenceContainer=function(e){var t=S.Deferred();this._createOrExtendPresenceContainerPromise=T;var i=o.Base.Utils.queryJSONObject(e,"_data._status");if(i===o.Base.NetworkErrorCodes.HTTP_NOT_FOUND||i===o.Base.NetworkErrorCodes.HTTP_BAD_REQUEST||i===o.Base.NetworkErrorCodes.HTTP_UNPROCESSABLE_ENTITY)switch(this._parseErrorCode(e.getData().getResponseText())){case 404001:case 4000004:return o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence container expired/invalidated"),this._recreatePresenceContainer();case 4040012:return o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription is unknown"),o.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presenceSubscriptions[0]")&&(this._presenceContainer.additionalResources.presenceSubscriptions[0]=T),t.resolve().promise();case 4040011:case 4220085:return o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence session is invalid"),this._createContainerAndSubscribe()}return t.reject(e).promise()},e.prototype._recreatePresenceContainer=function(){return this._deletePresenceContainer().then(this._createContainerAndSubscribe.bind(this))},e.prototype._createContainerAndSubscribe=function(){return this._presenceContainer=T,this._createOrExtendPresenceContainer(!0,!0).then(function(){this.subscribeForPresence(this._userSubscriptions)}.bind(this))},e.prototype._parseErrorCode=function(e){var t,i,a;try{0<e.length&&("object"==(a=typeof(i=JSON.parse(e)))?t=o.Base.Utils.queryJSONObject(i,"error[0].errorCode"):"string"==a&&(i=JSON.parse(i),t=o.Base.Utils.queryJSONObject(i,"error[0].serviceErrorCode")))}catch(e){o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to parse error response",e)}return t},e.prototype._getPresenceContainer=function(){var e=!1,t=!1;if(this._presenceContainer){if(Date.now()<this._presenceContainerExpirationDate.getTime()&&(e=!o.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presenceSubscriptions[0]"),t=!o.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presencePublication"),!e&&!t))return o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Current presence subscription container should be valid, using it"),S.Deferred().resolve(this._presenceContainer)}else e=t=!0;return this._createOrExtendPresenceContainer(t,e)},e.prototype._createOrExtendPresenceContainer=function(e,t){var i,a;return this._createOrExtendPresenceContainerPromise||(i=S.Deferred(),a=o.Base.Utils.queryJSONObject(this._presenceContainer,"containerResources.container.updateOrExtend.href")||this._csgProvider.getResourceHrefs()[o.Providers.CallServiceGateway.ResourceType.CreatePresenceContainer],o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Creating/updating presence container. Container exists: "+!!this._presenceContainer+", Publication resource needed: "+e+", Subscription resource needed: "+t),this._createOrExtendPresenceContainerPromise=i.promise(),a=this._messageBuilder.buildCreatePubSubContainerOptions(a),t=this._messageBuilder.buildCreateOrExtendPubSubContainerData(!!this._presenceContainer,e,t),this._csgProvider.send(t,a).then(function(e){if(this._presenceContainer=this._parsePresenceContainerResponse(e)||this._presenceContainer,!this._presenceContainer)return S.Deferred().reject(new o.Services.Presence.PresenceError(o.Services.Presence.PresenceErrorReason.INVALID_RESPONSE,"Received invalid response from server to create presence container request"));this._presenceContainerRefreshTimeoutId=setTimeout(this._createOrExtendPresenceContainer.bind(this),.8*this._presenceContainer.expires*1e3),this._createOrExtendPresenceContainerPromise=T,i.resolve(this._presenceContainer)}.bind(this),function(e){this._createOrExtendPresenceContainerPromise=T,i.reject(e)}.bind(this))),this._createOrExtendPresenceContainerPromise},e.prototype._deletePresenceContainer=function(){var e,t,i;return this._deletePresenceContainerPromise||(o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Deleting presence container"),e=S.Deferred(),i=o.Base.Utils.queryJSONObject(this._presenceContainer,"containerResources.container.delete.href"),this._deletePresenceContainerPromise=e.promise(),t=function(){this._presenceContainer=T,this._deletePresenceContainerPromise=T,e.resolve(),o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Deleted presence container")}.bind(this),i?(i=this._messageBuilder.buildDeletePubSubContainerOptions(i),this._csgProvider.send(T,i).then(t,t)):t()),this._deletePresenceContainerPromise},e.prototype._parsePresenceContainerResponse=function(e){var t;try{t=JSON.parse(e)}catch(e){}if(t&&t.pubSubContainer){var i=S.extend(new o.Providers.CallServiceGateway.CSGPresenceContainer,t.pubSubContainer);if(!!(i.expires&&i.containerResources.container.updateOrExtend.href&&i.additionalResources.presencePublication.replace.href&&i.additionalResources.presenceSubscriptions[0].replace.href))return this._presenceContainerExpirationDate=new Date(Date.now()+1e3*i.expires),i}},e.prototype._buildUnknownPresence=function(e){e=new o.Services.Presence.Presence(e);return e._setOverallState(o.Services.Presence.PresenceState.PRESENCE_STATE_UNKNOWN),e._setManualState(o.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNKNOWN),e._setVideoState(o.Services.Presence.VideoPresenceState.PRESENCE_STATE_UNKNOWN),e._setVideoContact(T),e._setPhoneState(o.Services.Presence.PhonePresenceState.PRESENCE_STATE_UNKNOWN),e._setPhoneContact(T),e._setEnterpriseIMState(o.Services.Presence.IMPresenceState.PRESENCE_STATE_UNKNOWN),e._setEnterpriseIMContact(T),e._setCalendarState(o.Services.Presence.CalendarPresenceState.PRESENCE_STATE_UNKNOWN),e._setCalendarStartTime(T),e._setCalendarEndTime(T),e},e.prototype.activateService=function(e,t){e.toUpperCase()===r.PRESENCE&&o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence activation status: "+t)},o.Providers.CallServiceGateway.CSGPresenceProvider=e}(AvayaClientServices),function(s){"use strict";function e(e,t){s.Providers.Interfaces.AbstractProvider.call(this),this._callProvider=e,this._ownerCallId=t,this._isVideoAllowed=!1;t=this._callProvider.lookupCall(this._ownerCallId);t&&(t=t._callService.getVideoCapability(),this._isVideoAllowed=t.isAllowed,t.addOnChangedCallback(this._monitorVideoCapability.bind(this)))}(e.prototype=Object.create(s.Providers.Interfaces.AbstractProvider.prototype)).start=function(e,t){return e._isVideoAllowed=this._isVideoAllowed,e._recalculateInConferenceChatCapability(),s.Base.Logger.info(s.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"started..."),S.Deferred().resolve()},e.prototype.stop=function(){var e=this._callProvider.lookupCall(this._ownerCallId);return e&&e._callService.getVideoCapability().removeOnChangedCallback(this._monitorVideoCapability.bind(this)),s.Base.Logger.info(s.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"stopped..."),S.Deferred().resolve()},e.prototype._monitorVideoCapability=function(e){this._isVideoAllowed=e.isAllowed},e.prototype.observeConference=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"observeConference method is not implemented"))},e.prototype.disconnectParticipant=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"disconnectParticipant method is not implemented"))},e.prototype.setAsLecturer=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setAsLecturer method is not implemented"))},e.prototype.setLocked=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setLocked method is not implemented"))},e.prototype.setVideoLayoutTextOverlay=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayoutTextOverlay method is not implemented"))},e.prototype.setVideoLayoutSelfSee=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayoutSelfSee method is not implemented"))},e.prototype.setVideoLayout=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayout method is not implemented"))},e.prototype.terminateConference=function(){return s.Base.Logger.info(s.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"terminated..."),S.Deferred().resolve()},e.prototype.removeLastParticipant=function(){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"removeLastParticipant method is not implemented"))},e.prototype.requestToBecomeModerator=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"requestToBecomeModerator method is not implemented"))},e.prototype.signIn=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"signIn method is not implemented"))},e.prototype.changeParticipantName=function(e,t){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"changeParticipantName method is not implemented"))},e.prototype.videoPin=function(e,t,i,a,r){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"videoPin method is not implemented"))},e.prototype.extendMeeting=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"extendMeeting method is not implemented"))},e.prototype.addParticipant=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"addParticipant method is not implemented"))},e.prototype.addParticipantFromCall=function(e){return this._callProvider.addParticipantFromCall(this._ownerCallId,e)},e.prototype.cancelDialoutParticipant=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"cancelDialoutParticipant method is not implemented"))},e.prototype.startRecording=function(e,t,i){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"startRecording method is not implemented"))},e.prototype.stopRecording=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"stopRecording method is not implemented"))},e.prototype.pauseRecording=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"pauseRecording method is not implemented"))},e.prototype.resumeRecording=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"resumeRecording method is not implemented"))},e.prototype.unsetAsLecturer=function(){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"unsetAsLecturer method is not implemented"))},e.prototype.controlRemoteCamera=function(e,t){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"controlRemoteCamera method is not implemented"))},e.prototype.muteUnmute=function(e,t,i){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"muteUnmute method is not implemented"))},e.prototype.sendChatMessage=function(e,t){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"sendChatMessage method is not implemented"))},e.prototype.muteUnmuteAll=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"muteUnmuteAll method is not implemented"))},e.prototype.raiseLowerHand=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"raiseLowerHand method is not implemented"))},e.prototype.moderatorLowerHand=function(e,t){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"moderatorLowerHand method is not implemented"))},e.prototype.getDialInInfo=function(){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"getDialInInfo method is not implemented"))},e.prototype.sendDisconnectEvent=function(e){return S.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"sendDisconnectEvent method is not implemented"))},e.prototype.recalculateAddParticipantFromCallCapability=function(e,t){var i,a=this._callProvider.lookupCall(this._ownerCallId),a=a&&a.getState()===s.Services.Call.CallStates.ESTABLISHED&&(!t.isConference()||!a.getConference()._isAvailable||a.getConference()._getType()!==t.getConference()._getType())?(i=!0,s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(i=!1,s.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);e._addParticipantFromCallCapabilities[t.getCallId()]._updateIfChanged(i,a)},e.prototype.recalculateAddParticipantFromCallCapabilityByCallId=function(e,t){t=this._callProvider.lookupCall(t);t&&this.recalculateAddParticipantFromCallCapability(e,t)},e.prototype.sendLocalMuteEvent=function(e,t){return S.Deferred().resolve().promise()},s.Providers.CM.CMConferenceProvider=e}(AvayaClientServices),function(n){"use strict";var o={1:{colorLimit:32,jpegQuality:.35},2:{colorLimit:32,jpegQuality:.4},3:{colorLimit:32,jpegQuality:.5},4:{colorLimit:64,jpegQuality:.5},5:{colorLimit:64,jpegQuality:.6},6:{colorLimit:64,jpegQuality:.7},7:{colorLimit:128,jpegQuality:.7},8:{colorLimit:128,jpegQuality:.8},9:{colorLimit:256,jpegQuality:.9},10:{colorLimit:256,jpegQuality:1}};function e(e,t,i,a,r,s){n.Providers.Interfaces.AbstractProvider.call(this),this._collaborationProvider=e,this._screenCapturer=t,this._shareApplicationWindowCapability=new n.Base.Capability(n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareFullScreenCapability=new n.Base.Capability(n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareAnyTypeCapability=new n.Base.Capability(n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareContentVideoCapability=new n.Base.Capability(n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingTagBuilder=i,this._bandwidthManager=a,this._screenSharingTagEncoder=r,this._startDeferred=T,this._isCapturing=!1,this._isAcksActivated=!0,this._isFirstSendFrameCall=!0,this._browser=n.Base.Utils.getBrowserType(),this._config=s,this._outgoingScreenSharingStream=T,this._outgoingCapturedStream=T,this._outgoingVideoSharingStream=T,this._maxUploadSpeed=T,this._screenCapturerEndedCallback=T,this._config&&n.Base.Utils.isDefined(this._config.imageQuality)?this.setImageQuality(this._config.imageQuality):this.setImageQuality(1),this._contentSharingTagBuilder&&this._contentSharingTagBuilder.setJpegImageQuality&&this._contentSharingTagBuilder.setJpegImageQuality(o[this._imageQuality].jpegQuality)}(e.prototype=Object.create(n.Providers.Interfaces.AbstractProvider.prototype)).start=function(){this._updateToFeatureSuportedCapabilities()},e.prototype._updateToFeatureSuportedCapabilities=function(){this._turnCapabilities(n.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable(),n.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable(),n.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable(),n.Providers.ContentSharing.FeatureSupported.isSharingContentVideoAvailable())},e.prototype.stop=function(){this._turnCapabilities(!1,!1,!1,!1)},e.prototype._turnCapabilities=function(e,t,i,a){this._turnCapability(this._shareApplicationWindowCapability,e),this._turnCapability(this._shareFullScreenCapability,t),this._turnCapability(this._shareAnyTypeCapability,i),this._turnCapability(this._shareContentVideoCapability,a)},e.prototype._turnCapability=function(e,t){var i=t?n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:n.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED;e._updateIfChanged(t,i)},e.prototype.setExtensionAvailable=function(e){n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+" doesn't support third-party extensions for screen sharing")},e.prototype.isDisplayMediaAvailable=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},e.prototype.startScreenSharing=function(){return this._screenCapturer.on(n.Providers.ContentSharing.ScreenCapturerEvents.BLOCKS_CHANGED,function(e,t,i){this.sendFrame(e,t,i)}.bind(this)),this._screenCapturer.on(n.Providers.ContentSharing.ScreenCapturerEvents.WINDOW_CLOSED,function(){this._screenCapturerEndedCallback&&this._screenCapturerEndedCallback(this)}.bind(this)),this._updateServerCapabilities=function(e){this._screenCapturer.setServerCapabilities(e)}.bind(this),this._collaborationProvider.on(n.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities),this._startScreenSharing()},e.prototype.setScreenCapturerEndedHandler=function(e){this._screenCapturerEndedCallback=e},e.prototype.sendFrame=function(e,t,i){this._isFirstSendFrameCall&&(this._isAcksActivated=this._collaborationProvider.getAcksActivated(),this._bandwidthManager.setAcksActivated(this._isAcksActivated),this._isFirstSendFrameCall=!1);var a=(new Date).getTime(),r=new n.Providers.ContentSharing.FrameBlocks(t),t=this._contentSharingTagBuilder.createStartTag(t,t?this._screenCapturer.getWidth():0,t?this._screenCapturer.getHeight():0,this._isAcksActivated),t=this._screenSharingTagEncoder.encodeTag(t);r.addBlock(t),e.forEach(function(e){e=this._contentSharingTagBuilder.createBlockTag(e,this._isAcksActivated),e=this._screenSharingTagEncoder.encodeTag(e);r.addBlock(e)}.bind(this)),r.addBlock(this._screenSharingTagEncoder.encodeTag(this._contentSharingTagBuilder.createEndTag(this._isAcksActivated)));e=(new Date).getTime();r.processingTime=i,this._bandwidthManager.addToEncodingTimes(e-a),this._bandwidthManager.addToQueue(r)},e.prototype.startFullScreen=function(e){throw n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"MUST override AbstractScreenSharingProvider.startFullScreen(mediaSourceId)"),new Error("Cannot start fullscreen sharing. Unknown provider.")},e.prototype.startApplicationWindow=function(e){throw n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"MUST override AbstractScreenSharingProvider.startApplicationWindow(mediaSourceId)"),new Error("Cannot start window sharing. Unknown provider.")},e.prototype.startSharingAnyType=function(e){return this._startDeferred=S.Deferred(),!0===this._shareAnyTypeCapability.isAllowed?(n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start sharing..."),e?this._onRetrievingStreamSucceeded(e):this._getDisplayMedia(),this._startDeferred.promise()):(n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": An attempt to start sharing any type - failed"),this._startDeferred.reject(n.Base.Utils.getBrowserName()+' doesn\'t support this method. Use "startApplicationWindow or "startFullScreen" instead').promise())},e.prototype.startCapture=function(){var t=S.Deferred();if(!this._shareAnyTypeCapability.isAllowed)return n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": An attempt to start capture - failed"),t.reject(n.Base.Utils.getBrowserName()+' doesn\'t support this method. Use "startApplicationWindow or "startFullScreen" instead').promise();n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start capturing...");var e=this._shareApplicationWindowCapability.isAllowed,i=this._shareFullScreenCapability.isAllowed,a=this._shareAnyTypeCapability.isAllowed,r=this._shareContentVideoCapability.isAllowed;return this._turnCapabilities(!1,!1,!1,!1),navigator.mediaDevices.getDisplayMedia({}).then(function(e){this.clearOutgoingCapturedStream(),this._outgoingCapturedStream=e,this._isCapturing=!0,t.resolve(e)}.bind(this)).catch(function(e){t.reject(e)}.bind(this)).finally(this._turnCapabilities.bind(this,e,i,a,r)),t.promise()},e.prototype.startSharingWithVideo=function(e,t,i){var a,r;return this._startDeferred=S.Deferred(),!0===this._shareContentVideoCapability.isAllowed?(t?(n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start video content sharing through electron app. Share audio = "+i),r={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:30}}},a={},a=i?n.Base.Utils.deepMerge({audio:{mandatory:{echoCancellation:!0,chromeMediaSource:"desktop"}}},r):n.Base.Utils.deepMerge({audio:!1},r),this._getUserMediaForSharingUsingVideo(a,e)):(n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start video content sharing..."),r=e.getNegotiatedVideoResolution(),r={video:{frameRate:{max:30},height:{ideal:a=Math.min(720,r.getHeight()),max:a},width:{ideal:r=Math.min(1280,r.getWidth()),max:r}},audio:{echoCancellation:!0,autoGainControl:!1}},this._getDisplayMediaFromBrowser(r).then(this._onRetrievingContentVideoStreamSuccess.bind(this,e)).catch(function(e){var t="Failed to retrieve stream: ";return e&&e.message&&(t+=e.message),n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": getDisplayMedia failed with Error: "+t),this._startDeferred.reject(e)}.bind(this))),this._startDeferred.promise()):(n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": An attempt to start sharing any type - failed"),this._startDeferred.reject(n.Base.Utils.getBrowserName()+' doesn\'t support this method. Use "startApplicationWindow or "startFullScreen" instead').promise())},e.prototype.updateAudioSourceForVideoSharing=function(e,t){return e.updateAudioSourceForVideoSharing(t)},e.prototype._onRetrievingContentVideoStreamSuccess=function(e,t){e.setVideoSharingStream(t),this._outgoingVideoSharingStream=new MediaStream,t.getVideoTracks().forEach(function(e){this._outgoingVideoSharingStream.addTrack(e)}.bind(this)),n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start content video ... callId ="+e._callId);var i=function(e){n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e),t.getTracks().forEach(function(e){e.stop()}),this._startDeferred.reject(e)}.bind(this);this._collaborationProvider.startVideoSharing().then(function(){e.sendContentVideoSharingStream(t).then(function(){this._startDeferred.resolve(t),n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Start content video success.")}.bind(this),function(e){i(e)}.bind(this))}.bind(this),function(e){i(e)})},e.prototype.stopSharingWithVideo=function(t,e,i){n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Stop content video ... callId ="+e),this.clearOutgoingVideoSharingStream();var a=S.Deferred(),r=function(e){t.stopContentVideoSharing(e).then(function(){n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Stop content video success."),a.resolve()}.bind(this),function(e){n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e),a.reject(e)}.bind(this)).always(function(){if(this._updateServerCapabilities){try{this._collaborationProvider.off(n.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities)}catch(e){n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e)}this._updateServerCapabilities=T}}.bind(this))}.bind(this);return!0===i?this._collaborationProvider.stopVideoSharing().then(function(){r(e)}.bind(this),function(e){n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e),a.reject(e)}):r(e),a.promise()},e.prototype.stopScreenSharing=function(e){return n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,n.Base.Utils.getBrowserName()+": Stop sharing..."),this.clearOutgoingScreenSharingStream(),!0===this.isCapturing()&&this.clearOutgoingCapturedStream(),this.stopScreenCapturer().then(function(){return this._bandwidthManager.stop()}.bind(this)).then(function(){if(!e)return this._stopScreenSharing()}.bind(this)).always(function(){if(this._updateServerCapabilities){try{this._collaborationProvider.off(n.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities)}catch(e){n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e)}this._updateServerCapabilities=T}}.bind(this))},e.prototype.stopScreenCapturer=function(){return this._screenCapturer.stop()},e.prototype.pause=function(){return this._bandwidthManager.pause(),n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Pause sharing..."),this._bandwidthManager.pause(),this._outgoingScreenSharingStream&&this._outgoingScreenSharingStream.getTracks().forEach(function(e){e.enabled=!1}),this._screenCapturer.pause().then(function(e){return e||this._pauseScreenSharing()}.bind(this))},e.prototype.resume=function(){return n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Resume sharing..."),this._bandwidthManager.resume(),this._outgoingScreenSharingStream&&this._outgoingScreenSharingStream.getTracks().forEach(function(e){e.enabled=!0}),this._screenCapturer.resume().then(function(e){return e&&this._startScreenSharing()}.bind(this))},e.prototype.getShareApplicationWindowCapability=function(){return this._shareApplicationWindowCapability},e.prototype.getShareFullScreenCapability=function(){return this._shareFullScreenCapability},e.prototype.getShareAnyTypeCapability=function(){return this._shareAnyTypeCapability},e.prototype.getStartSharingUsingVideoCapability=function(){return this._shareContentVideoCapability},e.prototype.getOutgoingScreenSharingStream=function(){return this._outgoingScreenSharingStream},e.prototype.getOutgoingCapturedStream=function(){return this._outgoingCapturedStream},e.prototype.getOutgoingVideoSharingStream=function(){return this._outgoingVideoSharingStream},e.prototype.isCapturing=function(){return this._isCapturing},e.prototype.isOpened=function(){return this._collaborationProvider.isOpened()},e.prototype.setImageQuality=function(e){e<1||10<e?(n.Base.Logger.warn("Failed to set unsupported image quality:"+e),this._imageQuality||this.setImageQuality(1)):(this._imageQuality=e,n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Selected image quality ["+o[this._imageQuality].colorLimit+", "+o[this._imageQuality].jpegQuality+"]"),this._contentSharingTagBuilder&&this._contentSharingTagBuilder.setJpegImageQuality&&this._contentSharingTagBuilder.setJpegImageQuality(o[this._imageQuality].jpegQuality))},e.prototype.getImageQuality=function(){return this._imageQuality},e.prototype.setScreenSharingVisibleRect=function(e){this._screenCapturer.setScreenSharingVisibleRect(e)},e.prototype.getScreenSharingVisibleRect=function(){return this._screenCapturer.getScreenSharingVisibleRect()},e.prototype.setScreenSharingMasks=function(e){this._screenCapturer.setScreenSharingMasks(e)},e.prototype.getScreenSharingMasks=function(){return this._screenCapturer.getScreenSharingMasks()},e.prototype._startScreenSharing=function(){return this._collaborationProvider.startScreenSharing()},e.prototype._startVideoSharing=function(){return this._collaborationProvider.startVideoSharing()},e.prototype._stopScreenSharing=function(){return this._collaborationProvider.stopScreenSharing()},e.prototype._pauseScreenSharing=function(){return this._collaborationProvider.pauseScreenSharing()},e.prototype.clearOutgoingScreenSharingStream=function(){this._outgoingScreenSharingStream&&(this._outgoingScreenSharingStream.getTracks().forEach(function(e){e.stop()}),this._outgoingScreenSharingStream=T)},e.prototype.clearOutgoingVideoSharingStream=function(){this._outgoingVideoSharingStream&&(this._outgoingVideoSharingStream.getTracks().forEach(function(e){e.stop()}),this._outgoingVideoSharingStream=T)},e.prototype.clearOutgoingCapturedStream=function(){this._outgoingCapturedStream&&(this._outgoingCapturedStream.getTracks().forEach(function(e){e.stop()}),this._outgoingCapturedStream=T)},e.prototype._getDisplayMedia=function(e){var t=n.Base.Utils.deepMerge({},e),i=this._shareApplicationWindowCapability.isAllowed,a=this._shareFullScreenCapability.isAllowed,r=this._shareAnyTypeCapability.isAllowed,e=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),this._getDisplayMediaFromBrowser(t).then(this._onRetrievingStreamSucceeded.bind(this),this._onRetrievingStreamFailed.bind(this)).finally(this._turnCapabilities.bind(this,i,a,r,e))},e.prototype._getDisplayMediaFromBrowser=function(e){return navigator.mediaDevices.getDisplayMedia(e)},e.prototype._getUserMediaForSharingUsingVideo=function(e,t){var i=this._shareApplicationWindowCapability.isAllowed,a=this._shareFullScreenCapability.isAllowed,r=this._shareAnyTypeCapability.isAllowed,s=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),navigator.mediaDevices.getUserMedia(e).then(this._onRetrievingContentVideoStreamSuccess.bind(this,t),this._onRetrievingStreamFailed.bind(this)).finally(this._turnCapabilities.bind(this,i,a,r,s))},e.prototype._getUserMedia=function(e){var t=this._shareApplicationWindowCapability.isAllowed,i=this._shareFullScreenCapability.isAllowed,a=this._shareAnyTypeCapability.isAllowed,r=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),navigator.mediaDevices.getUserMedia(e).then(this._onRetrievingStreamSucceeded.bind(this),this._onRetrievingStreamFailed.bind(this)).finally(this._turnCapabilities.bind(this,t,i,a,r))},e.prototype._onRetrievingStreamSucceeded=function(e){var t=!!this._collaborationProvider._selectedProvider._isShutdown,i=!!this._collaborationProvider._selectedProvider._isScreenSharingActive;!1==t&&!1==i?(this._collaborationProvider._selectedProvider._isScreenSharingActive=!0,this._outgoingScreenSharingStream=e.clone(),e.getTracks().forEach(function(e){e.stop()}),!0===this.isCapturing()&&this.clearOutgoingCapturedStream(),(i=S.extend(new n.Providers.ContentSharing.ScreenCapturerConfig,this._config,this._collaborationProvider.getServerCapabilities())).losslessColorLimit=o[this._imageQuality].colorLimit,this._maxUploadSpeed&&(i.maxBytesPerSecond=this._maxUploadSpeed/8*1e3),this._screenCapturer.isFrameNeeded=this._isFrameNeededCallback.bind(this),this._screenCapturer.start(this._outgoingScreenSharingStream,i,this._browser).then(function(){return this._bandwidthManager.start(this._screenCapturer._config),n.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.startScreenSharing.call(this)}.bind(this)).then(function(){"pending"===this._startDeferred.state()&&this._startDeferred.resolve()}.bind(this),function(e){"pending"===this._startDeferred.state()&&this._startDeferred.reject(e)}.bind(this))):(e.getTracks().forEach(function(e){e.stop()}),this._startDeferred.reject(new Error(t?"Couldn't start screencapture on a shutdowned component":"Couldn't start screencapture, screensharing already active")))},e.prototype._onRetrievingStreamFailed=function(e){var t="Failed to retrieve stream: ";e&&e.message&&(t+=e.message),n.Base.Logger.warn(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,t),"pending"===this._startDeferred.state()&&this._startDeferred.reject(e)},e.prototype._isFrameNeededCallback=function(e){return this._bandwidthManager.isFrameNeeded(e)},e.prototype.setMaxUploadSpeed=function(e){this._bandwidthManager.setMaxUploadSpeed(e),this._maxUploadSpeed=e},e.prototype.getMaxUploadSpeed=function(){return this._maxUploadSpeed},n.Providers.ContentSharing.AbstractScreenSharingProvider=e}(AvayaClientServices),function(c,t){"use strict";function e(e,t,i,a,r,s,n,o){c.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,e,t,i,a,r,s),this._networkProvider=n,this._networkProvider.addOnCapabilityChange(this._capabilityUpdate()),this._extensionRequestBuilder=o,this._mediaSourceId=T}(e.prototype=Object.create(c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).start=function(){this._networkProvider&&this._networkProvider.start(),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.start.call(this)},e.prototype.stop=function(){this._networkProvider&&this._networkProvider.stop(),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.stop.call(this)},e.prototype.setExtensionAvailable=function(e){this._networkProvider.setExtensionAvailable(e)},e.prototype.startFullScreen=function(e,t){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Start full screen sharing..."),this._startDeferred=S.Deferred(),t?this._onRetrievingStreamSucceeded(t):"string"==typeof e?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Using third-party source for screen sharing..."),this._handleMediaAvailableEvent({data:{mediaSourceId:e}})):(this._startEventListener(),this._networkProvider.send(this._extensionRequestBuilder.createStartSharingRequest("screen"))),this._startDeferred.promise()},e.prototype.startApplicationWindow=function(e,t){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Start appl window sharing..."),this._startDeferred=S.Deferred(),t?this._onRetrievingStreamSucceeded(t):"string"==typeof e?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Using third-party source for appl window sharing..."),this._handleMediaAvailableEvent({data:{mediaSourceId:e}})):(this._startEventListener(),this._networkProvider.send(this._extensionRequestBuilder.createStartSharingRequest("window"))),this._startDeferred.promise()},e.prototype.stopScreenSharing=function(e){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Stop sharing..."),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.stopScreenSharing.call(this,e).then(function(){this._networkProvider.send(this._extensionRequestBuilder.createStopSharingRequest(this._mediaSourceId)),this._mediaSourceId=T,this._removeEventListener()}.bind(this))},e.prototype.stopScreenCapturer=function(){return this._removeEventListener(),this._screenCapturer.stop()},e.prototype.isDisplayMediaAvailable=function(){return c.Base.Utils.getBrowserSubType()!==c.Base.BrowserSubType.ELECTRON&&!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},e.prototype._startEventListener=function(){this._networkProvider.addOnMediaAvailableCallback(this._handleMediaAvailableEvent.bind(this)),this._networkProvider.addOnMediaCancelledCallback(this._handleMediaCanceledEvent.bind(this))},e.prototype._removeEventListener=function(){this._networkProvider._onMediaAvailableCallbacks.empty(),this._networkProvider._onMediaCancelledCallbacks.empty()},e.prototype._handleMediaAvailableEvent=function(e){c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"User enabled screen sharing"),this._mediaSourceId=e.data.mediaSourceId;e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this._mediaSourceId,maxWidth:t.screen.width,maxHeight:t.screen.height,maxFrameRate:3}}};this._getUserMedia(e),this._removeEventListener()},e.prototype._handleMediaCanceledEvent=function(e){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,e),this._removeEventListener(),"pending"===this._startDeferred.state()&&this._startDeferred.reject(e)},e.prototype._capabilityUpdate=function(){return function(e,t){if(c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Extension: "+e+" is installed? "+t),!1===this._isWorkerConfigValid()){var i="Content sharing worker path is missing";return this._shareApplicationWindowCapability._updateIfChanged(!1,i),void this._shareFullScreenCapability._updateIfChanged(!1,i)}e=e+" extension was "+(t?"installed or enabled":"uninstalled or disabled");this._shareApplicationWindowCapability._updateIfChanged(t,e),this._shareFullScreenCapability._updateIfChanged(t,e)}.bind(this)},e.prototype._isWorkerConfigValid=function(){return this._config!==T&&"string"==typeof this._config.contentSharingWorkerPath&&0<this._config.contentSharingWorkerPath.length},c.Providers.ContentSharing.ChromeScreenSharingProvider=e}(AvayaClientServices,window),function(n){"use strict";function e(e,t,i,a,r,s){n.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,e,t,i,a,r,s)}(e.prototype=Object.create(n.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).startApplicationWindow=function(){return n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Edge: An attempt to start application window sharing - failed"),this._startDeferred=S.Deferred(),this._startDeferred.reject('Edge does not support this method. Use "startScreenSharing" instead').promise()},e.prototype.startFullScreen=function(){return n.Base.Logger.error(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Edge: An attempt to start fullscreen sharing - failed"),this._startDeferred=S.Deferred(),this._startDeferred.reject('Edge does not support this method. Use "startScreenSharing" instead').promise()},e.prototype._getDisplayMediaFromBrowser=function(e){return navigator.getDisplayMedia(e)},e.prototype.isDisplayMediaAvailable=function(){return!!navigator.getDisplayMedia},n.Providers.ContentSharing.EdgeScreenSharingProvider=e}(AvayaClientServices),function(n){"use strict";var i="screen",a="window";function e(e,t,i,a,r,s){n.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,e,t,i,a,r,s)}(e.prototype=Object.create(n.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).startFullScreen=function(e,t){return n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Firefox: Start full screen sharing..."),this._startDeferred=S.Deferred(),t?this._onRetrievingStreamSucceeded(t):this._getScreenStream(i),this._startDeferred.promise()},e.prototype.startApplicationWindow=function(e,t){return n.Base.Logger.info(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Firefox: Start application window sharing..."),this._startDeferred=S.Deferred(),t?this._onRetrievingStreamSucceeded(t):this._getScreenStream(a),this._startDeferred.promise()},e.prototype._getScreenStream=function(e){n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"User enabled screen sharing: "+e);e={audio:!1,video:{mediaSource:e,width:{max:window.screen.width},height:{max:window.screen.height},frameRate:{max:3}}};this._getUserMedia(e)},n.Providers.ContentSharing.FirefoxScreenSharingProvider=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.UCCP.UCCPMessage.call(this,"activeTalkerChangedEvent"),this.participantId=e}e.prototype=Object.create(t.Providers.UCCP.UCCPMessage.prototype),t.Providers.UCCP.UCCPActiveTalkerChangedEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPAdmissionResponse=e}(AvayaClientServices),function(s){"use strict";function e(e,t,i,a,r){s.Providers.UCCP.UCCPMessage.call(this,s.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT),this.textOverlay=e,this.noSelfSee=t,this.videoPin=i,this.geometries=a,this.LPPOn=r}e.prototype=Object.create(s.Providers.UCCP.UCCPMessage.prototype),s.Providers.UCCP.UCCPAvailableLayoutsChangedEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPChangeLayoutGeometryResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPChangeLayoutTextOverlayResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,"chatEvent"),this.participantId=e,this.type=t,this.text=a,this.time=i}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPChatEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.CHAT_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPChatResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,r.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT),this.textOverlay=e,this.noSelfSee=t,this.geometry=i,this.LPPOn=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPCurrentLayoutChangedEvent=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r,s){n.Providers.UCCP.UCCPMessage.call(this,n.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_RESPONSE),this.transId=e,this.responseCode=t,this.textOverlay=i,this.noSelfSee=a,this.geometry=r,this.LPPOn=s}e.prototype=Object.create(n.Providers.UCCP.UCCPMessage.prototype),n.Providers.UCCP.UCCPCurrentLayoutResponse=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r,s){n.Providers.UCCP.UCCPMessage.call(this,n.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_RESPONSE),this.transId=e,this.responseCode=t,this.webLink=i,this.streamingLink=a,this.dialInInformation=r,this.dialInInformationHtml=s}e.prototype=Object.create(n.Providers.UCCP.UCCPMessage.prototype),n.Providers.UCCP.UCCPDialInInfoResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPDialoutCancelResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"dialoutCompletedEvent"),this.participantId=e,this.result=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPDialoutCompletedEvent=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.DIALOUT_RESPONSE),this.transId=e,this.responseCode=t,this.participantId=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDialoutResponse=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.UCCP.UCCPMessage.call(this,t.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT),this.reason=e}e.prototype=Object.create(t.Providers.UCCP.UCCPMessage.prototype),t.Providers.UCCP.UCCPDisconnectEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"disconnectParticipantResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPDisconnectParticipantResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPExtendMeetingResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.FECC_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPFeccResponse=e}(AvayaClientServices),function(C){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d){C.Providers.UCCP.UCCPMessage.call(this,"handshakeResponse"),this.transId=e,this.responseCode=t,this.version=i,this.participantId=a,this.externalAdmissionNeeded=r,this.admissionPasscodeNeeded=s,this.admissionPermissionNeeded=n,this.commands=o,this.currentTime=c,this.longPollEmptyResponseTimeout=l,this.knockDoorTimeout=d}e.prototype=Object.create(C.Providers.UCCP.UCCPMessage.prototype),C.Providers.UCCP.UCCPHandshakeResponse=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.UCCP.UCCPMessage.call(this,t.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST),this.transId=e}e.prototype=Object.create(t.Providers.UCCP.UCCPMessage.prototype),t.Providers.UCCP.UCCPKeepAliveRequestEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPLectureModeStartResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPLectureModeStopResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"lockMeetingResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPLockMeetingResponse=e}(AvayaClientServices),function(u){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C){u.Providers.UCCP.UCCPMessage.call(this,"meetingInfoChangedEvent"),this.media=e,this.locked=t,this.mediaStatus=i,this.lecturerId=a,this.lecturerName=r,this.presenterId=s,this.presenterName=n,this.recording=o,this.streaming=c,this.encrypted=l,this.slidesAvailable=d,this.terminationTime=C}e.prototype=Object.create(u.Providers.UCCP.UCCPMessage.prototype),u.Providers.UCCP.UCCPMeetingInfoChangedEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"meetingTerminationInProgressEvent"),this.reason=e,this.userName=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPMeetingTerminationInProgressEvent=e}(AvayaClientServices),function(C){"use strict";function e(e){C.Base.RESTProvider.apply(this),this.type=C.Base.ProviderTypes.UCCP_LONG_POLLING_PROVIDER,this._isOpened=!1,this._polling=!1,this._parser=e,this._responsesData={},this._transactionIDLocation="",this._longPollEmptyResponseTimeout=6e4}(e.prototype=Object.create(C.Base.RESTProvider.prototype)).onConnectionUnavailable=function(){},e.prototype.close=function(){this._isOpened?(C.Base.RESTProvider.prototype.close.call(this),this._polling=!1,this._isOpened=!1,this._responsesData={}):this.onClose()},e.prototype.run=function(e){this._isOpened&&this._poll(e)},e.prototype.start=function(e,t,i){return i&&i.transactionIDLocation&&(this._transactionIDLocation=i.transactionIDLocation),this._isOpened?(this.onOpen(),S.Deferred().resolve().promise()):(this._isOpened=!0,this._maxConnectionErrorCount=e.maxConnectionErrorCount||5,C.Base.RESTProvider.prototype.start.call(this,e,t,i))},e.prototype.send=function(e,t,i){var a={},a=t&&t.sendType&&"GET"===t.sendType?this._buildGetRequestOptions():this._buildPostRequestOptions();return i=i||new C.Base.NetworkRequestRetryHelper(function(){return this.send(e,a,i)}.bind(this)),C.Base.RESTProvider.prototype.send.call(this,e,a,i).then(function(e){this._polling||(this._polling=!0,this.run(a))}.bind(this),function(e){return e&&(this._isOpened=!1,this._polling=!1,this.onConnectionUnavailable()),S.Deferred().reject(e).promise()}.bind(this))},e.prototype.abort=function(){this._isOpened=!1,this._polling=!1,this._responsesData={},C.Base.RESTProvider.prototype.abort.call(this)},e.prototype._buildGetRequestOptions=function(){return{sendType:"GET",urlSuffix:"/uwd/rest",timeout:this._longPollEmptyResponseTimeout}},e.prototype._buildPostRequestOptions=function(){return{sendType:"POST",urlSuffix:"/uwd/rest",headers:{"Content-Type":"application/json"}}},e.prototype.isOpened=function(){return this._isOpened},e.prototype._ajaxOnSuccess=function(e,t,i,a){return this._removeXhrFromPool(i),200===i.status&&e&&this._resolveGetResponse(e,i),a.resolve(e,i),e},e.prototype._resolveGetResponse=function(e,t){for(var i=C.Base.Utils.makeId(10),a="}"+i+"{",r=e.replace(/}\\n\\n{/g,a).split(i),s=0;s<r.length;s++){var n=JSON.parse(r[s]),o=C.Base.Utils.queryJSONObject(n,this._transactionIDLocation);n.name===C.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_RESPONSE&&(d=C.Base.Utils.queryJSONObject(n,"params.longPollEmptyResponseTimeout"),this._longPollEmptyResponseTimeout=C.Base.Utils.isDefined(d)?1e3*parseInt(d)+1e4:13e4);var c=this._responsesData[o];if(o&&c){var l,d=c.dfd,c=c.successIndicator;delete this._responsesData[o];try{l=this._parser.parse(n)}catch(e){return void d.reject(e)}l&&l.responseCode&&(c.indexOf?-1<c.indexOf(l.responseCode):l.responseCode===c)?d.resolve(l):(c=400,n&&n.params&&n.params.responseCode&&(c=n.params.responseCode),d.reject({name:"UCCPServerError",code:c,message:"UCCP server responded with "+c}))}else this.onMessage(r[s],t)}},e.prototype._poll=function(e){this._polling&&(e.sendType="GET",this.send(T,e).done(function(){this._poll(e)}.bind(this)))},C.Providers.UCCP.UCCPLongPollingProvider=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.note&&(t.type=i.Base.Utils.queryJSONObject(e,"note[0]._attr.type._value"),t.text=i.Base.Utils.queryJSONObject(e,"note[0]._text")),t.meetingOwner="Y"===i.Base.Utils.queryJSONObject(e,"_attr.meeting_owner._value"),e._attr.target_id?(t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.personal=!0):t.personal=!1;t=new i.Providers.WCS.AddNoteEventData(t.type,t.text,t.meetingOwner,t.personal,t.targetId);return new i.Providers.WCS.AddNoteEvent(this.stripCommonData(e),t)},i.Providers.WCS.AddNoteParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.AddWhiteboardEvent(this.stripCommonData(e))},t.Providers.WCS.AddWhiteboardParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value");t=new i.Providers.WCS.AllowPresentingEventData(t.targetId);return new i.Providers.WCS.AllowPresentingEvent(this.stripCommonData(e),t)},i.Providers.WCS.AllowPresentingParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.selection[0]._attr&&S.each(e.selection[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.ClearDrawingEventData(i.groupId,i.layerType);return new a.Providers.WCS.ClearDrawingEvent(this.stripCommonData(e),t)},a.Providers.WCS.ClearDrawingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.note&&(t.event_id=i.Base.Utils.queryJSONObject(e,"note[0]._attr.event_id._value"));t=new i.Providers.WCS.DeleteNoteEventData(t.event_id);return new i.Providers.WCS.DeleteNoteEvent(this.stripCommonData(e),t)},i.Providers.WCS.DeleteNoteParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.selection[0]._attr&&S.each(e.selection[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.DeleteSelectionEventData(i.groupId,i.layerType,i.id,i.selectionX,i.selectionY);return new a.Providers.WCS.DeleteSelectionEvent(this.stripCommonData(e),t)},a.Providers.WCS.DeleteSelectionParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"whiteboard[0]._attr.index._value"),t=new i.Providers.WCS.DeleteWhiteboardEventData(t);return new i.Providers.WCS.DeleteWhiteboardEvent(this.stripCommonData(e),t)},i.Providers.WCS.DeleteWhiteboardParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.DenyControlEvent(this.stripCommonData(e))},t.Providers.WCS.DenyControlParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value");t=new i.Providers.WCS.DenyPresentingEventData(t.targetId,t.targetName);return new i.Providers.WCS.DenyPresentingEvent(this.stripCommonData(e),t)},i.Providers.WCS.DenyPresentingParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.circle[0]._attr&&S.each(e.circle[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),a.Base.Utils.isDefined(i.fillColor)&&(i.fillColor=a.Base.Utils.colorIntToHex(i.fillColor),i.filled=!0),a.Base.Utils.isDefined(i.color)&&(i.color=a.Base.Utils.colorIntToHex(i.color),i.contour=!0),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.DrawCircleEventData(i.alpha,i.fillColor,i.color,i.groupId,i.layerType,i.width,i.x0,i.x1,i.y0,i.y1,i.filled,i.contour);return new a.Providers.WCS.DrawCircleEvent(this.stripCommonData(e),t)},a.Providers.WCS.DrawCircleParser=e}(AvayaClientServices),function(s){"use strict";function e(){}(e.prototype=Object.create(s.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={},a=[],r=[];e.m?r.push({x:s.Base.Utils.queryJSONObject(e,"m[0]._attr.x._value"),y:s.Base.Utils.queryJSONObject(e,"m[0]._attr.y._value")}):(e.lines&&e.lines[0]._attr&&S.each(e.lines[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),s.Base.Utils.isDefined(i.fillColor)&&(i.fillColor=s.Base.Utils.colorIntToHex(i.fillColor),i.filled=!0),s.Base.Utils.isDefined(i.color)&&(i.color=s.Base.Utils.colorIntToHex(i.color),i.contour=!0),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group),e.lines&&e.lines[0].l&&S.each(e.lines[0].l,function(e,t){a.push({x:t._attr.x._value,y:t._attr.y._value})}.bind(this)),e.lines&&e.lines[0].m&&S.each(e.lines[0].m,function(e,t){r.push({x:t._attr.x._value,y:t._attr.y._value})}.bind(this)));var t=new s.Providers.WCS.DrawShapeEventData(i.alpha,i.fillColor,i.color,i.groupId,i.layerType,i.width,a,r,i.filled,i.contour);return new s.Providers.WCS.DrawShapeEvent(this.stripCommonData(e),t)},s.Providers.WCS.DrawShapeParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.drawText[0]._attr&&S.each(e.drawText[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),a.Base.Utils.isDefined(i.fillColor)&&(i.fillColor=a.Base.Utils.colorIntToHex(i.fillColor)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.DrawTextEventData(i.fillColor,i.fontSize,i.groupId,i.layerType,i.text,i.x,i.y);return new a.Providers.WCS.DrawTextEvent(this.stripCommonData(e),t)},a.Providers.WCS.DrawTextParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value"),t.targetParticipantId=i.Base.Utils.queryJSONObject(e,"_attr.targetParticipantId._value"),t.time=i.Base.Utils.queryJSONObject(e,"_attr.time._value");t=new i.Providers.WCS.EjectParticipantEventData(t.targetId,t.targetName,t.targetParticipantId,t.time);return new i.Providers.WCS.EjectParticipantEvent(this.stripCommonData(e),t)},i.Providers.WCS.EjectParticipantParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.EndControlEvent(this.stripCommonData(e))},t.Providers.WCS.EndControlParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.lines[0]._attr&&S.each(e.lines[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.EndDrawShapeEventData(i.groupId,i.layerType);return new a.Providers.WCS.EndDrawShapeEvent(this.stripCommonData(e),t)},a.Providers.WCS.EndDrawShapeParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.EndMeetingEvent(this.stripCommonData(e))},t.Providers.WCS.EndMeetingParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.EndScreenSharingEvent(this.stripCommonData(e))},t.Providers.WCS.EndScreenSharingParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.EndVideoSharingEvent(this.stripCommonData(e))},t.Providers.WCS.EndVideoSharingParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.EndWhiteboardEvent(this.stripCommonData(e))},t.Providers.WCS.EndWhiteboardParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.AbstractParser.prototype)).parse=function(e){e={code:t.Base.Utils.queryJSONObject(e,"code[0]._text"),message:t.Base.Utils.queryJSONObject(e,"message[0]._text"),request_id:t.Base.Utils.queryJSONObject(e,"request_id[0]._text"),ws_connection_id:t.Base.Utils.queryJSONObject(e,"ws_connection_id[0]._text")},e=new t.Providers.WCS.ErrorEventData(e.code,e.message,e.request_id,e.ws_connection_id);return new t.Providers.WCS.ErrorEvent(e)},t.Providers.WCS.ErrorParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"os_type[0]._text"),t=new i.Providers.WCS.GrantControlEventData(t);return new i.Providers.WCS.GrantControlEvent(this.stripCommonData(e),t)},i.Providers.WCS.GrantControlParser=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.WCS.WCSSharingTag.call(this,e.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG)}t.prototype=Object.create(e.Providers.WCS.WCSSharingTag.prototype),e.Providers.WCS.ScreenSharingAcknowledgementTag=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.WCS.WCSSharingTag.call(this,e.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG),this.width=0,this.height=0,this.x=0,this.y=0,this.imageType=0,this.length=0,this.data=[]}t.prototype=Object.create(e.Providers.WCS.WCSSharingTag.prototype),e.Providers.WCS.ScreenSharingBlockTag=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.WCS.WCSSharingTag.call(this,e.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG),this.x=0,this.y=0,this.creationTime=0}t.prototype=Object.create(e.Providers.WCS.WCSSharingTag.prototype),e.Providers.WCS.ScreenSharingCursorTag=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.WCS.WCSSharingTag.call(this,e.Providers.WCS.WCSScreenSharingTagTypes.END_TAG)}t.prototype=Object.create(e.Providers.WCS.WCSSharingTag.prototype),e.Providers.WCS.ScreenSharingEndTag=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.WCS.WCSSharingTag.call(this,e.Providers.WCS.WCSScreenSharingTagTypes.START_TAG),this.isKeyFrame=!1,this.width=0,this.height=0,this.creationTime=0}t.prototype=Object.create(e.Providers.WCS.WCSSharingTag.prototype),e.Providers.WCS.ScreenSharingStartTag=t}(AvayaClientServices),function(s,r){"use strict";function e(e){s.Base.RESTProvider.apply(this),this.type=s.Base.ProviderTypes.WCS_COMET_PROVIDER,this._connectionId=T,this._isOpened=!1,this._polling=!1,this._options={},this._parser=e,this._keepAliveTimeout=T,this._keepAliveTimer=3e4,this._messagePoolingIndex=1,this._deferreds={},this._eventsStack={},this._resolveEventsRetries=0}(e.prototype=Object.create(s.Base.RESTProvider.prototype)).onConnectionUnavailable=function(){},e.prototype.close=function(){this._messagePoolingIndex=1,this._resolveEventsRetries=0,this._isOpened?(s.Base.RESTProvider.prototype.close.call(this),this._polling=!1,this._isOpened=!1,this._parser.removeOnMessageParsedCallback(this.onMessage)):this.onClose()},e.prototype.run=function(e){var a=function(e){if(!s.Base.Utils.isUndefined(e)&&!s.Base.Utils.isUndefined(e.data)){if("string"!=typeof e.data)return this.onMessage(e);var t=this._getXmlParameter("<request_id>","</request_id>",e.data),i=this._getXmlParameter("<event_id>","</event_id>",e.data);t&&i?(this._handleIncomingEvent(t,parseInt(i)),this.onMessage(e)):(t=e.data.match(/id="([^&]+?)"/i),i=e.data.match(/type="([^&]+?)"/i),this._isAsyncEvent(i)&&!this._isEventResolved(t)&&this._resolveEventsRetries<=5?(this._resolveEventsRetries++,setTimeout(function(){a(e)}.bind(e))):(this.onMessage(e),this._resolveEventsRetries=0))}}.bind(this);this._options=e,this._isOpened&&(this._polling=!0,this._poll(),this._parser.addOnMessageParsedCallback(a))},e.prototype.start=function(e,t){return this._messagePoolingIndex=1,this._resolveEventsRetries=0,this._isOpened?(this.onOpen(),S.Deferred().resolve().promise()):(this._isOpened=!0,this._maxConnectionErrorCount=e.maxConnectionErrorCount,s.Base.RESTProvider.prototype.start.call(this,e,t))},e.prototype.send=function(e,t,i){var a;return s.Base.Utils.isDefined(this._connectionId)&&(t.query="connection_id="+this._connectionId,t.sendType&&"POST"!==t.sendType||(a=/[?&]request_id=([^&]+).*$/,(a="string"==typeof e&&e.match(a)[1]?e.match(a)[1]:"")&&(t.requestId=a),e=this._addWCSHeader(e),t.processData=!1,t.dataType="binary",t.contentType="octet-stream",this._options.cometSequencing&&(t.contentType="application/vnd.avaya.wcs.comet.data.v2+"+t.contentType))),i=i||new s.Base.NetworkRequestRetryHelper(function(){return this.send(e,t,i)}.bind(this)),this._keepAlive(),t.keepAliveCallback=this._keepAlive.bind(this),s.Base.RESTProvider.prototype.send.call(this,e,t,i).then(function(e){if(e&&!this._isXmlString(e))return this._eventsStack[e]=!0,e;if(this._isXmlString(e)){e=r.parseString(e);return s.Base.Utils.isUndefined(this._connectionId)&&(this._connectionId=s.Base.Utils.queryJSONObject(e,"response[0].live_session[0].ws_connection_id[0]._text")),e}}.bind(this),function(e){e&&(this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._connectionId=T,this._isOpened=!1,this._polling=!1,setTimeout(function(){this.onConnectionUnavailable()}.bind(this)))}.bind(this))},e.prototype._isXmlString=function(e){return"string"==typeof e&&"xml"===e.substring(2,5)},e.prototype.isOpened=function(){return this._isOpened},e.prototype._handleIncomingEvent=function(e,t){var i;s.Base.Utils.isDefined(e)&&s.Base.Utils.isDefined(this._deferreds[e])&&(i=this._deferreds[e],delete this._deferreds[e],this._eventsStack[t]=!1,i.resolve(t,this._eventsStack))},e.prototype._isEventResolved=function(e){if(s.Base.Utils.isUndefined(e))return!1;e=e[1];return!s.Base.Utils.isDefined(this._eventsStack[e])||!0===this._eventsStack[e]},e.prototype._isAsyncEvent=function(e){return!(!e||!s.Base.Utils.isDefined(e)||e[1]!==s.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE&&e[1]!==s.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE&&e[1]!==s.Providers.WCS.WCSEventTypes.DRAW_SHAPE&&e[1]!==s.Providers.WCS.WCSEventTypes.DRAW_CIRCLE&&e[1]!==s.Providers.WCS.WCSEventTypes.MOVE_SELECTION&&e[1]!==s.Providers.WCS.WCSEventTypes.DRAW_TEXT)},e.prototype._getXmlParameter=function(e,t,i){t=new RegExp(e+"([^&]+)"+t,"i"),t=i.match(t);if(t)return t[1]},e.prototype._ajaxOnSuccess=function(e,t,i,a,r){if(!s.Base.Utils.isDefined(r.requestId))return this._removeXhrFromPool(i),a.resolve(e),e;this._deferreds[r.requestId]=a},e.prototype._poll=function(){this._polling&&(this._options.sendType="GET",this._options.dataType="binary",this._options.responseType="arraybuffer",this._options.binaryProgressCallback=this._parser.parse.bind(this._parser),this.send(T,this._options).done(function(){this._poll()}.bind(this)))},e.prototype._addWCSHeader=function(e){var t=e,i=s.Base.Utils.stringToArrayBuffer(this._parser.msgHeaderDetails.msgTxt),a=new ArrayBuffer(this._parser.msgHeaderDetails.flagSize);"string"==typeof e&&(new DataView(a).setUint8(0,this._parser.msgHeaderDetails.textFlagValue),t=s.Base.Utils.stringToArrayBuffer(t));var r=this._createInt32ArrayBuffer(this._parser.msgHeaderDetails.lengthIndicatorSize,t.byteLength);(2147483647<this._messagePoolingIndex||this._messagePoolingIndex<=0)&&(this._messagePoolingIndex=1);e=this._createInt32ArrayBuffer(4,this._messagePoolingIndex),a=s.Base.Utils.concatArrayBuffers(i,a),r=s.Base.Utils.concatArrayBuffers(a,r),e=s.Base.Utils.concatArrayBuffers(r,e),t=this._options.cometSequencing?s.Base.Utils.concatArrayBuffers(e,t):s.Base.Utils.concatArrayBuffers(r,t);return this._messagePoolingIndex++,t},e.prototype._createInt32ArrayBuffer=function(e,t){e=new ArrayBuffer(e);return new DataView(e).setUint32(0,t),e},e.prototype._keepAlive=function(e){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),4!==e&&(this._keepAliveTimeout=setTimeout(function(){this._connectionId=T,this.close(),this.onConnectionUnavailable()}.bind(this),this._keepAliveTimer))},s.Providers.WCS.WCSCometProvider=e}(AvayaClientServices,xmlToJSON),function(a){"use strict";function e(e){this._callService=e,this._conference=T,this._remoteAddress="",this._remoteDisplayName="",this._callId=T,this._incoming=!1,this._subject="",this._dataOnly=!1,this._establishedTime=T,this._heldTime=T,this._remoteParticipant=new a.Services.Participant,this._activeParticipants=[],this._callState=a.Services.Call.CallStates.IDLE,this._confEntryOptions=T,this._callCreationInfo=T,this._sessionId=T,this._videoChannels=[],this._audioChannel=T,this._incomingVideoOffered=a.Services.Call.VideoNetworkSignalingType.INDEFINITE,this._isServiceAvailable=!1,this._isPrivateCallerID=!1,this._isAuraAsserted=!1,this._alertType=a.Services.Call.AlertType.UNSPECIFIED,this._heldRemotely=!1,this._remote=!1,this._isMissed=!1,this._modes=[],this._dtmfString=T,this._isEarlyMedia=!1,this._webCollaboration=!1,this._isGuestUser=!1,this._allowedNailedUpVideoModes=[],this._endCallWatchdogTimer=T,this._serviceQuality=new a.Services.Call.ServiceQuality(this),this._isAudioMuted=!1,this._isSpeakerMuted=!1,this._audioMuteState=a.Services.Call.MediaMuteStates.UNDEFINED,this._speakerMuteState=a.Services.Call.MediaMuteStates.UNDEFINED,this._videoMuteState=a.Services.Call.MediaMuteStates.UNDEFINED,this._ucid=T,this._noiseReductionSetting=T,this._isContentVideoSharingStarted=!1,this._backgroundBlur=!1,this._backgroundImage=T,this._participantDroppedCallbacks=S.Callbacks(),this._onCallStartedCallbacks=S.Callbacks(),this._onCallRemoteAlertingCallbacks=S.Callbacks(),this._onCallRedirectedCallbacks=S.Callbacks(),this._onCallQueuedCallbacks=S.Callbacks(),this._onCallIgnoredCallbacks=S.Callbacks(),this._onCallEstablishedCallbacks=S.Callbacks(),this._onCallEstablishingCallbacks=S.Callbacks(),this._onCallRemoteAddressChangedCallbacks=S.Callbacks(),this._onCallHeldCallbacks=S.Callbacks(),this._onCallUnheldCallbacks=S.Callbacks(),this._onCallHeldRemotelyCallbacks=S.Callbacks(),this._onCallUnheldRemotelyCallbacks=S.Callbacks(),this._onCallJoinedCallbacks=S.Callbacks(),this._onCallEndedCallbacks=S.Callbacks(),this._onCallAudioMuteStatusChangedCallbacks=S.Callbacks(),this._onCallSpeakerMuteStatusChangedCallbacks=S.Callbacks(),this._onCallVideoMuteStatusChangedCallbacks=S.Callbacks(),this._onCallIncomingVideoAddRequestReceivedCallbacks=S.Callbacks(),this._onCallIncomingVideoAddRequestAcceptedCallbacks=S.Callbacks(),this._onCallIncomingVideoAddRequestDeniedCallbacks=S.Callbacks(),this._onCallIncomingVideoAddRequestTimedOutCallbacks=S.Callbacks(),this._onCallVideoChannelsUpdatedCallback=S.Callbacks(),this._onCallConferenceStatusChangedCallbacks=S.Callbacks(),this._onAudioStreamUpdatedCallback=S.Callbacks(),this._remoteVideoAddedCallbacks=S.Callbacks(),this._remoteVideoRemovedCallbacks=S.Callbacks(),this._callFailedCallbacks=S.Callbacks(),this._callServiceAvailableCallbacks=S.Callbacks(),this._callServiceUnavailableCallbacks=S.Callbacks(),this._callVideoChannelsUpdatedCallbacks=S.Callbacks(),this._callStateChangedCallBacks=S.Callbacks(),this._answerCallRequestedCallbacks=S.Callbacks(),this._terminateCallRequestedCallbacks=S.Callbacks(),this._updateCallRequestedCallbacks=S.Callbacks(),this._mediaConnectedCallbacks=S.Callbacks(),this._mediaDisconnectedCallbacks=S.Callbacks(),this._mediaFailedCallbacks=S.Callbacks(),this._muteCapability=new a.Services.Call.Capabilities.MuteCapability(this),this._unmuteCapability=new a.Services.Call.Capabilities.UnmuteCapability(this),this._muteVideoCapability=new a.Services.Call.Capabilities.MuteVideoCapability(this,e.getVideoCapability()),this._unmuteVideoCapability=new a.Services.Call.Capabilities.UnmuteVideoCapability(this,e.getVideoCapability()),this._muteSpeakerCapability=new a.Services.Call.Capabilities.MuteSpeakerCapability(this),this._unmuteSpeakerCapability=new a.Services.Call.Capabilities.UnmuteSpeakerCapability(this),this._videoChannelsCapability=new a.Services.Call.Capabilities.UpdateVideoChannelsCapability(this,e.getVideoCapability()),this._sendDTMFCapability=new a.Services.Call.Capabilities.SendDTMFCapability(this),this._holdCapability=new a.Services.Call.Capabilities.HoldCapability(this),this._unholdCapability=new a.Services.Call.Capabilities.UnholdCapability(this),this._joinCapability=new a.Services.Call.Capabilities.JoinCapability(this),this._transferCapability=new a.Services.Call.Capabilities.TransferCapability(this),this._transferToCapability=new a.Services.Call.Capabilities.TransferToCapability(this),this._updateVideoModeSendReceiveCapability=new a.Services.Call.Capabilities.UpdateVideoModeSendReceiveCapability(this,e.getVideoCapability()),this._updateVideoModeSendOnlyCapability=new a.Services.Call.Capabilities.UpdateVideoModeSendOnlyCapability(this,e.getVideoCapability()),this._updateVideoModeReceiveOnlyCapability=new a.Services.Call.Capabilities.UpdateVideoModeReceiveOnlyCapability(this,e.getVideoCapability()),this._updateVideoModeInactiveCapability=new a.Services.Call.Capabilities.UpdateVideoModeInactiveCapability(this,e.getVideoCapability()),this._updateVideoModeDisableCapability=new a.Services.Call.Capabilities.UpdateVideoModeDisableCapability(this,e.getVideoCapability()),this._updateWebCollaborationCapability=new a.Services.Call.Capabilities.UpdateWebCollaborationCapability(this),this._updateAudioModeCapability=new a.Services.Call.Capabilities.UpdateAudioModeCapability(this),this._serviceQualityScoreCapability=new a.Services.Call.Capabilities.ServiceQualityScoreCapability(this),this._preferredResolutionCapability=new a.Services.Call.Capabilities.UpdatePreferredResolutionCapability(this,e.getVideoCapability()),this._preferredReceiveResolutionCapability=new a.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability(this,e.getVideoCapability()),this._setNoiseReductionCapability=new a.Services.Call.Capabilities.SetNoiseReductionCapability(this),this._setBackgroundBlurCapability=new a.Services.Call.Capabilities.SetBackgroundBlurCapability(this,this._callService),this._setBackgroundImageCapability=new a.Services.Call.Capabilities.SetBackgroundBlurCapability(this,this._callService),this._serviceQualityScoreCapability.addOnChangedCallback(function(){this._serviceQuality.watch()}.bind(this)),this._callStatisticsLogger=new a.Base.CallStatisticsLogger(this)}e.prototype={_setRemoteAddress:function(e){this._remoteAddress=e,this._remoteParticipant.setAddress(e),this._callService._updateMatchedContactsForCall(this)},getRemoteAddress:function(){return this._remoteAddress},_setDtmfString:function(e){this._dtmfString=e},getRemoteDisplayName:function(){return this._remoteDisplayName},isIncoming:function(){return this._incoming},getEstablishedTime:function(){return this._establishedTime},getHeldTime:function(){return this._heldTime},_setRemoteDisplayName:function(e){this._remoteDisplayName=e,this._remoteParticipant.setDisplayName(e)},getRemoteParticipant:function(){return this._remoteParticipant},start:function(){this._callService.isServiceAvailable()||this._isDataOnly()?this._callService.startCall(this):(this._callService._notifyCallFailure(this,a.Services.Call.CallError.SERVICE_UNAVAILABLE),this._endCallWatchdogTimer&&clearTimeout(this._endCallWatchdogTimer),this._endCallWatchdogTimer=setTimeout(function(){this.end()}.bind(this),5e3))},end:function(){this._endCallWatchdogTimer&&(clearTimeout(this._endCallWatchdogTimer),this._endCallWatchdogTimer=T),this.getState()!==a.Services.Call.CallStates.ENDING&&this.getState()!==a.Services.Call.CallStates.ENDED&&(this._setState(a.Services.Call.CallStates.ENDING),this._callService.endCall(this))},getConference:function(){return a.Base.Utils.isUndefined(this._conference)&&(a.Base.Logger.info(a.Base.LoggerTags.CALL_SERVICE,"getConference(): Creating new CM Conference"),this._createCMConference()),this._conference},hold:function(){return this._callService.hold(this)},unhold:function(){return this._callService.unhold(this)},ignore:function(){return this._callService.ignore(this)},accept:function(){return this._callService.accept(this)},deny:function(){return this._setState(a.Services.Call.CallStates.ENDING),this._callService.endCall(this,a.Services.Call.CallDenialReason.BUSY)},denyWithReason:function(e){this._setState(a.Services.Call.CallStates.ENDING);var t,i=a.Services.Call.CallDenialReason.TEMPORARILY_UNAVAILABLE;for(t in a.Services.Call.CallDenialReason)if(a.Services.Call.CallDenialReason[t]===e){i=e;break}return this._callService.endCall(this,i)},sendDTMF:function(e){return this._callService.sendDTMF(this,e)},getState:function(){return this._callState},getRemoteNumber:function(){return this._remoteAddress},isConference:function(){return void 0!==this._conference},isIgnored:function(){return this.getState()===a.Services.Call.CallStates.IGNORED},isRemote:function(){return this._remote},_setRemote:function(e){this._remote=e},isHeldRemotely:function(){return this._heldRemotely},isMissed:function(){return this._isMissed},_setIsMissed:function(e){this._isMissed=e},isCallerIdentityPrivate:function(){return this._isPrivateCallerID},isServiceAvailable:function(){return this._isServiceAvailable},getAlertType:function(){return this._alertType},getSubject:function(){return this._subject},join:function(){return this._callService.join(this)},acceptSendVideo:function(e){return this._callService.acceptSendVideo(this,e)},denySendVideo:function(){return this._callService.denySendVideo(this)},getVideoChannels:function(){return this._videoChannels},getAudioChannel:function(){return this._audioChannel},setVideoChannels:function(e){return this._callService.setVideoChannels(this,e)},removeAllVideoChannels:function(){return this._callService.setVideoMode(this,a.Services.Call.VideoMode.DISABLE)},setVideoMode:function(e,t){return this._callService.setVideoMode(this,e,t)},setAudioMode:function(e){return this._callService.setAudioMode(this,e)},setWebCollaboration:function(e){return this._callService.setWebCollaboration(this,e)},getIncomingVideoOffered:function(){return this._incomingVideoOffered},getCallId:function(){return this._callId},_setCallId:function(e){this._callId=e},isAudioMuted:function(){return this._isAudioMuted},muteAudio:function(){return this._audioMuteState=a.Services.Call.MediaMuteStates.MUTED,this._callService.mute(this).then(function(){this._isAudioMuted=!0,this._muteCapability._recalculate(),this._unmuteCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot mute audio ",e)})},unmuteAudio:function(){return this._audioMuteState=a.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmute(this).then(function(){this._isAudioMuted=!1,this._muteCapability._recalculate(),this._unmuteCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot unmute audio ",e)})},muteVideo:function(){return this._videoMuteState=a.Services.Call.MediaMuteStates.MUTED,this._callService.muteVideo(this).then(function(){this._muteVideoCapability._recalculate(),this._unmuteVideoCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot mute video ",e)})},unmuteVideo:function(){return this._videoMuteState=a.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmuteVideo(this).then(function(){this._muteVideoCapability._recalculate(),this._unmuteVideoCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot unmute video ",e)})},isSpeakerMuted:function(){return this._isSpeakerMuted},muteSpeaker:function(){return this._speakerMuteState=a.Services.Call.MediaMuteStates.MUTED,this._callService.muteSpeaker(this).then(function(){this._isSpeakerMuted=!0,this._muteSpeakerCapability._recalculate(),this._unmuteSpeakerCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot mute speaker ",e)})},unmuteSpeaker:function(){return this._speakerMuteState=a.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmuteSpeaker(this).then(function(){this._isSpeakerMuted=!1,this._muteSpeakerCapability._recalculate(),this._unmuteSpeakerCapability._recalculate()}.bind(this)).catch(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Cannot unmute speaker ",e)})},transfer:function(e){return this._callService.transfer(this,e)},attendedTransfer:function(e){return this._callService.attendedTransfer(this,e)},setConferenceEntryOptions:function(e){this._confEntryOptions=e,a.Base.Utils.isDefined(this._callCreationInfo)||(this._callCreationInfo=new a.Services.Call.CallCreationInfo),this._callCreationInfo.setConferenceID(e.getMeetingId()),this._callCreationInfo.setPortalToken(e.getToken()),this._callCreationInfo.setPasscode(e.getPasscode()),e.isOTT()?this._callCreationInfo.setCallType(a.Services.Call.CallType.CallTypeHttpMeetMe):this._callCreationInfo.setCallType(a.Services.Call.CallType.CallTypeDefaultRegisteredService)},getConferenceEntryOptions:function(){return this._confEntryOptions},getAudioDetails:function(){return this._callService.getAudioDetails(this)},getVideoDetails:function(){return this._callService.getVideoDetails(this)},getServiceQualityScore:function(){return this._serviceQuality.getScore()},_setState:function(e){var t=e!==this._callState;this._callState=e,t&&this._callStateChangedCallBacks.fire()},_setServiceAvailability:function(e){this._isServiceAvailable=e},_isDataOnly:function(){return this._dataOnly},_hasCallMode:function(t){return 0<this._modes.filter(function(e){return e.id===t}).length},_removeCallMode:function(t){this.modes=this._modes.filter(function(e){return e.id!==t})},_createCMConference:function(){this._conference=this._callService.createCMConference(this),this._updateVideoModeCapabilities()},_setConference:function(e){this._conference=e,this.isAudioMuted()&&a.Base.Utils.isDefined(e)&&e._sendLocalMuteEvent(!0),this._updateVideoModeCapabilities()},_updateVideoModeCapabilities:function(){a.Base.Utils.isDefined(this._conference)&&(this._recalculateVideoModeCapabilities(),this._conference._addOnConferenceAllowVideoDirectionChangedCallback(this._recalculateVideoModeCapabilities.bind(this)))},_recalculateVideoModeCapabilities:function(){this._updateVideoModeSendReceiveCapability._recalculate(),this._updateVideoModeSendOnlyCapability._recalculate(),this._updateVideoModeReceiveOnlyCapability._recalculate(),this._updateVideoModeInactiveCapability._recalculate(),this._updateVideoModeDisableCapability._recalculate()},_setUserToUserInfo:function(e){this._userToUserInfo=e},_setAllowedNailedUpVideoModes:function(e){this._allowedNailedUpVideoModes=e},_getAllowedNailedUpVideoModes:function(){return this._allowedNailedUpVideoModes},getUserToUserInfo:function(){return this._userToUserInfo},startRinging:function(){return this._callService.startRinging(this)},acceptAnswerCallRequest:function(){return this._callService.acceptAnswerCallRequest(this)},acceptTerminateCallRequest:function(){return this._callService.acceptTerminateCallRequest(this)},acceptUpdateCallRequest:function(e){return this._callService.acceptUpdateCallRequest(this,e)},acceptMakeCallRequest:function(){return this._callService.acceptMakeCallRequest(this)},rejectAnswerCallRequest:function(){return this._callService.rejectAnswerCallRequest(this)},rejectTerminateCallRequest:function(){return this._callService.rejectTerminateCallRequest(this)},rejectUpdateCallRequest:function(e){return this._callService.rejectUpdateCallRequest(this,e)},rejectMakeCallRequest:function(){return this._callService.rejectMakeCallRequest(this)},isMediaConnected:function(){return this._callService.isMediaConnected(this)},isAutoAnswerEnabled:function(){return!(!this._isAutoAnswerEnabled||"string"!=typeof this._isAutoAnswerEnabled)&&"auto"===this._isAutoAnswerEnabled.toLowerCase()},_setIsAutoAnswerEnabled:function(e){this._isAutoAnswerEnabled=e},_setIsGuestUser:function(e){this._isGuestUser=e},startLoggingStatistics:function(){this._callStatisticsLogger.start()},stopLoggingStatistics:function(){this._callStatisticsLogger.stop()},setNoiseReduction:function(e){return this._callService.setNoiseReduction(this,e)},getNoiseReductionSetting:function(){return this._noiseReductionSetting},_setIsContentVideoSharingStarted:function(e){this._isContentVideoSharingStarted=e,this._recalculateVideoModeCapabilities()},_getIsContentVideoSharingStarted:function(){return this._isContentVideoSharingStarted},setBackgroundBlur:function(e){return e!==this._backgroundBlur?this._callService.setBackgroundBlur(this,e):S.Deferred().resolve().promise()},isBackgroundBlur:function(){return this._backgroundBlur},setBackgroundImage:function(e){return e!==this._backgroundImage?this._callService.setBackgroundImage(this,e):S.Deferred().resolve().promise()},getBackgroundImage:function(){return this._backgroundImage}},a.Base.AOPTools.addAdvices(e,"Call",["getConference","setVideoMode","setConferenceEntryOptions"],[a.Base.AOPCommonAdvices.LOG_CALL_API_CALLS]),a.Base.AOPTools.addAdvices(e,"Call",["start","end"],[a.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_EXCEPTION]),a.Base.AOPTools.addAdvices(e,"Call",["hold","unhold","ignore","accept","deny","denyWithReason","sendDTMF","join","acceptSendVideo","denySendVideo","setVideoChannels","removeAllVideoChannels","muteAudio","unmuteAudio","muteSpeaker","unmuteSpeaker","transfer","attendedTransfer","startRinging","acceptAnswerCallRequest","acceptTerminateCallRequest","acceptUpdateCallRequest","acceptMakeCallRequest","rejectAnswerCallRequest","rejectTerminateCallRequest","rejectUpdateCallRequest","rejectMakeCallRequest","muteVideo","unmuteVideo","setNoiseReduction","setBackgroundImage","setBackgroundBlur"],[a.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_ERROR]),a.Services.Call.Call=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Call.Call.prototype,{addOnRemoteVideoAddedCallback:function(e){this._remoteVideoAddedCallbacks.add(e)},removeOnRemoteVideoAddedCallback:function(e){this._remoteVideoAddedCallbacks.remove(e)},addOnRemoteVideoRemovedCallback:function(e){this._remoteVideoRemovedCallbacks.add(e)},removeOnRemoteVideoRemovedCallback:function(e){this._remoteVideoRemovedCallbacks.remove(e)},addOnCallVideoChannelsUpdatedCallback:function(e){this._onCallVideoChannelsUpdatedCallback.add(e)},removeOnCallVideoChannelsUpdatedCallback:function(e){this._onCallVideoChannelsUpdatedCallback.remove(e)},addOnAudioStreamUpdatedCallback:function(e){this._onAudioStreamUpdatedCallback.add(e)},removeOnAudioStreamUpdatedCallback:function(e){this._onAudioStreamUpdatedCallback.remove(e)},addOnCallStartedCallback:function(e){this._onCallStartedCallbacks.add(e)},removeOnCallStartedCallback:function(e){this._onCallStartedCallbacks.remove(e)},addOnCallRemoteAlertingCallback:function(e){this._onCallRemoteAlertingCallbacks.add(e)},removeOnCallRemoteAlertingCallback:function(e){this._onCallRemoteAlertingCallbacks.remove(e)},addOnCallRedirectedCallback:function(e){this._onCallRedirectedCallbacks.add(e)},removeOnCallRedirectedCallback:function(e){this._onCallRedirectedCallbacks.remove(e)},addOnCallQueuedCallback:function(e){this._onCallQueuedCallbacks.add(e)},removeOnCallQueuedCallback:function(e){this._onCallQueuedCallbacks.remove(e)},addOnCallIgnoredCallback:function(e){this._onCallIgnoredCallbacks.add(e)},removeOnCallIgnoredCallback:function(e){this._onCallIgnoredCallbacks.remove(e)},addOnCallEstablishedCallback:function(e){this._onCallEstablishedCallbacks.add(e)},removeOnCallEstablishedCallback:function(e){this._onCallEstablishedCallbacks.remove(e)},addOnCallEstablishingCallback:function(e){this._onCallEstablishingCallbacks.add(e)},removeOnCallEstablishingCallback:function(e){this._onCallEstablishingCallbacks.remove(e)},addOnCallRemoteAddressChangedCallback:function(e){this._onCallRemoteAddressChangedCallbacks.add(e)},removeOnCallRemoteAddressChangedCallback:function(e){this._onCallRemoteAddressChangedCallbacks.remove(e)},addOnCallHeldCallback:function(e){this._onCallHeldCallbacks.add(e)},removeOnCallHeldCallback:function(e){this._onCallHeldCallbacks.remove(e)},addOnCallUnheldCallback:function(e){this._onCallUnheldCallbacks.add(e)},removeOnCallUnheldCallback:function(e){this._onCallUnheldCallbacks.remove(e)},addOnCallHeldRemotelyCallback:function(e){this._onCallHeldRemotelyCallbacks.add(e)},removeOnCallHeldRemotelyCallback:function(e){this._onCallHeldRemotelyCallbacks.remove(e)},addOnCallUnheldRemotelyCallback:function(e){this._onCallUnheldRemotelyCallbacks.add(e)},removeOnCallUnheldRemotelyCallback:function(e){this._onCallUnheldRemotelyCallbacks.remove(e)},addOnCallJoinedCallback:function(e){this._onCallJoinedCallbacks.add(e)},removeOnCallJoinedCallback:function(e){this._onCallJoinedCallbacks.remove(e)},addOnCallEndedCallback:function(e){this._onCallEndedCallbacks.add(e)},removeOnCallEndedCallback:function(e){this._onCallEndedCallbacks.remove(e)},addOnCallAudioMuteStatusChangedCallback:function(e){this._onCallAudioMuteStatusChangedCallbacks.add(e)},removeOnCallAudioMuteStatusChangedCallback:function(e){this._onCallAudioMuteStatusChangedCallbacks.remove(e)},addOnCallSpeakerMuteStatusChangedCallback:function(e){this._onCallSpeakerMuteStatusChangedCallbacks.add(e)},removeOnCallSpeakerMuteStatusChangedCallback:function(e){this._onCallSpeakerMuteStatusChangedCallbacks.remove(e)},addOnCallVideoMuteStatusChangedCallback:function(e){this._onCallVideoMuteStatusChangedCallbacks.add(e)},removeOnCallVideoMuteStatusChangedCallback:function(e){this._onCallVideoMuteStatusChangedCallbacks.remove(e)},addOnCallIncomingVideoAddRequestReceivedCallback:function(e){this._onCallIncomingVideoAddRequestReceivedCallbacks.add(e)},removeOnCallIncomingVideoAddRequestReceivedCallback:function(e){this._onCallIncomingVideoAddRequestReceivedCallbacks.remove(e)},addOnCallIncomingVideoAddRequestAcceptedCallback:function(e){this._onCallIncomingVideoAddRequestAcceptedCallbacks.add(e)},removeOnCallIncomingVideoAddRequestAcceptedCallback:function(e){this._onCallIncomingVideoAddRequestAcceptedCallbacks.remove(e)},addOnCallIncomingVideoAddRequestDeniedCallback:function(e){this._onCallIncomingVideoAddRequestDeniedCallbacks.add(e)},removeOnCallIncomingVideoAddRequestDeniedCallback:function(e){this._onCallIncomingVideoAddRequestDeniedCallbacks.remove(e)},addOnCallIncomingVideoAddRequestTimedOutCallback:function(e){this._onCallIncomingVideoAddRequestTimedOutCallbacks.add(e)},removeOnCallIncomingVideoAddRequestTimedOutCallback:function(e){this._onCallIncomingVideoAddRequestTimedOutCallbacks.remove(e)},addOnCallVideoRemovedRemotelyCallback:function(e){},removeOnCallVideoRemovedRemotelyCallback:function(e){},addOnCallConferenceStatusChangedCallback:function(e){this._onCallConferenceStatusChangedCallbacks.add(e)},removeOnCallConferenceStatusChangedCallback:function(e){this._onCallConferenceStatusChangedCallbacks.remove(e)},addOnParticipantDroppedCallback:function(e){this._participantDroppedCallbacks.add(e)},removeOnParticipantDroppedCallback:function(e){this._participantDroppedCallbacks.remove(e)},addOnCallFailedCallback:function(e){this._callFailedCallbacks.add(e)},removeOnCallFailedCallback:function(e){this._callFailedCallbacks.remove(e)},addOnCallServiceAvailableCallback:function(e){this._callServiceAvailableCallbacks.add(e)},removeOnCallServiceAvailableCallback:function(e){this._callServiceAvailableCallbacks.remove(e)},addOnCallServiceUnavailableCallback:function(e){this._callServiceUnavailableCallbacks.add(e)},removeOnCallServiceUnavailableCallback:function(e){this._callServiceUnavailableCallbacks.remove(e)},addOnAnswerCallRequestedCallback:function(e){this._answerCallRequestedCallbacks.add(e)},removeOnAnswerCallRequestedCallback:function(e){this._answerCallRequestedCallbacks.remove(e)},addOnUpdateCallRequestedCallback:function(e){this._updateCallRequestedCallbacks.add(e)},removeOnUpdateCallRequestedCallback:function(e){this._updateCallRequestedCallbacks.remove(e)},addOnTerminateCallRequestedCallback:function(e){this._terminateCallRequestedCallbacks.add(e)},removeOnTerminateCallRequestedCallback:function(e){this._terminateCallRequestedCallbacks.remove(e)},addOnServiceQualityScoreChangedCallback:function(e){this._serviceQuality.addOnScoreChangedCallback(e)},removeOnServiceQualityScoreChangedCallback:function(e){this._serviceQuality.removeOnScoreChangedCallback(e)},addOnMediaConnectedCallback:function(e){this._mediaConnectedCallbacks.add(e)},removeOnMediaConnectedCallback:function(e){this._mediaConnectedCallbacks.remove(e)},addOnMediaDisconnectedCallback:function(e){this._mediaDisconnectedCallbacks.add(e)},removeOnMediaDisconnectedCallback:function(e){this._mediaDisconnectedCallbacks.remove(e)},addOnMediaFailedCallback:function(e){this._mediaFailedCallbacks.add(e)},removeOnMediaFailedCallback:function(e){this._mediaFailedCallbacks.remove(e)},_addOnCallStateChangedCallback:function(e){this._callStateChangedCallBacks.add(e)},_removeOnCallStateChangedCallback:function(e){this._callStateChangedCallBacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Call.Call.prototype,{getHoldCapability:function(){return this._holdCapability},getUnholdCapability:function(){return this._unholdCapability},getJoinCapability:function(){return this._joinCapability},getMuteCapability:function(){return this._muteCapability},getUnmuteCapability:function(){return this._unmuteCapability},getMuteVideoCapability:function(){return this._muteVideoCapability},getUnmuteVideoCapability:function(){return this._unmuteVideoCapability},getMuteSpeakerCapability:function(){return this._muteSpeakerCapability},getUnmuteSpeakerCapability:function(){return this._unmuteSpeakerCapability},getSendDTMFCapability:function(){return this._sendDTMFCapability},getTransferCapability:function(){return this._transferCapability},getTransferToCapability:function(){return this._transferToCapability},getUpdateVideoChannelsCapability:function(){return this._videoChannelsCapability},getUpdateVideoModeSendReceiveCapability:function(){return this._updateVideoModeSendReceiveCapability},getUpdateVideoModeSendOnlyCapability:function(){return this._updateVideoModeSendOnlyCapability},getUpdateVideoModeReceiveOnlyCapability:function(){return this._updateVideoModeReceiveOnlyCapability},getUpdateVideoModeInactiveCapability:function(){return this._updateVideoModeInactiveCapability},getUpdateVideoModeDisableCapability:function(){return this._updateVideoModeDisableCapability},getUpdateWebCollaborationCapability:function(){return this._updateWebCollaborationCapability},getUpdateAudioModeCapability:function(){return this._updateAudioModeCapability},getServiceQualityScoreCapability:function(){return this._serviceQualityScoreCapability},getSetNoiseReductionCapability:function(){return this._setNoiseReductionCapability},getSetBackgroundBlurCapability:function(){return this._setBackgroundBlurCapability},getSetBackgroundImageCapability:function(){return this._setBackgroundImageCapability}})}(AvayaClientServices),function(i){"use strict";function e(e,t){this._callManager=e,this._isAvailable=T,this._callService=t,this._callCreatedCallbacks=S.Callbacks(),this._callRemovedCallbacks=S.Callbacks(),this._incomingCallCallbacks=S.Callbacks(),this._undeliveredCallCallbacks=S.Callbacks(),this._callsServiceAvailableCallbacks=S.Callbacks(),this._callsServiceUnavailableCallbacks=S.Callbacks(),this._makeCallRequestedCallbacks=S.Callbacks(),this._voipCallingCapability=new i.Services.Call.Capabilities.VoipCallingCapability(this),this._setOnNetworkEventsCapability=new i.Services.Call.Capabilities.SetOnNetworkEventsCapability(t),this._removeOnNetworkEventsCapability=new i.Services.Call.Capabilities.RemoveOnNetworkEventsCapability(t),this._callService.on(i.Providers.Interfaces.CallServiceCallbackIds.INCOMING_CALL,function(e){this._incomingCallCallbacks.fire(e)}.bind(this)),this._callService.on(i.Providers.Interfaces.CallServiceCallbackIds.MAKE_CALL_REQUESTED,function(e){this._makeCallRequestedCallbacks.fire(e)}.bind(this)),this._voipCallingCapability._recalculate(),this._callManager.setCalls(this),this._hasCallsServiceRegistrationTriggered=!1,this._onCallsServiceRegistration=T,this._onRingbackToneURLsChangedCallback=S.Callbacks()}e.prototype={createCall:function(e){if(!e.isPresentationModeOnly()&&!this.getVoipCallingCapability().isAllowed)throw new i.Services.Call.CallException(this.getVoipCallingCapability().denialReason);if(e.getServiceGatewayURL()!==T&&e.getPortalToken()===T&&e.getAuthorizationToken()===T)throw i.Base.Logger.error(i.Base.LoggerTags.CALL_SERVICE,"Failed to create a call - token is invalid"),new i.Services.Call.CallException(i.Services.Call.CallError.INVALID_PARAMETER);var t=this._callManager.createCall(this._callService);return t._remoteAddress=e.getRemoteAddress(),t._subject=e.getSubject(),t._dataOnly=e.isPresentationModeOnly(),t._callCreationInfo=e,t.getUpdateWebCollaborationCapability()._recalculate(),t.getUpdateAudioModeCapability()._recalculate(),t.getServiceQualityScoreCapability()._recalculate(),t._dataOnly&&(e=new i.Services.Call.Modes.ConferenceCallMode(t,i.Services.Call.CallModes.CONFERENCE_CALL,this._callService._contactsIntegrationService),this._callManager.setCallMode(t,e)),i.Base.Utils.isDefined(this._callService._config.wcsConfiguration)&&i.Base.Utils.isDefined(this._callService._config.wcsConfiguration.enabled)&&(t._webCollaboration=this._callService._config.wcsConfiguration.enabled),t},createDefaultCall:function(){if(!this._callService._config._mediaServiceConfiguration)throw i.Base.Logger.error(i.Base.LoggerTags.CALL_SERVICE,"Failed to create call - media service context is invalid"),new i.Services.Call.CallException(i.Services.Call.CallError.INVALID_PARAMETER);if(0<this._callManager._getLiveCallCount())throw new i.Services.Call.CallException(i.Services.Call.CallError.MULTIPLE_CALLS_NOT_SUPPORTED);var e,t=new i.Services.Call.CallCreationInfo("",!1,"");return(e=this._callManager.createCall(this._callService))._sessionId=this._callService._config._mediaServiceConfiguration.sessionId,e._callCreationInfo=t,e.getUpdateWebCollaborationCapability()._recalculate(),e.getUpdateAudioModeCapability()._recalculate(),e.getSetNoiseReductionCapability()._recalculate(),i.Base.Logger.info(i.Base.LoggerTags.CALL_SERVICE,"session id: "+e._sessionId),e},getCalls:function(){return this._callManager.getAllCalls()},getCallCount:function(){return this._callManager.getCallCount()},getActiveCall:function(){return this._callManager.getActiveCall()},getIgnoredCalls:function(){return this._callManager.getIgnoredCalls()},getVideoCapability:function(){return this._callService.getVideoCapability()},hasHeldCall:function(){return this._callManager.hasHeldCall()},hasInitiatingCall:function(){return this._callManager.hasInitiatingCall()},getVoipCallingCapability:function(){return this._voipCallingCapability},getSetOnNetworkEventsCapability:function(){return this._setOnNetworkEventsCapability},getRemoveOnNetworkEventsCapability:function(){return this._removeOnNetworkEventsCapability},setOnNetworkEvents:function(e,t){return this._callService.setOnNetworkEvents(e,t)},removeOnNetworkEvents:function(){return this._callService.removeOnNetworkEvents()},isAvailable:function(){return this._isAvailable},_triggerRegistrationStatus:function(e){!this._hasCallsServiceRegistrationTriggered&&this._onCallsServiceRegistration&&(this._hasCallsServiceRegistrationTriggered=!0,this._onCallsServiceRegistration(e))},_start:function(){return this._callService.start(this)},_stop:function(){return this._callService.stop().always(function(){this._cleanupAndTriggerServiceUnavailable()}.bind(this))},_stopImmediately:function(){return this._callService.stopImmediately().always(function(){for(var e=0;e<this._callManager._calls.length;e++)this._callManager._calls[e].isConference()&&this._callManager._calls[e]._conference.stopImmediately();this._cleanupAndTriggerServiceUnavailable()}.bind(this))},_cleanupAndTriggerServiceUnavailable:function(){this._callsServiceUnavailableCallbacks.fire(this),this._isAvailable=T,this._callManager._calls=[],this._resetCallbacks()},_resetCallbacks:function(){this._callRemovedCallbacks.empty(),this._incomingCallCallbacks.empty(),this._undeliveredCallCallbacks.empty(),this._callsServiceAvailableCallbacks.empty(),this._callsServiceUnavailableCallbacks.empty(),this._callCreatedCallbacks.empty()},_isWebRTCSupportedBrowser:function(){return this._callService._isWebRTCSupportedBrowser()},_uploadLogs:function(){return this._callService.uploadLogs()},_isRegistrationTerminated:function(){return this._callService.isRegistrationTerminated()}},i.Base.AOPTools.addAdvices(e,"Calls",["createCall","createDefaultCall"],[i.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_EXCEPTION]),i.Services.Call.Calls=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Call.Calls.prototype,{addOnCallsServiceAvailableCallback:function(e){this._callsServiceAvailableCallbacks.add(e)},removeOnCallsServiceAvailableCallback:function(e){this._callsServiceAvailableCallbacks.remove(e)},addOnCallsServiceUnavailableCallback:function(e){this._callsServiceUnavailableCallbacks.add(e)},removeOnCallsServiceUnavailableCallback:function(e){this._callsServiceUnavailableCallbacks.remove(e)},addOnCallCreatedCallback:function(e){this._callCreatedCallbacks.add(e)},removeOnCallCreatedCallback:function(e){this._callCreatedCallbacks.remove(e)},addOnCallRemovedCallback:function(e){this._callRemovedCallbacks.add(e)},removeOnCallRemovedCallback:function(e){this._callRemovedCallbacks.remove(e)},addOnIncomingCallCallback:function(e){this._incomingCallCallbacks.add(e)},removeOnIncomingCallCallback:function(e){this._incomingCallCallbacks.remove(e)},addOnUndeliveredCallCallback:function(e){this._undeliveredCallCallbacks.add(e)},removeOnUndeliveredCallCallback:function(e){this._undeliveredCallCallbacks.remove(e)},addOnRingbackToneURLsChangedCallback:function(e){this._onRingbackToneURLsChangedCallback.add(e)},removeOnRingbackToneURLsChangedCallback:function(e){this._onRingbackToneURLsChangedCallback.remove(e)},addOnMakeCallRequestedCallback:function(e){this._makeCallRequestedCallbacks.add(e)},removeOnMakeCallRequestedCallback:function(e){this._makeCallRequestedCallbacks.remove(e)}})}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;return e=t&&!i?a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:e},a.Services.Call.Capabilities.AbstractCallMuteCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&this._call.isAudioMuted()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.MuteCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&this._call.isSpeakerMuted()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.MuteSpeakerCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&!this._call.isAudioMuted()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.UnmuteCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&!this._call.isSpeakerMuted()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.UnmuteSpeakerCapability=e}(AvayaClientServices),function(t){"use strict";function e(e){this._channelId=T,this._requestedDirection=T,this._internalRequestedDirection=T,this._negotiatedDirection=T,this._disabledReason=t.Services.Call.VideoChannelDisabledReason.NONE,this._isCameraAccessDenied=!1,this._call=e,this._preferredResolution=null,this._preferredReceiveResolution=T,this._cameraDenialReason=T}e.prototype={getChannelId:function(){return this._channelId},getNegotiatedDirection:function(){return this._negotiatedDirection},getRequestedDirection:function(){return this._requestedDirection},getNegotiatedResolution:function(){return this.isDisabled()||this._negotiatedDirection===t.Services.Call.MediaDirection.INACTIVE?T:this._call._callService.getVideoResolution(this._call)},getVideoDisabledReason:function(){return this._disabledReason},getCameraDenialReason:function(){return this._cameraDenialReason},isDisabled:function(){return this._disabledReason!==t.Services.Call.VideoChannelDisabledReason.NONE},isCameraAccessDenied:function(){return this._isCameraAccessDenied},setPreferredResolution:function(e){return this._call._callService.updatePreferredResolution(this,e)},setPreferredReceiveResolution:function(e){if(null===this._preferredResolution)return this._call._callService.setPreferredReceiveResolution(this._call,this._channelId,e);e=t.Base.Utils.getLowerResolution(e,this._preferredResolution);return this._call._callService.setPreferredReceiveResolution(this._call,this._channelId,e)},getUpdatePreferredReceiveResolutionCapability:function(){return this._call._preferredReceiveResolutionCapability},getPreferredResolution:function(){return this._preferredResolution},getPreferredReceiveResolution:function(){return this._preferredReceiveResolution},_setRequestedDirection:function(e){this._requestedDirection=e,(this._internalRequestedDirection=e)===t.Services.Call.MediaDirection.DISABLE&&(this._disabledReason=t.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)},_setNegotiatedDirection:function(e){(this._negotiatedDirection=e)!==t.Services.Call.MediaDirection.INACTIVE&&e!==t.Services.Call.MediaDirection.DISABLE&&(this._disabledReason=t.Services.Call.VideoChannelDisabledReason.NONE)},_setInternalRequestedDirection:function(e){this._internalRequestedDirection=e},_getInternalRequestedDirection:function(){return this._internalRequestedDirection},_setChannelId:function(e){this._channelId=e},_setVideoDisabledReason:function(e){this._disabledReason=e},_setCameraConstraint:function(e){this._isCameraAccessDenied=e.error===t.Services.Call.CallError.CAMERA_PERMISSION_DENIED,this._cameraDenialReason=e.reason}},t.Base.AOPTools.addAdvices(e,"VideoChannel",["setPreferredResolution","setPreferredReceiveResolution"],[t.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,t.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_ERROR]),t.Services.Call.VideoChannel=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){this._collaborationService=e,this._whiteboard=t,this._contentSharing=i,this._slider=a,this._collaborationId=r,this._callId=s,this._callService=n,this._isAvailable=T,this._participants=new o.Base.DataSet,this._selfParticipant=T,this._supportedFeatures=[o.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING,o.Services.Collaboration.FeaturesAvailable.WHITEBOARD,o.Services.Collaboration.FeaturesAvailable.SLIDER,o.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING],this._onCollaborationStartedCallbacks=S.Callbacks(),this._onCollaborationEndedCallbacks=S.Callbacks("unique"),this._onCollaborationServiceAvailableCallbacks=S.Callbacks("unique"),this._onCollaborationServiceUnavailableCallbacks=S.Callbacks("unique"),this._onCollaborationNearEndByEjectCallbacks=S.Callbacks("unique"),this._onCollaborationPresenterPrivilegeChangedCallbacks=S.Callbacks("unique"),this._onCollaborationModeratorPrivilegeChangedCallbacks=S.Callbacks("unique"),this._onCollaborationInitializedCallbacks=S.Callbacks("unique"),this._isPaused=!1,this._chatCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._meetingMinutesCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._networkLibraryCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._librarySharingCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._whiteboardCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveParticipantListCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sliderCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._isStarted=!1,this._isStopped=!0,this._config=T,this._meetingId=T,this._isReceivingSharingPaused=!1}e.prototype={start:function(e,t){if(o.Base.Utils.isDefined(e)&&o.Base.Utils.isDefined(t)&&(this._config=e,this._meetingId=t),o.Base.Utils.isDefined(this._config)&&o.Base.Utils.isDefined(this._meetingId))return this._collaborationService.start(this,this._config,this._meetingId).then(function(){this._contentSharing._start()}.bind(this));o.Base.Logger.error(o.Base.LoggerTags.COLLABORATION_SERVICE,"Configuration or meeting Id is missing");t=o.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE;return S.Deferred().reject(new o.Services.Collaboration.CollaborationError(t)).promise()},stop:function(){return this._contentSharing._collaborationEnd=!0,this._contentSharing.end().always(function(){this._contentSharing._stop()}.bind(this)),this._whiteboard.stop(),this._collaborationService.stop(this)},getContentSharing:function(){return this._contentSharing},getWhiteboard:function(){return this._whiteboard},getParticipants:function(){return this._collaborationService.getParticipants(this)},getCallId:function(){return this._callId},getCollaborationId:function(){return this._collaborationId},hasPresenterPrivilege:function(){},isEjected:function(){},hasModeratorPrivilege:function(){},pause:function(){return this._isReceivingSharingPaused=!0,this._collaborationService.pause(this)},resume:function(){return this._isReceivingSharingPaused=!1,this._collaborationService.resume(this)},_setConfiguration:function(e,t){this._config=e,this._meetingId=t},getSlider:function(){return this._slider},isReceivingSharingPaused:function(){return this._isReceivingSharingPaused},_setSelfParticipant:function(e){this._selfParticipant=e,this._selfParticipant&&this._selfParticipant instanceof o.Services.Participant&&(this._selfParticipant._localUser=!0),this._participants.push(this._selfParticipant),this._participants.onDataSetChanged([this._selfParticipant],o.Base.DataSetChangeTypes.ADDED)}},o.Base.AOPTools.addAdvices(e,"Collaboration",["getParticipants"],[o.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),o.Base.AOPTools.addAdvices(e,"Collaboration",["start","stop","pause","resume"],[o.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,o.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),o.Services.Collaboration.Collaboration=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Collaboration.Collaboration.prototype,{addOnCollaborationStartedCallback:function(e){this._onCollaborationStartedCallbacks.add(e)},removeOnCollaborationStartedCallback:function(e){this._onCollaborationStartedCallbacks.remove(e)},addOnCollaborationEndedCallback:function(e){this._onCollaborationEndedCallbacks.add(e)},removeOnCollaborationEndedCallback:function(e){this._onCollaborationEndedCallbacks.remove(e)},addOnCollaborationServiceAvailableCallback:function(e){this._onCollaborationServiceAvailableCallbacks.add(e)},removeOnCollaborationServiceAvailableCallback:function(e){this._onCollaborationServiceAvailableCallbacks.remove(e)},addOnCollaborationServiceUnavailableCallback:function(e){this._onCollaborationServiceUnavailableCallbacks.add(e)},removeOnCollaborationServiceUnavailableCallback:function(e){this._onCollaborationServiceUnavailableCallbacks.remove(e)},addOnCollaborationNearEndByEjectCallback:function(e){this._onCollaborationNearEndByEjectCallbacks.add(e)},removeOnCollaborationNearEndByEjectCallback:function(e){this._onCollaborationNearEndByEjectCallbacks.remove(e)},addOnCollaborationPresenterPrivilegeChangedCallback:function(e){this._onCollaborationPresenterPrivilegeChangedCallbacks.add(e)},removeOnCollaborationPresenterPrivilegeChangedCallback:function(e){this._onCollaborationPresenterPrivilegeChangedCallbacks.remove(e)},addOnCollaborationModeratorPrivilegeChangedCallback:function(e){this._onCollaborationModeratorPrivilegeChangedCallbacks.add(e)},removeOnCollaborationModeratorPrivilegeChangedCallback:function(e){this._onCollaborationModeratorPrivilegeChangedCallbacks.remove(e)},addOnCollaborationInitializedCallback:function(e){this._onCollaborationInitializedCallbacks.add(e)},removeOnCollaborationInitializedCallback:function(e){this._onCollaborationInitializedCallbacks.remove(e)}})}(AvayaClientServices),function(o){"use strict";var e={getChatCapability:function(){return this._chatCapability},_recalculateChatCapability:function(){var e,t=this._isAvailable,i=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.MESSAGES),i=t&&i&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._chatCapability._updateIfChanged(e,i)},getMeetingMinutesCapability:function(){return this._meetingMinutesCapability},_recalculateMeetingMinutesCapability:function(){var e,t=this._isAvailable,i=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.MINUTES),i=t&&i&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._meetingMinutesCapability._updateIfChanged(e,i)},getContentSharingCapability:function(){return this._contentSharingCapability},_recalculateContentSharingCapability:function(e){var t,i=this._isAvailable,a=this._contentSharing.getShareApplicationWindowCapability(),r=this._contentSharing.getShareApplicationWindowCapability().isAllowed||this._contentSharing.getShareFullScreenCapability().isAllowed||this._contentSharing.getStartScreenSharingCapability().isAllowed||this._contentSharing.getStartSharingUsingVideoCapability().isAllowed,s=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),n=!e||!!e._selfParticipant&&e._selfParticipant._presenter,e=o.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable()||o.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable()||o.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable()||o.Providers.ContentSharing.FeatureSupported.isSharingContentVideoAvailable(),a=i&&e&&r&&s&&n?(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):e?e&&!r&&a.denialReason===o.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._contentSharingCapability._updateIfChanged(t,a)},getNetworkLibraryCapability:function(){return this._networkLibraryCapability},_recalculateNetworkLibraryCapability:function(){var e,t=this._isAvailable,i=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.LIBRARY),i=t&&i&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._networkLibraryCapability._updateIfChanged(e,i)},getLibrarySharingCapability:function(){return this._librarySharingCapability},_recalculateLibrarySharingCapability:function(){var e,t=this._isAvailable,i=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.LIBRARY),i=t&&i&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._librarySharingCapability._updateIfChanged(e,i)},getWhiteboardCapability:function(){return this._whiteboardCapability},_recalculateWhiteboardCapability:function(e){var t,i=this._isAvailable,a=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.WHITEBOARD),e=!e||!!e._selfParticipant&&e._selfParticipant._presenter,e=i&&a&&this._isBrowserAllowed()&&e?(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._whiteboardCapability._updateIfChanged(t,e)},getRetrieveParticipantListCapability:function(){return this._retrieveParticipantListCapability},_recalculateRetrieveParticipantListCapability:function(){var e,t=this._isAvailable&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._retrieveParticipantListCapability._updateIfChanged(e,t)},_isBrowserAllowed:function(){return!0},getSliderCapability:function(){return this._sliderCapability},_recalculateSliderCapability:function(){var e,t=this._isAvailable,i=this._collaborationService.isFeatureSupported(this,o.Services.Collaboration.FeaturesAvailable.SLIDER),i=t&&i&&this._isBrowserAllowed()?(e=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._sliderCapability._updateIfChanged(e,i)}};S.extend(o.Services.Collaboration.Collaboration.prototype,e)}(AvayaClientServices),function(a){"use strict";function e(e,t){this._factory=e,this._callService=t,this._collaborationsStore={},this._onActiveContentSharingChangedCallback=S.Callbacks(),this._activeContentSharing=T}e.prototype={getCollaborationForCall:function(e){for(var t in a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._collaborationsStore)if(this._collaborationsStore.hasOwnProperty(t)&&this._collaborationsStore[t].getCallId()===e)return this._collaborationsStore[t];return this._createAndSaveCollaboration(e)},getCollaborationById:function(e){return this._collaborationsStore.hasOwnProperty(e)?this._collaborationsStore[e]:this._createAndSaveCollaboration(e)},_generateUniqueIdForCollaboration:function(){var e=a.Base.Utils.makeId();return this._collaborationsStore.hasOwnProperty(e)?this._generateUniqueIdForCollaboration():e},_createAndSaveCollaboration:function(e){e=this._factory.create(this,this._generateUniqueIdForCollaboration(),e);return this._collaborationsStore[e.getCollaborationId()]=e},_isCollaborationForCall:function(e){var t,i=!1;if(a.Base.Utils.isUndefined(e))return i;for(t in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(t)&&this._collaborationsStore[t].getCallId()===e&&(i=!0);return i},_deleteCollaboration:function(e){this._collaborationsStore[e]&&delete this._collaborationsStore[e]},_stopAndDeleteAllCollaborations:function(){for(var e in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(e)&&(this._collaborationsStore[e].stop(),this._deleteCollaboration(e));return this._collaborationsStore={},S.Deferred().resolve().promise()},_stopImmediately:function(){for(var e in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(e)&&(this._collaborationsStore[e]._isStarted=!1,this._collaborationsStore[e]._isAvailable&&(this._collaborationsStore[e]._isAvailable=T,this._collaborationsStore[e]._onCollaborationServiceUnavailableCallbacks.fire(this._collaborationsStore[e])),this._collaborationsStore[e]._isStopped=!0,a.Base.Logger.debug(a.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service stop",e),delete this._collaborationsStore[e]);return S.Deferred().resolve().promise()}},a.Base.AOPTools.addAdvices(e,"Collaborations",["getCollaborationById","getCollaborationForCall"],[a.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),a.Services.Collaboration.Collaborations=e}(AvayaClientServices),function(i){"use strict";function e(e,t){this._contentSharingService=e,this._collaborations=t,this._collaborations._onActiveContentSharingChangedCallback.add(this._onActiveContentSharingChanged.bind(this)),this._collaborationEnd=!1,this._collaboration=T,this._isPaused=!1,this._onContentSharingStartedCallbacks=S.Callbacks(),this._onCaptureEndedCallbacks=S.Callbacks(),this._onContentSharingEndedCallbacks=S.Callbacks(),this._onContentSharingPausedCallbacks=S.Callbacks(),this._onContentSharingResumedCallbacks=S.Callbacks(),this._onCursorReceivedCallbacks=S.Callbacks(),this._onFrameStartReceivedCallbacks=S.Callbacks(),this._onFrameEndReceivedCallbacks=S.Callbacks(),this._onFrameReceivedCallbacks=S.Callbacks(),this._onFrameChangedCallbacks=S.Callbacks(),this._onBlockReceivedCallbacks=S.Callbacks(),this._onFrameReportReceivedCallbacks=S.Callbacks(),this._onScreenSharingUsingVideoStartedCallbacks=S.Callbacks(),this._onScreenSharingUsingVideoEndedCallbacks=S.Callbacks(),this._onAudioAddedToScreenSharingUsingVideoCallback=S.Callbacks(),this._shareApplicationWindowCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareFullScreenCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareAnyTypeCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareContentVideoCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingService.getShareFullScreenCapability()._onChangedCallbacks.add(function(){this._recalculateShareFullScreenCapability(this._collaboration)}.bind(this)),this._contentSharingService.getShareApplicationWindowCapability()._onChangedCallbacks.add(function(){this._recalculateShareApplicationWindowCapability(this._collaboration)}.bind(this)),this._contentSharingService.getShareAnyTypeCapability()._onChangedCallbacks.add(function(){this._recalculateShareAnyTypeCapability(this._collaboration)}.bind(this)),this._contentSharingService.getStartSharingUsingVideoCapability()._onChangedCallbacks.add(function(){this._recalculateShareContentVideoCapability(this._collaboration)}.bind(this))}e.prototype={_start:function(){this._contentSharingService.start(this)},_stop:function(){this._contentSharingService.stop(this)},_setCollaboration:function(e){this._collaboration=e},_setMaxUploadSpeed:function(e){this._contentSharingService.setMaxUploadSpeed(e)},setExtensionAvailable:function(e){this._contentSharingService.setExtensionAvailable(e)},startScreenSharingFullScreen:function(e){var t;return this._contentSharingService.isDisplayMediaAvailable()&&(t=i.Base.ErrorReasons.DEPRECATED+" Please use ContentSharing.startScreenSharing instead of ContentSharing.startScreenSharingFullscreen",i.Base.Logger.warn(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,t)),this._contentSharingService.startScreenSharingFullScreen(this,e)},startScreenCapture:function(){return this._contentSharingService.startScreenCapture(this)},startScreenSharing:function(){var e=this.getOutgoingCapturedStream();return this._contentSharingService.startScreenSharingAnyType(this,e)},stopScreenCapture:function(){this._contentSharingService.stopScreenCapture()},startScreenSharingUsingVideo:function(e,t){return this._contentSharingService.startScreenSharingUsingVideo(this,e,t)},isSharingFullScreen:function(){return this._contentSharingService.isSharingFullScreen()},isScreenSharingUsingVideo:function(){return this._contentSharingService.isScreenSharingUsingVideo()},isScreenSharingUsingVideoWithAudio:function(){return this._contentSharingService.isScreenSharingUsingVideoWithAudio()},getReceivingBitrate:function(){return this._contentSharingService.getReceivingBitrate()},getOutgoingScreenSharingStream:function(){return this._contentSharingService.getOutgoingScreenSharingStream()},getOutgoingCapturedStream:function(){return this._contentSharingService.getOutgoingCapturedStream()},startSharingApplicationWindow:function(e){var t;return this._contentSharingService.isDisplayMediaAvailable()&&(t=i.Base.ErrorReasons.DEPRECATED+" Please use ContentSharing.startScreenSharing instead of ContentSharing.startSharingApplicationWindow",i.Base.Logger.warn(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,t)),this._contentSharingService.startSharingApplicationWindow(this,e)},isSharingApplicationWindow:function(){return this._contentSharingService.isSharingApplicationWindow()},end:function(){var e=this._collaborationEnd&&!(this.isSharingFullScreen()||this.isSharingApplicationWindow());return this._collaborationEnd=!1,this._clearActiveContentSharing(),this._contentSharingService.end(e,this)},isPresenting:function(){return this._contentSharingService.isPresenting()},isContentSharingActive:function(){return this._contentSharingService.isContentSharingActive()},isContentSharingPaused:function(){return this._contentSharingService.isContentSharingPaused()},pause:function(){return this._contentSharingService.pause()},resume:function(){return this._contentSharingService.resume()},_onActiveContentSharingChanged:function(){this._contentSharingService._recalculateAllContentSharingCapabilities(this)},_getCollaborations:function(){return this._collaborations},_clearActiveContentSharing:function(){var e=this._collaborations._activeContentSharing;e&&e===this&&(this._collaborations._activeContentSharing=T)},_endActiveScreenSharing:function(e){this._contentSharingService._endActiveScreenSharing(this,e)},_setImageQuality:function(e){this._contentSharingService.setImageQuality(e)},setScreenSharingVisibleRect:function(e){this._contentSharingService.setScreenSharingVisibleRect(e)},getScreenSharingVisibleRect:function(){return this._contentSharingService.getScreenSharingVisibleRect()},setScreenSharingMasks:function(e){this._contentSharingService.setScreenSharingMasks(e)},getScreenSharingMasks:function(){return this._contentSharingService.getScreenSharingMasks()},_notifyPerformanceMonitorAlert:function(e,t){this._contentSharingService.notifyPerformanceMonitorAlert(e,t)}},i.Base.AOPTools.addAdvices(e,"ContentSharing",["startScreenSharing","startScreenSharingUsingVideo","startScreenSharingFullScreen","startSharingApplicationWindow","startScreenSharingUsingVideo","startScreenCapture","stopScreenCapture","setScreenSharingVisibleRect","setScreenSharingMasks","end","pause","resume"],[i.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),i.Services.Collaboration.ContentSharing=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Collaboration.ContentSharing.prototype,{addOnContentSharingStartedCallback:function(e){this._onContentSharingStartedCallbacks.add(e)},removeOnContentSharingStartedCallback:function(e){this._onContentSharingStartedCallbacks.remove(e)},addOnContentSharingEndedCallback:function(e){this._onContentSharingEndedCallbacks.add(e)},removeOnContentSharingEndedCallback:function(e){this._onContentSharingEndedCallbacks.remove(e)},addOnCaptureEndedCallback:function(e){this._onCaptureEndedCallbacks.add(e)},removeOnCaptureEndedCallback:function(e){this._onCaptureEndedCallbacks.remove(e)},addOnContentSharingPausedCallback:function(e){this._onContentSharingPausedCallbacks.add(e)},removeOnContentSharingPausedCallback:function(e){this._onContentSharingPausedCallbacks.remove(e)},addOnContentSharingResumedCallback:function(e){this._onContentSharingResumedCallbacks.add(e)},removeOnContentSharingResumedCallback:function(e){this._onContentSharingResumedCallbacks.remove(e)},addOnScreenSharingUsingVideoStartedCallback:function(e){this._onScreenSharingUsingVideoStartedCallbacks.add(e)},removeOnScreenSharingUsingVideoStartedCallback:function(e){this._onScreenSharingUsingVideoStartedCallbacks.remove(e)},addOnScreenSharingUsingVideoEndedCallback:function(e){this._onScreenSharingUsingVideoEndedCallbacks.add(e)},removeOnScreenSharingUsingVideoEndedCallback:function(e){this._onScreenSharingUsingVideoEndedCallbacks.remove(e)},addOnAudioAddedToScreenSharingUsingVideoCallback:function(e){this._onAudioAddedToScreenSharingUsingVideoCallback.add(e)},removeOnAudioAddedToScreenSharingUsingVideoCallback:function(e){this._onAudioAddedToScreenSharingUsingVideoCallback.remove(e)},addOnCursorReceivedCallback:function(e){this._onCursorReceivedCallbacks.add(e)},removeOnCursorReceivedCallback:function(e){this._onCursorReceivedCallbacks.remove(e)},addOnFrameChangedCallback:function(e){this._onFrameChangedCallbacks.add(e)},removeOnFrameChangedCallback:function(e){this._onFrameChangedCallbacks.remove(e)},addOnFrameReceivedCallback:function(e){this._onFrameReceivedCallbacks.add(e)},removeOnFrameReceivedCallback:function(e){this._onFrameReceivedCallbacks.remove(e)},addOnFrameReportReceivedCallbacks:function(e){this._onFrameReportReceivedCallbacks.add(e)},removeOnFrameReportReceivedCallbacks:function(e){this._onFrameReportReceivedCallbacks.remove(e)}})}(AvayaClientServices),function(o){"use strict";var e={getShareApplicationWindowCapability:function(){return this._shareApplicationWindowCapability},_recalculateShareApplicationWindowCapability:function(e){var t,i=this._contentSharingService.getShareApplicationWindowCapability(),a=this._contentSharingService.isOpened(),r=this._contentSharingService.isFeatureAvailable(o.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),s=o.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,n=o.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable(),e=!e||!!e._selfParticipant&&e._selfParticipant._presenter,i=n&&i.isAllowed&&a&&r&&e?s?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):n?n&&!i.isAllowed?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareApplicationWindowCapability._updateIfChanged(t,i)},getShareFullScreenCapability:function(){return this._shareFullScreenCapability},_recalculateShareFullScreenCapability:function(e){var t,i=this._contentSharingService.getShareFullScreenCapability(),a=this._contentSharingService.isOpened(),r=this._contentSharingService.isFeatureAvailable(o.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),s=o.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,n=o.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable(),e=!e||!!e._selfParticipant&&e._selfParticipant._presenter,i=n&&i.isAllowed&&a&&r&&e?s?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):n?n&&!i.isAllowed?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareFullScreenCapability._updateIfChanged(t,i)},getStartScreenSharingCapability:function(){return this._shareAnyTypeCapability},_recalculateShareAnyTypeCapability:function(e){var t,i=this._contentSharingService.getShareAnyTypeCapability(),a=this._contentSharingService.isOpened(),r=this._contentSharingService.isFeatureAvailable(o.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),s=o.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,n=o.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable(),e=!e||!!e._selfParticipant&&e._selfParticipant._presenter,i=n&&i.isAllowed&&a&&r&&e?s?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):n?n&&!i.isAllowed?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareAnyTypeCapability._updateIfChanged(t,i)},getStartSharingUsingVideoCapability:function(){return this._shareContentVideoCapability},_recalculateShareContentVideoCapability:function(e){var t,i=this._contentSharingService.getStartSharingUsingVideoCapability(),a=this._contentSharingService.isFeatureAvailable(o.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING),r=o.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,e=!e||!!e._selfParticipant&&e._selfParticipant._presenter,e=this._contentSharingService.isScreenSharingUsingVideoAllowed()?i.isAllowed&&e&&a?r?(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,e?o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED:o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);this._shareContentVideoCapability._updateIfChanged(t,e)},getSupportRemoteControlCapability:function(){return new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)},getRequestRemoteControlCapability:function(){return new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)}};S.extend(o.Services.Collaboration.ContentSharing.prototype,e)}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Participant.call(this),this._participantId=e,this._displayName=t,this._presenter=!1}(e.prototype=Object.create(i.Services.Participant.prototype)).isPresenter=function(){return this._presenter},i.Services.Collaboration.Participant=e}(AvayaClientServices),function(t){"use strict";function e(e){this._collaboration=T,this._whiteboardService=e,this._activeSurface=T,this._currentLiveDrawingWhiteboardIds=[],this._currentLiveDrawingShapes=[],this._onWhiteboardStartedCallbacks=S.Callbacks(),this._onWhiteboardEndedCallbacks=S.Callbacks(),this._onWhiteboardSurfaceAddedCallbacks=S.Callbacks(),this._onWhiteboardSurfaceRemovedCallbacks=S.Callbacks(),this._onWhiteboardSurfaceSetActiveCallbacks=S.Callbacks(),this._recentlyActiveSurface=T,this._surfaces=new t.Base.DataSet,this._removeWhiteboardCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._drawingCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addWhiteboardCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}e.prototype={start:function(){return this._whiteboardService.start(this)},end:function(){return this._whiteboardService.end(this)},stop:function(){return this._whiteboardService.stop(this)},requestNewSurface:function(){return this._whiteboardService.requestNewSurface(this)},removeSurface:function(e){return this._whiteboardService.removeSurface(this,e)},getSurfaces:function(){return this._surfaces},getSurfaceById:function(t){return this._surfaces.filter(function(e){return e.getSurfaceId()===t})[0]},getActiveSurface:function(){return this._activeSurface},_setCollaboration:function(e){this._collaboration=e}},t.Base.AOPTools.addAdvices(e,"Whiteboard",["start","stop","end","requestNewSurface","removeSurface"],[t.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,t.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),t.Services.Collaboration.Whiteboard=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Collaboration.Whiteboard.prototype,{addOnWhiteboardStartedCallback:function(e){this._onWhiteboardStartedCallbacks.add(e)},removeOnWhiteboardStartedCallback:function(e){this._onWhiteboardStartedCallbacks.remove(e)},addOnWhiteboardEndedCallback:function(e){this._onWhiteboardEndedCallbacks.add(e)},removeOnWhiteboardEndedCallback:function(e){this._onWhiteboardEndedCallbacks.remove(e)},addOnWhiteboardSurfaceAddedCallback:function(e){this._onWhiteboardSurfaceAddedCallbacks.add(e)},removeOnWhiteboardSurfaceAddedCallback:function(e){this._onWhiteboardSurfaceAddedCallbacks.remove(e)},addOnWhiteboardSurfaceRemovedCallback:function(e){this._onWhiteboardSurfaceRemovedCallbacks.add(e)},removeOnWhiteboardSurfaceRemovedCallback:function(e){this._onWhiteboardSurfaceRemovedCallbacks.remove(e)},addOnWhiteboardSurfaceSetActiveCallback:function(e){this._onWhiteboardSurfaceSetActiveCallbacks.add(e)},removeOnWhiteboardSurfaceSetActiveCallback:function(e){this._onWhiteboardSurfaceSetActiveCallbacks.remove(e)}})}(AvayaClientServices),function(r){"use strict";var e={getAddWhiteboardCapability:function(){return this._addWhiteboardCapability},_recalculateAddWhiteboardCapability:function(e){var t,e=!!e&&!!e._selfParticipant&&e._selfParticipant._presenter,e=this.getActiveSurface()&&e?(t=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addWhiteboardCapability._updateIfChanged(t,e)},getRemoveWhiteboardCapability:function(){return this._removeWhiteboardCapability},_recalculateRemoveWhiteboardCapability:function(e){var t,e=!!e&&!!e._selfParticipant&&e._selfParticipant._presenter,e=this.getActiveSurface()&&1<this._surfaces.length&&e?(t=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeWhiteboardCapability._updateIfChanged(t,e)},getDrawingCapability:function(){return this._drawingCapability},_recalculateDrawingCapability:function(e){var t,i=e._isAvailable,a=e._collaborationService.isFeatureSupported(e,r.Services.Collaboration.FeaturesAvailable.WHITEBOARD),e=i&&a&&e._isBrowserAllowed()?(t=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._drawingCapability._updateIfChanged(t,e)}};S.extend(r.Services.Collaboration.Whiteboard.prototype,e)}(AvayaClientServices),function(i){"use strict";function e(){this.possibleColors=["#cd2029","#f58521","#f3e913","#652d90","#3659a7","#2a8b45","#211e1e","#ffffff","#959595"],this._whiteboard=T,this._collaboration=T,this._ended=!1,this._callbacks={},this._onShowShapeAnnotationCallbacks=S.Callbacks()}e.prototype={init:function(e,a){(this._whiteboard=e).addOnWhiteboardStartedCallback(function(e,t){this._ended=!1,i.Base.Utils.isDefined(t)&&this.start(a)}.bind(this)),e.addOnWhiteboardEndedCallback(function(e){this._ended=!0,this.end(a)}.bind(this)),e.addOnWhiteboardSurfaceAddedCallback(function(e,t){var i=[{name:"OnShapeAddedCallback",callback:function(e,t){e.isActive()&&this.drawShape(t)}.bind(this)},{name:"OnShapeDeletedCallback",callback:function(e,t){this.removeShape(t)}.bind(this)},{name:"OnShapeUpdatedCallback",callback:function(e,t){this.updateShape(t)}.bind(this)},{name:"OnSurfaceClearedCallback",callback:function(e){this.clearContent()}.bind(this)}];i.forEach(function(e){t["add"+e.name](e.callback)}),this._callbacks[t.getSurfaceId()]=i}.bind(this)),e.addOnWhiteboardSurfaceRemovedCallback(function(e,t){this._callbacks[t.getSurfaceId()].forEach(function(e){t["remove"+e.name](e.callback)}),this._callbacks[t.getSurfaceId()]=T}.bind(this)),e.addOnWhiteboardSurfaceSetActiveCallback(function(e,t){if(this._ended&&this.start(a),this.clearContent(),t)for(var i in t.getShapes())t.getShapes().hasOwnProperty(i)&&this.drawShape(t.getShapes()[i])}.bind(this))},start:function(){},end:function(){},drawShape:function(e){},removeShape:function(e){},updateShape:function(e){},clearContent:function(){},addOnShowShapeAnnotationCallback:function(e){this._onShowShapeAnnotationCallbacks.add(e)},removeOnShowShapeAnnotationCallback:function(e){this._onShowShapeAnnotationCallbacks.remove(e)}},i.Base.AOPTools.addAdvices(e,"WhiteboardRenderer",["init"],[i.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),i.Services.Collaboration.WhiteboardRenderer=e}(AvayaClientServices),function(t){"use strict";function e(e,t){this._whiteboard=e,this._whiteboardService=t,this._shapes={},this._surfaceId=T,this._isDrawing=!1,this._active=!1,this._onShapeAddedCallbacks=S.Callbacks(),this._onShapeDeletedCallbacks=S.Callbacks(),this._onShapeUpdatedCallbacks=S.Callbacks(),this._onSurfaceClearedCallbacks=S.Callbacks()}e.prototype={getSurfaceId:function(){return this._surfaceId},setAsActive:function(){return this._whiteboardService.start(this._whiteboard,this)},addCircle:function(e){return this._appendShape(e._id,e),this._whiteboardService.addCircle(this,e)},addShape:function(e){return this._appendShape(e._id,e),e._onShapeFinished=function(){return this._whiteboardService.endDrawShape(this,e)}.bind(this),this._whiteboardService.addShape(this,e)},addText:function(e){return this._appendShape(e._id,e),this._whiteboardService.addText(this,e)},getShapes:function(){return this._shapes},isActive:function(){return this._active},clearContent:function(){return this._whiteboardService.clearContent(this)},updateShape:function(e){return this._whiteboardService.moveSelection(this,e)},removeShape:function(e){return this._whiteboardService.removeShape(this,e)},finishShape:function(e){return e.finishDrawing()},_appendShape:function(e,t){this._shapes[e]||(this._shapes[e]=t)},_getShapeById:function(e){if(t.Base.Utils.isDefined(this._shapes[e]))return this._shapes[e]},_removeShapeById:function(e){delete this._shapes[e]},_clearShapes:function(){this._shapes={}}},t.Base.AOPTools.addAdvices(e,"WhiteboardSurface",["finishShape","removeShape","updateShape","clearContent","addText","addShape","addCircle","setAsActive"],[t.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,t.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),t.Services.Collaboration.WhiteboardSurface=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Collaboration.WhiteboardSurface.prototype,{addOnShapeAddedCallback:function(e){this._onShapeAddedCallbacks.add(e)},removeOnShapeAddedCallback:function(e){this._onShapeAddedCallbacks.remove(e)},addOnShapeUpdatedCallback:function(e){this._onShapeUpdatedCallbacks.add(e)},removeOnShapeUpdatedCallback:function(e){this._onShapeUpdatedCallbacks.remove(e)},addOnShapeDeletedCallback:function(e){this._onShapeDeletedCallbacks.add(e)},removeOnShapeDeletedCallback:function(e){this._onShapeDeletedCallbacks.remove(e)},addOnSurfaceClearedCallback:function(e){this._onSurfaceClearedCallbacks.add(e)},removeOnSurfaceClearedCallback:function(e){this._onSurfaceClearedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";function e(e){this._chatService=e,this._selfParticipant=T,this._privateMessages=new i.Base.DataSet,this._publicMessages=new i.Base.DataSet,this._allMessages=new i.Base.DataSet,this._onChatMessageReceivedCallbacks=S.Callbacks(),this._onChatServiceAvailableCallbacks=S.Callbacks(),this._onChatServiceUnavailableCallbacks=S.Callbacks()}e.prototype={sendPrivateMessage:function(e,t){return i.Base.Utils.validate(t,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),i.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:i.Services.Conference.Participant}]}),this._chatService.sendMessage(this,t,e)},sendPublicMessage:function(e){return i.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._chatService.sendMessage(this,e)},getAllPrivateMessages:function(){return this._privateMessages},getAllPublicMessages:function(){return this._publicMessages},getAllMessages:function(){return this._allMessages},_setSelfParticipant:function(e){i.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:i.Services.Conference.Participant}]}),this._selfParticipant=e},_addMessage:function(e){i.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:i.Services.Conference.ChatMessage}]}),this._chatService.addMessage(this,e)}},i.Base.AOPTools.addAdvices(e,"Chat",["sendPrivateMessage","sendPublicMessage"],[i.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),i.Services.Conference.Chat=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Conference.Chat.prototype,{addOnChatMessageReceivedCallback:function(e){this._onChatMessageReceivedCallbacks.add(e)},removeOnChatMessageReceivedCallback:function(e){this._onChatMessageReceivedCallbacks.remove(e)},addOnChatServiceAvailableCallback:function(e){this._onChatServiceAvailableCallbacks.add(e)},removeOnChatServiceAvailableCallback:function(e){this._onChatServiceAvailableCallbacks.remove(e)},addOnChatServiceUnavailableCallback:function(e){this._onChatServiceUnavailableCallbacks.add(e)},removeOnChatServiceUnavailableCallback:function(e){this._onChatServiceUnavailableCallbacks.remove(e)}})}(AvayaClientServices),function(a){"use strict";function e(e,t,i){this._id=a.Base.Utils.generateUUID(),this._eventConference=!1,this._conferenceService=e,this._participantService=t,this._chat=i,this._selfParticipantId="",this._selfParticipant=T,this._activeTalkerId="",this._recentTalkersList=new a.Base.DataSet,this._dialoutPermissions=T,this._recordingPermissions=T,this._lockPermissions=T,this._unmuteSelfPermissions=T,this._unmuteAllPermissions=T,this._sendFeccPermissions=T,this._allowVideoDirection=T,this._lecturerId="",this._conferenceOwnerAddress="",this._presenterId="",this._mediaStatus="",this._activeParticipants=new a.Base.DataSet,this._droppedParticipants=[],this._pendingParticipants=[],this._isLectureModeActive=!1,this._isUccpConference=!1,this._isHandRaised=!1,this._recorderStatus=a.Services.Conference.RecorderStatus.NONE,this._recordingStatus=a.Services.Conference.RecordingStatus.OFF,this._isVideoAllowed=!1,this._encryptionStatus=a.Services.Conference.MeetingEncryptionStatus.NO,this._isWebCollaborationActive=!1,this._isLocked=!1,this._isPasscodeRequiredToBecomeModerator=!1,this._isVideoParticipantNameDisplayActive=!1,this._isVideoPersonalLayoutActive=T,this._isVideoSelfSeeActive=!1,this._currentVideoLayout=T,this._supportedVideoLayouts=[],this._isVideoSelfSeeChangeAllowed=!1,this._isVideoPinAllowed=!1,this._isVideoParticipantNameDisplayChangeAllowed=!1,this._isStreamingActive=!1,this._terminationTime=T,this._subject="",this._webURI="",this._sipURI="",this._isApplicationSharingActive=!1,this._brandName="",this._collaborationURI="",this._admissionPermissionNeeded=!1,this._admissionPasscodeNeeded=!1,this._streamingURI="",this._joinMeetingURI="",this._dialInInformation="",this._dialInInformationHtml="",this._isAvailable=T,this._collaboration=T,this._uccpConfig=T,this._isStarting=!1,this._isStarted=!1,this._preEnteredPasscode="",this._knockDoorTimeout=T,this._onEventConferenceStatusChangedCallbacks=S.Callbacks(),this._onConferenceLockStatusChangedCallbacks=S.Callbacks(),this._onConferenceDisplayVideoParticipantNameChangedCallbacks=S.Callbacks(),this._onConferenceVideoSelfSeeChangedCallbacks=S.Callbacks(),this._onConferenceVideoLayoutChangedCallbacks=S.Callbacks(),this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks=S.Callbacks(),this._onConferenceVideoSelfSeeAllowedCallbacks=S.Callbacks(),this._onConferenceVideoPinAllowedCallbacks=S.Callbacks(),this._onConferenceAvailableVideoLayoutsChangedCallbacks=S.Callbacks(),this._onConferenceSubjectChangedCallbacks=S.Callbacks(),this._onConferenceKnockDoorTimeoutChangedCallbacks=S.Callbacks(),this._onConferenceOwnerAddressChangedCallbacks=S.Callbacks(),this._onConferenceDialInInfoUpdatedCallbacks=S.Callbacks(),this._onConferenceJoinMeetingURIUpdatedCallbacks=S.Callbacks(),this._onConferenceStreamingURIUpdatedCallbacks=S.Callbacks(),this._onConferenceContinuationStatusChangedCallbacks=S.Callbacks(),this._onConferenceRecordingStatusChangedCallbacks=S.Callbacks(),this._onConferenceRecordingFailedCallbacks=S.Callbacks(),this._onConferenceVideoStatusChangedCallbacks=S.Callbacks(),this._onConferenceLectureModeStatusChangedCallbacks=S.Callbacks(),this._onConferenceEntryExitToneChangedCallbacks=S.Callbacks(),this._onConferencePresentationModeStatusChangedCallbacks=S.Callbacks(),this._onConferenceActiveTalkersChangedCallbacks=S.Callbacks(),this._onConferenceActiveVideoParticipantsChangedCallbacks=S.Callbacks(),this._onConferenceParticipantRoleChangedCallbacks=S.Callbacks(),this._onConferenceParticipantAudioMuteStatusChangedCallbacks=S.Callbacks(),this._onConferenceParticipantVideoBlockStatusChangedCallbacks=S.Callbacks(),this._onConferenceAllParticipantsMutedCallbacks=S.Callbacks(),this._onConferenceAllParticipantsUnmutedCallbacks=S.Callbacks(),this._onConferenceEncryptionStatusChangedCallbacks=S.Callbacks(),this._onConferenceStreamingStatusChangedCallbacks=S.Callbacks(),this._onConferenceParticipantRaiseHandStatusChangedCallbacks=S.Callbacks(),this._onConferencePendingParticipantCallbacks=S.Callbacks(),this._onConferencePendingParticipantRemovedCallbacks=S.Callbacks(),this._onConferenceDroppedParticipantAddedCallbacks=S.Callbacks(),this._onConferenceDroppedParticipantRemovedCallbacks=S.Callbacks(),this._onConferenceServiceAvailableCallbacks=S.Callbacks(),this._onConferenceServiceUnavailableCallbacks=S.Callbacks(),this._onConferenceParticipantsAddedCallbacks=S.Callbacks(),this._onConferenceParticipantsRemovedCallbacks=S.Callbacks(),this._onConferenceMeetingTerminationTimeChangedCallbacks=S.Callbacks(),this._onConferenceMeetingTerminationInProgressCallbacks=S.Callbacks(),this._onConferenceCollaborationURIChangedCallbacks=S.Callbacks(),this._onConferenceConnectionEndedCallbacks=S.Callbacks(),this._onConferenceStartingCallbacks=S.Callbacks(),this._onConferenceWaitingToStartCallbacks=S.Callbacks(),this._onConferenceAllowVideoDirectionChangedCallbacks=S.Callbacks(),this._setLectureModeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteParticipantCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._blockUnblockParticipantVideoCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setLockCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeLastParticipantCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._denyPendingParticipantCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._acceptPendingParticipantCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._terminateConferenceCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteSelfAudioCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteSelfAudioCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendFeccCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._activeTalkerCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._supportMeetingMinutesCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._moderateConferenceCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startRecordingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._stopRecordingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._pauseRecordingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._resumeRecordingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteAllCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._raiseHandSupportCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._lowerHandSupportCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setDisplayVideoParticipantNameCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoSelfSeeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoLayoutCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setRequestToBecomeModeratorCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoPinCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeSelectParticipantCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantViaDialoutCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._signInCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._extendMeetingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveParticipantListCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._inConferenceChatCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateChatService(this._inConferenceChatCapability),this._inConferenceChatCapability.addOnChangedCallback(this._updateChatService.bind(this)),this._addParticipantFromCallCapabilities={}}e.prototype={start:function(e){return a.Base.Utils.isDefined(e)&&(this._uccpConfig=e),this._conferenceService.start(this,this._uccpConfig)},stop:function(){return this._addParticipantFromCallCapabilities={},this._conferenceService.stop(this)},_stopImmediately:function(){return this._conferenceService.stopImmediately(this)},isEventConference:function(){return this._eventConference},getInConferenceChat:function(){return this._chat},getRecentTalkers:function(){return this._recentTalkersList},getMeetingMinutes:function(){throw new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.NOT_SUPPORTED)},getCollaborationURI:function(){return this._collaborationURI},getConferenceOwnerAddress:function(){return this._conferenceOwnerAddress},isLocked:function(){return this._isLocked},setLocked:function(e){return this._conferenceService.setLocked(this,e)},isConferenceWaitingToStart:function(){return this._mediaStatus===a.Services.Conference.MediaStatus.WAITING_ROOM},isVideoSelfSeeActive:function(){return this._isVideoSelfSeeActive},isMuteAllParticipantsActive:function(){return this._mediaStatus===a.Services.Conference.MediaStatus.MUTE_ALL_AUDIO},setVideoSelfSee:function(e){return this._conferenceService.setVideoLayoutSelfSee(this,e)},isVideoParticipantNameDisplayActive:function(){return this._isVideoParticipantNameDisplayActive},setDisplayVideoParticipantName:function(e){return this._conferenceService.setVideoLayoutTextOverlay(this,e)},_setPreEnteredPasscode:function(e){this._preEnteredPasscode=e},getSupportedVideoLayoutList:function(){return this._supportedVideoLayouts},isLectureModeActive:function(){return this._isLectureModeActive},startRecording:function(e,t){return this._conferenceService.startRecording(this,e,t)},stopRecording:function(){return this._conferenceService.stopRecording(this)},pauseRecording:function(){return this._conferenceService.pauseRecording(this)},resumeRecording:function(){return this._conferenceService.resumeRecording(this)},isVideoAllowed:function(){return this._isVideoAllowed},getCurrentVideoLayout:function(){return this._currentVideoLayout},setVideoLayout:function(e){for(var t in a.Services.Conference.VideoLayout)if(a.Services.Conference.VideoLayout.hasOwnProperty(t)&&e===a.Services.Conference.VideoLayout[t])return this._conferenceService.setVideoLayout(this,e);return S.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.INVALID_ARGUMENT))},getActiveParticipants:function(){return this._activeParticipants},getDroppedParticipants:function(){return this._droppedParticipants},getPendingParticipants:function(){return this._pendingParticipants},muteAllParticipants:function(){return this._conferenceService.muteAllParticipants(this)},unmuteAllParticipants:function(){return this._conferenceService.unmuteAllParticipants(this)},addParticipant:function(e){return this._conferenceService.addParticipant(this,a.Base.Utils.normalizeAddress(e))},addParticipantFromCall:function(e){return this.getAddParticipantFromCallCapability(e).isAllowed?this._conferenceService.addParticipantFromCall(e):S.Deferred().reject(new a.Services.Call.CallException(a.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))},removeParticipant:function(e){return e.getParticipantConnectionStatus()===a.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTING?this._conferenceService.cancelDialoutParticipant(this,e):e.isActiveParticipant()?this._conferenceService.disconnectParticipant(e):S.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.INVALID_ARGUMENT,"Invalid participant state for this method"))},removeLastParticipant:function(){return this._conferenceService.removeLastParticipant()},terminateConference:function(){return this._conferenceService.terminateConference(this)},sendPasscode:function(e){return this._conferenceService.sendAdmissionRequest(this,e)},sendRequestToEnterLockedConference:function(){return this._conferenceService.sendAdmissionRequest(this)},isPasscodeRequiredToBecomeModerator:function(){return this._isPasscodeRequiredToBecomeModerator},requestToBecomeModerator:function(e){return this._conferenceService.requestToBecomeModerator(this,e)},signIn:function(e){return this._conferenceService.signIn(this,e)},pinVideoByParticipant:function(e,t,i){return this._conferenceService.videoPin(e,0,0,t,i)},pinVideoByCoordinates:function(e,t,i,a){return this._conferenceService.videoPin(void 0,e,t,i,a)},extendMeeting:function(e){return this._conferenceService.extendMeeting(e)},raiseHand:function(){return this.getSupportRaiseHandCapability().isAllowed?this._conferenceService.raiseLowerHand(!0):S.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"an attepmt to raise hand was failed"))},lowerHand:function(){return this.getSupportLowerHandCapability().isAllowed?this._conferenceService.raiseLowerHand(!1):S.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"an attepmt to lower hand was failed"))},_recalculateAllCapabilities:function(){this._conferenceService?this._conferenceService._recalculateAllCapabilities?this._conferenceService._recalculateAllCapabilities(this):a.Base.Logger.error(a.Base.LoggerTags.CONFERENCE_SERVICE,"conferenceService has no method _recalculateAllCapabilities"):a.Base.Logger.error(a.Base.LoggerTags.CONFERENCE_SERVICE,"conference service not initialized")},_recalculate:function(){this._conferenceService._recalculateAllCapabilities(this),this._activeParticipants.forEach(function(e){e._recalculateAllCapabilities()})},getSelfParticipant:function(){return this._selfParticipant},isRecordingActive:function(){return this._recordingStatus===a.Services.Conference.RecordingStatus.ON||this._recordingStatus===a.Services.Conference.RecordingStatus.PAUSE},isRecordingPaused:function(){return this._recordingStatus===a.Services.Conference.RecordingStatus.PAUSE},getEncryptionStatus:function(){return this._encryptionStatus},getSubject:function(){return this._subject},getMeetingEndTime:function(){return this._terminationTime},isStreamingActive:function(){return this._isStreamingActive},isApplicationSharingActive:function(){return this._isApplicationSharingActive},getStreamingURI:function(){return this._streamingURI},getJoinMeetingURI:function(){return this._joinMeetingURI},getDialInInformation:function(){return this._dialInInformation},getDialInInformationHtml:function(){return this._dialInInformationHtml},toString:function(){return this._id},_getPreEnteredPasscode:function(){return this._preEnteredPasscode},_disconnect:function(){return this._conferenceService.sendDisconnectEvent()},_getType:function(){return this._conferenceService.getType()},_sendLocalMuteEvent:function(e){var t=function(){a.Base.Logger.debug(a.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent onFailure service now available sending mute "+e),this._conferenceService.sendLocalMuteEvent(this._selfParticipantId,e),this.removeOnConferenceServiceAvailableCallback(t)}.bind(this),i=function(){a.Base.Logger.debug(a.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent onFailure mute "+e),this.addOnConferenceServiceAvailableCallback(t)}.bind(this);if(this._selfParticipantId)return a.Base.Logger.debug(a.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent sending mute "+e),this._conferenceService.sendLocalMuteEvent(this._selfParticipantId,e).fail(i);i()},_setConfiguration:function(e){this._uccpConfig=e},_setCollaboration:function(e){this._collaboration=e},_setConferenceStarted:function(e){this._isStarted=e,this._isStarted&&(this._isStarting=!1),a.Base.Logger.debug(a.Base.LoggerTags.CONFERENCE_SERVICE,"_setConferenceStarted: "+e)},_isConferenceStarted:function(){return this._isStarted},_updateChatService:function(e){this._chat&&this._chat._chatService&&this._chat._chatService._setEnableSendingMessages(e.isAllowed)},getKnockDoorTimeout:function(){return this._knockDoorTimeout},isPasscodeRequiredToEnterConference:function(){return!a.Base.Utils.isDefined(this._admissionPasscodeNeeded)||this._admissionPasscodeNeeded},isPermissionRequiredToEnterLockedConference:function(){return!a.Base.Utils.isDefined(this._admissionPermissionNeeded)||this._admissionPermissionNeeded}},a.Base.AOPTools.addAdvices(e,"Conference",["_setConferenceStarted"],[a.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS]),a.Base.AOPTools.addAdvices(e,"Conference",["start","stop","setLocked","setVideoSelfSee","setDisplayVideoParticipantName","startRecording","stopRecording","pauseRecording","resumeRecording","setVideoLayout","muteAllParticipants","unmuteAllParticipants","addParticipant","addParticipantFromCall","removeParticipant","removeLastParticipant","terminateConference","sendPasscode","sendRequestToEnterLockedConference","requestToBecomeModerator","signIn","pinVideoByParticipant","pinVideoByCoordinates","extendMeeting","raiseHand","lowerHand"],[a.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),a.Services.Conference.Conference=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Conference.Conference.prototype,{addOnEventConferenceStatusChangedCallback:function(e){this._onEventConferenceStatusChangedCallbacks.add(e)},removeOnEventConferenceStatusChangedCallback:function(e){this._onEventConferenceStatusChangedCallbacks.remove(e)},addOnConferenceLockStatusChangedCallback:function(e){this._onConferenceLockStatusChangedCallbacks.add(e)},removeOnConferenceLockStatusChangedCallback:function(e){this._onConferenceLockStatusChangedCallbacks.remove(e)},addOnConferenceDisplayVideoParticipantNameChangedCallback:function(e){this._onConferenceDisplayVideoParticipantNameChangedCallbacks.add(e)},removeOnConferenceDisplayVideoParticipantNameChangedCallback:function(e){this._onConferenceDisplayVideoParticipantNameChangedCallbacks.remove(e)},addOnConferenceVideoSelfSeeChangedCallback:function(e){this._onConferenceVideoSelfSeeChangedCallbacks.add(e)},removeOnConferenceVideoSelfSeeChangedCallback:function(e){this._onConferenceVideoSelfSeeChangedCallbacks.remove(e)},addOnConferenceVideoLayoutChangedCallback:function(e){this._onConferenceVideoLayoutChangedCallbacks.add(e)},removeOnConferenceVideoLayoutChangedCallback:function(e){this._onConferenceVideoLayoutChangedCallbacks.remove(e)},addOnConferenceDisplayParticipantNameOnVideoAllowedCallback:function(e){this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.add(e)},removeOnConferenceDisplayParticipantNameOnVideoAllowedCallback:function(e){this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.remove(e)},addOnConferenceVideoSelfSeeAllowedCallback:function(e){this._onConferenceVideoSelfSeeAllowedCallbacks.add(e)},removeOnConferenceVideoSelfSeeAllowedCallback:function(e){this._onConferenceVideoSelfSeeAllowedCallbacks.remove(e)},addOnConferenceVideoPinAllowedCallback:function(e){this._onConferenceVideoPinAllowedCallbacks.add(e)},removeOnConferenceVideoPinAllowedCallback:function(e){this._onConferenceVideoPinAllowedCallbacks.remove(e)},addOnConferenceAvailableVideoLayoutsChangedCallback:function(e){this._onConferenceAvailableVideoLayoutsChangedCallbacks.add(e)},removeOnConferenceAvailableVideoLayoutsChangedCallback:function(e){this._onConferenceAvailableVideoLayoutsChangedCallbacks.remove(e)},addOnConferenceContinuationStatusChangedCallback:function(e){this._onConferenceContinuationStatusChangedCallbacks.add(e)},removeOnConferenceContinuationStatusChangedCallback:function(e){this._onConferenceContinuationStatusChangedCallbacks.remove(e)},addOnConferenceRecordingStatusChangedCallback:function(e){this._onConferenceRecordingStatusChangedCallbacks.add(e)},removeOnConferenceRecordingStatusChangedCallback:function(e){this._onConferenceRecordingStatusChangedCallbacks.remove(e)},addOnConferenceRecordingFailedCallbacks:function(e){this._onConferenceRecordingFailedCallbacks.add(e)},removeOnConferenceRecordingFailedCallbacks:function(e){this._onConferenceRecordingFailedCallbacks.remove(e)},addOnConferenceVideoStatusChangedCallback:function(e){this._onConferenceVideoStatusChangedCallbacks.add(e)},removeOnConferenceVideoStatusChangedCallback:function(e){this._onConferenceVideoStatusChangedCallbacks.remove(e)},addOnConferenceLectureModeStatusChangedCallback:function(e){this._onConferenceLectureModeStatusChangedCallbacks.add(e)},removeOnConferenceLectureModeStatusChangedCallback:function(e){this._onConferenceLectureModeStatusChangedCallbacks.remove(e)},addOnConferenceStreamingStatusChangedCallback:function(e){this._onConferenceStreamingStatusChangedCallbacks.add(e)},removeOnConferenceStreamingStatusChangedCallback:function(e){this._onConferenceStreamingStatusChangedCallbacks.remove(e)},addOnConferenceEncryptionStatusChangedCallback:function(e){this._onConferenceEncryptionStatusChangedCallbacks.add(e)},removeOnConferenceEncryptionStatusChangedCallback:function(e){this._onConferenceEncryptionStatusChangedCallbacks.remove(e)},addOnConferenceMeetingTerminationTimeChangedCallback:function(e){this._onConferenceMeetingTerminationTimeChangedCallbacks.add(e)},removeOnConferenceMeetingTerminationTimeChangedCallback:function(e){this._onConferenceMeetingTerminationTimeChangedCallbacks.remove(e)},addOnConferenceMeetingTerminationInProgressCallbacks:function(e){this._onConferenceMeetingTerminationInProgressCallbacks.add(e)},removeOnConferenceMeetingTerminationInProgressCallbacks:function(e){this._onConferenceMeetingTerminationInProgressCallbacks.remove(e)},addOnConferenceEntryExitToneChangedCallback:function(e){this._onConferenceEntryExitToneChangedCallbacks.add(e)},removeOnConferenceEntryExitToneChangedCallback:function(e){this._onConferenceEntryExitToneChangedCallbacks.remove(e)},addOnConferencePresentationModeStatusChangedCallback:function(e){this._onConferencePresentationModeStatusChangedCallbacks.add(e)},removeOnConferencePresentationModeStatusChangedCallback:function(e){this._onConferencePresentationModeStatusChangedCallbacks.remove(e)},addOnConferenceActiveTalkersChangedCallback:function(e){this._onConferenceActiveTalkersChangedCallbacks.add(e)},removeOnConferenceActiveTalkersChangedCallback:function(e){this._onConferenceActiveTalkersChangedCallbacks.remove(e)},addOnConferenceActiveVideoParticipantsChangedCallback:function(e){this._onConferenceActiveVideoParticipantsChangedCallbacks.add(e)},removeOnConferenceActiveVideoParticipantsChangedCallback:function(e){this._onConferenceActiveVideoParticipantsChangedCallbacks.remove(e)},addOnConferenceAllParticipantsMutedCallback:function(e){this._onConferenceAllParticipantsMutedCallbacks.add(e)},removeOnConferenceAllParticipantsMutedCallback:function(e){this._onConferenceAllParticipantsMutedCallbacks.remove(e)},addOnConferenceAllParticipantsUnmutedCallback:function(e){this._onConferenceAllParticipantsUnmutedCallbacks.add(e)},removeOnConferenceAllParticipantsUnmutedCallback:function(e){this._onConferenceAllParticipantsUnmutedCallbacks.remove(e)},addOnConferencePendingParticipantCallback:function(e){this._onConferencePendingParticipantCallbacks.add(e)},removeOnConferencePendingParticipantCallback:function(e){this._onConferencePendingParticipantCallbacks.remove(e)},addOnConferencePendingParticipantRemovedCallback:function(e){this._onConferencePendingParticipantRemovedCallbacks.add(e)},removeOnConferencePendingParticipantRemovedCallback:function(e){this._onConferencePendingParticipantRemovedCallbacks.remove(e)},addOnConferenceDroppedParticipantAddedCallback:function(e){this._onConferenceDroppedParticipantAddedCallbacks.add(e)},removeOnConferenceDroppedParticipantAddedCallback:function(e){this._onConferenceDroppedParticipantAddedCallbacks.remove(e)},addOnConferenceDroppedParticipantRemovedCallback:function(e){this._onConferenceDroppedParticipantRemovedCallbacks.add(e)},removeOnConferenceDroppedParticipantRemovedCallback:function(e){this._onConferenceDroppedParticipantRemovedCallbacks.remove(e)},addOnConferenceServiceAvailableCallback:function(e){this._onConferenceServiceAvailableCallbacks.add(e)},removeOnConferenceServiceAvailableCallback:function(e){this._onConferenceServiceAvailableCallbacks.remove(e)},addOnConferenceServiceUnavailableCallback:function(e){this._onConferenceServiceUnavailableCallbacks.add(e)},removeOnConferenceServiceUnavailableCallback:function(e){this._onConferenceServiceUnavailableCallbacks.remove(e)},addOnConferenceParticipantsAddedCallback:function(e){this._onConferenceParticipantsAddedCallbacks.add(e)},removeOnConferenceParticipantsAddedCallback:function(e){this._onConferenceParticipantsAddedCallbacks.remove(e)},addOnConferenceParticipantsRemovedCallback:function(e){this._onConferenceParticipantsRemovedCallbacks.add(e)},removeOnConferenceParticipantsRemovedCallback:function(e){this._onConferenceParticipantsRemovedCallbacks.remove(e)},addOnConferenceSubjectCallback:function(e){this._onConferenceSubjectChangedCallbacks.add(e)},removeOnConferenceSubjectCallback:function(e){this._onConferenceSubjectChangedCallbacks.remove(e)},addOnConferenceKnockDoorTimeoutChangedCallback:function(e){this._onConferenceKnockDoorTimeoutChangedCallbacks.add(e)},removeOnConferenceKnockDoorTimeoutChangedCallback:function(e){this._onConferenceKnockDoorTimeoutChangedCallbacks.remove(e)},addOnConferenceOwnerAddressChangedCallback:function(e){this._onConferenceOwnerAddressChangedCallbacks.add(e)},removeOnConferenceOwnerAddressChangedCallback:function(e){this._onConferenceOwnerAddressChangedCallbacks.remove(e)},addOnConferenceCollaborationURIChangedCallback:function(e){this._onConferenceCollaborationURIChangedCallbacks.add(e)},removeOnConferenceCollaborationURIChangedCallback:function(e){this._onConferenceCollaborationURIChangedCallbacks.remove(e)},addOnConferenceStartingCallback:function(e){this._onConferenceStartingCallbacks.add(e)},removeOnConferenceStartingCallback:function(e){this._onConferenceStartingCallbacks.remove(e)},addOnConferenceWaitingToStartCallback:function(e){this._onConferenceWaitingToStartCallbacks.add(e)},removeOnConferenceWaitingToStartCallback:function(e){this._onConferenceWaitingToStartCallbacks.remove(e)},addOnConferenceConnectionEndedCallbacks:function(e){this._onConferenceConnectionEndedCallbacks.add(e)},removeOnConferenceConnectionEndedCallbacks:function(e){this._onConferenceConnectionEndedCallbacks.remove(e)},_addOnConferenceAllowVideoDirectionChangedCallback:function(e){this._onConferenceAllowVideoDirectionChangedCallbacks.add(e)},_removeOnConferenceAllowVideoDirectionChangedCallback:function(e){this._onConferenceAllowVideoDirectionChangedCallbacks.remove(e)},addOnConferenceStreamingURIUpdatedCallback:function(e){this._onConferenceStreamingURIUpdatedCallbacks.add(e)},removeOnConferenceStreamingURIUpdatedCallback:function(e){this._onConferenceStreamingURIUpdatedCallbacks.remove(e)},addOnConferenceJoinMeetingURIUpdatedCallback:function(e){this._onConferenceJoinMeetingURIUpdatedCallbacks.add(e)},removeOnConferenceJoinMeetingURIUpdatedCallback:function(e){this._onConferenceJoinMeetingURIUpdatedCallbacks.remove(e)},addOnConferenceDialInInfoUpdatedCallback:function(e){this._onConferenceDialInInfoUpdatedCallbacks.add(e)},removeOnConferenceDialInInfoUpdatedCallback:function(e){this._onConferenceDialInInfoUpdatedCallbacks.remove(e)}})}(AvayaClientServices),function(r){"use strict";var e={getInConferenceChatCapability:function(){return this._inConferenceChatCapability},_recalculateInConferenceChatCapability:function(){var e,t=!0;this._inConferenceChatCapability&&this._inConferenceChatCapability instanceof r.Base.Capability?(e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,!this._isInWaitingRoomState()&&!this._isCmConference()&&this._isAvailable||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._inConferenceChatCapability._updateIfChanged(t,e)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_inConferenceChatCapability property is not defined")},_isInWaitingRoomState:function(){return this._mediaStatus===r.Services.Conference.MediaStatus.WAITING_ROOM},_isCmConference:function(){return this._conferenceProvider!==T&&this._conferenceProvider._conferenceType!==T&&this._conferenceProvider._conferenceType===r.Services.Conference.ConferenceType.CM},getSupportMeetingMinutesCapability:function(){return this._supportMeetingMinutesCapability},getModerateConferenceCapability:function(){return this._moderateConferenceCapability},_recalculateModerateConferenceCapability:function(){var e,t;this._moderateConferenceCapability&&this._moderateConferenceCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._moderateConferenceCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_moderateConferenceCapability property is not defined")},getActiveTalkerCapability:function(){return this._activeTalkerCapability},_recalculateActiveTalkerCapability:function(){var e,t;this._activeTalkerCapability&&this._activeTalkerCapability instanceof r.Base.Capability?(t=this._isUccpConference?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._activeTalkerCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_activeTalkerCapability property is not defined")},getMuteSelfAudioCapability:function(){return this._muteSelfAudioCapability},_recalculateMuteSelfAudioCapability:function(){var e,t;this._muteSelfAudioCapability&&this._muteSelfAudioCapability instanceof r.Base.Capability?(this._isUccpConference&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._unmuteSelfPermissions)?this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteSelfAudioCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_muteSelfAudioCapability property is not defined")},getUnmuteSelfAudioCapability:function(){return this._unmuteSelfAudioCapability},_recalculateUnmuteSelfAudioCapability:function(){var e,t;this._unmuteSelfAudioCapability&&this._unmuteSelfAudioCapability instanceof r.Base.Capability?(this._isUccpConference&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._unmuteSelfPermissions)?this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteSelfPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteSelfAudioCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_unmuteSelfAudioCapability property is not defined")},getSendFeccCapability:function(){return this._sendFeccCapability},_recalculateSendFeccCapability:function(){var e,t;this._sendFeccCapability&&this._sendFeccCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._sendFeccPermissions)?this._sendFeccPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._sendFeccPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._sendFeccPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._sendFeccPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendFeccCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_sendFeccCapability property is not defined")},getTerminateConferenceCapability:function(){return this._terminateConferenceCapability},_recalculateTerminateConferenceCapability:function(){var e,t;this._terminateConferenceCapability&&this._terminateConferenceCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._terminateConferenceCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_terminateConferenceCapability property is not defined")},getUpdateLockStatusCapability:function(){return this._setLockCapability},_recalculateSetLockCapability:function(){var e,t;this._setLockCapability&&this._setLockCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._lockPermissions)?this._lockPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._lockPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._lockPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._lockPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setLockCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setLockCapability property is not defined")},getStartRecordingCapability:function(){return this._startRecordingCapability},getStopRecordingCapability:function(){return this._stopRecordingCapability},getPauseRecordingCapability:function(){return this._pauseRecordingCapability},getResumeRecordingCapability:function(){return this._resumeRecordingCapability},_recalculateStartStopRecordingCapability:function(){var e,t,i;this._startRecordingCapability&&this._startRecordingCapability instanceof r.Base.Capability?this._stopRecordingCapability&&this._stopRecordingCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._recorderStatus)&&r.Base.Utils.isDefined(this._recordingPermissions)?this._recordingPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED||this._recorderStatus===r.Services.Conference.RecorderStatus.NONE?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN_OR_MODERATOR?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN_OR_MODERATOR):(i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=this.isRecordingActive()?!(e=!1):!(e=!0)):(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startRecordingCapability._updateIfChanged(e,i),this._stopRecordingCapability._updateIfChanged(t,i)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_stopRecordingCapability property is not defined"):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_startRecordingCapability property is not defined")},_recalculatePauseResumeRecordingCapability:function(){var e,t,i;this._pauseRecordingCapability&&this._pauseRecordingCapability instanceof r.Base.Capability?this._resumeRecordingCapability&&this._resumeRecordingCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._recorderStatus)&&r.Base.Utils.isDefined(this._recordingPermissions)?this._recordingPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED||this._recorderStatus!==r.Services.Conference.RecorderStatus.WITH_PAUSE?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):this._recordingPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN_OR_MODERATOR?(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN_OR_MODERATOR):(i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=this.isRecordingActive()?this.isRecordingPaused()?!(e=!1):!(e=!0):e=!1):(t=e=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._pauseRecordingCapability._updateIfChanged(e,i),this._resumeRecordingCapability._updateIfChanged(t,i)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_resumeRecordingCapability property is not defined"):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_pauseRecordingCapability property is not defined")},getSupportRaiseHandCapability:function(){return this._raiseHandSupportCapability},_recalculateRaiseHandSupportCapability:function(){var e,t;this._raiseHandSupportCapability&&this._raiseHandSupportCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant._audioFromParticipant!==r.Services.Conference.MediaFromParticipantStatus.NA?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._raiseHandSupportCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_raiseHandSupportCapability property is not defined")},getSupportLowerHandCapability:function(){return this._lowerHandSupportCapability},_recalculateLowerHandSupportCapability:function(){var e,t;this._lowerHandSupportCapability&&this._lowerHandSupportCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant._audioFromParticipant!==r.Services.Conference.MediaFromParticipantStatus.NA?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._lowerHandSupportCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_lowerHandSupportCapability property is not defined")},getRetrieveParticipantListCapability:function(){return this._retrieveParticipantListCapability},_recalculateRetrieveParticipantListCapability:function(){var e,t;this._retrieveParticipantListCapability&&this._retrieveParticipantListCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._retrieveParticipantListCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_retrieveParticipantListCapability property is not defined")},getMuteAllParticipantsCapability:function(){return this._muteUnmuteAllCapability},getUnmuteAllParticipantsCapability:function(){return this._muteUnmuteAllCapability},_recalculateMuteUnmuteAllCapability:function(){var e,t;this._muteUnmuteAllCapability&&this._muteUnmuteAllCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._unmuteAllPermissions)?this._unmuteAllPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteAllPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteAllPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteAllPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteAllCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_muteUnmuteAllCapability property is not defined")},getChangeParticipantRoleCapability:function(){},getUpdateDisplayVideoParticipantNameCapability:function(){return this._setDisplayVideoParticipantNameCapability},_recalculateDisplayVideoParticipantNameCapability:function(){var e,t;this._setDisplayVideoParticipantNameCapability&&this._setDisplayVideoParticipantNameCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._isVideoParticipantNameDisplayChangeAllowed)?this._isVideoParticipantNameDisplayChangeAllowed?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setDisplayVideoParticipantNameCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setDisplayVideoParticipantNameCapability property is not defined")},getUpdateVideoSelfSeeCapability:function(){return this._setVideoSelfSeeCapability},_recalculateVideoSelfSeeCapability:function(){var e,t;this._setVideoSelfSeeCapability&&this._setVideoSelfSeeCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._isVideoSelfSeeChangeAllowed)?this._isVideoSelfSeeChangeAllowed?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoSelfSeeCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoSelfSeeCapability property is not defined")},getUpdateVideoLayoutCapability:function(){return this._setVideoLayoutCapability},_recalculateSetVideoLayoutCapability:function(){if(this._setVideoLayoutCapability&&this._setVideoLayoutCapability instanceof r.Base.Capability){var e=void 0===this._isVideoPersonalLayoutActive||this._isVideoPersonalLayoutActive;if(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._currentVideoLayout)&&r.Base.Utils.isDefined(this._supportedVideoLayouts)&&e){for(var t=!1,i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED,a=0;a<this._supportedVideoLayouts.length;++a)if(this._supportedVideoLayouts[a].geometry===this._currentVideoLayout){t=!0,i=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;break}}else i=e?(t=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(t=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);this._setVideoLayoutCapability._updateIfChanged(t,i)}else r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoLayoutCapability property is not defined")},getRequestToBecomeModeratorCapability:function(){return this._setRequestToBecomeModeratorCapability},_recalculateRequestToBecomeModeratorCapability:function(){var e,t;this._setRequestToBecomeModeratorCapability&&this._setRequestToBecomeModeratorCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)?this.isEventConference()&&this._selfParticipant.isRestrictedParticipant()?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._selfParticipant.isModerator()?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setRequestToBecomeModeratorCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setRequestToBecomeModeratorCapability property is not defined")},getVideoPinCapability:function(){return this._setVideoPinCapability},_recalculateVideoPinCapability:function(){var e,t;this._setVideoPinCapability&&this._setVideoPinCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._isVideoPinAllowed)?this._isVideoPinAllowed?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoPinCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoPinCapability property is not defined")},getAddParticipantViaDialoutCapability:function(){return this._addParticipantViaDialoutCapability},_recalculateAddParticipantViaDialoutCapability:function(){var e,t;this._addParticipantViaDialoutCapability&&this._addParticipantViaDialoutCapability instanceof r.Base.Capability?(this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&r.Base.Utils.isDefined(this._dialoutPermissions)?this._dialoutPermissions===r.Services.Conference.PermissionStatus.ALLOWED?(e=!0,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._dialoutPermissions===r.Services.Conference.PermissionStatus.NOT_ALLOWED?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._dialoutPermissions===r.Services.Conference.PermissionStatus.NEED_MODERATOR?(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._dialoutPermissions===r.Services.Conference.PermissionStatus.NEED_SIGNIN&&(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(e=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantViaDialoutCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_addParticipantViaDialoutCapability property is not defined")},getRemoveSelectParticipantCapability:function(){return this._removeSelectParticipantCapability},_recalculateRemoveSelectParticipantCapability:function(){var e,t;this._removeSelectParticipantCapability&&this._removeSelectParticipantCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeSelectParticipantCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_removeSelectParticipantCapability property is not defined")},getSignInCapability:function(){return this._signInCapability},_recalculateSignInCapability:function(){var e,t;this._signInCapability&&this._signInCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._signInCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_signInCapability property is not defined")},getRemoveLastParticipantCapability:function(){return this._removeLastParticipantCapability},getAcceptPendingParticipantCapability:function(){return this._acceptPendingParticipantCapability},_recalculateAcceptPendingParticipantCapability:function(){var e,t;this._acceptPendingParticipantCapability&&this._acceptPendingParticipantCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._acceptPendingParticipantCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_acceptPendingParticipantCapability property is not defined")},getDenyPendingParticipantCapability:function(){return this._denyPendingParticipantCapability},_recalculateDenyPendingParticipantCapability:function(){var e,t;this._denyPendingParticipantCapability&&this._denyPendingParticipantCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._denyPendingParticipantCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_denyPendingParticipantCapability property is not defined")},getExtendMeetingCapability:function(){return this._extendMeetingCapability},_recalculateExtendMeetingCapability:function(){var e,t;this._extendMeetingCapability&&this._extendMeetingCapability instanceof r.Base.Capability?(t=this._isAvailable&&r.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._extendMeetingCapability._updateIfChanged(e,t)):r.Base.Logger.error(r.Base.LoggerTags.CONFERENCE_SERVICE,"_extendMeetingCapability property is not defined")},getAddParticipantFromCallCapability:function(e){var t=e.getCallId();return this._addParticipantFromCallCapabilities.hasOwnProperty(t)||(e.addOnCallConferenceStatusChangedCallback(function(){this._recalculateAddParticipantFromCallCapability(e)}.bind(this)),this._addParticipantFromCallCapabilities[t]=new r.Base.Capability(r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._recalculateAddParticipantFromCallCapability(e)),this._addParticipantFromCallCapabilities[t]},_recalculateAddParticipantFromCallCapability:function(e){this._conferenceService._recalculateAddParticipantFromCallCapability(this,e)},_recalculateAllAddParticipantFromCallCapability:function(){for(var e in this._addParticipantFromCallCapabilities)this._addParticipantFromCallCapabilities.hasOwnProperty(e)&&this._conferenceService._recalculateAddParticipantFromCallCapabilityByCallId(this,e)}};S.extend(r.Services.Conference.Conference.prototype,e)}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Participant.call(this),this._participantService=e,this._conference=t,this._onParticipantStatusChangedCallbacks=S.Callbacks(),this._setUnsetAsLecturerCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteAudioCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteAudioCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._blockVideoCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unblockVideoCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._remoteCameraControlCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._lowerHandCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._changeParticipantNameCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}(e.prototype=Object.create(i.Services.Participant.prototype)).getParticipantAuthorizationStatus=function(){return this._status},e.prototype.isPendingParticipant=function(){return this._status===i.Services.Conference.ParticipantAuthorizationStatus.AUTHORIZING},e.prototype.isActiveParticipant=function(){return this._status===i.Services.Conference.ParticipantAuthorizationStatus.ACTIVE},e.prototype._recalculateAllCapabilities=function(){this._participantService.recalculateAllCapabilities(this)},i.Services.Conference.Participant=e}(AvayaClientServices),function(_){"use strict";var e={getMuteParticipantAudioCapability:function(){return this._muteAudioCapability},getUnmuteParticipantAudioCapability:function(){return this._unmuteAudioCapability},_recalculateMuteUnmuteCapability:function(){var e=_.Services.Conference.MediaFromParticipantStatus,t=_.Base.CapabilityDenialReason,i=t.CAPABILITY_INVALID_STATE,a=t.CAPABILITY_CALL_HAS_NO_AUDIO,r=t.CAPABILITY_NOT_ALLOWED,s=t.CAPABILITY_NOT_DENIED,n=!1,o=!1,c=r,l=r,d=this._conference._selfParticipant&&this._conference._selfParticipant.isModerator(),C=this._conference.isLectureModeActive();if(this._conference._isAvailable)switch(this._audioFromParticipant){case e.NA:u(!1,a),h(!1,a);break;case e.ACTIVE:case e.SELF_MUTED:d&&u(!0,s);break;case e.MODERATOR_MUTED:case e.BOTH_MUTED:(d||this._isSelfParticipant&&!C)&&h(!0,s)}else u(!1,i),h(!1,i);function u(e,t){n=e,c=t}function h(e,t){o=e,l=t}this._muteAudioCapability._updateIfChanged(n,c),this._unmuteAudioCapability._updateIfChanged(o,l)},getBlockParticipantVideoCapability:function(){return this._blockVideoCapability},getUnblockParticipantVideoCapability:function(){return this._unblockVideoCapability},_recalculateBlockUnblockVideoCapability:function(){var e=_.Services.Conference.MediaFromParticipantStatus,t=_.Base.CapabilityDenialReason,i=t.CAPABILITY_INVALID_STATE,a=t.CAPABILITY_CALL_HAS_NO_VIDEO,r=t.CAPABILITY_NOT_ALLOWED,s=t.CAPABILITY_NOT_DENIED,n=!1,o=!1,c=r,l=r,d=this._conference._selfParticipant&&this._conference._selfParticipant.isModerator(),C=this._conference.isLectureModeActive();if(this._conference._isAvailable)switch(this._videoFromParticipant){case e.NA:u(!1,a),h(!1,a);break;case e.ACTIVE:d&&u(!0,s);break;case e.MODERATOR_MUTED:(d||this._isSelfParticipant&&!C)&&h(!0,s)}else u(!1,i),h(!1,i);function u(e,t){n=e,c=t}function h(e,t){o=e,l=t}this._blockVideoCapability._updateIfChanged(n,c),this._unblockVideoCapability._updateIfChanged(o,l)},getChangeRoleCapability:function(){},getAssignParticipantAsLecturerCapability:function(){return this._setUnsetAsLecturerCapability},_recalculateSetAsLecturerCapability:function(){var e,t=_.Base.Utils.isUndefined(this._canLecture)&&this._audioFromParticipant===_.Services.Conference.MediaFromParticipantStatus.NA?(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_CALL_HAS_NO_AUDIO):!1===this._canLecture?(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._conference._isAvailable&&_.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(e=!0,_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._setUnsetAsLecturerCapability._updateIfChanged(e,t)},getLowerParticipantHandCapability:function(){return this._lowerHandCapability},_recalculateLowerHandCapability:function(){var e,t=this._conference._isAvailable&&_.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(e=!0,_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._lowerHandCapability._updateIfChanged(e,t)},getRemoteCameraControlCapability:function(){return this._remoteCameraControlCapability},_recalculateRemoteCameraControlCapability:function(){var e,t=this._conference._isAvailable&&_.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(e=!0,_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._remoteCameraControlCapability._updateIfChanged(e,t)},getChangeParticipantNameCapability:function(){return this._changeParticipantNameCapability},_recalculateChangeParticipantNameCapability:function(){var e,t=this._conference._selfParticipant.isConferenceOwner()?this._conference._isAvailable&&_.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(e=!0,_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!1,_.Base.CapabilityDenialReason.CAPABILITY_NOT_CONFERENCE_OWNER);this._changeParticipantNameCapability._updateIfChanged(e,t)}};S.extend(_.Services.Conference.Participant.prototype,e)}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Conference.Participant.call(this,e,t),this._onPendingParticipantAcceptedCallbacks=S.Callbacks(),this._onPendingParticipantCancelledCallbacks=S.Callbacks(),this._onPendingParticipantDeniedCallbacks=S.Callbacks()}(e.prototype=Object.create(i.Services.Conference.Participant.prototype)).accept=function(){return this._participantService.accept(this)},e.prototype.deny=function(){return this._participantService.deny(this)},i.Base.AOPTools.addAdvices(e,"PendingParticipant",["accept","deny"],[i.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),i.Services.Conference.PendingParticipant=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Conference.PendingParticipant.prototype,{addOnPendingParticipantAcceptedCallback:function(e){this._onPendingParticipantAcceptedCallbacks.add(e)},removeOnPendingParticipantAcceptedCallback:function(e){this._onPendingParticipantAcceptedCallbacks.remove(e)},addOnPendingParticipantCancelledCallback:function(e){this._onPendingParticipantCancelledCallbacks.add(e)},removeOnPendingParticipantCancelledCallback:function(e){this._onPendingParticipantCancelledCallbacks.remove(e)},addOnPendingParticipantDeniedCallback:function(e){this._onPendingParticipantDeniedCallbacks.add(e)},removeOnPendingParticipantDeniedCallback:function(e){this._onPendingParticipantDeniedCallbacks.remove(e)}})}(AvayaClientServices),function(s){"use strict";function e(){this._uniqueAddressForMatching=T,this._firstName=new s.Services.Contacts.ContactStringField,this._lastName=new s.Services.Contacts.ContactStringField,this._displayName=new s.Services.Contacts.ContactStringField,this._asciiFirstName=new s.Services.Contacts.ContactStringField,this._asciiLastName=new s.Services.Contacts.ContactStringField,this._asciiDisplayName=new s.Services.Contacts.ContactStringField,this._alias=new s.Services.Contacts.ContactStringField,this._company=new s.Services.Contacts.ContactStringField,this._location=new s.Services.Contacts.ContactStringField,this._workRoomNumber=new s.Services.Contacts.ContactStringField,this._streetAddress=new s.Services.Contacts.ContactStringField,this._city=new s.Services.Contacts.ContactStringField,this._state=new s.Services.Contacts.ContactStringField,this._country=new s.Services.Contacts.ContactStringField,this._postalCode=new s.Services.Contacts.ContactStringField,this._manager=new s.Services.Contacts.ContactStringField,this._department=new s.Services.Contacts.ContactStringField,this._language=new s.Services.Contacts.ContactStringField,this._emailAddresses=new s.Services.Contacts.ContactFieldList,this._phoneNumbers=new s.Services.Contacts.ContactFieldList,this._imAddresses=new s.Services.Contacts.ContactFieldList,this._buddy=new s.Services.Contacts.ContactBooleanField,this._favorite=new s.Services.Contacts.ContactBooleanField,this._videoCapable=new s.Services.Contacts.ContactBooleanField,this._rank=new s.Services.Contacts.ContactNumberField,this._notes=new s.Services.Contacts.ContactStringField,this._custom1=new s.Services.Contacts.ContactFieldList,this._custom2=new s.Services.Contacts.ContactFieldList,this._custom3=new s.Services.Contacts.ContactFieldList,this._terminal=new s.Services.Contacts.Terminal,this._scopiaUserId=new s.Services.Contacts.ContactStringField,this._scopiaLoginId=new s.Services.Contacts.ContactStringField,this._inContactList=!1,this._pictureUrlMap={},this._selfContact=!1,this._presenceService=T,this._contactsService=T,this._presence=T,this._presenceAddress=T,this._presenceAddressCandidates=T,this._onPresenceReceived=T,this._getPresenceCapability=new s.Base.Capability(s.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._onPresenceChangedCallbacks=S.Callbacks(),this._onContactChangedCallbacks=S.Callbacks()}e.prototype={getUniqueAddressForMatching:function(){var e,t=this._uniqueAddressForMatching;return t=-1<t.indexOf("/")?(e=t.split("/"))[e.length-1]:t},_getUniqueAddressWithoutChanges:function(){return this._uniqueAddressForMatching},_setUniqueAddressForMatching:function(e){this._uniqueAddressForMatching=e},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getDisplayName:function(){return this._displayName},getASCIIFirstName:function(){return this._asciiFirstName},getASCIILastName:function(){return this._asciiLastName},getASCIIDisplayName:function(){return this._asciiDisplayName},getAlias:function(){return this._alias},getLocation:function(){return this._location},getWorkRoomNumber:function(){return this._workRoomNumber},getStreetAddress:function(){return this._streetAddress},getCity:function(){return this._city},getState:function(){return this._state},getCountry:function(){return this._country},getPostalCode:function(){return this._postalCode},getCompany:function(){return this._company},getManager:function(){return this._manager},getDepartment:function(){return this._department},getPictureUrl:function(e){return e&&s.Services.Contacts.ContactPictureSize[e]||(e=s.Services.Contacts.ContactPictureSize.MEDIUM),this._pictureUrlMap[e]},addPictureUrl:function(e,t){e&&s.Services.Contacts.ContactPictureSize[e]&&t&&(this._pictureUrlMap[e]=t)},getLanguage:function(){return this._language},getEmailAddresses:function(){return this._emailAddresses},getPhoneNumbers:function(){return this._phoneNumbers},getIMAddresses:function(){return this._imAddresses},isBuddy:function(){return this._buddy},isFavorite:function(){return this._favorite},isVideoCapable:function(){return this._videoCapable},getNotes:function(){return this._notes},getRank:function(){return this._rank},getCustom1:function(){return this._custom1},getCustom2:function(){return this._custom2},getCustom3:function(){return this._custom3},getScopiaUserId:function(){return this._scopiaUserId},getScopiaLoginId:function(){return this._scopiaLoginId},getTerminal:function(){return this._terminal},_isInContactList:function(){return this._inContactList},_setInContactList:function(e){this._inContactList=e},getPresence:function(){return this._presence},startPresence:function(){if(!this._getPresenceCapability.isAllowed)return S.Deferred().reject(new s.Services.Presence.PresenceError(s.Services.Presence.PresenceErrorReason.UNSUPPORTED)).promise();this._onPresenceReceived=function(e){var t;e.getPresentity()===this._presenceAddress&&(this._selfContact&&(e=S.extend(new s.Services.Presence.SelfPresence,e),t=s.Services.Contacts.ContactsUtils.getPhoneAndVideoChannelPresenceAddress(this),this._presenceService._setSelfPresence(e,this._presenceAddress,t.getPhoneNumber())),this._presence=e,this._onPresenceChangedCallbacks.fire(this,e))}.bind(this);var i=this._presenceService.getPresenceListSubscription();i._addOnInternalPresenceReceivedCallback(this._onPresenceReceived);var a=S.Deferred(),r=function(){var t=this._getPresenceAddress()||this._getNextPresenceAddressCandidate();if(!t)return s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"No IM addresses available for contact's presence subscription"),i._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),S.Deferred().reject(new s.Services.Presence.PresenceError(s.Services.Presence.PresenceErrorReason.UNSUPPORTED)).promise();s.Base.Logger.debug(s.Base.LoggerTags.CONTACTS_SERVICE,"Attempting to subscribe for contact's presence using IM address",t),i._addInternalAddress(t).done(function(){this._presenceAddress=t,a.resolve()}.bind(this)).fail(function(e){e instanceof s.Services.Presence.PresenceError&&e.getReason()===s.Services.Presence.PresenceErrorReason.TIMEOUT?(s.Base.Logger.warn(s.Base.LoggerTags.CONTACTS_SERVICE,"Unable to subscribe for contact's presence using "+t+" IM address. Trying next one."),setTimeout(r,0)):(s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"Failed to subscribe for contact's presence",e),i._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),a.reject(e))}.bind(this))}.bind(this);return r(),a.promise()},stopPresence:function(){if(!this._getPresenceCapability.isAllowed)return S.Deferred().reject(new s.Services.Presence.PresenceError(s.Services.Presence.PresenceErrorReason.UNSUPPORTED));if(!this.getPresence())return s.Base.Logger.warn(s.Base.LoggerTags.CONTACTS_SERVICE,"Cannot stop monitoring presence of this contact as it was not started"),S.Deferred().reject(new s.Services.Presence.PresenceError(s.Services.Presence.PresenceErrorReason.INVALID_STATE));var e=this._presenceService.getPresenceListSubscription();return e._removeInternalAddress(this._getPresenceAddress()).then(function(){e._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),this._presence=T}.bind(this))},_setPresenceService:function(e){this._presenceService=e,this._presenceService&&(this._presenceService.addOnPresenceServiceAvailableCallback(this._recalculateCapabilities.bind(this)),this._presenceService.addOnPresenceServiceUnavailableCallback(this._recalculateCapabilities.bind(this))),this._recalculateCapabilities()},_setContactsService:function(e){this._contactsService=e},_getPresenceAddress:function(){return this._presenceAddress},_getNextPresenceAddressCandidate:function(){this._presenceAddressCandidates||((e=(e=this._imAddresses.getValues()).slice(0,e.length)).sort(function(e,t){return e.isAvayaAdministered()&&!t.isAvayaAdministered()||e.getIMAddressType()===s.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK&&t.getIMAddressType()!==s.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK?-1:!e.isAvayaAdministered()&&t.isAvayaAdministered()||e.getIMAddressType()!==s.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK&&t.getIMAddressType()===s.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK?1:0}),this._presenceAddressCandidates=e);var e=this._presenceAddressCandidates.shift();if(e)return e.getAddress()},_recalculateCapabilities:function(){var e=this._presenceService&&0<this._imAddresses.getValues().length&&this._presenceService._available?s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:s.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED;this._getPresenceCapability._updateIfChanged(e===s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e)},_setSelfContact:function(e){this._selfContact=e}},s.Base.AOPTools.addAdvices(e,"Contact",["startPresence","stopPresence"],[s.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS,s.Base.AOPCommonAdvices.WRAP_CAUGHT_CONTACTS_ERROR]),s.Services.Contacts.Contact=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Contacts.Contact.prototype,{addOnPresenceChangedCallback:function(e){this._onPresenceChangedCallbacks.add(e)},removeOnPresenceChangedCallback:function(e){this._onPresenceChangedCallbacks.remove(e)},addOnContactChangedCallback:function(e){this._onContactChangedCallbacks.add(e)},removeOnContactChangedCallback:function(e){this._onContactChangedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Contacts.Contact.prototype,{getUpdateContactCapability:function(){return this._contactsService.getUpdateContactCapability(this)},getDeleteContactCapability:function(){return this._contactsService.getDeleteContactCapability(this)},getPresenceCapability:function(){return this._getPresenceCapability}})}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._value=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},e.Services.Contacts.ContactBooleanField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._address=T,this._emailAddressType=e.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER,this._default=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getAddress=function(){return this._address},t.prototype.getEmailAddressType=function(){return this._emailAddressType},t.prototype.isDefault=function(){return this._default},e.Services.Contacts.ContactEmailAddressField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactBooleanField.call(this)}(t.prototype=Object.create(e.Services.Contacts.ContactBooleanField.prototype)).setValue=function(e){this._value=e},e.Services.Contacts.EditableContactBooleanField=t}(AvayaClientServices),function(t){"use strict";function e(){t.Services.Contacts.ContactEmailAddressField.call(this)}(e.prototype=Object.create(t.Services.Contacts.ContactEmailAddressField.prototype)).setAddress=function(e){this._address=e},e.prototype.setEmailAddressType=function(e){this._emailAddressType=e,this._default=this._emailAddressType===t.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK},t.Services.Contacts.EditableContactEmailAddressField=e}(AvayaClientServices),function(r){"use strict";function e(e){this._contactsService=e,this._isAvailable=!1,this._onCapabilitiesChangedCallbacks=S.Callbacks(),this._onContactsServiceUnavailableCallbacks=S.Callbacks(),this._onContactsServiceAvailableCallbacks=S.Callbacks()}e.prototype={createEditableContact:function(){return this._contactsService.createEditableContact()},createEditableContactFromContact:function(e){return this._contactsService.createEditableContactFromContact(e)},addContact:function(e){return r.Base.Utils.isUndefined(e)||!e.getContactSavableCapability().isAllowed?S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.REQUIRED_DATA_MISSING)):this._contactsService.getAddContactCapability(e).isAllowed?this._contactsService.addContact(e):S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.ADD_CONTACT_NOT_AVAILABLE))},updateContact:function(e){return r.Base.Utils.isUndefined(e)||!e.getContactSavableCapability().isAllowed?S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.REQUIRED_DATA_MISSING)):this._contactsService.isContactInCache(e)?this._contactsService.getUpdateContactCapability(e).isAllowed?this._contactsService.updateContact(e):S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.UPDATE_CONTACT_NOT_AVAILABLE)):S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND))},deleteContact:function(e){return r.Base.Utils.isUndefined(e)||!this._contactsService.isContactInCache(e)?S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND)):this._contactsService.getDeleteContactCapability(e).isAllowed?this._contactsService.deleteContact(e):S.Deferred().reject(new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.DELETE_CONTACT_NOT_AVAILABLE))},getContacts:function(){return this._contactsService.getContacts()},searchContacts:function(e){if(!e)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search request"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_REQUEST);var t=e.getSearchField();if(t){if(!r.Services.Contacts.SearchFieldType.hasOwnProperty(t))throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search field"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD)}else e._searchField=r.Services.Contacts.SearchFieldType.ALL;if(!this._contactsService.getNetworkSearchContactCapability().isAllowed&&e.getSearchField()!==r.Services.Contacts.SearchFieldType.TERMINAL)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Search contacts is not available"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.SEARCH_CONTACTS_NOT_AVAILABLE);if(!this._contactsService.getNetworkSearchTerminalCapability().isAllowed&&e.getSearchField()===r.Services.Contacts.SearchFieldType.TERMINAL)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Search terminals is not available"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.SEARCH_TERMINALS_NOT_AVAILABLE);t=e.getSearchString();if(!t||""===t)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search string"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_STRING);t=e.getSearchSource();if(t){if(!r.Services.Contacts.SearchSourceType.hasOwnProperty(t))throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search source"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_SOURCE)}else e._searchSource=r.Services.Contacts.SearchSourceType.NETWORK;t=e.getMaxResults();(!t||t<0)&&(e._maxResults=0);t=e.getMaxChunkSize();return(!t||t<0)&&(e._maxChunkSize=0),this._contactsService.searchContacts(e)},resolveContacts:function(e){if(!e)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search request"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_REQUEST);var t=e.getSearchStrings();if(!t||!t.length)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search strings"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_STRINGS);if(500<t.length)throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Count of search strings is too large"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.SEARCH_STRINGS_TOO_LARGE);t=e.getSearchField();if(t){if(!r.Services.Contacts.ResolveContactsFieldType.hasOwnProperty(t))throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search field"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD)}else e._setSearchField(r.Services.Contacts.ResolveContactsFieldType.PHONE_NUMBER);var i=r.Services.Contacts.SearchSourceType,t=this._contactsService.getNetworkResolveContactsCapability(),a=e.getSearchSource();if(a||(a=i.NETWORK,e._setSearchSource(i.NETWORK)),!t.isAllowed)switch(a){case i.NETWORK:throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution over the network is currently unavailable"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.SEARCH_CONTACTS_NOT_AVAILABLE);case i.ALL:r.Base.Logger.warn(r.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution over the network is currently unavailable, searching in local cache"),a=i.LOCAL,e._setSearchSource(i.LOCAL)}if(!i.hasOwnProperty(a))throw r.Base.Logger.error(r.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search source"),new r.Services.Contacts.ContactsError(r.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_SOURCE);return this._contactsService.resolveContacts(e)},changeSearchContactsRequest:function(e,t){this._contactsService.changeSearchContactsRequest(e,t)},findLocalMatchingContacts:function(e,t){for(var i in r.Services.Contacts.SearchFieldType)r.Services.Contacts.SearchFieldType.hasOwnProperty(i)&&t===r.Services.Contacts.SearchFieldType[i]&&this._contactsService.findLocalMatchingContacts(e,t)},start:function(e){return this._startDfd=S.Deferred(),this._contactsService.start(this,e),this._startDfd.promise()},stop:function(){var e=function(){this._onCapabilitiesChangedCallbacks.empty(),this._onContactsServiceAvailableCallbacks.empty(),this._onContactsServiceUnavailableCallbacks.empty()}.bind(this);return this._contactsService.stop(this).always(e)},_stopImmediately:function(){return this._contactsService.stopImmediately(this)},_fireContactsAvailableCallback:function(){!this._isAvailable&&this._contactsService.isStarted()&&(this._isAvailable=!0,r.Base.Logger.info(r.Base.LoggerTags.CONTACTS_SERVICE,"Service is available"),this._startDfd.state()===r.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onContactsServiceAvailableCallbacks.fire(this))},_fireContactsUnavailableCallback:function(){(this._isAvailable||this._contactsService.isStarting())&&(this._isAvailable=!1,r.Base.Logger.info(r.Base.LoggerTags.CONTACTS_SERVICE,"Service is unavailable"),this._startDfd.state()===r.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onContactsServiceUnavailableCallbacks.fire(this))}},r.Base.AOPTools.addAdvices(e,"Contacts",["createEditableContact","createEditableContactFromContact","getContacts","searchContacts","resolveContacts","changeSearchContactsRequest","findLocalMatchingContacts"],[r.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS]),r.Base.AOPTools.addAdvices(e,"Contacts",["addContact","updateContact","deleteContact"],[r.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS,r.Base.AOPCommonAdvices.WRAP_CAUGHT_CONTACTS_ERROR]),r.Services.Contacts.Contacts=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Contacts.Contacts.prototype,{addOnContactsServiceUnavailableCallback:function(e){this._onContactsServiceUnavailableCallbacks.add(e)},removeOnContactsServiceUnavailableCallback:function(e){this._onContactsServiceUnavailableCallbacks.remove(e)},addOnContactsServiceAvailableCallback:function(e){this._onContactsServiceAvailableCallbacks.add(e)},removeOnContactsServiceAvailableCallback:function(e){this._onContactsServiceAvailableCallbacks.remove(e)},addOnContactServicesCapabilitiesChangedCallback:function(e){this._onCapabilitiesChangedCallbacks.add(e)},removeOnContactServicesCapabilitiesChangedCallback:function(e){this._onCapabilitiesChangedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Contacts.Contacts.prototype,{getAddContactCapability:function(){return this._contactsService.getAddContactCapability()},getNetworkSearchContactCapability:function(){return this._contactsService.getNetworkSearchContactCapability()},getNetworkSearchTerminalCapability:function(){return this._contactsService.getNetworkSearchTerminalCapability()},getConferenceSearchCapability:function(){return this._contactsService.getConferenceSearchCapability()},getNetworkResolveContactsCapability:function(){return this._contactsService.getNetworkResolveContactsCapability()}})}(AvayaClientServices),function(t){"use strict";function e(e){this._thumbnailCreator=e,this.disposition="",this.duration=-1,this.mimeType="",this.id="",this.size=-1,this.file=T,this.status="",this.name="",this.location="",this.thumbnail=T,this._onNameChangedCallbacks=S.Callbacks(),this._onMimeTypeChangedCallbacks=S.Callbacks(),this._onDurationChangedCallbacks=S.Callbacks(),this._onSizeChangedCallbacks=S.Callbacks(),this._onStatusChangedCallbacks=S.Callbacks(),this._onConsumptionStatusChangedCallbacks=S.Callbacks(),this._onTypeChangedCallbacks=S.Callbacks(),this._onHasThumbnailChangedCallbacks=S.Callbacks(),this._onIsSelfGeneratedCallbacks=S.Callbacks(),this._updateNameCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateMimeTypeCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateDurationCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSizeCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateLocationCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIsSelfGeneratedCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createThumbnailCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeThumbnailCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}e.prototype={_getStatus:function(){return this.status},getName:function(){if(this.name)return this.name;if(this.disposition&&-1!==this.disposition.search("filename"))try{return this.name=new RegExp("filename=(?:[\"']?)([^\"';]+)","i").exec(this.disposition)[1],this.name}catch(e){t.Base.Logger.error(t.Base.LoggerTags.MESSAGING_SERVICE,"Could not retrieve attachment name: "+e)}return T},getMimeType:function(){return this.mimeType},getDuration:function(){return this.duration},getSize:function(){return this.size},_isThumbnail:function(){return-1!==this.disposition.indexOf("inline")},getThumbnail:function(){return this.thumbnail},setName:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.name=e},setMimeType:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.mimeType=e},setDuration:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"number"}]}),this.duration=e},getDownloadURL:function(){return this.location},createThumbnail:function(){return!!this.getCreateThumbnailCapability().isAllowed&&this._thumbnailCreator.create(this)},removeThumbnail:function(){this.thumbnail=T},_setStatus:function(e){this.status=e,this._onStatusChangedCallbacks.fire(e)}},t.Base.AOPTools.addAdvices(e,"Attachment",["createThumbnail"],[t.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,t.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),t.Services.Messaging.Attachment=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Messaging.Attachment.prototype,{addOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.add(e)},removeOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.remove(e)},addOnHasThumbnailChangedCallback:function(e){this._onHasThumbnailChangedCallbacks.add(e)},removeOnHasThumbnailChangedCallback:function(e){this._onHasThumbnailChangedCallbacks.remove(e)},addOnIsSelfGeneratedCallback:function(e){this._onIsSelfGeneratedCallbacks.add(e)},removeOnIsSelfGeneratedCallback:function(e){this._onIsSelfGeneratedCallbacks.remove(e)}})}(AvayaClientServices),function(r){"use strict";var e={getUpdateNameCapability:function(){return this._updateNameCapability},_recalculateUpdateNameCapability:function(){var e,t=this.status!==r.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateNameCapability._updateIfChanged(e,t)},getUpdateMimeTypeCapability:function(){return this._updateMimeTypeCapability},_recalculateUpdateMimeTypeCapability:function(){var e,t=this.status!==r.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateMimeTypeCapability._updateIfChanged(e,t)},getUpdateDurationCapability:function(){return this._updateDurationCapability},_recalculateUpdateDurationCapability:function(){var e,t=this.status!==r.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateDurationCapability._updateIfChanged(e,t)},getUpdateIsSelfGeneratedCapability:function(){return this._updateIsSelfGeneratedCapability},_recalculateUpdateIsSelfGeneratedCapability:function(){var e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._updateIsSelfGeneratedCapability._updateIfChanged(!0,e)},getCreateThumbnailCapability:function(){return this._createThumbnailCapability},_recalculateCreateThumbnailCapability:function(){var e,t,i,a=!1;for(t in this._thumbnailCreator._creators)this._thumbnailCreator._creators.hasOwnProperty(t)&&(-1!==(i=t).indexOf("/*")&&(i=t.slice(0,t.indexOf("/*"))),-1!==this.getMimeType().indexOf(i)&&(a=!0,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED));a||(e=r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createThumbnailCapability._updateIfChanged(a,e)},getRemoveThumbnailCapability:function(){return this._removeThumbnailCapability},_recalculateRemoveThumbnailCapability:function(){var e,t=this.status!==r.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._removeThumbnailCapability._updateIfChanged(e,t)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var e,t=this.status!==r.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._removeCapability._updateIfChanged(e,t)}};S.extend(r.Services.Messaging.Attachment.prototype,e)}(AvayaClientServices),function(a){"use strict";function e(e){this._conversationService=e,this.attachmentCount=0,this.totalMessageCount=0,this.active=!1,this.closed=!1,this.sensitivity=a.Services.Messaging.SensitivityLevel.NORMAL,this.href="",this.id="",this.lastAccessTime=T,this.lastUpdated=T,this.latestEntryTimestamp=T,this.subject="",this.totalCount=0,this.type=a.Services.Messaging.ConversationType.THREAD,this.unreadAttachmentCount=0,this.unreadCount=0,this.unreadContentSinceLastAccess=0,this.resourceStatus=a.Services.Messaging.ResourceStatus.PUBLISHED,this.messages=new a.Base.DataSet,this.previewText="",this.participants=[],this.composingParticipants=new a.Base.DataSet,this.multiparty=!1,this._draftMessages=[],this._draftEscalations=[],this._counts={eventCount:0,eventUnreadMessage:0,messageAttachment:0,messageCount:0,messageUnreadAttachment:0,messageUnreadMessage:0},this._isSubscribed=!1,this._onMessagesAddedCallbacks=S.Callbacks(),this._onSubjectChangedCallbacks=S.Callbacks(),this._onParticipantsAddedCallbacks=S.Callbacks(),this._onParticipantsRemovedCallbacks=S.Callbacks(),this._onActiveStatusChangedCallbacks=S.Callbacks(),this._onClosedStatusChangedCallbacks=S.Callbacks(),this._onMultiPartyStatusChangedCallbacks=S.Callbacks(),this._onIsComposingStatusChangedCallbacks=S.Callbacks(),this._onLastAccessTimeChangedCallbacks=S.Callbacks(),this._onLastUpdatedTimeChangedCallbacks=S.Callbacks(),this._onLatestEntryTimeChangedCallbacks=S.Callbacks(),this._onStatusChangedCallbacks=S.Callbacks(),this._onPreviewTextChangedCallbacks=S.Callbacks(),this._onTotalMessagesCountChangedCallbacks=S.Callbacks(),this._onTotalUnreadMessageCountChangedCallbacks=S.Callbacks(),this._onTotalAttachmentCountChangedCallbacks=S.Callbacks(),this._onTotalUnreadAttachmentCountChangedCallbacks=S.Callbacks(),this._onTotalEventCountChangedCallbacks=S.Callbacks(),this._onTotalUnreadEventCountChangedCallbacks=S.Callbacks(),this._onSensitivityChangedCallbacks=S.Callbacks(),this._onTypeChangedCallbacks=S.Callbacks(),this._onMessagesRemovedCallbacks=S.Callbacks(),this._onOtherMessagesAddedCallbacks=S.Callbacks(),this._updateSubjectCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateLastAccessTimeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSensitivityCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveMessagesCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantsCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeParticipantsCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createMessageCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createEscalationCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markAllContentAsReadCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._leaveCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._isTypingCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}e.prototype={getSensitivity:function(){return this.sensitivity},isActive:function(){return this.active},isClosed:function(){return this.closed},isMultiParty:function(){return this.multiparty},isPrivate:function(){return this.sensitivity===a.Services.Messaging.SensitivityLevel.PRIVATE},hasUnreadMessagesSinceLastAccess:function(){return 0<this._conversationService.getNumberOfMessagesWithUnreadContentSinceLastAccess(this)},hasUnreadAttachments:function(){return 0<this._counts.messageUnreadAttachment},hasAttachments:function(){return 0<this._counts.messageAttachment},isParticipantActive:function(e){},getLastAccessTime:function(){return this.lastAccessTime},getLastUpdatedTime:function(){return this.lastUpdated},getLastEntryTime:function(){return this.latestEntryTimestamp},getComposingParticipants:function(){return this.composingParticipants},getParticipants:function(){return this.participants},getActiveParticipants:function(){return this.getParticipants()},getType:function(){return this.type},getTotalMessageCount:function(){return this._counts.messageCount},getAttachmentCount:function(){return this._counts.messageAttachment},getUnreadAttachmentCount:function(){return this._counts.messageUnreadAttachment},getUnreadMessageCount:function(){return this._counts.messageUnreadMessage},getPreviewText:function(){return this.previewText},getSubject:function(){return this.subject},getLastUpdatedByParticipant:function(){var t=this._getLastMessage();return void 0===t?T:this.participants.filter(function(e){return e.address===t.from.address})[0]},getStatus:function(){return this.resourceStatus},setSensitivity:function(e){var t,i=!1;for(t in a.Services.Messaging.SensitivityLevel)if(a.Services.Messaging.SensitivityLevel.hasOwnProperty(t)&&e===a.Services.Messaging.SensitivityLevel[t]){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.sensitivity!==e&&(this.sensitivity=e,this._onSensitivityChangedCallbacks.fire(this,e)),i=!0;break}return i},_setStatus:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.resourceStatus!==e&&(this.resourceStatus=e,this._onStatusChangedCallbacks.fire(this,e))},setLastAccessTime:function(){this._conversationService.setLastAccessTime(this)},setSubject:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.subject!==e&&(this.getStatus()===a.Services.Messaging.ResourceStatus.PUBLISHED&&this._conversationService.changeSubject(this,e),this.subject=e,this._onSubjectChangedCallbacks.fire(this,this.subject))},_getLastMessage:function(){return this.messages.filter(function(e){return e.getType()===a.Services.Messaging.MessageType.MESSAGE})[0]},createMessage:function(){return this._conversationService.createMessage(this)},createEscalation:function(){var e=this._conversationService.createEscalation(this);return this._draftEscalations.push(e),e},removeEscalation:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Escalation}]}),this._conversationService.removeEscalation(e,this._draftEscalations)},getMessages:function(){return this.messages},retrieveMessagesAfter:function(e,t){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Message}]}),a.Base.Utils.validate(t,{optional:!0,validators:[{type:"type",expected:"number"}]}),this._conversationService.getOtherMessages(null,e,t,this)},retrieveMessagesBefore:function(e,t){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Message}]}),a.Base.Utils.validate(t,{optional:!0,validators:[{type:"type",expected:"number"}]}),this._conversationService.getOtherMessages(e,null,t,this)},markAllContentAsRead:function(){return this._conversationService.markAllAsRead(this)},subscribeForTypingEvents:function(e){return this._conversationService.subscribeForTypingEvents(this,e)},unsubscribeForTypingEvents:function(){return this._conversationService.unsubscribeForTypingEvents(this)},addParticipantAddresses:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._conversationService.addParticipantAddresses(this,e)},removeParticipantAddresses:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._conversationService.removeParticipantAddresses(this,e)},removeMessage:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Message}]}),this._conversationService.removeMessage(this.messages,this._draftMessages,e)},start:function(){var e=S.Deferred();return setTimeout(function(){e.resolve()}),e.promise()},leave:function(){return this._conversationService.leave(this)},_updateParticipantsList:function(e){this._conversationService._updateParticipantsList(this,e)},getId:function(){return this.id}},a.Base.AOPTools.addAdvices(e,"Conversation",["setSubject","createMessage","createEscalation","retrieveMessagesAfter","retrieveMessagesBefore"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),a.Base.AOPTools.addAdvices(e,"Conversation",["markAllContentAsRead","removeEscalation","subscribeForTypingEvents","unsubscribeForTypingEvents","addParticipantAddresses","removeParticipantAddresses","removeMessage","start","leave"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),a.Services.Messaging.Conversation=e}(AvayaClientServices),function(l){"use strict";function e(e){this._messageBuilder=e}e.prototype={build:function(e,t){var i=new l.Services.Messaging.Conversation(t);i.attachmentCount=e.attachmentCount||0,e.counts&&(i.totalMessageCount=e.counts.messageCount||0),e.flags&&(i.active=e.flags.active,i.closed=e.flags.closed,i.sensitivity=e.flags.sensitivity),i.href=e.href,i.id=e.id,i.lastAccessTime=new Date(e.lastAccessedTime),i.participants=new l.Base.DataSet,i.lastUpdated=new Date(e.lastUpdated),i.latestEntryTimestamp=new Date(e.latestEntryTimestamp),i.subject=e.subject,i.totalCount=e.totalCount||0,i.type=e.type||l.Services.Messaging.ConversationType.THREAD,i.unreadAttachmentCount=e.unreadAttachmentCount||0,i.unreadCount=e.unreadCount||0,i.resourceStatus=e.resourceStatus||l.Services.Messaging.ResourceStatus.PUBLISHED,e.counts&&(i._counts.eventCount=e.counts.eventCount||0,i._counts.eventUnreadMessage=e.counts.eventUnreadMessage||0,i._counts.messageAttachment=e.counts.messageAttachment||0,i._counts.messageCount=e.counts.messageCount||0,i._counts.messageUnreadAttachment=e.counts.messageUnreadAttachment||0,i._counts.messageUnreadMessage=e.counts.messageUnreadMessage||0);e=i._getLastMessage();return i.previewText=e?e.from.givenName+": "+e.body:"",t._recalculateAllConversationCapabilities(i),i},update:function(e,t,i){e.attachmentCount!==t.attachmentCount&&(e.attachmentCount=t.attachmentCount,e._onTotalAttachmentCountChangedCallbacks.fire(e,e.attachmentCount)),t.counts&&e.totalMessageCount!==t.counts.messageCount&&(e.totalMessageCount=t.counts.messageCount,e._onTotalMessagesCountChangedCallbacks.fire(e,e.totalMessageCount)),t.flags&&(e.active!==t.flags.active&&(e.active=t.flags.active,e._onActiveStatusChangedCallbacks.fire(e,e.active)),e.closed!==t.flags.closed&&(e.closed=t.flags.closed,e._onClosedStatusChangedCallbacks.fire(e,e.closed)),e.sensitivity!==t.flags.sensitivity&&(e.sensitivity=t.flags.sensitivity,e._onSensitivityChangedCallbacks.fire(e,e.sensitivity))),e.multiparty!==t.isMultiparty&&(e.multiparty=t.isMultiparty,e._onMultiPartyStatusChangedCallbacks.fire(e,e.multiparty));var a=new Date(t.lastUpdated);return e.lastUpdated&&e.lastUpdated.getTime()===a.getTime()||(e.lastUpdated=a,e._onLastUpdatedTimeChangedCallbacks.fire(e,e.lastUpdated)),a=new Date(t.lastAccessedTime),e.lastAccessTime&&e.lastAccessTime.getTime()===a.getTime()||(e.lastAccessTime=a,e._onLastAccessTimeChangedCallbacks.fire(e,e.lastAccessTime)),a=new Date(t.latestEntryTimestamp),e.latestEntryTimestamp&&e.latestEntryTimestamp.getTime()===a.getTime()||(e.latestEntryTimestamp=a,e._onLatestEntryTimeChangedCallbacks.fire(e,e.latestEntryTimestamp)),e.subject!==t.subject&&(e.subject=t.subject,e._onSubjectChangedCallbacks.fire(e,e.subject)),e.type!==t.type&&(e.type=t.type,e._onTypeChangedCallbacks.fire(e,e.type)),e.unreadAttachmentCount!==t.unreadAttachmentCount&&(e.unreadAttachmentCount=t.unreadAttachmentCount,e._onTotalUnreadAttachmentCountChangedCallbacks.fire(e,e.unreadAttachmentCount)),e.unreadCount!==t.unreadCount&&(e.unreadCount=t.unreadCount,e._onTotalUnreadMessageCountChangedCallbacks.fire(e,e.unreadCount)),t.counts&&(e._counts.eventCount!==t.counts.eventCount&&(e._counts.eventCount=t.counts.eventCount,e._onTotalEventCountChangedCallbacks.fire(e,e._counts.eventCount)),e._counts.eventUnreadMessage!==t.counts.eventUnreadMessage&&(e._counts.eventUnreadMessage=t.counts.eventUnreadMessage,e._onTotalUnreadEventCountChangedCallbacks.fire(e,e._counts.eventUnreadMessage)),e._counts.messageAttachment!==t.counts.messageAttachment&&(e._counts.messageAttachment=t.counts.messageAttachment,e._onTotalAttachmentCountChangedCallbacks.fire(e,e._counts.messageAttachment)),e._counts.messageCount!==t.counts.messageCount&&(e._counts.messageCount=t.counts.messageCount,e._onTotalMessagesCountChangedCallbacks.fire(e,e._counts.messageCount)),e._counts.messageUnreadAttachment!==t.counts.messageUnreadAttachment&&(e._counts.messageUnreadAttachment=t.counts.messageUnreadAttachment,e._onTotalUnreadAttachmentCountChangedCallbacks.fire(e,e._counts.messageUnreadAttachment)),e._counts.messageUnreadMessage!==t.counts.messageUnreadMessage&&(e._counts.messageUnreadMessage=t.counts.messageUnreadMessage,e._onTotalUnreadMessageCountChangedCallbacks.fire(e,e._counts.messageUnreadMessage))),i._recalculateAllConversationCapabilities(e),this.updateMessages(e,t,i)},updateMessages:function(e,t,i){for(var a,r=[],s=[],n=t.messages.length-1;0<=n;n--){var o=t.messages[n],c=this._getMessageById(e.messages,o.id);void 0!==c?c.getLastModifiedDate().toISOString()!==new Date(o.lastModifiedDate).toISOString()&&(t.messages[n+1]&&(a=this._getMessageById(e.messages,t.messages[n+1].id)),this._updateExistingMessage(c,o,a),r.push(c)):(t.messages[n+1]&&(a=this._getMessageById(e.messages,t.messages[n+1].id)),a=this._addNewMessage(e,o,a,i),e._onMessagesAddedCallbacks.fire(e,[a]),s.push(a))}return 0<r.length&&e.messages.onDataSetChanged(r,l.Base.DataSetChangeTypes.UPDATED),0<s.length&&e.messages.onDataSetChanged(s,l.Base.DataSetChangeTypes.ADDED),(0<r.length||0<s.length)&&this._updatePreviewText(e),s},_getMessageById:function(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t)return e[i]},_updatePreviewText:function(e){var t=e._getLastMessage(),t=t&&t.from?t.from.givenName+": "+t.getBody():"";t!==e.previewText&&(e.previewText=t,e._onPreviewTextChangedCallbacks.fire(e,t))},_removeParticipant:function(e,t){var i,a=e.participants.filter(function(e){return e.getAddress()===t.eventRelatedParticipants[0].address});0<a.length&&(i=e.participants.indexOf(a[0]),e.participants.splice(i,1),e._onParticipantsRemovedCallbacks.fire(e,a[0]))},_updateExistingMessage:function(e,t,i){return this._messageBuilder.update(e,t),i&&e._setIsCoalesced(this._messageBuilder.isMessageCoalesced(e,i)),e},_addNewMessage:function(e,t,i,a){t=a.createNewClientMessage(t,e);return i&&t._setIsCoalesced(this._messageBuilder.isMessageCoalesced(t,i)),e.messages.push(t),t.getType()===l.Services.Messaging.MessageType.LEFT&&this._removeParticipant(e,t),e.messages.sort(function(e,t){return e.lastModifiedDate.getTime()-t.lastModifiedDate.getTime()}),t}},l.Services.Messaging.ConversationBuilder=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Messaging.Conversation.prototype,{addOnTotalMessageCountChangedCallback:function(e){this._onTotalMessagesCountChangedCallbacks.add(e)},removeOnTotalMessageCountChangedCallback:function(e){this._onTotalMessagesCountChangedCallbacks.remove(e)},addOnSubjectChangedCallback:function(e){this._onSubjectChangedCallbacks.add(e)},removeOnSubjectChangedCallback:function(e){this._onSubjectChangedCallbacks.remove(e)},addOnActiveStatusChangedCallback:function(e){this._onActiveStatusChangedCallbacks.add(e)},removeOnActiveStatusChangedCallback:function(e){this._onActiveStatusChangedCallbacks.remove(e)},addOnClosedStatusChangedCallback:function(e){this._onClosedStatusChangedCallbacks.add(e)},removeOnClosedStatusChangedCallback:function(e){this._onClosedStatusChangedCallbacks.remove(e)},addOnMultiPartyStatusChangedCallback:function(e){this._onMultiPartyStatusChangedCallbacks.add(e)},removeOnMultiPartyStatusChangedCallback:function(e){this._onMultiPartyStatusChangedCallbacks.remove(e)},addOnLastAccessTimeChangedCallback:function(e){this._onLastAccessTimeChangedCallbacks.add(e)},removeOnLastAccessTimeChangedCallback:function(e){this._onLastAccessTimeChangedCallbacks.remove(e)},addOnLastUpdatedTimeChangedCallback:function(e){this._onLastUpdatedTimeChangedCallbacks.add(e)},removeOnLastUpdatedTimeChangedCallback:function(e){this._onLastUpdatedTimeChangedCallbacks.remove(e)},addOnLatestEntryTimeChangedCallback:function(e){this._onLatestEntryTimeChangedCallbacks.add(e)},removeOnLatestEntryTimeChangedCallback:function(e){this._onLatestEntryTimeChangedCallbacks.remove(e)},addOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.add(e)},removeOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.remove(e)},addOnPreviewTextChangedCallback:function(e){this._onPreviewTextChangedCallbacks.add(e)},removeOnPreviewTextChangedCallback:function(e){this._onPreviewTextChangedCallbacks.remove(e)},addOnTotalAttachmentCountChangedCallback:function(e){this._onTotalAttachmentCountChangedCallbacks.add(e)},removeOnTotalAttachmentCountChangedCallback:function(e){this._onTotalAttachmentCountChangedCallbacks.remove(e)},addOnTotalUnreadMessageCountChangedCallback:function(e){this._onTotalUnreadMessageCountChangedCallbacks.add(e)},removeOnTotalUnreadMessageCountChangedCallback:function(e){this._onTotalUnreadMessageCountChangedCallbacks.remove(e)},addOnTotalUnreadAttachmentCountChangedCallback:function(e){this._onTotalUnreadAttachmentCountChangedCallbacks.add(e)},removeOnTotalUnreadAttachmentCountChangedCallback:function(e){this._onTotalUnreadAttachmentCountChangedCallbacks.remove(e)},addOnSensitivityChangedCallback:function(e){this._onSensitivityChangedCallbacks.add(e)},removeOnSensitivityChangedCallback:function(e){this._onSensitivityChangedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";var e={getUpdateSubjectCapability:function(){return this._updateSubjectCapability},_recalculateUpdateSubjectCapability:function(){var e,t;!this._conversationService.isServiceAvailable()||this.closed?(e=!1,t=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):this.resourceStatus===i.Services.Messaging.ResourceStatus.PUBLISHED?t=this._conversationService.isUpdateSubjectSupported()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(e=!0,t=i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateSubjectCapability._updateIfChanged(e,t)},getUpdateLastAccessTimeCapability:function(){return this._updateLastAccessTimeCapability},_recalculateUpdateLastAccessTimeCapability:function(){var e,t=!this._conversationService.isServiceAvailable()||this.closed||this.resourceStatus!==i.Services.Messaging.ResourceStatus.PUBLISHED?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateLastAccessTimeCapability._updateIfChanged(e,t)},getUpdateSensitivityCapability:function(){return this._updateSensitivityCapability},_recalculateUpdateSensitivityCapability:function(){var e,t=!this._conversationService.isServiceAvailable()||this.closed||this.resourceStatus!==i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateSensitivityCapability._updateIfChanged(e,t)},getRetrieveMessagesCapability:function(){return this._retrieveMessagesCapability},_recalculateOlderContentCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.PUBLISHED&&this.totalCount!==this.messages.length?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._retrieveMessagesCapability._updateIfChanged(e,t)},getAddParticipantsCapability:function(){return this._addParticipantsCapability},_recalculateAddParticipantsCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&(this.isActive()||this.getStatus()===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT)?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addParticipantsCapability._updateIfChanged(e,t)},getRemoveParticipantsCapability:function(){return this._removeParticipantsCapability},_recalculateRemoveParticipantsCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&this.getStatus()===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeParticipantsCapability._updateIfChanged(e,t)},getCreateMessageCapability:function(){return this._createMessageCapability},_recalculateCreateMessageCapability:function(){var e,t=!this._conversationService.isServiceAvailable()||this.closed?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._createMessageCapability._updateIfChanged(e,t)},getCreateEscalationCapability:function(){return this._createEscalationCapability},_recalculateCreateEscalationCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&this.getStatus()!==i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createEscalationCapability._updateIfChanged(e,t)},getMarkAllContentAsReadCapability:function(){return this._markAllContentAsReadCapability},_recalculateMarkAllContentAsReadCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&0!==this._counts.messageUnreadMessage?this._conversationService.isMarkAllContentAsReadSupported()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._markAllContentAsReadCapability._updateIfChanged(e,t)},getLeaveCapability:function(){return this._leaveCapability},_recalculateLeaveCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&this.active&&!this.closed?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._leaveCapability._updateIfChanged(e,t)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var e,t=this._conversationService.isServiceAvailable()&&this.getStatus()===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(e,t)},getSendCapability:function(){return this._startCapability},_recalculateStartCapability:function(){var e,t=!this._conversationService.isServiceAvailable()||this.closed||!this.active||this.resourceStatus!==i.Services.Messaging.ResourceStatus.DRAFT_UNSENT||0===this.participants.filter(function(e){return!e.isLocalUser()}).length?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._startCapability._updateIfChanged(e,t)},getIsTypingCapability:function(){return this._isTypingCapability},_recalculateIsTypingCapability:function(){var e,t=this._conversationService.isOpened(),t=this._conversationService.isServiceAvailable()&&t&&this._isSubscribed?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._isTypingCapability._updateIfChanged(e,t)}};S.extend(i.Services.Messaging.Conversation.prototype,e)}(AvayaClientServices),function(a){"use strict";function e(e,t){this._messageService=e,this.conversation=t,this.resourceStatus=a.Services.Messaging.ResourceStatus.PUBLISHED,this.body="",this.htmlBody="",this.type=a.Services.Messaging.MessageType.MESSAGE,this.sensitivity=a.Services.Messaging.SensitivityLevel.NORMAL,this.importance=a.Services.Messaging.MessageImportance.NORMAL,this.read=!1,this.doNotForward=!1,this.from=T,this.href="",this.id="",this.lastModifiedDate=T,this.receivedDate=T,this.subject="",this.threadId="",this.to=T,this.parts=new a.Base.DataSet,this._attachments=[],this.coalesced=!1,this.inReplyTo=T,this._sessionType=T,this._onTypeChangedCallbacks=S.Callbacks(),this._onBodyChangedCallbacks=S.Callbacks(),this._onInReplyToChangedCallbacks=S.Callbacks(),this._onLastModifiedDateChangedCallbacks=S.Callbacks(),this._onIsCoalescedStatusChangedCallbacks=S.Callbacks(),this._onHasAttachmentStatusChangedCallbacks=S.Callbacks(),this._onHasUnreadAttachmentStatusChangedCallbacks=S.Callbacks(),this._onIsPrivateStatusChangedCallbacks=S.Callbacks(),this._onDoNotForwardStatusChangedCallbacks=S.Callbacks(),this._onIsReadStatusChangedCallbacks=S.Callbacks(),this._onStatusChangedCallbacks=S.Callbacks(),this._onImportanceChangedCallbacks=S.Callbacks(),this._onSensitivityChangedCallbacks=S.Callbacks(),this._updateBodyCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSensitivityCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateInReplyToCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateDoNotForwardCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateImportanceCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createAttachmentCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markAsReadCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}e.prototype={getType:function(){return this.type},getBody:function(){return this.body},getHtmlBody:function(){return this.htmlBody},getConversationId:function(){return this.conversation.getId()},getId:function(){return this.id},getInReplyTo:function(){return this.inReplyTo},getSessionType:function(){return this._sessionType},getLastModifiedDate:function(){return this.lastModifiedDate},getReceivedDate:function(){return this.receivedDate},isCoalesced:function(){return this.coalesced},hasHtmlBody:function(){return 0<this.htmlBody.length},hasAttachment:function(){return 0<this.parts.length},hasUnreadAttachment:function(){return this.parts.reduce(function(e,t){return e||!t.isRead()},!1)},isPrivate:function(){return this.sensitivity===a.Services.Messaging.SensitivityLevel.PRIVATE},isDoNotForward:function(){return this.doNotForward},isRead:function(){return this.read},getFromParticipant:function(){return this.from},getAttachments:function(){return this.parts},getStatus:function(){return this.resourceStatus},getImportance:function(){return this.importance},getSensitivity:function(){return this.sensitivity},setBodyAndReportTyping:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._messageService.setBodyAndReportTyping(this,this.conversation,e)},reportTyping:function(e){this.conversation.getStatus()===a.Services.Messaging.ResourceStatus.PUBLISHED&&this.conversation.getIsTypingCapability().isAllowed&&this.conversation._conversationService.reportTyping(this,e)},setSensitivity:function(e){for(var t in a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),a.Services.Messaging.SensitivityLevel)a.Services.Messaging.SensitivityLevel.hasOwnProperty(t)&&e===a.Services.Messaging.SensitivityLevel[t]&&(a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.sensitivity!==e&&(this.sensitivity=e,this._onSensitivityChangedCallbacks.fire(this,e)))},_setIsCoalesced:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"boolean"}]}),this.coalesced!==e&&(this.coalesced=e,this._onIsCoalescedStatusChangedCallbacks.fire(this,e))},isFromMe:function(){return!!this.from&&this.from.isSelf()},setInReplyTo:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Message}]}),e instanceof a.Services.Messaging.Message&&void 0!==e.getId()&&this.inReplyTo!==e&&(this.inReplyTo=e.getId(),this._onInReplyToChangedCallbacks.fire(this,this.inReplyTo))},setDoNotForward:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"boolean"}]}),this.doNotForward!==e&&(this.doNotForward=e,this._onDoNotForwardStatusChangedCallbacks.fire(this,e))},_setStatus:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.resourceStatus!==e&&(this.resourceStatus=e,this._onStatusChangedCallbacks.fire(this,e))},setImportance:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]});var t,i=!1;for(t in a.Services.Messaging.MessageImportance)if(a.Services.Messaging.MessageImportance.hasOwnProperty(t)&&e===a.Services.Messaging.MessageImportance[t]){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.importance!==e&&(this.importance=e,this._onImportanceChangedCallbacks.fire(this,e)),i=!0;break}return i},markAsRead:function(){return this._messageService.markAsRead(this)},send:function(){return this._messageService.send(this)},createAttachment:function(e){return a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:File}]}),this._messageService.createAttachment(this,e)},removeDraftAttachment:function(e){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:a.Services.Messaging.Attachment}]}),this._messageService.removeDraftAttachment(this,e)}},a.Base.AOPTools.addAdvices(e,"Message",["removeDraftAttachment","createAttachment","reportTyping"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),a.Base.AOPTools.addAdvices(e,"Message",["send","markAsRead","setBodyAndReportTyping"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),a.Services.Messaging.Message=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Messaging.Message.prototype,{addOnBodyChangedCallback:function(e){this._onBodyChangedCallbacks.add(e)},removeOnBodyChangedCallback:function(e){this._onBodyChangedCallbacks.remove(e)},addOnInReplyToChangedCallback:function(e){this._onInReplyToChangedCallbacks.add(e)},removeOnInReplyToChangedCallback:function(e){this._onInReplyToChangedCallbacks.remove(e)},addOnLastModifiedDateChangedCallback:function(e){this._onLastModifiedDateChangedCallbacks.add(e)},removeOnLastModifiedDateChangedCallback:function(e){this._onLastModifiedDateChangedCallbacks.remove(e)},addOnIsCoalescedStatusChangedCallback:function(e){this._onIsCoalescedStatusChangedCallbacks.add(e)},removeOnIsCoalescedStatusChangedCallback:function(e){this._onIsCoalescedStatusChangedCallbacks.remove(e)},addOnHasAttachmentStatusChangedCallback:function(e){this._onHasAttachmentStatusChangedCallbacks.add(e)},removeOnHasAttachmentStatusChangedCallback:function(e){this._onHasAttachmentStatusChangedCallbacks.remove(e)},addOnHasUnreadAttachmentStatusChangedCallback:function(e){this._onHasUnreadAttachmentStatusChangedCallbacks.add(e)},removeOnHasUnreadAttachmentStatusChangedCallback:function(e){this._onHasUnreadAttachmentStatusChangedCallbacks.remove(e)},addOnIsPrivateStatusChangedCallback:function(e){this._onIsPrivateStatusChangedCallbacks.add(e)},removeOnIsPrivateStatusChangedCallback:function(e){this._onIsPrivateStatusChangedCallbacks.remove(e)},addOnDoNotForwardStatusChangedCallback:function(e){this._onDoNotForwardStatusChangedCallbacks.add(e)},removeOnDoNotForwardStatusChangedCallback:function(e){this._onDoNotForwardStatusChangedCallbacks.remove(e)},addOnIsReadStatusChangedCallback:function(e){this._onIsReadStatusChangedCallbacks.add(e)},removeOnIsReadStatusChangedCallback:function(e){this._onIsReadStatusChangedCallbacks.remove(e)},addOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.add(e)},removeOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.remove(e)},addOnImportanceChangedCallback:function(e){this._onImportanceChangedCallbacks.add(e)},removeOnImportanceChangedCallback:function(e){this._onImportanceChangedCallbacks.remove(e)},addOnSensitivityChangedCallback:function(e){this._onSensitivityChangedCallbacks.add(e)},removeOnSensitivityChangedCallback:function(e){this._onSensitivityChangedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";var e={getUpdateBodyCapability:function(){return this._updateBodyCapability},_recalculateUpdateBodyCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateBodyCapability._updateIfChanged(e,t)},getUpdateSensitivityCapability:function(){return this._updateSensitivityCapability},_recalculateUpdateSensitivityCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.conversation.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateSensitivityCapability._updateIfChanged(e,t)},getUpdateInReplyToCapability:function(){return this._updateInReplyToCapability},_recalculateUpdateInReplyToCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateInReplyToCapability._updateIfChanged(e,t)},getUpdateDoNotForwardCapability:function(){return this._updateDoNotForwardCapability},_recalculateUpdateDoNotForwardCapability:function(){var e,t=this._messageService.isServiceAvailable()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateDoNotForwardCapability._updateIfChanged(e,t)},getUpdateImportanceCapability:function(){return this._updateImportanceCapability},_recalculateUpdateImportanceCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateImportanceCapability._updateIfChanged(e,t)},getCreateAttachmentCapability:function(e){return this._createAttachmentCapability},_recalculateCreateAttachmentCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createAttachmentCapability._updateIfChanged(e,t)},getSendCapability:function(){return this._sendCapability},_recalculateSendCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&this.conversation.active&&!this.conversation.closed?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._sendCapability._updateIfChanged(e,t)},getMarkAsReadCapability:function(){return this._markAsReadCapability},_recalculateMarkAsReadCapability:function(){var e,t=!this._messageService.isServiceAvailable()||this.read?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._markAsReadCapability._updateIfChanged(e,t)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var e,t=this._messageService.isServiceAvailable()&&this.resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(e,t)}};S.extend(i.Services.Messaging.Message.prototype,e)}(AvayaClientServices),function(t){"use strict";function e(e){this._messagingService=e,this._isAvailable=T,this._onMessagingLimitsChangedCallbacks=S.Callbacks(),this._onRoutableDomainsChangedCallbacks=S.Callbacks(),this._onNumberOfConversationsWithUnreadContentChangedCallbacks=S.Callbacks(),this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks=S.Callbacks(),this._onMessagingServiceUnavailableCallbacks=S.Callbacks(),this._onMessagingServiceAvailableCallbacks=S.Callbacks(),this._retrieveConversationsCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startServiceCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createConversationCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._searchConversationsCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateRefreshIntervalCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._validateParticipantAddressesCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markContentAsReadCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._clearLocalDataCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._messagingUnavailableReason=T}e.prototype={getRoutableDomains:function(){return this._messagingService.getRoutableDomains()},getSelfAddress:function(){return this._messagingService.getSelfAddress()},getNumberOfConversationsWithUnreadContentSinceLastAccess:function(){return this._messagingService.getNumberOfConversationsWithUnreadContentSinceLastAccess()},getNumberOfConversationsWithUnreadContent:function(){return this._messagingService.getNumberOfConversationsWithUnreadContent()},createConversation:function(){return this._messagingService.createConversation(this)},getActiveConversations:function(){return this._messagingService.getActiveConversations(this)},getDraftConversations:function(){return this._messagingService.getDraftConversations()},getConversationIds:function(){return this._messagingService.getConversationIds()},searchConversations:function(e){return t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:t.Services.Messaging.MessagingQuery}]}),this._messagingService.searchConversations(e,this)},getAllActiveConversationsForContact:function(e){},validateAddresses:function(e){return t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._messagingService.validateUsers(e)},leaveConversations:function(e){return t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:t.Services.Messaging.Conversation}]}),this._messagingService.leaveConversations(e)},leaveAllConversations:function(){return this._messagingService.leaveAllConversations()},start:function(e){return this._startDfd=S.Deferred(),this._messagingService.start(this,e),this._startDfd.promise()},stop:function(){return this._messagingService.stop(this)},_stopImmediately:function(){return this._messagingService._stopImmediately(this)},removeConversation:function(e){return t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:t.Services.Messaging.Conversation}]}),this._messagingService.removeConversation(e)},_fireMessagingAvailableCallback:function(){!t.Base.Utils.isUndefined(this._isAvailable)&&this._isAvailable||(this._isAvailable=!0,this._messagingUnavailableReason=T,this._startDfd.state()===t.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onMessagingServiceAvailableCallbacks.fire(this))},_fireMessagingUnavailableCallback:function(e){(t.Base.Utils.isUndefined(this._isAvailable)||this._isAvailable)&&(this._isAvailable=!1,this._messagingUnavailableReason=e,this._startDfd.state()===t.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onMessagingServiceUnavailableCallbacks.fire(this))}},t.Base.AOPTools.addAdvices(e,"Messaging",["createConversation","getActiveConversations","searchConversations"],[t.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),t.Base.AOPTools.addAdvices(e,"Messaging",["validateAddresses","leaveConversations","leaveAllConversations","removeConversation"],[t.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,t.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),t.Services.Messaging.Messaging=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Messaging.Messaging.prototype,{addOnMessagingLimitsChangedCallback:function(e){this._onMessagingLimitsChangedCallbacks.add(e)},removeOnMessagingLimitsChangedCallback:function(e){this._onMessagingLimitsChangedCallbacks.remove(e)},addOnRoutableDomainsChangedCallback:function(e){this._onRoutableDomainsChangedCallbacks.add(e)},removeOnRoutableDomainsChangedCallback:function(e){this._onRoutableDomainsChangedCallbacks.remove(e)},addOnNumberOfConversationsWithUnreadContentChangedCallback:function(e){this._onNumberOfConversationsWithUnreadContentChangedCallbacks.add(e)},removeOnNumberOfConversationsWithUnreadContentChangedCallback:function(e){this._onNumberOfConversationsWithUnreadContentChangedCallbacks.remove(e)},addOnNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallback:function(e){this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.add(e)},removeOnNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallback:function(e){this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.remove(e)},addOnMessagingServiceUnavailableCallback:function(e){this._onMessagingServiceUnavailableCallbacks.add(e)},removeOnMessagingServiceUnavailableCallback:function(e){this._onMessagingServiceUnavailableCallbacks.remove(e)},addOnMessagingServiceAvailableCallback:function(e){this._onMessagingServiceAvailableCallbacks.add(e)},removeOnMessagingServiceAvailableCallback:function(e){this._onMessagingServiceAvailableCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";var e={getStartServiceCapability:function(){return this._startServiceCapability},_recalculateStartServiceCapability:function(){var e,t=this._isAvailable?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._startServiceCapability._updateIfChanged(e,t)},getCreateConversationCapability:function(){return this._createConversationCapability},_recalculateCreateConversationCapability:function(){var e,t=this._isAvailable?this._messagingService.getConversationResource()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createConversationCapability._updateIfChanged(e,t)},getRetrieveConversationsCapability:function(){return this._retrieveConversationsCapability},_recalculateRetrieveConversationsCapability:function(){var e,t=this._isAvailable&&this._messagingService.getConversationResource()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._retrieveConversationsCapability._updateIfChanged(e,t)},getSearchConversationsCapability:function(){return this._searchConversationsCapability},_recalculateSearchConversationsCapability:function(){var e,t=this._isAvailable?this._messagingService.getConversationResource()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._searchConversationsCapability._updateIfChanged(e,t)},getValidateParticipantAddressesCapability:function(){return this._validateParticipantAddressesCapability},_recalculateValidateParticipantAddressCapability:function(){var e,t=this._isAvailable,t=t&&this._messagingService.getValidateAddressResource()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):t&&!this._messagingService.getValidateAddressResource()?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._validateParticipantAddressesCapability._updateIfChanged(e,t)},getMarkContentAsReadCapability:function(){return this._markContentAsReadCapability},_recalculateMarkContentAsReadCapability:function(){var e,t=this._isAvailable,t=t&&this._messagingService.getMarkAsReadResource()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):t&&!this._messagingService.getMarkAsReadResource()?(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._markContentAsReadCapability._updateIfChanged(e,t)}};S.extend(i.Services.Messaging.Messaging.prototype,e)}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Participant.call(this),this._address=e._address,this._localUser=t,this.type=e.type,this.givenName=e.givenName,this.language=e.language,this.modalities=e.modalities,this.nativeGivenName=e.nativeGivenName,this.nativeSurname=e.nativeSurname,this.surname=e.surname}(e.prototype=Object.create(i.Services.Participant.prototype)).getType=function(){return this.type},e.prototype.getAddress=function(){return this._address},e.prototype.getGivenName=function(){return this.givenName},e.prototype.getSurname=function(){return this.nativeSurname},e.prototype.getDisplayName=function(){var e=this._displayName&&""!==this._displayName?this._displayName:this.givenName||this.surname?this.surname?this.givenName?this.givenName+" "+this.surname:this.surname:this.givenName:this._address;return e},e.prototype.getSupportedModalities=function(){return this.modalities},e.prototype.isSelf=function(){return this.self},i.Services.Messaging.Participant=e}(AvayaClientServices),function(i){"use strict";function e(e){this._presenceProvider=e,this._userAddresses=[],this._internalAddresses=[],this._selfAddress=T,this._onPresenceNotification=T,this._onStartedCallbacks=S.Callbacks(),this._onStoppedCallbacks=S.Callbacks(),this._onPresenceReceivedCallbacks=S.Callbacks(),this._onInternalPresenceReceivedCallbacks=S.Callbacks(),this._onSelfPresenceReceivedCallbacks=S.Callbacks()}e.prototype={addAddress:function(e){return this._subscribe(e).then(function(){this._userAddresses.push(e)}.bind(this))},_addInternalAddress:function(e){return this._subscribe(e).then(function(){this._internalAddresses.push(e)}.bind(this))},_subscribe:function(e){return e&&""!==e.trim()?(i.Base.Logger.debug(i.Base.LoggerTags.PRESENCE_SERVICE,"Subscribing for presence",e),this._presenceProvider.subscribeForSingleAddressPresence(e)):(i.Base.Logger.error(i.Base.LoggerTags.PRESENCE_SERVICE,"Subscription was requested for empty/undefined address",e),S.Deferred().reject(new i.Services.Presence.PresenceError(i.Services.Presence.PresenceErrorReason.INVALID_REQUEST)).promise())},_setSelfAddress:function(e){this._selfAddress=e},removeAddress:function(t){return this._userAddresses=this._userAddresses.filter(function(e){return t!==e},this),this._presenceProvider.unsubscribeFromSingleAddressPresence(t)},_removeInternalAddress:function(t){return this._internalAddresses=this._internalAddresses.filter(function(e){return t!==e},this),this._presenceProvider.unsubscribeFromSingleAddressPresence(t)},_start:function(){return this._onPresenceNotification=function(e){var t=e.getPresentity();i.Base.Logger.debug(i.Base.LoggerTags.PRESENCE_SERVICE,"Received presence information",t),this._selfAddress===t&&(e=S.extend(new i.Services.Presence.SelfPresence,e),this._onSelfPresenceReceivedCallbacks.fire(e)),-1!==this._userAddresses.indexOf(t)&&this._onPresenceReceivedCallbacks.fire(this,e),-1!==this._internalAddresses.indexOf(t)&&this._onInternalPresenceReceivedCallbacks.fire(e)}.bind(this),this._presenceProvider.on(i.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,this._onPresenceNotification),this._presenceProvider.subscribeForPresence([this._selfAddress]).then(function(){this._onStartedCallbacks.fire()}.bind(this))},_stop:function(){return this._presenceProvider.unsubscribeFromAllAddressesPresence().always(function(){this._onStoppedCallbacks.fire(),this._onStartedCallbacks.empty(),this._onStoppedCallbacks.empty(),this._onPresenceReceivedCallbacks.empty(),this._onInternalPresenceReceivedCallbacks.empty(),this._onSelfPresenceReceivedCallbacks.empty()}.bind(this))}},i.Base.AOPTools.addAdvices(e,"PresenceListSubscription",["addAddress","removeAddress"],[i.Base.AOPCommonAdvices.LOG_PRESENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_PRESENCE_ERROR]),i.Services.Presence.PresenceListSubscription=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Presence.PresenceListSubscription.prototype,{addOnStartedCallback:function(e){this._onStartedCallbacks.add(e)},removeOnStartedCallback:function(e){this._onStartedCallbacks.remove(e)},addOnStoppedCallback:function(e){this._onStoppedCallbacks.add(e)},removeOnStoppedCallback:function(e){this._onStoppedCallbacks.remove(e)},addOnPresenceReceivedCallback:function(e){this._onPresenceReceivedCallbacks.add(e)},removeOnPresenceReceivedCallback:function(e){this._onPresenceReceivedCallbacks.remove(e)},_addOnInternalPresenceReceivedCallback:function(e){this._onInternalPresenceReceivedCallbacks.add(e)},_removeOnInternalPresenceReceivedCallback:function(e){this._onInternalPresenceReceivedCallbacks.remove(e)},_addOnSelfPresenceReceivedCallback:function(e){this._onSelfPresenceReceivedCallbacks.add(e)},_removeOnSelfPresenceReceivedCallback:function(e){this._onSelfPresenceReceivedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";function e(e){this._presenceProvider=e,this._selfPresenceManagedExternally=!1,this._selfPresence=T,this._selfAddress=T,this._phoneAndVideoChannelAddress=T,this._presenceSubscriptions=new i.Services.Presence.PresenceListSubscription(this._presenceProvider),this._onSelfPresenceNotification=T,this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._available=T,this._starting=!1,this._started=!1,this._userConfiguration=T,this._onSelfPresenceReceivedCallbacks=S.Callbacks(),this._onPresenceServiceAvailableCallbacks=S.Callbacks(),this._onPresenceServiceUnavailableCallbacks=S.Callbacks()}e.prototype={publishAutomaticPresence:function(){return this._selfPresence?(this._selfPresence._setPhoneContact(this._phoneAndVideoChannelAddress),this._selfPresence._setVideoContact(this._phoneAndVideoChannelAddress),this._selfPresence._setEnterpriseIMContact(this._selfAddress),this._selfPresence._manualState!==i.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNKNOWN&&this._selfPresence._manualState!==i.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNSPECIFIED&&i.Base.Logger.warn(i.Base.LoggerTags.PRESENCE_SERVICE,"Presence manual state set, automatic presence state will not take effect"),this._presenceProvider.publishAutomaticPresence(this._selfPresence)):S.Deferred().reject(new i.Services.Presence.PresenceError(i.Services.Presence.PresenceErrorReason.INVALID_STATE))},publishManualState:function(e){return this._presenceProvider.publishManualState(e)},publishLocationMode:function(e){return this._presenceProvider.publishLocationMode(e)},publishNote:function(e){return this._presenceProvider.publishNote(e)},getPresenceListSubscription:function(){return this._presenceSubscriptions},getSelfPresence:function(){return this._selfPresence},start:function(e){return this._startDfd=S.Deferred(),i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Starting the service"),this.userConfiguration=e,this._onSelfPresenceNotification=function(e){this._selfPresenceManagedExternally||(this._selfPresence=e,this._onSelfPresenceReceivedCallbacks.fire(this,e))}.bind(this),this._subscribeForProvidersNotifications(),this._starting=!0,this._presenceProvider.start(e).then(function(){return this._startPresenceSubscriptions()}.bind(this)).then(function(){this._onServiceAvailable(),i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Service started successfully")}.bind(this),function(e){this._starting=!1,i.Base.Logger.error(i.Base.LoggerTags.PRESENCE_SERVICE,"Failed to start service",e)}.bind(this)),this._startDfd.promise()},stop:function(){i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Stopping the service"),this._unsubscribeFromProvidersNotifications(),this._onServiceUnavailable();var t=S.Deferred();return this._presenceSubscriptions._stop().always(function(){this._presenceProvider.stop().then(function(){i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Service stopped successfully"),t.resolve()},function(e){i.Base.Logger.error(i.Base.LoggerTags.PRESENCE_SERVICE,"Failed to stop service",e),t.reject(e)}).always(function(){this._onSelfPresenceReceivedCallbacks.empty(),this._onPresenceServiceAvailableCallbacks.empty(),this._onPresenceServiceUnavailableCallbacks.empty(),this._presenceSubscriptions._removeOnSelfPresenceReceivedCallback(this._onSelfPresenceNotification),this._started=!1}.bind(this))}.bind(this)),t.promise()},_stopImmediately:function(){return i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Stopping the service"),this._started=!1,this._onServiceUnavailable(),i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Service stopped successfully"),S.Deferred().resolve().promise()},_setSelfPresence:function(e,t,i){this._selfPresenceManagedExternally=!0,this._selfPresence=e,this._selfAddress=t,this._phoneAndVideoChannelAddress=i},_onServiceAvailable:function(){var e;this._available||(e=function(){this._starting=!1,this._started=!0,this._available=!0,i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Service is available"),this._startDfd.state()===i.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onPresenceServiceAvailableCallbacks.fire(this)}.bind(this),this._starting?e():this._startPresenceSubscriptions().then(function(){e()}.bind(this)))},_onServiceUnavailable:function(){(this._available||this._starting)&&(this._available=!1,i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Service is unavailable"),this._starting&&(this._starting=!1),this._startDfd.state()===i.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onPresenceServiceUnavailableCallbacks.fire(this))},_setPhoneVideoAdress:function(e){this._phoneAndVideoChannelAddress=e},_startPresenceSubscriptions:function(){return this._selfPresenceManagedExternally||(this._phoneAndVideoChannelAddress||(this._phoneAndVideoChannelAddress=this.userConfiguration.sgConfiguration.credentialProvider.username),this._selfAddress=this._phoneAndVideoChannelAddress),this._presenceSubscriptions._addOnSelfPresenceReceivedCallback(this._onSelfPresenceNotification),this._presenceSubscriptions._setSelfAddress(this._selfAddress),this._presenceSubscriptions._start().then(function(){i.Base.Logger.info(i.Base.LoggerTags.PRESENCE_SERVICE,"Presence subscriptions started successfully")}.bind(this),function(e){i.Base.Logger.error(i.Base.LoggerTags.PRESENCE_SERVICE,"Failed to start presence subscriptions",e)}.bind(this))},_subscribeForProvidersNotifications:function(){this._started||this._starting||(this._onNetworkAvailable=this._onServiceAvailable.bind(this),this._onNetworkUnavailable=this._onServiceUnavailable.bind(this),this._onPresenceHandleReceived=this._setPhoneVideoAdress.bind(this),this._presenceProvider.on(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._presenceProvider.on(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._presenceProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._presenceProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._presenceProvider.on(i.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,this._onPresenceHandleReceived))},_unsubscribeFromProvidersNotifications:function(){this._started&&(this._presenceProvider.off(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._presenceProvider.off(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._presenceProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._presenceProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._presenceProvider.on(i.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,this._onPresenceHandleReceived),this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._onPresenceHandleReceived=T)}},i.Base.AOPTools.addAdvices(e,"PresenceService",["publishAutomaticPresence","publishManualState","publishLocationMode","publishNote"],[i.Base.AOPCommonAdvices.LOG_PRESENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_PRESENCE_ERROR]),i.Services.Presence.PresenceService=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Presence.PresenceService.prototype,{addOnSelfPresenceReceivedCallback:function(e){this._onSelfPresenceReceivedCallbacks.add(e)},removeOnSelfPresenceReceivedCallback:function(e){this._onSelfPresenceReceivedCallbacks.remove(e)},addOnPresenceServiceAvailableCallback:function(e){this._onPresenceServiceAvailableCallbacks.add(e)},removeOnPresenceServiceAvailableCallback:function(e){this._onPresenceServiceAvailableCallbacks.remove(e)},addOnPresenceServiceUnavailableCallback:function(e){this._onPresenceServiceUnavailableCallbacks.add(e)},removeOnPresenceServiceUnavailableCallback:function(e){this._onPresenceServiceUnavailableCallbacks.remove(e)}})}(AvayaClientServices),function(n){"use strict";function e(e){n.Base.WebSocketProvider.apply(this),this._parentLoggerTag=e,this._networkLogger=new n.Base.NetworkLogger(e),this._deferreds={},this._transactionIDLocation=""}(e.prototype=Object.create(n.Base.WebSocketProvider.prototype)).start=function(e,t,i,a,r){return i&&i.transactionIDLocation&&(this._transactionIDLocation=i.transactionIDLocation),n.Base.WebSocketProvider.prototype.start.call(this,e,t,i,a,r,this._handleOnMessage.bind(this))},e.prototype._handleOnMessage=function(t){var e,i,a,r=!0,s=!1;if(t.data instanceof ArrayBuffer==!1)try{e=this.parseResponse(t.data),s=this.checkForPong(e),i=this.getTransactionIDFromResponse(e,this._transactionIDLocation),a=this._deferreds[i]}catch(e){"string"==typeof t.data&&n.Base.Logger.error(n.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,this._parentLoggerTag,e)}else s=this.checkForPong(t.data);i&&a&&(s||this._networkLogger.logRecvMessage(t.data,T),n.Base.Logger.debug(n.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,this._parentLoggerTag,"Resolving message "+e.name+" with transId "+i),delete this._deferreds[i],r=!1,a.resolve(e)),r&&this.onMessage(t)},e.prototype.parseMessage=function(e){return JSON.parse(e)},e.prototype.send=function(e,t,i){var a=S.Deferred(),r=this.getTransactionIDFromRequest(this.parseRequest(e),this._transactionIDLocation);return r&&(this._deferreds[r]=a),n.Base.WebSocketProvider.prototype.send.call(this,e,t,i).then(function(){r||a.resolve()},function(e){a.reject(e)}),a.promise()},e.prototype.close=function(){return this.cleanupTransactions("Request aborted due to close request"),n.Base.WebSocketProvider.prototype.close.call(this)},e.prototype.onClose=function(){return this.cleanupTransactions("Request failed due to network error"),n.Base.WebSocketProvider.prototype.onClose.call(this)},e.prototype.cleanupTransactions=function(e){for(var t in this._deferreds)this._deferreds.hasOwnProperty(t)&&(t=this._deferreds[t],n.Base.Utils.isDefined(t)&&(n.Base.Logger.debug("Rejecting transaction because: "+e),t.reject({message:e})));this._deferreds={}},e.prototype._getTransactionID=function(e,t){return n.Base.Utils.queryJSONObject(e,t)},e.prototype.getTransactionIDFromResponse=function(e,t){return this._getTransactionID(e,t)},e.prototype.getTransactionIDFromRequest=function(e,t){return this._getTransactionID(e,t)},e.prototype.parseRequest=function(e){return this.parseMessage(e)},e.prototype.parseResponse=function(e){return this.parseMessage(e)},e.prototype.registerBlackList=function(e){this._networkLogger.registerBlackList(e)},n.Base.TransactionalWebSocketProvider=e}(AvayaClientServices),function(h){"use strict";var t,e,i,r=[];r.type=new h.Base.Validators.TypeValidator,r.arrayElementType=new h.Base.Validators.ArrayElementTypeValidator,r.defined=new h.Base.Validators.DefinedValidator;var a=window.crypto||window.msCrypto;h.Base.Utils={isUndefined:function(e){return void 0===e},isDefined:function(e){return void 0!==e},isObject:function(e){return null!==e&&"object"==typeof e},validate:function(t,e,i){if(e.optional&&void 0===t)return!1;var a=!0;return e.validators.forEach(function(e){if(h.Base.Utils.isUndefined(r[e.type]))throw new Error("Validator of specified type does not exist.");a=a&&r[e.type].validate(t,e,i)}.bind(this)),a},makeId:function(e,t){e=e||10;for(var i=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",r=0;r<e;r++)a+=i.charAt(Math.floor(Math.random()*i.length));return a},clean:function(e,t){for(var i=0;i<e.length;i++)e[i]===t&&(e.splice(i,1),i--);return e},queryJSONObject:function(e,t){if(null==e)return T;var i=e,a=t.match(/(\w+)/g);if(!a)return T;for(var r=0;r<a.length;r++){var s=i[a[r]];if(!h.Base.Utils.isDefined(s)||null===s)return T;i=s}return i},getBrowserType:function(){return t!==T||(t=h.Base.BrowserType.UNKNOWN,window.chrome&&(-1<document.location.href.indexOf("chrome-extension")||-1===window.navigator.userAgent.indexOf("Edge"))||-1<window.navigator.userAgent.indexOf("Chrome")&&-1<window.navigator.userAgent.indexOf("Electron")||-1<window.navigator.userAgent.indexOf("HeadlessChrome")?t=h.Base.BrowserType.CHROME:window.chrome&&-1<document.location.href.indexOf("moz-extension")||"undefined"!=typeof InstallTrigger?t=h.Base.BrowserType.FIREFOX:-1!==window.navigator.userAgent.indexOf("Safari")&&-1===window.navigator.userAgent.indexOf("Chrome")&&-1===window.navigator.userAgent.indexOf("Edge")?t=h.Base.BrowserType.SAFARI:!(e=!!document.documentMode)&&window.StyleMedia?t=h.Base.BrowserType.EDGE:e&&(t=h.Base.BrowserType.IE)),t;var e},getBrowserSubType:function(){return e!==T||(e=h.Base.BrowserSubType.UNKNOWN,window.chrome&&0<Object.keys(window.chrome).length?-1<document.location.href.indexOf("chrome-extension")?e=h.Base.BrowserSubType.CHROME_EXTENSION:-1<document.location.href.indexOf("moz-extension")&&(e=h.Base.BrowserSubType.FIREFOX_EXTENSION):-1<window.navigator.userAgent.indexOf("Chrome")&&-1<window.navigator.userAgent.indexOf("Electron")&&(e=h.Base.BrowserSubType.ELECTRON)),e},getBrowserName:function(){var e;return i===T&&(e=this.getBrowserType(),i=e[0].toUpperCase()+e.toLowerCase().slice(1)),i},getBrowserTabVisibilityParams:function(){var e,t;return void 0!==document.visibilityState?(e="visibilitychange",t="visibilityState"):void 0!==document.mozVisibilityState?(e="mozvisibilitychange",t="mozVisibilityState"):void 0!==document.msVisibilityState?(e="msvisibilitychange",t="msVisibilityState"):void 0!==document.webkitVisibilityState&&(e="webkitvisibilitychange",t="webkitVisibilityState"),[e,t]},isApplicationTabActive:function(e){return this.isUndefined(e)&&(e=this.getBrowserTabVisibilityParams()[1]),"visible"===document[e]},isWebRTC_SupportedBrowser:function(e){var t=this.getBrowserType();if(this.isDefined(e)&&-1!==e.indexOf(t))return!1;var i=t===h.Base.BrowserType.CHROME||t===h.Base.BrowserType.FIREFOX||t===h.Base.BrowserType.EDGE||t===h.Base.BrowserType.SAFARI,e=[h.Base.BrowserType.EDGE,h.Base.BrowserType.SAFARI];return i=(i=i&&~e.indexOf(t)&&!window.RTCPeerConnection?!1:i)&&t===h.Base.BrowserType.SAFARI?this.isSafariSupported(window.navigator.userAgent):i},isSafariSupported:function(e){e=e.match(/Version\/(\d+)\.\d+/)||e.match(/OS ((\d+_?){2,3})\s/);return!!e&&(-1!==e[1].indexOf("_")&&(e[1]=e[1].split("_").join(".").slice(0,4)),13<=e[1])},removeDuplicatesFromArray:function(e){return Array.isArray(e)?e.filter(function(e,t,i){return i.indexOf(e)===t}):T},parseUrl:function(t){if(t){var i;[/^(?:([^:/?#]+):)?\/\/(([^:\/?#]+\:\w*\@)??([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(?:\?)?([^#]*|)(?:#)?(.*|)$/,/^(?:([^:/?#]+):)?\/\/(([^:\/?#]+\:\w*\@)??([^:\/?#]*)(?:\:([0-9]+))?)$/].some(function(e){return i=t.match(e)});var e,a=i[4];return i[5]&&(a+=":"+i[5]),i[3]&&(e=i[3].slice(0,-1)),{url:i[0],protocol:i[1],host:a,credentials:e,hostname:i[4],port:parseInt(i[5]),path:i[6],query:i[7],hash:i[8],isSecure:!!i[1]&&("https"===i[1]||"wss"===i[1])}}return T},getHost:function(e){var t=e.port===T||isNaN(e.port)?e.isSecure?"443":"80":e.port;return e.hostname+":"+t},callFunction:function(t,i,a,r,s){var n=S.Deferred(),o=0;s=s||1e3;var c=function(e){setTimeout(function(){i.apply(t,a).then(function(e){n.resolve(e)},function(e){o++,r&&r<o?n.reject(e):c(s)})},e)};return c(0),n.promise()},connectionBackoffAlgorithm:function(i,a,e,t,r){var s,n=t||2,o=S.Deferred(),c=0,r=h.Base.Utils.isDefined(r)?r:-1,l=e||15e3,d=!1,e={dfdPromise:o.promise(),cancel:function(){d=!0,h.Base.Utils.isDefined(s)&&clearTimeout(s),h.Base.Utils.isDefined(o)&&o.state()===h.Base.DeferredStates.PENDING&&o.reject(h.Base.ErrorReasons.BACKOFF_ALGORITHM_CANCELLED)}},C=function(e,t){var i;e<0?u(e,t):(i=l*Math.pow(n,e),c=12e4<i?12e4:Math.min(12e4,(Math.random()*(1-.8)+.8)*i),h.Base.Logger.debug(h.Base.LoggerTags.UTILS,"BackoffAlgorithm, ConsecutiveFailures: "+e+" Timeout: "+c+"msec"),a&&a(e),s=setTimeout(function(){u(e,t)},c))};function u(t,e){d||i(t,e).then(function(e){o.resolve(e)},function(e){e&&e.message===h.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED?o.reject(e):C(++t,e)})}return C(r),e},colorIntToHex:function(e){e=parseInt(e).toString(16);return(e="#000000".substr(0,7-e.length)+e).toUpperCase()},concatArrayBuffers:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer},readAsByteArray:function(e){var t=S.Deferred(),i=new FileReader;return i.onload=function(){var e=new Uint8Array(i.result);t.resolve(e)},i.readAsArrayBuffer(e),t},getSingleByteArrayFromString:function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t},stringToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),a=0,r=e.length;a<r;a++)i[a]=e.charCodeAt(a);return t},getVideoOptions:function(e,t){var i,a,r=!1;if(h.Base.Utils.isDefined(e))for(var s=0;s<e.length;s++)e[s]._getInternalRequestedDirection()!==h.Services.Call.MediaDirection.INACTIVE&&(r=!0,i=e[s].getChannelId(),t&&(a=t.getDeviceId()));return{enable:r,videoChannelId:i,videoDeviceId:a}},getBytesCount:function(e){for(var t,i=0,a=0;a<e.length;a++){try{t=function(e,t){t=t||0;var i,a=e.charCodeAt(t);if(55296<=a&&a<=56319){if(i=a,t=e.charCodeAt(t+1),isNaN(t))throw"High surrogate not followed by low surrogate in fixedCharCodeAt()";return 1024*(i-55296)+(t-56320)+65536}return!(56320<=a&&a<=57343)&&a}(e,a)}catch(e){return 0}!1!==t&&(t<=127?i++:i+=t<=2047?2:t<=65535?3:t<=2097151?4:t<=67108863?5:6)}return i},isInteger:function(e){return(0^e)===e},generateUUID:void 0!==a&&void 0!==a.getRandomValues?function(){var e=new Uint16Array(8);a.getRandomValues(e);function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}return t(e[0])+t(e[1])+"-"+t(e[2])+"-"+t(e[3])+"-"+t(e[4])+"-"+t(e[5])+t(e[6])+t(e[7])}:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},deepMerge:function(t,i){if(h.Base.Utils.isUndefined(t)&&h.Base.Utils.isDefined(i))return i;for(var a in i)try{i[a].constructor===Object?t[a]=h.Base.Utils.deepMerge(t[a],i[a]):t[a]=i[a]}catch(e){t[a]=i[a]}return t},rejectIfPromiseNotResolvedInTime:function(e,t,i,a){var r=S.Deferred(),s=setTimeout(function(){r.state()===h.Base.DeferredStates.PENDING&&(h.Base.Logger.warn(h.Base.LoggerTags.UTILS,"cancelIfPromiseNotResolvedInTime - Promise was not resolved in time"),r.reject(i),a&&a())},t);return e.then(function(e){r.state()===h.Base.DeferredStates.PENDING&&(r.resolve(e),clearInterval(s))},function(e){r.state()===h.Base.DeferredStates.PENDING&&(r.reject(e),clearInterval(s))},function(e){r.state()===h.Base.DeferredStates.PENDING&&r.notify(e)}),r.promise()},waitForAllPromisesCompletion:function(e){for(var t,i=S.Deferred(),a=0,r=function(){},s=function(e){return t=t||e,S.Deferred().reject(e).promise()},n=function(e){i.notify(e)},o=function(){++a===e.length&&(t?i.reject(t):i.resolve())},c=0;c<e.length;c++)e[c].then(r,s,n).always(o);return i.promise()},isNotEmptyString:function(e){return!(!e||!e.trim())},isBool:function(e){return typeof e==typeof!0},includes:function(e,t){return Array.prototype.includes?t.includes(e):-1!==t.indexOf(e)},hasProperty:function(e,t){return e instanceof HTMLElement==!0?t in e:t in document.createElement(e)},forEach:function(e,t,i){if(h.Base.Utils.isDefined(e.forEach))e.forEach(function(e){t.call(i,e)});else for(var a in e)e.hasOwnProperty(a)&&(a=e[a],t.call(i,a))},addToQueryString:function(e,t){return this.isUndefined(t)?e:~e.indexOf("?")?e+"&"+S.param(t):e+"?"+S.param(t)},normalizeAddress:function(e){e=e.trim();return!1===/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(e)&&!0===/^(\+?)([0-9\s\.\-\(\)\*\#\,\;]+)$/.test(e)?e.replace(/[\s\-\.\(\)]/g,""):e},cutNumberFromString:function(e){return e.match(/\d+/g).toString()},toNumber:function(e){return parseInt(e,10)},getAverageValueFromArray:function(e){for(var t=0,i=0;i<e.length;i++)"string"==typeof e[i]&&(e[i]=this.toNumber(this.cutNumberFromString(e[i]))),t+=e[i];return t/e.length},getLowerResolution:function(e,t){return e.length===t.length?e<t==!0?e:t:e.length<t.length==!0?e:t}},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(t){var i=this;return function(){var e=Array.prototype.slice.call(arguments);return i.apply(t||null,e)}}),void 0===FileReader.prototype.readAsBinaryString&&(FileReader.prototype.readAsBinaryString=function(e){var r="",s=this,n=new FileReader;n.onload=function(e){for(var t=new Uint8Array(n.result),i=t.byteLength,a=0;a<i;a++)r+=String.fromCharCode(t[a]);s.content=r,S(s).trigger("onload")},n.readAsArrayBuffer(e)})}(AvayaClientServices),function(s){"use strict";function e(e,t,i,a){s.Base.Observable.call(this),this._requestBuilder=e,this._restProvider=t,this._restProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._notificationProvider=i,this._notificationProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._started=!1,this._acsAvailable=!1,this._acsConfig={},this._acsResources={},this._acsNotificationResources={},this._maxConnectionErrorCount=5,this._notificationsConfiguration=T,this._notificationPromises={},this._notificationHandlers={},this._eTag=null,this._refreshRestSessionIntervalId=T,this._refreshNotificationSessionIntervalId=T,this._startPromise=S.Deferred(),this._stopPromise=S.Deferred(),this._subscriptions={},this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var e=s.Base.Utils.makeId(32,"0123456789abcdef"),e={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=e,version:"1"}};return JSON.stringify(e)}.bind(this),wsIsPongMessage:function(e){e="string"==typeof e?JSON.parse(e):e;return s.Base.Utils.isDefined(e.pong)&&this._failoverPingData.wsPingMessageRequestId===e.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._blackList=[],this._discoveryBackoffDataObject=T,this._contactsAnalyticsService=a,this._invalidateBackoffDataObject=T,this._maxSearchResultsTotal=T,this._discoveryCounter=0,this._supportCSRF=!0,this._supportV7=!0,this._resourceDiscoveryRetryInterval=250}(e.prototype=S.extend({},s.Base.Observable.prototype)).start=function(e,t){return!1===this._started&&(this._started=!0,this._startPromise=S.Deferred(),this._acsConfig=e,this._restProvider.onMessage=function(e,t){this._setAcsAvailable(!0),void 0===t||null!=(t=t.getResponseHeader("ETag"))&&(this._eTag=t)}.bind(this),this._restProvider.onError=function(){this._setAcsAvailable(!1),t._fireContactsUnavailableCallback(t)}.bind(this),this._restProvider.on(s.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(s.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._restProvider.on(s.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._notificationProvider.on(s.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(s.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._restProvider.registerBlackList(this._blackList),this._notificationProvider.registerBlackList(this._blackList),this._restProvider.start(this._acsConfig.networkProviderConfiguration,this._acsConfig.credentialProvider),this.discoverResources().then(function(){this.createNotificationsConfig(),this.startNotificationProvider(t).then(function(){this._startRefreshingRestSession(),this._startRefreshingNotificationSession(),this._startPromise.resolve()}.bind(this),function(e){s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to start notification provider",e),this._started=!1,this._startPromise.reject(e)}.bind(this))}.bind(this))),this._startPromise.promise()},e.prototype.registerBlackList=function(e){this._blackList=e},e.prototype.stop=function(){if(!0===this._started){this._started=!1,this._stopPromise=S.Deferred(),s.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=T),s.Base.Utils.isDefined(this._invalidateBackoffDataObject)&&(this._invalidateBackoffDataObject.cancel(),this._invalidateBackoffDataObject=T),this._restProvider.onClose=function(){this._setAcsAvailable(!1),this._stopRefreshingRestSession(),this._stopRefreshingNotificationSession(),this._acsResources={},this._eTag=null,this._stopPromise.resolve()}.bind(this),this._notificationProvider.onClose=function(){this._notificationPromises={},this._notificationHandlers={};try{this._restProvider.close()}catch(e){this._stopPromise.reject(e)}}.bind(this);try{this._notificationProvider.close()}catch(e){this._stopPromise.reject(e)}}return this._stopPromise.promise()},e.prototype.stopIfNoSubscriptions=function(){return Object.keys(this._subscriptions).length?S.Deferred().resolve().promise():this.stop()},e.prototype._startRefreshingRestSession=function(){this._refreshRestSessionIntervalId===T?this._refreshRestSessionIntervalId=setInterval(function(){this.sendRefreshRestSession().then(function(){s.Base.Logger.info(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Successfully refreshed auth session")},function(e){s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to refresh auth session",e)})}.bind(this),1e3*(this._acsResources.sessionManagement.timeout||900)*.8):s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Auth session refreshing is already active")},e.prototype._stopRefreshingRestSession=function(){this._refreshRestSessionIntervalId!==T?(clearInterval(this._refreshRestSessionIntervalId),this._refreshRestSessionIntervalId=T):s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Auth session refreshing is not active")},e.prototype._startRefreshingNotificationSession=function(){this._refreshNotificationSessionIntervalId===T?this._refreshNotificationSessionIntervalId=setInterval(function(){this.sendRefreshNotificationSession().then(function(){s.Base.Logger.info(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Successfully refreshed notification session")},function(e){s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to refresh notification session",e)})}.bind(this),1e3*(this._notificationResources.sessionManagement.timeout||900)*.8):s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification session refreshing is already active")},e.prototype._stopRefreshingNotificationSession=function(){this._refreshNotificationSessionIntervalId!==T?(clearInterval(this._refreshNotificationSessionIntervalId),this._refreshNotificationSessionIntervalId=T):s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification session refreshing is not active")},e.prototype.discoverResources=function(){var i="",e=function(e,t){this._updateServerSupport(e,t);t=this._requestBuilder.buildResourcesOptions(this._supportCSRF,this._supportV7);return this.send(null,t).then(function(e,t){return i=t.getResponseHeader("Content-Type"),e})}.bind(this);return this._discoveryBackoffDataObject=s.Base.Utils.connectionBackoffAlgorithm(e,T,this._resourceDiscoveryRetryInterval),this._discoveryBackoffDataObject.dfdPromise.then(function(e){this._restProvider.onError=function(){},this._discoveryCounter++,this._resourceDiscoveryRetryInterval=T,this._discoveryBackoffDataObject=T,this._parseResources(e,i)}.bind(this))},e.prototype._updateServerSupport=function(e,t){t&&"function"==typeof t.getReason&&t.getReason()===s.Services.Contacts.ContactsErrorReason.INCOMPATIBLE_SERVER_VERSION?this._supportV7=!1:0===e&&0===this._discoveryCounter&&(this._supportCSRF=!1)},e.prototype.sendInvalidateSession=function(){var e=function(){return this.send(null,this._requestBuilder.buildInvalidateSessionOptions())}.bind(this);return this._invalidateBackoffDataObject=s.Base.Utils.connectionBackoffAlgorithm(e),this._invalidateBackoffDataObject.dfdPromise.then(function(){this._invalidateBackoffDataObject=T}.bind(this))},e.prototype.sendRefreshRestSession=function(){return this.send(null,this._requestBuilder.buildRefreshRestSessionOptions())},e.prototype.sendRefreshNotificationSession=function(){return this.send(null,this._requestBuilder.buildRefreshNotificationSessionOptions())},e.prototype.send=function(e,t){return this._restProvider.send(e,t).catch(function(e){return this._handleError(e)}.bind(this))},e.prototype._handleError=function(e){var t,i=(e=e instanceof s.Base.NetworkError&&e.getData()instanceof s.Base.NetworkErrorEvent?e.getData():e)instanceof s.Base.NetworkErrorEvent?this._handleNetworkErrorEvent(e):e instanceof s.Base.NetworkError?this._handleNetworkError(e):(i=s.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,t="Unknown error: {"+e+"}",this._contactsAnalyticsService.trackContactProvidersUnavailable(i),new s.Services.Contacts.ContactsError(i,t));return s.Base.Logger.warn(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Request failed",t),S.Deferred().reject(i).promise()},e.prototype._handleNetworkErrorEvent=function(e){var t,i,a=e.getStatus();try{var r=JSON.parse(e.getResponseText()).displayMsg}catch(e){s.Base.Logger.debug(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to parse error response")}switch(this._setAcsAvailable(!0),a){case 400:t=s.Services.Contacts.ContactsErrorReason.INVALID_CONTACT,i=r||"Contact is invalid";break;case 401:t=s.Services.Contacts.ContactsErrorReason.AUTHENTICATION_FAILED,i="Authentication failed";break;case 404:t=s.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND,i="Contact was not found";break;case 406:t=s.Services.Contacts.ContactsErrorReason.INCOMPATIBLE_SERVER_VERSION,i="Incompatible server version.  The protocol version used by the client was rejected by the server";break;case 408:case 504:t=s.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT,i="Request to server has timed out",this._contactsAnalyticsService.trackContactProvidersUnavailable(t);break;case 409:t=s.Services.Contacts.ContactsErrorReason.DUPLICATE_CONTACT,i="Contact already exists";break;case 503:t=s.Services.Contacts.ContactsErrorReason.RETRY,i="Server is busy",this._contactsAnalyticsService.trackContactProvidersUnavailable(t);break;case 400001:t=s.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE,i="Connection failed",this._contactsAnalyticsService.trackContactProvidersUnavailable(t);break;default:400<=a&&a<500?(t=s.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,i="Unknown Client Error"):(500<=a&&a<600?(this._setAcsAvailable(!1),t=s.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE,i="Unknown ACS Server Error"):t=s.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,this._contactsAnalyticsService.trackContactProvidersUnavailable(t))}return new s.Services.Contacts.ContactsError(t,i)},e.prototype._handleNetworkError=function(e){var t,e=e.message===s.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED?(t=s.Services.Contacts.ContactsErrorReason.AUTHENTICATION_CANCELLED,s.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED):t=s.Services.Analytics.AnalyticsErrorCode.NETWORK_ERROR;return this._contactsAnalyticsService.trackContactProvidersUnavailable(t),new s.Services.Contacts.ContactsError(t,e)},e.prototype.onCredentialsRequired=function(t,e){e&&e!==this._acsConfig.credentialProvider&&s.Base.Utils.deepMerge(this._acsConfig.credentialProvider,e),this._acsConfig.credentialProvider.onAuthenticationChallenge(void 0,function(e){this.onCredentialsRetrieved(e,t)}.bind(this))},e.prototype.onCredentialsRetrieved=function(e,t){s.Base.Utils.isDefined(t.options)&&(t.options.headers=t.options.headers||{},!e.token||e.bearer&&e.bearer!==s.Config.Authentication.TokenType.UPTOKEN?e.token&&e.bearer?(t.options.wsSecureProtocolData=[],t.options.headers.Authorization=s.Config.Authentication.Header.bearer(e.bearer,e.token)):t.options.headers.Authorization=s.Config.Authentication.Header.basic(e.username,e.password):(t.options.wsSecureProtocolData=[s.Config.Authentication.TokenType.UPTOKEN,e.token],t.options.headers.Authorization=s.Config.Authentication.Header.bearer(s.Config.Authentication.TokenType.UPTOKEN,e.token)))},e.prototype._parseResources=function(e,t){var i;switch(t){case this._requestBuilder._contentTypes.resourcesV2:case this._requestBuilder._contentTypes.resourcesV7:i=new s.Providers.ACS.ResourcesV2;break;case this._requestBuilder._contentTypes.resourcesV1:i=new s.Providers.ACS.ResourcesV1;break;default:s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Unknown version of AADS was discovered. Returned Content-Type:",t),i=new s.Providers.ACS.ResourcesV2}this._acsResources=S.extend({},i,e),this._requestBuilder.setResources(this._acsResources),this._maxSearchResultsTotal=this._acsResources.resources.contacts&&this._acsResources.resources.contacts.GET.getContacts&&this._acsResources.resources.contacts.GET.getContacts.limits&&this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal?this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal:T},e.prototype.createNotificationsConfig=function(){var e=s.Base.Utils.parseUrl(this._acsResources.resources.notification.websocket.href),t=new s.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path),i=s.Base.Utils.parseUrl(this._acsResources.resources.notification.sse.href),e=new s.Config.ServerInfo(i.hostname,i.port,i.isSecure,i.path),i=new s.Config.ServerInfo;this._notificationsConfiguration=new s.Config.NetworkProviderConfiguration(i,t,e,this._maxConnectionErrorCount)},e.prototype.getETag=function(){return this._eTag},e.prototype.getResources=function(){return this._acsResources},e.prototype.startNotificationProvider=function(t){var i=S.Deferred();if(this._notificationProvider.isOpened())return i.resolve().promise();if(!this._notificationsConfiguration)return s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notifications provider configuration is absent"),this._contactsAnalyticsService.trackContactProvidersUnavailable(s.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR),i.reject(new s.Services.Contacts.ContactsError(s.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)).promise();this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){s.Base.Logger.debug(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notifications provider has been started"),this._notificationProvider.onMessage=function(e){e=e.data&&e.type!==s.Base.ProvidersEventTypes.PING?JSON.parse(e.data):e;e.notification?this._onNotification(e.notification):e.discovery?(this._onNotificationDiscovery(e.discovery),this._setAcsAvailable(!0),this.trigger(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE),i.resolve(),t._fireContactsAvailableCallback(t)):e.subscribed&&this._onSubscribed(e.subscribed)}.bind(this)}.bind(this),this._notificationProvider.onError=function(e){s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification provider connection failed",e),this._setAcsAvailable(!1),this.trigger(s.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE),i.reject(new s.Base.NetworkError(s.Base.ErrorReasons.NETWORK_ERROR)),t._fireContactsUnavailableCallback(t)}.bind(this);var e=function(){var e=S.Deferred();return this._setAcsAvailable(!1),t._fireContactsUnavailableCallback(t),this._stopRefreshingRestSession(),this._stopRefreshingNotificationSession(),this.discoverResources().then(function(){this.createNotificationsConfig(),this.startNotificationProvider(t).then(function(){e.resolve(),this._startPromise.resolve(),this._startRefreshingRestSession(),this._startRefreshingNotificationSession(),this._resubscribeNotifications()}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()}.bind(this)),e.promise()}.bind(this);return this._notificationProvider.start(this._notificationsConfiguration,this._acsConfig.credentialProvider,T,T,e,this._failoverPingData).then(function(){return s.Base.Utils.rejectIfPromiseNotResolvedInTime(i.promise(),3e4,new s.Services.Contacts.ContactsError(s.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT),function(){s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification discovery was not received in time"),t._fireContactsUnavailableCallback(t)})},function(){this._contactsAnalyticsService.trackContactProvidersUnavailable(s.Services.Contacts.ContactsErrorReason.CONTACTS_NOTIFICATIONS_CHANNEL_FAILED),s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Start notification channel failed.")}.bind(this)),i.promise()},e.prototype._onNotificationDiscovery=function(e){this._notificationResources=S.extend({},new s.Providers.ACS.NotificationResourcesV1,e),this._requestBuilder.setNotificationResources(this._notificationResources),this._notificationResources.commandURL&&(e=s.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfiguration.restConfig.hostName=e.hostname,this._notificationsConfiguration.restConfig.port=e.port,this._notificationsConfiguration.restConfig.isSecure=e.isSecure,this._notificationsConfiguration.restConfig.path=e.path)},e.prototype._resubscribeNotifications=function(){this._subscriptions[s.Providers.ACS.ACSConstants.SVC_GET_CONTACTS]&&this.sendNotification(JSON.stringify(this._subscriptions[s.Providers.ACS.ACSConstants.SVC_GET_CONTACTS]),this._requestBuilder.buildNotificationsOptions()),this._subscriptions[s.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS]&&this.sendNotification(JSON.stringify(this._subscriptions[s.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS]),this._requestBuilder.buildNotificationsOptions())},e.prototype._onSubscribed=function(e){var t;e.requestId&&e.results&&((t=this._notificationPromises[e.requestId])&&("acs"===s.Base.Utils.queryJSONObject(e,"results.successful[0].application")?(t.resolve(),s.Base.Logger.debug(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Subscribed to "+s.Base.Utils.queryJSONObject(e,"results.successful[0].resource"))):"acs"===s.Base.Utils.queryJSONObject(e,"results.failed[0].application")&&(e=s.Base.Utils.queryJSONObject(e,"results.failed[0].error.description"),s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for notifications",e),this._contactsAnalyticsService.trackContactProvidersUnavailable(s.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE),t.reject(new s.Services.Contacts.ContactsError(s.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE)))))},e.prototype._onNotification=function(e){var t;"acs"!==e.application||!e.resource||(t=this._notificationHandlers[e.resource])&&t(e.contents)},e.prototype.subscribeForNotifications=function(e,t){var i=S.Deferred(),a=i.promise();return a.then(function(){this._notificationHandlers[e.subscribe.resources[0].resource]=t,this._subscriptions[e.subscribe.resources[0].service]=e}.bind(this)),this._notificationPromises[e.subscribe.requestId]=i,this.sendNotification(JSON.stringify(e),this._requestBuilder.buildNotificationsOptions()),s.Base.Utils.rejectIfPromiseNotResolvedInTime(a,3e4,new s.Services.Contacts.ContactsError(s.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT),function(){s.Base.Logger.error(s.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Subscription confirmation was not received in time",e.subscribe.resources[0].resource)})},e.prototype.unsubscribeFromNotifications=function(e){return this.sendNotification(JSON.stringify(e),this._requestBuilder.buildNotificationsOptions()).always(function(){delete this._notificationHandlers[e.unsubscribe.resources[0].resource],delete this._subscriptions[e.unsubscribe.resources[0].service]}.bind(this))},e.prototype.sendNotification=function(e,t){return this._notificationProvider.isOpened()?this._notificationProvider.send(e,t).then(function(e){return e},function(e){return this._handleError(e)}.bind(this)):S.Deferred().reject(new s.Services.Contacts.ContactsError(s.Services.Contacts.ContactsErrorReason.CONTACTS_NOTIFICATIONS_CHANNEL_FAILED)).promise()},e.prototype.isAcsAvailable=function(){return this._acsAvailable},e.prototype.isStarted=function(){return this._started},e.prototype.getMaxSearchResultsTotal=function(){return this._maxSearchResultsTotal},e.prototype._setAcsAvailable=function(e){this._acsAvailable!==e&&(this._acsAvailable=e,this.trigger("acs_availability_changed"))},s.Providers.ACS.ACSNetworkProvider=e}(AvayaClientServices),function(d){"use strict";var a="attachment",r="inline",s="\r\n";function e(e,t){d.Providers.Interfaces.MessagingProvider.call(this),this._eTag="",this._conversationsLastModified=T,this._isStarted=!1,this._networkProvider=e,this._resources={},this._credentials=T,this._config={},this._ammMessagesParser=t,this._resourcesTypes={conversation:"application/vnd.avaya.aem.conversation.v1+json",conversationAccessTime:"application/vnd.avaya.aem.conversation.access.time.v1+json",conversationFlags:"application/vnd.avaya.aem.conversation.flags.v1+json",conversationIds:"application/vnd.avaya.aem.conversations.ids.v1+json",conversations:"application/vnd.avaya.aem.conversations.v1+json",entity:"application/vnd.avaya.aem.entity.v1+json",error:"application/vnd.avaya.aem.error.v1+json",event:"application/vnd.avaya.aem.event.v1+json",message:"application/vnd.avaya.aem.message.v1+json",messageFlags:"application/vnd.avaya.aem.message.flags.v1+json",messageIds:"application/vnd.avaya.aem.messageIds.v1+json",participants:"application/vnd.avaya.aem.participants.v1+json",resources:"application/vnd.avaya.aem.resources.v1+json",validatedAddresses:"application/vnd.avaya.aem.validatedAddresses.v2+json"},this._endpoints={conversations:"",validateAddresses:"",messages:"",outbox:"",markAsReadIf:"",markAsReadBatch:"",addresses:""},this._latestMessagesInConversations={},this._conversationsWithMissingMessages=[],this._needToGetMissingMessages=!1}(e.prototype=Object.create(d.Providers.Interfaces.MessagingProvider.prototype)).onCredentialsRequired=function(t,e){e&&e!==this._config.credentialProvider&&d.Base.Utils.deepMerge(this._config.credentialProvider,e),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(e){this.onCredentialsRetrieved(e,t)}.bind(this))},e.prototype.onCredentialsRetrieved=function(e,t){this._credentials=e,t.options!==T&&(t.options.headers=t.options.headers||{},e.token?(e.bearer=e.bearer||d.Config.Authentication.TokenType.BEARER,t.options.headers.Authorization=d.Config.Authentication.Header.bearer(e.token,e.bearer)):t.options.headers.Authorization=d.Config.Authentication.Header.basic(e.username,e.password))},e.prototype.start=function(e){this._config=e,this._isStarted=!0},e.prototype.getConversations=function(e){e=this._buildGetConversationsRequestOptions(e);return this._networkProvider.send(null,e).then(this._onGetConversationsRequestSent.bind(this),this._handleError.bind(this))},e.prototype._buildGetConversationsRequestOptions=function(e){var t=[this._resourcesTypes.conversations,this._resourcesTypes.error].join(", ");return d.Base.Utils.deepMerge(e,{url:this._endpoints.conversations,sendType:"GET",dataType:"JSON",headers:{Accept:t}})},e.prototype._onGetConversationsRequestSent=function(e){e=this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,e);return this._updateLatestMessagesInConversations(e.conversations),e},e.prototype.getConversationIds=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.getConversationsByQuery=function(e,t,i){i=this._buildGetConversationsRequestOptions(i),i=t?this._getConversationsByIds(t,i):this._getConversationsByQuery(e,i);return i.then(function(e){this._needToGetMissingMessages?(this._updateConversationsWithMissingMessages(e),this._loadMissingMsgs.apply(this,arguments)):this._updateLatestMessagesInConversations(e.conversations)}.bind(this)),i},e.prototype._getConversationsByIds=function(e,t){return t.url+="?"+e.map(function(e){return"id="+e}).join("&"),this._networkProvider.send(null,t).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},e.prototype._getConversationsByQuery=function(e,t){return this._networkProvider.send(e,t).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},e.prototype._onGetConversationsByQueryRequestSent=function(e){return this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,e)},e.prototype.parseResources=function(e){this._resources=e,this._config.endpoints={}},e.prototype.discoverResources=function(e){var t={urlSuffix:"/aem/resources",sendType:"GET",dataType:"JSON"};return t.headers={Accept:[this._resourcesTypes.resources,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,t).then(function(e){e=this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.DISCOVERY,e);return this.parseResources(e),this._resources}.bind(this),this._handleError.bind(this))},e.prototype.getResources=function(){return this._resources},e.prototype.validateUsers=function(e){var t=e.map(function(e){return"address="+e}).join("&"),e=this._buildValidateUsersRequestOptions();return e.url=e.url+"?"+t,this._networkProvider.send(null,e).then(this._onValidateUsersRequestSent.bind(this),this._handleError.bind(this))},e.prototype._buildValidateUsersRequestOptions=function(){var e=[this._resourcesTypes.validatedAddresses,this._resourcesTypes.error].join(", ");return{url:this._endpoints.validateAddresses,sendType:"GET",dataType:"JSON",headers:{Accept:e}}},e.prototype._onValidateUsersRequestSent=function(e){return this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,e)},e.prototype.getRoutableDomains=function(){return this._resources.domains},e.prototype.getSelfAddress=function(){return this._resources.self},e.prototype.getParticipants=function(e,t){t=t||{};return t.url=this._endpoints.conversations+"/"+e+"/participants",t.sendType="GET",t.dataType="JSON",t.headers={Accept:[this._resourcesTypes.participants,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,t).catch(this._handleError.bind(this))},e.prototype.setLastAccessTime=function(e,t){t=t||{};return t.url=this._endpoints.conversations+"/"+e,t.sendType="POST",t.headers={"Content-Type":[this._resourcesTypes.conversationAccessTime].join(", "),Accept:[this._resourcesTypes.conversationAccessTime,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,t).catch(this._handleError.bind(this))},e.prototype.sendMessage=function(e,t){t=t||{};return t.url=this._endpoints.outbox,t.dataType=null,t.headers={Accept:[this._resourcesTypes.message,this._resourcesTypes.error].join(", "),"Content-Type":this._resourcesTypes.message},this._networkProvider.send(JSON.stringify(e),t).then(function(e){return this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.SEND,e)}.bind(this),this._handleError.bind(this))},e.prototype._handleError=function(e){e=new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_SERVER_ERROR,e);return S.Deferred().reject(e).promise()},e.prototype.sendMessageWithAttachments=function(t,e,i){var a=i||{};a.url=this._endpoints.outbox,a.dataType=null,a.headers={Accept:[this._resourcesTypes.message,this._resourcesTypes.error].join(", "),"Content-Type":'multipart/related;boundary="boundary"'},a.processData=!1;var r=S.Deferred();return this._createThumbnailsPromises(e).then(function(){return this._createAttachmentsPromises(e)}.bind(this),function(e){return S.Deferred().reject(e).promise()}).then(function(e){this._createBody("boundary",t,e).then(function(e){this._networkProvider.send(e,a).then(function(e){e=this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.SEND,e);r.resolve(e)}.bind(this),function(e){this._handleError(e).fail(function(e){r.reject(e)})}.bind(this))}.bind(this))}.bind(this),function(e){e=new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_CREATE_ATTACHMENT_FAILED,e);r.reject(e)}),r.promise()},e.prototype._createThumbnailsPromises=function(e){var t=S.Deferred(),i=[];return e.forEach(function(e){i.push(e.createThumbnail())}),S.when.apply(this,i).then(function(){t.resolve(e)}),t.promise()},e.prototype._createAttachmentsPromises=function(e){var t=S.Deferred(),i=[];return e.forEach(function(e){i.push(this._readAttachment(e)),e.getCreateThumbnailCapability().isAllowed&&i.push(this._readAttachment(e.getThumbnail()))}.bind(this)),S.when.apply(this,i).then(function(){t.resolve(Array.prototype.slice.call(arguments))},t.reject),t.promise()},e.prototype._readAttachment=function(r){var s=S.Deferred(),n=new FileReader;return n.onload=function(e){var t;r.disposition&&(t=-1!==r.disposition.indexOf("inline")?d.Services.Messaging.AttachmentType.THUMBNAIL:d.Services.Messaging.AttachmentType.MAIN);var i={name:r.getName(),mime:r.getMimeType(),type:t,data:"",file:r.file},a="base64,";e&&e.target?t===d.Services.Messaging.AttachmentType.THUMBNAIL&&-1!==e.target.result.indexOf(a)?i.data=atob(e.target.result.slice(e.target.result.indexOf(a)+a.length)):i.data=e.target.result:t===d.Services.Messaging.AttachmentType.THUMBNAIL&&-1!==n.content.indexOf(a)?i.data=atob(n.content.slice(n.content.indexOf(a)+a.length)):i.data=n.content,s.resolve(i)},n.onerror=function(e){s.reject(e)},n.readAsBinaryString(r.file),s.promise()},e.prototype._createBody=function(e,t,i){var a=[this._createMessage(t)];i.map(this._createAttachment).map(function(e){a.push(e)});var r="--"+e+s,i="--"+e+"--"+s,e=a.reduce(function(e,t){return e.concat(r,t)});return e.unshift(r),e.push(i),d.Base.Utils.readAsByteArray(new Blob(e))},e.prototype._createMessage=function(e){return["Content-Type:"+this._resourcesTypes.message+";"+s+s,JSON.stringify(e),s]},e.prototype._createAttachment=function(e){var t=e.type===d.Services.Messaging.AttachmentType.THUMBNAIL?r:a,i=t===a&&e.file!==T?e.file:d.Base.Utils.getSingleByteArrayFromString(e.data);return["Content-Type:"+e.mime+s,"Content-Transfer-Encoding:binary\r\n","Content-Disposition:"+t+'; filename="'+e.name+'"'+s+s,i,s]},e.prototype.leaveConversation=function(e){var t={};return t.url=this._endpoints.conversations+"/"+e,t.sendType="DELETE",t.headers={Accept:[this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,t).catch(this._handleError.bind(this))},e.prototype.markAllAsRead=function(e,t,i){var a={};return a.url=this._endpoints.markAsReadIf,a.url+="?conversationId="+e,void 0!==t&&(a.url+="&hasAttachment="+!!t),i&&(a.url+="&upTo="+i),a.sendType="POST",a.headers={Accept:[this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,a).catch(this._handleError.bind(this))},e.prototype.changeSubject=function(e){var t={};return t.url=this._endpoints.outbox,t.dataType="JSON",t.headers={"Content-Type":this._resourcesTypes.message},this._networkProvider.send(JSON.stringify(e),t).catch(this._handleError.bind(this))},e.prototype.markAsReadBatch=function(e){var t={};if(t.url=this._endpoints.markAsReadBatch,""===t.url)throw new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE);t.sendType="POST",t.headers={Accept:[this._resourcesTypes.error].join(", "),"Content-Type":this._resourcesTypes.messageIds};e=JSON.stringify({messageIds:e});return this._networkProvider.send(e,t).catch(this._handleError.bind(this))},e.prototype.getMessages=function(e,t,i,a,r){a=a?a.id:T,r=r?r.id:T;return this._getMsgs(e,t,i,a,r)},e.prototype.reportTyping=function(){},e.prototype.reportCustomChatNotification=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.observeConversations=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.startNotificationProvider=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.subscribeForTypingEventsInConversation=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.unsubscribeForTypingEventsInConversation=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.callEscalationEvent=function(e,t){var i={};return i.url=this._endpoints.conversations+"/"+t+"/events",i.sendType="POST",i.headers={"Content-Type":this._resourcesTypes.event},this._networkProvider.send(JSON.stringify(e),i).catch(this._handleError.bind(this))},e.prototype.addParticipantsToConversation=function(e,t,i){i=S.extend(i,{headers:{}});return i.url=this._endpoints.conversations+"/"+e+"/participants",i.sendType="POST",i.dataType="JSON",i.headers={"Content-Type":this._resourcesTypes.participants},this._networkProvider.send(JSON.stringify(t),i).then(function(e){return this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,e)}.bind(this),this._handleError.bind(this))},e.prototype.close=function(e){var t={};return t.url=this._endpoints.conversations+"/"+e+"/flags",t.sendType="POST",t.dataType="JSON",t.headers={"Content-Type":this._resourcesTypes.conversationFlags},this._networkProvider.send(JSON.stringify({closed:!0}),t).then(function(e){return this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.CLOSE,e)}.bind(this),this._handleError.bind(this))},e.prototype.stop=function(){this._isStarted=!1,this._eTag="";var t=S.Deferred();return this._networkProvider.onClose=function(){this._resources={},t.resolve()}.bind(this),this._networkProvider.onError=function(e){"abort"===e.statusText?t.resolve():(e=new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_CLOSE_FAILED),t.reject(e))}.bind(this),this._networkProvider.close(),t.promise()},e.prototype.logout=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},e.prototype.isUpdateSubjectSupported=function(){return!1},e.prototype.isMarkAllContentAsReadSupported=function(){return!1},e.prototype.getMaxImageSize=function(){return 0},e.prototype.getMaxVideoSize=function(){return 0},e.prototype.getMaxAudioSize=function(){return 0},e.prototype.getMaxTextLength=function(){return 0},e.prototype.getMaxGenericAttachmentSize=function(){return 0},e.prototype.getConversationResource=function(){return this._resources.conversationsResource.href},e.prototype.getValidateAddressResource=function(){return this._resources.services.validateAddresses},e.prototype.getMarkAsReadResource=function(){return this._resources.services.markAsReadIf},e.prototype.isOpened=function(){return!1},e.prototype.getMaxMessageCount=function(){return 15},e.prototype.isStarted=function(){return this._isStarted},e.prototype._getMsgs=function(e,t,i,a,r){e=S.extend(e,{headers:{}});e.url=this._endpoints.conversations+"/"+t;t="?";return d.Base.Utils.isDefined(i)&&(e.url+=t+"messageCount="+i,t="&"),d.Base.Utils.isDefined(a)&&(e.url+=t+"beforeId="+a,t="&"),d.Base.Utils.isDefined(r)&&(e.url+=t+"afterId="+r),e.sendType="GET",e.dataType="JSON",e.headers={Accept:[this._resourcesTypes.conversation,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,e).then(function(e){e=this._ammMessagesParser.parse(d.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,e);return this._needToGetMissingMessages||this._updateLatestMessagesInConversations([e]),e}.bind(this),this._handleError.bind(this))},e.prototype._loadMissingMsgs=function(e){for(var o={},t={},c=[],i=0;i<e.conversations.length;i++){var a=e.conversations[i],r=a.messages,s={id:r[0].id,receivedDate:r[0].receivedDate};-1!==this._conversationsWithMissingMessages.indexOf(a.id)?(t[a.id]={loadedMsgs:0,messageID:r[r.length-1].id},o[a.id]=s):this._latestMessagesInConversations[a.id]=s}var n,l=function(r,s,n){var e=15<=35-s.loadedMsgs?15:35-s.loadedMsgs;this._getMsgs({},r,e,s.messageID).then(function(e){var t=e.messages;if(this.trigger(d.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[{conversations:[e]}]),s.loadedMsgs+=t.length,35!==s.loadedMsgs){for(var i=!0,a=0;a<t.length;a++)if(t[a].id===this._latestMessagesInConversations[r].id){i=!1;break}i?(s.messageID=t[t.length-1].id,l.call(this,r,s,n)):(this._latestMessagesInConversations[r]=o[r],c[n].resolve())}else this._latestMessagesInConversations[r]=o[r],c[n].resolve()}.bind(this))};for(n in t)t.hasOwnProperty(n)&&(c.push(S.Deferred()),l.call(this,n,t[n],c.length-1));c.length?S.when.apply(this,c).then(function(){this._needToGetMissingMessages=!1}.bind(this)):this._needToGetMissingMessages=!1},e.prototype._updateLatestMessagesInConversations=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];this._latestMessagesInConversations[i.id]=this._getLatestMessageInConversation(i)}else d.Base.Logger.warn(d.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"AbstractAMMProvider.prototype._updateLatestMessagesInConversations: conversations is not defined")},e.prototype._getLatestMessageInConversation=function(e){var t=e.id,i=e.messages,a=i.length?i[0]:null,e=this._latestMessagesInConversations[t],i=e?Date.parse(e.receivedDate):null,t=a?Date.parse(a.receivedDate):null;return a&&(!e||e&&!!(i&&t&&i<t))?{id:a.id,receivedDate:a.receivedDate}:e||null},e.prototype._areMessagesInConversationUpToDate=function(e){var t=e.id;if(this._latestMessagesInConversations[t]){for(var i=e.messages,a=0;a<i.length;a++)if(i[a].id===this._latestMessagesInConversations[t].id)return!0;return!1}return!0},e.prototype._updateConversationsWithMissingMessages=function(e){e=e.conversations;for(var t=this._conversationsWithMissingMessages.length=0;t<e.length;t++){var i=e[t];this._areMessagesInConversationUpToDate(i)||this._conversationsWithMissingMessages.push(i.id)}},e.prototype._getConversationsState=function(){var e=S.Deferred();return e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),e.promise()},d.Providers.AMM.AbstractAMMProvider=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.AMM.AbstractAMMProvider.call(this,e,t),this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resourcesTypes.resources="application/vnd.avaya.aem.resources.v3+json",this._blackListedWords=["subject","message","body","mimeType","size","disposition","mediaUrl","media","givenName","href","nativeGivenName","nativeSurname","surname","address","duration"]}(e.prototype=Object.create(i.Providers.AMM.AbstractAMMProvider.prototype)).start=function(e,t){return this._config=e,this._isStarted=!0,this._networkProvider.onMessage=function(e,t){var i;void 0!==t&&(i=t.getResponseHeader("ETag"),e&&e.conversations&&(e.lastUpdated?this._conversationsLastModified=new Date(new Date(e.lastUpdated).getTime()+1):this._conversationsLastModified=new Date(new Date(t.getResponseHeader("Last-Modified")).getTime()+1)),null!=i&&(this._eTag=i))}.bind(this),this._networkProvider.onError=function(e){return t&&t._fireMessagingUnavailableCallback(i.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR),this._handleError(e)}.bind(this),this._networkProvider.on(i.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(i.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._networkProvider.on(i.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(i.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.start(this._config.networkProviderConfiguration,this._config.credentialProvider)},e.prototype._longPollConversations=function(){if(!S.isEmptyObject(this._resources)){var e=30,e={headers:{"Avaya-Request-Timeout":e=this._resources.avayaRequestTimeout&&this._resources.avayaRequestTimeout.recommended?this._resources.avayaRequestTimeout.recommended:e}};return this.getConversations(e)}},e.prototype.observeConversations=function(){return this._longPollConversations().then(function(e){if(this._isStarted)return e&&e.conversations&&0<e.conversations.length&&this.trigger("conversations.update",[e]),this.observeConversations()}.bind(this))},e.prototype.isUpdateSubjectSupported=function(){return!0},e.prototype.isMarkAllContentAsReadSupported=function(){return!!this._resources&&!!this._resources.services&&!!this._resources.services.markAsReadIf},e.prototype.parseResources=function(e){this._resources=S.extend(new i.Providers.AMM.ResourcesV2,e),this._endpoints.conversations=this._resources.conversationsResource.href,this._endpoints.validateAddresses=this._resources.services.validateAddresses,this._endpoints.messages=this._resources.messages,this._endpoints.outbox=this._resources.outbox,this._endpoints.markAsReadIf=this._resources.services.markAsReadIf,this._endpoints.addresses=this._resources.addresses},e.prototype.getMaxImageSize=function(){return i.Base.Utils.queryJSONObject(this,"_resources.limits.maxImageSize")},e.prototype.getMaxVideoSize=function(){return i.Base.Utils.queryJSONObject(this,"_resources.limits.maxVideoSize")},e.prototype.getMaxAudioSize=function(){return i.Base.Utils.queryJSONObject(this,"_resources.limits.maxAudioSize")},e.prototype.getMaxTextLength=function(){return i.Base.Utils.queryJSONObject(this,"_resources.limits.maxTextLength")},e.prototype.getMaxGenericAttachmentSize=function(){return i.Base.Utils.queryJSONObject(this,"_resources.limits.maxGenericAttachmentSize")},i.Providers.AMM.AMM2_1Provider=e}(AvayaClientServices),function(C){"use strict";function e(e,t,i,a){C.Providers.AMM.AMM2_1Provider.call(this,e,a),this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resources={},this._notificationResources={},this._maxConnectionErrorCount=5,this._notificationsConfiguration={},this._notificationProvider=t,this._notificationProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resourcesTypes.conversation="application/vnd.avaya.aem.conversation.v2+json",this._resourcesTypes.conversationExtensions="application/vnd.avaya.aem.conversation.extensions.v1+json",this._resourcesTypes.conversations="application/vnd.avaya.aem.conversations.v2+json",this._resourcesTypes.message="application/vnd.avaya.aem.message.v2+json",this._resourcesTypes.resources="application/vnd.avaya.aem.resources.v4+json",this._resourcesTypes.subject="application/vnd.avaya.aem.subject.v1+json",this._isListening=!1,this._requests={},this._callbacksForTypingEvents={},this._identity={},this._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._dfdSubscribed={},this._dfdUnsubscribed={},this._dfdConversationsSubscribed={},this._chatStateNotifications=i,this._conversationsSubscribed=!1,this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var e=C.Base.Utils.makeId(32,"0123456789abcdef"),e={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=e,version:"1"}};return JSON.stringify(e)}.bind(this),wsIsPongMessage:function(e){e="string"==typeof e?JSON.parse(e):e;return C.Base.Utils.isDefined(e.pong)&&this._failoverPingData.wsPingMessageRequestId===e.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._discoveryBackoffDataObject=T,this._dfdConversationsResourceState={}}(e.prototype=Object.create(C.Providers.AMM.AMM2_1Provider.prototype)).start=function(e,t){return this._notificationProvider.registerBlackList(this._blackListedWords),C.Providers.AMM.AMM2_1Provider.prototype.start.call(this,e,t)},e.prototype.startNotificationProvider=function(l){var e,d=S.Deferred();return!!this.getResources().notificationService&&(this.getResources().notificationService.websocket.href||this.getResources().notificationService.sse.href)&&!this._notificationProvider.isOpened()?(this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){this._notificationProvider.onMessage=function(e){var t,i,a,r,e=e.data&&e.type!==C.Base.ProvidersEventTypes.PING?JSON.parse(e.data):e;if(e.notification){var s=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.NOTIFICATION,e.notification);switch(s.service){case C.Providers.AMM.MessagesService.CONVERSATION:this._eTag=C.Base.Utils.queryJSONObject(s,"contents.entityTag"),this.getConversationsByQuery({after:this._conversationsLastModified.toISOString()}).then(function(e){e&&e.conversations&&0<e.conversations.length&&this.trigger(C.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[e])}.bind(this));break;case C.Providers.AMM.MessagesService.CHAT_STATE:var n=S.extend(new C.Providers.AMM.NotificationContentsV1,s.contents),o=n.address===this._resources.self,c=s.resource.slice(this._resources.conversationsResource.href.length+1);this._chatStateNotifications.setChatStateNotification(n,o,this._callbacksForTypingEvents[c]),this._callbacksForTypingEvents[c].fire(n);break;default:C.Base.Logger.warn(C.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Unknown notification service value received: {0}",s.service)}}else e.notified?(t=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.NOTIFIED,e.notified),this._handleNotificationResponse(t)):e.discovery?(t=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.DISCOVERY_NOTIFICATION,e.discovery),this._notificationResources=S.extend(new C.Providers.AMM.NotificationResourcesV1,t),this._notificationResources.commandURL&&(t=C.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfiguration.restConfig.hostName=t.hostname,this._notificationsConfiguration.restConfig.port=t.port,this._notificationsConfiguration.restConfig.isSecure=t.isSecure,this._notificationsConfiguration.restConfig.path=t.path),d.resolve(),this.trigger(C.Providers.AMM.ProviderStates.AVAILABLE,[]),l._fireMessagingAvailableCallback()):e.subscribed?(r=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,e.subscribed),i=C.Base.Utils.queryJSONObject(r,"results.successful[0].service"),a=C.Base.Utils.queryJSONObject(r,"results.successful[0].resource"),i===C.Providers.AMM.MessagesService.CHAT_STATE&&this._dfdSubscribed[a]!==T&&this._dfdSubscribed[a].state()===C.Base.DeferredStates.PENDING?this._dfdSubscribed[a].resolve(r):i===C.Providers.AMM.MessagesService.CONVERSATION&&this._dfdConversationsSubscribed!==T&&this._dfdConversationsSubscribed.state()===C.Base.DeferredStates.PENDING&&(this._dfdConversationsSubscribed.resolve(r),this._conversationsSubscribed=!0)):e.unsubscribed?(r=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,e.unsubscribed),i=C.Base.Utils.queryJSONObject(r,"results.successful[0].service"),a=C.Base.Utils.queryJSONObject(r,"results.successful[0].resource"),i===C.Providers.AMM.MessagesService.CHAT_STATE&&this._dfdUnsubscribed[a]!==T&&this._dfdUnsubscribed[a].state()===C.Base.DeferredStates.PENDING&&(this._dfdUnsubscribed[a].resolve(r),this._chatStateNotifications.clearChatStateNotifications())):e.resourceState&&(e=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.RESOURCE_STATE,e.resourceState),i=C.Base.Utils.queryJSONObject(e,"results.successful[0].service"),a=C.Base.Utils.queryJSONObject(e,"results.successful[0].resource"),i===C.Providers.AMM.MessagesService.CONVERSATION&&this._dfdConversationsResourceState!==T&&this._dfdConversationsResourceState.state()===C.Base.DeferredStates.PENDING&&this._dfdConversationsResourceState.resolve(e))}.bind(this)}.bind(this),this._chatStateNotifications.onPauseChatState=function(e,t){return""!==this._chatStateNotifications.getConversationId()?this._reportChatState(e,t,!1):(C.Base.Logger.info("Not pausing chat state because conversation already terminated."),S.Deferred().resolve().promise())}.bind(this),this._notificationProvider.on(C.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(C.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(C.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(C.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),e=function(){var a=S.Deferred();return this._needToGetMissingMessages=!0,this.trigger(C.Providers.AMM.ProviderStates.UNAVAILABLE,[]),l._fireMessagingUnavailableCallback(C.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR),this._discoverResources(l).then(function(){return this.startNotificationProvider(l).then(function(){if(this._conversationsSubscribed)return this.observeConversations().then(function(){return this._getConversationsState().then(function(e){var t=e.results.successful[0].state.entityTag,i=function(){a.resolve(),this._resubscribeForTypingEvents()}.bind(this);t!==this._eTag?this.getConversationsByQuery().then(function(e){e&&e.conversations&&0<e.conversations.length&&this.trigger(C.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[e]),this._eTag=t,i()}.bind(this)):i()}.bind(this))}.bind(this));a.resolve()}.bind(this),function(){a.reject()}.bind(this))}.bind(this)),a.promise()}.bind(this),this._notificationProvider.start(this._notificationsConfiguration,this._config.credentialProvider,T,T,e,this._failoverPingData).fail(function(){C.Base.Logger.error(C.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Start notification channel failed."),d.reject(new C.Services.Messaging.MessagingError(C.Services.Messaging.MessagingErrorReason.MESSAGING_NOTIFICATION_FAILED))})):d.reject(new C.Services.Messaging.MessagingError(C.Services.Messaging.MessagingErrorReason.MESSAGING_NOTIFICATIONS_CHANNEL_FAILED)),C.Base.Utils.rejectIfPromiseNotResolvedInTime(d.promise(),3e4,new C.Services.Messaging.MessagingError(C.Services.Messaging.MessagingErrorReason.MESSAGING_TIMEOUT),function(){C.Base.Logger.error(C.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Notification discovery was not received in time"),l._fireMessagingUnavailableCallback(C.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR)})},e.prototype.stop=function(){var t=S.Deferred();return C.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=T),C.Providers.AMM.AMM2_1Provider.prototype.stop.call(this).then(function(){this._notificationProvider.onClose=function(){this._conversationsLastModified=T,this._isListening=!1,t.resolve()}.bind(this);try{this._notificationProvider.close()}catch(e){t.reject(new C.Services.Messaging.MessagingError(C.Services.Messaging.MessagingErrorReason.MESSAGING_CLOSE_FAILED))}}.bind(this),t.reject),t.promise()},e.prototype.logout=function(){if(this._resources.sessionManagement){var e={};return e.url=this._resources.sessionManagement.href,e.sendType="DELETE",e.headers={Accept:this._resourcesTypes.error},this._networkProvider.send(null,e)}return S.Deferred().resolve().promise()},e.prototype.discoverResources=function(i){return this._discoverResources(i).then(function(e){var t=e.sessionManagement.username;return this._credentials.username!==t?(C.Base.Logger.warn(C.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Deleting session due to mismatch username"),this.logout().then(function(){return this.discoverResources(i)}.bind(this))):e}.bind(this))},e.prototype._discoverResources=function(t){var e=function(){var e={urlSuffix:"/aem/resources",sendType:"GET",dataType:"JSON",crossDomain:!0};return e.headers={Accept:[this._resourcesTypes.resources,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,e)}.bind(this);return this._discoveryBackoffDataObject=C.Base.Utils.connectionBackoffAlgorithm(e),this._discoveryBackoffDataObject.dfdPromise.then(function(e){e=this._ammMessagesParser.parse(C.Providers.AMM.AMMResponsesTypes.DISCOVERY,e);return this._discoveryBackoffDataObject=T,this.parseResources(e)}.bind(this),function(e){return this.trigger(C.Providers.AMM.ProviderStates.UNAVAILABLE,[]),t._fireMessagingUnavailableCallback(C.Services.Analytics.AnalyticsErrorCode.CONNECTION_BACKOFF_ALGORITHM_ERROR),this._handleError(e)}.bind(this))},e.prototype.parseResources=function(e){this._resources=S.extend(new C.Providers.AMM.ResourcesV4,e),this._endpoints.conversations=this._resources.conversationsResource.href,this._endpoints.validateAddresses=this._resources.services.validateAddresses.href,this._endpoints.messages=this._resources.messages.href,this._endpoints.outbox=this._resources.outbox.href,this._endpoints.markAsReadIf=this._resources.services.markAsReadIf.href,this._endpoints.markAsReadBatch=this._resources.services.markAsReadBatch.href;var t=C.Base.Utils.parseUrl(this._resources.notificationService.websocket.href),i=new C.Config.ServerInfo(t.hostname,t.port,t.isSecure,t.path),e=C.Base.Utils.parseUrl(this._resources.notificationService.sse.href),t=new C.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path),e=new C.Config.ServerInfo;return this._notificationsConfiguration=new C.Config.NetworkProviderConfiguration(e,i,t,this._maxConnectionErrorCount),this._resources},e.prototype.getConversationIds=function(e){e=C.Base.Utils.deepMerge(e,{headers:{}});return e.url=this._endpoints.conversations,e.sendType="GET",e.dataType="JSON",e.headers.Accept=[this._resourcesTypes.conversationIds,this._resourcesTypes.error].join(", "),this._networkProvider.send(null,e).then(function(e){return e},this._handleError.bind(this))},e.prototype.observeConversations=function(){this._dfdConversationsSubscribed=S.Deferred();var e={subscribe:{resources:[{application:"AMM",service:"conversation",resource:this._resources.conversationsResource.href}],version:"1"}};return this._notificationProvider.send(JSON.stringify(e),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdConversationsSubscribed.promise()},e.prototype.reportTyping=function(e,t){var i=this._chatStateNotifications.getChatNotification(this._resources.self);return i&&i.action!==C.Providers.AMM.ChatStateActions.TYPING&&(this._reportChatState(i.action,e,!1),this._chatStateNotifications.clearChatStateRefreshTimeout()),this._chatStateNotifications.isChatStateAdded()?((i=S.Deferred()).resolve(),i.promise()):(this._chatStateNotifications.setChatStateRefreshTimeout(),this._reportChatState(C.Providers.AMM.ChatStateActions.TYPING,e,t))},e.prototype.reportCustomChatNotification=function(e,t,i){var a=this._chatStateNotifications.getChatNotification(this._resources.self);return a&&a.action===C.Providers.AMM.ChatStateActions.TYPING&&(this._reportChatState(C.Providers.AMM.ChatStateActions.TYPING,e,!1),this._chatStateNotifications.clearChatStateRefreshTimeout()),this._chatStateNotifications.isChatStateAdded()?((a=S.Deferred()).resolve(),a.promise()):(this._chatStateNotifications.setChatStateRefreshTimeout(),this._reportChatState(t,e,i))},e.prototype.subscribeForTypingEventsInConversation=function(e,t){var i=this._resources.conversationsResource.href+"/"+e;this._chatStateNotifications.setConversationId(e),this._dfdSubscribed[i]=S.Deferred();var a={subscribe:{resources:[{application:"AMM",service:"chatState",resource:i}]}},r=!1;return this._callbacksForTypingEvents[e]||(this._callbacksForTypingEvents[e]=S.Callbacks()),this._callbacksForTypingEvents[e].has()||(r=!0),this._callbacksForTypingEvents[e].has(t)||this._callbacksForTypingEvents[e].add(t),r&&this._notificationProvider.send(JSON.stringify(a),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdSubscribed[i].promise()},e.prototype.unsubscribeForTypingEventsInConversation=function(e){var t=this._resources.conversationsResource.href+"/"+e;this._chatStateNotifications.setConversationId(""),this._dfdUnsubscribed[t]=S.Deferred();var i={unsubscribe:{resources:[{application:"AMM",service:"chatState",resource:t}]}};this._callbacksForTypingEvents[e]&&this._callbacksForTypingEvents[e].has()&&this._callbacksForTypingEvents[e].empty();return this._notificationProvider.send(JSON.stringify(i),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdUnsubscribed[t].promise()},e.prototype._resubscribeForTypingEvents=function(){var e=this._chatStateNotifications.getConversationId();if(""!==e){var t=this._resources.conversationsResource.href+"/"+e;this._dfdSubscribed[t]=S.Deferred();e={subscribe:{resources:[{application:"AMM",service:"chatState",resource:t}]}};return this._notificationProvider.send(JSON.stringify(e),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdSubscribed[t].promise()}},e.prototype._sendNotification=function(e,t){for(var i=C.Base.Utils.makeId();C.Base.Utils.isDefined(this._requests[i]);)i=C.Base.Utils.makeId();e={notify:{requestId:i,notifications:[e]}};this._requests[i]=t;return this._notificationProvider.send(JSON.stringify(e),{dataType:"JSON",headers:{"Content-Type":"application/json"}}).fail(function(e){this._requests[i].reject(e),delete this._requests[i]}.bind(this))},e.prototype._handleNotificationResponse=function(e){var t;e.results.successful&&C.Base.Utils.isDefined(this._requests[e.requestId])?(this._requests[e.requestId].resolve(e.results.successful[0]),delete this._requests[e.requestId]):e.results.failed&&C.Base.Utils.isDefined(this._requests[e.requestId])&&(t=new C.Services.Messaging.MessagingError(C.Base.ErrorReasons.AMM_NOTIFICATION_FAILED,C.Base.Utils.queryJSONObject(e,"results.failed")),this._requests[e.requestId].reject(t),delete this._requests[e.requestId])},e.prototype.isUpdateSubjectSupported=function(){return!!(this._resources&&this._resources.conversationsResource&&this._resources.conversationsResource.capabilities&&this._resources.conversationsResource.capabilities.subjectChange)},e.prototype.isMarkAllContentAsReadSupported=function(){return!!this._resources&&!!this._resources.services&&!!this._resources.services.markAsReadIf},e.prototype._reportChatState=function(e,t,i){var a=S.Deferred(),t={application:"AMM",service:"chatState",resource:this._resources.conversationsResource.href+"/"+t,contents:{state:C.Providers.AMM.ChatStates.PAUSED}};return i&&(t.contents={action:e,state:C.Providers.AMM.ChatStates.COMPOSING}),this._sendNotification(t,a),a.promise()},e.prototype.isOpened=function(){return this._notificationProvider.isOpened()},e.prototype.getMaxMessageCount=function(){return this._resources.conversationsResource.limits.maxMessageCount},e.prototype.getMaxImageSize=function(){return C.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxImageSize")},e.prototype.getMaxVideoSize=function(){return C.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxVideoSize")},e.prototype.getMaxAudioSize=function(){return C.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxAudioSize")},e.prototype.getMaxTextLength=function(){return C.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxTextLength")},e.prototype.getMaxGenericAttachmentSize=function(){return C.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxGenericAttachmentSize")},e.prototype.changeSubject=function(e){var t={},i={subject:e.subject};return t.url=this._endpoints.conversations+"/"+e.threadId,t.sendType="POST",t.headers={"Content-Type":this._resourcesTypes.subject},this._networkProvider.send(JSON.stringify(i),t).catch(this._handleError.bind(this))},e.prototype._getConversationsState=function(){var e={getState:{requestId:"myGetState",resources:[{application:"AMM",service:"conversation",resource:this._resources.conversationsResource.href}],version:"1"}};return this._dfdConversationsResourceState=S.Deferred(),this._notificationProvider.send(JSON.stringify(e),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdConversationsResourceState.promise()},e.prototype.leaveConversation=function(e){return C.Providers.AMM.AbstractAMMProvider.prototype.leaveConversation.apply(this,[e]).then(function(){this._chatStateNotifications.setConversationId("")}.bind(this))},C.Providers.AMM.AMM3Provider=e}(AvayaClientServices),function(o){"use strict";function e(){o.Providers.AMM.AbstractAMMProvider.call(this),this._providers=[],this._selectedProvider=T,this._config={},this._isAvailable=!1}(e.prototype=Object.create(o.Providers.AMM.AbstractAMMProvider.prototype)).registerAMMProvider=function(e,t){t.on(o.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),t.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),t.on(o.Providers.AMM.ProviderStates.AVAILABLE,function(){this.trigger(o.Providers.AMM.ProviderStates.AVAILABLE,[])}.bind(this)),t.on(o.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this.trigger(o.Providers.AMM.ProviderStates.UNAVAILABLE,[])}.bind(this)),this._providers.push({version:e,provider:t})},e.prototype.start=function(e,t){return S.isEmptyObject(e)||this._config===e||(this._config=e),this.determineServerVersion(t)},e.prototype.determineServerVersion=function(e){var t=S.Deferred();this._providers.sort(function(e,t){return t.version-e.version});return this._checkServer(0,t,this._config,e),t.promise()},e.prototype._checkServer=function(a,r,s,n){this._isProperVersion(a,s,n).then(function(){this._selectedProvider=this._providers[a].provider,o.Base.Logger.info(o.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Determined AMM server version: "+this._selectedProvider._resourcesTypes.resources),this._selectedProvider.startNotificationProvider(n),r.resolve()}.bind(this),function(e){a+=1;var t=e.getData()&&e.getData().message===o.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED,i=e.getData()&&e.getData()===o.Base.ErrorReasons.BACKOFF_ALGORITHM_CANCELLED;!(406===e.statusCode||a<this._providers.length-1)||t||i?r.reject(e):this._checkServer(a,r,s,n)}.bind(this))},e.prototype._isProperVersion=function(e,t,i){return this._selectedProvider=this._providers[e].provider,this._providers[e].provider.start(t,i),this._providers[e].provider.discoverResources(i).then(function(){this._isAvailable=!0}.bind(this))},e.prototype.getRoutableDomains=function(){return this._selectedProvider.getRoutableDomains()},e.prototype.getSelfAddress=function(){return this._selectedProvider.getSelfAddress()},e.prototype.getConversations=function(e){return this._selectedProvider.getConversations(e)},e.prototype.getConversationIds=function(e){return this._selectedProvider.getConversationIds(e).then(function(e){for(var t=[],i=0;i<e.conversationIds.length;i++)t.push(new o.Services.Messaging.ConversationId(e.conversationIds[i]));return t})},e.prototype.getConversationsByQuery=function(e,t,i){return this._selectedProvider.getConversationsByQuery(e,t,i)},e.prototype.discoverResources=function(){return this._selectedProvider.discoverResources()},e.prototype.getResources=function(){return this._selectedProvider.getResources()},e.prototype.validateUsers=function(e){return this._selectedProvider.validateUsers(e)},e.prototype.getParticipants=function(e,t){return this._selectedProvider.getParticipants(e,t)},e.prototype.sendMessage=function(e,t){return this._selectedProvider.sendMessage(e,t)},e.prototype.sendMessageWithAttachments=function(e,t,i){return this._selectedProvider.sendMessageWithAttachments(e,t,i)},e.prototype.leaveConversation=function(e){return this._selectedProvider.leaveConversation(e)},e.prototype.markAllAsRead=function(e){return this._selectedProvider.markAllAsRead(e)},e.prototype.changeSubject=function(e){return this._selectedProvider.changeSubject(e)},e.prototype.markAsReadBatch=function(e){return this._selectedProvider.markAsReadBatch(e)},e.prototype.getMessages=function(e,t,i,a,r){return this._selectedProvider.getMessages(e,t,i,a,r)},e.prototype.reportTyping=function(e,t){return this._selectedProvider.reportTyping(e,t)},e.prototype.reportCustomChatNotification=function(e,t,i){return this._selectedProvider.reportCustomChatNotification(e,t,i)},e.prototype.observeConversations=function(){return this._selectedProvider.observeConversations()},e.prototype.callEscalationEvent=function(e,t){return this._selectedProvider.callEscalationEvent(e,t)},e.prototype.setLastAccessTime=function(e,t){return this._selectedProvider.setLastAccessTime(e,t)},e.prototype.addParticipantsToConversation=function(e,t){return this._selectedProvider.addParticipantsToConversation(e,t)},e.prototype.subscribeForTypingEventsInConversation=function(e,t){return this._selectedProvider.subscribeForTypingEventsInConversation(e,t)},e.prototype.unsubscribeForTypingEventsInConversation=function(e){return this._selectedProvider.unsubscribeForTypingEventsInConversation(e)},e.prototype.close=function(e){return this._selectedProvider.close(e)},e.prototype.stop=function(){return this._selectedProvider.stop().then(function(){this._isAvailable=!1}.bind(this))},e.prototype.logout=function(){return this._selectedProvider.logout()},e.prototype.on=function(e,t){return this._selectedProvider?this._selectedProvider.on(e,t):o.Providers.AMM.AbstractAMMProvider.prototype.on.call(this,e,t)},e.prototype.off=function(e,t){return this._selectedProvider.off(e,t)},e.prototype.isUpdateSubjectSupported=function(){return this._selectedProvider.isUpdateSubjectSupported()},e.prototype.isMarkAllContentAsReadSupported=function(){return this._selectedProvider.isMarkAllContentAsReadSupported()},e.prototype.isOpened=function(){return this._selectedProvider.isOpened()},e.prototype.getMaxMessageCount=function(){return this._selectedProvider.getMaxMessageCount()},e.prototype.getMaxImageSize=function(){return this._selectedProvider.getMaxImageSize()},e.prototype.getMaxVideoSize=function(){return this._selectedProvider.getMaxVideoSize()},e.prototype.getMaxAudioSize=function(){return this._selectedProvider.getMaxAudioSize()},e.prototype.getMaxTextLength=function(){return this._selectedProvider.getMaxTextLength()},e.prototype.getMaxSubjectLength=function(){return 50},e.prototype.getMaxGenericAttachmentSize=function(){return this._selectedProvider.getMaxGenericAttachmentSize()},e.prototype.getConversationResource=function(){return this._selectedProvider.getConversationResource()},e.prototype.getValidateAddressResource=function(){return this._selectedProvider.getValidateAddressResource()},e.prototype.getMarkAsReadResource=function(){return this._selectedProvider.getMarkAsReadResource()},e.prototype.isAvailable=function(){return this._isAvailable&&!!this._selectedProvider&&!!this._selectedProvider.isStarted()&&this.isOpened()},o.Providers.AMM.AMMProvider=e}(AvayaClientServices),function(i){"use strict";var s="v",n="tid",o="cid",a="t",c="an",l="av",r="event",d="timing",t=!1,C=[],u={BUCKET_DEFINITIONS:{OPERATIONS_TIMING:{LESS_100:"<100 msec",MORE_100:"100-999 msec",MORE_1000:"1000-4999 msec",MORE_5000:"5000-9999 msec",MORE_10000:">=10000 msec"},SERVICE_OUTAGE:{LESS_1000:"<1 sec",MORE_1000:"1-59 sec",MORE_60000:"1-10 min",MORE_600000:"10-59 min",MORE_3600000:">=1 hour"},CALL_DURATION:{LESS_10000:"<10 sec",MORE_10000:"10-59 sec",MORE_60000:"1-5 min",MORE_300000:"5-10 min",MORE_600000:"10-60 min",MORE_3600000:">=60 min"},CONTACT_COUNT:{LESS_10:"<10",MORE_10:"10-99",MORE_100:"100-499",MORE_500:"500-999",MORE_1000:"1000-1999",MORE_2000:"2000-2999",MORE_3000:"3000-3999",MORE_4000:"4000-4999",MORE_5000:">=5000"},ATTACHMENT_SIZE:{LESS_100:"<100 KB",MORE_100:"100-999 KB",MORE_1000:"1000-4999 KB",MORE_5000:"5000-9999 KB",MORE_10000:"10000-29999 KB",MORE_30000:">=30000 KB"},CALL_PRESERVATION:{LESS_1000:"<1 sec",MORE_1000:"1-5 sec",MORE_5000:"5-10 sec",MORE_10000:"10-30 sec",MORE_30000:"30-60 sec",MORE_60000:">=60 sec"}}},h=i.Base.Utils;i.Providers.Analytics.AnalyticsStatistic={CONSTANTS:u,setCollectionEnabledState:function(e){(t=e)||(C.length=0)},isCollectionEnabled:function(){return t},queueCollectedHits:function(){this._hitTransmissionQueue=this._hitTransmissionQueue.concat(C),C.length=0},addHit:function(e){t&&C.push(e)},getCommonRequestsParams:function(e,t){for(var i="",a=[[s,1],[n,"UA-81637253-1"],[o,t],[c,"Client SDK Communications Package"],[l,e]],r=0;r<a.length;r++)i+=this.addURIParam(a[r][0],a[r][1],!i);return i},addHitTypeParameter:function(e){var t="";switch(e){case"event":t=r;break;case"timing":t=d;break;default:i.Base.Logger.warn(i.Base.LoggerTags.ANALYTICS_PROVIDER,"Unknown type",e)}return this.addURIParam(a,t)},addCustomDimensionsParameters:function(e){var t,i,a="";for(t in e)!e.hasOwnProperty(t)||"string"==typeof(i=e[t])&&""!==i&&h.getBytesCount(encodeURIComponent(i))<=150&&(a+=this.addURIParam("cd"+t,i));return a},addURIParam:function(e,t,i){var a="";return a+=i?"":"&",a+=e+"="+encodeURIComponent(t)},getOperationTimingLabel:function(e){var t=u.BUCKET_DEFINITIONS.OPERATIONS_TIMING;return e<100?t.LESS_100:e<1e3?t.MORE_100:e<5e3?t.MORE_1000:e<1e4?t.MORE_5000:t.MORE_10000},getServiceOutageLabel:function(e){var t=u.BUCKET_DEFINITIONS.SERVICE_OUTAGE;return e<1e3?t.LESS_1000:e<6e4?t.MORE_1000:e<6e5?t.MORE_60000:e<36e5?t.MORE_600000:t.MORE_3600000},getCallDurationLabel:function(e){var t=u.BUCKET_DEFINITIONS.CALL_DURATION;return e<1e4?t.LESS_10000:e<6e4?t.MORE_10000:e<3e5?t.MORE_60000:e<6e5?t.MORE_300000:e<36e5?t.MORE_600000:t.MORE_3600000},getContactCountLabel:function(e){var t=u.BUCKET_DEFINITIONS.CONTACT_COUNT;return e<10?t.LESS_10:e<100?t.MORE_10:e<500?t.MORE_100:e<1e3?t.MORE_500:e<2e3?t.MORE_1000:e<3e3?t.MORE_2000:e<4e3?t.MORE_3000:e<5e3?t.MORE_4000:t.MORE_5000},getAttachmentSizeLabel:function(e){var t=u.BUCKET_DEFINITIONS.ATTACHMENT_SIZE;return(e/=1024)<100?t.LESS_100:e<1e3?t.MORE_100:e<5e3?t.MORE_1000:e<1e4?t.MORE_5000:e<3e4?t.MORE_10000:t.MORE_30000},getCallPreservation:function(e){var t=u.BUCKET_DEFINITIONS.CALL_PRESERVATION;return e<1e3?t.LESS_1000:e<5e3?t.MORE_1000:e<1e4?t.MORE_5000:e<3e4?t.MORE_10000:e<6e4?t.MORE_30000:t.MORE_60000}}}(AvayaClientServices),function(e){"use strict";var c="utc",l="utv",d="utt",C="utl",u=e.Base.Utils,h=e.Providers.Analytics.AnalyticsStatistic;e.Providers.Analytics.AnalyticsTimingStatistic={send:function(e,t,i,a,r){var s;!h.isCollectionEnabled()||(s=this._getTimingParams.apply(this,arguments))&&h.addHit(s)},_getTimingParams:function(e,t,i,a,r){if(!u.isInteger(i))return null;var s=h.addHitTypeParameter("timing"),n=[[c,e],[l,t],[d,i]];a&&n.push([C,a]);for(var o=0;o<n.length;o++)s+=h.addURIParam(n[o][0],n[o][1]);return s+=h.addCustomDimensionsParameters(r)}}}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r){o.Base.Observable.call(this),this._restProvider=t,this._restProvider.setCSRFSupport(!0),this._notificationProvider=i,this._restKeepAliveProvider=a,this._restKeepAliveProvider.setCSRFSupport(!0),this._residueRestKeepAliveProvider=T,this._messageBuilder=e,this._csgConfig=T,this._notificationsConfig=T,this._maxConnectionErrorCount=5,this._credentials=T,this._started=!1,this._isNetworkAvailable=!1,this._startPromise=T,this._eTag=T,this._cancelDiscovery=!1,this._resourceHrefs={},this._restResources={},this._notificationResources={},this._activeServices=[],this._serviceParameters={},this._notificationPromises={},this._notificationHandlers={},this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var e=o.Base.Utils.makeId(32,"0123456789abcdef"),e={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=e,version:"1"}};return JSON.stringify(e)}.bind(this),wsIsPongMessage:function(e){e="string"==typeof e?JSON.parse(e):e;return o.Base.Utils.isDefined(e.pong)&&this._failoverPingData.wsPingMessageRequestId===e.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._blackListedWords=["remoteDisplayName","Authorization","authentication","meetingToken","meetingPasscode","meetingId","userIdentity","rlPresenceUpdatedEvent","contact","remoteAddress","targetRemoteAddress","targetCallId","participantId","webCollaborationUrl","callInfo","username","owner","userId"],this._discoveryBackoffDataObject=T,this._clientId=T,this._discoveryCounter=0,this._resourceDiscoveryRetryInterval=250,this._resourceDiscoveryRetryFactor=1.2}(e.prototype=Object.create(o.Base.Observable.prototype)).start=function(e){var t;return this._started||this._startPromise||(this._started=!0,this._csgConfig=e,this._discoveryCounter=0,this._cancelDiscovery=!1,this._startPromise=S.Deferred(),t=function(){this._discoverResources().then(this._startNotificationProvider.bind(this),function(e){if(e!==o.Providers.CallServiceGateway.Constants.RESOURCE_DISCOVERY_USERNAME_MISMATCH)return S.Deferred().reject(e).promise();this._clientId=T,t.call(this)}.bind(this)).then(function(){this._restProvider.onError=function(){},this._startRefreshingClientSession(),o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Provider has been started successfully"),o.Base.Utils.isDefined(this._startPromise)&&this._startPromise.resolve()}.bind(this),function(e){o.Base.Utils.isDefined(this._startPromise)&&this._startPromise.reject(e)}.bind(this))}.bind(this),this._startRestProvider().then(t.bind(this))),this._startPromise.promise()},e.prototype.stop=function(){if(!this._started&&this._isNetworkAvailable)return S.Deferred().reject("CSGProvider: Provider is not started").promise();if(0<this._activeServices.length)return S.Deferred().resolve().promise();o.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel();function t(e){i=i||e}var i,e=S.Deferred();return this._isNetworkAvailable?this._stopNotificationProvider().then(function(){return this._stopRefreshingClientAndRestSession()}.bind(this),function(e){return t(e),this._stopRefreshingClientAndRestSession()}.bind(this)).then(function(){return this._stopRestProvider()}.bind(this),function(e){return t(e),this._stopRestProvider()}.bind(this)).fail(function(e){t(e)}).always(function(){this._cleanupAfterStop(),i?e.reject(i):e.resolve()}.bind(this)):(this._pauseRefreshingClientSession(),this._stopNotificationProvider().always(function(){this._stopRestProvider().always(function(){this._cleanupAfterStop()}.bind(this)),e.reject(new o.Base.NetworkError(o.Base.ErrorReasons.NETWORK_ERROR))}.bind(this))),e.promise().then(function(){o.Base.Logger.debug("CSGProvider: Provider has been stopped successfully")})},e.prototype.stopImmediately=function(){if(!this._started)return S.Deferred().reject("CSGProvider: Provider is not started");function t(e){i=i||e}var i,e=S.Deferred();return this._pauseRefreshingClientSession(),o.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),this._stopRefreshingClientSessionSynchronously().then(function(){return this._stopNotificationProvider()}.bind(this),function(e){return t(e),this._stopNotificationProvider()}.bind(this)).then(function(){return this._stopRestProvider()}.bind(this),function(e){return t(e),this._stopRestProvider()}.bind(this)).fail(function(e){t(e)}.bind(this)).always(function(){this._cleanupAfterStop(),i?e.reject(i):e.resolve()}.bind(this)),e.promise().then(function(){o.Base.Logger.debug("CSGProvider: Provider has been stopped successfully")})},e.prototype._cleanupAfterStop=function(){this._removeListeners(),this._started=!1,this._discoveryCounter=0,this._cancelDiscovery=!1,this._notificationsConfig=T,this._credentials=T,this._startPromise=T,this._eTag=T,this._clientId=T,this._resourceHrefs={},this._restResources={},this._notificationResources={},this._activeServices=[],this._notificationPromises={},this._notificationHandlers={},o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Provider has been stopped successfully")},e.prototype._startRestProvider=function(){var e=S.Deferred();return this._restProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._restProvider.registerBlackList(this._blackListedWords),this._restProvider.onMessage=function(e,t){void 0===t||null!=(t=t.getResponseHeader("ETag"))&&(this._eTag=t)}.bind(this),this._restProvider.onConnectionUnavailable=function(e){this._handleError("Unable to communicate with REST server"),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",e])}.bind(this),this._restProvider.onOpen=function(){this._restProvider.onError=function(e){this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",e]))}.bind(this),e.resolve()}.bind(this),this._restProvider.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(){e.reject(o.Base.NetworkProviderEvents.UNAUTHORIZED),this.trigger(o.Base.NetworkProviderEvents.UNAUTHORIZED,[]),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",o.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED])}.bind(this)),this._restProvider.on(o.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._restProvider.start(this._csgConfig.networkProviderConfiguration,this._csgConfig.credentialProvider),e.promise()},e.prototype._stopNotificationProvider=function(){var t=S.Deferred();return this._notificationProvider.onClose=function(){t.resolve(),o.Base.Logger.warn("CSGProvider: Notification service websocket connection is closed")},this._notificationProvider.stopMonitorFallback(),this._isNetworkAvailable?(this._notificationProvider.onError=function(e){o.Base.Logger.warn("CSGProvider: Notification service websocket connection is closed with error",e),t.resolve()},this._notificationProvider.close()):t.reject(new o.Base.NetworkError(o.Base.ErrorReasons.NETWORK_ERROR)),t.promise()},e.prototype._stopRestProvider=function(){return this._restProvider.close()},e.prototype.activateService=function(t,e){var i=this._messageBuilder.buildActivateServiceOptions(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.Services]),a=this._messageBuilder.buildActivateServiceData(t,e);if(-1!==this._activeServices.indexOf(t))return o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Service already activated",t),S.Deferred().resolve().promise();this._serviceParameters[t]=e;a=JSON.stringify(a);return o.Base.Utils.callFunction(this._restProvider,this._restProvider.send,[a,i],5,3200).then(function(e){return this._activeServices.push(t),o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Service activated",t),e}.bind(this),function(e){return o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to activate service",t),S.Deferred().reject(e).promise()}.bind(this))},e.prototype._reactivateService=function(){var e=this._activeServices.indexOf(o.Providers.CallServiceGateway.Constants.CALLS);-1!==e&&(this._activeServices.splice(e,1),this.activateService(o.Providers.CallServiceGateway.Constants.CALLS,this._serviceParameters[o.Providers.CallServiceGateway.Constants.CALLS]));e=this._activeServices.indexOf(o.Providers.CallServiceGateway.Constants.PRESENCE);-1!==e&&(this._activeServices.splice(e,1),this.activateService(o.Providers.CallServiceGateway.Constants.PRESENCE,this._serviceParameters[o.Providers.CallServiceGateway.Constants.PRESENCE]))},e.prototype.deactivateService=function(e){var t=this._messageBuilder.buildDeactivateServiceOptions(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.Services]),i=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(e)),e=this._activeServices.indexOf(e);return-1<e&&this._activeServices.splice(e,1),this._restProvider.send(i,t)},e.prototype._deactivateServicesImmediately=function(){var e=this._messageBuilder.buildDeactivateServiceOptions(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.Services]);e.async=!1;var t=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(o.Providers.CallServiceGateway.Constants.CALLS));this._restProvider.send(t,e);t=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(o.Providers.CallServiceGateway.Constants.PRESENCE));this._restProvider.send(t,e)},e.prototype._discoverResources=function(){if(this._cancelDiscovery)return S.Deferred().reject("Resource Discovery Cancelled").promise();var s=S.Deferred(),e=function(e){this._isCSRFSupportVerified(e)?o.Base.Utils.isDefined(this._startPromise)&&"pending"===this._startPromise.state()&&(this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST","Resource Discovery"]),this._startPromise.reject("Resource discovery failed detected")):(this._restProvider.setCSRFSupport(!1),this._restKeepAliveProvider.setCSRFSupport(!1))}.bind(this),t=function(e){var t,i,a,r=this._messageBuilder.buildResourceDiscoveryData(this._clientId),s=this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.Clients];s&&(t=(s=s.replace("/users/self/clients","")).indexOf("/csa"),i=s.indexOf("/bsid"),a=s.lastIndexOf("/resources"),-1!==t&&-1!==i&&-1!==a&&(n=s.substring(t,i)+s.substring(a))),o.Base.Utils.isUndefined(n)&&(n=this._csgConfig.networkProviderConfiguration.restConfig.path),this._credentials&&this._credentials.isGuest&&(r.name=this._credentials.displayName);var n=this._messageBuilder.buildResourceDiscoveryOptions(n);return this._restProvider.send(r,n)}.bind(this);return o.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=o.Base.Utils.connectionBackoffAlgorithm(t,e,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor),this._discoveryBackoffDataObject.dfdPromise.then(function(e){if(this._discoveryCounter++,this._resourceDiscoveryRetryInterval=1e3,this._discoveryBackoffDataObject=T,null!==e){if(this._restResources=S.extend({},new o.Providers.CallServiceGateway.RestResources,e),e.clientId&&(this._clientId=e.clientId),e.resources)for(var t=0;t<e.resources.length;t++){var i=e.resources[t];this._resourceHrefs[i.name]=i.serviceReference.href,"calls"===i.name?i.serviceReference.supported?this.trigger(o.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[i.serviceReference.supported]):this.trigger(o.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[]):"upload-logs"===i.name&&this.trigger(o.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,[i.serviceReference.href,i.bucketName,this._clientId])}var a,r;e.sessionManagement&&(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.RestSessionMgmt]=e.sessionManagement.href,a=o.Base.Utils.queryJSONObject(e,"sessionManagement.username"),o.Base.Utils.isDefined(this._credentials.username)&&(0<=(r=this._credentials.username).indexOf("csaGuest/")&&(r=r.substring("csaGuest/".length)),o.Base.Utils.isDefined(a)&&a!==r&&(!this._credentials.isGuest||0!==a.indexOf("jsg-")&&0!==a.indexOf("sessionId-")?(o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Rediscovering resources due to mismatch username"),this._deleteRestSession(),this._clientId=T,s.reject(o.Providers.CallServiceGateway.Constants.RESOURCE_DISCOVERY_USERNAME_MISMATCH)):(o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Overriding mismatch guest username"),this._credentials.username="csaGuest/"+a,this._csgConfig.credentialProvider.username=this._credentials.username)))),e.clientManagement&&(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.ClientKeepAlive]=e.clientManagement.refreshClient.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.ClientTerminate]=e.clientManagement.terminateClient.href,e.clientManagement.fastDelete&&(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.FastDelete]=e.clientManagement.fastDelete.href)),e.stunServers&&this.trigger(o.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,[e.stunServers]),e.presence&&(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.PublishPresenceMode]=e.presence.manualMode.set.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.PublishPresenceState]=e.presence.manualPresenceState.set.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.PublishPresenceNote]=e.presence.manualNote.set.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.DeletePresenceMode]=e.presence.manualMode.delete.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.DeletePresenceState]=e.presence.manualPresenceState.delete.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.DeletePresenceNote]=e.presence.manualNote.delete.href),e.pubSubContainers&&(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.CreatePresenceContainer]=e.pubSubContainers.create.href),e.notificationService?(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.Websocket]=e.notificationService.websocket.href,this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.SSE]=e.notificationService.sse.href,this._createNotificationsConfig(),s.resolve()):s.reject("Notification service is undefined")}}.bind(this),function(e){this._handleError("_discoverResources() network provider failed - "+e),s.reject(e)}.bind(this)),s.promise()},e.prototype._isCSRFSupportVerified=function(e){return 0<=e||0<this._discoveryCounter},e.prototype._createNotificationsConfig=function(){var e=o.Base.Utils.parseUrl(this._restResources.notificationService.websocket.href),t=new o.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path),i=o.Base.Utils.parseUrl(this._restResources.notificationService.sse.href),e=new o.Config.ServerInfo(i.hostname,i.port,i.isSecure,i.path),i=new o.Config.ServerInfo;this._notificationsConfig=new o.Config.NetworkProviderConfiguration(i,t,e,this._maxConnectionErrorCount)},e.prototype._startNotificationProvider=function(){var r=S.Deferred();if(this._notificationProvider.isOpened())return r.resolve().promise();if(!this._notificationsConfig)return r.reject(new Error("Unable to start notifications service - Notifications provider configuration is absent")).promise();this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notifications provider has been started"),this._isNetworkAvailable=!0,this._notificationProvider.onMessage=function(e){var t,i,a=e.data&&e.type!==o.Base.ProvidersEventTypes.PING?JSON.parse(e.data):e;a.notification?this._onNotification(a.notification):a.subscribed?this._onSubscribed(a.subscribed):a.discovery?(this._onNotificationDiscovery(a.discovery),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE),r.resolve()):a.notified&&a.notified.results.failed&&(i=a.notified.requestId,t=o.Base.Utils.queryJSONObject(a.notified.results,"failed[0].error.errorCode"),e=o.Providers.CallServiceGateway.Utils.convertErrorCode(t),a=o.Base.Utils.queryJSONObject(a.notified.results,"failed[0].error.description"),null!==(i=i.match(/jscsdk\.(.*)\.req.*/))&&2===i.length&&"null"!==i[1]&&this.trigger(o.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[i[1],e,o.Services.Call.CallProtocolType.APPLICATION,t,a]))}.bind(this)}.bind(this),this._notificationProvider.onError=function(e){o.Base.Logger.warn(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notification service websocket connection failed: ",e),r.reject(new o.Base.NetworkError(o.Base.ErrorReasons.NETWORK_ERROR)),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification",e]))}.bind(this),this._notificationProvider.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(o.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(o.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this));var e=function(){var t=S.Deferred();return this._pauseRefreshingClientSession(),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification","Unavailable"])),this._activeServices=[],this._discoverResources().then(function(){this._startNotificationProvider().then(function(){this._reactivateService(),this._startRefreshingClientSession(),t.resolve()}.bind(this),function(e){t.reject(e)})}.bind(this),function(e){t.reject(e)}),t.promise()}.bind(this);return this._notificationProvider.registerBlackList(this._blackListedWords),this._notificationProvider.start(this._notificationsConfig,T,T,T,e,this._failoverPingData).then(function(){return o.Base.Utils.rejectIfPromiseNotResolvedInTime(r.promise(),3e4,new o.Base.BaseError(o.Base.ErrorReasons.TIMEOUT),function(){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notification discovery was not received in time"),this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification","Unavailable"])}.bind(this))}.bind(this),function(){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Start notification channel failed.")}),r.promise()},e.prototype._onNotificationDiscovery=function(e){this._notificationResources=S.extend({},new o.Providers.CallServiceGateway.NotificationResources,e),this._notificationResources.commandURL&&this._resourceHrefs.hasOwnProperty(o.Providers.CallServiceGateway.ResourceType.SSE)&&(o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Using SSE connection"),e=o.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfig.restConfig.hostName=e.hostname,this._notificationsConfig.restConfig.port=e.port,this._notificationsConfig.restConfig.isSecure=e.isSecure,this._notificationsConfig.restConfig.path=e.path)},e.prototype._onSubscribed=function(e){var t;e.requestId&&e.results&&((t=this._notificationPromises[e.requestId])&&(o.Base.Utils.queryJSONObject(e,"results.successful[0].application")===o.Providers.CallServiceGateway.Constants.CSA_APPLICATION?(t.resolve(),o.Base.Logger.debug(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed",o.Base.Utils.queryJSONObject(e,"results.successful[0].resource"))):o.Base.Utils.queryJSONObject(e,"results.failed[0].application")===o.Providers.CallServiceGateway.Constants.CSA_APPLICATION&&(e=o.Base.Utils.queryJSONObject(e,"results.failed[0].error.description"),t.reject({message:"Failed to subscribe for notifications",details:e}))))},e.prototype._onNotification=function(e){var t;e.application!==o.Providers.CallServiceGateway.Constants.CSA_APPLICATION||!e.resource||(t=this._notificationHandlers[e.resource])&&t(e.contents)},e.prototype.subscribeForNotifications=function(e,t){var i=S.Deferred(),a=i.promise();return a.then(function(){this._notificationHandlers[e.subscribe.resources[0].resource]=t}.bind(this)),this._notificationPromises[e.subscribe.requestId]=i,this.sendNotification(JSON.stringify(e),this._messageBuilder.buildNotificationsOptions()),a},e.prototype.unsubscribeFromNotifications=function(e){return this.sendNotification(JSON.stringify(e),this._messageBuilder.buildNotificationsOptions()).always(function(){delete this._notificationHandlers[e.unsubscribe.resources[0].resource]}.bind(this))},e.prototype.send=function(e,t){return this._restProvider.send(e,t).fail(function(e){var t=this._parseNetworkError(e);t&&o.Base.Utils.queryJSONObject(t,"error[0].errorCode")!==o.Providers.CallServiceGateway.Constants.CALL_DOES_NOT_EXISTS&&this._handleError(JSON.stringify(e))}.bind(this))},e.prototype.sendNotification=function(e,t){return this._notificationProvider.send(e,t).fail(function(e){this._handleError(JSON.stringify(e))}.bind(this))},e.prototype.getRestResources=function(){return this._restResources},e.prototype.getNotificationResources=function(){return this._restResources},e.prototype.getResourceHrefs=function(){return this._resourceHrefs},e.prototype.getCredentials=function(){return this._credentials},e.prototype.restProviderOnErrorHandler=function(e){this._restProvider.onError=e},e.prototype.forceNetworkRecovery=function(){this._pauseRefreshingClientSession(),this._notificationProvider.onConnectionUnavailable(),this._notificationProvider.close()},e.prototype._onCredentialsRequired=function(t,e){e&&e!==this._csgConfig.credentialProvider&&o.Base.Utils.deepMerge(this._csgConfig.credentialProvider,e),this._csgConfig.credentialProvider.onAuthenticationChallenge(void 0,function(e){this._onCredentialsRetrieved(e,t)}.bind(this))},e.prototype._onCredentialsRetrieved=function(e,t){o.Base.Utils.isDefined(t.options)&&(t.options.authentication=t.options.authentication||{},e.token?(e.bearer=e.bearer||o.Config.Authentication.TokenType.BEARER,!o.Base.Utils.isUndefined(this._credentials)&&this._credentials.token===e.token||(this._credentials=e),t.options.authentication.type=o.Config.Authentication.Scheme.BEARER,t.options.authentication.token=e.token,t.options.authentication.bearer=e.bearer):(!o.Base.Utils.isUndefined(this._credentials)&&this._credentials.username===e.username&&this._credentials.password===e.password||(this._credentials=e),t.options.authentication.type=o.Config.Authentication.Scheme.BASIC,t.options.authentication.username=e.username,t.options.authentication.password=e.password))},e.prototype._startRefreshingRestSession=function(){var e=this._messageBuilder.buildKeepAliveOptions();this._restResources.sessionManagement&&(this._restKeepAliveProvider.stopPolling(),this._restKeepAliveProvider.startPolling(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.RestSessionMgmt],1e3*this._restResources.sessionManagement.timeout*.8,{},e))},e.prototype._pauseRefreshingRestSession=function(){return this._restKeepAliveProvider.stopPolling()},e.prototype._startRefreshingClientSession=function(){var e,t=this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.ClientKeepAlive];o.Base.Utils.isDefined(t)?(e=this._messageBuilder.buildKeepAliveOptions(this._csgConfig),this._pauseRefreshingClientSession(),this._restKeepAliveProvider.startPolling(t,1e3*this._restResources.clientManagement.timeout*.8,{},e),this._restKeepAliveProvider.onMessage=function(e){this._residueRestKeepAliveProvider&&(this._residueRestKeepAliveProvider.stopPolling(),this._residueRestKeepAliveProvider=T),this._isNetworkAvailable||(this._isNetworkAvailable=!0,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE))}.bind(this),this._restKeepAliveProvider.onError=function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network error detected while pinging session management: ",e),this._isNetworkAvailable?(this._isNetworkAvailable=!1,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",e]),this._monitorKeepAliveSession()):this._residueRestKeepAliveProvider&&this.forceNetworkRecovery()}.bind(this)):this._startRefreshingRestSession()},e.prototype._monitorKeepAliveSession=function(){var e,t,i=this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.ClientKeepAlive];o.Base.Utils.isDefined(i)&&(e=this._messageBuilder.buildKeepAliveOptions(this._csgConfig),this._residueRestKeepAliveProvider?this._residueRestKeepAliveProvider.stopPolling():(this._residueRestKeepAliveProvider=new o.Base.PollingRESTProvider,this._residueRestKeepAliveProvider.setCSRFSupport(!1)),t=3e4,this._restResources.clientManagement.timeout<30&&(t=1e3*this._restResources.clientManagement.timeout*(1-.8)),this._residueRestKeepAliveProvider.startPolling(i,t,{},e),this._residueRestKeepAliveProvider.onMessage=function(e){this._isNetworkAvailable||(this._isNetworkAvailable=!0,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)),this._startRefreshingClientSession()}.bind(this),this._restKeepAliveProvider.onError=function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network error detected while pinging session management: ",e),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(o.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",e]))}.bind(this))},e.prototype._pauseRefreshingClientSession=function(){return this._residueRestKeepAliveProvider&&(this._residueRestKeepAliveProvider.stopPolling(),this._residueRestKeepAliveProvider=T),this._restKeepAliveProvider.stopPolling()},e.prototype._stopRefreshingClientAndRestSession=function(){return this._pauseRefreshingClientSession(),this._invokeIfNetworkIsAvailable(function(){return this._invokeIfNetworkIsAvailable(this._deleteClientSession.bind(this)).then(function(){return this._invokeIfNetworkIsAvailable(this._deleteRestSession.bind(this))}.bind(this),function(e){return this._invokeIfNetworkIsAvailable(this._deleteRestSession.bind(this))}.bind(this))}.bind(this))},e.prototype._stopRefreshingClientSessionSynchronously=function(){return this._pauseRefreshingClientSession(),this._deleteClientSessionImmediately()},e.prototype._deleteClientSession=function(e){var t=this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.ClientTerminate];if(this._isNetworkAvailable&&o.Base.Utils.isDefined(t)){t=this._messageBuilder.buildDeleteSessionOptions(t);return o.Base.Utils.isDefined(e)&&(t.async=e),this._restProvider.send(null,t)}return S.Deferred().resolve().promise()},e.prototype._deleteClientSessionImmediately=function(){var e=this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.FastDelete];return e&&navigator.sendBeacon?(navigator.sendBeacon(e)?S.Deferred().resolve():S.Deferred().reject("Failed to delete client session")).promise():this._deleteClientSession(!1)},e.prototype._deleteRestSession=function(e){var t=this._messageBuilder.buildDeleteSessionOptions(this._resourceHrefs[o.Providers.CallServiceGateway.ResourceType.RestSessionMgmt]);return o.Base.Utils.isDefined(e)&&(t.async=e),this._restProvider.send(null,t)},e.prototype._invokeIfNetworkIsAvailable=function(e){return this._isNetworkAvailable?e():S.Deferred().reject("Network is unavailable").promise()},e.prototype._handleError=function(e){o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error detected: "+e)},e.prototype._parseNetworkError=function(e){var t=o.Base.Utils.queryJSONObject(e,"_data._responseText");if(t)try{return JSON.parse(t)}catch(e){}return T},e.prototype.isNetworkAvailable=function(){return this._isNetworkAvailable},e.prototype.cancelDiscovery=function(){this._cancelDiscovery=!0,o.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),o.Base.Logger.info(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Resource discovery cancelled")},e.prototype.invalidateClient=function(){this._clientId=T,this._pauseRefreshingClientSession()},e.prototype.isNetworkEventsUrlDefined=function(){return!!this.getResourceHrefs().mpaasevents},e.prototype.setOnNetworkEvents=function(e){if(!this.isNetworkEventsUrlDefined()){var t=new o.Services.Call.CallException(o.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,t),S.Deferred().reject(t).promise()}t=this._messageBuilder.buildSubscribeGenericEventsOptions(this.getResourceHrefs().mpaasevents),e=JSON.stringify(e);return this._restProvider.send(e,t)},e.prototype.removeOnNetworkEvents=function(e){if(!this.isNetworkEventsUrlDefined()){var t=new o.Services.Call.CallException(o.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,t),S.Deferred().reject(t).promise()}e=this._messageBuilder.buildUnsubscribeGenericEventsOptions(this.getResourceHrefs().mpaasevents,e);return this._restProvider.send(null,e)},e.prototype.updateOnNetworkEvents=function(e){if(!this.isNetworkEventsUrlDefined()){var t=new o.Services.Call.CallException(o.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return o.Base.Logger.error(o.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,t),S.Deferred().reject(t).promise()}t=this._messageBuilder.buildUpdateGenericEventsOptions(this.getResourceHrefs().mpaasevents),e=JSON.stringify(e);return this._restProvider.send(e,t)},o.Providers.CallServiceGateway.CSGProvider=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i){n.Providers.Interfaces.ConferenceDataProvider.call(this),this._networkProvider=e,this._config=T,this._messageBuilder=t,this._messageParser=i,this._isStarted=!1}(e.prototype=Object.create(n.Providers.Interfaces.ConferenceDataProvider.prototype)).start=function(e){var t=S.Deferred();return this._config=e,this._isStarted=!0,t.resolve(),t.promise()},e.prototype.onCredentialsRequired=function(t,e){e&&e!==this._config.credentialProvider&&n.Base.Utils.deepMerge(this._config.credentialProvider,e),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(e){this.onCredentialsRetrieved(e,t)}.bind(this))},e.prototype.onCredentialsRetrieved=function(e,t){},e.prototype.sendHandshake=function(e){e=this._messageBuilder.buildHandshakeRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeMeetingInfo=function(e){e=this._messageBuilder.buildSubscribeMeetingInfoRequest(e);return this._sendMessage(e,"success")},e.prototype.startRecording=function(e,t,i){i=this._messageBuilder.buildSetRecordingRequest(e,n.Services.Conference.RecordingOperation.START,t,i);return this._sendMessage(i,"success")},e.prototype.stopRecording=function(e){e=this._messageBuilder.buildSetRecordingRequest(e,n.Services.Conference.RecordingOperation.STOP);return this._sendMessage(e,"success")},e.prototype.pauseRecording=function(e){e=this._messageBuilder.buildSetRecordingRequest(e,n.Services.Conference.RecordingOperation.PAUSE);return this._sendMessage(e,"success")},e.prototype.resumeRecording=function(e){e=this._messageBuilder.buildSetRecordingRequest(e,n.Services.Conference.RecordingOperation.RESUME);return this._sendMessage(e,"success")},e.prototype.subscribeRoster=function(e){e=this._messageBuilder.buildSubscribeRosterRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeActiveTalker=function(e){e=this._messageBuilder.buildSubscribeActiveTalkerRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribePermissions=function(e){e=this._messageBuilder.buildSubscribePermissionsRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeSlider=function(e){e=this._messageBuilder.buildSubscribeSliderRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeMeetingNote=function(e){e=this._messageBuilder.buildSubscribeMeetingNoteRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeWebCollab=function(e){e=this._messageBuilder.buildSubscribeWebCollabRequest(e);return this._sendMessage(e,"success")},e.prototype.subscribeAvailableLayouts=function(e){e=this._messageBuilder.buildSubscribeAvailableLayoutsRequest(e);return this._sendMessage(e,"success")},e.prototype.setAsLecturer=function(e,t){t=this._messageBuilder.buildSetAsLecturerRequest(e,t);return this._sendMessage(t,"success")},e.prototype.unsetAsLecturer=function(e){e=this._messageBuilder.buildUnsetAsLecturerRequest(e);return this._sendMessage(e,"success")},e.prototype.disconnectParticipant=function(e,t){t=this._messageBuilder.buildDisconnectParticipantRequest(e,t._participantId);return this._sendMessage(t,"success")},e.prototype.setLocked=function(e,t){t=this._messageBuilder.buildLockMeetingRequest(e,t);return this._sendMessage(t,"success")},e.prototype.muteUnmute=function(e,t,i,a){a=this._messageBuilder.buildModeratorMuteRequest(e,t,i,a);return this._sendMessage(a,"success")},e.prototype.controlRemoteCamera=function(e,t,i){i=this._messageBuilder.buildFeccRequest(e,t,i);return this._sendMessage(i,"success")},e.prototype.muteUnmuteAll=function(e,t){t=this._messageBuilder.buildMuteAllRequest(e,t);return this._sendMessage(t,"success")},e.prototype.sendLocalMuteEvent=function(e,t,i){i=this._messageBuilder.buildLocalMuteEvent(e,t,i);return this._networkProvider.send(JSON.stringify(i))},e.prototype.sendDisconnectEvent=function(e,t){t=this._messageBuilder.buildDisconnectEvent(e,t);return this._networkProvider.send(JSON.stringify(t))},e.prototype.terminateConference=function(e){e=this._messageBuilder.buildTerminateMeetingRequest(e);return this._sendMessage(e,"success")},e.prototype.requestToBecomeModerator=function(e,t){t=this._messageBuilder.buildStartModerationRequest(e,t);return this._sendMessage(t,"success")},e.prototype.signIn=function(e,t){t=this._messageBuilder.buildUpdateCredentialsTokenRequest(e,t);return this._sendMessage(t,"success")},e.prototype.videoPin=function(e,t,i,a,r,s){s=this._messageBuilder.buildVideoPinRequest(e,t,i,a,r,s);return this._sendMessage(s,"success")},e.prototype.extendMeeting=function(e,t){t=this._messageBuilder.buildExtendMeetingRequest(e,t);return this._sendMessage(t,"success")},e.prototype.addParticipant=function(e,t){t=this._messageBuilder.buildDialoutRequest(e,t);return this._sendMessage(t,n.Services.Conference.DialoutStatus.DIALING)},e.prototype.cancelDialoutParticipant=function(e,t){t=this._messageBuilder.buildCancelDialoutRequest(e,t);return this._sendMessage(t,"success")},e.prototype.sendChatMessage=function(e,t,i){i=this._messageBuilder.buildSendChatMessage(e,t,i);return this._sendMessage(i,"success")},e.prototype.setVideoLayout=function(e,t){t=this._messageBuilder.buildChangeLayoutGeometryRequest(e,t);return this._sendMessage(t,"success")},e.prototype.setVideoLayoutSelfSee=function(e,t){t=this._messageBuilder.buildChangeLayoutNoSelfSeeRequest(e,!t);return this._sendMessage(t,"success")},e.prototype.setVideoLayoutTextOverlay=function(e,t){t=this._messageBuilder.buildChangeLayoutTextOverlayRequest(e,t);return this._sendMessage(t,"success")},e.prototype.getCurrentVideoLayout=function(e){e=this._messageBuilder.buildCurrentLayoutRequest(e);return this._sendMessage(e,"success")},e.prototype.raiseLowerHand=function(e,t){t=this._messageBuilder.buildRaiseHandRequest(e,t);return this._sendMessage(t,"success")},e.prototype.moderatorLowerHand=function(e,t,i){i=this._messageBuilder.buildModeratorLowerHandRequest(e,t,i);return this._sendMessage(i,"success")},e.prototype.moderatorAdmission=function(e,t,i){i=this._messageBuilder.buildModeratorAdmissionRequest(e,t,i);return this._sendMessage(i,"success")},e.prototype.sendAdmissionRequest=function(e,t){var i=S.Deferred(),t=this._messageBuilder.buildAdmissionRequest(e,t);return this._sendMessage(t,[n.Services.Conference.AdmissionResponseCode.SUCCESS,n.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_TRY_AGAIN,n.Services.Conference.AdmissionResponseCode.PENDING_APPROVAL,n.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_DISCONNECTING,n.Services.Conference.AdmissionResponseCode.REJECTED]).then(function(e){this._resolveAdmissionResponse(i,e)}.bind(this),function(e){i.reject(e)}),this.on(n.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE,function(e){this._resolveAdmissionResponse(i,e)}.bind(this)),i.promise()},e.prototype._resolveAdmissionResponse=function(e,t){switch(t.responseCode){case n.Services.Conference.AdmissionResponseCode.SUCCESS:e.resolve(t);break;case n.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_DISCONNECTING:case n.Services.Conference.AdmissionResponseCode.REJECTED:case n.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_TRY_AGAIN:e.reject({name:"UCCPServerError",code:t.responseCode,message:"UCCP server responded with "+t.responseCode});break;case n.Services.Conference.AdmissionResponseCode.PENDING_APPROVAL:break;default:n.Base.Logger.warn(n.Base.LoggerTags.UCCP_CONFERENCE_PROVIDER,"Unknown response code received: {0}",t.responseCode)}},e.prototype.getDialInInfo=function(e){e=this._messageBuilder.buildDialInInfoRequest(e);return this._sendMessage(e,"success")},e.prototype._sendMessage=function(e,t){var i,a=S.Deferred(),r=this._networkProvider._communicationAdapter instanceof n.Providers.UCCP.UCCPLongPollingProvider,s=n.Base.Utils.queryJSONObject(e,"params.transId");return r&&(i={dfd:a,successIndicator:t},this._networkProvider._communicationAdapter._responsesData[s]=i),this._networkProvider.send(JSON.stringify(e)).then(function(e){r||this._resolveResponse(a,e,t)}.bind(this),function(e){r&&this._networkProvider._communicationAdapter._responsesData&&delete this._networkProvider._communicationAdapter._responsesData[s],a.reject(e)}.bind(this)),a.promise()},e.prototype._resolveResponse=function(t,e,i){var a,r;try{a=this._messageParser.parse(e)}catch(e){return void t.reject(e)}a&&a.responseCode&&(i.indexOf?-1<i.indexOf(a.responseCode):a.responseCode===i)?t.resolve(a):(r=400,e&&e.params&&e.params.responseCode&&(r=e.params.responseCode),-1<i.indexOf(r)?t.resolve(a):t.reject({name:"UCCPServerError",code:r,message:"UCCP server responded with "+r}))},e.prototype.changeParticipantName=function(e,t,i){i=this._messageBuilder.buildChangeParticipantNameRequest(e,t,i);return this._sendMessage(i,"success")},n.Providers.UCCP.AbstractUCCPProvider=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i){n.Providers.UCCP.AbstractUCCPProvider.call(this),this._networkProvider=e,this._config=T,this._messageBuilder=t,this._messageParser=i,this._networkRequestRetryHelper=T,this._reconnectCount=0,this._isReconnecting=!1,this._isStarted=!1,this._fallbackPromise=T,this._handleReconnectRetryInterval=1e3,this._handleReconnectRetryFactor=1.2,this._blackListedWords=["text","lecturerName","presenterName","participantName","videoPin","participantDisplayName","meetingName","virtualRoomName","userId","callerId","login","virtualRoomOwnerId","email","userId","userID","pin","passcode","dialInInformation","dialInInformationHtml",'[{"params":"name"}]'],this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var e=n.Base.Utils.makeId(32,"0123456789abcdef");this._failoverPingData.wsPingMessageRequestId=e;e=this._messageBuilder.buildKeepaliveRequest(e);return JSON.stringify(e)}.bind(this),wsIsPongMessage:function(e){return!!(e="string"==typeof e?JSON.parse(e):e).name&&e.name===n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_RESPONSE&&this._failoverPingData.wsPingMessageRequestId===e.params.transId}.bind(this),wsIsPingMessage:function(e){return!!(e="string"==typeof e?JSON.parse(e):e).name&&e.name===n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3}}(e.prototype=Object.create(n.Providers.UCCP.AbstractUCCPProvider.prototype)).start=function(e,t){this._config=e;var i=S.Deferred();this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._networkProvider.onOpen=function(){this._networkProvider.onClose=function(){i.reject()},this._networkProvider.isOpened()?(this._isReconnecting&&(this._isReconnecting=!1,this.handleAfterReconnect(t)),this._isStarted=!0,i.resolve()):this._waitForSocketConnection(this._networkProvider,function(){this._isReconnecting&&(this._isReconnecting=!1,this.handleAfterReconnect(t)),this._isStarted=!0,i.resolve()}.bind(this),function(e){i.reject("Failed to open")}.bind(this))}.bind(this),this._networkProvider.onClose=function(){i.reject()},this._networkProvider.onMessage=function(e){var e=e.data?JSON.parse(e.data):JSON.parse(e),t=this._messageParser.parse(e);t instanceof n.Providers.UCCP.UCCPMessage&&(n.Base.Logger.debug(n.Base.LoggerTags.UCCP_CONFERENCE_PROVIDER,"Received message "+t.name),setTimeout(function(){this.trigger(t.name,[t])}.bind(this),0))}.bind(this);var a=e.networkProviderConfiguration.webSocketConfig,r={urlSuffix:a.path,transactionIDLocation:"params.transId"};n.Base.Utils.queryJSONObject(e,"networkProviderConfiguration.webSocketConfig.query")&&-1<a.query.indexOf("ticket=")&&(r.alreadyApplied=!0);a=new n.Config.ServerInfo(a.hostName,a.port,a.isSecure,a.path.replace(/ws$/,"rest"),"",a.query);e.networkProviderConfiguration.restConfig=a;var s=function(){return this._isReconnecting||t._conferenceService._isDisconnecting?S.Deferred().resolve().promise():(this._isReconnecting=!0,this.trigger(n.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_UNAVAILABLE),this._handleReconnect().then(function(){this._isReconnecting=!1,this.handleAfterReconnect()}.bind(this)))}.bind(this);return this._networkRequestRetryHelper=new n.Base.NetworkRequestRetryHelper(function(){return this._networkProvider.start(e.networkProviderConfiguration,e.credentialProvider,r,this._networkRequestRetryHelper,s,this._failoverPingData)}.bind(this)),this._networkProvider.on(n.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(n.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._networkProvider.on(n.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(n.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this.on(n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,function(e){this._sendKeepAliveResponse(e)}.bind(this)),this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.start(e.networkProviderConfiguration,e.credentialProvider,r,this._networkRequestRetryHelper,s,this._failoverPingData),i.promise()},e.prototype._sendKeepAliveResponse=function(e){e=this._messageBuilder.buildKeepAliveResponse(e.transId);this._networkProvider.send(JSON.stringify(e),T,T,!0)},e.prototype._waitForSocketConnection=function(t,i,a){var r=function(e){e<10?setTimeout(function(){t.isOpened()?i():r(e+1)}.bind(this),100):a("Max retry reached")};r(0)},e.prototype._handleReconnect=function(){var e=this._networkRequestRetryHelper.getRetryCallback();return this._fallbackPromise=n.Base.Utils.connectionBackoffAlgorithm(e,T,this._handleReconnectRetryInterval,this._handleReconnectRetryFactor),this._fallbackPromise.dfdPromise.state()===n.Base.DeferredStates.PENDING?S.Deferred().reject().promise():this._fallbackPromise.dfdPromise},e.prototype.handleAfterReconnect=function(){this._fallbackPromise=T,this.trigger(n.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_AVAILABLE)},e.prototype.stop=function(){this._isStarted=!1,this._removeListeners(),n.Base.Utils.isDefined(this._fallbackPromise)&&this._fallbackPromise.cancel();var t=S.Deferred();return this._networkProvider.onClose=function(){t.resolve()},this._networkProvider.onError=function(e){t.reject(e)},this._networkProvider.close(),t.promise()},n.Providers.UCCP.UCCP1Provider=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.UCCP.AbstractUCCPProvider.call(this),this._config=T,this._providers=[],this._selectedProvider=T}(t.prototype=Object.create(e.Providers.UCCP.AbstractUCCPProvider.prototype)).start=function(e,t){return S.isEmptyObject(e)||this._config===e||(this._config=e),this._selectedProvider=this._determineServerVersion(),this._selectedProvider.start(e,t)},t.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():S.Deferred().reject(new e.Services.Conference.ConferenceException(e.Services.Conference.ConferenceError.PROVIDER_UNAVAILABLE,"UUCPProvider")).promise()},t.prototype._determineServerVersion=function(){return this._providers[0].provider},t.prototype.getSelectedProvider=function(){return this._selectedProvider},t.prototype.registerUCCPProvider=function(e,t){return this._providers.push({version:e,provider:t})},t.prototype.sendHandshake=function(e){return this._selectedProvider.sendHandshake(e)},t.prototype.subscribeMeetingInfo=function(e){return this._selectedProvider.subscribeMeetingInfo(e)},t.prototype.startRecording=function(e,t,i){return this._selectedProvider.startRecording(e,t,i)},t.prototype.stopRecording=function(e){return this._selectedProvider.stopRecording(e)},t.prototype.pauseRecording=function(e){return this._selectedProvider.pauseRecording(e)},t.prototype.resumeRecording=function(e){return this._selectedProvider.resumeRecording(e)},t.prototype.subscribeRoster=function(e){return this._selectedProvider.subscribeRoster(e)},t.prototype.subscribeActiveTalker=function(e){return this._selectedProvider.subscribeActiveTalker(e)},t.prototype.subscribePermissions=function(e){return this._selectedProvider.subscribePermissions(e)},t.prototype.subscribeSlider=function(e){return this._selectedProvider.subscribeSlider(e)},t.prototype.subscribeMeetingNote=function(e){return this._selectedProvider.subscribeMeetingNote(e)},t.prototype.subscribeWebCollab=function(e){return this._selectedProvider.subscribeWebCollab(e)},t.prototype.subscribeAvailableLayouts=function(e){return this._selectedProvider.subscribeAvailableLayouts(e)},t.prototype.raiseHand=function(e){return this._selectedProvider.raiseHand(e)},t.prototype.setAsLecturer=function(e,t){return this._selectedProvider.setAsLecturer(e,t)},t.prototype.unsetAsLecturer=function(e){return this._selectedProvider.unsetAsLecturer(e)},t.prototype.disconnectParticipant=function(e,t){return this._selectedProvider.disconnectParticipant(e,t)},t.prototype.setLocked=function(e,t){return this._selectedProvider.setLocked(e,t)},t.prototype.setVideoLayout=function(e,t){return this._selectedProvider.setVideoLayout(e,t)},t.prototype.setVideoLayoutSelfSee=function(e,t){return this._selectedProvider.setVideoLayoutSelfSee(e,t)},t.prototype.setVideoLayoutTextOverlay=function(e,t){return this._selectedProvider.setVideoLayoutTextOverlay(e,t)},t.prototype.getCurrentVideoLayout=function(e){return this._selectedProvider.getCurrentVideoLayout(e)},t.prototype.muteUnmute=function(e,t,i,a){return this._selectedProvider.muteUnmute(e,t,i,a)},t.prototype.controlRemoteCamera=function(e,t,i){return this._selectedProvider.controlRemoteCamera(e,t,i)},t.prototype.muteUnmuteAll=function(e,t){return this._selectedProvider.muteUnmuteAll(e,t)},t.prototype.sendLocalMuteEvent=function(e,t,i){return this._selectedProvider.sendLocalMuteEvent(e,t,i)},t.prototype.sendDisconnectEvent=function(e,t){return this._selectedProvider.sendDisconnectEvent(e,t)},t.prototype.terminateConference=function(e){return this._selectedProvider.terminateConference(e)},t.prototype.requestToBecomeModerator=function(e,t){return this._selectedProvider.requestToBecomeModerator(e,t)},t.prototype.signIn=function(e,t){return this._selectedProvider.signIn(e,t)},t.prototype.videoPin=function(e,t,i,a,r,s){return this._selectedProvider.videoPin(e,t,i,a,r,s)},t.prototype.extendMeeting=function(e,t){return this._selectedProvider.extendMeeting(e,t)},t.prototype.addParticipant=function(e,t){return this._selectedProvider.addParticipant(e,t)},t.prototype.cancelDialoutParticipant=function(e,t){return this._selectedProvider.cancelDialoutParticipant(e,t)},t.prototype.sendChatMessage=function(e,t,i){return this._selectedProvider.sendChatMessage(e,t,i)},t.prototype.raiseLowerHand=function(e,t){return this._selectedProvider.raiseLowerHand(e,t)},t.prototype.moderatorLowerHand=function(e,t,i){return this._selectedProvider.moderatorLowerHand(e,t,i)},t.prototype.sendAdmissionRequest=function(e,t){return this._selectedProvider.sendAdmissionRequest(e,t)},t.prototype.moderatorAdmission=function(e,t,i){return this._selectedProvider.moderatorAdmission(e,t,i)},t.prototype.getDialInInfo=function(e){return this._selectedProvider.getDialInInfo(e)},t.prototype.changeParticipantName=function(e,t,i){return this._selectedProvider.changeParticipantName(e,t,i)},e.Providers.UCCP.UCCPProvider=t}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.Interfaces.CollaborationProvider.call(this),this._networkProvider=e,this._wcsEventsParser=t,this._wcsBinaryParser=i,this._wcsMessageBuilder=a,this._config={}}(e.prototype=Object.create(r.Providers.Interfaces.CollaborationProvider.prototype)).onCredentialsRequired=function(t,e){e&&e!==this._config.credentialProvider&&r.Base.Utils.deepMerge(this._config.credentialProvider,e),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(e){this.onCredentialsRetrieved(e,t)}.bind(this))},e.prototype.onCredentialsRetrieved=function(e,t){},e.prototype.addShape=function(e){},e.prototype.addCircle=function(e){},e.prototype.getParticipants=function(){},e.prototype.discoverResources=function(){},e.prototype.run=function(){},r.Providers.WCS.AbstractWCSProvider=e}(AvayaClientServices),function(d){"use strict";function e(e,t,i,a,r,s,n,o,c){d.Providers.WCS.AbstractWCSProvider.call(this,e,t,i,a),this._meetingId=T,this._wcsContentSharingHandler=r,this._wcsWhiteboardHandler=s,this._wcsSliderHandler=n,this._version="1.1",this._bytesReceivedLastSecond=0,this._notificationsProvider=o,this._resources=T,this._isWhiteboardActive=!1,this._isScreenSharingActive=!1,this._isVideoSharingActive=!1,this._notificationPromise=T,this._discoveryBackoffDataObject=T,this._discoveryConsecutiveFailures=-1,this._binaryProtocolVersion=2,this._isAcksActivated=!0,this._isCometNotificationProvider=!1,this._liveSessionNotFoundCounter=0,this._liveSessionNotFoundCounterComet=0,this._maximumLiveSessionRetries=6,this._permanentlyUnavaliable=!1,this._cometSequencingActive=!1,this._pendingBlocks=[],this._urlSuffixes={comet:{startLiveSession:"/wcsws/Comet/StartLiveSession",endLiveSession:"/wcsws/Comet/EndLiveSession",data:"/wcsws/Comet/Data"}},this._blackListedWords=["username","user_name","token","participant_id","meeting_id","fromname","sender_id","sender_name","sender_username","from"],this._failoverPingData={allowAnyPong:!0,wsKeepAliveEnabled:!0,wsPingInterval:25e3,wsGeneratePingMessage:function(){var e=d.Base.Utils.makeId(32,"0123456789abcdef");return"live_ping?request_id="+(this._failoverPingData.wsPingMessageRequestId=e)+"&ws_connection_id="+this._wsConnectionId}.bind(this),wsIsPongMessage:function(e){var t=d.Base.Utils.queryJSONObject(e,"response[0].live_ping[0]"),i=d.Base.Utils.queryJSONObject(e,"response[0].live_ping[0].request_id[0]._text"),e=d.Base.Utils.queryJSONObject(e,"response[0].live_ping[0].ws_connection_id[0]._text");return d.Base.Utils.isDefined(t)&&this._failoverPingData.wsPingMessageRequestId===i&&this._wsConnectionId===e}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:2e4},this._isShutdown=!1,this._wsConnectionId="",this._supportedFeatures={},this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.LIBRARY]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.POLLING]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.MINUTES]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.WHITEBOARD]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.MESSAGES]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.REPORTS]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.SLIDER]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.REMOTE_CONTROL]=!1,this._supportedFeatures[d.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING]=!0,this._colaborationsAnalyticsService=c,this._serverCapabilities={},this._resourceDiscoveryRetryInterval=1e3,this._resourceDiscoveryRetryFactor=1.2,this._isScreenSharingEnding=!1,this.binaryPromises=[]}(e.prototype=Object.create(d.Providers.WCS.AbstractWCSProvider.prototype)).start=function(e,t){var i=S.Deferred();return this._isShutdown=!1,this._config=e,this._meetingId=t,this._credentials=T,this._participant=T,this._pendingBlocks=[],this._networkProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._networkProvider.onOpen=function(){i.resolve()},this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.disableOptionsLogging(!0),this._networkProvider.start(e.networkProviderConfiguration,e.credentialProvider),this._liveSessionNotFoundCounter=0,this._liveSessionNotFoundCounterComet=0,this._cometSequencingActive=!1,i.promise()},e.prototype.stop=function(){var t=S.Deferred();return this._isShutdown=!0,this._discoveryConsecutiveFailures=-1,d.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=T),this._notificationsProvider.onClose=function(){this._colaborationsAnalyticsService.sendStopEvent(!0),d.Base.Logger.info(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS provider stopped"),t.resolve()}.bind(this),this._notificationsProvider.onError=function(e){this._colaborationsAnalyticsService.sendStopEvent(!1),this._colaborationsAnalyticsService.sendFailureStopEvent(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_STOP_FAILURE),d.Base.Logger.info(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error while stopping WCS provider",e),t.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_STOP_FAILURE,e))}.bind(this),this._notificationsProvider.close(),t.promise()},e.prototype.pause=function(){var e,t=this._wcsMessageBuilder.buildPauseMessage(),i=S.Deferred();return this._isCometNotificationProvider&&(e={urlSuffix:this._getCometDataUrlSuffix()}),this._notificationsProvider.send(t,e),i.resolve(),i.promise()},e.prototype.resume=function(){var e,t=this._wcsMessageBuilder.buildResumeMessage(),i=S.Deferred();return this._isCometNotificationProvider&&(e={urlSuffix:this._getCometDataUrlSuffix()}),this._notificationsProvider.send(t,e),i.resolve(),i.promise()},e.prototype._getFullUrlSuffix=function(e){return this._config.networkProviderConfiguration.restConfig&&this._config.networkProviderConfiguration.restConfig.path?this._config.networkProviderConfiguration.restConfig.path+e:e},e.prototype._getCometDataUrlSuffix=function(){return this._getFullUrlSuffix(this._urlSuffixes.comet.data)},e.prototype._sendLiveSession=function(){var e=Date.now(),t={urlSuffix:this._getFullUrlSuffix(this._urlSuffixes.comet.startLiveSession)},i=d.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789"),i="live_session?token="+this._credentials.token+"&brand="+this._resources.brandId+"&meeting_id="+this._meetingId+"&participant_id="+this._credentials.participantId+"&username="+this._credentials.username+"&last_event_offset=0&local_time="+e+"&ejected=false&session_id="+this._credentials.sessionId+"&remote_control_enabled=false&private_chat_enabled=true&user_agent="+navigator.userAgent+"&client_version=PC;WebCollab;local_version&binary_protocol="+this._binaryProtocolVersion+"&request_id="+i;return this._notificationsProvider.send(i,t)},e.prototype._onCredentialsRequired=function(e,t,i){d.Base.Utils.isUndefined(this._credentials)&&(i&&i!==this._config.credentialProvider&&d.Base.Utils.deepMerge(this._config.credentialProvider,i),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(e){this._onCredentialsRetrieved(e,t)}.bind(this)))},e.prototype._onCredentialsRetrieved=function(e,t){this._credentials=e},e.prototype.observeCollaboration=function(l){this._networkProvider.on(d.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(d.Base.Utils.isUndefined(l._isAvailable)||l._isAvailable)&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable))}.bind(this)),this._notificationsProvider.on(d.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(d.Base.Utils.isUndefined(l._isAvailable)||l._isAvailable)&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable))}.bind(this)),this._notificationsProvider.on(d.Base.NetworkProviderEvents.AUTHORIZED,function(){!d.Base.Utils.isUndefined(l._isAvailable)&&l._isAvailable||(l._isAvailable=!0,l._onCollaborationServiceAvailableCallbacks.fire(l))}.bind(this)),this._networkProvider.on(d.Base.NetworkProviderEvents.AUTHORIZED,function(){!d.Base.Utils.isUndefined(l._isAvailable)&&l._isAvailable||(l._isAvailable=!0,l._onCollaborationServiceAvailableCallbacks.fire(l))}.bind(this));var e={urlSuffix:this._getCometDataUrlSuffix(),cometSequencing:this._cometSequencingActive};this._notificationsProvider.run(e),this._notificationsProvider.wsConnectionId=this._wsConnectionId,this._notificationsProvider.onMessage=function(e){var t=[];if(e.data instanceof ArrayBuffer)this._updateReceivingBitrate(e.data.byteLength),t.push(this._wcsBinaryParser.parse(e.data));else for(var i=this._wcsEventsParser.parse(e.data),a=i.length,r=0;r<a;r++)t.push(i[r]);for(var s,n,o=t.length,c=0;c<o;c++)this._delegateEvent(t[c],l);l._collaborationService.wasScreenSharingInterrupted()&&(s=l._collaborationService.getInterruptedSharingType(),n=l._collaborationService.getInterruptedSharingStream(),setTimeout(function(){!1===l.getContentSharing().isContentSharingActive()&&!1===this.isWhiteboardActive()&&(s===d.Services.Collaboration.ContentSharingType.ANY_TYPE?(this._isScreenSharingActive=!1,l.getContentSharing()._contentSharingService.startScreenSharingAnyType(l.getContentSharing(),n)):s===d.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING?l.getContentSharing()._contentSharingService.startSharingApplicationWindow(l.getContentSharing(),T,n):s===d.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING?l.getContentSharing()._contentSharingService.startScreenSharingFullScreen(l.getContentSharing(),T,n):s===d.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&l.getContentSharing()._contentSharingService.restartScreenSharingUsingVideo(l.getContentSharing(),n))}.bind(this)),l._collaborationService._resetInterruptedSharing())}.bind(this)},e.prototype.startDrawShape=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildStartDrawShapeMessage(e,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,i).then(this._getEventIdFromResponse.bind(this))},e.prototype._discoverResourcesFnc=function(){var e=this._wcsMessageBuilder.buildResourceDiscoveryMessage(this._credentials.mode,this._meetingId,this._credentials.participantId,this._credentials.username,this._credentials.token),t={urlSuffix:this._getFullUrlSuffix("/viewer/rest/live_viewer/"),method:"POST"},t=this._networkProvider.send(e,t);return t.fail(function(){this._discoveryConsecutiveFailures++}.bind(this)),t},e.prototype.discoverResources=function(e){return this._discoveryConsecutiveFailures=-1,this._discoveryBackoffDataObject=d.Base.Utils.connectionBackoffAlgorithm(this._discoverResourcesFnc.bind(this),T,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor),this._discoveryBackoffDataObject.dfdPromise.then(this._parseResources.bind(this)).then(function(){return this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=T,this._startNotificationProvider(e)}.bind(this))},e.prototype._parseResources=function(e){e=this._wcsEventsParser.parse(e);return this._resources=e[0].data,this._resources},e.prototype._startNotificationProvider=function(l){var a=S.Deferred();this._notificationPromise||(this._notificationPromise=a),this._isCometNotificationProvider=this._notificationsProvider._communicationAdapter===this._notificationsProvider._fallbackProvider,this._notificationsProvider.onOpen=function(){this._sendLiveSession().done(function(e){if(e){this._discoveryConsecutiveFailures=-1,this._liveSessionNotFoundCounterComet=0,d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].cometSendData")&&(this._cometSequencingActive=!0);var t,i,a,r=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].live_attendee[0].attendee_id[0]._text");r&&(t=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].live_attendee[0].user_name[0]._text"),c=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].live_attendee[0].presenter[0]._text"),i=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].server_time_diff[0]._text"),void 0===(a=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].binary_protocol[0]._text"))||a<this._binaryProtocolVersion?this._isAcksActivated=!1:this._isAcksActivated=!0,this._participant=new d.Services.Collaboration.Participant(r,t),i&&(this._participant._joinTime+=i),this._participant._presenter=c),this._wsConnectionId=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].ws_connection_id[0]._text"),d.Base.Logger.info(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Socket open. wsConnId: "+this._wsConnectionId);for(var s=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].features[0].feature"),n=s.length-1;0<=n;n--){var o=d.Base.Utils.queryJSONObject(s[n],"type[0]._text");d.Base.Utils.isDefined(d.Services.Collaboration.FeaturesAvailable[o])&&(this._supportedFeatures[o]=d.Base.Utils.queryJSONObject(s[n],"enabled[0]._text"))}var c=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].suggested_screensharing_quality[0]._text");c&&l.getContentSharing()._setImageQuality(c);c=d.Base.Utils.queryJSONObject(e,"response[0].live_session[0].max_upload_speed[0]._text");c&&l.getContentSharing()._setMaxUploadSpeed(c),this._notificationPromise&&(this._notificationPromise.resolve(this._participant),this._notificationPromise=T),l._isAvailable||(l._isAvailable=!0,l.isReceivingSharingPaused()&&l.pause(),(c=(e=l.getSlider()).getSlides()).length&&(e._removeSlides(),e._onSlidesRemovedCallbacks.fire(c)),l._onCollaborationServiceAvailableCallbacks.fire(l))}}.bind(this)).fail(function(e){a.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,e)),l._isAvailable&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable))}.bind(this))}.bind(this),this._notificationsProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._notificationsProvider.onClose=function(){this._isShutdown||(l._isAvailable&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable)),this._notificationPromise&&(this._notificationPromise.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED)),this._notificationPromise=T)),d.Base.Logger.info(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Socket was closed. wsConnId: "+this._wsConnectionId)}.bind(this),this._notificationsProvider.onError=function(e){d.Base.Logger.info(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error on socket: ",e),a.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,e)),e._data&&404===e._data._status&&(this._liveSessionNotFoundCounterComet++,this._liveSessionNotFoundCounterComet>this._maximumLiveSessionRetries&&this.stopCollaborationAndShutDown()),l._isAvailable&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable))}.bind(this),this._notificationsProvider.onMessage=function(e){var t,i;e.data?(t=S.parseXML(e.data),t=(i=S(t)).find("code").text(),i=i.find("message").text(),t&&(this._discoveryConsecutiveFailures++,d.Base.Logger.error(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS live session response error:",t,i),a.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,i)),"404"===t&&(this._liveSessionNotFoundCounter++,this._liveSessionNotFoundCounter>=this._maximumLiveSessionRetries&&this.stopCollaborationAndShutDown()),l._isAvailable&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable)))):d.Base.Logger.warn(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS sent some events before the live session response:",e,"These events will not be parsed.")}.bind(this),this.stopCollaborationAndShutDown=function(){this._permanentlyUnavaliable=!0,this.stop(),l.stop(),l._onCollaborationServiceUnavailableCallbacks.fire(l,this._permanentlyUnavaliable),d.Base.Logger.error(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS live session reconnect maximum retries has been reached")}.bind(this);var e=new d.Config.ServerInfo(this._config.networkProviderConfiguration.restConfig.hostName,this._config.networkProviderConfiguration.restConfig.port,this._config.networkProviderConfiguration.restConfig.isSecure),t=new d.Config.ServerInfo(this._config.networkProviderConfiguration.restConfig.hostName,this._config.networkProviderConfiguration.restConfig.port,this._config.networkProviderConfiguration.restConfig.isSecure,this._getFullUrlSuffix("/"+this._resources.websocketPath)),i=function(){var t=S.Deferred();if(l._isStopped||this._isShutdown)return t.resolve().promise();l._isAvailable&&(l._isAvailable=!1,l._onCollaborationServiceUnavailableCallbacks.fire(l)),this._discoveryBackoffDataObject&&this._discoveryBackoffDataObject.cancel();var e=-1;return this._isCometNotificationProvider&&(e=++this._discoveryConsecutiveFailures),this._discoveryBackoffDataObject=d.Base.Utils.connectionBackoffAlgorithm(this._discoverResourcesFnc.bind(this),T,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor,e),this._discoveryBackoffDataObject.dfdPromise.then(this._parseResources.bind(this)).then(function(){return this._discoveryBackoffDataObject=T,this._startNotificationProvider(l).then(function(e){l._setSelfParticipant(e),this.observeCollaboration(l),this._recalculateCollaborationCapabilities(l),t.resolve()}.bind(this),function(e){t.reject(e)}.bind(this))}.bind(this)),t.promise()}.bind(this),t=new d.Config.NetworkProviderConfiguration(e,t);return this._notificationsProvider.registerBlackList(this._blackListedWords),this._notificationsProvider.disableOptionsLogging(!0),this._notificationsProvider.start(t,this._config.credentialProvider,T,T,i,this._failoverPingData).fail(function(){this._notificationPromise.reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED)),this._notificationPromise=T}.bind(this)),a.promise()},e.prototype.liveDrawShape=function(e,t){var i,a={urlSuffix:this._getCometDataUrlSuffix()},r=e._getPointsToSend();return r&&r[0]&&r[0].isMove?(i=this._wcsMessageBuilder.buildFirstPointLiveDrawShapeMessage(r[0].point,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),e._markPointsAsSent(1)):(i=this._wcsMessageBuilder.buildLiveDrawShapeMessage(r,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),e._markPointsAsSent(e.getPoints().length)),this._notificationsProvider.send(i,a).then(this._getEventIdFromResponse.bind(this))},e.prototype.endDrawShape=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildEndDrawShapeMessage(e,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,i).then(this._getEventIdFromResponse.bind(this))},e.prototype.addShape=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildDrawShapeMessage(e,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,i).then(this._getEventIdFromResponse.bind(this))},e.prototype.moveSelection=function(e,t,i){var a={urlSuffix:this._getCometDataUrlSuffix()},i=this._wcsMessageBuilder.buildMoveSelectionMessage(e,t,i.getX(),i.getY(),this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(i,a).then(this._getEventIdFromResponse.bind(this))},e.prototype._updateReceivingBitrate=function(e){this._bytesReceivedLastSecond+=e,setTimeout(function(){this._bytesReceivedLastSecond-=e}.bind(this),1e3)},e.prototype.getReceivingBitrate=function(){return 8*this._bytesReceivedLastSecond},e.prototype.addCircle=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildDrawCircleMessage(e,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,i).then(this._getEventIdFromResponse.bind(this))},e.prototype.addText=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildDrawTextMessage(e,t,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,i).then(this._getEventIdFromResponse.bind(this))},e.prototype.startScreenSharing=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildStartScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isWhiteboardActive?this.endWhiteboard().then(function(){return this._notificationsProvider.send(t,e)}.bind(this)):this._isVideoSharingActive?this.stopVideoSharing().then(function(){return this._notificationsProvider.send(t,e)}.bind(this)):this._notificationsProvider.send(t,e)},e.prototype.stopScreenSharing=function(){var e,t={urlSuffix:this._getCometDataUrlSuffix()};return this._isScreenSharingActive?(e=this._wcsMessageBuilder.buildStopScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),this._isScreenSharingEnding=!0,this._notificationsProvider.send(e,t)):this._isVideoSharingActive?(e=this._wcsMessageBuilder.buildStopVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),this._isVideoSharingEnding=!0,this._notificationsProvider.send(e,t)):S.Deferred().reject(new d.Services.Collaboration.CollaborationError(d.Services.Collaboration.CollaborationErrorReason.SHARING_INACTIVE)).promise()},e.prototype.startVideoSharing=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildStartVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isWhiteboardActive?this.endWhiteboard().then(function(){return this._notificationsProvider.send(t,e)}.bind(this)):this._isScreenSharingActive?this.stopScreenSharing().then(function(){return this._notificationsProvider.send(t,e)}.bind(this)):this._notificationsProvider.send(t,e)},e.prototype.stopVideoSharing=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildStopVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isVideoSharingEnding=!0,this._notificationsProvider.send(t,e)},e.prototype.pauseScreenSharing=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildPauseScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,e)},e.prototype.sendLiveEvent=function(e){var t={urlSuffix:this._getCometDataUrlSuffix()},e=this._wcsMessageBuilder.buildLiveEventMessage(e,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(e,t)},e.prototype.sendBlocks=function(e,t){var i={urlSuffix:this._getCometDataUrlSuffix()};if(this._isScreenSharingActive){if(this._isCometNotificationProvider||!this._isAcksActivated)return this._notificationsProvider.send(e,i);var a=S.Deferred();return this.binaryPromises[t]=a,this._notificationsProvider.send(e,i),a}a={};return t?(a.message=e,a.messageId=t):a.message=e,this._pendingBlocks.push(a),S.Deferred().resolve().promise()},e.prototype.getBufferedAmount=function(){return this._notificationsProvider.getBufferedAmount()},e.prototype.startWhiteboard=function(e){var t={urlSuffix:this._getCometDataUrlSuffix()},i=this._wcsMessageBuilder.buildStartWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName(),e);return this._isScreenSharingActive?this.stopScreenSharing().then(function(){return this._notificationsProvider.send(i,t)}.bind(this)):this._isVideoSharingActive?this.stopVideoSharing().then(function(){return this._notificationsProvider.send(i,t)}.bind(this)):this._notificationsProvider.send(i,t)},e.prototype.endWhiteboard=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildEndWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,e)},e.prototype.addWhiteboardSurface=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildAddWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(t,e)},e.prototype.removeWhiteboardSurface=function(e){var t={urlSuffix:this._getCometDataUrlSuffix()},e=this._wcsMessageBuilder.buildRemoveWhiteboardMessage(e,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(e,t)},e.prototype.removeShape=function(e,t,i){var a={urlSuffix:this._getCometDataUrlSuffix()},i=this._wcsMessageBuilder.buildDeleteSelectionMessage(e,t,i.getX(),i.getY(),this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(i,a)},e.prototype.clearContent=function(e){var t={urlSuffix:this._getCometDataUrlSuffix()},e=this._wcsMessageBuilder.buildClearContentMessage(e,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(e,t)},e.prototype.getParticipants=function(){var e={urlSuffix:this._getCometDataUrlSuffix()},t=this._wcsMessageBuilder.buildGetParticipantsMessage(!1);return this._notificationsProvider.send(t,e).then(function(e){for(var t=[],i=this._wcsEventsParser.parse(e),a=0;a<i[0].data.liveAttendees.length;a++){var r=d.Base.Utils.queryJSONObject(i[0],"data.liveAttendees["+a+"].attendeeId"),s=d.Base.Utils.queryJSONObject(i[0],"data.liveAttendees["+a+"].userName");t.push(new d.Services.Collaboration.Participant(r,s))}return t}.bind(this))},e.prototype.updateMaxDownload=function(e){var t={urlSuffix:this._getCometDataUrlSuffix()},e=this._wcsMessageBuilder.buildMaxDownloadMessage(e);return this._notificationsProvider.send(e,t)},e.prototype.isOpened=function(){return this._notificationsProvider.isOpened()},e.prototype.isFeatureAvailable=function(e){return this._supportedFeatures[e]||!1},e.prototype.isWhiteboardActive=function(){return this._isWhiteboardActive},e.prototype._delegateEvent=function(e,t){var i;if(!d.Base.Utils.isUndefined(e)&&!d.Base.Utils.isUndefined(e.type))switch(e.type){case d.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG:this._wcsContentSharingHandler.updateCursor(t,e);break;case d.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:case d.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:case d.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:this._wcsContentSharingHandler.updateFrame(t,e);break;case d.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG:this.binaryPromises[e.messageId].resolve();break;case d.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING:i=this._wcsWhiteboardHandler._getParticipant(t,e),this._isWhiteboardActive&&(this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(t,e)),this._isVideoSharingActive&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharingByParticipant(t,i)),!this._isScreenSharingActive||i.isLocalUser()||t._contentSharing._isPaused||this._wcsContentSharingHandler.endScreenSharingByParticipant(t,i),this._isScreenSharingActive=!0,this._isScreenSharingEnding=!1,i&&this._participant&&i.getParticipantId()===this._participant.getParticipantId()&&this._sendPendingBlocks(),this._wcsContentSharingHandler.startScreenSharing(t,e);break;case d.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING:this._wcsContentSharingHandler.pauseScreenSharing(t,e);break;case d.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING:this._isScreenSharingActive&&(this._isScreenSharingEnding||e.from!==t._selfParticipant._participantId&&!e.isServerInitiated())&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharing(t,e));break;case d.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING:i=this._wcsWhiteboardHandler._getParticipant(t,e),this._isWhiteboardActive&&(this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(t,e)),this._isScreenSharingActive&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharingByParticipant(t,i)),this._isVideoSharingActive&&!i.isLocalUser()&&this._wcsContentSharingHandler.endVideoSharingByParticipant(t,i),this._isVideoSharingActive=!0,this._isVideoSharingEnding=!1,this._wcsContentSharingHandler.startVideoSharing(t,e);break;case d.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING:this._isVideoSharingActive&&(this._isVideoSharingEnding||e.from!==t._selfParticipant._participantId&&!e.isServerInitiated())&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharing(t,e));break;case d.Providers.WCS.WCSEventTypes.FRAME_REPORT:this._wcsContentSharingHandler.frameReport(t,e);break;case d.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES:this._serverCapabilities=e.data,this.trigger(d.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,[e.data]);break;case d.Providers.WCS.WCSEventTypes.START_WHITEBOARD:i=this._wcsWhiteboardHandler._getParticipant(t,e),this._isScreenSharingActive&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharingByParticipant(t,i)),this._isVideoSharingActive&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharingByParticipant(t,i)),this._isWhiteboardActive=!0,this._wcsWhiteboardHandler.startWhiteboard(t,e);break;case d.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD:this._wcsWhiteboardHandler.addWhiteboard(t,e);break;case d.Providers.WCS.WCSEventTypes.END_WHITEBOARD:this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(t,e);break;case d.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD:this._wcsWhiteboardHandler.deleteWhiteboard(t,e);break;case d.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE:this._wcsWhiteboardHandler.startDrawShape(t,e);break;case d.Providers.WCS.WCSEventTypes.DRAW_SHAPE:this._wcsWhiteboardHandler.drawShape(t,e);break;case d.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE:this._wcsWhiteboardHandler.endDrawShape(t,e);break;case d.Providers.WCS.WCSEventTypes.DRAW_CIRCLE:this._wcsWhiteboardHandler.drawCircle(t,e);break;case d.Providers.WCS.WCSEventTypes.MOVE_SELECTION:this._wcsWhiteboardHandler.moveSelection(t,e);break;case d.Providers.WCS.WCSEventTypes.DRAW_TEXT:this._wcsWhiteboardHandler.drawText(t,e);break;case d.Providers.WCS.WCSEventTypes.DELETE_SELECTION:this._wcsWhiteboardHandler.deleteSelection(t,e);break;case d.Providers.WCS.WCSEventTypes.CLEAR_DRAWING:this._wcsWhiteboardHandler.clearDrawing(t,e);break;case d.Providers.WCS.WCSEventTypes.SLIDER_SLIDE:this._wcsSliderHandler.handleSliderSlide(t,e);break;case d.Providers.WCS.WCSEventTypes.SLIDER_EMPTY:this._wcsSliderHandler.handleSliderEmpty(t,e);break;case d.Providers.WCS.WCSEventTypes.END_MEETING:t._onCollaborationEndedCallbacks.fire(t),this._isShutdown||t.stop();break;case d.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT:e.data.targetId&&t._selfParticipant&&e.data.targetId===t._selfParticipant._participantId&&e.data.time>=t._selfParticipant._joinTime&&(t._onCollaborationNearEndByEjectCallbacks.fire(t),this._isShutdown||t.stop());break;case d.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING:e.data.targetId&&t._selfParticipant&&e.data.targetId===t._selfParticipant._participantId&&(t._selfParticipant._presenter=!0,this._recalculateCollaborationCapabilities(t));break;case d.Providers.WCS.WCSEventTypes.DENY_PRESENTING:e.data.targetId&&t._selfParticipant&&e.data.targetId===t._selfParticipant._participantId&&(t._selfParticipant._presenter=!1,this._recalculateCollaborationCapabilities(t));break;default:d.Base.Logger.warn(d.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown event type received: {0}",e.type)}},e.prototype._recalculateCollaborationCapabilities=function(e){e.getContentSharing()._recalculateShareApplicationWindowCapability(e),e.getContentSharing()._recalculateShareFullScreenCapability(e),e.getContentSharing()._recalculateShareAnyTypeCapability(e),e.getContentSharing()._recalculateShareContentVideoCapability(e),e._recalculateContentSharingCapability(e),e._recalculateWhiteboardCapability(e),e.getWhiteboard()._recalculateAddWhiteboardCapability(e),e.getWhiteboard()._recalculateRemoveWhiteboardCapability(e)},e.prototype._getEventIdFromResponse=function(e){return this._isCometNotificationProvider?e:d.Base.Utils.queryJSONObject(e,"response[0].live_event[0].event_id[0]._text")},e.prototype.getServerCapabilities=function(){return this._serverCapabilities},e.prototype._sendPendingBlocks=function(){for(var e=0;e<this._pendingBlocks.length;e++){var t=this._pendingBlocks[e];t.messageId?this.sendBlocks(t.message,t.messageId):this.sendBlocks(t.message)}this._pendingBlocks=[]},e.prototype.getAcksActivated=function(){return this._isAcksActivated},d.Providers.WCS.WCSv1_1Provider=e}(AvayaClientServices),function(e,t){"use strict";function i(){e.Base.TransactionalWebSocketProvider.apply(this,[e.Base.LoggerTags.WCS_COLLABORATION_PROVIDER]),this._transactionIDLocation="request_id"}(i.prototype=Object.create(e.Base.TransactionalWebSocketProvider.prototype)).getTransactionIDFromRequest=function(e,t){return!(void 0===e||e instanceof ArrayBuffer||e instanceof Blob)&&e.match(t+"=(\\w*)&?")[1]},i.prototype.getTransactionIDFromResponse=function(e,t){if(void 0===e)return!1;var i=this._getTransactionID(e,"response[0].live_session[0].request_id[0]._text"),a=this._getTransactionID(e,"response[0].live_event[0].request_id[0]._text"),r=this._getTransactionID(e,"response[0].live_attendees[0].request_id[0]._text"),e=this._getTransactionID(e,"response[0].live_ping[0].request_id[0]._text");return a||i||r||e},i.prototype.parseRequest=function(e){return e},i.prototype.parseResponse=function(e){return t.parseString(e)},e.Providers.WCS.WCSTransactionalWebSocketProvider=i}(AvayaClientServices,xmlToJSON),function(r){"use strict";function e(e,t,i,a){this._id=r.Base.Utils.makeId(10,"0123456789"),this._color=i,this._width=a,this._translation=T,this._status=r.Services.Collaboration.SelectionStatus.PENDING,this._isMine=t,this._ownerDisplayName=e,this._finished=!1}e.prototype={getId:function(){return this._id},setId:function(e){this._id=e},getColor:function(){return this._color},getWidth:function(){return this._width},getOwnerDisplayName:function(){return this._ownerDisplayName},getTranslation:function(){return this._translation},setTranslation:function(e){this._translation=e},getStatus:function(){return this._status},isMine:function(){return this._isMine},isFinished:function(){return this._finished},finishDrawing:function(){return this._finished=!0,S.when(this._finished)}},r.Base.AOPTools.addAdvices(e,"AbstractShape",["finishDrawing"],[r.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,r.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),r.Services.Collaboration.AbstractShape=e}(AvayaClientServices),function(c){"use strict";function e(e,t,i,a,r,s,n,o){c.Services.Collaboration.AbstractShape.call(this,i,r,s,o),this._topLeft=e,this._bottomRight=t,this._filled=a||!1,this._alpha=n||100}(e.prototype=Object.create(c.Services.Collaboration.AbstractShape.prototype)).getTopLeft=function(){return this._topLeft},e.prototype.setTopLeft=function(e){this._topLeft=e},e.prototype.getBottomRight=function(){return this._bottomRight},e.prototype.setBottomRight=function(e){this._bottomRight=e},e.prototype.isFilled=function(){return this._filled},e.prototype.getAlpha=function(){return this._alpha},c.Services.Collaboration.Circle=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r,s){n.Services.Collaboration.AbstractShape.call(this,e,i,a,s),this._filled=t||!1,this._finished=!1,this._sentPointsPos=0,this._points=[],this._alpha=r||100,this._onShapeFinished=T,this._readyToSendCallbacks=S.Callbacks(),this._throttlingInterval=100}(e.prototype=Object.create(n.Services.Collaboration.AbstractShape.prototype))._addPoint=function(e,t){var i=(new Date).getTime();this._points.push({isMove:e,point:t,_timestamp:i}),(0===this._getSentPointsCount()||i-this._points[this._getSentPointsCount()-1]._timestamp>this._throttlingInterval)&&this._readyToSendCallbacks.fire()},e.prototype.addMovePoint=function(e){this._addPoint(!0,e)},e.prototype.addLinePoint=function(e){this._addPoint(!1,e)},e.prototype.finishDrawing=function(){return this._finished=!0,n.Base.Utils.isDefined(this._onShapeFinished)?this._onShapeFinished():S.when(this._finished)},e.prototype.getPoints=function(){return this._points},e.prototype.updatePoints=function(e){for(var t=0;t<e.length;t++)this._points.push(e[t])},e.prototype.isFilled=function(){return this._filled},e.prototype.setFilled=function(e){this._filled=e},e.prototype._hasPointsToSend=function(){return this._sentPointsPos!==this._points.length},e.prototype._getPointsToSend=function(){return this._points.slice(this._sentPointsPos)},e.prototype._markPointsAsSent=function(e){this._sentPointsPos=e},e.prototype._getSentPointsCount=function(){return this._sentPointsPos},e.prototype.getAlpha=function(){return this._alpha},n.Base.AOPTools.addAdvices(e,"Shape",["addMovePoint","updatePoints"],[n.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),n.Base.AOPTools.addAdvices(e,"Shape",["finishDrawing"],[n.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,n.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),n.Services.Collaboration.Shape=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){o.Services.Collaboration.AbstractShape.call(this,i,r,s,n),this._content=e,this._filled=a||!1,this._fontSize=t,this._position=T}(e.prototype=Object.create(o.Services.Collaboration.AbstractShape.prototype)).getPosition=function(){return this._position},e.prototype.setPosition=function(e){this._position=e},e.prototype.getContent=function(){return this._content},e.prototype.getFontSize=function(){return this._fontSize},o.Services.Collaboration.WhiteboardText=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Conference.Participant.call(this,e,t),this._participantURI="",this._remoteDisplayName="",this._applicationActive=!1,this._handRaised=!1,this._presenter=!1,this._lecturer=!1,this._audioStatus=i.Services.Conference.ParticipantMediaState.MEDIA_STATUS_NO_MEDIA,this._videoStatus=i.Services.Conference.ParticipantMediaState.MEDIA_STATUS_NO_MEDIA,this._connectionStatus=i.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_UNKNOWN,this._disconnectionReason=T,this._audioId=T,this._videoId=T,this._lastSpokenTime=T,this._joinTime=T,this._lastSpokenTime=T,this._leaveTimeStamp=T,this._audioFromParticipant="",this._audioToParticipant="",this._userId="",this._sourceID="",this._feccRecvSupport=!1,this._videoFromParticipant="",this._videoToParticipant="",this._contentFromParticipant="",this._contentToParticipant="",this._canLecture=!1,this._role="",this._isVideoBlocked=!1,this._isAudioMuted=!1,this._isSelfParticipant=!1,this._wasPreviouslyNotVisibleInParticipantList=!1,this._status="",this._isConferenceOwner=!1,this._onParticipantCollaborationStatusChangedCallbacks=S.Callbacks(),this._onParticipantConnectionStatusChangedCallbacks=S.Callbacks(),this._onParticipantSetAsModeratorCallbacks=S.Callbacks(),this._onParticipantUnsetAsModeratorCallbacks=S.Callbacks(),this._onParticipantSetAsLecturerCallbacks=S.Callbacks(),this._onParticipantUnsetAsLecturerCallbacks=S.Callbacks(),this._onParticipantSetAsPresenterCallbacks=S.Callbacks(),this._onParticipantUnsetAsPresenterCallbacks=S.Callbacks(),this._onParticipantAudioStatusChangedCallbacks=S.Callbacks(),this._onParticipantVideoStatusChangedCallbacks=S.Callbacks(),this._onParticipantActiveTalkerStatusChangedCallbacks=S.Callbacks(),this._onParticipantHandRaisedCallbacks=S.Callbacks(),this._onParticipantHandLoweredCallbacks=S.Callbacks(),this._onParticipantDisplayNameChangedCallbacks=S.Callbacks(),this._onParticipantNameChangedCallbacks=S.Callbacks()}(e.prototype=Object.create(i.Services.Conference.Participant.prototype)).controlRemoteCamera=function(e){for(var t in i.Services.Conference.CameraControl)if(i.Services.Conference.CameraControl.hasOwnProperty(t)&&e===i.Services.Conference.CameraControl[t])return this._participantService.controlRemoteCamera(this,e);return S.Deferred().reject(new i.Services.Conference.ConferenceException(i.Services.Conference.ConferenceError.INVALID_ARGUMENT))},e.prototype.mute=function(){return this._participantService.mute(this)},e.prototype.unmute=function(){return this._participantService.unmute(this)},e.prototype.blockVideo=function(){return this._participantService.blockVideo(this)},e.prototype.unblockVideo=function(){return this._participantService.unblockVideo(this)},e.prototype.lowerHand=function(e){return this._participantService.lowerHand(this,e)},e.prototype.setAsLecturer=function(){return this._participantService.setAsLecturer(this)},e.prototype.unsetAsLecturer=function(){return this._participantService.unsetAsLecturer()},e.prototype.isHandRaised=function(){return this._handRaised},e.prototype.getJoinTime=function(){return this._joinTime},e.prototype.getLastSpokenTime=function(){return this._lastSpokenTime},e.prototype.isVideoBlocked=function(){return this._isVideoBlocked},e.prototype.isAudioMuted=function(){return this._isAudioMuted},e.prototype.isModerator=function(){return this._role===i.Services.Conference.ParticipantRole.MODERATOR},e.prototype.isRestrictedParticipant=function(){return this._role===i.Services.Conference.ParticipantRole.RESTRICTED_PARTICIPANT},e.prototype.wasPreviouslyNotVisibleInParticipantList=function(){return this._wasPreviouslyNotVisibleInParticipantList},e.prototype.getParticipantAudioStatus=function(){return this._audioFromParticipant},e.prototype.getParticipantVideoStatus=function(){return this._videoFromParticipant},e.prototype.isLecturer=function(){return this._lecturer},e.prototype.isPresenter=function(){return this._presenter},e.prototype.getFeccRecvSupport=function(){return this._feccRecvSupport},e.prototype.getContentToParticipant=function(){return this._contentToParticipant},e.prototype.getContentFromParticipant=function(){return this._contentFromParticipant},e.prototype.getParticipantConnectionStatus=function(){return this._connectionStatus},e.prototype.getRole=function(){return this._role},e.prototype.isConferenceOwner=function(){return this._isConferenceOwner},e.prototype.changeParticipantName=function(e){return this._participantService.changeParticipantName(this,e)},i.Base.AOPTools.addAdvices(e,"ActiveParticipant",["controlRemoteCamera","mute","unmute","blockVideo","unblockVideo","lowerHand","setAsLecturer","unsetAsLecturer"],[i.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),i.Services.Conference.ActiveParticipant=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Conference.ActiveParticipant.prototype,{addOnParticipantCollaborationStatusChangedCallback:function(e){this._onParticipantCollaborationStatusChangedCallbacks.add(e)},removeOnParticipantCollaborationStatusChangedCallback:function(e){this._onParticipantCollaborationStatusChangedCallbacks.remove(e)},addOnParticipantStatusChangedCallback:function(e){this._onParticipantStatusChangedCallbacks.add(e)},removeOnParticipantStatusChangedCallback:function(e){this._onParticipantStatusChangedCallbacks.remove(e)},addOnParticipantConnectionStatusChangedCallback:function(e){this._onParticipantConnectionStatusChangedCallbacks.add(e)},removeOnParticipantConnectionStatusChangedCallback:function(e){this._onParticipantConnectionStatusChangedCallbacks.remove(e)},addOnParticipantSetAsModeratorCallback:function(e){this._onParticipantSetAsModeratorCallbacks.add(e)},removeOnParticipantSetAsModeratorCallback:function(e){this._onParticipantSetAsModeratorCallbacks.remove(e)},addOnParticipantUnsetAsModeratorCallback:function(e){this._onParticipantUnsetAsModeratorCallbacks.add(e)},removeOnParticipantUnsetAsModeratorCallback:function(e){this._onParticipantUnsetAsModeratorCallbacks.remove(e)},addOnParticipantSetAsLecturerCallback:function(e){this._onParticipantSetAsLecturerCallbacks.add(e)},removeOnParticipantSetAsLecturerCallback:function(e){this._onParticipantSetAsLecturerCallbacks.remove(e)},addOnParticipantUnsetAsLecturerCallback:function(e){this._onParticipantUnsetAsLecturerCallbacks.add(e)},removeOnParticipantUnsetAsLecturerCallback:function(e){this._onParticipantUnsetAsLecturerCallbacks.remove(e)},addOnParticipantSetAsPresenterCallback:function(e){this._onParticipantSetAsPresenterCallbacks.add(e)},removeOnParticipantSetAsPresenterCallback:function(e){this._onParticipantSetAsPresenterCallbacks.remove(e)},addOnParticipantUnsetAsPresenterCallback:function(e){this._onParticipantUnsetAsPresenterCallbacks.add(e)},removeOnParticipantUnsetAsPresenterCallback:function(e){this._onParticipantUnsetAsPresenterCallbacks.remove(e)},addOnParticipantAudioStatusChangedCallback:function(e){this._onParticipantAudioStatusChangedCallbacks.add(e)},removeOnParticipantAudioStatusChangedCallback:function(e){this._onParticipantAudioStatusChangedCallbacks.remove(e)},addOnParticipantVideoStatusChangedCallback:function(e){this._onParticipantVideoStatusChangedCallbacks.add(e)},removeOnParticipantVideoStatusChangedCallback:function(e){this._onParticipantVideoStatusChangedCallbacks.remove(e)},addOnParticipantActiveTalkerStatusChangedCallback:function(e){this._onParticipantActiveTalkerStatusChangedCallbacks.add(e)},removeOnParticipantActiveTalkerStatusChangedCallback:function(e){this._onParticipantActiveTalkerStatusChangedCallbacks.remove(e)},addOnParticipantHandRaisedCallback:function(e){this._onParticipantHandRaisedCallbacks.add(e)},removeOnParticipantHandRaisedCallback:function(e){this._onParticipantHandRaisedCallbacks.remove(e)},addOnParticipantHandLoweredCallback:function(e){this._onParticipantHandLoweredCallbacks.add(e)},removeOnParticipantHandLoweredCallback:function(e){this._onParticipantHandLoweredCallbacks.remove(e)},addOnParticipantDisplayNameChangedCallback:function(e){this._onParticipantDisplayNameChangedCallbacks.add(e)},removeOnParticipantDisplayNameChangedCallback:function(e){this._onParticipantDisplayNameChangedCallbacks.remove(e)},addOnParticipantNameChangedCallback:function(e){this._onParticipantNameChangedCallbacks.add(e)},removeOnParticipantNameChangedCallback:function(e){this._onParticipantNameChangedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Conference.Participant.call(this,e,t)}(e.prototype=Object.create(i.Services.Conference.Participant.prototype)).reinvite=function(){},i.Base.AOPTools.addAdvices(e,"DroppedParticipant",["reinvite"],[i.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,i.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),i.Services.Conference.DroppedParticipant=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._escalationService=t,this.type=a.Services.Messaging.MessageType.SESSION,this.sessionType=T,this.participants=new a.Base.DataSet,this.extensions={},this._resourceStatus=a.Services.Messaging.ResourceStatus.DRAFT_UNSENT,a.Base.Utils.isDefined(e)&&(this.type=e.type,this.sessionType=e.sessionType,this.extensions=e.extensions,this.conversation=e.conversation),this._onTypeChangedCallbacks=S.Callbacks(),this._onStatusChangedCallbacks=S.Callbacks(),this._onSessionTypeChangedSuccessCallbacks=S.Callbacks(),this._onSessionTypeChangedFailedCallbacks=S.Callbacks(),this._onStartSuccessCallbacks=S.Callbacks(),this._onStartFailedCallbacks=S.Callbacks(),this._onMessagingEscalationCapabilitiesChangedCallbacks=S.Callbacks(),this._sendCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantsCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeParticipantsCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSessionTypeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),t._recalculateAllEscalationCapabilities(this)}e.prototype={getStatus:function(){return this._resourceStatus},getSessionType:function(){return this.sessionType},getConversation:function(){return this.conversation},setSessionType:function(e){var t,i=!1;for(t in a.Services.Messaging.SessionType)if(a.Services.Messaging.SessionType.hasOwnProperty(t)&&e===a.Services.Messaging.SessionType[t]){this._escalationService.setSessionType(this,e),i=!0;break}return i},addParticipants:function(e){this._escalationService.addParticipants(this,e)},removeParticipants:function(e){this._escalationService.removeParticipants(this,e)},getParticipants:function(){return this.participants},send:function(){return this._escalationService.start(this)},_setStatus:function(e){if(!a.Base.Utils.isDefined(a.Services.Messaging.ResourceStatus[e]))throw new Error("Unknown ResourceStatus");this._resourceStatus=e,this._onStatusChangedCallbacks.fire(this,e)}},a.Base.AOPTools.addAdvices(e,"Escalation",["addParticipants","removeParticipants"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),a.Base.AOPTools.addAdvices(e,"Escalation",["send"],[a.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),a.Services.Messaging.Escalation=e}(AvayaClientServices),function(e){"use strict";S.extend(e.Services.Messaging.Escalation.prototype,{addOnSessionTypeChangedCallback:function(e){this._onTypeChangedCallbacks.add(e)},removeOnSessionTypeChangedCallback:function(e){this._onTypeChangedCallbacks.remove(e)},addOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.add(e)},removeOnStatusChangedCallback:function(e){this._onStatusChangedCallbacks.remove(e)}})}(AvayaClientServices),function(i){"use strict";var e={getSendCapability:function(){return this._sendCapability},_recalculateStartCapability:function(){var e,t=this._escalationService.isServiceAvailable()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._sendCapability._updateIfChanged(e,t)},getAddParticipantsCapability:function(){return this._addParticipantsCapability},_recalculateAddParticipantsCapability:function(){var e,t=this._escalationService.isServiceAvailable()?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addParticipantsCapability._updateIfChanged(e,t)},getRemoveParticipantsCapability:function(){return this._removeParticipantsCapability},_recalculateRemoveParticipantsCapability:function(){var e,t=this._escalationService.isServiceAvailable()&&this._resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeParticipantsCapability._updateIfChanged(e,t)},getUpdateSessionTypeCapability:function(){return this._updateSessionTypeCapability},_recalculateUpdateSessionTypeCapability:function(){var e,t=this._escalationService.isServiceAvailable()&&this._resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateSessionTypeCapability._updateIfChanged(e,t)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var e,t=this._escalationService.isServiceAvailable()&&this._resourceStatus===i.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(e=!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(e=!1,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(e,t)}};S.extend(i.Services.Messaging.Escalation.prototype,e)}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.AMM.AMM3Provider.call(this,e,t,i,a),this._resourcesTypes.addressesToValidate="application/vnd.avaya.aem.addressesToValidate.v1+json",this._resourcesTypes.conversationsFilter="application/vnd.avaya.aem.conversationsFilter.v1+json"}(e.prototype=Object.create(r.Providers.AMM.AMM3Provider.prototype))._discoverResources=function(e){return S.Deferred(function(t){return r.Providers.AMM.AMM3Provider.prototype._discoverResources.call(this,e).then(function(e){this._isProviderSupported(e)?t.resolve(e):(e=new r.Base.BaseError("API in not supported, try different provider"),t.reject(e))}.bind(this),t.reject)}.bind(this))},e.prototype._isProviderSupported=function(e){var t=r.Base.Utils.queryJSONObject(e,"conversationsResource.requestTypes"),t=r.Base.Utils.isDefined(t)&&r.Base.Utils.includes(this._resourcesTypes.conversationsFilter,t),e=r.Base.Utils.queryJSONObject(e,"services.validateAddresses.requestTypes"),e=r.Base.Utils.isDefined(e)&&r.Base.Utils.includes(this._resourcesTypes.addressesToValidate,e);return t&&e},e.prototype.validateUsers=function(e){var t=JSON.stringify({addresses:e.map(function(e){return{address:e}})}),e=this._buildValidateUsersRequestOptions();return this._networkProvider.send(t,e).then(this._onValidateUsersRequestSent.bind(this),this._handleError.bind(this))},e.prototype._buildValidateUsersRequestOptions=function(){var e=r.Providers.AMM.AbstractAMMProvider.prototype._buildValidateUsersRequestOptions.call(this);return e.sendType="POST",e.headers["Content-Type"]=this._resourcesTypes.addressesToValidate,e},e.prototype.getConversations=function(e){var t=JSON.stringify({}),e=this._buildGetConversationsRequestOptions(e);return this._networkProvider.send(t,e).then(this._onGetConversationsRequestSent.bind(this),this._handleError.bind(this))},e.prototype._buildGetConversationsRequestOptions=function(e){e=r.Providers.AMM.AMM3Provider.prototype._buildGetConversationsRequestOptions.call(this,e);return e.sendType="POST",e.headers["Content-Type"]=this._resourcesTypes.conversationsFilter,e},e.prototype._getConversationsByIds=function(e,t){e=JSON.stringify({ids:e.map(function(e){return{id:e}})});return this._networkProvider.send(e,t).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},e.prototype._getConversationsByQuery=function(e,t){var i={searchString:e.q,searchSubject:e.subject,searchParticipants:e.participants,searchBody:e.body};e.after!==T&&(i.searchAfterDate=e.after);i=JSON.stringify(i);return r.Providers.AMM.AMM3Provider.prototype._getConversationsByQuery.call(this,i,t)},r.Providers.AMM.AMM3_2Provider=e}(AvayaClientServices),function(e){"use strict";var c=e.Base.Utils,l=e.Providers.Analytics.AnalyticsStatistic,d="ec",C="ea",u="el",h="ev";e.Providers.Analytics.AnalyticsEventStatistic={send:function(e,t,i,a,r){var s;l.isCollectionEnabled()&&(s=this._getEventParams.apply(this,arguments),l.addHit(s))},_getEventParams:function(e,t,i,a,r){var s=l.addHitTypeParameter("event"),n=[[d,e],[C,t]];i&&n.push([u,i]),c.isInteger(a)&&n.push([h,a]);for(var o=0;o<n.length;o++)s+=l.addURIParam(n[o][0],n[o][1]);return s+=l.addCustomDimensionsParameters(r)}}}(AvayaClientServices),function(e){"use strict";var r=e.Providers.Analytics.AnalyticsEventStatistic,s=e.Providers.Analytics.AnalyticsTimingStatistic;function t(){this._category=T,this._customDimensions=T,this._init()}t.prototype._init=function(){this._category=this._createCategory(),this._customDimensions=this._createCustomDimensions()},t.prototype.sendTiming=function(e,t,i,a){if((a=!!a)&&!this._customDimensions)throw"Provider type is not set";a=a?this._customDimensions:{};s.send(this._category,e,i,t,a)},t.prototype.sendEvent=function(e,t,i,a){if(!this._category)throw"The category is not set";if(a&&!this._customDimensions)throw"Provider type is not set";a=a?this._customDimensions:{};r.send(this._category,e,t,i,a)},t.prototype._createCategory=function(){throw"You must create a category using the method _createCategory"},t.prototype._createCustomDimensions=function(){return{}},t.prototype.startTimingMetric=function(){return new Date},e.Services.Analytics.AnalyticsService=t}(AvayaClientServices),function(e){"use strict";var a="Audio",t="Conference",i="Duration",r="Dropped",s="Error",n="Failure",o="Incoming",c="Media Types",l="Outgoing",d="P2P",C="Preservation",u="Service Unavailable",h="Start Type",_="Success (call continued)",v="Success (call ended)",p="Video",g=e.Providers.Analytics.AnalyticsStatistic,S=e.Providers.Analytics.AnalyticsCategories,f=e.Providers.Analytics.AnalyticsCustomDimensions,E=e.Providers.Analytics.AnalyticsProvidersTypes;function A(){e.Services.Analytics.AnalyticsService.call(this),this._callMediaTypes={AUDIO:1,VIDEO:0}}(A.prototype=Object.create(e.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return S.CALLS},A.prototype._createCustomDimensions=function(){var e={};return e[f.PROVIDER_TYPE]=E.CALLS,e},A.prototype.sendCallInfo=function(e,t){var i=e?o:l,e=a;e+=t?"+"+p:"",this.sendEvent(i,e,null,!0)},A.prototype.callTimeEnd=function(e){var t;e&&(t=new Date-e,e=g.getCallDurationLabel(t),this.sendTiming(i,e,t,!0))},A.prototype.setCallMediaTypes=function(e){this._callMediaTypes.VIDEO=e?1:0},A.prototype.sendCallMediaTypes=function(){var e="";this._callMediaTypes.AUDIO&&(e+=a),this._callMediaTypes.VIDEO&&(e+=(e?"+":"")+p),this.sendEvent(c,e,null,!0)},A.prototype.sendOperationFailureEvent=function(e,t){this.sendEvent(e+" "+s,t,null,!0)},A.prototype.sendCallType=function(e){e=e?t:d;this.sendEvent(h,e,null,!0)},A.prototype.sendUnavailableEvent=function(e){this.sendEvent(u,e,null,!0)},A.prototype.serviceUnavailableTimeEnd=function(e){var t;e&&(t=new Date-e,e=g.getServiceOutageLabel(t),this.sendTiming(u,e,t,!0))},A.prototype.sendDroppedCallEvent=function(e){this.sendEvent(r,e,null,!0)},A.prototype.sendPreservationEvent=function(e,t){t&&(t=e?_:5e3<t?v:n,this.sendEvent(C,t,null,!0))},A.prototype.callPreservationTimeStart=function(e){return e?this.startTimingMetric():T},A.prototype.callPreservationTimeEnd=function(e){var t;return e&&(t=new Date-e,e=g.getCallPreservation(t),this.sendTiming(C,e,t,!0)),t},e.Services.Analytics.CallsAnalyticsService=A}(AvayaClientServices),function(i){"use strict";var a="Graceful",t="Avaya",r="Shutdown",e="Startup",s="Ungraceful",n=i.Providers.Analytics.AnalyticsCategories,o=i.Providers.Analytics.AnalyticsCustomDimensions;function c(e,t){this._productName=e,this._productVersion=t,i.Services.Analytics.AnalyticsService.call(this)}(c.prototype=Object.create(i.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return n.CLIENT},c.prototype._createCustomDimensions=function(){var e={};return e[o.PRODUCT_VENDOR]=t,e[o.PRODUCT_NAME]=this._productName,e[o.PRODUCT_VERSION]=this._productVersion,e},c.prototype.sendStartupEvent=function(){this.sendEvent(e,null,null,!0)},c.prototype.sendShutdownEvent=function(e){e=e?a:s;this.sendEvent(r,e,null,!0)},c.prototype.shutdownTimeEnd=function(e,t){e&&(e=new Date-e,t=t?a:s,this.sendTiming(r,t,e,!0))},i.Services.Analytics.ClientAnalyticsService=c}(AvayaClientServices),function(e){"use strict";var t="Start Error",i="Duration",a="End",r="End Error",s="Failure",n="Start",o="Success",c=e.Providers.Analytics.AnalyticsStatistic,l=e.Providers.Analytics.AnalyticsCategories,d=e.Providers.Analytics.AnalyticsCustomDimensions,C=e.Providers.Analytics.AnalyticsProvidersTypes;function u(){e.Services.Analytics.AnalyticsService.call(this)}(u.prototype=Object.create(e.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return l.COLLABORATIONS},u.prototype._createCustomDimensions=function(){var e={};return e[d.PROVIDER_TYPE]=C.COLLABORATION,e},u.prototype.sendStartupEvent=function(e){e=e?o:s;this.sendEvent(n,e,null,!0)},u.prototype.durationTimeEnd=function(e){var t;e&&(t=new Date-e,e=c.getCallDurationLabel(t),this.sendTiming(i,e,t,!0))},u.prototype.sendStartErrorEvent=function(e){this.sendEvent(t,e,null,!0)},u.prototype.sendStopEvent=function(e){e=e?o:s;this.sendEvent(a,e,null,!0)},u.prototype.sendFailureStopEvent=function(e){this.sendEvent(r,e,null,!0)},e.Services.Analytics.CollaborationsAnalyticsService=u}(AvayaClientServices),function(i){"use strict";var a=i.Providers.Analytics.AnalyticsStatistic,r="Loaded",s="Cache Search",n="Directory Search",o="Service Unavailable",c="RESOLVE_CONTACTS";function e(){i.Services.Analytics.AnalyticsService.call(this)}(e.prototype=Object.create(i.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return i.Providers.Analytics.AnalyticsCategories.CONTACTS},e.prototype._createCustomDimensions=function(){var e={};return e[i.Providers.Analytics.AnalyticsCustomDimensions.PROVIDER_TYPE]=i.Providers.Analytics.AnalyticsProvidersTypes.CONTACTS,e},e.prototype.sendNumContactsLoaded=function(e){var t=a.getContactCountLabel(e);this.sendEvent(r,t,e,!0)},e.prototype.contactsLoadTimeEnd=function(e){var t;e?(t=new Date-e,e=a.getOperationTimingLabel(t),this.sendTiming(r,e,t,!0)):i.Base.Logger.warn(i.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, contactsLoadTimeEnd: start time was not defined")},e.prototype.cachedContactsSearchTimeEnd=function(e){var t;e?(t=new Date-e,e=a.getOperationTimingLabel(t),this.sendTiming(s,e,t,!1)):i.Base.Logger.warn(i.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, cachedContactsSearchTimeEnd: start time was not defined")},e.prototype.sendNumCachedContactSearches=function(e){this.sendEvent(s,e,null,!1)},e.prototype.sendNumDirectorySearches=function(e){this.sendEvent(n,e,null,!0)},e.prototype.directorySearchTimeEnd=function(e){var t;e?(t=new Date-e,e=a.getOperationTimingLabel(t),this.sendTiming(n,e,t,!0)):i.Base.Logger.warn(i.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, directorySearchTimeEnd: start time was not defined")},e.prototype.trackContactProvidersUnavailable=function(e){this.sendEvent(o,e,null,!0)},e.prototype.durationContactProviderOutagesEnd=function(e){var t;e&&(t=new Date-e,e=a.getServiceOutageLabel(t),this.sendTiming(o,e,t,!0))},e.prototype.sendNumResolveContacts=function(e){this.sendEvent(c,e,null,!0)},e.prototype.resolveContactsTimeEnd=function(e){var t;e?(t=new Date-e,e=a.getOperationTimingLabel(t),this.sendTiming(c,e,t,!0)):i.Base.Logger.warn(i.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, resolveContactsTimeEnd: start time was not defined")},i.Services.Analytics.ContactsAnalyticsService=e}(AvayaClientServices),function(e){"use strict";var t="Missed Hits",i="ga_missed_hits",a=e.Base.Storage,r=e.Providers.Analytics.AnalyticsCategories;function s(){e.Services.Analytics.AnalyticsService.call(this)}(s.prototype=Object.create(e.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return r.ANALYTICS},s.prototype._getMissedHitsObj=function(){return a.get(a.TYPES.LOCAL,i)},s.prototype.setMissedHitsObj=function(e){a.set(a.TYPES.LOCAL,i,e)},s.prototype.createMissedHitsObj=function(e,t){var i=this._getMissedHitsObj();e+=i?i.count:0,this.setMissedHitsObj({count:e,reason:t})},s.prototype.sendMissedHitsCount=function(){var e=this._getMissedHitsObj();e&&this.sendEvent(t,e.reason,e.count)},e.Services.Analytics.InfrastructureAnalyticsService=s}(AvayaClientServices),function(a){"use strict";var r=a.Providers.Analytics.AnalyticsStatistic,i="SendMessage",s="Attachment Size",n="SearchConversations",o="Service Unavailable",t="GetConversations",c="SearchConversations",l="LeaveConversations",d="ValidateAddresses",C="SendMessage",u="Text",h="Attachment",_="Body",v="Subject",p="Participants";function e(){a.Services.Analytics.AnalyticsService.call(this)}(e.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return a.Providers.Analytics.AnalyticsCategories.MESSAGING},e.prototype._createCustomDimensions=function(){return{}},e.prototype._setCustomDimensionsMimeType=function(e){this._customDimensions[a.Providers.Analytics.AnalyticsCustomDimensions.MIME_TYPE]=e},e.prototype._resetCustomDimensionsMimeType=function(){delete this._customDimensions[a.Providers.Analytics.AnalyticsCustomDimensions.MIME_TYPE]},e.prototype.trackNumMessagesSent=function(e,t){t=this._getLabelTypeMessage(e,t);this.sendEvent(i,t,null,!1)},e.prototype._getLabelTypeMessage=function(e,t){var i=[];return e&&i.push(u),t&&i.push(h),i.join("+")},e.prototype.trackMessageAttachmentSize=function(e,t){this._setCustomDimensionsMimeType(t);t=r.getAttachmentSizeLabel(e);this.sendEvent(s,t,e,!0),this._resetCustomDimensionsMimeType()},e.prototype.trackNumConversationSearchRequests=function(e,t,i){var a=[];e&&a.push(_),t&&a.push(v),i&&a.push(p);a=a.join("+");this.sendEvent(n,a,null,!1)},e.prototype.trackTimeRequestsGetConversationsEnd=function(e){this._sendTrackTimeRequests(t,e)},e.prototype.trackTimeRequestsSearchConversationsEnd=function(e){this._sendTrackTimeRequests(c,e)},e.prototype.trackTimeRequestsLeaveConversationsEnd=function(e){this._sendTrackTimeRequests(l,e)},e.prototype.trackTimeRequestsValidateAddressesEnd=function(e){this._sendTrackTimeRequests(d,e)},e.prototype.trackTimeRequestsSendMessageEnd=function(e){this._sendTrackTimeRequests(C,e)},e.prototype._sendTrackTimeRequests=function(e,t){var i;t?(i=new Date-t,t=r.getOperationTimingLabel(i),this.sendTiming(e,t,i,!1)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Messaging, sendTrackTimeRequests: start time was not defined")},e.prototype.trackErrorsResponseGetConversations=function(e){this._trackErrorsResponse(t,e)},e.prototype.trackErrorsResponseSearchConversations=function(e){this._trackErrorsResponse(c,e)},e.prototype.trackErrorsResponseLeaveConversations=function(e){this._trackErrorsResponse(l,e)},e.prototype.trackErrorsResponseValidateAddresses=function(e){this._trackErrorsResponse(d,e)},e.prototype.trackErrorsResponseSendMessage=function(e){this._trackErrorsResponse(C,e)},e.prototype._trackErrorsResponse=function(e,t){this.sendEvent(e,t,null,!1)},e.prototype.trackServiceUnavailable=function(e){this.sendEvent(o,e,null,!1)},e.prototype.trackDurationServiceUnavailableEnd=function(e){var t;e&&(t=new Date-e,e=r.getServiceOutageLabel(t),this.sendTiming(o,e,t,!1))},a.Services.Analytics.MessagingAnalyticsService=e}(AvayaClientServices),function(e){"use strict";var i="Create",a="Failure",r="Success",c="Services",s="Providers",t=e.Providers.Analytics.AnalyticsCategories,l=e.Providers.Analytics.AnalyticsServicesNames,n=e.Providers.Analytics.AnalyticsProvidersTypes;function o(){e.Services.Analytics.AnalyticsService.call(this)}(o.prototype=Object.create(e.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return t.USER},o.prototype.userCreationTimeEnd=function(e,t){e&&(e=new Date-e,t=t?r:a,this.sendTiming(i,t,e))},o.prototype.sendInfoByUseOfServices=function(e,t,i,a,r,s){function n(e){o+=o?"+":"",o+=e}var o="";e&&n(l.CALL),t&&n(l.COLLABORATION),i&&n(l.CONTACT),a&&n(l.MESSAGING),r&&n(l.PRESENCE),s&&n(l.VOICE_MESSAGING),this.sendEvent(c,o)},o.prototype.sendInfoByUseOfProviders=function(e){function t(e){-1===i.indexOf(e)&&(i+=i?"+":"",i+=e)}var i="";e.acsConfiguration&&e.acsConfiguration.enabled&&t(n.CONTACTS),e.ammConfiguration&&e.ammConfiguration.enabled&&t(n.MESSAGING),e.sgConfiguration&&e.sgConfiguration.enabled&&t(n.CALLS),e.presenceConfiguration&&e.presenceConfiguration.enabled&&t(n.PRESENCE),e.wcsConfiguration&&e.wcsConfiguration.enabled&&t(n.COLLABORATION),e.uccpConfiguration&&e.uccpConfiguration.enabled&&t(n.CONFERENCE),this.sendEvent(s,i)},e.Services.Analytics.UserAnalyticsService=o}(AvayaClientServices),function(s){"use strict";function e(e,t){this._collaborationProvider=e,this._collaborationProviderInitialized=!1,this._whiteboards={},this._nextCollaborationId=1,this._colaborationsAnalyticsService=t,this._wasScreenSharingInterrupted=!1,this._interruptedStream=T,this._interruptedSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._interruptedSharingTimer=T}e.prototype={start:function(e,t,i){if(e._isStarted)return S.Deferred().resolve().promise();if(e._isStopped)return this._durationAnalyticsInit(e),e._isStopped=!1,s.Base.Logger.debug(s.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service is starting..."),this._collaborationProvider.start(t,i).then(function(){this._discoveryResource(e),e._isStarted=!0,e.addOnCollaborationServiceAvailableCallback(function(){this._recalculateAllCollaborationCapabilities(e)}.bind(this)),e.addOnCollaborationServiceUnavailableCallback(function(){e.getContentSharing().getOutgoingScreenSharingStream()&&(this._wasScreenSharingInterrupted=!0,this._interruptedStream=e.getContentSharing().getOutgoingScreenSharingStream().clone(),this._interruptedSharingType=e.getContentSharing()._contentSharingService._contentSharingType,this._interruptedSharingTimer=setTimeout(function(){this._resetInterruptedSharing()}.bind(this),3e5),e.getContentSharing()._clearActiveContentSharing(),e.getContentSharing()._endActiveScreenSharing(e._selfParticipant)),this._recalculateAllCollaborationCapabilities(e)}.bind(this));e.getContentSharing().getShareApplicationWindowCapability().addOnChangedCallback(function(){e._recalculateContentSharingCapability(e)})}.bind(this),function(e){return this._colaborationsAnalyticsService.sendStartErrorEvent(s.Services.Analytics.AnalyticsErrorCode.STARTING_COLLABORATION_ERROR),S.Deferred().reject(e).promise()}.bind(this));s.Base.Logger.error(s.Base.LoggerTags.COLLABORATION_SERVICE,"Rejected attempt to start a collaboration that is already starting.");i=s.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE;return S.Deferred().reject(new s.Services.Collaboration.CollaborationError(i)).promise()},_durationAnalyticsInit:function(e){var t,i;e._whiteboard.addOnWhiteboardStartedCallback(function(){i=this._colaborationsAnalyticsService.startTimingMetric()}.bind(this)),e._whiteboard.addOnWhiteboardEndedCallback(function(){this._colaborationsAnalyticsService.durationTimeEnd(i)}.bind(this)),e._contentSharing.addOnContentSharingStartedCallback(function(){t=this._colaborationsAnalyticsService.startTimingMetric()}.bind(this)),e._contentSharing.addOnContentSharingEndedCallback(function(){this._colaborationsAnalyticsService.durationTimeEnd(t)}.bind(this))},_resetInterruptedSharing:function(){this._wasScreenSharingInterrupted=!1,this._interruptedSharingType=s.Services.Collaboration.ContentSharingType.NONE,this._interruptedStream=T,clearTimeout(this._interruptedSharingTimer),this._interruptedSharingTimer=T},_discoveryResource:function(t){return this._collaborationProvider.discoverResources(t).done(function(e){t._setSelfParticipant(e),this._collaborationProvider.observeCollaboration(t),!s.Base.Utils.isUndefined(t._isAvailable)&&t._isAvailable||(t._isAvailable=!0,t._onCollaborationServiceAvailableCallbacks.fire(t)),this._recalculateAllCollaborationCapabilities(t)}.bind(this))},stop:function(e){if(e._isStopped)return S.Deferred().resolve().promise();e._isStarted=!1,e._isAvailable&&(e._isAvailable=T,e._onCollaborationServiceUnavailableCallbacks.fire(e)),s.Base.Logger.debug(s.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service stop");var t=e.getSlider(),i=t.getSlides();return t._removeSlides(),t._onSlidesRemovedCallbacks.fire(i),e._selfParticipant=T,e._participants.length=0,e._participants.onDataSetChanged(e._participants,s.Base.DataSetChangeTypes.REMOVED),e._onCollaborationStartedCallbacks.empty(),e._onCollaborationEndedCallbacks.empty(),e._onCollaborationServiceAvailableCallbacks.empty(),e._onCollaborationServiceUnavailableCallbacks.empty(),e._onCollaborationNearEndByEjectCallbacks.empty(),e._onCollaborationPresenterPrivilegeChangedCallbacks.empty(),e._onCollaborationModeratorPrivilegeChangedCallbacks.empty(),e._onCollaborationInitializedCallbacks.empty(),e._isPaused=!1,this._collaborationProvider.stop().always(function(){e._isStopped=!0})},getNextCollaborationId:function(){return this._nextCollaborationId++},getParticipants:function(t){var i=new s.Base.DataRetrieval(t._participants),e=function(e){this.updateParticipantList(t,e),i._dataRetrievalProgress.fire(e.length,!1),i._dataRetrievalDone.fire()}.bind(this);return this._collaborationProvider.getParticipants(t).then(e),i},updateParticipantList:function(e,i){function t(e,t){return t.getParticipantId()===i[e].getParticipantId()}for(var a=[],r=0;r<i.length;r++)0===e._participants.filter(t.bind(this,r)).length&&(e._participants.push(i[r]),a.push(i[r]));0<a.length&&e._participants.onDataSetChanged(a,s.Base.DataSetChangeTypes.ADDED)},_recalculateAllCollaborationCapabilities:function(e){e.getContentSharing()._recalculateShareApplicationWindowCapability(e),e.getContentSharing()._recalculateShareFullScreenCapability(e),e.getContentSharing()._recalculateShareAnyTypeCapability(e),e.getContentSharing()._recalculateShareContentVideoCapability(e),e.getWhiteboard()._recalculateAddWhiteboardCapability(e),e._recalculateChatCapability(),e._recalculateMeetingMinutesCapability(),e._recalculateContentSharingCapability(e),e._recalculateNetworkLibraryCapability(),e._recalculateLibrarySharingCapability(),e._recalculateWhiteboardCapability(e),e._recalculateRetrieveParticipantListCapability(),e.getWhiteboard()._recalculateDrawingCapability(e),e._recalculateSliderCapability()},isFeatureSupported:function(e,t){return 0<=e._supportedFeatures.indexOf(t)&&this._collaborationProvider.isFeatureAvailable(t)},isServiceAvailable:function(){return this._collaborationProvider.isOpened()},pause:function(e){return this._collaborationProvider.pause()},resume:function(e){return this._collaborationProvider.resume()},wasScreenSharingInterrupted:function(){return this._wasScreenSharingInterrupted},getInterruptedSharingType:function(){return this._interruptedSharingType},getInterruptedSharingStream:function(){return this._interruptedStream}},s.Services.Collaboration.CollaborationService=e}(AvayaClientServices),function(a){"use strict";var t="ga_client_id",i=a.Base.Storage,r=a.Base.Utils,s=a.Providers.Analytics.AnalyticsStatistic;function e(e){var t=new a.Config.ServerInfo("www.google-analytics.com",null,!0,"/batch"),i=new a.Base.RESTProvider;this._networkProviderConfiguration=new a.Config.NetworkProviderConfiguration(t),this._networkProvider=new a.Base.NetworkProvider(i,T,a.Base.LoggerTags.ANALYTICS_PROVIDER),this._dfdStop=null,this._reportingTimer=null,this._isRunning=!1,this._stopRequested=!1,this._httpRequestsOutstanding=0,this._hitTransmissionQueue=[],this._pendingRequest="",this._countHitsRequest=0,this._retriedOnce=!1,this._commonHitParameters=s.getCommonRequestsParams(e,this._getClientID()),this._infrastructureAnalyticsService=new a.Services.Analytics.InfrastructureAnalyticsService}(e.prototype={}).start=function(){return s.setCollectionEnabledState(!0),this._startProvider()},e.prototype.stop=function(){return this._dfdStop=S.Deferred(),this._isRunning?(this._stopRequested=!0,this._stopProvider()):this._stopCompleted(),s.setCollectionEnabledState(!1),this._dfdStop.promise()},e.prototype._isCollectionEnabled=function(){return s.isCollectionEnabled()},e.prototype._startReportingCycle=function(){this._hitTransmissionQueue.length||(s.queueCollectedHits.call(this),this._hitTransmissionQueue.length&&(this._infrastructureAnalyticsService.sendMissedHitsCount(),s.queueCollectedHits.call(this),this._sendBatch()))},e.prototype._sendBatch=function(){for(this._countHitsRequest=0,this._pendingRequest="";this._hitTransmissionQueue.length&&this._countHitsRequest<20;){var e=this._commonHitParameters;if(e+=this._hitTransmissionQueue[0]+"\n",8192<r.getBytesCount(e))this._hitTransmissionQueue.shift();else{if(16384<r.getBytesCount(this._pendingRequest+e))break;this._pendingRequest+=e,this._countHitsRequest++,this._hitTransmissionQueue.shift()}}this._retriedOnce=!1,this._sendRequest()},e.prototype._sendRequest=function(){this._networkProvider.send(this._pendingRequest,{contentType:"text/plain"}).then(function(e){this._onDataReceived()}.bind(this),function(e){a.Base.Logger.error(a.Base.LoggerTags.ANALYTICS_PROVIDER,"Failed to send request",e),this._onErrorReceived(e)}.bind(this)),this._httpRequestsOutstanding++},e.prototype._onDataReceived=function(){this._infrastructureAnalyticsService.setMissedHitsObj(null),this._pendingRequest="",this._hitTransmissionQueue.length&&this._sendBatch(),this._onRequestCompleted()},e.prototype._onErrorReceived=function(e){this._stopRequested||this._retriedOnce||!this._pendingRequest?(this._infrastructureAnalyticsService.createMissedHitsObj(this._countHitsRequest+this._hitTransmissionQueue.length,e.name),this._pendingRequest="",this._hitTransmissionQueue.length=0):(this._retriedOnce=!0,this._sendRequest()),this._onRequestCompleted()},e.prototype._onRequestCompleted=function(){--this._httpRequestsOutstanding<=0&&(this._httpRequestsOutstanding=0,this._stopRequested&&this._stopCompleted())},e.prototype._stopCompleted=function(){this._stopRequested=!1,this._httpRequestsOutstanding=0,this._dfdStop&&this._dfdStop.resolve()},e.prototype._startProvider=function(){this._networkProvider.start(this._networkProviderConfiguration),this._startReportingTimer(),this._isRunning=!0;var e=S.Deferred();return e.resolve(),e.promise()},e.prototype._stopProvider=function(){if(this._stopReportingTimer(),this._isRunning){for(this._isRunning=!1,s.queueCollectedHits.call(this);this._hitTransmissionQueue.length;)this._sendBatch();this._httpRequestsOutstanding<=0&&this._stopCompleted()}},e.prototype._startReportingTimer=function(){this._reportingTimer||(this._reportingTimer=window.setInterval(function(){this._startReportingCycle()}.bind(this),5e3))},e.prototype._stopReportingTimer=function(){this._reportingTimer&&(window.clearInterval(this._reportingTimer),this._reportingTimer=null)},e.prototype._getClientID=function(){var e=i.get(i.TYPES.LOCAL,t);return void 0===e&&(e=a.Base.Utils.generateUUID(),i.set(i.TYPES.LOCAL,t,e)),e},a.Providers.Analytics.AnalyticsProvider=e}(AvayaClientServices),function(h){"use strict";var o=h.Providers.Analytics.AnalyticsStatistic;function e(e,t,i){var a,r,s,n;this._config=h.Base.Utils.deepMerge(new h.Config.UserConfiguration,e),this._mediaServiceFactory=t,this._version=i,this._collaborationFactory=T,this._collaboration=T,this._collaborations=T,this._callFactory=T,this._calls=T,this._messagingFactory=T,this._messaging=T,this._contacts=T,this._contactsService=T,this._contactsIntegrationService=T,this._presenceService=T,this._voiceMessaging=T,this._callPerformanceManager=new h.Base.CallPerformanceManager(this._config),this._diagnosticDataGenerator=new h.Base.DiagnosticDataGenerator,this._loggingInterval=T,this._isStopping=!1,this._isStarting=!1,this._isStarted=!1,this._userRegistrationSuccessfulCallbacks=S.Callbacks(),this._userUnregistrationSuccessfulCallbacks=S.Callbacks(),this._userRegistrationFailedCallbacks=S.Callbacks(),this._userUnregistrationFailedCallbacks=S.Callbacks(),this._providerFactory=new h.Base.ProviderFactory,this._contactsIntegrationService=new h.Services.Contacts.ContactsIntegrationService,this._config.presenceConfiguration&&this._config.presenceConfiguration.enabled&&this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(a=(r=this._config.sgConfiguration.networkProviderConfiguration.restConfig).hostName+":"+r.port,r=this._providerFactory.getPresenceProviders(a)[0],this._presenceService=new h.Services.Presence.PresenceService(r)),this._config.acsConfiguration&&this._config.acsConfiguration.enabled&&(a=this._providerFactory.getContactsProviders(this._config)[0],r=this._providerFactory.getDirectorySearchProviders(this._config)[0],s=new h.Services.Analytics.ContactsAnalyticsService,this._contactsService=new h.Services.Contacts.ContactsService(a,r,this._contactsIntegrationService,this._presenceService,s),this._contacts=new h.Services.Contacts.Contacts(this._contactsService)),this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(this._voiceMessaging=new h.Services.VoiceMessaging.VoiceMessaging),this._config.mediaServiceContext&&(h.Base.Logger.addLogger(this._providerFactory.getRemoteLoggerProvider().getLogger()),s=atob(this._config.mediaServiceContext),this._config._mediaServiceConfiguration=JSON.parse(s),s=h.Base.Utils.parseUrl(this._config._mediaServiceConfiguration.userAgentURL),s=new h.Config.ServerInfo(s.hostname,isNaN(s.port)?T:s.port,s.isSecure,s.path,s.credentials,s.query),this._config.sgConfiguration.networkProviderConfiguration=new h.Config.NetworkProviderConfiguration(s),s=new h.Config.CredentialTokenProvider(this._config._mediaServiceConfiguration.sessionToken,h.Config.Authentication.TokenType.BEARER),this._config.sgConfiguration.credentialProvider=s,this._config.sgConfiguration.enabled=!0),this._config.sgConfiguration!==T&&!h.Base.Utils.isBool(this._config.sgConfiguration.enabled)||(n=new h.Services.Analytics.CallsAnalyticsService,this._callFactory=new h.Services.Call.CallFactory(this._providerFactory,this._mediaServiceFactory,this._contactsIntegrationService,n,this._callPerformanceManager),this._callFactory.init(this._config),this._calls=this._callFactory.getCalls()),this._config.ammConfiguration&&this._config.ammConfiguration.enabled&&(this._messagingFactory=new h.Services.Messaging.MessagingFactory(this._config,this._providerFactory,this._contactsIntegrationService),this._messaging=this._messagingFactory.create()),this._config.wcsConfiguration&&this._config.wcsConfiguration.enabled&&(n=new h.Services.Analytics.CollaborationsAnalyticsService,this._collaborationFactory=new h.Services.Collaboration.CollaborationFactory(this._config,this._providerFactory,n,this._callPerformanceManager,this._callFactory.getCallService()),this._collaborations=new h.Services.Collaboration.Collaborations(this._collaborationFactory,this._callFactory.getCallService()),this._collaborations=new h.Services.Collaboration.Collaborations(this._collaborationFactory,this._callFactory.getCallService(),this._callFactory.getCallManager()),this._collaboration=this._collaborations.getCollaborationById("standalone"),this._callFactory&&this._callFactory.getCallService()&&this._callFactory.getCallService().setCollaborations(this._collaborations)),this._config.analyticsConfiguration&&(this._analyticsProvider=new h.Providers.Analytics.AnalyticsProvider(i)),this._clientAnalyticsService=new h.Services.Analytics.ClientAnalyticsService(this._config.applicationProductName,this._config.applicationProductVersion),this._userAnalyticsService=new h.Services.Analytics.UserAnalyticsService,this._boundedAOPexceptionHandler=this._aopExceptionHandler.bind(this)}e.prototype={getCollaboration:function(){return h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"getCollaboration function is deprecated. Please use AvayaClientServices.User.prototype.getCollaborations instead. Usage of the new function is slightly different."),this._collaboration},getCollaborations:function(){return this._collaborations},getMessaging:function(){return this._messaging},getContacts:function(){return this._contacts},getSelfContact:function(){return this._contactsService.getSelfContact()},getPresenceService:function(){return this._presenceService},getCalls:function(){return this._calls},getVoiceMessaging:function(){return this._voiceMessaging},stop:function(){var e,t,i,a,r=this._clientAnalyticsService.startTimingMetric(),s=S.Deferred(),n=[];return this._isStopping?(h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still stopping."),s.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()):this._isStarting?(h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still starting."),s.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()):(this._isStopping=!0,this._messaging&&(e=this._messaging.stop(),n.push(e)),this._voiceMessaging&&(t=this._voiceMessaging.stop(),n.push(t)),this._calls?(t=this._calls._stop(),n.push(t),t.then(function(){return this._userUnregistrationSuccessfulCallbacks.fire(),this._resetRegistrationCallbacks(),this._mediaServiceFactory.getMediaServicesService().stop()}.bind(this),function(e){return this._userUnregistrationFailedCallbacks.fire(e),this._mediaServiceFactory.getMediaServicesService().stop()}.bind(this))):this._mediaServiceFactory&&(i=this._mediaServiceFactory.getMediaServicesService().stop(),n.push(i)),this._presenceService&&(i=this._presenceService.stop(),n.push(i)),this._contacts&&(a=this._contacts.stop(),n.push(a)),this._collaborations&&(a=this._collaborations._stopAndDeleteAllCollaborations(),n.push(a)),clearInterval(this._loggingInterval),S.when.apply(this,n).then(function(){this._isStopping=!1,o.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!0),this._clientAnalyticsService.shutdownTimeEnd(r,!0),this._analyticsProvider.stop().then(function(){s.resolve()}.bind(this))):s.resolve()}.bind(this),function(e){this._isStopping=!1,o.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!1),this._clientAnalyticsService.shutdownTimeEnd(r,!1),this._analyticsProvider.stop().always(function(){s.reject(e)})):s.reject(e)}.bind(this)).always(function(){this._isStarted=!1,this._config.mediaServiceContext&&this._calls&&(this._calls._uploadLogs(),h.Base.Logger.removeLogger(this._providerFactory.getRemoteLoggerProvider().getLogger())),h.Base.AOPTools.removeOnExceptionCallback(this._boundedAOPexceptionHandler)}.bind(this))),s.promise()},stopImmediately:function(){var e,t=this._clientAnalyticsService.startTimingMetric(),i=S.Deferred(),a=[];return this._isStopping?(h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still stopping."),i.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE))):this._isStarting?(h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still starting."),i.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE))):(this._isStopping=!0,this._calls?(e=this._calls._stopImmediately().then(function(){this._userUnregistrationSuccessfulCallbacks.fire()}.bind(this),function(e){this._userUnregistrationFailedCallbacks.fire()}.bind(this)).always(function(){this._stopOtherServicesImmediately(a,i)}.bind(this)),a.push(e)):this._stopOtherServicesImmediately(a,i,t)),i.promise()},_stopOtherServicesImmediately:function(e,t,i){var a,r,s;this._voiceMessaging&&(a=this._voiceMessaging._stopImmediately(),e.push(a)),this._presenceService&&(r=this._presenceService._stopImmediately(),e.push(r)),this._messaging&&(r=this._messaging._stopImmediately(),e.push(r)),this._contacts&&(s=this._contacts._stopImmediately(),e.push(s)),this._collaborations&&(s=this._collaborations._stopImmediately(),e.push(s)),S.when.apply(this,e).then(function(){this._isStopping=!1,this._userUnregistrationSuccessfulCallbacks.fire(),o.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!0),this._clientAnalyticsService.shutdownTimeEnd(i,!0),this._analyticsProvider.stop().then(function(){t.resolve()}.bind(this))):t.resolve()}.bind(this),function(e){this._isStopping=!1,this._userUnregistrationFailedCallbacks(),o.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!1),this._clientAnalyticsService.shutdownTimeEnd(i,!1),this._analyticsProvider.stop().always(function(){t.reject(e)})):t.reject(e)}.bind(this)).always(function(){this._isStarted=!1}.bind(this))},start:function(){var t=this._clientAnalyticsService.startTimingMetric();h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Starting SDK, version is "+this._version);var i=S.Deferred();h.Base.AOPTools.addOnExceptionCallback(this._boundedAOPexceptionHandler);try{this._checkDependencies()}catch(e){var a=e.getMessage(),r=e.getData(),s=r.extent===h.Base.Library.Service.SUPPORT_EXTENT_NONE?h.Base.Logger.error:h.Base.Logger.warn,a=a+" "+r.info;if(s(h.Base.LoggerTags.USER_SERVICE,a),r.extent===h.Base.Library.Service.SUPPORT_EXTENT_NONE)return i.reject(e).promise()}var e,n,o,c,l,d=[];if(h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Browser detected as "+h.Base.Utils.getBrowserType()),h.Base.Utils.getBrowserSubType()!==h.Base.BrowserSubType.UNKNOWN&&h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Sub type detected as "+h.Base.Utils.getBrowserSubType()),h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"User agent "+navigator.userAgent),this._isStopping)return h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot start while services are still stopping."),i.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),i.promise();if(this._isStarting)return h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot start service while services are still starting."),i.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),i.promise();if(this._isStarted)return h.Base.Logger.warn(h.Base.LoggerTags.USER_SERVICE,"Cannot start service while service is already started."),i.reject(new h.Base.BaseError(h.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),i.promise();this._isStarting=!0,this._analyticsProvider&&this._config.analyticsConfiguration&&this._config.analyticsConfiguration.enabled&&(e=this._analyticsProvider.start(),d.push(e),this._userAnalyticsService.sendInfoByUseOfServices(this._calls,this._collaboration||this._collaborations,this._contacts,this._messaging,this._presenceService,this._voiceMessaging),this._userAnalyticsService.sendInfoByUseOfProviders(this._config)),this._contacts&&(e=this._contacts.start(this._config),d.push(e)),this._messaging&&(n=this._messaging.start(this._config),d.push(n)),this._presenceService&&(n=this._presenceService.start(this._config),d.push(n)),this._calls&&(o=S.Deferred(),this._config.mediaConfiguration.mediaEngineEnabled&&(this._mediaServiceFactory.getMediaServicesService().setUserConfig(this._config.mediaConfiguration,this._callPerformanceManager),d.push(this._mediaServiceFactory.getMediaServices().start(this._config.mediaConfiguration.retrieveDeviceLabelsEnabled))),this._calls._onCallsServiceRegistration=function(e){(e?this._userRegistrationSuccessfulCallbacks:this._userRegistrationFailedCallbacks).fire()}.bind(this),l=this._calls._start(),d.push(l),l.then(function(){o.resolve()}.bind(this),function(e){o.reject(e)}.bind(this))),this._voiceMessaging&&(this._calls?(c=S.Deferred(),d.push(c),o.promise().always(function(){var e=this._providerFactory.getVoiceMessagingProvider(this._config.sgConfiguration);this._voiceMessaging.start(this._config,e).then(function(){c.resolve()},function(e){c.reject(e)})}.bind(this))):(l=this._voiceMessaging.start(this._config),d.push(l))),this._loggingInterval=setInterval(function(){this._logDiagnosticData()}.bind(this),3e5);var C=0,u=0;return h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Starting "+d.length+" services."),d.forEach(function(e){e.then(function(){u++,i.state()===h.Base.DeferredStates.PENDING&&u+C===d.length&&(this._userAnalyticsService.userCreationTimeEnd(t,!0),this._isStarting=!1,this._isStarted=!0,h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Resolving promise : ["+u+","+C+"]"),i.resolve())}.bind(this),function(){C++,i.state()===h.Base.DeferredStates.PENDING&&(C===d.length?(this._userAnalyticsService.userCreationTimeEnd(t,!1),this._isStarting=!1,h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Rejecting promise : ["+u+","+C+"]"),i.reject()):u+C===d.length&&(this._userAnalyticsService.userCreationTimeEnd(t,!0),this._isStarting=!1,this._isStarted=!0,h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,"Resolving promise : ["+u+","+C+"]"),i.resolve()))}.bind(this))}.bind(this)),this._clientAnalyticsService.sendStartupEvent(),i.promise()},_checkDependencies:function(){var e=h.Base.Library.Service.jQuery.getSupportExtent();if(e!==h.Base.Library.Service.SUPPORT_EXTENT_FULL){e={extent:e,info:"Supported version of jQuery is "+h.Base.Library.Service.jQuery.getSupportedVersion()+" while current version is "+h.Base.Library.Service.jQuery.getCurrentVersion()};throw new h.Base.BaseError(h.Base.ErrorReasons.LIBRARY_NOT_SUPPORTED,e)}},_resetRegistrationCallbacks:function(){this._userRegistrationSuccessfulCallbacks.empty(),this._userUnregistrationSuccessfulCallbacks.empty(),this._userRegistrationFailedCallbacks.empty(),this._userUnregistrationFailedCallbacks.empty()},_logDiagnosticData:function(){var t=[];this._diagnosticDataGenerator.generateBatteryLogs(this._config).then(function(e){return t=t.concat(e),this._diagnosticDataGenerator.generateMessagingLogs(this._messaging)}.bind(this)).then(function(e){return t=t.concat(e),this._diagnosticDataGenerator.generateContactsLogs(this._contacts)}.bind(this)).then(function(e){return t=t.concat(e),this._diagnosticDataGenerator.generateCallLogs(this._calls)}.bind(this)).then(function(e){return t=t.concat(e),this._diagnosticDataGenerator.generatePerformanceLogs()}.bind(this)).then(function(e){t=t.concat(e),h.Base.Logger.info(h.Base.LoggerTags.USER_SERVICE,t.join("\r\n"))}.bind(this))},_aopExceptionHandler:function(e){h.Base.Logger.error(h.Base.LoggerTags.USER_SERVICE,"Caught service exception",e),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()}},h.Base.AOPTools.addAdvices(e,"User",["getSelfContact"],[h.Base.AOPCommonAdvices.LOG_USER_API_CALLS]),h.Base.AOPTools.addAdvices(e,"User",["start","stop","stopImmediately"],[h.Base.AOPCommonAdvices.LOG_USER_API_CALLS,h.Base.AOPCommonAdvices.WRAP_CAUGHT_USER_ERROR]),h.Base.AOPTools.addAdvices(window.AvayaClientServices,"AvayaClientServices",["createUser","registerLogger"],[h.Base.AOPCommonAdvices.LOG_USER_API_CALLS]),h.User=e}(AvayaClientServices),function(e){"use strict";S.extend(e.User.prototype,{addOnUserRegistrationSuccessful:function(e){this._userRegistrationSuccessfulCallbacks.add(e)},removeOnUserRegistrationSuccessful:function(e){this._userRegistrationSuccessfulCallbacks.remove(e)},addOnUserRegistrationFailed:function(e){this._userRegistrationFailedCallbacks.add(e)},removeOnUserRegistrationFailed:function(e){this._userRegistrationFailedCallbacks.remove(e)},addOnUserUnregistrationSuccessful:function(e){this._userUnregistrationSuccessfulCallbacks.add(e)},removeOnUserUnregistrationSuccessful:function(e){this._userUnregistrationSuccessfulCallbacks.remove(e)},addOnUserUnregistrationFailed:function(e){this._userUnregistrationFailedCallbacks.add(e)},removeOnUserUnregistrationFailed:function(e){this._userUnregistrationFailedCallbacks.remove(e)}})}(AvayaClientServices),AvayaClientServices.Base.Library.Service.jQuery.addOnVersionChangedCallback(function(e){S=e})}();
/**
 * @license
 * Lodash lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 */
;(function(){function n(n,t,r){switch(r.length){case 0:return n.call(t);case 1:return n.call(t,r[0]);case 2:return n.call(t,r[0],r[1]);case 3:return n.call(t,r[0],r[1],r[2])}return n.apply(t,r)}function t(n,t,r,e){for(var u=-1,i=null==n?0:n.length;++u<i;){var o=n[u];t(e,o,r(o),n)}return e}function r(n,t){for(var r=-1,e=null==n?0:n.length;++r<e&&false!==t(n[r],r,n););return n}function e(n,t){for(var r=null==n?0:n.length;r--&&false!==t(n[r],r,n););return n}function u(n,t){for(var r=-1,e=null==n?0:n.length;++r<e;)if(!t(n[r],r,n))return false;
return true}function i(n,t){for(var r=-1,e=null==n?0:n.length,u=0,i=[];++r<e;){var o=n[r];t(o,r,n)&&(i[u++]=o)}return i}function o(n,t){return!(null==n||!n.length)&&-1<v(n,t,0)}function f(n,t,r){for(var e=-1,u=null==n?0:n.length;++e<u;)if(r(t,n[e]))return true;return false}function c(n,t){for(var r=-1,e=null==n?0:n.length,u=Array(e);++r<e;)u[r]=t(n[r],r,n);return u}function a(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function l(n,t,r,e){var u=-1,i=null==n?0:n.length;for(e&&i&&(r=n[++u]);++u<i;)r=t(r,n[u],u,n);
return r}function s(n,t,r,e){var u=null==n?0:n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r}function h(n,t){for(var r=-1,e=null==n?0:n.length;++r<e;)if(t(n[r],r,n))return true;return false}function p(n,t,r){var e;return r(n,function(n,r,u){if(t(n,r,u))return e=r,false}),e}function _(n,t,r,e){var u=n.length;for(r+=e?1:-1;e?r--:++r<u;)if(t(n[r],r,n))return r;return-1}function v(n,t,r){if(t===t)n:{--r;for(var e=n.length;++r<e;)if(n[r]===t){n=r;break n}n=-1}else n=_(n,d,r);return n}function g(n,t,r,e){
--r;for(var u=n.length;++r<u;)if(e(n[r],t))return r;return-1}function d(n){return n!==n}function y(n,t){var r=null==n?0:n.length;return r?m(n,t)/r:F}function b(n){return function(t){return null==t?T:t[n]}}function x(n){return function(t){return null==n?T:n[t]}}function j(n,t,r,e,u){return u(n,function(n,u,i){r=e?(e=false,n):t(r,n,u,i)}),r}function w(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function m(n,t){for(var r,e=-1,u=n.length;++e<u;){var i=t(n[e]);i!==T&&(r=r===T?i:r+i)}return r;
}function A(n,t){for(var r=-1,e=Array(n);++r<n;)e[r]=t(r);return e}function E(n,t){return c(t,function(t){return[t,n[t]]})}function k(n){return function(t){return n(t)}}function S(n,t){return c(t,function(t){return n[t]})}function O(n,t){return n.has(t)}function I(n,t){for(var r=-1,e=n.length;++r<e&&-1<v(t,n[r],0););return r}function R(n,t){for(var r=n.length;r--&&-1<v(t,n[r],0););return r}function z(n){return"\\"+Un[n]}function W(n){var t=-1,r=Array(n.size);return n.forEach(function(n,e){r[++t]=[e,n];
}),r}function B(n,t){return function(r){return n(t(r))}}function L(n,t){for(var r=-1,e=n.length,u=0,i=[];++r<e;){var o=n[r];o!==t&&"__lodash_placeholder__"!==o||(n[r]="__lodash_placeholder__",i[u++]=r)}return i}function U(n){var t=-1,r=Array(n.size);return n.forEach(function(n){r[++t]=n}),r}function C(n){var t=-1,r=Array(n.size);return n.forEach(function(n){r[++t]=[n,n]}),r}function D(n){if(Rn.test(n)){for(var t=On.lastIndex=0;On.test(n);)++t;n=t}else n=Qn(n);return n}function M(n){return Rn.test(n)?n.match(On)||[]:n.split("");
}var T,$=1/0,F=NaN,N=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],P=/\b__p\+='';/g,Z=/\b(__p\+=)''\+/g,q=/(__e\(.*?\)|\b__t\))\+'';/g,V=/&(?:amp|lt|gt|quot|#39);/g,K=/[&<>"']/g,G=RegExp(V.source),H=RegExp(K.source),J=/<%-([\s\S]+?)%>/g,Y=/<%([\s\S]+?)%>/g,Q=/<%=([\s\S]+?)%>/g,X=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nn=/^\w*$/,tn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rn=/[\\^$.*+?()[\]{}|]/g,en=RegExp(rn.source),un=/^\s+|\s+$/g,on=/^\s+/,fn=/\s+$/,cn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,an=/\{\n\/\* \[wrapped with (.+)\] \*/,ln=/,? & /,sn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,hn=/\\(\\)?/g,pn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_n=/\w*$/,vn=/^[-+]0x[0-9a-f]+$/i,gn=/^0b[01]+$/i,dn=/^\[object .+?Constructor\]$/,yn=/^0o[0-7]+$/i,bn=/^(?:0|[1-9]\d*)$/,xn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,jn=/($^)/,wn=/['\n\r\u2028\u2029\\]/g,mn="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",An="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+mn,En="(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])",kn=RegExp("['\u2019]","g"),Sn=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),On=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|"+En+mn,"g"),In=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",An].join("|"),"g"),Rn=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),zn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Wn="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Bn={};
Bn["[object Float32Array]"]=Bn["[object Float64Array]"]=Bn["[object Int8Array]"]=Bn["[object Int16Array]"]=Bn["[object Int32Array]"]=Bn["[object Uint8Array]"]=Bn["[object Uint8ClampedArray]"]=Bn["[object Uint16Array]"]=Bn["[object Uint32Array]"]=true,Bn["[object Arguments]"]=Bn["[object Array]"]=Bn["[object ArrayBuffer]"]=Bn["[object Boolean]"]=Bn["[object DataView]"]=Bn["[object Date]"]=Bn["[object Error]"]=Bn["[object Function]"]=Bn["[object Map]"]=Bn["[object Number]"]=Bn["[object Object]"]=Bn["[object RegExp]"]=Bn["[object Set]"]=Bn["[object String]"]=Bn["[object WeakMap]"]=false;
var Ln={};Ln["[object Arguments]"]=Ln["[object Array]"]=Ln["[object ArrayBuffer]"]=Ln["[object DataView]"]=Ln["[object Boolean]"]=Ln["[object Date]"]=Ln["[object Float32Array]"]=Ln["[object Float64Array]"]=Ln["[object Int8Array]"]=Ln["[object Int16Array]"]=Ln["[object Int32Array]"]=Ln["[object Map]"]=Ln["[object Number]"]=Ln["[object Object]"]=Ln["[object RegExp]"]=Ln["[object Set]"]=Ln["[object String]"]=Ln["[object Symbol]"]=Ln["[object Uint8Array]"]=Ln["[object Uint8ClampedArray]"]=Ln["[object Uint16Array]"]=Ln["[object Uint32Array]"]=true,
Ln["[object Error]"]=Ln["[object Function]"]=Ln["[object WeakMap]"]=false;var Un={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Cn=parseFloat,Dn=parseInt,Mn=typeof global=="object"&&global&&global.Object===Object&&global,Tn=typeof self=="object"&&self&&self.Object===Object&&self,$n=Mn||Tn||Function("return this")(),Fn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nn=Fn&&typeof module=="object"&&module&&!module.nodeType&&module,Pn=Nn&&Nn.exports===Fn,Zn=Pn&&Mn.process,qn=function(){
try{var n=Nn&&Nn.f&&Nn.f("util").types;return n?n:Zn&&Zn.binding&&Zn.binding("util")}catch(n){}}(),Vn=qn&&qn.isArrayBuffer,Kn=qn&&qn.isDate,Gn=qn&&qn.isMap,Hn=qn&&qn.isRegExp,Jn=qn&&qn.isSet,Yn=qn&&qn.isTypedArray,Qn=b("length"),Xn=x({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I",
"\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C",
"\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i",
"\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r",
"\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij",
"\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),nt=x({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),tt=x({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),rt=function x(mn){function An(n){if(yu(n)&&!ff(n)&&!(n instanceof Un)){if(n instanceof On)return n;if(oi.call(n,"__wrapped__"))return Fe(n)}return new On(n)}function En(){}function On(n,t){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=T}function Un(n){this.__wrapped__=n,
this.__actions__=[],this.__dir__=1,this.__filtered__=false,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Mn(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function Tn(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function Fn(n){var t=-1,r=null==n?0:n.length;for(this.clear();++t<r;){var e=n[t];this.set(e[0],e[1])}}function Nn(n){var t=-1,r=null==n?0:n.length;for(this.__data__=new Fn;++t<r;)this.add(n[t]);
}function Zn(n){this.size=(this.__data__=new Tn(n)).size}function qn(n,t){var r,e=ff(n),u=!e&&of(n),i=!e&&!u&&af(n),o=!e&&!u&&!i&&_f(n),u=(e=e||u||i||o)?A(n.length,ni):[],f=u.length;for(r in n)!t&&!oi.call(n,r)||e&&("length"==r||i&&("offset"==r||"parent"==r)||o&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||Se(r,f))||u.push(r);return u}function Qn(n){var t=n.length;return t?n[ir(0,t-1)]:T}function et(n,t){return De(Ur(n),pt(t,0,n.length))}function ut(n){return De(Ur(n))}function it(n,t,r){(r===T||lu(n[t],r))&&(r!==T||t in n)||st(n,t,r);
}function ot(n,t,r){var e=n[t];oi.call(n,t)&&lu(e,r)&&(r!==T||t in n)||st(n,t,r)}function ft(n,t){for(var r=n.length;r--;)if(lu(n[r][0],t))return r;return-1}function ct(n,t,r,e){return uo(n,function(n,u,i){t(e,n,r(n),i)}),e}function at(n,t){return n&&Cr(t,Wu(t),n)}function lt(n,t){return n&&Cr(t,Bu(t),n)}function st(n,t,r){"__proto__"==t&&Ai?Ai(n,t,{configurable:true,enumerable:true,value:r,writable:true}):n[t]=r}function ht(n,t){for(var r=-1,e=t.length,u=Ku(e),i=null==n;++r<e;)u[r]=i?T:Ru(n,t[r]);return u;
}function pt(n,t,r){return n===n&&(r!==T&&(n=n<=r?n:r),t!==T&&(n=n>=t?n:t)),n}function _t(n,t,e,u,i,o){var f,c=1&t,a=2&t,l=4&t;if(e&&(f=i?e(n,u,i,o):e(n)),f!==T)return f;if(!du(n))return n;if(u=ff(n)){if(f=me(n),!c)return Ur(n,f)}else{var s=vo(n),h="[object Function]"==s||"[object GeneratorFunction]"==s;if(af(n))return Ir(n,c);if("[object Object]"==s||"[object Arguments]"==s||h&&!i){if(f=a||h?{}:Ae(n),!c)return a?Mr(n,lt(f,n)):Dr(n,at(f,n))}else{if(!Ln[s])return i?n:{};f=Ee(n,s,c)}}if(o||(o=new Zn),
i=o.get(n))return i;o.set(n,f),pf(n)?n.forEach(function(r){f.add(_t(r,t,e,r,n,o))}):sf(n)&&n.forEach(function(r,u){f.set(u,_t(r,t,e,u,n,o))});var a=l?a?ve:_e:a?Bu:Wu,p=u?T:a(n);return r(p||n,function(r,u){p&&(u=r,r=n[u]),ot(f,u,_t(r,t,e,u,n,o))}),f}function vt(n){var t=Wu(n);return function(r){return gt(r,n,t)}}function gt(n,t,r){var e=r.length;if(null==n)return!e;for(n=Qu(n);e--;){var u=r[e],i=t[u],o=n[u];if(o===T&&!(u in n)||!i(o))return false}return true}function dt(n,t,r){if(typeof n!="function")throw new ti("Expected a function");
return bo(function(){n.apply(T,r)},t)}function yt(n,t,r,e){var u=-1,i=o,a=true,l=n.length,s=[],h=t.length;if(!l)return s;r&&(t=c(t,k(r))),e?(i=f,a=false):200<=t.length&&(i=O,a=false,t=new Nn(t));n:for(;++u<l;){var p=n[u],_=null==r?p:r(p),p=e||0!==p?p:0;if(a&&_===_){for(var v=h;v--;)if(t[v]===_)continue n;s.push(p)}else i(t,_,e)||s.push(p)}return s}function bt(n,t){var r=true;return uo(n,function(n,e,u){return r=!!t(n,e,u)}),r}function xt(n,t,r){for(var e=-1,u=n.length;++e<u;){var i=n[e],o=t(i);if(null!=o&&(f===T?o===o&&!wu(o):r(o,f)))var f=o,c=i;
}return c}function jt(n,t){var r=[];return uo(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function wt(n,t,r,e,u){var i=-1,o=n.length;for(r||(r=ke),u||(u=[]);++i<o;){var f=n[i];0<t&&r(f)?1<t?wt(f,t-1,r,e,u):a(u,f):e||(u[u.length]=f)}return u}function mt(n,t){return n&&oo(n,t,Wu)}function At(n,t){return n&&fo(n,t,Wu)}function Et(n,t){return i(t,function(t){return _u(n[t])})}function kt(n,t){t=Sr(t,n);for(var r=0,e=t.length;null!=n&&r<e;)n=n[Me(t[r++])];return r&&r==e?n:T}function St(n,t,r){return t=t(n),
ff(n)?t:a(t,r(n))}function Ot(n){if(null==n)n=n===T?"[object Undefined]":"[object Null]";else if(mi&&mi in Qu(n)){var t=oi.call(n,mi),r=n[mi];try{n[mi]=T;var e=true}catch(n){}var u=ai.call(n);e&&(t?n[mi]=r:delete n[mi]),n=u}else n=ai.call(n);return n}function It(n,t){return n>t}function Rt(n,t){return null!=n&&oi.call(n,t)}function zt(n,t){return null!=n&&t in Qu(n)}function Wt(n,t,r){for(var e=r?f:o,u=n[0].length,i=n.length,a=i,l=Ku(i),s=1/0,h=[];a--;){var p=n[a];a&&t&&(p=c(p,k(t))),s=Ci(p.length,s),
l[a]=!r&&(t||120<=u&&120<=p.length)?new Nn(a&&p):T}var p=n[0],_=-1,v=l[0];n:for(;++_<u&&h.length<s;){var g=p[_],d=t?t(g):g,g=r||0!==g?g:0;if(v?!O(v,d):!e(h,d,r)){for(a=i;--a;){var y=l[a];if(y?!O(y,d):!e(n[a],d,r))continue n}v&&v.push(d),h.push(g)}}return h}function Bt(n,t,r){var e={};return mt(n,function(n,u,i){t(e,r(n),u,i)}),e}function Lt(t,r,e){return r=Sr(r,t),t=2>r.length?t:kt(t,hr(r,0,-1)),r=null==t?t:t[Me(Ve(r))],null==r?T:n(r,t,e)}function Ut(n){return yu(n)&&"[object Arguments]"==Ot(n)}function Ct(n){
return yu(n)&&"[object ArrayBuffer]"==Ot(n)}function Dt(n){return yu(n)&&"[object Date]"==Ot(n)}function Mt(n,t,r,e,u){if(n===t)t=true;else if(null==n||null==t||!yu(n)&&!yu(t))t=n!==n&&t!==t;else n:{var i=ff(n),o=ff(t),f=i?"[object Array]":vo(n),c=o?"[object Array]":vo(t),f="[object Arguments]"==f?"[object Object]":f,c="[object Arguments]"==c?"[object Object]":c,a="[object Object]"==f,o="[object Object]"==c;if((c=f==c)&&af(n)){if(!af(t)){t=false;break n}i=true,a=false}if(c&&!a)u||(u=new Zn),t=i||_f(n)?se(n,t,r,e,Mt,u):he(n,t,f,r,e,Mt,u);else{
if(!(1&r)&&(i=a&&oi.call(n,"__wrapped__"),f=o&&oi.call(t,"__wrapped__"),i||f)){n=i?n.value():n,t=f?t.value():t,u||(u=new Zn),t=Mt(n,t,r,e,u);break n}if(c)t:if(u||(u=new Zn),i=1&r,f=_e(n),o=f.length,c=_e(t).length,o==c||i){for(a=o;a--;){var l=f[a];if(!(i?l in t:oi.call(t,l))){t=false;break t}}if((c=u.get(n))&&u.get(t))t=c==t;else{c=true,u.set(n,t),u.set(t,n);for(var s=i;++a<o;){var l=f[a],h=n[l],p=t[l];if(e)var _=i?e(p,h,l,t,n,u):e(h,p,l,n,t,u);if(_===T?h!==p&&!Mt(h,p,r,e,u):!_){c=false;break}s||(s="constructor"==l);
}c&&!s&&(r=n.constructor,e=t.constructor,r!=e&&"constructor"in n&&"constructor"in t&&!(typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)&&(c=false)),u.delete(n),u.delete(t),t=c}}else t=false;else t=false}}return t}function Tt(n){return yu(n)&&"[object Map]"==vo(n)}function $t(n,t,r,e){var u=r.length,i=u,o=!e;if(null==n)return!i;for(n=Qu(n);u--;){var f=r[u];if(o&&f[2]?f[1]!==n[f[0]]:!(f[0]in n))return false}for(;++u<i;){var f=r[u],c=f[0],a=n[c],l=f[1];if(o&&f[2]){if(a===T&&!(c in n))return false;
}else{if(f=new Zn,e)var s=e(a,l,c,n,t,f);if(s===T?!Mt(l,a,3,e,f):!s)return false}}return true}function Ft(n){return!(!du(n)||ci&&ci in n)&&(_u(n)?hi:dn).test(Te(n))}function Nt(n){return yu(n)&&"[object RegExp]"==Ot(n)}function Pt(n){return yu(n)&&"[object Set]"==vo(n)}function Zt(n){return yu(n)&&gu(n.length)&&!!Bn[Ot(n)]}function qt(n){return typeof n=="function"?n:null==n?$u:typeof n=="object"?ff(n)?Jt(n[0],n[1]):Ht(n):Zu(n)}function Vt(n){if(!ze(n))return Li(n);var t,r=[];for(t in Qu(n))oi.call(n,t)&&"constructor"!=t&&r.push(t);
return r}function Kt(n,t){return n<t}function Gt(n,t){var r=-1,e=su(n)?Ku(n.length):[];return uo(n,function(n,u,i){e[++r]=t(n,u,i)}),e}function Ht(n){var t=xe(n);return 1==t.length&&t[0][2]?We(t[0][0],t[0][1]):function(r){return r===n||$t(r,n,t)}}function Jt(n,t){return Ie(n)&&t===t&&!du(t)?We(Me(n),t):function(r){var e=Ru(r,n);return e===T&&e===t?zu(r,n):Mt(t,e,3)}}function Yt(n,t,r,e,u){n!==t&&oo(t,function(i,o){if(u||(u=new Zn),du(i)){var f=u,c=Le(n,o),a=Le(t,o),l=f.get(a);if(l)it(n,o,l);else{
var l=e?e(c,a,o+"",n,t,f):T,s=l===T;if(s){var h=ff(a),p=!h&&af(a),_=!h&&!p&&_f(a),l=a;h||p||_?ff(c)?l=c:hu(c)?l=Ur(c):p?(s=false,l=Ir(a,true)):_?(s=false,l=zr(a,true)):l=[]:xu(a)||of(a)?(l=c,of(c)?l=Ou(c):du(c)&&!_u(c)||(l=Ae(a))):s=false}s&&(f.set(a,l),Yt(l,a,r,e,f),f.delete(a)),it(n,o,l)}}else f=e?e(Le(n,o),i,o+"",n,t,u):T,f===T&&(f=i),it(n,o,f)},Bu)}function Qt(n,t){var r=n.length;if(r)return t+=0>t?r:0,Se(t,r)?n[t]:T}function Xt(n,t,r){var e=-1;return t=c(t.length?t:[$u],k(ye())),n=Gt(n,function(n){return{
a:c(t,function(t){return t(n)}),b:++e,c:n}}),w(n,function(n,t){var e;n:{e=-1;for(var u=n.a,i=t.a,o=u.length,f=r.length;++e<o;){var c=Wr(u[e],i[e]);if(c){e=e>=f?c:c*("desc"==r[e]?-1:1);break n}}e=n.b-t.b}return e})}function nr(n,t){return tr(n,t,function(t,r){return zu(n,r)})}function tr(n,t,r){for(var e=-1,u=t.length,i={};++e<u;){var o=t[e],f=kt(n,o);r(f,o)&&lr(i,Sr(o,n),f)}return i}function rr(n){return function(t){return kt(t,n)}}function er(n,t,r,e){var u=e?g:v,i=-1,o=t.length,f=n;for(n===t&&(t=Ur(t)),
r&&(f=c(n,k(r)));++i<o;)for(var a=0,l=t[i],l=r?r(l):l;-1<(a=u(f,l,a,e));)f!==n&&xi.call(f,a,1),xi.call(n,a,1);return n}function ur(n,t){for(var r=n?t.length:0,e=r-1;r--;){var u=t[r];if(r==e||u!==i){var i=u;Se(u)?xi.call(n,u,1):xr(n,u)}}}function ir(n,t){return n+Ii(Ti()*(t-n+1))}function or(n,t){var r="";if(!n||1>t||9007199254740991<t)return r;do t%2&&(r+=n),(t=Ii(t/2))&&(n+=n);while(t);return r}function fr(n,t){return xo(Be(n,t,$u),n+"")}function cr(n){return Qn(Uu(n))}function ar(n,t){var r=Uu(n);
return De(r,pt(t,0,r.length))}function lr(n,t,r,e){if(!du(n))return n;t=Sr(t,n);for(var u=-1,i=t.length,o=i-1,f=n;null!=f&&++u<i;){var c=Me(t[u]),a=r;if(u!=o){var l=f[c],a=e?e(l,c,f):T;a===T&&(a=du(l)?l:Se(t[u+1])?[]:{})}ot(f,c,a),f=f[c]}return n}function sr(n){return De(Uu(n))}function hr(n,t,r){var e=-1,u=n.length;for(0>t&&(t=-t>u?0:u+t),r=r>u?u:r,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Ku(u);++e<u;)r[e]=n[e+t];return r}function pr(n,t){var r;return uo(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}
function _r(n,t,r){var e=0,u=null==n?e:n.length;if(typeof t=="number"&&t===t&&2147483647>=u){for(;e<u;){var i=e+u>>>1,o=n[i];null!==o&&!wu(o)&&(r?o<=t:o<t)?e=i+1:u=i}return u}return vr(n,t,$u,r)}function vr(n,t,r,e){t=r(t);for(var u=0,i=null==n?0:n.length,o=t!==t,f=null===t,c=wu(t),a=t===T;u<i;){var l=Ii((u+i)/2),s=r(n[l]),h=s!==T,p=null===s,_=s===s,v=wu(s);(o?e||_:a?_&&(e||h):f?_&&h&&(e||!p):c?_&&h&&!p&&(e||!v):p||v?0:e?s<=t:s<t)?u=l+1:i=l}return Ci(i,4294967294)}function gr(n,t){for(var r=-1,e=n.length,u=0,i=[];++r<e;){
var o=n[r],f=t?t(o):o;if(!r||!lu(f,c)){var c=f;i[u++]=0===o?0:o}}return i}function dr(n){return typeof n=="number"?n:wu(n)?F:+n}function yr(n){if(typeof n=="string")return n;if(ff(n))return c(n,yr)+"";if(wu(n))return ro?ro.call(n):"";var t=n+"";return"0"==t&&1/n==-$?"-0":t}function br(n,t,r){var e=-1,u=o,i=n.length,c=true,a=[],l=a;if(r)c=false,u=f;else if(200<=i){if(u=t?null:so(n))return U(u);c=false,u=O,l=new Nn}else l=t?[]:a;n:for(;++e<i;){var s=n[e],h=t?t(s):s,s=r||0!==s?s:0;if(c&&h===h){for(var p=l.length;p--;)if(l[p]===h)continue n;
t&&l.push(h),a.push(s)}else u(l,h,r)||(l!==a&&l.push(h),a.push(s))}return a}function xr(n,t){return t=Sr(t,n),n=2>t.length?n:kt(n,hr(t,0,-1)),null==n||delete n[Me(Ve(t))]}function jr(n,t,r,e){for(var u=n.length,i=e?u:-1;(e?i--:++i<u)&&t(n[i],i,n););return r?hr(n,e?0:i,e?i+1:u):hr(n,e?i+1:0,e?u:i)}function wr(n,t){var r=n;return r instanceof Un&&(r=r.value()),l(t,function(n,t){return t.func.apply(t.thisArg,a([n],t.args))},r)}function mr(n,t,r){var e=n.length;if(2>e)return e?br(n[0]):[];for(var u=-1,i=Ku(e);++u<e;)for(var o=n[u],f=-1;++f<e;)f!=u&&(i[u]=yt(i[u]||o,n[f],t,r));
return br(wt(i,1),t,r)}function Ar(n,t,r){for(var e=-1,u=n.length,i=t.length,o={};++e<u;)r(o,n[e],e<i?t[e]:T);return o}function Er(n){return hu(n)?n:[]}function kr(n){return typeof n=="function"?n:$u}function Sr(n,t){return ff(n)?n:Ie(n,t)?[n]:jo(Iu(n))}function Or(n,t,r){var e=n.length;return r=r===T?e:r,!t&&r>=e?n:hr(n,t,r)}function Ir(n,t){if(t)return n.slice();var r=n.length,r=gi?gi(r):new n.constructor(r);return n.copy(r),r}function Rr(n){var t=new n.constructor(n.byteLength);return new vi(t).set(new vi(n)),
t}function zr(n,t){return new n.constructor(t?Rr(n.buffer):n.buffer,n.byteOffset,n.length)}function Wr(n,t){if(n!==t){var r=n!==T,e=null===n,u=n===n,i=wu(n),o=t!==T,f=null===t,c=t===t,a=wu(t);if(!f&&!a&&!i&&n>t||i&&o&&c&&!f&&!a||e&&o&&c||!r&&c||!u)return 1;if(!e&&!i&&!a&&n<t||a&&r&&u&&!e&&!i||f&&r&&u||!o&&u||!c)return-1}return 0}function Br(n,t,r,e){var u=-1,i=n.length,o=r.length,f=-1,c=t.length,a=Ui(i-o,0),l=Ku(c+a);for(e=!e;++f<c;)l[f]=t[f];for(;++u<o;)(e||u<i)&&(l[r[u]]=n[u]);for(;a--;)l[f++]=n[u++];
return l}function Lr(n,t,r,e){var u=-1,i=n.length,o=-1,f=r.length,c=-1,a=t.length,l=Ui(i-f,0),s=Ku(l+a);for(e=!e;++u<l;)s[u]=n[u];for(l=u;++c<a;)s[l+c]=t[c];for(;++o<f;)(e||u<i)&&(s[l+r[o]]=n[u++]);return s}function Ur(n,t){var r=-1,e=n.length;for(t||(t=Ku(e));++r<e;)t[r]=n[r];return t}function Cr(n,t,r,e){var u=!r;r||(r={});for(var i=-1,o=t.length;++i<o;){var f=t[i],c=e?e(r[f],n[f],f,r,n):T;c===T&&(c=n[f]),u?st(r,f,c):ot(r,f,c)}return r}function Dr(n,t){return Cr(n,po(n),t)}function Mr(n,t){return Cr(n,_o(n),t);
}function Tr(n,r){return function(e,u){var i=ff(e)?t:ct,o=r?r():{};return i(e,n,ye(u,2),o)}}function $r(n){return fr(function(t,r){var e=-1,u=r.length,i=1<u?r[u-1]:T,o=2<u?r[2]:T,i=3<n.length&&typeof i=="function"?(u--,i):T;for(o&&Oe(r[0],r[1],o)&&(i=3>u?T:i,u=1),t=Qu(t);++e<u;)(o=r[e])&&n(t,o,e,i);return t})}function Fr(n,t){return function(r,e){if(null==r)return r;if(!su(r))return n(r,e);for(var u=r.length,i=t?u:-1,o=Qu(r);(t?i--:++i<u)&&false!==e(o[i],i,o););return r}}function Nr(n){return function(t,r,e){
var u=-1,i=Qu(t);e=e(t);for(var o=e.length;o--;){var f=e[n?o:++u];if(false===r(i[f],f,i))break}return t}}function Pr(n,t,r){function e(){return(this&&this!==$n&&this instanceof e?i:n).apply(u?r:this,arguments)}var u=1&t,i=Vr(n);return e}function Zr(n){return function(t){t=Iu(t);var r=Rn.test(t)?M(t):T,e=r?r[0]:t.charAt(0);return t=r?Or(r,1).join(""):t.slice(1),e[n]()+t}}function qr(n){return function(t){return l(Mu(Du(t).replace(kn,"")),n,"")}}function Vr(n){return function(){var t=arguments;switch(t.length){
case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=eo(n.prototype),t=n.apply(r,t);return du(t)?t:r}}function Kr(t,r,e){function u(){for(var o=arguments.length,f=Ku(o),c=o,a=de(u);c--;)f[c]=arguments[c];return c=3>o&&f[0]!==a&&f[o-1]!==a?[]:L(f,a),
o-=c.length,o<e?ue(t,r,Jr,u.placeholder,T,f,c,T,T,e-o):n(this&&this!==$n&&this instanceof u?i:t,this,f)}var i=Vr(t);return u}function Gr(n){return function(t,r,e){var u=Qu(t);if(!su(t)){var i=ye(r,3);t=Wu(t),r=function(n){return i(u[n],n,u)}}return r=n(t,r,e),-1<r?u[i?t[r]:r]:T}}function Hr(n){return pe(function(t){var r=t.length,e=r,u=On.prototype.thru;for(n&&t.reverse();e--;){var i=t[e];if(typeof i!="function")throw new ti("Expected a function");if(u&&!o&&"wrapper"==ge(i))var o=new On([],true)}for(e=o?e:r;++e<r;)var i=t[e],u=ge(i),f="wrapper"==u?ho(i):T,o=f&&Re(f[0])&&424==f[1]&&!f[4].length&&1==f[9]?o[ge(f[0])].apply(o,f[3]):1==i.length&&Re(i)?o[u]():o.thru(i);
return function(){var n=arguments,e=n[0];if(o&&1==n.length&&ff(e))return o.plant(e).value();for(var u=0,n=r?t[u].apply(this,n):e;++u<r;)n=t[u].call(this,n);return n}})}function Jr(n,t,r,e,u,i,o,f,c,a){function l(){for(var d=arguments.length,y=Ku(d),b=d;b--;)y[b]=arguments[b];if(_){var x,j=de(l),b=y.length;for(x=0;b--;)y[b]===j&&++x}if(e&&(y=Br(y,e,u,_)),i&&(y=Lr(y,i,o,_)),d-=x,_&&d<a)return j=L(y,j),ue(n,t,Jr,l.placeholder,r,y,j,f,c,a-d);if(j=h?r:this,b=p?j[n]:n,d=y.length,f){x=y.length;for(var w=Ci(f.length,x),m=Ur(y);w--;){
var A=f[w];y[w]=Se(A,x)?m[A]:T}}else v&&1<d&&y.reverse();return s&&c<d&&(y.length=c),this&&this!==$n&&this instanceof l&&(b=g||Vr(b)),b.apply(j,y)}var s=128&t,h=1&t,p=2&t,_=24&t,v=512&t,g=p?T:Vr(n);return l}function Yr(n,t){return function(r,e){return Bt(r,n,t(e))}}function Qr(n,t){return function(r,e){var u;if(r===T&&e===T)return t;if(r!==T&&(u=r),e!==T){if(u===T)return e;typeof r=="string"||typeof e=="string"?(r=yr(r),e=yr(e)):(r=dr(r),e=dr(e)),u=n(r,e)}return u}}function Xr(t){return pe(function(r){
return r=c(r,k(ye())),fr(function(e){var u=this;return t(r,function(t){return n(t,u,e)})})})}function ne(n,t){t=t===T?" ":yr(t);var r=t.length;return 2>r?r?or(t,n):t:(r=or(t,Oi(n/D(t))),Rn.test(t)?Or(M(r),0,n).join(""):r.slice(0,n))}function te(t,r,e,u){function i(){for(var r=-1,c=arguments.length,a=-1,l=u.length,s=Ku(l+c),h=this&&this!==$n&&this instanceof i?f:t;++a<l;)s[a]=u[a];for(;c--;)s[a++]=arguments[++r];return n(h,o?e:this,s)}var o=1&r,f=Vr(t);return i}function re(n){return function(t,r,e){
e&&typeof e!="number"&&Oe(t,r,e)&&(r=e=T),t=Au(t),r===T?(r=t,t=0):r=Au(r),e=e===T?t<r?1:-1:Au(e);var u=-1;r=Ui(Oi((r-t)/(e||1)),0);for(var i=Ku(r);r--;)i[n?r:++u]=t,t+=e;return i}}function ee(n){return function(t,r){return typeof t=="string"&&typeof r=="string"||(t=Su(t),r=Su(r)),n(t,r)}}function ue(n,t,r,e,u,i,o,f,c,a){var l=8&t,s=l?o:T;o=l?T:o;var h=l?i:T;return i=l?T:i,t=(t|(l?32:64))&~(l?64:32),4&t||(t&=-4),u=[n,t,u,h,s,i,o,f,c,a],r=r.apply(T,u),Re(n)&&yo(r,u),r.placeholder=e,Ue(r,n,t)}function ie(n){
var t=Yu[n];return function(n,r){if(n=Su(n),(r=null==r?0:Ci(Eu(r),292))&&Wi(n)){var e=(Iu(n)+"e").split("e"),e=t(e[0]+"e"+(+e[1]+r)),e=(Iu(e)+"e").split("e");return+(e[0]+"e"+(+e[1]-r))}return t(n)}}function oe(n){return function(t){var r=vo(t);return"[object Map]"==r?W(t):"[object Set]"==r?C(t):E(t,n(t))}}function fe(n,t,r,e,u,i,o,f){var c=2&t;if(!c&&typeof n!="function")throw new ti("Expected a function");var a=e?e.length:0;if(a||(t&=-97,e=u=T),o=o===T?o:Ui(Eu(o),0),f=f===T?f:Eu(f),a-=u?u.length:0,
64&t){var l=e,s=u;e=u=T}var h=c?T:ho(n);return i=[n,t,r,e,u,l,s,i,o,f],h&&(r=i[1],n=h[1],t=r|n,e=128==n&&8==r||128==n&&256==r&&i[7].length<=h[8]||384==n&&h[7].length<=h[8]&&8==r,131>t||e)&&(1&n&&(i[2]=h[2],t|=1&r?0:4),(r=h[3])&&(e=i[3],i[3]=e?Br(e,r,h[4]):r,i[4]=e?L(i[3],"__lodash_placeholder__"):h[4]),(r=h[5])&&(e=i[5],i[5]=e?Lr(e,r,h[6]):r,i[6]=e?L(i[5],"__lodash_placeholder__"):h[6]),(r=h[7])&&(i[7]=r),128&n&&(i[8]=null==i[8]?h[8]:Ci(i[8],h[8])),null==i[9]&&(i[9]=h[9]),i[0]=h[0],i[1]=t),n=i[0],
t=i[1],r=i[2],e=i[3],u=i[4],f=i[9]=i[9]===T?c?0:n.length:Ui(i[9]-a,0),!f&&24&t&&(t&=-25),Ue((h?co:yo)(t&&1!=t?8==t||16==t?Kr(n,t,f):32!=t&&33!=t||u.length?Jr.apply(T,i):te(n,t,r,e):Pr(n,t,r),i),n,t)}function ce(n,t,r,e){return n===T||lu(n,ei[r])&&!oi.call(e,r)?t:n}function ae(n,t,r,e,u,i){return du(n)&&du(t)&&(i.set(t,n),Yt(n,t,T,ae,i),i.delete(t)),n}function le(n){return xu(n)?T:n}function se(n,t,r,e,u,i){var o=1&r,f=n.length,c=t.length;if(f!=c&&!(o&&c>f))return false;if((c=i.get(n))&&i.get(t))return c==t;
var c=-1,a=true,l=2&r?new Nn:T;for(i.set(n,t),i.set(t,n);++c<f;){var s=n[c],p=t[c];if(e)var _=o?e(p,s,c,t,n,i):e(s,p,c,n,t,i);if(_!==T){if(_)continue;a=false;break}if(l){if(!h(t,function(n,t){if(!O(l,t)&&(s===n||u(s,n,r,e,i)))return l.push(t)})){a=false;break}}else if(s!==p&&!u(s,p,r,e,i)){a=false;break}}return i.delete(n),i.delete(t),a}function he(n,t,r,e,u,i,o){switch(r){case"[object DataView]":if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)break;n=n.buffer,t=t.buffer;case"[object ArrayBuffer]":
if(n.byteLength!=t.byteLength||!i(new vi(n),new vi(t)))break;return true;case"[object Boolean]":case"[object Date]":case"[object Number]":return lu(+n,+t);case"[object Error]":return n.name==t.name&&n.message==t.message;case"[object RegExp]":case"[object String]":return n==t+"";case"[object Map]":var f=W;case"[object Set]":if(f||(f=U),n.size!=t.size&&!(1&e))break;return(r=o.get(n))?r==t:(e|=2,o.set(n,t),t=se(f(n),f(t),e,u,i,o),o.delete(n),t);case"[object Symbol]":if(to)return to.call(n)==to.call(t)}
return false}function pe(n){return xo(Be(n,T,Ze),n+"")}function _e(n){return St(n,Wu,po)}function ve(n){return St(n,Bu,_o)}function ge(n){for(var t=n.name+"",r=Gi[t],e=oi.call(Gi,t)?r.length:0;e--;){var u=r[e],i=u.func;if(null==i||i==n)return u.name}return t}function de(n){return(oi.call(An,"placeholder")?An:n).placeholder}function ye(){var n=An.iteratee||Fu,n=n===Fu?qt:n;return arguments.length?n(arguments[0],arguments[1]):n}function be(n,t){var r=n.__data__,e=typeof t;return("string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t)?r[typeof t=="string"?"string":"hash"]:r.map;
}function xe(n){for(var t=Wu(n),r=t.length;r--;){var e=t[r],u=n[e];t[r]=[e,u,u===u&&!du(u)]}return t}function je(n,t){var r=null==n?T:n[t];return Ft(r)?r:T}function we(n,t,r){t=Sr(t,n);for(var e=-1,u=t.length,i=false;++e<u;){var o=Me(t[e]);if(!(i=null!=n&&r(n,o)))break;n=n[o]}return i||++e!=u?i:(u=null==n?0:n.length,!!u&&gu(u)&&Se(o,u)&&(ff(n)||of(n)))}function me(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&oi.call(n,"index")&&(r.index=n.index,r.input=n.input),r}function Ae(n){
return typeof n.constructor!="function"||ze(n)?{}:eo(di(n))}function Ee(n,t,r){var e=n.constructor;switch(t){case"[object ArrayBuffer]":return Rr(n);case"[object Boolean]":case"[object Date]":return new e(+n);case"[object DataView]":return t=r?Rr(n.buffer):n.buffer,new n.constructor(t,n.byteOffset,n.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":
case"[object Uint16Array]":case"[object Uint32Array]":return zr(n,r);case"[object Map]":return new e;case"[object Number]":case"[object String]":return new e(n);case"[object RegExp]":return t=new n.constructor(n.source,_n.exec(n)),t.lastIndex=n.lastIndex,t;case"[object Set]":return new e;case"[object Symbol]":return to?Qu(to.call(n)):{}}}function ke(n){return ff(n)||of(n)||!!(ji&&n&&n[ji])}function Se(n,t){var r=typeof n;return t=null==t?9007199254740991:t,!!t&&("number"==r||"symbol"!=r&&bn.test(n))&&-1<n&&0==n%1&&n<t;
}function Oe(n,t,r){if(!du(r))return false;var e=typeof t;return!!("number"==e?su(r)&&Se(t,r.length):"string"==e&&t in r)&&lu(r[t],n)}function Ie(n,t){if(ff(n))return false;var r=typeof n;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=n&&!wu(n))||(nn.test(n)||!X.test(n)||null!=t&&n in Qu(t))}function Re(n){var t=ge(n),r=An[t];return typeof r=="function"&&t in Un.prototype&&(n===r||(t=ho(r),!!t&&n===t[0]))}function ze(n){var t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||ei)}function We(n,t){
return function(r){return null!=r&&(r[n]===t&&(t!==T||n in Qu(r)))}}function Be(t,r,e){return r=Ui(r===T?t.length-1:r,0),function(){for(var u=arguments,i=-1,o=Ui(u.length-r,0),f=Ku(o);++i<o;)f[i]=u[r+i];for(i=-1,o=Ku(r+1);++i<r;)o[i]=u[i];return o[r]=e(f),n(t,this,o)}}function Le(n,t){if(("constructor"!==t||"function"!=typeof n[t])&&"__proto__"!=t)return n[t]}function Ue(n,t,r){var e=t+"";t=xo;var u,i=$e;return u=(u=e.match(an))?u[1].split(ln):[],r=i(u,r),(i=r.length)&&(u=i-1,r[u]=(1<i?"& ":"")+r[u],
r=r.join(2<i?", ":" "),e=e.replace(cn,"{\n/* [wrapped with "+r+"] */\n")),t(n,e)}function Ce(n){var t=0,r=0;return function(){var e=Di(),u=16-(e-r);if(r=e,0<u){if(800<=++t)return arguments[0]}else t=0;return n.apply(T,arguments)}}function De(n,t){var r=-1,e=n.length,u=e-1;for(t=t===T?e:t;++r<t;){var e=ir(r,u),i=n[e];n[e]=n[r],n[r]=i}return n.length=t,n}function Me(n){if(typeof n=="string"||wu(n))return n;var t=n+"";return"0"==t&&1/n==-$?"-0":t}function Te(n){if(null!=n){try{return ii.call(n)}catch(n){}
return n+""}return""}function $e(n,t){return r(N,function(r){var e="_."+r[0];t&r[1]&&!o(n,e)&&n.push(e)}),n.sort()}function Fe(n){if(n instanceof Un)return n.clone();var t=new On(n.__wrapped__,n.__chain__);return t.__actions__=Ur(n.__actions__),t.__index__=n.__index__,t.__values__=n.__values__,t}function Ne(n,t,r){var e=null==n?0:n.length;return e?(r=null==r?0:Eu(r),0>r&&(r=Ui(e+r,0)),_(n,ye(t,3),r)):-1}function Pe(n,t,r){var e=null==n?0:n.length;if(!e)return-1;var u=e-1;return r!==T&&(u=Eu(r),u=0>r?Ui(e+u,0):Ci(u,e-1)),
_(n,ye(t,3),u,true)}function Ze(n){return(null==n?0:n.length)?wt(n,1):[]}function qe(n){return n&&n.length?n[0]:T}function Ve(n){var t=null==n?0:n.length;return t?n[t-1]:T}function Ke(n,t){return n&&n.length&&t&&t.length?er(n,t):n}function Ge(n){return null==n?n:$i.call(n)}function He(n){if(!n||!n.length)return[];var t=0;return n=i(n,function(n){if(hu(n))return t=Ui(n.length,t),true}),A(t,function(t){return c(n,b(t))})}function Je(t,r){if(!t||!t.length)return[];var e=He(t);return null==r?e:c(e,function(t){
return n(r,T,t)})}function Ye(n){return n=An(n),n.__chain__=true,n}function Qe(n,t){return t(n)}function Xe(){return this}function nu(n,t){return(ff(n)?r:uo)(n,ye(t,3))}function tu(n,t){return(ff(n)?e:io)(n,ye(t,3))}function ru(n,t){return(ff(n)?c:Gt)(n,ye(t,3))}function eu(n,t,r){return t=r?T:t,t=n&&null==t?n.length:t,fe(n,128,T,T,T,T,t)}function uu(n,t){var r;if(typeof t!="function")throw new ti("Expected a function");return n=Eu(n),function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=T),
r}}function iu(n,t,r){return t=r?T:t,n=fe(n,8,T,T,T,T,T,t),n.placeholder=iu.placeholder,n}function ou(n,t,r){return t=r?T:t,n=fe(n,16,T,T,T,T,T,t),n.placeholder=ou.placeholder,n}function fu(n,t,r){function e(t){var r=c,e=a;return c=a=T,_=t,s=n.apply(e,r)}function u(n){var r=n-p;return n-=_,p===T||r>=t||0>r||g&&n>=l}function i(){var n=Go();if(u(n))return o(n);var r,e=bo;r=n-_,n=t-(n-p),r=g?Ci(n,l-r):n,h=e(i,r)}function o(n){return h=T,d&&c?e(n):(c=a=T,s)}function f(){var n=Go(),r=u(n);if(c=arguments,
a=this,p=n,r){if(h===T)return _=n=p,h=bo(i,t),v?e(n):s;if(g)return lo(h),h=bo(i,t),e(p)}return h===T&&(h=bo(i,t)),s}var c,a,l,s,h,p,_=0,v=false,g=false,d=true;if(typeof n!="function")throw new ti("Expected a function");return t=Su(t)||0,du(r)&&(v=!!r.leading,l=(g="maxWait"in r)?Ui(Su(r.maxWait)||0,t):l,d="trailing"in r?!!r.trailing:d),f.cancel=function(){h!==T&&lo(h),_=0,c=p=a=h=T},f.flush=function(){return h===T?s:o(Go())},f}function cu(n,t){function r(){var e=arguments,u=t?t.apply(this,e):e[0],i=r.cache;
return i.has(u)?i.get(u):(e=n.apply(this,e),r.cache=i.set(u,e)||i,e)}if(typeof n!="function"||null!=t&&typeof t!="function")throw new ti("Expected a function");return r.cache=new(cu.Cache||Fn),r}function au(n){if(typeof n!="function")throw new ti("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!n.call(this);case 1:return!n.call(this,t[0]);case 2:return!n.call(this,t[0],t[1]);case 3:return!n.call(this,t[0],t[1],t[2])}return!n.apply(this,t)}}function lu(n,t){return n===t||n!==n&&t!==t;
}function su(n){return null!=n&&gu(n.length)&&!_u(n)}function hu(n){return yu(n)&&su(n)}function pu(n){if(!yu(n))return false;var t=Ot(n);return"[object Error]"==t||"[object DOMException]"==t||typeof n.message=="string"&&typeof n.name=="string"&&!xu(n)}function _u(n){return!!du(n)&&(n=Ot(n),"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n)}function vu(n){return typeof n=="number"&&n==Eu(n)}function gu(n){return typeof n=="number"&&-1<n&&0==n%1&&9007199254740991>=n;
}function du(n){var t=typeof n;return null!=n&&("object"==t||"function"==t)}function yu(n){return null!=n&&typeof n=="object"}function bu(n){return typeof n=="number"||yu(n)&&"[object Number]"==Ot(n)}function xu(n){return!(!yu(n)||"[object Object]"!=Ot(n))&&(n=di(n),null===n||(n=oi.call(n,"constructor")&&n.constructor,typeof n=="function"&&n instanceof n&&ii.call(n)==li))}function ju(n){return typeof n=="string"||!ff(n)&&yu(n)&&"[object String]"==Ot(n)}function wu(n){return typeof n=="symbol"||yu(n)&&"[object Symbol]"==Ot(n);
}function mu(n){if(!n)return[];if(su(n))return ju(n)?M(n):Ur(n);if(wi&&n[wi]){n=n[wi]();for(var t,r=[];!(t=n.next()).done;)r.push(t.value);return r}return t=vo(n),("[object Map]"==t?W:"[object Set]"==t?U:Uu)(n)}function Au(n){return n?(n=Su(n),n===$||n===-$?1.7976931348623157e308*(0>n?-1:1):n===n?n:0):0===n?n:0}function Eu(n){n=Au(n);var t=n%1;return n===n?t?n-t:n:0}function ku(n){return n?pt(Eu(n),0,4294967295):0}function Su(n){if(typeof n=="number")return n;if(wu(n))return F;if(du(n)&&(n=typeof n.valueOf=="function"?n.valueOf():n,
n=du(n)?n+"":n),typeof n!="string")return 0===n?n:+n;n=n.replace(un,"");var t=gn.test(n);return t||yn.test(n)?Dn(n.slice(2),t?2:8):vn.test(n)?F:+n}function Ou(n){return Cr(n,Bu(n))}function Iu(n){return null==n?"":yr(n)}function Ru(n,t,r){return n=null==n?T:kt(n,t),n===T?r:n}function zu(n,t){return null!=n&&we(n,t,zt)}function Wu(n){return su(n)?qn(n):Vt(n)}function Bu(n){if(su(n))n=qn(n,true);else if(du(n)){var t,r=ze(n),e=[];for(t in n)("constructor"!=t||!r&&oi.call(n,t))&&e.push(t);n=e}else{if(t=[],
null!=n)for(r in Qu(n))t.push(r);n=t}return n}function Lu(n,t){if(null==n)return{};var r=c(ve(n),function(n){return[n]});return t=ye(t),tr(n,r,function(n,r){return t(n,r[0])})}function Uu(n){return null==n?[]:S(n,Wu(n))}function Cu(n){return $f(Iu(n).toLowerCase())}function Du(n){return(n=Iu(n))&&n.replace(xn,Xn).replace(Sn,"")}function Mu(n,t,r){return n=Iu(n),t=r?T:t,t===T?zn.test(n)?n.match(In)||[]:n.match(sn)||[]:n.match(t)||[]}function Tu(n){return function(){return n}}function $u(n){return n;
}function Fu(n){return qt(typeof n=="function"?n:_t(n,1))}function Nu(n,t,e){var u=Wu(t),i=Et(t,u);null!=e||du(t)&&(i.length||!u.length)||(e=t,t=n,n=this,i=Et(t,Wu(t)));var o=!(du(e)&&"chain"in e&&!e.chain),f=_u(n);return r(i,function(r){var e=t[r];n[r]=e,f&&(n.prototype[r]=function(){var t=this.__chain__;if(o||t){var r=n(this.__wrapped__);return(r.__actions__=Ur(this.__actions__)).push({func:e,args:arguments,thisArg:n}),r.__chain__=t,r}return e.apply(n,a([this.value()],arguments))})}),n}function Pu(){}
function Zu(n){return Ie(n)?b(Me(n)):rr(n)}function qu(){return[]}function Vu(){return false}mn=null==mn?$n:rt.defaults($n.Object(),mn,rt.pick($n,Wn));var Ku=mn.Array,Gu=mn.Date,Hu=mn.Error,Ju=mn.Function,Yu=mn.Math,Qu=mn.Object,Xu=mn.RegExp,ni=mn.String,ti=mn.TypeError,ri=Ku.prototype,ei=Qu.prototype,ui=mn["__core-js_shared__"],ii=Ju.prototype.toString,oi=ei.hasOwnProperty,fi=0,ci=function(){var n=/[^.]+$/.exec(ui&&ui.keys&&ui.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),ai=ei.toString,li=ii.call(Qu),si=$n._,hi=Xu("^"+ii.call(oi).replace(rn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),pi=Pn?mn.Buffer:T,_i=mn.Symbol,vi=mn.Uint8Array,gi=pi?pi.g:T,di=B(Qu.getPrototypeOf,Qu),yi=Qu.create,bi=ei.propertyIsEnumerable,xi=ri.splice,ji=_i?_i.isConcatSpreadable:T,wi=_i?_i.iterator:T,mi=_i?_i.toStringTag:T,Ai=function(){
try{var n=je(Qu,"defineProperty");return n({},"",{}),n}catch(n){}}(),Ei=mn.clearTimeout!==$n.clearTimeout&&mn.clearTimeout,ki=Gu&&Gu.now!==$n.Date.now&&Gu.now,Si=mn.setTimeout!==$n.setTimeout&&mn.setTimeout,Oi=Yu.ceil,Ii=Yu.floor,Ri=Qu.getOwnPropertySymbols,zi=pi?pi.isBuffer:T,Wi=mn.isFinite,Bi=ri.join,Li=B(Qu.keys,Qu),Ui=Yu.max,Ci=Yu.min,Di=Gu.now,Mi=mn.parseInt,Ti=Yu.random,$i=ri.reverse,Fi=je(mn,"DataView"),Ni=je(mn,"Map"),Pi=je(mn,"Promise"),Zi=je(mn,"Set"),qi=je(mn,"WeakMap"),Vi=je(Qu,"create"),Ki=qi&&new qi,Gi={},Hi=Te(Fi),Ji=Te(Ni),Yi=Te(Pi),Qi=Te(Zi),Xi=Te(qi),no=_i?_i.prototype:T,to=no?no.valueOf:T,ro=no?no.toString:T,eo=function(){
function n(){}return function(t){return du(t)?yi?yi(t):(n.prototype=t,t=new n,n.prototype=T,t):{}}}();An.templateSettings={escape:J,evaluate:Y,interpolate:Q,variable:"",imports:{_:An}},An.prototype=En.prototype,An.prototype.constructor=An,On.prototype=eo(En.prototype),On.prototype.constructor=On,Un.prototype=eo(En.prototype),Un.prototype.constructor=Un,Mn.prototype.clear=function(){this.__data__=Vi?Vi(null):{},this.size=0},Mn.prototype.delete=function(n){return n=this.has(n)&&delete this.__data__[n],
this.size-=n?1:0,n},Mn.prototype.get=function(n){var t=this.__data__;return Vi?(n=t[n],"__lodash_hash_undefined__"===n?T:n):oi.call(t,n)?t[n]:T},Mn.prototype.has=function(n){var t=this.__data__;return Vi?t[n]!==T:oi.call(t,n)},Mn.prototype.set=function(n,t){var r=this.__data__;return this.size+=this.has(n)?0:1,r[n]=Vi&&t===T?"__lodash_hash_undefined__":t,this},Tn.prototype.clear=function(){this.__data__=[],this.size=0},Tn.prototype.delete=function(n){var t=this.__data__;return n=ft(t,n),!(0>n)&&(n==t.length-1?t.pop():xi.call(t,n,1),
--this.size,true)},Tn.prototype.get=function(n){var t=this.__data__;return n=ft(t,n),0>n?T:t[n][1]},Tn.prototype.has=function(n){return-1<ft(this.__data__,n)},Tn.prototype.set=function(n,t){var r=this.__data__,e=ft(r,n);return 0>e?(++this.size,r.push([n,t])):r[e][1]=t,this},Fn.prototype.clear=function(){this.size=0,this.__data__={hash:new Mn,map:new(Ni||Tn),string:new Mn}},Fn.prototype.delete=function(n){return n=be(this,n).delete(n),this.size-=n?1:0,n},Fn.prototype.get=function(n){return be(this,n).get(n);
},Fn.prototype.has=function(n){return be(this,n).has(n)},Fn.prototype.set=function(n,t){var r=be(this,n),e=r.size;return r.set(n,t),this.size+=r.size==e?0:1,this},Nn.prototype.add=Nn.prototype.push=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this},Nn.prototype.has=function(n){return this.__data__.has(n)},Zn.prototype.clear=function(){this.__data__=new Tn,this.size=0},Zn.prototype.delete=function(n){var t=this.__data__;return n=t.delete(n),this.size=t.size,n},Zn.prototype.get=function(n){
return this.__data__.get(n)},Zn.prototype.has=function(n){return this.__data__.has(n)},Zn.prototype.set=function(n,t){var r=this.__data__;if(r instanceof Tn){var e=r.__data__;if(!Ni||199>e.length)return e.push([n,t]),this.size=++r.size,this;r=this.__data__=new Fn(e)}return r.set(n,t),this.size=r.size,this};var uo=Fr(mt),io=Fr(At,true),oo=Nr(),fo=Nr(true),co=Ki?function(n,t){return Ki.set(n,t),n}:$u,ao=Ai?function(n,t){return Ai(n,"toString",{configurable:true,enumerable:false,value:Tu(t),writable:true})}:$u,lo=Ei||function(n){
return $n.clearTimeout(n)},so=Zi&&1/U(new Zi([,-0]))[1]==$?function(n){return new Zi(n)}:Pu,ho=Ki?function(n){return Ki.get(n)}:Pu,po=Ri?function(n){return null==n?[]:(n=Qu(n),i(Ri(n),function(t){return bi.call(n,t)}))}:qu,_o=Ri?function(n){for(var t=[];n;)a(t,po(n)),n=di(n);return t}:qu,vo=Ot;(Fi&&"[object DataView]"!=vo(new Fi(new ArrayBuffer(1)))||Ni&&"[object Map]"!=vo(new Ni)||Pi&&"[object Promise]"!=vo(Pi.resolve())||Zi&&"[object Set]"!=vo(new Zi)||qi&&"[object WeakMap]"!=vo(new qi))&&(vo=function(n){
var t=Ot(n);if(n=(n="[object Object]"==t?n.constructor:T)?Te(n):"")switch(n){case Hi:return"[object DataView]";case Ji:return"[object Map]";case Yi:return"[object Promise]";case Qi:return"[object Set]";case Xi:return"[object WeakMap]"}return t});var go=ui?_u:Vu,yo=Ce(co),bo=Si||function(n,t){return $n.setTimeout(n,t)},xo=Ce(ao),jo=function(n){n=cu(n,function(n){return 500===t.size&&t.clear(),n});var t=n.cache;return n}(function(n){var t=[];return 46===n.charCodeAt(0)&&t.push(""),n.replace(tn,function(n,r,e,u){
t.push(e?u.replace(hn,"$1"):r||n)}),t}),wo=fr(function(n,t){return hu(n)?yt(n,wt(t,1,hu,true)):[]}),mo=fr(function(n,t){var r=Ve(t);return hu(r)&&(r=T),hu(n)?yt(n,wt(t,1,hu,true),ye(r,2)):[]}),Ao=fr(function(n,t){var r=Ve(t);return hu(r)&&(r=T),hu(n)?yt(n,wt(t,1,hu,true),T,r):[]}),Eo=fr(function(n){var t=c(n,Er);return t.length&&t[0]===n[0]?Wt(t):[]}),ko=fr(function(n){var t=Ve(n),r=c(n,Er);return t===Ve(r)?t=T:r.pop(),r.length&&r[0]===n[0]?Wt(r,ye(t,2)):[]}),So=fr(function(n){var t=Ve(n),r=c(n,Er);return(t=typeof t=="function"?t:T)&&r.pop(),
r.length&&r[0]===n[0]?Wt(r,T,t):[]}),Oo=fr(Ke),Io=pe(function(n,t){var r=null==n?0:n.length,e=ht(n,t);return ur(n,c(t,function(n){return Se(n,r)?+n:n}).sort(Wr)),e}),Ro=fr(function(n){return br(wt(n,1,hu,true))}),zo=fr(function(n){var t=Ve(n);return hu(t)&&(t=T),br(wt(n,1,hu,true),ye(t,2))}),Wo=fr(function(n){var t=Ve(n),t=typeof t=="function"?t:T;return br(wt(n,1,hu,true),T,t)}),Bo=fr(function(n,t){return hu(n)?yt(n,t):[]}),Lo=fr(function(n){return mr(i(n,hu))}),Uo=fr(function(n){var t=Ve(n);return hu(t)&&(t=T),
mr(i(n,hu),ye(t,2))}),Co=fr(function(n){var t=Ve(n),t=typeof t=="function"?t:T;return mr(i(n,hu),T,t)}),Do=fr(He),Mo=fr(function(n){var t=n.length,t=1<t?n[t-1]:T,t=typeof t=="function"?(n.pop(),t):T;return Je(n,t)}),To=pe(function(n){function t(t){return ht(t,n)}var r=n.length,e=r?n[0]:0,u=this.__wrapped__;return!(1<r||this.__actions__.length)&&u instanceof Un&&Se(e)?(u=u.slice(e,+e+(r?1:0)),u.__actions__.push({func:Qe,args:[t],thisArg:T}),new On(u,this.__chain__).thru(function(n){return r&&!n.length&&n.push(T),
n})):this.thru(t)}),$o=Tr(function(n,t,r){oi.call(n,r)?++n[r]:st(n,r,1)}),Fo=Gr(Ne),No=Gr(Pe),Po=Tr(function(n,t,r){oi.call(n,r)?n[r].push(t):st(n,r,[t])}),Zo=fr(function(t,r,e){var u=-1,i=typeof r=="function",o=su(t)?Ku(t.length):[];return uo(t,function(t){o[++u]=i?n(r,t,e):Lt(t,r,e)}),o}),qo=Tr(function(n,t,r){st(n,r,t)}),Vo=Tr(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),Ko=fr(function(n,t){if(null==n)return[];var r=t.length;return 1<r&&Oe(n,t[0],t[1])?t=[]:2<r&&Oe(t[0],t[1],t[2])&&(t=[t[0]]),
Xt(n,wt(t,1),[])}),Go=ki||function(){return $n.Date.now()},Ho=fr(function(n,t,r){var e=1;if(r.length)var u=L(r,de(Ho)),e=32|e;return fe(n,e,t,r,u)}),Jo=fr(function(n,t,r){var e=3;if(r.length)var u=L(r,de(Jo)),e=32|e;return fe(t,e,n,r,u)}),Yo=fr(function(n,t){return dt(n,1,t)}),Qo=fr(function(n,t,r){return dt(n,Su(t)||0,r)});cu.Cache=Fn;var Xo=fr(function(t,r){r=1==r.length&&ff(r[0])?c(r[0],k(ye())):c(wt(r,1),k(ye()));var e=r.length;return fr(function(u){for(var i=-1,o=Ci(u.length,e);++i<o;)u[i]=r[i].call(this,u[i]);
return n(t,this,u)})}),nf=fr(function(n,t){return fe(n,32,T,t,L(t,de(nf)))}),tf=fr(function(n,t){return fe(n,64,T,t,L(t,de(tf)))}),rf=pe(function(n,t){return fe(n,256,T,T,T,t)}),ef=ee(It),uf=ee(function(n,t){return n>=t}),of=Ut(function(){return arguments}())?Ut:function(n){return yu(n)&&oi.call(n,"callee")&&!bi.call(n,"callee")},ff=Ku.isArray,cf=Vn?k(Vn):Ct,af=zi||Vu,lf=Kn?k(Kn):Dt,sf=Gn?k(Gn):Tt,hf=Hn?k(Hn):Nt,pf=Jn?k(Jn):Pt,_f=Yn?k(Yn):Zt,vf=ee(Kt),gf=ee(function(n,t){return n<=t}),df=$r(function(n,t){
if(ze(t)||su(t))Cr(t,Wu(t),n);else for(var r in t)oi.call(t,r)&&ot(n,r,t[r])}),yf=$r(function(n,t){Cr(t,Bu(t),n)}),bf=$r(function(n,t,r,e){Cr(t,Bu(t),n,e)}),xf=$r(function(n,t,r,e){Cr(t,Wu(t),n,e)}),jf=pe(ht),wf=fr(function(n,t){n=Qu(n);var r=-1,e=t.length,u=2<e?t[2]:T;for(u&&Oe(t[0],t[1],u)&&(e=1);++r<e;)for(var u=t[r],i=Bu(u),o=-1,f=i.length;++o<f;){var c=i[o],a=n[c];(a===T||lu(a,ei[c])&&!oi.call(n,c))&&(n[c]=u[c])}return n}),mf=fr(function(t){return t.push(T,ae),n(Of,T,t)}),Af=Yr(function(n,t,r){
null!=t&&typeof t.toString!="function"&&(t=ai.call(t)),n[t]=r},Tu($u)),Ef=Yr(function(n,t,r){null!=t&&typeof t.toString!="function"&&(t=ai.call(t)),oi.call(n,t)?n[t].push(r):n[t]=[r]},ye),kf=fr(Lt),Sf=$r(function(n,t,r){Yt(n,t,r)}),Of=$r(function(n,t,r,e){Yt(n,t,r,e)}),If=pe(function(n,t){var r={};if(null==n)return r;var e=false;t=c(t,function(t){return t=Sr(t,n),e||(e=1<t.length),t}),Cr(n,ve(n),r),e&&(r=_t(r,7,le));for(var u=t.length;u--;)xr(r,t[u]);return r}),Rf=pe(function(n,t){return null==n?{}:nr(n,t);
}),zf=oe(Wu),Wf=oe(Bu),Bf=qr(function(n,t,r){return t=t.toLowerCase(),n+(r?Cu(t):t)}),Lf=qr(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),Uf=qr(function(n,t,r){return n+(r?" ":"")+t.toLowerCase()}),Cf=Zr("toLowerCase"),Df=qr(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),Mf=qr(function(n,t,r){return n+(r?" ":"")+$f(t)}),Tf=qr(function(n,t,r){return n+(r?" ":"")+t.toUpperCase()}),$f=Zr("toUpperCase"),Ff=fr(function(t,r){try{return n(t,T,r)}catch(n){return pu(n)?n:new Hu(n)}}),Nf=pe(function(n,t){
return r(t,function(t){t=Me(t),st(n,t,Ho(n[t],n))}),n}),Pf=Hr(),Zf=Hr(true),qf=fr(function(n,t){return function(r){return Lt(r,n,t)}}),Vf=fr(function(n,t){return function(r){return Lt(n,r,t)}}),Kf=Xr(c),Gf=Xr(u),Hf=Xr(h),Jf=re(),Yf=re(true),Qf=Qr(function(n,t){return n+t},0),Xf=ie("ceil"),nc=Qr(function(n,t){return n/t},1),tc=ie("floor"),rc=Qr(function(n,t){return n*t},1),ec=ie("round"),uc=Qr(function(n,t){return n-t},0);return An.after=function(n,t){if(typeof t!="function")throw new ti("Expected a function");
return n=Eu(n),function(){if(1>--n)return t.apply(this,arguments)}},An.ary=eu,An.assign=df,An.assignIn=yf,An.assignInWith=bf,An.assignWith=xf,An.at=jf,An.before=uu,An.bind=Ho,An.bindAll=Nf,An.bindKey=Jo,An.castArray=function(){if(!arguments.length)return[];var n=arguments[0];return ff(n)?n:[n]},An.chain=Ye,An.chunk=function(n,t,r){if(t=(r?Oe(n,t,r):t===T)?1:Ui(Eu(t),0),r=null==n?0:n.length,!r||1>t)return[];for(var e=0,u=0,i=Ku(Oi(r/t));e<r;)i[u++]=hr(n,e,e+=t);return i},An.compact=function(n){for(var t=-1,r=null==n?0:n.length,e=0,u=[];++t<r;){
var i=n[t];i&&(u[e++]=i)}return u},An.concat=function(){var n=arguments.length;if(!n)return[];for(var t=Ku(n-1),r=arguments[0];n--;)t[n-1]=arguments[n];return a(ff(r)?Ur(r):[r],wt(t,1))},An.cond=function(t){var r=null==t?0:t.length,e=ye();return t=r?c(t,function(n){if("function"!=typeof n[1])throw new ti("Expected a function");return[e(n[0]),n[1]]}):[],fr(function(e){for(var u=-1;++u<r;){var i=t[u];if(n(i[0],this,e))return n(i[1],this,e)}})},An.conforms=function(n){return vt(_t(n,1))},An.constant=Tu,
An.countBy=$o,An.create=function(n,t){var r=eo(n);return null==t?r:at(r,t)},An.curry=iu,An.curryRight=ou,An.debounce=fu,An.defaults=wf,An.defaultsDeep=mf,An.defer=Yo,An.delay=Qo,An.difference=wo,An.differenceBy=mo,An.differenceWith=Ao,An.drop=function(n,t,r){var e=null==n?0:n.length;return e?(t=r||t===T?1:Eu(t),hr(n,0>t?0:t,e)):[]},An.dropRight=function(n,t,r){var e=null==n?0:n.length;return e?(t=r||t===T?1:Eu(t),t=e-t,hr(n,0,0>t?0:t)):[]},An.dropRightWhile=function(n,t){return n&&n.length?jr(n,ye(t,3),true,true):[];
},An.dropWhile=function(n,t){return n&&n.length?jr(n,ye(t,3),true):[]},An.fill=function(n,t,r,e){var u=null==n?0:n.length;if(!u)return[];for(r&&typeof r!="number"&&Oe(n,t,r)&&(r=0,e=u),u=n.length,r=Eu(r),0>r&&(r=-r>u?0:u+r),e=e===T||e>u?u:Eu(e),0>e&&(e+=u),e=r>e?0:ku(e);r<e;)n[r++]=t;return n},An.filter=function(n,t){return(ff(n)?i:jt)(n,ye(t,3))},An.flatMap=function(n,t){return wt(ru(n,t),1)},An.flatMapDeep=function(n,t){return wt(ru(n,t),sdk_$)},An.flatMapDepth=function(n,t,r){return r=r===T?1:Eu(r),
wt(ru(n,t),r)},An.flatten=Ze,An.flattenDeep=function(n){return(null==n?0:n.length)?wt(n,sdk_$):[]},An.flattenDepth=function(n,t){return null!=n&&n.length?(t=t===T?1:Eu(t),wt(n,t)):[]},An.flip=function(n){return fe(n,512)},An.flow=Pf,An.flowRight=Zf,An.fromPairs=function(n){for(var t=-1,r=null==n?0:n.length,e={};++t<r;){var u=n[t];e[u[0]]=u[1]}return e},An.functions=function(n){return null==n?[]:Et(n,Wu(n))},An.functionsIn=function(n){return null==n?[]:Et(n,Bu(n))},An.groupBy=Po,An.initial=function(n){
return(null==n?0:n.length)?hr(n,0,-1):[]},An.intersection=Eo,An.intersectionBy=ko,An.intersectionWith=So,An.invert=Af,An.invertBy=Ef,An.invokeMap=Zo,An.iteratee=Fu,An.keyBy=qo,An.keys=Wu,An.keysIn=Bu,An.map=ru,An.mapKeys=function(n,t){var r={};return t=ye(t,3),mt(n,function(n,e,u){st(r,t(n,e,u),n)}),r},An.mapValues=function(n,t){var r={};return t=ye(t,3),mt(n,function(n,e,u){st(r,e,t(n,e,u))}),r},An.matches=function(n){return Ht(_t(n,1))},An.matchesProperty=function(n,t){return Jt(n,_t(t,1))},An.memoize=cu,
An.merge=Sf,An.mergeWith=Of,An.method=qf,An.methodOf=Vf,An.mixin=Nu,An.negate=au,An.nthArg=function(n){return n=Eu(n),fr(function(t){return Qt(t,n)})},An.omit=If,An.omitBy=function(n,t){return Lu(n,au(ye(t)))},An.once=function(n){return uu(2,n)},An.orderBy=function(n,t,r,e){return null==n?[]:(ff(t)||(t=null==t?[]:[t]),r=e?T:r,ff(r)||(r=null==r?[]:[r]),Xt(n,t,r))},An.over=Kf,An.overArgs=Xo,An.overEvery=Gf,An.overSome=Hf,An.partial=nf,An.partialRight=tf,An.partition=Vo,An.pick=Rf,An.pickBy=Lu,An.property=Zu,
An.propertyOf=function(n){return function(t){return null==n?T:kt(n,t)}},An.pull=Oo,An.pullAll=Ke,An.pullAllBy=function(n,t,r){return n&&n.length&&t&&t.length?er(n,t,ye(r,2)):n},An.pullAllWith=function(n,t,r){return n&&n.length&&t&&t.length?er(n,t,T,r):n},An.pullAt=Io,An.range=Jf,An.rangeRight=Yf,An.rearg=rf,An.reject=function(n,t){return(ff(n)?i:jt)(n,au(ye(t,3)))},An.remove=function(n,t){var r=[];if(!n||!n.length)return r;var e=-1,u=[],i=n.length;for(t=ye(t,3);++e<i;){var o=n[e];t(o,e,n)&&(r.push(o),
u.push(e))}return ur(n,u),r},An.rest=function(n,t){if(typeof n!="function")throw new ti("Expected a function");return t=t===T?t:Eu(t),fr(n,t)},An.reverse=Ge,An.sampleSize=function(n,t,r){return t=(r?Oe(n,t,r):t===T)?1:Eu(t),(ff(n)?et:ar)(n,t)},An.set=function(n,t,r){return null==n?n:lr(n,t,r)},An.setWith=function(n,t,r,e){return e=typeof e=="function"?e:T,null==n?n:lr(n,t,r,e)},An.shuffle=function(n){return(ff(n)?ut:sr)(n)},An.slice=function(n,t,r){var e=null==n?0:n.length;return e?(r&&typeof r!="number"&&Oe(n,t,r)?(t=0,
r=e):(t=null==t?0:Eu(t),r=r===T?e:Eu(r)),hr(n,t,r)):[]},An.sortBy=Ko,An.sortedUniq=function(n){return n&&n.length?gr(n):[]},An.sortedUniqBy=function(n,t){return n&&n.length?gr(n,ye(t,2)):[]},An.split=function(n,t,r){return r&&typeof r!="number"&&Oe(n,t,r)&&(t=r=T),r=r===T?4294967295:r>>>0,r?(n=Iu(n))&&(typeof t=="string"||null!=t&&!hf(t))&&(t=yr(t),!t&&Rn.test(n))?Or(M(n),0,r):n.split(t,r):[]},An.spread=function(t,r){if(typeof t!="function")throw new ti("Expected a function");return r=null==r?0:Ui(Eu(r),0),
fr(function(e){var u=e[r];return e=Or(e,0,r),u&&a(e,u),n(t,this,e)})},An.tail=function(n){var t=null==n?0:n.length;return t?hr(n,1,t):[]},An.take=function(n,t,r){return n&&n.length?(t=r||t===T?1:Eu(t),hr(n,0,0>t?0:t)):[]},An.takeRight=function(n,t,r){var e=null==n?0:n.length;return e?(t=r||t===T?1:Eu(t),t=e-t,hr(n,0>t?0:t,e)):[]},An.takeRightWhile=function(n,t){return n&&n.length?jr(n,ye(t,3),false,true):[]},An.takeWhile=function(n,t){return n&&n.length?jr(n,ye(t,3)):[]},An.tap=function(n,t){return t(n),
n},An.throttle=function(n,t,r){var e=true,u=true;if(typeof n!="function")throw new ti("Expected a function");return du(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),fu(n,t,{leading:e,maxWait:t,trailing:u})},An.thru=Qe,An.toArray=mu,An.toPairs=zf,An.toPairsIn=Wf,An.toPath=function(n){return ff(n)?c(n,Me):wu(n)?[n]:Ur(jo(Iu(n)))},An.toPlainObject=Ou,An.transform=function(n,t,e){var u=ff(n),i=u||af(n)||_f(n);if(t=ye(t,4),null==e){var o=n&&n.constructor;e=i?u?new o:[]:du(n)&&_u(o)?eo(di(n)):{};
}return(i?r:mt)(n,function(n,r,u){return t(e,n,r,u)}),e},An.unary=function(n){return eu(n,1)},An.union=Ro,An.unionBy=zo,An.unionWith=Wo,An.uniq=function(n){return n&&n.length?br(n):[]},An.uniqBy=function(n,t){return n&&n.length?br(n,ye(t,2)):[]},An.uniqWith=function(n,t){return t=typeof t=="function"?t:T,n&&n.length?br(n,T,t):[]},An.unset=function(n,t){return null==n||xr(n,t)},An.unzip=He,An.unzipWith=Je,An.update=function(n,t,r){return null==n?n:lr(n,t,kr(r)(kt(n,t)),void 0)},An.updateWith=function(n,t,r,e){
return e=typeof e=="function"?e:T,null!=n&&(n=lr(n,t,kr(r)(kt(n,t)),e)),n},An.values=Uu,An.valuesIn=function(n){return null==n?[]:S(n,Bu(n))},An.without=Bo,An.words=Mu,An.wrap=function(n,t){return nf(kr(t),n)},An.xor=Lo,An.xorBy=Uo,An.xorWith=Co,An.zip=Do,An.zipObject=function(n,t){return Ar(n||[],t||[],ot)},An.zipObjectDeep=function(n,t){return Ar(n||[],t||[],lr)},An.zipWith=Mo,An.entries=zf,An.entriesIn=Wf,An.extend=yf,An.extendWith=bf,Nu(An,An),An.add=Qf,An.attempt=Ff,An.camelCase=Bf,An.capitalize=Cu,
An.ceil=Xf,An.clamp=function(n,t,r){return r===T&&(r=t,t=T),r!==T&&(r=Su(r),r=r===r?r:0),t!==T&&(t=Su(t),t=t===t?t:0),pt(Su(n),t,r)},An.clone=function(n){return _t(n,4)},An.cloneDeep=function(n){return _t(n,5)},An.cloneDeepWith=function(n,t){return t=typeof t=="function"?t:T,_t(n,5,t)},An.cloneWith=function(n,t){return t=typeof t=="function"?t:T,_t(n,4,t)},An.conformsTo=function(n,t){return null==t||gt(n,t,Wu(t))},An.deburr=Du,An.defaultTo=function(n,t){return null==n||n!==n?t:n},An.divide=nc,An.endsWith=function(n,t,r){
n=Iu(n),t=yr(t);var e=n.length,e=r=r===T?e:pt(Eu(r),0,e);return r-=t.length,0<=r&&n.slice(r,e)==t},An.eq=lu,An.escape=function(n){return(n=Iu(n))&&H.test(n)?n.replace(K,nt):n},An.escapeRegExp=function(n){return(n=Iu(n))&&en.test(n)?n.replace(rn,"\\$&"):n},An.every=function(n,t,r){var e=ff(n)?u:bt;return r&&Oe(n,t,r)&&(t=T),e(n,ye(t,3))},An.find=Fo,An.findIndex=Ne,An.findKey=function(n,t){return p(n,ye(t,3),mt)},An.findLast=No,An.findLastIndex=Pe,An.findLastKey=function(n,t){return p(n,ye(t,3),At);
},An.floor=tc,An.forEach=nu,An.forEachRight=tu,An.forIn=function(n,t){return null==n?n:oo(n,ye(t,3),Bu)},An.forInRight=function(n,t){return null==n?n:fo(n,ye(t,3),Bu)},An.forOwn=function(n,t){return n&&mt(n,ye(t,3))},An.forOwnRight=function(n,t){return n&&At(n,ye(t,3))},An.get=Ru,An.gt=ef,An.gte=uf,An.has=function(n,t){return null!=n&&we(n,t,Rt)},An.hasIn=zu,An.head=qe,An.identity=$u,An.includes=function(n,t,r,e){return n=su(n)?n:Uu(n),r=r&&!e?Eu(r):0,e=n.length,0>r&&(r=Ui(e+r,0)),ju(n)?r<=e&&-1<n.indexOf(t,r):!!e&&-1<v(n,t,r);
},An.indexOf=function(n,t,r){var e=null==n?0:n.length;return e?(r=null==r?0:Eu(r),0>r&&(r=Ui(e+r,0)),v(n,t,r)):-1},An.inRange=function(n,t,r){return t=Au(t),r===T?(r=t,t=0):r=Au(r),n=Su(n),n>=Ci(t,r)&&n<Ui(t,r)},An.invoke=kf,An.isArguments=of,An.isArray=ff,An.isArrayBuffer=cf,An.isArrayLike=su,An.isArrayLikeObject=hu,An.isBoolean=function(n){return true===n||false===n||yu(n)&&"[object Boolean]"==Ot(n)},An.isBuffer=af,An.isDate=lf,An.isElement=function(n){return yu(n)&&1===n.nodeType&&!xu(n)},An.isEmpty=function(n){
if(null==n)return true;if(su(n)&&(ff(n)||typeof n=="string"||typeof n.splice=="function"||af(n)||_f(n)||of(n)))return!n.length;var t=vo(n);if("[object Map]"==t||"[object Set]"==t)return!n.size;if(ze(n))return!Vt(n).length;for(var r in n)if(oi.call(n,r))return false;return true},An.isEqual=function(n,t){return Mt(n,t)},An.isEqualWith=function(n,t,r){var e=(r=typeof r=="function"?r:T)?r(n,t):T;return e===T?Mt(n,t,T,r):!!e},An.isError=pu,An.isFinite=function(n){return typeof n=="number"&&Wi(n)},An.isFunction=_u,
An.isInteger=vu,An.isLength=gu,An.isMap=sf,An.isMatch=function(n,t){return n===t||$t(n,t,xe(t))},An.isMatchWith=function(n,t,r){return r=typeof r=="function"?r:T,$t(n,t,xe(t),r)},An.isNaN=function(n){return bu(n)&&n!=+n},An.isNative=function(n){if(go(n))throw new Hu("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ft(n)},An.isNil=function(n){return null==n},An.isNull=function(n){return null===n},An.isNumber=bu,An.isObject=du,An.isObjectLike=yu,An.isPlainObject=xu,An.isRegExp=hf,
An.isSafeInteger=function(n){return vu(n)&&-9007199254740991<=n&&9007199254740991>=n},An.isSet=pf,An.isString=ju,An.isSymbol=wu,An.isTypedArray=_f,An.isUndefined=function(n){return n===T},An.isWeakMap=function(n){return yu(n)&&"[object WeakMap]"==vo(n)},An.isWeakSet=function(n){return yu(n)&&"[object WeakSet]"==Ot(n)},An.join=function(n,t){return null==n?"":Bi.call(n,t)},An.kebabCase=Lf,An.last=Ve,An.lastIndexOf=function(n,t,r){var e=null==n?0:n.length;if(!e)return-1;var u=e;if(r!==T&&(u=Eu(r),u=0>u?Ui(e+u,0):Ci(u,e-1)),
t===t){for(r=u+1;r--&&n[r]!==t;);n=r}else n=_(n,d,u,true);return n},An.lowerCase=Uf,An.lowerFirst=Cf,An.lt=vf,An.lte=gf,An.max=function(n){return n&&n.length?xt(n,$u,It):T},An.maxBy=function(n,t){return n&&n.length?xt(n,ye(t,2),It):T},An.mean=function(n){return y(n,$u)},An.meanBy=function(n,t){return y(n,ye(t,2))},An.min=function(n){return n&&n.length?xt(n,$u,Kt):T},An.minBy=function(n,t){return n&&n.length?xt(n,ye(t,2),Kt):T},An.stubArray=qu,An.stubFalse=Vu,An.stubObject=function(){return{}},An.stubString=function(){
return""},An.stubTrue=function(){return true},An.multiply=rc,An.nth=function(n,t){return n&&n.length?Qt(n,Eu(t)):T},An.noConflict=function(){return $n._===this&&($n._=si),this},An.noop=Pu,An.now=Go,An.pad=function(n,t,r){n=Iu(n);var e=(t=Eu(t))?D(n):0;return!t||e>=t?n:(t=(t-e)/2,ne(Ii(t),r)+n+ne(Oi(t),r))},An.padEnd=function(n,t,r){n=Iu(n);var e=(t=Eu(t))?D(n):0;return t&&e<t?n+ne(t-e,r):n},An.padStart=function(n,t,r){n=Iu(n);var e=(t=Eu(t))?D(n):0;return t&&e<t?ne(t-e,r)+n:n},An.parseInt=function(n,t,r){
return r||null==t?t=0:t&&(t=+t),Mi(Iu(n).replace(on,""),t||0)},An.random=function(n,t,r){if(r&&typeof r!="boolean"&&Oe(n,t,r)&&(t=r=T),r===T&&(typeof t=="boolean"?(r=t,t=T):typeof n=="boolean"&&(r=n,n=T)),n===T&&t===T?(n=0,t=1):(n=Au(n),t===T?(t=n,n=0):t=Au(t)),n>t){var e=n;n=t,t=e}return r||n%1||t%1?(r=Ti(),Ci(n+r*(t-n+Cn("1e-"+((r+"").length-1))),t)):ir(n,t)},An.reduce=function(n,t,r){var e=ff(n)?l:j,u=3>arguments.length;return e(n,ye(t,4),r,u,uo)},An.reduceRight=function(n,t,r){var e=ff(n)?s:j,u=3>arguments.length;
return e(n,ye(t,4),r,u,io)},An.repeat=function(n,t,r){return t=(r?Oe(n,t,r):t===T)?1:Eu(t),or(Iu(n),t)},An.replace=function(){var n=arguments,t=Iu(n[0]);return 3>n.length?t:t.replace(n[1],n[2])},An.result=function(n,t,r){t=Sr(t,n);var e=-1,u=t.length;for(u||(u=1,n=T);++e<u;){var i=null==n?T:n[Me(t[e])];i===T&&(e=u,i=r),n=_u(i)?i.call(n):i}return n},An.round=ec,An.runInContext=x,An.sample=function(n){return(ff(n)?Qn:cr)(n)},An.size=function(n){if(null==n)return 0;if(su(n))return ju(n)?D(n):n.length;
var t=vo(n);return"[object Map]"==t||"[object Set]"==t?n.size:Vt(n).length},An.snakeCase=Df,An.some=function(n,t,r){var e=ff(n)?h:pr;return r&&Oe(n,t,r)&&(t=T),e(n,ye(t,3))},An.sortedIndex=function(n,t){return _r(n,t)},An.sortedIndexBy=function(n,t,r){return vr(n,t,ye(r,2))},An.sortedIndexOf=function(n,t){var r=null==n?0:n.length;if(r){var e=_r(n,t);if(e<r&&lu(n[e],t))return e}return-1},An.sortedLastIndex=function(n,t){return _r(n,t,true)},An.sortedLastIndexBy=function(n,t,r){return vr(n,t,ye(r,2),true);
},An.sortedLastIndexOf=function(n,t){if(null==n?0:n.length){var r=_r(n,t,true)-1;if(lu(n[r],t))return r}return-1},An.startCase=Mf,An.startsWith=function(n,t,r){return n=Iu(n),r=null==r?0:pt(Eu(r),0,n.length),t=yr(t),n.slice(r,r+t.length)==t},An.subtract=uc,An.sum=function(n){return n&&n.length?m(n,$u):0},An.sumBy=function(n,t){return n&&n.length?m(n,ye(t,2)):0},An.template=function(n,t,r){var e=An.templateSettings;r&&Oe(n,t,r)&&(t=T),n=Iu(n),t=bf({},t,e,ce),r=bf({},t.imports,e.imports,ce);var u,i,o=Wu(r),f=S(r,o),c=0;
r=t.interpolate||jn;var a="__p+='";r=Xu((t.escape||jn).source+"|"+r.source+"|"+(r===Q?pn:jn).source+"|"+(t.evaluate||jn).source+"|$","g");var l=oi.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";if(n.replace(r,function(t,r,e,o,f,l){return e||(e=o),a+=n.slice(c,l).replace(wn,z),r&&(u=true,a+="'+__e("+r+")+'"),f&&(i=true,a+="';"+f+";\n__p+='"),e&&(a+="'+((__t=("+e+"))==null?'':__t)+'"),c=l+t.length,t}),a+="';",(t=oi.call(t,"variable")&&t.variable)||(a="with(obj){"+a+"}"),
a=(i?a.replace(P,""):a).replace(Z,"$1").replace(q,"$1;"),a="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(u?",__e=_.escape":"")+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+a+"return __p}",t=Ff(function(){return Ju(o,l+"return "+a).apply(T,f)}),t.source=a,pu(t))throw t;return t},An.times=function(n,t){if(n=Eu(n),1>n||9007199254740991<n)return[];var r=4294967295,e=Ci(n,4294967295);for(t=ye(t),n-=4294967295,e=A(e,t);++r<n;)t(r);return e},An.toFinite=Au,
An.toInteger=Eu,An.toLength=ku,An.toLower=function(n){return Iu(n).toLowerCase()},An.toNumber=Su,An.toSafeInteger=function(n){return n?pt(Eu(n),-9007199254740991,9007199254740991):0===n?n:0},An.toString=Iu,An.toUpper=function(n){return Iu(n).toUpperCase()},An.trim=function(n,t,r){return(n=Iu(n))&&(r||t===T)?n.replace(un,""):n&&(t=yr(t))?(n=M(n),r=M(t),t=I(n,r),r=R(n,r)+1,Or(n,t,r).join("")):n},An.trimEnd=function(n,t,r){return(n=Iu(n))&&(r||t===T)?n.replace(fn,""):n&&(t=yr(t))?(n=M(n),t=R(n,M(t))+1,
Or(n,0,t).join("")):n},An.trimStart=function(n,t,r){return(n=Iu(n))&&(r||t===T)?n.replace(on,""):n&&(t=yr(t))?(n=M(n),t=I(n,M(t)),Or(n,t).join("")):n},An.truncate=function(n,t){var r=30,e="...";if(du(t))var u="separator"in t?t.separator:u,r="length"in t?Eu(t.length):r,e="omission"in t?yr(t.omission):e;n=Iu(n);var i=n.length;if(Rn.test(n))var o=M(n),i=o.length;if(r>=i)return n;if(i=r-D(e),1>i)return e;if(r=o?Or(o,0,i).join(""):n.slice(0,i),u===T)return r+e;if(o&&(i+=r.length-i),hf(u)){if(n.slice(i).search(u)){
var f=r;for(u.global||(u=Xu(u.source,Iu(_n.exec(u))+"g")),u.lastIndex=0;o=u.exec(f);)var c=o.index;r=r.slice(0,c===T?i:c)}}else n.indexOf(yr(u),i)!=i&&(u=r.lastIndexOf(u),-1<u&&(r=r.slice(0,u)));return r+e},An.unescape=function(n){return(n=Iu(n))&&G.test(n)?n.replace(V,tt):n},An.uniqueId=function(n){var t=++fi;return Iu(n)+t},An.upperCase=Tf,An.upperFirst=$f,An.each=nu,An.eachRight=tu,An.first=qe,Nu(An,function(){var n={};return mt(An,function(t,r){oi.call(An.prototype,r)||(n[r]=t)}),n}(),{chain:false
}),An.VERSION="4.17.15",r("bind bindKey curry curryRight partial partialRight".split(" "),function(n){An[n].placeholder=An}),r(["drop","take"],function(n,t){Un.prototype[n]=function(r){r=r===T?1:Ui(Eu(r),0);var e=this.__filtered__&&!t?new Un(this):this.clone();return e.__filtered__?e.__takeCount__=Ci(r,e.__takeCount__):e.__views__.push({size:Ci(r,4294967295),type:n+(0>e.__dir__?"Right":"")}),e},Un.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),r(["filter","map","takeWhile"],function(n,t){
var r=t+1,e=1==r||3==r;Un.prototype[n]=function(n){var t=this.clone();return t.__iteratees__.push({iteratee:ye(n,3),type:r}),t.__filtered__=t.__filtered__||e,t}}),r(["head","last"],function(n,t){var r="take"+(t?"Right":"");Un.prototype[n]=function(){return this[r](1).value()[0]}}),r(["initial","tail"],function(n,t){var r="drop"+(t?"":"Right");Un.prototype[n]=function(){return this.__filtered__?new Un(this):this[r](1)}}),Un.prototype.compact=function(){return this.filter($u)},Un.prototype.find=function(n){
return this.filter(n).head()},Un.prototype.findLast=function(n){return this.reverse().find(n)},Un.prototype.invokeMap=fr(function(n,t){return typeof n=="function"?new Un(this):this.map(function(r){return Lt(r,n,t)})}),Un.prototype.reject=function(n){return this.filter(au(ye(n)))},Un.prototype.slice=function(n,t){n=Eu(n);var r=this;return r.__filtered__&&(0<n||0>t)?new Un(r):(0>n?r=r.takeRight(-n):n&&(r=r.drop(n)),t!==T&&(t=Eu(t),r=0>t?r.dropRight(-t):r.take(t-n)),r)},Un.prototype.takeRightWhile=function(n){
return this.reverse().takeWhile(n).reverse()},Un.prototype.toArray=function(){return this.take(4294967295)},mt(Un.prototype,function(n,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),e=/^(?:head|last)$/.test(t),u=An[e?"take"+("last"==t?"Right":""):t],i=e||/^find/.test(t);u&&(An.prototype[t]=function(){function t(n){return n=u.apply(An,a([n],f)),e&&h?n[0]:n}var o=this.__wrapped__,f=e?[1]:arguments,c=o instanceof Un,l=f[0],s=c||ff(o);s&&r&&typeof l=="function"&&1!=l.length&&(c=s=false);var h=this.__chain__,p=!!this.__actions__.length,l=i&&!h,c=c&&!p;
return!i&&s?(o=c?o:new Un(this),o=n.apply(o,f),o.__actions__.push({func:Qe,args:[t],thisArg:T}),new On(o,h)):l&&c?n.apply(this,f):(o=this.thru(t),l?e?o.value()[0]:o.value():o)})}),r("pop push shift sort splice unshift".split(" "),function(n){var t=ri[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:pop|shift)$/.test(n);An.prototype[n]=function(){var n=arguments;if(e&&!this.__chain__){var u=this.value();return t.apply(ff(u)?u:[],n)}return this[r](function(r){return t.apply(ff(r)?r:[],n)});
}}),mt(Un.prototype,function(n,t){var r=An[t];if(r){var e=r.name+"";oi.call(Gi,e)||(Gi[e]=[]),Gi[e].push({name:t,func:r})}}),Gi[Jr(T,2).name]=[{name:"wrapper",func:T}],Un.prototype.clone=function(){var n=new Un(this.__wrapped__);return n.__actions__=Ur(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ur(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ur(this.__views__),n},Un.prototype.reverse=function(){if(this.__filtered__){var n=new Un(this);
n.__dir__=-1,n.__filtered__=true}else n=this.clone(),n.__dir__*=-1;return n},Un.prototype.value=function(){var n,t=this.__wrapped__.value(),r=this.__dir__,e=ff(t),u=0>r,i=e?t.length:0;n=i;for(var o=this.__views__,f=0,c=-1,a=o.length;++c<a;){var l=o[c],s=l.size;switch(l.type){case"drop":f+=s;break;case"dropRight":n-=s;break;case"take":n=Ci(n,f+s);break;case"takeRight":f=Ui(f,n-s)}}if(n={start:f,end:n},o=n.start,f=n.end,n=f-o,o=u?f:o-1,f=this.__iteratees__,c=f.length,a=0,l=Ci(n,this.__takeCount__),!e||!u&&i==n&&l==n)return wr(t,this.__actions__);
e=[];n:for(;n--&&a<l;){for(o+=r,u=-1,i=t[o];++u<c;){var h=f[u],s=h.type,h=(0,h.iteratee)(i);if(2==s)i=h;else if(!h){if(1==s)continue n;break n}}e[a++]=i}return e},An.prototype.at=To,An.prototype.chain=function(){return Ye(this)},An.prototype.commit=function(){return new On(this.value(),this.__chain__)},An.prototype.next=function(){this.__values__===T&&(this.__values__=mu(this.value()));var n=this.__index__>=this.__values__.length;return{done:n,value:n?T:this.__values__[this.__index__++]}},An.prototype.plant=function(n){
for(var t,r=this;r instanceof En;){var e=Fe(r);e.__index__=0,e.__values__=T,t?u.__wrapped__=e:t=e;var u=e,r=r.__wrapped__}return u.__wrapped__=n,t},An.prototype.reverse=function(){var n=this.__wrapped__;return n instanceof Un?(this.__actions__.length&&(n=new Un(this)),n=n.reverse(),n.__actions__.push({func:Qe,args:[Ge],thisArg:T}),new On(n,this.__chain__)):this.thru(Ge)},An.prototype.toJSON=An.prototype.valueOf=An.prototype.value=function(){return wr(this.__wrapped__,this.__actions__)},An.prototype.first=An.prototype.head,
wi&&(An.prototype[wi]=Xe),An}();typeof define=="function"&&typeof define.amd=="object"&&define.amd?($n._=rt, define(function(){return rt})):Nn?((Nn.exports=rt)._=rt,Fn._=rt):$n._=rt}).call(this);
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.RSVP=t.RSVP||{})})(this,function(t){"use strict";function e(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function r(t){var e=t._promiseCallbacks;e||(e=t._promiseCallbacks={});return e}function n(t,e){if(2!==arguments.length)return jt[t];jt[t]=e}function o(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function i(t){return"function"==typeof t}function u(t){return null!==t&&"object"==typeof t}function a(t){return null!==t&&"object"==typeof t}function s(){setTimeout(function(){for(var t=0;t<St.length;t++){var e=St[t],r=e.payload;r.guid=r.key+r.id;r.childGuid=r.key+r.childId;r.error&&(r.stack=r.error.stack);jt.trigger(e.name,e.payload)}St.length=0},50)}function c(t,e,r){1===St.push({name:t,payload:{key:e._guidKey,id:e._id,eventName:t,detail:e._result,childId:r&&r._id,label:e._label,timeStamp:Ot(),error:jt["instrument-with-stack"]?new Error(e._label):null}})&&s()}function f(t,e){var r=this;if(t&&"object"==typeof t&&t.constructor===r)return t;var n=new r(h,e);m(n,t);return n}function l(){return new TypeError("A promises callback cannot return that same promise.")}function h(){}function p(t){try{return t.then}catch(e){kt.error=e;return kt}}function y(t,e,r,n){try{t.call(e,r,n)}catch(o){return o}}function v(t,e,r){jt.async(function(t){var n=!1,o=y(r,e,function(r){if(!n){n=!0;e!==r?m(t,r,void 0):b(t,r)}},function(e){if(!n){n=!0;g(t,e)}},"Settle: "+(t._label||" unknown promise"));if(!n&&o){n=!0;g(t,o)}},t)}function d(t,e){if(e._state===Pt)b(t,e._result);else if(e._state===Rt){e._onError=null;g(t,e._result)}else j(e,void 0,function(r){e!==r?m(t,r,void 0):b(t,r)},function(e){return g(t,e)})}function _(t,e,r){var n=e.constructor===t.constructor&&r===P&&t.constructor.resolve===f;if(n)d(t,e);else if(r===kt){g(t,kt.error);kt.error=null}else i(r)?v(t,e,r):b(t,e)}function m(t,e){t===e?b(t,e):o(e)?_(t,e,p(e)):b(t,e)}function w(t){t._onError&&t._onError(t._result);E(t)}function b(t,e){if(t._state===At){t._result=e;t._state=Pt;0===t._subscribers.length?jt.instrument&&c("fulfilled",t):jt.async(E,t)}}function g(t,e){if(t._state===At){t._state=Rt;t._result=e;jt.async(w,t)}}function j(t,e,r,n){var o=t._subscribers,i=o.length;t._onError=null;o[i]=e;o[i+Pt]=r;o[i+Rt]=n;0===i&&t._state&&jt.async(E,t)}function E(t){var e=t._subscribers,r=t._state;jt.instrument&&c(r===Pt?"fulfilled":"rejected",t);if(0!==e.length){for(var n=void 0,o=void 0,i=t._result,u=0;u<e.length;u+=3){n=e[u];o=e[u+r];n?S(r,n,o,i):o(i)}t._subscribers.length=0}}function T(){this.error=null}function O(t,e){try{return t(e)}catch(r){xt.error=r;return xt}}function S(t,e,r,n){var o=i(r),u=void 0,a=void 0;if(o){u=O(r,n);if(u===xt){a=u.error;u.error=null}else if(u===e){g(e,l());return}}else u=n;e._state!==At||(o&&void 0===a?m(e,u):void 0!==a?g(e,a):t===Pt?b(e,u):t===Rt&&g(e,u))}function A(t,e){var r=!1;try{e(function(e){if(!r){r=!0;m(t,e)}},function(e){if(!r){r=!0;g(t,e)}})}catch(n){g(t,n)}}function P(t,e,r){var n=this,o=n._state;if(o===Pt&&!t||o===Rt&&!e){jt.instrument&&c("chained",n,n);return n}n._onError=null;var i=new n.constructor(h,r),u=n._result;jt.instrument&&c("chained",n,i);if(o===At)j(n,i,t,e);else{var a=o===Pt?t:e;jt.async(function(){return S(o,i,a,u)})}return i}function R(t,e,r){return t===Pt?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}function k(t,e){return Tt(t)?new Mt(this,t,(!0),e).promise:this.reject(new TypeError("Promise.all must be called with an array"),e)}function x(t,e){var r=this,n=new r(h,e);if(!Tt(t)){g(n,new TypeError("Promise.race must be called with an array"));return n}for(var o=0;n._state===At&&o<t.length;o++)j(r.resolve(t[o]),void 0,function(t){return m(n,t)},function(t){return g(n,t)});return n}function M(t,e){var r=this,n=new r(h,e);g(n,t);return n}function C(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function I(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(){this.value=void 0}function V(t){try{return t.then}catch(e){Vt.value=e;return Vt}}function D(t,e,r){try{t.apply(e,r)}catch(n){Vt.value=n;return Vt}}function K(t,e){for(var r={},n=t.length,o=new Array(n),i=0;i<n;i++)o[i]=t[i];for(var u=0;u<e.length;u++){var a=e[u];r[a]=o[u+1]}return r}function U(t){for(var e=t.length,r=new Array(e-1),n=1;n<e;n++)r[n-1]=t[n];return r}function q(t,e){return{then:function(r,n){return t.call(e,r,n)}}}function F(t,e){var r=function(){for(var r=this,n=arguments.length,o=new Array(n+1),i=!1,u=0;u<n;++u){var a=arguments[u];if(!i){i=W(a);if(i===Dt){var s=new Nt(h);g(s,Dt.value);return s}i&&i!==!0&&(a=q(i,a))}o[u]=a}var c=new Nt(h);o[n]=function(t,r){t?g(c,t):void 0===e?m(c,r):e===!0?m(c,U(arguments)):Tt(e)?m(c,K(arguments,e)):m(c,r)};return i?L(c,o,t,r):G(c,o,t,r)};r.__proto__=t;return r}function G(t,e,r,n){var o=D(r,n,e);o===Vt&&g(t,o.value);return t}function L(t,e,r,n){return Nt.all(e).then(function(e){var o=D(r,n,e);o===Vt&&g(t,o.value);return t})}function W(t){return!(!t||"object"!=typeof t)&&(t.constructor===Nt||V(t))}function Y(t,e){return Nt.all(t,e)}function sdk_$(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function z(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function B(t,e){return Tt(t)?new Kt(Nt,t,e).promise:Nt.reject(new TypeError("Promise.allSettled must be called with an array"),e)}function H(t,e){return Nt.race(t,e)}function J(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function X(t,e){return u(t)?new qt(Nt,t,e).promise:Nt.reject(new TypeError("Promise.hash must be called with an object"),e)}function Z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function tt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function et(t,e){return u(t)?new Ft(Nt,t,(!1),e).promise:Nt.reject(new TypeError("RSVP.hashSettled must be called with an object"),e)}function rt(t){setTimeout(function(){throw t});throw t}function nt(t){var e={resolve:void 0,reject:void 0};e.promise=new Nt(function(t,r){e.resolve=t;e.reject=r},t);return e}function ot(t,e,r){return Tt(t)?i(e)?Nt.all(t,r).then(function(t){for(var n=t.length,o=new Array(n),i=0;i<n;i++)o[i]=e(t[i]);return Nt.all(o,r)}):Nt.reject(new TypeError("RSVP.map expects a function as a second argument"),r):Nt.reject(new TypeError("RSVP.map must be called with an array"),r)}function it(t,e){return Nt.resolve(t,e)}function ut(t,e){return Nt.reject(t,e)}function at(t,e){return Nt.all(t,e)}function st(t,e){return Nt.resolve(t,e).then(function(t){return at(t,e)})}function ct(t,e,r){if(!(Tt(t)||u(t)&&void 0!==t.then))return Nt.reject(new TypeError("RSVP.filter must be called with an array or promise"),r);if(!i(e))return Nt.reject(new TypeError("RSVP.filter expects function as a second argument"),r);var n=Tt(t)?at(t,r):st(t,r);return n.then(function(t){for(var n=t.length,o=new Array(n),i=0;i<n;i++)o[i]=e(t[i]);return at(o,r).then(function(e){for(var r=new Array(n),o=0,i=0;i<n;i++)if(e[i]){r[o]=t[i];o++}r.length=o;return r})})}function ft(t,e){Ht[Gt]=t;Ht[Gt+1]=e;Gt+=2;2===Gt&&Jt()}function lt(){var t=process.nextTick,e=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);Array.isArray(e)&&"0"===e[1]&&"10"===e[2]&&(t=setImmediate);return function(){return t(dt)}}function ht(){return"undefined"!=typeof Lt?function(){Lt(dt)}:vt()}function pt(){var t=0,e=new $t(dt),r=document.createTextNode("");e.observe(r,{characterData:!0});return function(){return r.data=t=++t%2}}function yt(){var t=new MessageChannel;t.port1.onmessage=dt;return function(){return t.port2.postMessage(0)}}function vt(){return function(){return setTimeout(dt,1)}}function dt(){for(var t=0;t<Gt;t+=2){var e=Ht[t],r=Ht[t+1];e(r);Ht[t]=void 0;Ht[t+1]=void 0}Gt=0}function _t(){try{var t=require,e=t("vertx");Lt=e.runOnLoop||e.runOnContext;return ht()}catch(r){return vt()}}function mt(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r;return t}function wt(){jt.on.apply(jt,arguments)}function bt(){jt.off.apply(jt,arguments)}var gt={mixin:function(t){t.on=this.on;t.off=this.off;t.trigger=this.trigger;t._promiseCallbacks=void 0;return t},on:function(t,n){if("function"!=typeof n)throw new TypeError("Callback must be a function");var o=r(this),i=void 0;i=o[t];i||(i=o[t]=[]);e(i,n)===-1&&i.push(n)},off:function(t,n){var o=r(this),i=void 0,u=void 0;if(n){i=o[t];u=e(i,n);u!==-1&&i.splice(u,1)}else o[t]=[]},trigger:function(t,e,n){var o=r(this),i=void 0,u=void 0;if(i=o[t])for(var a=0;a<i.length;a++){u=i[a];u(e,n)}}},jt={instrument:!1};gt.mixin(jt);var Et=void 0;Et=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var Tt=Et,Ot=Date.now||function(){return(new Date).getTime()},St=[],At=void 0,Pt=1,Rt=2,kt=new T,xt=new T,Mt=function(){function t(t,e,r,n){this._instanceConstructor=t;this.promise=new t(h,n);this._abortOnReject=r;this._init.apply(this,arguments)}t.prototype._init=function(t,e){var r=e.length||0;this.length=r;this._remaining=r;this._result=new Array(r);this._enumerate(e);0===this._remaining&&b(this.promise,this._result)};t.prototype._enumerate=function(t){for(var e=this.length,r=this.promise,n=0;r._state===At&&n<e;n++)this._eachEntry(t[n],n)};t.prototype._settleMaybeThenable=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===f){var o=p(t);if(o===P&&t._state!==At){t._onError=null;this._settledAt(t._state,e,t._result)}else if("function"!=typeof o){this._remaining--;this._result[e]=this._makeResult(Pt,e,t)}else if(r===Nt){var i=new r(h);_(i,t,o);this._willSettleAt(i,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)};t.prototype._eachEntry=function(t,e){if(a(t))this._settleMaybeThenable(t,e);else{this._remaining--;this._result[e]=this._makeResult(Pt,e,t)}};t.prototype._settledAt=function(t,e,r){var n=this.promise;if(n._state===At)if(this._abortOnReject&&t===Rt)g(n,r);else{this._remaining--;this._result[e]=this._makeResult(t,e,r);0===this._remaining&&b(n,this._result)}};t.prototype._makeResult=function(t,e,r){return r};t.prototype._willSettleAt=function(t,e){var r=this;j(t,void 0,function(t){return r._settledAt(Pt,e,t)},function(t){return r._settledAt(Rt,e,t)})};return t}(),Ct="rsvp_"+Ot()+"-",It=0,Nt=function(){function t(e,r){this._id=It++;this._label=r;this._state=void 0;this._result=void 0;this._subscribers=[];jt.instrument&&c("created",this);if(h!==e){"function"!=typeof e&&C();this instanceof t?A(this,e):I()}}t.prototype._onError=function(t){var e=this;jt.after(function(){e._onError&&jt.trigger("error",t,e._label)})};t.prototype["catch"]=function(t,e){return this.then(void 0,t,e)};t.prototype["finally"]=function(t,e){var r=this,n=r.constructor;return r.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})},e)};return t}();Nt.cast=f;Nt.all=k;Nt.race=x;Nt.resolve=f;Nt.reject=M;Nt.prototype._guidKey=Ct;Nt.prototype.then=P;var Vt=new N,Dt=new N,Kt=function(t){function e(e,r,n){return sdk_$(this,t.call(this,e,r,!1,n))}z(e,t);return e}(Mt);Kt.prototype._makeResult=R;var Ut=Object.prototype.hasOwnProperty,qt=function(t){function e(e,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments[3];return J(this,t.call(this,e,r,n,o))}Q(e,t);e.prototype._init=function(t,e){this._result={};this._enumerate(e);0===this._remaining&&b(this.promise,this._result)};e.prototype._enumerate=function(t){var e=this.promise,r=[];for(var n in t)Ut.call(t,n)&&r.push({position:n,entry:t[n]});var o=r.length;this._remaining=o;for(var i=void 0,u=0;e._state===At&&u<o;u++){i=r[u];this._eachEntry(i.entry,i.position)}};return e}(Mt),Ft=function(t){function e(e,r,n){return Z(this,t.call(this,e,r,!1,n))}tt(e,t);return e}(qt);Ft.prototype._makeResult=R;var Gt=0,Lt=void 0,Wt="undefined"!=typeof window?window:void 0,Yt=Wt||{},$t=Yt.MutationObserver||Yt.WebKitMutationObserver,zt="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Bt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Ht=new Array(1e3),Jt=void 0;Jt=zt?lt():$t?pt():Bt?yt():void 0===Wt&&"function"==typeof require?_t():vt();var Qt=void 0;if("object"==typeof self)Qt=self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");Qt=global}var Xt;jt.async=ft;jt.after=function(t){return setTimeout(t,0)};var Zt=it,te=function(t,e){return jt.async(t,e)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var ee=window.__PROMISE_INSTRUMENTATION__;n("instrument",!0);for(var re in ee)ee.hasOwnProperty(re)&&wt(re,ee[re])}var ne=(Xt={asap:ft,cast:Zt,Promise:Nt,EventTarget:gt,all:Y,allSettled:B,race:H,hash:X,hashSettled:et,rethrow:rt,defer:nt,denodeify:F,configure:n,on:wt,off:bt,resolve:it,reject:ut,map:ot},mt(Xt,"async",te),mt(Xt,"filter",ct),Xt);t["default"]=ne;t.asap=ft;t.cast=Zt;t.Promise=Nt;t.EventTarget=gt;t.all=Y;t.allSettled=B;t.race=H;t.hash=X;t.hashSettled=et;t.rethrow=rt;t.defer=nt;t.denodeify=F;t.configure=n;t.on=wt;t.off=bt;t.resolve=it;t.reject=ut;t.map=ot;t.async=te;t.filter=ct;Object.defineProperty(t,"__esModule",{value:!0})});
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (global) {
    'use strict';

    /**
     * Initializes OceanaCustomerWebVoiceVideo SDK
     *
     * @class
     * @classdesc OceanaCustomerWebVoiceVideo JavaScript SDK
     * @memberOf window
     * @define window.OceanaCustomerWebVoiceVideo
     * @param {object} config OceanaCustomerWebVoiceVideo configuration object
     */
    function OceanaCustomerWebVoiceVideo(config) {
        /**
         * @private
         * @type {string}
         */
        this.version = '4.0.25';
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Config.Configuration}
         */
        OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().config = config;
        OceanaCustomerWebVoiceVideo.Base.Logger.clearLoggers();
    }

    OceanaCustomerWebVoiceVideo.prototype =
        /** @lends window.OceanaCustomerWebVoiceVideo */
    {
        /**
         * Get the OceanaCustomerWebVoiceVideo SDK version number
         *
         * @public
         * @function window.OceanaCustomerWebVoiceVideo#getVersionNumber
         * @returns {String} SDK version number
         */
        getVersionNumber: function () {
            return this.version;
        },
        /**
         * Create a work object in OceanaCustomerWebVoiceVideo SDK, used to create interactions.
         *
         * @public
         * @function window.OceanaCustomerWebVoiceVideo#createWork
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Work} Work request object
         */
        createWork: function () {
            return new OceanaCustomerWebVoiceVideo.Services.Work.Work();
        },
        /**
         * Attach a Logger to the OceanaCustomerWebVoiceVideo SDK <br/>
         * For example: clientInstance.registerLogger(console);
         *
         * @public
         * @function window.OceanaCustomerWebVoiceVideo#registerLogger
         * @param {function|object} logger
         */
        registerLogger: function (logger) {
            OceanaCustomerWebVoiceVideo.Base.Logger.addLogger(logger);
        }
    };

    global.OceanaCustomerWebVoiceVideo = OceanaCustomerWebVoiceVideo;

}(window));

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    /**
     * @namespace OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Base = OceanaCustomerWebVoiceVideo.Base || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Config
     * @define OceanaCustomerWebVoiceVideo.Config
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Config = OceanaCustomerWebVoiceVideo.Config || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers
     * @define OceanaCustomerWebVoiceVideo.Providers
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers = OceanaCustomerWebVoiceVideo.Providers || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.AMC
     * @define OceanaCustomerWebVoiceVideo.Providers.AMC
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.AMC = OceanaCustomerWebVoiceVideo.Providers.AMC || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.AMC.Requests
     * @define OceanaCustomerWebVoiceVideo.Providers.AMC.Requests
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.AMC.Requests = OceanaCustomerWebVoiceVideo.Providers.AMC.Requests || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.Calls
     * @define OceanaCustomerWebVoiceVideo.Providers.Calls
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.Calls = OceanaCustomerWebVoiceVideo.Providers.Calls || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.CP
     * @define OceanaCustomerWebVoiceVideo.Providers.CP
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.CP = OceanaCustomerWebVoiceVideo.Providers.CP || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.CP.Parsers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Parsers
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.CP.Parsers = OceanaCustomerWebVoiceVideo.Providers.CP.Parsers || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Providers.CP.Handlers = OceanaCustomerWebVoiceVideo.Providers.CP.Handlers || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Services
     * @define OceanaCustomerWebVoiceVideo.Services
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services = OceanaCustomerWebVoiceVideo.Services || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Services.Devices
     * @define OceanaCustomerWebVoiceVideo.Services.Devices
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services.Devices = OceanaCustomerWebVoiceVideo.Services.Devices || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Service.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services.Work = OceanaCustomerWebVoiceVideo.Services.Work || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Service.Work.Interactions
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Interactions
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services.Work.Interactions = OceanaCustomerWebVoiceVideo.Services.Work.Interactions || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Service.Work.Attributes
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Attributes
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services.Work.Attributes = OceanaCustomerWebVoiceVideo.Services.Work.Attributes || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Service.Work.Schema
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Schema
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Services.Work.Schema = OceanaCustomerWebVoiceVideo.Services.Work.Schema || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Base.Collections
     * @define OceanaCustomerWebVoiceVideo.Base.Collections
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Base.Collections = OceanaCustomerWebVoiceVideo.Base.Collections || {};
    })(OceanaCustomerWebVoiceVideo);
    /**
     * @namespace OceanaCustomerWebVoiceVideo.Base.Network
     * @define OceanaCustomerWebVoiceVideo.Base.Network
     */
    (function (OceanaCustomerWebVoiceVideo) {
        OceanaCustomerWebVoiceVideo.Base.Network = OceanaCustomerWebVoiceVideo.Base.Network || {};
    })(OceanaCustomerWebVoiceVideo);

}(OceanaCustomerWebVoiceVideo));

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Callbacks
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * @class
     * @classdesc Callbacks Class
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base.Callbacks
     *
     * @description Callbacks constructor function
     */
    function Callbacks() {
        /**
         * @private
         * @type {Array}
         */
        this._callbacks = [];
    }

    Callbacks.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Callbacks */
    {
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Callbacks#add
         * @param {Function} callback
         */
        add: function (callback) {
            this._callbacks.push(callback);
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Callbacks#fire
         */
        fire: function () {
            var callbackArgs = arguments;
            _.forEach(this._callbacks, function(callback) {
                callback.apply(null, callbackArgs);
            });
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Callbacks#remove
         * @param {Function} callback
         */
        remove: function (callback) {
            var index = _.indexOf(this._callbacks, callback);
            if (index !== -1) {
                this._callbacks.splice(index, 1);
            }
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Callbacks#empty
         */
        empty: function () {
            this._callbacks = [];
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Callbacks = Callbacks;

})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Generic Collection
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * @class
     * @classdesc Collection for managing an array
     * @define OceanaCustomerWebVoiceVideo.Base.Collections.Collection
     * @memberOf OceanaCustomerWebVoiceVideo.Base.Collections
     *
     * @description Constructor function for Collection
     */
    function Collection() {
        /**
         * @protected
         * @type {OceanaCustomerWebVoiceVideo.Base.Collections.Model[]}
         */
        this.collection = [];
    }

    Collection.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Collections.Collection */
    {
        /**
         * Check is param data present in Collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#isPresnt
         * @param {Object} data - Data to check exists
         * @returns {Boolean}
         */
        isPresent: function (data) {
            var index = _.indexOf(this.collection, data);
            if (index === -1) {
                return false;
            } else {
                return true;
            }
        },
        /**
         * Retrieves all entries in a Collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#findAll
         * @returns {OceanaCustomerWebVoiceVideo.Collection[]}
         */
        findAll: function () {
            return this.collection;
        },
        /**
         * Create new Collection entry and populate with param data
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#add
         * @param {Object} data - Data for populating new Collection entry
         * @returns {void}
         */
        add: function (data) {
            if (!this.isPresent(data)) {
                this.collection.push(data);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.log('Collection: error adding object, object already exists');
                OceanaCustomerWebVoiceVideo.Base.Logger.log(JSON.parse(JSON.stringify(data)));
            }
        },
        /**
         * Create multiple Collection entries and populate the entry with param data
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#addMultiple
         * @param {Array<Object>} data - Data for populating new Collection entry
         * @returns {void}
         */
        addMultiple: function (data) {
            var self = this;
            _.forEach(data, function (entry) {
                if (!self.isPresent(entry)) {
                    self.collection.push(entry);
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.log('Collection: error adding object, object already exists');
                    OceanaCustomerWebVoiceVideo.Base.Logger.log(entry);
                }
            });
        },
        /**
         * Removes matching entry from Collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#remove
         * @param {Object} data - Criteria used to find Collection entry
         * @returns {Object}
         */
        remove: function (data) {
            var index = _.indexOf(this.collection, data);
            if (index !== -1) {
                this.collection.splice(index, 1);
            }
        },
        /**
         * Removes multiple matching entries from Collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#removeMultiple
         * @param {Array<Object>} data - Criteria used to find Collection entries
         * @returns {Object}
         */
        removeMultiple: function (data) {
            var self = this;
            _.forEach(data, function (entry) {
                var index = _.indexOf(self.collection, entry);
                if (index !== -1) {
                    self.collection.splice(index, 1);
                }
            });
        },
        /**
         * Removes all entries from a Collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Collection#removeAll
         * @returns {void}
         */
        empty: function () {
            this.collection = [];
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Collections.Collection = Collection;

})(OceanaCustomerWebVoiceVideo, _);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file SDK datastore
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    var Datastore = (function () {
        var instance;

        function createInstance() {
            var object = {
                config: '',
                authToken: '',
                attributes: [],
                context: '',
                topic: '',
                workRequest: { provided: false, id: undefined },
                locale: undefined,
                routingStrategy: undefined,
                dataCenter: undefined,
                contextualData: undefined,
                services: [],
                resources: [],
                platformType : undefined
            };
            return object;
        }

        return {
            getInstance: function () {
                if (!instance) {
                    instance = createInstance();
                }
                return instance;
            },
            clear: function () {
                // clear should only remove work request data, not config data
                // so preserve and re initialise config data
                var config = instance.config;
                instance = createInstance();
                instance.config = config;
            }
        };
    })();

    OceanaCustomerWebVoiceVideo.Base.Datastore = Datastore;

})(OceanaCustomerWebVoiceVideo);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Logger
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';

    var loggers = [];

    function standardLog(logger, level, message, meta) {
        if(_.isUndefined(meta)) {
            logger[level](message);
        } else {
            logger[level](message, meta);
        }
    }

    function externalLog(logger, level, message, meta) {
        if(_.isUndefined(meta)) {
            logger.log(level, message);
        } else {
            logger.log(level, message, meta);
        }
    }

    /**
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base.Logger
     */
    OceanaCustomerWebVoiceVideo.Base.Logger = {
        /**
         * Output log message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#log
         * @param {string} level Type of log message
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        log: function (level, message, meta) {
            loggers.forEach(function (logger) {
                externalLog(logger, level, message, meta);
            });
        },
        /**
         * Output info message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#info
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        info: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.info === 'function') {
                    standardLog(logger, 'info', message, meta);
                } else {
                    externalLog(logger, 'info', message, meta);
                }
            });
        },
        /**
         * Output error message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#error
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        error: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.error === 'function') {
                    standardLog(logger, 'error', message, meta);
                } else {
                    externalLog(logger, 'error', message, meta);
                }
            });
        },
        /**
         * Output fatal message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#fatal
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        fatal: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.fatal === 'function') {
                    standardLog(logger, 'fatal', message, meta);
                } else {
                    externalLog(logger, 'fatal', message, meta);
                }
            });
        },
        /**
         * Output debug message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#debug
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        debug: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.debug === 'function') {
                    standardLog(logger, 'debug', message, meta);
                } else {
                    externalLog(logger, 'debug', message, meta);
                }
            });
        },
        /**
         * Output trace message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#trace
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        trace: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.trace === 'function') {
                    standardLog(logger, 'trace', message, meta);
                } else {
                    externalLog(logger, 'trace', message, meta);
                }
            });
        },
        /**
         * Output warn message
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#warn
         * @param {string} message Message to log
         * @param {Object} [meta] Optional meta data
         */
        warn: function (message, meta) {
            loggers.forEach(function (logger) {
                if (typeof logger.warn === 'function') {
                    standardLog(logger, 'warn', message, meta);
                } else {
                    externalLog(logger, 'warn', message, meta);
                }
            });
        },
        /**
         * Get logger collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#getLoggers
         * @param {Object[]} logger
         */
        getLoggers: function (logger) {
            return loggers;
        },
        /**
         * Add logger
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Logger#addLogger
         * @param {Object} logger
         */
        addLogger: function (logger) {
            if (!logger || typeof logger.log === 'undefined') {
                throw new TypeError('Logger should implement log method.');
            }
            loggers.push(logger);
        },
        /**
         * Remove logger
         *
         * @public
         * @function
         * @param {Object} logger
         */
        removeLogger: function (logger) {
            var index = loggers.indexOf(logger);
            if (index === -1) {
                throw new Error('Specified error does not exist.');
            }
            loggers.splice(index, 1);
        },
        clearLoggers: function () {
            loggers = [];
        }
    };
})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * @class
     * @classdesc HTTP Options Configuration
     * @define OceanaCustomerWebVoiceVideo.Base.Network.HTTPOptions
     * @memberOf OceanaCustomerWebVoiceVideo.Base.Network
     */
    function HTTPOptions() {
        /**
         * Make asynchronous HTTP requests
         *
         * @public
         * @type {boolean}
         */
        this.async = true;
        /**
         * HTTP Headers
         *
         * @public
         * @type {object}
         */
        this.headers = {};
        /**
         * HTTP timeout
         *
         * @public
         * @type {object}
         */
        this.timeout = 20000;
    }

    OceanaCustomerWebVoiceVideo.Base.Network.HTTPOptions = HTTPOptions;

})(OceanaCustomerWebVoiceVideo);

/**
* Copyright Avaya Inc.
* All rights reserved. Usage of this source is bound to the terms described in
* the file Avaya SDK EULA.pdf, included in this SDK.
* Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
*/
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * @define OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest
     * @memberOf OceanaCustomerWebVoiceVideo.Base.Network
     * @class
     * @param {{timeout, withCredentials}} options
     */
    function HTTPRequest(options) {
        /**
         * @type {XMLHttpRequest|ActiveXObject}
         * @private
         */
        this._xhr = undefined;
        /**
         * Determine which AJAX object to use
         */
        if (window.XMLHttpRequest) {
            this._xhr = new XMLHttpRequest();
        } else if (window.ActiveXObject) {
            try {
                this._xhr = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                this._xhr = new ActiveXObject("Microsoft.XMLHTTP");
            }
        } else {
            throw new Error('There is no XHR protocol available for HTTP Requests');
        }
        /**
         * {@link https://xhr.spec.whatwg.org/#the-timeout-attribute}
         * @type {number}
         */
        this._xhr.timeout = 20000;
        /**
         * {@link https://xhr.spec.whatwg.org/#the-withcredentials-attribute}
         * @type {boolean}
         */
        this._xhr.withCredentials = options.withCredentials;
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onloadstart}
         * @param {{target}} loadstart
         */
        this._xhr.onloadstart = function (loadstart) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', loadstart.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onprogress}
         * @param {{target}} progress
         */
        this._xhr.onprogress = function(progress) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', progress.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onabort}
         * @param {{target}} abort
         */
        this._xhr.onabort = function (abort) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', abort.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onerror}
         * @param {{target}} error
         */
        this._xhr.onerror = function (error) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', error.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onload}
         * @param {{target}} load
         */
        this._xhr.onload = function (load) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', load.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-ontimeout}
         * @param {{target}} timeout
         */
        this._xhr.ontimeout = function (timeout) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', timeout.target);
        };
        /**
         * {@link https://xhr.spec.whatwg.org/#handler-xhr-onloadend}
         * @param {{target}} loadend
         */
        this._xhr.onloadend = function (loadend) {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('HTTPRequest', loadend.target);
        };
    }

    HTTPRequest.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest */
    {
        /**
         * Encode data as URL query params
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#encode
         * @param {string|object} data Data to encode
         * @returns {string} payload Encoded data as URL query params
         */
        encode: function (data) {
            data = data || {};
            if (typeof data === "string") {
                return data;
            } else {
                var params = [];
                _.forEach(data, function (value, key) {
                    params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));
                });
                return params.join('&');
            }
        },
        /**
         * Set Request Header for XHR Request
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#setRequestHeader
         * @param {string} header Name of header to set
         * @param {string} content Header content to set
         */
        setRequestHeader: function (header, content) {
            this._xhr.setRequestHeader(header, content);
        },
        /**
         * Set Multiple Request Headers for XHR Request
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#setRequestHeaders
         * @param {Object} headers List of headers to set
         */
        setRequestHeaders: function (headers) {
            var contentType = 'application/x-www-form-urlencoded';
            _.forEach(headers, _.bind(function (content, header) {
                if (header.toLowerCase() === 'content-type') {
                    contentType = content;
                } else {
                    this.setRequestHeader(header, content);
                }
            }, this));
            this.setRequestHeader('Content-type', contentType);
        },
        /**
         * Open XHR Request
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#open
         * @param {string} method HTTP request method (e.g. GET, POST, etc.)
         * @param {string} url URL of the HTTP request
         * @param {boolean} async Make this call asynchronous
         */
        open: function (method, url, async) {
            this._xhr.open(method, url, async);
        },
        /**
         * Abort XHR Request
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#abort
         */
        abort: function () {
            this._xhr.abort();
        },
        /**
         * Send XHR Request
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#send
         * @param {string} data Content to send
         */
        send: function (data) {
            this._xhr.send(data);
        },
        /**
         * Add a callback to be executed on XHR Request state change
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest#addOnStateChangeCallback
         * @param {function} callback
         */
        addOnStateChangeCallback: function(callback) {
            this._xhr.onreadystatechange = callback;
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest = HTTPRequest;

})(OceanaCustomerWebVoiceVideo, _);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, _, Promise) {
    'use strict';
    /**
     * @class
     * @classdesc Rest Provider Class
     * @define OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     *
     * @description Rest Provider constructor function
     */
    function RESTProvider() {
        
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Network.HTTPOptions}
         */
        this._options = new OceanaCustomerWebVoiceVideo.Base.Network.HTTPOptions();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest[]}
         */
        this._xhrPool = [];
    }

    RESTProvider.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider */
    {
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#send
         * @param {string} method HTTP request method (e.g. GET, POST, etc.)
         * @param {string} url URL of the HTTP request
         * @param {string} data Content to send
         * @param {{headers, async}} options
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        send: function (method, url, data, options) {
            options = _.assignIn({}, this._options, options);
            var xhr = new OceanaCustomerWebVoiceVideo.Base.Network.HTTPRequest({});
            return new Promise(_.bind(function (resolve, reject) {
                var payload = xhr.encode(data);
                if (method === 'GET' && payload) {
                    url += '?' + payload;
                    payload = null;
                }
                xhr.open(method, url, options.async);
                xhr.setRequestHeaders(options.headers);
                xhr.addOnStateChangeCallback(function () {
                    if (this.readyState === 4) {
                        if (!this.status || (this.status < 200 || this.status >= 300) && this.status !== 304) {
                            reject(this);
                        } else {
                            resolve(this.responseText, this);
                        }
                    }
                });
                xhr.send(payload);
                this._xhrPool.push(xhr);
            }, this));
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#get
         * @param {string} url URL of the HTTP request
         * @param {string} [data] Content to send
         * @param {{headers}} [options]
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        get: function (url, data, options) {
            return this.send('GET', url, data, options);
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#get
         * @param {string} url URL of the HTTP request
         * @param {string} [data] Content to send
         * @param {{headers}} [options]
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        post: function (url, data, options) {
            return this.send('POST', url, data, options);
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#get
         * @param {string} url URL of the HTTP request
         * @param {string} [data] Content to send
         * @param {{headers}} [options]
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        put: function (url, data, options) {
            return this.send('PUT', url, data, options);
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#get
         * @param {string} url URL of the HTTP request
         * @param {string} [data] Content to send
         * @param {{headers}} [options]
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        delete: function (url, data, options) {
            return this.send('DELETE', url, data, options);
        },
        /**
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider#close
         */
        close: function () {
            _.forEach(this._xhrPool, function (xhr) {
                xhr.abort();
            });
            this._xhrPool = [];
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider = RESTProvider;

})(OceanaCustomerWebVoiceVideo, _, RSVP.Promise);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Enables Observable Objects
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * @class
     * @classdesc Observable class. It handles events communication.
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base.Observable
     *
     * @description Observable constructor function
     */
    function Observable() {
        /**
         * @protected
         * @type {{}}
         */
        this._listeners = {};
    }

    Observable.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Observable */
    {
        /**
         * Subscribes handler to specified event
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Observable#on
         * @this OceanaCustomerWebVoiceVideo.Base.Observable
         * @param {string} name Name of event to subscribe to
         * @param {function} handler Handler subscribed to event
         * @returns {OceanaCustomerWebVoiceVideo.Base.Observable}
         */
        on: function (name, handler) {
            if (typeof(handler) !== 'function') {
                return this;
            }
            else {
                this._listeners[name] = this._listeners[name] || [];
                this._listeners[name].push(handler);
            }
            return this;
        },
        /**
         * Unsubscribes handler from specified event
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Observable#off
         * @this OceanaCustomerWebVoiceVideo.Base.Observable
         * @param {string} name Name of event to unsubscribe from
         * @param {function} handler Handler subscribed to event
         * @returns {OceanaCustomerWebVoiceVideo.Base.Observable}
         * @throws Will throw error if listener is not defined
         */
        off: function (name, handler) {
            if (typeof(handler) !== 'function') {
                return this;
            }
            else {
                if (this._listeners[name] === undefined) {
                    throw new Error('There is no such handler for event with name: ' + name + '.');
                }
                var index = _.indexOf(this._listeners[name], handler);
                if (index !== -1) {
                    this._listeners[name].splice(index, 1);
                } else {
                    throw new Error('There is no such handler for event with name: ' + name + '.');
                }
                if (_.size(this._listeners[name]) === 0) {
                    delete this._listeners[name];
                }
            }
            return this;
        },
        /**
         * Triggers specified event
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Base.Observable#trigger
         * @param {string} name Name of event to be triggered
         * @param {Array} args Event callback arguments
         */
        trigger: function (name, args) {
            var listeners = this._listeners[name];
            if (listeners !== undefined) {
                args = args || [];
                _.forEach(listeners, function (listener) {
                    listener.apply(window, args);
                });
            }
        },
        /**
         * Removes [all] listeners
         *
         * @public
         * @param {string} [namespace] Only remove listeners by namespace
         * @function AvayaCustomerServices.Base.Observable#removeListeners
         */
        removeListeners: function (namespace) {
            var self = this;
            _.forEach(this._listeners, function (listener, name) {
                var removeListener = _.isUndefined(namespace);
                if (namespace) {
                    var regExp = new RegExp('^' + namespace);
                    removeListener = regExp.exec(name) !== null;
                }
                if (removeListener) {
                    _.forEach(listener, function (handler) {
                        self.off(name, handler);
                    });
                }
            });
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Observable = Observable;

})(OceanaCustomerWebVoiceVideo, _);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Promises
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * RSVP.js provides simple tools for organizing asynchronous code.
     * Specifically, it is a tiny implementation of Promises/A+.
     * It works in node and the browser (IE6+, all the popular evergreen ones).
     *
     * See {@tutorial async} for more information.
     *
     * @example <caption>Basic Usage</caption>
     *  var promise = new RSVP.Promise(function(resolve, reject) {
     *      // succeed
     *      resolve(value);
     *      // or reject
     *      reject(error);
     *  });
     *
     *  promise.then(function(value) {
     *      // success
     *  }, function(value) {
     *      // failure
     *  });
     *
     * @class
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base.Promise
     * @param {function} resolver
     */
    function Promise(resolver) {
        /**
         * NOTE: This class does nothing!
         * It is only use to document RSVP Promise object in order to provide syntax completion.
         */
    }

    Promise.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Promise **/
    {
        /**
         * The primary way of interacting with a promise is through its `then` method,
         * which registers callbacks to receive either a promise's eventual value or the
         * reason why the promise cannot be fulfilled.
         *
         * @example
         *  findUser().then(function(user){
         *      // user is available
         *  }, function(reason){
         *      // user is unavailable, and you are given the reason why
         *  });
         *
         * @public
         * @param {function} onFulfillment
         * @param {function} onRejection
         * @param {string} [label] optional string for labeling the promise.
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        then: function(onFulfillment, onRejection, label){},
        /**
         * `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
         * as the catch block of a try/catch statement.
         *
         * @example
         *  function findAuthor(){
         *      throw new Error("couldn't find that author");
         *  }
         *  findAuthor().catch(function(reason){
         *      // something went wrong
         *  });
         *
         * @public
         * @param {function} onRejection
         * @param {string} [label] optional string for labeling the promise.
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        catch: function(onRejection, label){},
        /**
         * `finally` will be invoked regardless of the promise's fate just as native
         * try/catch/finally behaves
         *
         * @example
         *  findAuthor().catch(function(reason){
         *      return findOtherAuthor();
         *  }).finally(function(){
         *      // author was either found, or not
         *  });
         *
         * @public
         * @param {function} callback
         * @param {string} [label] optional string for labeling the promise.
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        finally: function(callback, label){}
    };

    OceanaCustomerWebVoiceVideo.Base.Promise = Promise;

})(OceanaCustomerWebVoiceVideo);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Enables Observable Objects
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * @class
     * @classdesc Watcher class.
     * @memberOf OceanaCustomerWebVoiceVideo.Base
     * @define OceanaCustomerWebVoiceVideo.Base.Watcher
     * @description Watcher constructor function
     */
    function Watcher() { }

    Watcher.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Base.Watcher */
    {
        watch: function (target, prop, handler) {
            var oldValue = target[prop],
                newValue = oldValue,
                self = this,
                getter = function () {
                    return newValue;
                },
                setter = function (value) {
                    oldValue = newValue;
                    newValue = value;
                    handler.call(target, prop, oldValue, value);
                };
            if (delete target[prop]) {
                if (Object.defineProperty) {
                    Object.defineProperty(target, prop, {
                        get: getter,
                        set: setter,
                        enumerable: false,
                        configurable: true
                    });
                }
            }
            return this;
        }, 
        unwatch: function(target, prop) {
            var value = target[prop];
            delete target[prop];
            target[prop] = value;
            return this;
        }
    };

    OceanaCustomerWebVoiceVideo.Base.Watcher = Watcher;

})(OceanaCustomerWebVoiceVideo, _);
/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * @class
     * @classdesc OceanaCustomerWebVoiceVideo ClientConfiguration information
     * @define OceanaCustomerWebVoiceVideo.Config.ClientConfiguration
     * @memberOf OceanaCustomerWebVoiceVideo.Config
     */
    function ClientConfiguration() {
        /**
         * A configuration object, indicating the Oceana server to communication with
         *
         * @public
         * @type {OceanaCustomerWebVoiceVideo.Config.Configuration}
         */
        this.configuration = new OceanaCustomerWebVoiceVideo.Config.Configuration();
         /**
         * A configuration object, indicating the signalling gateway to communication with
         *
         * @public
         * @type {OceanaCustomerWebVoiceVideo.Config.WebGatewayConfiguration}
         */
        this.webGatewayConfiguration = new OceanaCustomerWebVoiceVideo.Config.WebGatewayConfiguration();
    }

    OceanaCustomerWebVoiceVideo.Config.ClientConfiguration = ClientConfiguration;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * @class
     * @classdesc OceanaCustomerWebVoiceVideo Configuration used when connecting to Oceana.Not valid in case of Elite
     * @define OceanaCustomerWebVoiceVideo.Config.Configuration
     * @memberOf OceanaCustomerWebVoiceVideo.Config
     */
    function Configuration() {
        /**
         * FQDN for the Breeze cluster hosting AvayaMobileCommunications
         *
         * @public
         * @type {string}
         */
        this.restUrl = '';
        /**
         * Port number to connect to the Breeze cluster hosting AvayaMobileCommunications
         *
         * @public
         * @type {number}
         */
        this.port = 443;
        /**
         * Connect to the Breeze cluster using HTTP/HTTPS
         *
         * @public
         * @type {boolean}
         */
        this.secure = false;
        /**
         * The URL path for the Breeze cluster
         * This is optional, if not provided a default value will be used
         * The default is 'services/AvayaMobileCommunications/sessions'.
         * This can be used to target older service versions where the name was AMC
         *
         * @public
         * @type {string}
         */
        this.urlPath = '';
    }

    OceanaCustomerWebVoiceVideo.Config.Configuration = Configuration;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * @class
     * @classdesc OceanaCustomerWebVoiceVideo WebGatewayConfiguration information
     * @define OceanaCustomerWebVoiceVideo.Config.WebGatewayConfiguration
     * @memberOf OceanaCustomerWebVoiceVideo.Config
     */
    function WebGatewayConfiguration() {
        /**
         * The address (FQDN) used to contact the Avaya Aura Web Gateway server
         *
         * @public
         * @type {string}
         */
        this.webGatewayAddress = '';
        /**
         * Port number used to contact the Avaya Aura Web Gateway server
         *
         * @public
         * @type {number}
         */
        this.port = 443;
        /**
         * Connect to Avaya Aura Web Gateway using HTTP/HTTPS
         *
         * @public
         * @type {boolean}
         */
        this.secure = true;
    }

    OceanaCustomerWebVoiceVideo.Config.WebGatewayConfiguration = WebGatewayConfiguration;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file AmcProvider
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    var _restProvider;
    var _url;

    /**
     * @class
     * @classdesc AmcProvider Class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.AMC
     * @define OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider
     * @requires OceanaCustomerWebVoiceVideo.Base.Callbacks
     */
    function AmcProvider() {
        var config = OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().config;
        // if a ClientConfiguration object is used as configuration rather than a Configuration object.
        // flatten the nested Configuration object, i.e. make the Configuration properties available at the root of ClientConfiguration
        // this is to keep backwards compatability
        if(_.has(config, 'configuration')) {
            _.assign(config, config.configuration);
            delete config.configuration;
        }
        _url = _urlBuilder(config);
        _restProvider = new OceanaCustomerWebVoiceVideo.Base.Network.RESTProvider();
    }


    AmcProvider.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider */
    {
        /**
         * Create a AMC session
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider#createAmcSession
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.InteractionType} interactionType - the interaction type to create
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        createAmcSession: function (interactionType) {
            return _requestAmcSession(interactionType);
        },
        /**
         * Complete a AMC session
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider#createAmcSession
         * @param {string} workRequestId - the work request id for the interaction to end
         * @returns {OceanaCustomerWebVoiceVideo.Base.Promise}
         */
        endAmcSession: function (workRequestId) {
            return _deleteAmcSession(workRequestId);
        }
    };

    function _requestAmcSession(interactionType) {
        var payload = new OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession();
        payload.setInteractionType(interactionType);
        payload.fetchData();
        return _restProvider.post(_url, payload.parse(), {headers: {'Content-Type': 'application/json'}});
    }

    function _deleteAmcSession(workRequestId) {
        var url = _url + '/' + workRequestId;

        return _restProvider.delete(url);
    }

    function _urlBuilder(config) {
        if(config.restUrl && config.port) {
            var baseUrlPath = 'services/AvayaMobileCommunications/sessions';
            var protocol = config.secure ? 'https://' : 'http://';

            var urlPath = baseUrlPath;

            if(config.urlPath) {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('SDK: using [' + config.urlPath + '] as url path');
                urlPath = config.urlPath;
            }

            return protocol + config.restUrl + ':' + config.port + '/' + urlPath;
        } else {
            OceanaCustomerWebVoiceVideo.Base.Logger.error('SDK: provided AMC server configuration is invalid');
            OceanaCustomerWebVoiceVideo.Base.Logger.error(config);
        }
    }

    OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider = AmcProvider;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file CreateAmcSession
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';

    /**
     * @class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.AMC.Requests
     * @define  OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession
     */
    function CreateAmcSession () {
        /**
         * @private
         * @type {string}
         */
        this.platform = _getBrowserName();
        /**
         * @private
         * @type {string}
         */
        this.customerId = '';
        /**
         * @private
         * @type {string}
         */
        this.primaryChannel = 'VOICE';
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList}
         */
        this.attributes = [];
        /**
         * @private
         * @type {Array.<string>}
         */
        this.escalationChannels = [];
    }

    CreateAmcSession.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession */
    {
        /**
         * Set the session interaction type
         * @function OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession#setInteractionType
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.InteractionType} interactionType - the interaction type to create
         */
        setInteractionType: function (interactionType) {
            if(interactionType === OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY) {
                this.primaryChannel = 'VOICE';
            } else {
                this.primaryChannel = 'VIDEO';
            }
        },
        /**
         * Create appropriate additional properties on this AmcSession, based on the data available in the data store
         * @function OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession#fetchData
         */
        fetchData: function () {
            var data = OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance();

            this.customerId = data.context;
            this.topic = data.topic;
            this.attributes = data.attributes;

            if(data.workRequest.provided && data.workRequest.id) {
                this.workRequestId = data.workRequest.id;
            }

            if(data.locale) {
                this.locale = data.locale;
            }

            if(data.routingStrategy) {
                this.routingStrategy = data.routingStrategy;
            }

            if(data.dataCenter) {
                this.dataCenter = data.dataCenter;
            }

            if(data.contextualData) {
                this.data = data.contextualData;
            }

            if(data.services) {
                this.services = _.keyBy(data.services, function(service) {
                    // add one since array index starts at zero
                    return data.services.indexOf(service) + 1;
                });
            }

            if(data.resources) {
                this.resources = _.keyBy(data.resources, function(resource) {
                    // add one since array index starts at zero
                    return data.resources.indexOf(resource) + 1;
                });
            }

        },
        /**
         * Convert the object to a json string
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession#parse
         * @returns {string}
         */
        parse: function () {
            return JSON.stringify(this);
        }
    };

    function _getBrowserName() {
        var browserName = 'BROWSER';

        if(!!window.chrome && !!window.chrome.csi) {
            browserName = 'CHROME';
        }

        if(typeof InstallTrigger !== 'undefined') {
            browserName = 'FIREFOX';
        }

        var isIE = /*@cc_on!@*/false || !!document.documentMode;

        if(!isIE && !!window.StyleMedia) {
            browserName = 'EDGE';
        }

        return browserName;
    }

    OceanaCustomerWebVoiceVideo.Providers.AMC.Requests.CreateAmcSession = CreateAmcSession;

})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    /**
     * @class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.Calls
     * @define OceanaCustomerWebVoiceVideo.Providers.Calls.CallConfig
     */
    function CallConfig () {
        /**
         * @private
         * @type {boolean}
         */
        this.audioMuted = false;
        /**
         * @private
         * @type {boolean}
         */
        this.videoMuted = false;
        /**
         * @private
         * @type {boolean}
         */
        this.videoEnabled = true;
    }

    CallConfig.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.Calls.CallConfig */
    {
        isAudioMuted: function () {
          return this.audioMuted;
        },
        setAudioMuted: function (muted) {
            this.audioMuted = muted;
        },
        isVideoMuted: function () {
          return this.videoMuted;
        },
        setVideoMuted: function (muted) {
            this.videoMuted = muted;
        },
        isVideoEnabled: function () {
            return this.videoEnabled;
        },
        setVideoEnabled: function (enabled) {
            this.videoEnabled = enabled;
        }
    };

    OceanaCustomerWebVoiceVideo.Providers.Calls.CallConfig = CallConfig;

})(OceanaCustomerWebVoiceVideo);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
/**
 * @file InteractionState
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all call operations
     *
     * @readonly
     * @enum {string}
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.Call
     * @define OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations
     */
    var CallOperations = {
        GET_STATE: 'GET_STATE',
        GET_DURATION: 'GET_DURATION',
        SEND_DTMF: 'SEND_DTMF',
        IS_SERVICE_AVAILABLE: 'IS_SERVICE_AVAILABLE'
    };

    OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations = CallOperations;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
/**
 * @file InteractionState
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all call operations
     *
     * @readonly
     * @enum {string}
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.Call
     * @define OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations
     */
    var MediaOperations = {
        IS_AUDIO_MUTED: 'IS_AUDIO_MUTED',
        MUTE_AUDIO: 'MUTE_AUDIO',
        IS_VIDEO_MUTED: 'IS_VIDEO_MUTED',
        MUTE_VIDEO: 'MUTE_VIDEO',
        IS_VIDEO_ENABLED: 'IS_VIDEO_ENABLED',
        ENABLE_VIDEO: 'ENABLE_VIDEO',
        IS_CALL_HELD: 'IS_CALL_HELD',
        HOLD_CALL: 'HOLD_CALL'
    };

    OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations = MediaOperations;

})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    var _self;
    var _client;
    var _user;
    //var poorQualityStartTime = -1;
    //var bVideoDisabledEventSent = false;

    var _webGatewayConfiguration;

    var _active = false;

    // Used to play back DTMF tones

    var _audioContext; // Leave this undefined for now, due to Chrome 70+ policy change

    /**
     * @class
     * @classdesc Communication service provider class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider
     */
    function CpProvider(webGatewayConfiguration) {
        OceanaCustomerWebVoiceVideo.Base.Observable.call(this);
        _self = this;
        _client = new AvayaClientServices();
        this._mediaServices = _client.getMediaServices();
        this._callService = {};
        this._configHandler = new OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.ConfigHandler();
        this._callTimeHandler = new OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.CallTimeHandler();
        this._deviceHandler = new OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.DeviceHandler(this._mediaServices);
        this._mediaOperationHandler = new OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.MediaOperationHandler(this);
        this._webGatewayConfiguration = webGatewayConfiguration;
        this._videoHandler = undefined;
    }

    CpProvider.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider */
    {
        /**
         * Start the communication service call service
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#start
         * @returns {void}
         */
        start: function (interationType, videoDevice) {
            var video = true;
            if (interationType === OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY) {
                video = false;
            }
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: start');
            _initCallService(video, videoDevice);
        },
        /**
         * Stop the communication service call service
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#stop
         * @returns {void}
         */
        stop: function () {
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: stop');
            _shutdownCallService();
        },
        /**
         * Create a audio call with the communication service
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#makeAudioCall
         * @param {object} amcSession - the AMC session
         * @returns {void}
         */
        makeAudioCall: function (platformType, amcSession) {
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: makeAudioCall');
            if (this._deviceHandler.hasAudioDevice()) {
                _createCall(platformType, amcSession);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: cannot make a audio call [no audio device available]');
                this.trigger('interaction.failed', [{ reason: 'No audio device available' }]);
            }
        },
        /**
         * Create a video call with the communication service
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#makeVideoCall
         * @param {object} amcSession - the AMC session
         * @param {object} videoDevice - video device properties
         * @returns {void}
         */
        makeVideoCall: function (platformType, amcSession, videoDevice, callQualityParams) {
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: makeVideoCall');
            if (this._deviceHandler.hasAudioDevice()) {
                _createCall(platformType, amcSession, videoDevice);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: cannot make a video call [no audio device available]');
                this.trigger('interaction.failed', [{ reason: 'No audio device available' }]);
            }
        },
        /**
         * Attempt to perform a operation on the active communication service call 
         * to retrieve cal station information, for example time elapsed and call state
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#performOperation
         * @returns {*}
         */
        performOperation: function (operation) {
            var doLog = true;

            if (operation.name === OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_DURATION ||
                operation.name === OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_STATE) {
                doLog = false;
            }

            if (doLog) {
                OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: performing operation ' + operation.name);
            }
            var result = _performOperation(_.head(this._callService.getCalls()), operation);
            if (doLog) {
                OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: performed operation ' + operation.name + " - result: " + result);
            }
            return result;
        },
        /**
         * Attempt to perform a media operation on a communication service call
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#performOperation
         * @returns {*}
         */
        performMediaOperation: function (operation) {
            var call;

            if (this._callService && this._callService.getCalls) {
                call = _.head(this._callService.getCalls());
            }
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: performing media operation ' + operation.name);
            var result = _performMediaOperation(call, operation);
            OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: performed media operation ' + operation.name + ' - result: ' + result);
            return result;
        },
        /**
         * End the active communication service call
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider#endCall
         * @returns {void}
         */
        endCall: function () {
            _endCall(_.head(this._callService.getCalls()));
        },
        readAudioDetails: function (callback) {
            _readAudioDetails(_.head(this._callService.getCalls()), callback);
        },
        readVideoDetails: function (callback) {
            _readVideoDetails(_.head(this._callService.getCalls()), callback);
        }
    };

    function _initCallService(videoEnabled, videoDevice) {

        OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: Initialising Call Service');

        var videoResolution = AvayaClientServices.Config.VideoResolution.RESOLUTION_480p;
        if (videoDevice) {
            videoResolution = _mapCaptureResolution(videoDevice.getCameraCaptureResolution());
        }

        var userConfig = _self._configHandler.createUserConfig(videoEnabled, videoResolution);

        _.forEach(OceanaCustomerWebVoiceVideo.Base.Logger.getLoggers(), function (logger) {
            _client.registerLogger(logger);
        });

        OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: creating user');
        _user = _client.createUser(userConfig);

        if (_.isEmpty(_self._callService)) {
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: getting call service');
            _self._callService = _user.getCalls();
        }

        _self._callService.addOnCallsServiceAvailableCallback(function (callService) {
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call service initialised');
            // We can't make calls yet, so this callback probably isn't relevant
        });
        _self._callService.addOnCallsServiceUnavailableCallback(function (callService) {
            /**
             * TODO figure out how to handle connecting!
             * how to check connection station
             * should this trigger connecting callback multiple times
             * should this trigger disconnect listener and when
             * add logging for connecting and disconnected
             * and if these callbacks will be triggered for anonymouse users
             */
            if (_self._active) {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('CP: Call service unavailable');
                _exponentialBackoff(function () {
                    _self.trigger('service.connecting', []);
                }, 10, 100, function () {
                    _self.trigger('service.disconnected', []);
                    _self.stop();
                });
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('CP: Call service shut down successfully');
                _self.trigger('service.disconnected', []);
            }
        });
        _self._callService.addOnCallRemovedCallback(function (call) {
            _self._mediaOperationHandler.setDefaultMediaState();
        });

        _user.addOnUserRegistrationFailed(function (user) {
            OceanaCustomerWebVoiceVideo.Base.Logger.warn('CP: user registration failed');
        });
        _user.addOnUserRegistrationSuccessful(function (user) {
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: user registration successful');
        });

        OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: starting anonymous user');
        // Note: need to register all the callbacks before starting the user when using anonymous access
        var request = _user.start();

        request.then(function (success) {
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call service available and ready for use');
            _self.trigger('service.connected', []);
            _self._active = true;
        }, function (error) {
            OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: Call service initialisation. Error: ' + error);
        });
    }

    function _shutdownCallService() {
        OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: shutting down call service');
        _self._active = false;
        if (_user) {
            _user.stop();
        }
    }

    function _getCallCreationInfo(amcSession) {
        var callCreationInfo = {
            success: false,
            reason: '',
            info: undefined
        };

        var calleeAddress = amcSession.amcRoutepoint;
        if (calleeAddress === null || typeof calleeAddress !== 'string' || calleeAddress === '') {
            callCreationInfo.success = false;
            callCreationInfo.reason = 'Destination address is invalid';
        } else {
            var contextId = amcSession.workRequestId + ',' + amcSession.interactionType + ',N';
            callCreationInfo.info = new AvayaClientServices.Services.Call.CallCreationInfo(calleeAddress);
            var aawgAddress = _self._webGatewayConfiguration.webGatewayAddress;
            var aawgPort = _self._webGatewayConfiguration.port;
            var aawgProtocol = _self._webGatewayConfiguration.secure ? 'https' : 'http';

            var token = OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken || '';

            var url = aawgProtocol + '://' + aawgAddress + ':' + aawgPort + '/csa/resources/tenants/default';
            callCreationInfo.info.setServiceGatewayURL(url);
            callCreationInfo.info.setAuthorizationToken(token);
            callCreationInfo.info.setContextId(contextId);

            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: AAWG address is ' + url);
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Starting call to - [' + amcSession.amcRoutepoint + '] with Work Request ID - [' + amcSession.workRequestId + ']');
            callCreationInfo.success = true;
        }

        return callCreationInfo;
    }

    function _getCallCreationInfoElite(eliteSession, isVideoCall) {
        var callCreationInfo = {
            success: false,
            reason: '',
            info: undefined
        };

        var calleeAddress = eliteSession.destination;
        if (calleeAddress === null || typeof calleeAddress !== 'string' || calleeAddress === '') {
            callCreationInfo.success = false;
            callCreationInfo.reason = 'Destination address is invalid';
        } else {
            var contextId = eliteSession.contextId;
            // if (isVideoCall) {
            //     //The WV,N flag is not requred for Elite Audio calls
            //     contextId = contextId + ',' + eliteSession.interactionType + ',N';
            // }
            callCreationInfo.info = new AvayaClientServices.Services.Call.CallCreationInfo(calleeAddress);
            var aawgAddress = _self._webGatewayConfiguration.webGatewayAddress;
            var aawgPort = _self._webGatewayConfiguration.port;
            var aawgProtocol = _self._webGatewayConfiguration.secure ? 'https' : 'http';

            var token = OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken || '';

            var url = aawgProtocol + '://' + aawgAddress + ':' + aawgPort + '/csa/resources/tenants/default';
            callCreationInfo.info.setServiceGatewayURL(url);
            callCreationInfo.info.setAuthorizationToken(token);
            callCreationInfo.info.setContextId(contextId);

            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: AAWG address is ' + url);
            OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Starting Elite call to - [' + calleeAddress + '] ');
            callCreationInfo.success = true;
        }

        return callCreationInfo;
    }

    function _createCall(platformType, session, videoDevice) {
        if (_self._callService.getVoipCallingCapability().isAllowed) {
            var callCreationInfo;
            //var isVideoCallCheck = videoDevice ? true : false;
            if (platformType === OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA) {
                callCreationInfo = _getCallCreationInfo(session);
            } else {
                var isVideoCall = videoDevice ? true : false;
                callCreationInfo = _getCallCreationInfoElite(session, isVideoCall);
            }
            if (callCreationInfo.success) {
                var call = _self._callService.createCall(callCreationInfo.info);

                call.addOnCallStartedCallback(function () {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call started');
                });
                call.addOnCallRemoteAlertingCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call alerting remotely');
                    _self.trigger('interaction.alerting', []);
                    _self._callTimeHandler.startTimer();

                    if (_self._mediaOperationHandler.isAudioMuted()) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: pre-call: muting audio');
                        _self._mediaOperationHandler.muteAudio(call, true);
                    }
                });
                /*if (isVideoCallCheck) {
                    if (callQualityParams.disableVideoFlag) {
                        call.addOnServiceQualityScoreChangedCallback(function (callback) {
                            console.info('CP : Call quality!!!', callback);
                            //logic to disable video ..
                            var date = new Date();
                            var currentTimeMillis = date.getTime();
                            if (callback < callQualityParams.callQualityThreshold) {
                                if (poorQualityStartTime < 0) {
                                    poorQualityStartTime = currentTimeMillis;
                                }
                                if (poorQualityStartTime >= 0 && (currentTimeMillis - poorQualityStartTime) > callQualityParams.maxWaitingTimeAfterReachingThreshold) {
                                    //Call quality has been poor for a long time. Stop video
                                    console.info("Video quality not satisfactory. Disabling video.");
                                    _self.trigger('interaction.videoDisabledPoorQuality', []);
                                    bVideoDisabledEventSent = true; // flag required if this video is disabled by us.
                                    //Reset Poor quality start time to give a fair assesment chance when Video is enabled again
                                    poorQualityStartTime = -1;
                                }
                            } else {
                                if (bVideoDisabledEventSent) {
                                    _self.trigger('interaction.videoCanBeEnabledGoodQuality', []);
                                    bVideoDisabledEventSent = false;
                                }
                                poorQualityStartTime = -1;
                            }
                        });
                    }
                }*/
                call.addOnServiceQualityScoreChangedCallback(function (callback) {
                    _self.trigger('interaction.getCallQuality', [callback]);
                });
                call.addOnCallEstablishedCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call connected');
                    _self.trigger('interaction.active', []);
                });
                call.addOnCallEndedCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call ended');
                    //Clear the video surface when ending the call so that when next call starts, the surface is clear
                    if (_self._videoHandler) {
                        _self._videoHandler.clearVideoSurface();
                    }
                    _self._callTimeHandler.stopTimer();
                    _self.trigger('interaction.ended', []);
                    _self.stop();
                });
                call.addOnCallFailedCallback(function (call, callException) {
                    //Clear the video surface if call fails so that when next call starts, the surface is clear
                    if (_self._videoHandler) {
                        _self._videoHandler.clearVideoSurface();
                    }
                    var error = callException.getError();
                    OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: Call failed. Error: ' + error);
                    _self._callTimeHandler.pauseTimer();
                    _self.trigger('interaction.failed', [{ reason: error }]);
                });
                call.addOnCallHeldRemotelyCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call remotely held');
                    _self.trigger('interaction.remotely.held', []);
                });
                call.addOnCallUnheldRemotelyCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call remotely unheld');
                    _self.trigger('interaction.remotely.unheld', []);
                });
                call.addOnCallQueuedCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call queued');
                    _self.trigger('interaction.queued', []);
                });
                call.addOnCallRedirectedCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call redirected');
                    _self.trigger('interaction.redirected', []);
                });
                call.addOnCallAudioMuteStatusChangedCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.log('CP: new audio mute state: ' + call.isAudioMuted());
                    _self.trigger('interaction.audiomute.statechange', [{ newState: call.isAudioMuted() }]);
                });
                call.addOnCallVideoChannelsUpdatedCallback(function (call, videoChannels) {
                    if (_self._videoHandler) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: video channels updated');
                        _self._videoHandler.updateVideoSurfaces(videoChannels);
                    } else {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: no video handler available');
                    }
                });
                call.addOnCallIncomingVideoAddRequestReceivedCallback(function (call, videoMode) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: far-end has requested to add [' + videoMode + '] video to the call');
                });
                call.addOnCallServiceAvailableCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.info('CP: Call signalling path available');
                    _self.trigger('service.connected', []);
                });
                call.addOnCallServiceUnavailableCallback(function (call) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CP: Call signalling path unavailable');
                    _self.trigger('service.disconnected', []);
                });
                if (videoDevice) {
                    _self._videoHandler = new OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.VideoHandler(_self._mediaServices, videoDevice);
                    var videoMode = _self._mediaOperationHandler.getStartingVideoMode();

                    call.setVideoMode(videoMode);
                }

                call.start();
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: Destination address is invalid');
                _self.trigger('interaction.failed', [{ reason: callCreationInfo.reason }]);
            }
        } else {
            _self.trigger('interaction.failed', [{ reason: 'Call failed - VoIP capability is currently unavailable' }]);
            OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: cannot make call - VoIP capability is currently unavailable');
        }
    }

    function _isOperationAllowed() {
        var allowed = false;

        if (_self._callService.getCallCount() > 0) {
            allowed = true;
        }
        return allowed;
    }

    function _performOperation(call, operation) {
        var result;
        if (_isOperationAllowed() && call) {
            switch (operation.name) {
                case OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_STATE:
                    var stateParser = new OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.StateParser();
                    var callState = call.getState();
                    result = stateParser.parse(callState);
                    break;
                case OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_DURATION:
                    var timeInSeconds = _self._callTimeHandler.getTimeElapsed();
                    var date = new Date(null);
                    date.setSeconds(timeInSeconds);
                    result = date.getTime();
                    break;
                case OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.SEND_DTMF:
                    var dtmfDigit = parseInt(operation.tone);
                    if (dtmfDigit >= 0 && dtmfDigit <= 15) {
                        var capability = call.getSendDTMFCapability();
                        if (capability.isAllowed) {
                            var dtmfParser = new OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser();
                            var dtmfTone = dtmfParser.parse(dtmfDigit);
                            call.sendDTMF(dtmfTone);
                            _playDtmfTone(dtmfDigit);
                        } else {
                            OceanaCustomerWebVoiceVideo.Base.Logger.warn('CP: sendDTMF capability not allowed [' + capability.denialReason + ']');
                        }
                    } else {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: invalid DTMF value supplied');
                    }
                    break;
                case OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.IS_SERVICE_AVAILABLE:
                    result = call.isServiceAvailable();
                    break;
                default:
                    OceanaCustomerWebVoiceVideo.Base.Logger.debug('CP: operation not supported [' + operation.name + ']');
                    break;
            }
        }

        return result;
    }

    function _performMediaOperation(call, operation) {
        var result;
        switch (operation.name) {
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_AUDIO_MUTED:
                result = _self._mediaOperationHandler.isAudioMuted(call);
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.MUTE_AUDIO:
                if (typeof (operation.muted) === 'boolean') {
                    _self._mediaOperationHandler.muteAudio(call, operation.muted);
                }
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_VIDEO_MUTED:
                result = _self._mediaOperationHandler.isVideoMuted(call);
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.MUTE_VIDEO:
                if (typeof (operation.muted) === 'boolean') {
                    _self._mediaOperationHandler.muteVideo(call, operation.muted);
                }
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_VIDEO_ENABLED:
                result = _self._mediaOperationHandler.isVideoEnabled(call);
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.ENABLE_VIDEO:
                if (typeof (operation.enabled) === 'boolean') {
                    _self._mediaOperationHandler.enableVideo(call, operation.enabled);
                }
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_CALL_HELD:
                if (typeof (operation.held) === 'boolean') {
                    _self._mediaOperationHandler.isCallHeld(call, operation.held);
                }
                break;
            case OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.HOLD_CALL:
                if (typeof (operation.held) === 'boolean') {
                    _self._mediaOperationHandler.holdCall(call, operation.held);
                }
                break;
            default:
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CP: media operation not supported  [' + operation.name + ']');
                break;
        }
        return result;
    }

    function _endCall(call) {
        //Clear the video surface when ending the call so that when next call starts, the surface is clear
        if (_self._videoHandler) {
            _self._videoHandler.clearVideoSurface();
        }
        if (_isOperationAllowed() && call) {
            call.end();
        }
    }

    function _readAudioDetails(call, callback) {
        if (call) {
            call.getAudioDetails().then(function (internalDetails) {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug("CpProvider: retrieved audio details");
                var details = _mapAudioDetails(internalDetails);
                callback(details);
            }, _audioDetailsFailed);
        }
    }

    function _readVideoDetails(call, callback) {
        if (call) {
            call.getVideoDetails().then(function (internalDetails) {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug("CpProvider: retrieved video details");
                var details = _mapVideoDetails(internalDetails);
                callback(details);
            }, _videoDetailsFailed);
        }
    }
    function _audioDetailsFailed(exception) {
        OceanaCustomerWebVoiceVideo.Base.Logger.error("CpProvider: failed to get audio details: " + exception.getError());
    }

    function _videoDetailsFailed(exception) {
        OceanaCustomerWebVoiceVideo.Base.Logger.error("CpProvider: failed to get video details: " + exception.getError());
    }

    function _mapAudioDetails(internalDetails) {
        var details = {
            bytesReceived: internalDetails.bytesReceived,
            bytesTransmitted: internalDetails.bytesTransmitted,
            averageJitterReceivedMillis: internalDetails.jitterMillisecondsReceived,
            packetLossTotalReceived: internalDetails.packetLossTotalReceived,
            packetLossTotalTransmitted: internalDetails.packetLossTotalTransmitted,
            packetsReceived: internalDetails.packetsReceived,
            packetsTransmitted: internalDetails.packetsTransmitted,
            roundTripTimeMillis: internalDetails.roundTripTimeMilliseconds
        };

        return details;
    }

    function _mapVideoDetails(internalDetails) {
        var details = {
            videoReceiveStatistics: {
                actualBitRate: internalDetails.actualBitRateReceived,
                actualFrameRate: internalDetails.actualFrameRateReceived,
                byteCount: internalDetails.bytesReceived,
                packetLossTotal: internalDetails.packetLossTotalReceived,
                packetLossFraction: internalDetails.packetsLossFractionReceived,
                packetCount: internalDetails.packetsReceived
            },
            videoTransmitStatistics: {
                actualBitRate: internalDetails.actualBitRateTransmitted,
                actualFrameRate: internalDetails.actualFrameRateTransmitted,
                byteCount: internalDetails.bytesTransmitted,
                packetLossTotal: internalDetails.packetLossTotalTransmitted,
                packetLossFraction: internalDetails.packetsLossFractionTransmitted,
                packetCount: internalDetails.packetsTransmitted
            }
        };

        return details;
    }

    // Map video resolution from Oceana SDK enum values to AvayaClientServices enum values
    function _mapCaptureResolution(resolution) {
        switch (resolution) {
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_320x180:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_180p;
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_416x240:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_240p;
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_640x360:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_360p;
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_848x480:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_480p;
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_1280x720:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_720p;
            case OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_1920x1080:
                return AvayaClientServices.Config.VideoResolution.RESOLUTION_1080p;
        }

        // Default to 480p
        return AvayaClientServices.Config.VideoResolution.RESOLUTION_480p;
    }

    // The JSCSDK does not play DTMF tones automatically, so we need to play them ourselves.
    function _playDtmfTone(dtmfDigit) {
        var dtmfParser = new OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser();

        var oscHigh = _getOscillator(dtmfParser.getHighFrequency(dtmfDigit));
        var oscLow = _getOscillator(dtmfParser.getLowFrequency(dtmfDigit));

        oscHigh.start();
        oscLow.start();

        setTimeout(function () {
            oscHigh.stop();
            oscLow.stop();
        }, 100);
    }

    function _getOscillator(freq) {
        if (!_audioContext) {
            _audioContext = new window.AudioContext();
        }

        var gainNode = _audioContext.createGain();
        gainNode.gain.value = 0.2;
        gainNode.connect(_audioContext.destination);

        var osc = _audioContext.createOscillator();
        osc.connect(gainNode);
        osc.frequency.value = freq;

        return osc;
    }

    // TODO finish this method, add log about delay or retry time
    function _exponentialBackoff(toTry, max, delay, expiredcallback) {

        var result = toTry();

        if (!result) {
            if (max > 0) {
                setTimeout(function () {
                    _exponentialBackoff(toTry, --max, delay * 2, expiredcallback);
                }, delay);

            } else {
                expiredcallback();
            }
        }
    }
    _.defaults(CpProvider.prototype, OceanaCustomerWebVoiceVideo.Base.Observable.prototype);

    OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider = CpProvider;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    var self;

    /**
     * @class
     * @classdesc Call Time Handler Class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.CallTimeHandler
     */
    function CallTimeHandler() {
        self = this;
        this._time = 0;
        this._timerInterval = undefined;
    }

    CallTimeHandler.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.CallTimeHandler */
        {
            startTimer: function () {
                self._timerInterval = setInterval(function () {
                    self._time = self._time + 1;
                }, 1000);
            },
            pauseTimer: function () {
                clearInterval(self._timerInterval);
            },
            stopTimer: function () {
                clearInterval(self._timerInterval);
                self._time = 0;
            },
            getTimeElapsed: function () {
                return self._time;
            }
        };

    OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.CallTimeHandler = CallTimeHandler;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    /**
     * @class
     * @classdesc Communication services configuration handler class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.ConfigHandler
     */
    function ConfigHandler() {

    }

    ConfigHandler.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.ConfigHandler */
        {
            createUserConfig: function (videoEnabled, videoResolution) {
                var callUserConfiguration = new AvayaClientServices.Config.CallUserConfiguration();
                callUserConfiguration.incomingCall = false;
                callUserConfiguration.videoEnabled = videoEnabled;
                callUserConfiguration.videoMaxBandwidthAnyNetwork = 1024;


                var mediaConfig = new AvayaClientServices.Config.MediaConfiguration();
                mediaConfig.voipConfigurationVideo = new AvayaClientServices.Config.VoIPConfigurationVideo();

                // TODO: Decide about video resolution;
                // note that JSCSDK will reduce until it finds a resolution that the camera supports
                mediaConfig.voipConfigurationVideo.videoResolution = videoResolution;

                var sgConfiguration = new AvayaClientServices.Config.SGConfiguration();

                sgConfiguration.maxCallStartReconnectionAttempts = 3;
                
                var config = {
                    callUserConfiguration: callUserConfiguration,
                    sgConfiguration: sgConfiguration,
                    mediaConfiguration: mediaConfig
                };

                return config;
            }
        };

    OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.ConfigHandler = ConfigHandler;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    // TODO improve this calls so it actually works, needs to check for devices connected and should handle blocked devices if possible

    /**
     * @class
     * @classdesc Communication services device handler class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.DeviceHandler
     */
    function DeviceHandler(mediaServices) {
        this._mediaServices = mediaServices;
        this._audioInputInterface = this._mediaServices.getAudioInterface().getInputInterface();
        this._audioOutputInterface = this._mediaServices.getAudioInterface().getOutputInterface();
        this._videoInterface = this._mediaServices.getVideoInterface();
    }

    DeviceHandler.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.DeviceHandler */
        {
            hasAudioDevice: function() {
                var hasSpeakers = (this._audioOutputInterface.getAvailableDevices().length > 0);
                var hasMic = (this._audioInputInterface.getAvailableDevices().length > 0);
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CP: Microphone available: ' + hasMic);
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CP: Speakers available: ' + hasSpeakers);
                // The test for available output devices only works in Chrome, so we don't check it before permitting calls
                // We only check that a microphone is available.
                return hasMic; 
            },
            hasVideoDevice: function() {
                return this._videoInterface.getAvailableDevices().length > 0;
            }
        };

    OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.DeviceHandler = DeviceHandler;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    var _self;
    /**
     * @class
     * @classdesc Communication services media operation handler class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.MediaOperationHandler
     */
    function MediaOperationHandler(provider) {
        OceanaCustomerWebVoiceVideo.Base.Watcher.call(this);
        _self = this;
        this._provider = provider;

        this._audioMuted = false;
        this._videoMuted = false;
        this._videoEnabled = true;
        this._callHeld = false;

        this._videoMuteWatcher = function (propertyName, oldValue, newValue) {
            if(newValue !== oldValue) {
                _self._provider.trigger('interaction.videomute.statechange', [{ newState: newValue }]);
            }
        };
        this.videoEnabledWatcher = function (propertyName, oldValue, newValue) {
            if(newValue !== oldValue) {
                // when new value indicates the video is disabled and when video is currently muted 
                // change video mute state to false, as there is no way to get back to a muted video state when disabled 
                if(!newValue && _self._videoMuted) {
                    _self._videoMuted = false;
                }
                _self._provider.trigger('interaction.videoenabled.statechange', [{ newState: newValue }]);
            }       
        };

        this.callHeldWatcher = function (propertyName, oldValue, newValue) {
            if(newValue !== oldValue) {
                _self._provider.trigger('interaction.callhold.statechange', [{ newState: newValue }]);
            }
        };
        

        this.watch(this, '_videoMuted', this._videoMuteWatcher);
        this.watch(this, '_videoEnabled', this.videoEnabledWatcher);
        this.watch(this, '_callHeld', this.callHeldWatcher);

    }

    MediaOperationHandler.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.MediaOperationHandler */
        {
            isAudioMuted: function (call) {
                var muted = this._audioMuted;
                if (call && _hasCallState(call, ['remote_alerting', 'established', 'renegotiating', 'far_end_renegotiating'])) {
                    muted = call.isAudioMuted();
                }
                return muted;
            },
            muteAudio: function (call, muted) {
                this._audioMuted = muted;
                if (call && _hasCallState(call, ['remote_alerting', 'established', 'renegotiating', 'far_end_renegotiating']) && muted) {
                    this.doMuteAudio(call);
                } else if (call && _hasCallState(call, ['remote_alerting', 'established', 'renegotiating', 'far_end_renegotiating']) && !muted) {
                    this.doUnmuteAudio(call);
                } else {
                    this._audioMuted = muted;
                    // OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: cannot set audio muted [' + muted + '] in current call state:');
                }
            },
            doMuteAudio: function (call) {
                var capability = call.getMuteCapability();
                if (capability.isAllowed) {
                    call.muteAudio();
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: mute audio capability not allowed [' + capability.denialReason + ']');
                }
            },
            doUnmuteAudio: function (call) {
                var capability = call.getUnmuteCapability();
                if (capability.isAllowed) {
                    call.unmuteAudio();
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: umute audio capability not allowed [' + capability.denialReason + ']');
                }
            },
            isVideoMuted: function (call) {
                var muted = this._videoMuted;
                if (call && _hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && call.getVideoChannels()[0]) {
                    muted = _hasCallMediaDirection(call.getVideoChannels()[0], ['recvonly']);
                }
                return muted;
            },
            muteVideo: function (call, muted) {
                if (call) {
                    if (_hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && muted) {
                        this.doMuteVideo(call);
                    } else if (_hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && !muted) {
                        this.doUnmuteVideo(call);
                    } else {
                        OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: cannot set video muted [' + muted + '] in current call state [' + call.getState() + ']');
                    }
                } else {
                    // video can only be muted if it is enabled
                    if(this._videoEnabled) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CpProvider: pre-call: setting video mute to ' + muted);
                        this._videoMuted = muted;
                    } else  {
                        OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: cannot set video muted [' + muted + '] because video is not enabled');
                    }
                }
            },
            doMuteVideo: function (call) {
                if (_hasCallMediaDirection(call.getVideoChannels()[0], ['sendrecv'])) {
                    var capability = call.getUpdateVideoModeReceiveOnlyCapability();
                    if (capability.isAllowed) {
                        call.setVideoMode(AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY).then(function () {
                            _self._videoMuted = true;
                        }, function (exception) {
                            OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error muting video [' + exception.getError() + ']');
                        });
                    } else {
                        OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: mute video capability not allowed [' + capability.denialReason + ']');
                    }
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: mute video capability not allowed [NEGOTIATED_MEDIA_DIRECTION_INVALID]');
                }
            },
            doUnmuteVideo: function (call) {
                if (_hasCallMediaDirection(call.getVideoChannels()[0], ['recvonly'])) {
                    var capability = call.getUpdateVideoModeSendReceiveCapability();
                    if (capability.isAllowed) {
                        call.setVideoMode(AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE).then(function () {
                            _self._videoMuted = false;
                        }, function (exception) {
                            OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error unmuting video [' + exception.getError() + ']');
                        });
                    } else {
                        OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: unmute video capability not allowed [' + capability.denialReason + ']');
                    }
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: unmute video capability not allowed [NEGOTIATED_MEDIA_DIRECTION_INVALID]');
                }
            },
            isVideoEnabled: function (call) {
                var enabled = this._videoEnabled;
                if (call && _hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && call.getVideoChannels()[0]) {
                    enabled = _hasCallMediaDirection(call.getVideoChannels()[0], ['sendrecv', 'recvonly', 'sendonly']);
                }
                return enabled;
            },
            enableVideo: function (call, enabled) {
                if (call && _hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && enabled) {
                    this.doEnableVideo(call);
                } else if (call && _hasCallState(call, ['idle', 'established', 'renegotiating', 'far_end_renegotiating']) && !enabled) {
                    this.doDisableVideo(call);
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: cannot change video enable state to [' + enabled + '] in current call state [' + call.getState() + ']');
                }
            },
            doEnableVideo: function (call) {
                var capability = call.getUpdateVideoModeSendReceiveCapability();
                if (capability.isAllowed) {
                    call.setVideoMode(AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE).then(function () {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CpProvider: enabled video');
                        _self._videoEnabled = true;
                    }, function (exception) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error enabling video [' + exception.getError() + ']');
                    });
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: enable video capability not allowed [' + capability.denialReason + ']');
                }
            },
            doDisableVideo: function (call) {
                var capability = call.getUpdateVideoModeDisableCapability();
                if (capability.isAllowed) {
                    call.setVideoMode(AvayaClientServices.Services.Call.VideoMode.DISABLE).then(function () {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CpProvider: disabled video');
                        _self._videoEnabled = false;
                    }, function (exception) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error inactivating video [' + exception.getError() + ']');
                    });
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: disable video capability not allowed [' + capability.denialReason + ']');
                }
            },
            getStartingVideoMode: function () {
                var videoMode = AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE;
                if(!this._videoEnabled) {
                    videoMode = AvayaClientServices.Services.Call.VideoMode.INACTIVE;   
                } else if(this._videoEnabled && this._videoMuted) {
                    videoMode = AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY;
                } else if (!this._provider._deviceHandler.hasVideoDevice()) {
                    OceanaCustomerWebVoiceVideo.Base.Logger.error('CP: cannot start a video call with SEND_RECEIVE mode, falling back to RECEIVE_ONLY mode');
                    videoMode = AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY;
                }
                
                return videoMode;
            },
            setDefaultMediaState: function () {
                this.unwatch(this, '_videoMuted');
                this.unwatch(this, '_videoEnabled');
                this.unwatch(this, '_callHeld');                
                this._audioMuted = false;
                this._videoMuted = false;
                this._videoEnabled = true;
                this.watch(this, '_videoMuted', this._videoMuteWatcher);
                this.watch(this, '_videoEnabled', this.videoEnabledWatcher);
                this.watch(this, '_callHeld', this.callHeldWatcher);
            },
            isCallHeld: function (call) {
                return call && _hasCallState(call, ['held']);             
            },
            holdCall: function (call, held) {
               
                if (call && _hasCallState(call, ['established'])) {
                    this.doHoldCall(call);
                } else if (call && _hasCallState(call, ['held'])) {
                    this.doUnholdCall(call);
                } else {
                    this._callHeld = held;
                }
            },
            doHoldCall: function (call) {
                var capability = call.getHoldCapability();
                if (capability.isAllowed) {
                    call.hold().then(function () {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CpProvider: Call held');
                        _self._callHeld = true;
                    }, function (exception) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error holding call [' + exception.getError() + ']');
                    });
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: Hold capability not allowed [' + capability.denialReason + ']');
                }
            },
            doUnholdCall: function (call) {
                var capability = call.getUnholdCapability();
                if (capability.isAllowed) {
                    call.unhold().then(function () {
                        OceanaCustomerWebVoiceVideo.Base.Logger.info('CpProvider: Call unheld');
                        _self._callHeld = false;
                    }, function (exception) {
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('CpProvider: error unholding call [' + exception.getError() + ']');
                    });
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.warn('CpProvider: Unhold  capability not allowed [' + capability.denialReason + ']');
                }
            },
        };

    function _hasCallState(call, states) {
        return _.includes(states, call.getState());
    }

    function _hasCallMediaDirection(videoChannel, directions) {
        return _.includes(directions, videoChannel.getNegotiatedDirection());
    }

    _.defaults(MediaOperationHandler.prototype, OceanaCustomerWebVoiceVideo.Base.Watcher.prototype);

    OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.MediaOperationHandler = MediaOperationHandler;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    /**
     * @class
     * @classdesc Communication services video handler class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Handlers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.VideoHandler
     */
    function VideoHandler(mediaServices, videoDevice) {
        this._mediaServices = mediaServices;
        this._videoDevice = videoDevice;

        // Create video surface
        this._localSurface = _prepareVideoSurface(this._videoDevice.localView, "local", true);
        this._remoteSurface = _prepareVideoSurface(this._videoDevice.remoteView, "remote", true);
    }

    VideoHandler.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.VideoHandler */
    {
        getStreams: function (videoChannels) {
            var streams = {
                local: null,
                remote: null,
            };

            var videoChannel = videoChannels[0];
            if (videoChannel) {
                var localStream;
                var remoteStream;

                switch (videoChannel.getNegotiatedDirection()) {
                    case AvayaClientServices.Services.Call.MediaDirection.RECV_ONLY:
                        localStream = null; // ychoo
                        remoteStream = this._mediaServices.getVideoInterface().getRemoteMediaStream(videoChannel.getChannelId());
                        break;
                    case AvayaClientServices.Services.Call.MediaDirection.SEND_ONLY:
                        localStream = this._mediaServices.getVideoInterface().getLocalMediaStream(videoChannel.getChannelId());
                        remoteStream = null; // ychoo
                        break;
                    case AvayaClientServices.Services.Call.MediaDirection.SEND_RECV:
                        localStream = this._mediaServices.getVideoInterface().getLocalMediaStream(videoChannel.getChannelId());
                        remoteStream = this._mediaServices.getVideoInterface().getRemoteMediaStream(videoChannel.getChannelId());
                        break;
                    case AvayaClientServices.Services.Call.MediaDirection.INACTIVE:
                        break;
                    case AvayaClientServices.Services.Call.MediaDirection.DISABLE:
                        break;
                    default:
                        localStream = null;
                        remoteStream = null;
                        break;
                }
                streams.local = localStream;
                streams.remote = remoteStream;
            }
            return streams;
        },
        updateVideoSurfaces: function (videoChannels) {
            var streams = this.getStreams(videoChannels);

            if (streams) {
                _updateVideoSurfaceStream(this._localSurface, streams.local, 'local');
                _updateVideoSurfaceStream(this._remoteSurface, streams.remote, 'remote');
            }
        },
        clearVideoSurface: function () {
            _clearVideoSurfaceStream(this._videoDevice.localView);
            _clearVideoSurfaceStream(this._videoDevice.remoteView);
        }
    };

    function _prepareVideoSurface(surfaceId, streamName, startMuted) {

        var surface = document.getElementById(surfaceId);

        if (!_.isUndefined(surface)) {

            if (surface.tagName.toLowerCase() === 'div') {
                // This is a div - create a new video tag inside it and use that as the surface instead
                //var videoElement = document.createElement('video');

                var videoElement;
                if (streamName === 'local') {
                    videoElement = document.getElementById('videoLocal');
                } else if (streamName === 'remote') {
                    videoElement = document.getElementById('videoRemote');
                }

                videoElement.setAttribute("width", "100%");
                videoElement.setAttribute("height", "100%");

                videoElement.muted = startMuted;

                // Empty out anything that was previously in the div
                // while (surface.firstChild) {
                //     surface.removeChild(surface.firstChild);
                // }

                // surface.appendChild(videoElement);
                surface = videoElement;
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: cannot use ' + surfaceId + ' as ' + streamName + ' video surface is not a div : invalid tag: ' + tagName);
            }

            if (surface.tagName.toLowerCase() === 'video') {
                return surface;
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: cannot use ' + surfaceId + ' as ' + streamName + ' video surface: invalid tag: ' + tagName);
            }
        }
        else {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: no ' + streamName + ' video surface');
        }

        return undefined;
    }

    function _updateVideoSurfaceStream(surface, stream, streamName) {
        OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: setting up ' + streamName + ' video surface.');
        console.log('CpProvider: stream = ' + stream);
        console.log('CpProvider: surface = ' + surface);

        if (surface) {
            if (stream) {
                // ychoo - Workaround for Firefox issue of unmute. 
                // Clone so that we display a new video only MediaStream
                var isFirefox = AvayaClientServices.Base.Utils.getBrowserType() === AvayaClientServices.Base.BrowserType.FIREFOX;

                if (streamName === 'local' && isFirefox) {
                    var videoOnlyStream = new MediaStream();
                    stream.getVideoTracks().forEach(function (track) {
                        videoOnlyStream.addTrack(track);
                    });
                    surface.srcObject = videoOnlyStream;
                } else {
                    surface.srcObject = stream;
                    console.log('CpProvider: Surface video width = ' + surface.videoWidth + ' video height = ' + surface.videoHeight);

                }
                surface.style.display = "block";
                //surface.play();
            }
            else {
                surface.style.display = "none";
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: no media stream to add to ' + streamName + ' video surface; hiding surface');
            }
        }
        else {
            OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: no surface to display ' + streamName + ' video stream');
        }
    }

    function _clearVideoSurfaceStream(surfaceId) {
        // OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: clearing up video surface.');
        // console.log(surfaceId);

        // var surface = document.getElementById(surfaceId);

        // if (!_.isUndefined(surface)) {

        //     if (surface.tagName.toLowerCase() === 'div') {
        //         // Empty out anything that was previously in the div
        //         while (surface.firstChild) {
        //             surface.removeChild(surface.firstChild);
        //         }
        //     }
        // } else {
        //     OceanaCustomerWebVoiceVideo.Base.Logger.debug('CpProvider: no surface found');
        // }
    }

    OceanaCustomerWebVoiceVideo.Providers.CP.Handlers.VideoHandler = VideoHandler;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    /**
     * @class
     * @classdesc DtmfParser Class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Parsers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser
     */
    function DtmfParser() {
        
    }

    DtmfParser.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser */
        {
            /**
             * Convert from interaction DTMFTone to call DTMFTone
             *
             * @public
             * @function OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser#parse
             * @param {OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone} dtmfTone - the interaction dtmfTone
             * @returns {OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone} dtmfTone
             */
            parse: function(dtmf) {
                var dtmfTone;

                switch (dtmf) {
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ZERO: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.ZERO;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ONE: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.ONE;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.TWO: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.TWO;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.THREE: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.THREE;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FOUR: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.FOUR;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FIVE:
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.FIVE; 
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SIX: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.SIX;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SEVEN: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.SEVEN;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.EIGHT: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.EIGHT;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.NINE: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.NINE;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.STAR: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.STAR;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.POUND: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.POUND;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.A: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.A;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.B: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.B;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.C: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.C;
                        break;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.D: 
                        dtmfTone = AvayaClientServices.Services.Call.DTMFTone.D;
                        break;
                }

                return dtmfTone;
            },
            getHighFrequency: function(dtmf) {
                var frequency;
                
                switch (dtmf) {
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ONE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FOUR: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SEVEN: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.STAR:
                        return 1209;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.TWO: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FIVE:
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.EIGHT: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ZERO: 
                        return 1336;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.THREE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SIX: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.NINE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.POUND: 
                        return 1477;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.A: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.B: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.C: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.D: 
                        return 1633;
                }
                return 500;
            },
            getLowFrequency: function(dtmf) {
                var frequency;
                
                switch (dtmf) {
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ONE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.TWO: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.THREE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.A: 
                        return 697;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FOUR: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.FIVE:
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SIX: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.B: 
                        return 770;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.SEVEN: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.EIGHT: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.NINE: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.C: 
                        return 852;
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.STAR:
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.ZERO: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.POUND: 
                    case OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone.D: 
                        return 941;
                }
                return 500;
            }
        };
        
        OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.DtmfParser = DtmfParser;
        
    })(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, global) {
    'use strict';

    /**
     * @class
     * @classdesc StateParser Class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers.CP.Parsers
     * @define OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.StateParser
     */
    function StateParser() {
        
    }

    StateParser.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.StateParser */
        {
            /**
             * Convert from communication service call state to interaction state
             *
             * @public
             * @function OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.StateParser#parse
             * @param {AvayaClientServices.Services.Call.CallStates} state - the communication service call state
             * @returns {OceanaCustomerWebVoiceVideo.Services.Work.InteractionState} interactionState
             */
            parse: function(state) {
                var interactionState;

                switch (state) {
                    case AvayaClientServices.Services.Call.CallStates.IDLE: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.INITIATING: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.REMOTE_ALERTING: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.REMOTE_ALERTING;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.ESTABLISHED: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.FAILED: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.FAILED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.ENDING:
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ENDING; 
                        break;
                    case AvayaClientServices.Services.Call.CallStates.ENDED: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ENDED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.RENEGOTIATING: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.FAR_END_RENEGOTIATING: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.BEING_TRANSFERRED: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
                        break;
                    case AvayaClientServices.Services.Call.CallStates.HELD: 
                        interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.HELD;
                        break;
                }

                return interactionState;
            }
        };

    OceanaCustomerWebVoiceVideo.Providers.CP.Parsers.StateParser = StateParser;

})(OceanaCustomerWebVoiceVideo, window);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
/**
 * @file Provider Factory
 * @author Avaya Inc
 * @version 1.0.0
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';

    var _amcProvider;

    /**
     * @class
     * @memberOf OceanaCustomerWebVoiceVideo.Providers
     * @define OceanaCustomerWebVoiceVideo.Providers.ProviderFactory
     */
    function ProviderFactory() {
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider}
         */
        this._amcProvider = {};
    }

    ProviderFactory.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Providers.ProviderFactory */
    {
        /**
         * Returns the AmcProvider instance
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.ProviderFactory#getAmcProvider
         * @returns {OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider}
         */
        getAmcProvider: function () {
            if (!_.isEmpty(this._amcProvider)) {
                return this._amcProvider;
            }
            this._amcProvider = new OceanaCustomerWebVoiceVideo.Providers.AMC.AmcProvider();
            return this._amcProvider;
        },
        /**
         * Returns the Call Provider instance
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Providers.ProviderFactory#getCallProvider
         * @returns {OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider}
         */
        getCallProvider: function () {
            if (!_.isEmpty(this._callProvider)) {
                return this._callProvider;
            }

            // if the aawg configuration is available and it is enabled create a CP provider
            var config = OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().config;
            if(_.has(config, 'webGatewayConfiguration')) {
                OceanaCustomerWebVoiceVideo.Base.Logger.log('Provider: CP');
                this._callProvider = new OceanaCustomerWebVoiceVideo.Providers.CP.CpProvider(config.webGatewayConfiguration);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.error('Cannot start provider - missing configuration');
            }
            return this._callProvider;
        }
    };
    OceanaCustomerWebVoiceVideo.Providers.ProviderFactory = ProviderFactory;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all Video Quality
     *
     * @readonly
     * @enum {number}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Devices
     * @define OceanaCustomerWebVoiceVideo.Services.Devices.CallQuality
     */
    var CallQuality = {
        BAD: 1,
        POOR: 2,
        FAIR: 3,
        GOOD: 4,
        EXCELLENT: 5
    };

    /**
     * @typedef CallQuality
     * OceanaCustomerWebVoiceVideo.Services.Devices.CallQuality
     * @property {number} BAD
     * @property {number} POOR
     * @property {number} FAIR
     * @property {number} GOOD
     * @property {number} EXCELLENT
     */

    OceanaCustomerWebVoiceVideo.Services.Devices.CallQuality = CallQuality;

})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all accepted Camera Resolutions
     *
     * @readonly
     * @enum {number}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Devices
     * @define OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution
     */
    var CameraResolution = {
        RESOLUTION_416x240: '416x240',
        RESOLUTION_640x360: '640x360',
        RESOLUTION_848x480: '848x480',
        RESOLUTION_1280x720: '1280x720',
        RESOLUTION_1920x1080: '1920x1080'
    };

    /**
     * @typedef CameraResolution
     * OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution
     * @property {string} RESOLUTION_416x240
     * @property {string} RESOLUTION_640x360
     * @property {string} RESOLUTION_848x480
     * @property {string} RESOLUTION_1280x720
     * @property {string} RESOLUTION_1920x1080
     */
    
    OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution = CameraResolution;

})(OceanaCustomerWebVoiceVideo, _);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';

    /**
     * @class
     * @classdesc Video Device Class allows setup of the video media stream
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Devices
     * @define OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice
     */
    function VideoDevice () {
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution}
         */
        this.cameraCaptureResolution = OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution.RESOLUTION_848x480;
        /**
         * @private
         * @type {String}
         */
        this.localView = undefined;
        /**
         * @private
         * @type {String}
         */
        this.remoteView = undefined;
    }

    VideoDevice.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice.prototype */
    {
        /**
         * Get the selected camera capture resolution
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#getCameraCaptureResolution
         * @returns {OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution} resolution - the current camera capture resolution
         */
        getCameraCaptureResolution: function () {
            return this.cameraCaptureResolution;
        },
        /**
         * Set the camera capture resolution for the interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#setCameraCaptureResolution
         * @param {OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution} resolution - the desired camera capture resolution
         */
        setCameraCaptureResolution: function (resolution) {
            this.cameraCaptureResolution = resolution;
        },
        /**
         * Set the camera capture resolution for the interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#withCameraCaptureResolution
         * @param {OceanaCustomerWebVoiceVideo.Services.Devices.CameraResolution} resolution - the desired camera capture resolution
         * @returns {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice}
         */
        withCameraCaptureResolution: function (resolution) {
            this.cameraCaptureResolution = resolution;
            return this;
        },
        /**
         * Set the view to render the local video stream
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#setLocalView
         * @param {String} view - the id of the video tag to use when drawing local video
         */
        setLocalView: function (view) {
            this.localView = view;
        },
        /**
         * Set the view to render the local video stream
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#withLocalView
         * @param {String} view - the id of the video tag to use when drawing local video
         * @returns {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice}
         */
        withLocalView: function (view) {
            this.localView = view;
            return this;
        },
        /**
         * Set the view to render the remote video stream
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#setRemoteView
         * @param {String} view - the id of the video tag to use when drawing remote video
         */
        setRemoteView: function (view) {
            this.remoteView = view;
        },
        /**
         * Set the view to render the remote video stream
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice#withRemoteView
         * @param {String} view - the id of the video tag to use when drawing remote video
         * @returns {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice}
         */
        withRemoteView: function (view) {
            this.remoteView = view;
            return this;
        }
    };

    OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice = VideoDevice;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    /**
     * @class
     * @classdesc Attribute class - a attribute is used to route work to a resource in Oceana
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Attributes
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute
     */
    function Attribute () {
        /**
         * @private
         * @type {String}
         */
        this.name = undefined;
        /**
         * @private
         * @type {String[]}
         */
        this.values = [];
        /**
         * @private
         * @type {Boolean}
         */
        this.routable = true;
    }

    Attribute.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute */
    {
        /**
         * Update the Attribute name
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute#withName
         * @param {String} name - the attribute name
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} Attribute
         */
        withName: function (name) {
            this.name = name;
            return this;
        },
        /**
         * Update the Attribute value/s
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute#withValues
         * @param {Array.<String>} values - the attribute value/s
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} Attribute
         */
        withValues: function (values) {
            this.values = values;
            return this;
        }
    };

    OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute = Attribute;

})(OceanaCustomerWebVoiceVideo);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';

    /**
     * @class
     * @classdesc Attribute list is a collection of Attributes
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Attributes
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList
     */
    function AttributeList() {
        // clear attributes list
        OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes = [];
    }
    
    AttributeList.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList */
    {
        /**
         * Helper method to create a Attribute
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#createAttribute
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} Attribute
         */
        createAttribute: function () {
          return new OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute();
        },
        /**
         * Check if the provided Attribute is present in the collection of Attributes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#isPresent
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} Attribute
         * @returns {boolean} found - true or false if Attribute is found
         */
        isPresent: function (attribute) {
            var index = _.indexOf(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, attribute);
            if (index === -1) {
                return false;
            } else {
                return true;
            }
        },
        /**
         * Retrieves all Attributes in the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#findAll
         * @returns {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute>} Attributes - a collection of Attributes
         */
        findAll: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes;
        },
        /**
         * Add or update a Attribute in the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#upsert
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} attribute
         */
        upsert: function (attribute) {
            if (_isAttributeValid(attribute)) {
                if (!this.isPresent(attribute)) {
                    OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.push(attribute);
                } else {
                    var index = _.indexOf(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, _.find(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, attribute.name));
                    OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.splice(index, 1, attribute);
                }
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('Error Adding Attribute: invalid attribute supplied');
                OceanaCustomerWebVoiceVideo.Base.Logger.debug(JSON.parse(JSON.stringify(attribute)));
            }
        },
        /**
         * Add or update one or more Attributes in the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#upsertMultiple
         * @param {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute>} attributes
         */
        upsertMultiple: function (attributes) {
            var self = this;
            _.forEach(attributes,function (attribute) {
                if (_isAttributeValid(attribute)) {
                    if (!self.isPresent(attribute)) {
                        OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.push(attribute);
                    } else {
                        var index = _.indexOf(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, _.find(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, attribute.name));
                        OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.splice(index, 1, attribute);
                    }
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.debug('Error Adding Attribute: invalid attribute supplied');
                    OceanaCustomerWebVoiceVideo.Base.Logger.debug(JSON.parse(JSON.stringify(attribute)));
                }
            });
            
        },
        /**
         * Remove an Attribute from the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#delete
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute} attribute
         */
        delete: function (attribute) {
            if (_isAttributeValid(attribute)) {
                var index = _.indexOf(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, attribute);
                if (index !== -1) {
                    OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.splice(index, 1);
                }
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.debug('Error Removing Attribute: invalid attribute supplied');
                OceanaCustomerWebVoiceVideo.Base.Logger.debug(JSON.parse(JSON.stringify(attribute)));
            }
        },
        /**
         * Remove one or more Attributes from the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#deleteMultiple
         * @param {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Attributes.Attribute>} attributes
         */
        deleteMultiple: function (attributes) {
            var self = this;
            _.forEach(attributes, function (attribute) {
                if (_isAttributeValid(attribute)) {
                    var index = _.indexOf(OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes, attribute);
                    if (index !== -1) {
                        OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes.splice(index, 1);
                    }
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.debug('Error Removing Attribute: invalid attribute supplied');
                    OceanaCustomerWebVoiceVideo.Base.Logger.debug(JSON.parse(JSON.stringify(attribute)));
                }
            });

        },
        /**
         * Remove all attributes from the collection
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList#deleteAll
         */
        deleteAll: function () {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().attributes = [];
        }
    };

    /**
     * Function to check if a attribute is valid
     * @param attribute
     * @return {boolean}
     * @private
     */
    function _isAttributeValid(attribute) {
        var isValid = false;
        if(attribute.name && attribute.values) {
            return true;
        }
        return isValid;
    }

    OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList = AttributeList;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all accepted DTMF tones
     * OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone
     * @enum {Number}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone
     */
    var DTMFTone = {
        ZERO: 0,
        ONE: 1,
        TWO: 2,
        THREE: 3,
        FOUR: 4,
        FIVE: 5,
        SIX: 6,
        SEVEN: 7,
        EIGHT: 8,
        NINE: 9,
        STAR: 10,
        POUND: 11,
        A: 12,
        B: 13,
        C: 14,
        D: 15
    };

    /**
     * @typedef DTMFTone
     * @property {number} ZERO
     * @property {number} ONE
     * @property {number} TWO
     * @property {number} THREE
     * @property {number} FOUR
     * @property {number} FIVE
     * @property {number} SIX
     * @property {number} SEVEN
     * @property {number} EIGHT
     * @property {number} NINE
     * @property {number} STAR
     * @property {number} POUND
     * @property {number} A
     * @property {number} B
     * @property {number} C
     * @property {number} D
     */

    OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone = DTMFTone;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo, _) {
    'use strict';
    /**
     * Lists all Interaction States
     *
     * @readonly
     * @enum {number}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work.InteractionState
     */
    var InteractionState = {
        IDLE: 0,
        INITIATING: 1,
        REMOTE_ALERTING: 2,
        ESTABLISHED: 4,
        ENDING: 5,
        ENDED: 6,
        FAILED: 7,
        HELD:8
    };

    /**
     * @typedef InteractionState
     * OceanaCustomerWebVoiceVideo.Services.Work.InteractionState
     * @property {number} IDLE
     * @property {number} INITIATING
     * @property {number} REMOTE_ALERTING
     * @property {number} ESTABLISHED
     * @property {number} ENDING
     * @property {number} ENDED
     * @property {number} FAILED
     * @property {number} HELD
     */

    OceanaCustomerWebVoiceVideo.Services.Work.InteractionState = InteractionState;

})(OceanaCustomerWebVoiceVideo, _);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * Lists all Interaction Types
     *
     * @readonly
     * @enum {number}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work.InteractionType
     */
    var InteractionType = {
        AUDIO_ONLY: 0,
        VIDEO: 1
    };

    /**
     * @typedef InteractionType
     * OceanaCustomerWebVoiceVideo.Services.Work.InteractionState
     * @property {number} AUDIO_ONLY
     * @property {number} VIDEO
     */
    OceanaCustomerWebVoiceVideo.Services.Work.InteractionType = InteractionType;

})(OceanaCustomerWebVoiceVideo);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    /**
     * Lists all Platform Types
     *
     * @readonly
     * @enum {string}
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
     * @description Define the call type when making a call using this enumeration
     */
    var PlatformType = {
        OCEANA: 'OCEANA',
        ELITE: 'ELITE'
    };

    /**
     * @typedef PlatformType
     * OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
     * @property {string} OCEANA
     * @property {string} ELITE
     */
    OceanaCustomerWebVoiceVideo.Services.Work.PlatformType = PlatformType;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';
    var self;

    var _amcProvider;
    var _callProvider;

    var _amcSession;

    var _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.IDLE;

    /**
     * @class
     * @classdesc Audio Interaction class encapsulates the logic of an audio call
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Interactions
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction
       @param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType. Currently supported platform types are OCEANA and ELITE
     */
    function AudioInteraction(platformType) {
        OceanaCustomerWebVoiceVideo.Base.Observable.call(this);
        self = this;
        /**
         * @private
         * @type {string}
         */
        this.destination = undefined;
        /**
        * @private
        * @type {string}
        */
        this.contextId = undefined;
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Services.Work.PlatformType}
         */
        this.platformType = platformType;
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionInitiating = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionRemoteAlerting = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionActive = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionCallQuality = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionEnded = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionFailed = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionAudioMuteStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionHoldStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionServiceConnected = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionServiceConnecting = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onAudioInteractionServiceDisconnected = new OceanaCustomerWebVoiceVideo.Base.Callbacks();

        var providerFactory = new OceanaCustomerWebVoiceVideo.Providers.ProviderFactory();
        if (this.platformType === OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA) {
            _amcProvider = providerFactory.getAmcProvider();
        }
        _callProvider = providerFactory.getCallProvider();
    }

    AudioInteraction.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction */
    {
        /**
         * Get the authorization token, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getAuthorizationToken
         * @returns {String} authorization token
         */
        getAuthorizationToken: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken || '';
        },
        /**
         * Set the authorization token<br/>
         * In the current Oceana release, the authorization token identifies the customer within AAWG<br/>
         * This identity is used for the lifetime of the call
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#setAuthorizationToken
         * @param {object} token The authorization token to set
         */
        setAuthorizationToken: function (token) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken = token;
        },
        /**
         * Shutdown the SDK after the interaction has ended
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#discard
         */
        discard: function () {
            _callProvider.stop();
        },
        /**
         * Get the remote destination address, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getDestinationAddress
         * @returns {String} destination address
         */
        getDestinationAddress: function () {
            return this.destination;
        },
        /**
         * Set the remote destination address, for SIP this is the unescaped URI of the remote end of the interaction.
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#setDestinationAddress
         * @param {String} destination - the destination address
         */
        setDestinationAddress: function (destination) {
            var isValid = /^\+?(0|[1-9]\d*)$/.test(destination);
            if (isValid) {
                this.destination = destination;
            } else {
                this.destination = undefined;
                OceanaCustomerWebVoiceVideo.Base.Logger.error('AUDIO INTERACTION: invalid destination supplied, please provide a number');
            }
        },
        /**
         * Get the platformType, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getPlatformType
         * @returns {String} OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
         */
        getPlatformType: function () {
            return this.platformType || OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA;
        },
        /**
         * Set the Platform type<br/>
         * Currently supported platform types are OCEANA and ELITE
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#setPlatformType
         * @param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
         */
        setPlatformType: function (platformType) {
            this.platformType = platformType;
        },
        /**
         * Get the ContextId, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getContextId
         * @returns {String} context Id
         */
        getContextId: function () {

            return this.contextId;
        },
        /**
         * Set the ContextId <br/>
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#setContextId
         * @param {String} contextId 
         */
        setContextId: function (contextId) {
            this.contextId = contextId;
        },
        /**
         * Initiate a Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#start
         */
        start: function () {
            if (!OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken) {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('AUDIO INTERACTION: Cannot start Audio Interaction! Authorization Token has not been set.');
                return;
            }

            _startCallProvider(function () {
                var interactionContext = self;
                _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.IDLE;
                interactionContext.onAudioInteractionInitiating.fire();

                if (interactionContext.getPlatformType() === OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA) {
                    var request = _amcProvider.createAmcSession(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY);
                    request.then(function (success) {

                        _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                        OceanaCustomerWebVoiceVideo.Base.Logger.log('AUDIO INTERACTION: amc session created');
                        OceanaCustomerWebVoiceVideo.Base.Logger.log('AUDIO INTERACTION: amc response [' + success + ']');
                        _amcSession = JSON.parse(success);
                        _amcSession.interactionType = 'WV';

                        if (interactionContext.destination) {
                            _amcSession.amcRoutepoint = interactionContext.destination;
                        }

                        // notify work service of new interaction
                        self.trigger('interaction.new', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY }]);

                        _callProvider.makeAudioCall(interactionContext.getPlatformType(), _amcSession);
                    }, function (error) {
                        _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.FAILED;
                        OceanaCustomerWebVoiceVideo.Base.Logger.error('AUDIO INTERACTION: amc session not created');
                        if (error.responseText) {
                            OceanaCustomerWebVoiceVideo.Base.Logger.error('AUDIO INTERACTION: ' + error.responseText);
                        }
                        interactionContext.onAudioInteractionFailed.fire({ reason: 'request to AMC failed' });
                    });
                } else {
                    _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                    // notify work service of new interaction
                    self.trigger('interaction.new', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY }]);
                    var eliteSession = {
                        destination: interactionContext.destination,
                        contextId: interactionContext.contextId,
                        interactionType: ''
                    };
                    _callProvider.makeAudioCall(interactionContext.getPlatformType(), eliteSession);

                }

            });
        },
        /**
         * End a Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#end
         */
        end: function () {
            _callProvider.endCall();
            // notify work service of completed interaction
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY }]);
        },
        /**
         * Get the current state of the Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getInteractionState
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.InteractionState} state - the interaction state
         */
        getInteractionState: function () {
            var newInteractionState = _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_STATE });
            if (newInteractionState) {
                _interactionState = newInteractionState;
            }
            return _interactionState;
        },
        /**
         * Get time elapsed of the current interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#getInteractionTimeElapsed
         * @returns {number} duration - the elapsed time in milliseconds
         */
        getInteractionTimeElapsed: function () {
            return _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_DURATION });
        },
        /**
         * Send the specified DTMF tone
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#sendDTMF
         * @param {OceanaCustomerWebVoiceVideo.Services.Work.DTMFTone} tone - the DTMF tone to send
         */
        sendDTMF: function (tone) {
            _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.SEND_DTMF, tone: tone });
        },
        /**
         * Returns a flag indicating whether this interaction has a valid signalling path.
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#isServiceAvailable
         * @returns {boolean} serviceAvailable - true if the call has a valid signaling path, or false otherwise.
         */
        isServiceAvailable: function () {
            return _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.Call.Operations.IS_SERVICE_AVAILABLE });
        },
        /**
         * A boolean value indicating whether audio has been explicitly muted for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#isAudioMuted
         * @returns {boolean} isAudioMuted - true if muted, false otherwise
         */
        isAudioMuted: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_AUDIO_MUTED });
        },
        /**
         * Set the mute state of the Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#mute
         * @param {boolean} muteAudio - mute the audio
         */
        muteAudio: function (mute) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.MUTE_AUDIO, muted: mute });
        },

        /**
         * Set the call in hold state of the Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#hold
         * @param {boolean} hold - hold/unhold the audio call
         */
        holdCall: function (hold) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.HOLD_CALL, held: hold });
        },

        /**
         * A boolean value indicating whether call has been explicitly held for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#isCallHeld
         * @returns {boolean} isCallHeld - true if held, false otherwise
         */
        isCallHeld: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_CALL_HELD });
        },
        /**
         * A boolean value indicating whether call has been held by the remote party for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#isCallHeldRemotely
         * @returns {boolean} isCallHeldRemotely - true if held remotely, false otherwise
         */
        isHeldRemotely: function () {
            return _callProvider.isHeldRemotely();
        },

        /**
         * Attach an event handler for onAudioInteractionInitiating<br/>
         * Called when an interaction is started
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionInitiatingCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionInitiatingCallback: function (callback) {
            this.onAudioInteractionInitiating.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionRemoteAlerting<br/>
         * Called when an interaction is alerting
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionRemoteAlertingCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionRemoteAlertingCallback: function (callback) {
            this.onAudioInteractionRemoteAlerting.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionCallQuality<br/>
        * Called to get call quality
        * @public
        * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionCallQualityCallback
        * @param {function} callback - the function to invoke
        */
        addOnAudioInteractionCallQualityCallback: function (callback) {
            this.onAudioInteractionCallQuality.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionActive<br/>
         * Called when an interaction is established
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionActiveCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionActiveCallback: function (callback) {
            this.onAudioInteractionActive.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionEnded<br/>
         * Called when an interaction is ended
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionEndedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionEndedCallback: function (callback) {
            this.onAudioInteractionEnded.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionFailed<br/>
         * Called when an interaction fails
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionFailedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionFailedCallback: function (callback) {
            this.onAudioInteractionFailed.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionAudioMuteStatusChanged<br/>
         * Called when an interaction's audio mute state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionAudioMuteStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionAudioMuteStatusChangedCallback: function (callback) {
            this.onAudioInteractionAudioMuteStatusChanged.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionHoldStatusChanged<br/>
         * Called when an interaction's Hold state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionHoldStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionHoldStatusChangedCallback: function (callback) {
            this.onAudioInteractionHoldStatusChanged.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionServiceConnected<br/>
         * Called when the signalling path for a call is available
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionServiceConnectedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionServiceConnectedCallback: function (callback) {
            this.onAudioInteractionServiceConnected.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionServiceConnecting<br/>
         * Called when the signalling path for a call has is attempting to reconnect after an outage, 
         * expect limited call capabilities and the media path to remain active
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionServiceConnectingCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionServiceConnectingCallback: function (callback) {
            this.onAudioInteractionServiceConnecting.add(callback);
        },
        /**
         * Attach an event handler for onAudioInteractionServiceDisconnected<br/>
         * Called when the signalling path for a call has failed or is unavailable
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#addOnAudioInteractionServiceDisconnectedCallback
         * @param {function} callback - the function to invoke
         */
        addOnAudioInteractionServiceDisconnectedCallback: function (callback) {
            this.onAudioInteractionServiceDisconnected.add(callback);
        },
        /**
         * Remove all callback event handlers from the Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#removeCallbacks
         */
        removeCallbacks: function () {
            this.onAudioInteractionInitiating.empty();
            this.onAudioInteractionRemoteAlerting.empty();
            this.onAudioInteractionCallQuality.empty();
            this.onAudioInteractionActive.empty();
            this.onAudioInteractionEnded.empty();
            this.onAudioInteractionFailed.empty();
            this.onAudioInteractionAudioMuteStatusChanged.empty();
            this.onAudioInteractionHoldStatusChanged.empty();
            this.onAudioInteractionServiceConnected.empty();
            this.onAudioInteractionServiceConnecting.empty();
            this.onAudioInteractionServiceDisconnected.empty();
        },
        /**
         * Reads the detailed statistics for the audio streams on the interaction, and returns it asynchronously
         * 
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#readAudioDetails
         */
        readAudioDetails: function (callback) {
            _callProvider.readAudioDetails(callback);
        }
    };

    function _startCallProvider(successCallback) {
        var context = self;
        var awaitingConnectedCallback = true;

        _callProvider.removeListeners('service');
        _callProvider.removeListeners('interaction');

        _callProvider.on('service.connected', function () {
            if (awaitingConnectedCallback === true) {
                awaitingConnectedCallback = false;
                successCallback();
            }
            context.onAudioInteractionServiceConnected.fire();
        });
        _callProvider.on('service.connecting', function () {
            context.onAudioInteractionServiceConnecting.fire();
        });
        _callProvider.on('service.disconnected', function () {
            context.onAudioInteractionServiceDisconnected.fire();
        });

        _callProvider.on('interaction.failed', function (error) {
            //Not needed in case of Elite
            if (_amcSession) {
                _amcProvider.endAmcSession(_amcSession.workRequestId);
            }
            _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.FAILED;
            context.onAudioInteractionFailed.fire(error);
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY }]);
        });
        _callProvider.on('interaction.ended', function () {
            //Not needed in case of Elite
            if (_amcSession) {
                _amcProvider.endAmcSession(_amcSession.workRequestId);
            }
            context.onAudioInteractionEnded.fire();
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY }]);
        });
        _callProvider.on('interaction.active', function () {
            context.onAudioInteractionActive.fire();
        });
        _callProvider.on('interaction.alerting', function () {
            context.onAudioInteractionRemoteAlerting.fire();
        });
        _callProvider.on('interaction.getCallQuality', function (callQuality) {
            //console.info('vi context -: Call quality!!!');
            context.onAudioInteractionCallQuality.fire(callQuality);
        });
        _callProvider.on('interaction.audiomute.statechange', function (state) {
            context.onAudioInteractionAudioMuteStatusChanged.fire(state.newState);
        });
        _callProvider.on('interaction.callhold.statechange', function (state) {
            context.onAudioInteractionHoldStatusChanged.fire(state.newState);
        });
        _callProvider.start(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY, null);

    }

    function _isInteractionActive(state) {
        return state === OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.REMOTE_ALERTING ||
            state === OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
    }




    function _doPerformOperation(operation) {
        return _callProvider.performOperation(operation);
    }

    function _doPerformMediaOperation(operation) {
        return _callProvider.performMediaOperation(operation);
    }

    _.defaults(AudioInteraction.prototype, OceanaCustomerWebVoiceVideo.Base.Observable.prototype);

    OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction = AudioInteraction;
}(OceanaCustomerWebVoiceVideo));

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    var self;
    //var _disableVideoFlag;
    //var _callQualityThreshold;
    //var _maxWaitingTimeAfterReachingThreshold;
    var _amcProvider;
    var _callProvider;

    var _amcSession;

    var _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.IDLE;

    /**
     * @class
     * @classdesc Video Interaction class encapsulates the logic of a video call
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Interactions
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction
     * @param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType. Currently supported platform types are OCEANA and ELITE
     */
    function VideoInteraction(platformType) {
        OceanaCustomerWebVoiceVideo.Base.Observable.call(this);
        self = this;

        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice}
         */
        this.device = new OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice();
        /**
         * @private
         * @type {string}
         */
        this.destination = undefined;
        /**
        * @private
        * @type {string}
        */
        this.contextId = undefined;
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Services.Work.PlatformType}
         */
        this.platformType = platformType;
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionInitiating = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionRemoteAlerting = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        //this.onVideoInteractionVideoDisablePoorQuality = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        //this.onVideoInteractionVideoCanBeEnabledGoodQuality = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionCallQuality = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
        */
        this.onVideoInteractionActive = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionEnded = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionFailed = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionAudioMuteStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionVideoMuteStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionVideoEnabledStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionHoldStatusChanged = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionServiceConnected = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionServiceConnecting = new OceanaCustomerWebVoiceVideo.Base.Callbacks();
        /**
         * @private
         * @type {OceanaCustomerWebVoiceVideo.Base.Callback}
         */
        this.onVideoInteractionServiceDisconnected = new OceanaCustomerWebVoiceVideo.Base.Callbacks();

        var providerFactory = new OceanaCustomerWebVoiceVideo.Providers.ProviderFactory();
        if (this.platformType === OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA) {
            _amcProvider = providerFactory.getAmcProvider();
        }
        _callProvider = providerFactory.getCallProvider();
    }

    VideoInteraction.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction */
    {

        /**
         * Get the authorization token, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getAuthorizationToken
         * @returns {String} authorization token
         */
        getAuthorizationToken: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken || '';
        },
        /**
         * Set the authorization token<br/>
         * In the current Oceana release, the authorization token identifies the customer within AAWG<br/>
         * This identity is used for the lifetime of the call
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#setAuthorizationToken
         * @param {object} token The authorization token to set
         */
        setAuthorizationToken: function (token) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken = token;
        },
        /**
         * Disable Video in Low Bandwidth<br/>
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#disableVideoInLowBandwidth
         * @param {boolean} disableVideoFlag - flag can be true/false, true to disable video if call quality is below threshold.
         * @param {number} callQualityThreshold - threshold to determine when to disable video on call quality param
         * @param {number} maxWaitingTimeAfterReachingThreshold - maximum waiting time after reaching threshold
         */
        /*disableVideoInLowBandwidth: function (disableVideoFlag, callQualityThreshold, maxWaitingTimeAfterReachingThreshold) {
            console.info('vi context - disableVideoInLowBandwidth params!!! '+ callQualityThreshold);
            _disableVideoFlag = disableVideoFlag;
            _callQualityThreshold = callQualityThreshold;
            _maxWaitingTimeAfterReachingThreshold = maxWaitingTimeAfterReachingThreshold;
        },*/
        /**
         * Shutdown the SDK after the interaction has ended
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#discard
         */
        discard: function () {
            _callProvider.stop();
        },
        /**
         * Get the Video Device instance that provides media control services
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getVideoDevice
         * @returns {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice}
         */
        getVideoDevice: function () {
            return this.device;
        },
        /**
         * Get the remote destination address, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getDestinationAddress
         * @returns {String} destination address
         */
        getDestinationAddress: function () {
            return this.destination;
        },
        /**
         * Set the remote destination address. For SIP this is the unescaped URI of the remote end of the interaction.
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#setDestinationAddress
         * @param {number} destination - the destination address
         */
        setDestinationAddress: function (destination) {
            var isValid = /^\+?(0|[1-9]\d*)$/.test(destination);
            if (isValid) {
                this.destination = destination;
            } else {
                this.destination = undefined;
                OceanaCustomerWebVoiceVideo.Base.Logger.error('VIDEO INTERACTION: invalid destination supplied, please provide a number');
            }
        },
        /**
         * Get the platformType, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getPlagtformType
         * @returns {Object} OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
         */
        getPlatformType: function () {
            return this.platformType || OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA;
        },
        /**
         * Set the Platform type<br/>
         * Currently supported platform types are OCEANA and ELITE
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#setPlatformType
         * @param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType
         */
        setPlatformType: function (platformType) {
            this.platformType = platformType;
        },
        /**
         * Get the ContextId, if one has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getContextId
         * @returns {String} context Id
         */
        getContextId: function () {

            return this.contextId;
        },
        /**
         * Set the ContextId <br/>
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#setContextId
         * @param {String} contextId 
         */
        setContextId: function (contextId) {
            this.contextId = contextId;
        },
        /**
         * Initiate a Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#start
         */
        start: function () {
            if (!OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().authToken) {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('VIDEO INTERACTION: Cannot start Video Interaction! Authorization Token has not been set.');
                return;
            }

            var interactionContext = this;

            _startCallProvider(function () {
                if (_validateDevice(interactionContext.device)) {
                    _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.IDLE;
                    interactionContext.onVideoInteractionInitiating.fire();
                    /*var callQualityParams = {
                        disableVideoFlag: _disableVideoFlag,
                        callQualityThreshold: _callQualityThreshold,
                        maxWaitingTimeAfterReachingThreshold: _maxWaitingTimeAfterReachingThreshold
                    };*/
                    if (interactionContext.getPlatformType() === OceanaCustomerWebVoiceVideo.Services.Work.PlatformType.OCEANA) {
                        var request = _amcProvider.createAmcSession(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO);
                        request.then(function (success) {

                            OceanaCustomerWebVoiceVideo.Base.Logger.log('VIDEO INTERACTION: amc session created');
                            OceanaCustomerWebVoiceVideo.Base.Logger.log('VIDEO INTERACTION: amc response [' + success + ']');

                            _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                            _amcSession = JSON.parse(success);
                            _amcSession.interactionType = 'VI';

                            if (interactionContext.destination) {
                                _amcSession.amcRoutepoint = interactionContext.destination;
                            }

                            // notify work service of pending interaction
                            self.trigger('interaction.new', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO }]);

                            _callProvider.makeVideoCall(interactionContext.getPlatformType(), _amcSession, interactionContext.device);
                        }, function (error) {
                            _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.FAILED;
                            OceanaCustomerWebVoiceVideo.Base.Logger.error('VIDEO INTERACTION: amc session not created');
                            if (error.responseText) {
                                OceanaCustomerWebVoiceVideo.Base.Logger.error('VIDEO INTERACTION: ' + error.responseText);
                            }
                            interactionContext.onVideoInteractionFailed.fire({ reason: 'request to AMC failed' });

                        });
                    } else {
                        _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.INITIATING;
                        // notify work service of new interaction
                        self.trigger('interaction.new', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO }]);
                        var eliteSession = {
                            destination: interactionContext.destination,
                            contextId: interactionContext.contextId,
                            interactionType: 'VI'

                        };
                        _callProvider.makeVideoCall(interactionContext.getPlatformType(), eliteSession, interactionContext.device);
                    }
                } else {
                    OceanaCustomerWebVoiceVideo.Base.Logger.error('VIDEO INTERACTION: device configuration is invalid, cannot start interaction');
                }
            });
        },
        /**
         * End a Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#end
         */
        end: function () {
            _callProvider.endCall();
            // notify work service of completed interaction
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO }]);
        },
        /**
         * Get the current interaction state of the Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getInteractionState
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.InteractionState}
         */
        getInteractionState: function () {
            var newInteractionState = _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_STATE });
            if (newInteractionState) {
                _interactionState = newInteractionState;
            }
            return _interactionState;
        },
        /**
         * Get time elapsed of the current interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#getInteractionTimeElapsed
         * @returns {number} duration - the elapsed time in milliseconds
         */
        getInteractionTimeElapsed: function () {
            return _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.GET_DURATION });
        },
        /**
         * Send the specified DTMF tone
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#sendDTMF
         * @param {OceanaCustomerWebVoiceVideo.Work.DTMFTone} tone - the DTMF tone to send
         */
        sendDTMF: function (tone) {
            _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.CallOperations.SEND_DTMF, tone: tone });
        },
        /**
         * Returns a flag indicating whether this interaction has a valid signaling path.
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#isServiceAvailable
         * @returns {boolean} serviceAvailable - true if the call has a valid signaling path, or false otherwise.
         */
        isServiceAvailable: function () {
            return _doPerformOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.Call.Operations.IS_SERVICE_AVAILABLE });
        },
        /**
         * A boolean value indicating whether audio has been explicitly muted for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#isAudioMuted
         * @returns {boolean} isAudioMuted - true if muted, false otherwise
         */
        isAudioMuted: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_AUDIO_MUTED });
        },
        /**
         * Set the audio mute state of the Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#muteAudio
         * @param {boolean} mute - mute the audio media
         */
        muteAudio: function (mute) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.MUTE_AUDIO, muted: mute });
        },

        /**
         * Set the call in hold state of the Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#hold
         * @param {boolean} hold - hold/unhold the audio call
         */
        holdCall: function (hold) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.HOLD_CALL, held: hold });
        },

        /**
         * A boolean value indicating whether call has been explicitly held for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#isCallHeld
         * @returns {boolean} isCallHeld - true if held, false otherwise
         */
        isCallHeld: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_CALL_HELD });
        },
        /**
         * A boolean value indicating whether call has been held by the remote party for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction#isCallHeldRemotely
         * @returns {boolean} isCallHeldRemotely - true if held remotely, false otherwise
         */
        isHeldRemotely: function () {
            return _callProvider.isHeldRemotely();
        },
        /**
         * A boolean value indicating whether video has been explicitly muted for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#isVideoMuted
         * @returns {boolean} isVideoMuted - true if muted, false otherwise
         */
        isVideoMuted: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_VIDEO_MUTED });
        },
        /**
         * Set the video mute state of the Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#muteVideo
         * @param {boolean} mute - mute the video media
         */
        muteVideo: function (mute) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.MUTE_VIDEO, muted: mute });
        },

        /**
         * A boolean value indicating whether video has been explicitly enabled for this interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#isVideoEnabled
         * @returns {boolean} isEnabled - true if enabled, false otherwise
         */
        isVideoEnabled: function () {
            return _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.IS_VIDEO_ENABLED });
        },
        /**
         * Enable or disable video for the interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#enableVideo
         * @param {boolean} enabled - Flag indicating whether video is enabled or disabled for the interaction.
         */
        enableVideo: function (enabled) {
            _doPerformMediaOperation({ name: OceanaCustomerWebVoiceVideo.Providers.Calls.MediaOperations.ENABLE_VIDEO, enabled: enabled });
        },
        /**
         * Attach an event handler for onVideoInteractionInitiating<br/>
         * Called when an interaction is started
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionInitiatingCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionInitiatingCallback: function (callback) {
            this.onVideoInteractionInitiating.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionRemoteAlerting<br/>
         * Called when an interaction is alerting
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionRemoteAlertingCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionRemoteAlertingCallback: function (callback) {
            this.onVideoInteractionRemoteAlerting.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionVideoDisablePoorQuality<br/>
         * Called to disable video if call quality is low
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionVideoDisablePoorQualityCallback
         */
        /*addOnVideoInteractionVideoDisablePoorQualityCallback: function () {
            this.onVideoInteractionVideoDisablePoorQuality.add();
        },*/
        /**
         * Attach an event handler for onVideoInteractionVideoCanBeEnabledGoodQuality<br/>
         * Called to enable video if call quality is good
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionVideoCanBeEnabledGoodQualityCallback
         */
        /* addOnVideoInteractionVideoCanBeEnabledGoodQualityCallback: function () {
            this.onVideoInteractionVideoCanBeEnabledGoodQuality.add();
        },*/
        /**
         * Attach an event handler for onVideoInteractionCallQuality<br/>
        * Called to get call quality
        * @public
        * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionCallQualityCallback
        * @param {function} callback - the function to invoke
        */
        addOnVideoInteractionCallQualityCallback: function (callback) {
            this.onVideoInteractionCallQuality.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionActive<br/>
         * Called when an interaction is established
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionActiveCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionActiveCallback: function (callback) {
            this.onVideoInteractionActive.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionEnded<br/>
         * Called when an interaction is ended
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionEndedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionEndedCallback: function (callback) {
            this.onVideoInteractionEnded.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionFailed<br/>
         * Called when an interaction fails
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionFailedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionFailedCallback: function (callback) {
            this.onVideoInteractionFailed.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionAudioMuteStatusChanged<br/>
         * Called when an interaction's audio mute state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionAudioMuteStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionAudioMuteStatusChangedCallback: function (callback) {
            this.onVideoInteractionAudioMuteStatusChanged.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionVideoMuteStatusChanged<br/>
         * Called when an interaction's video mute state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionVideoMuteStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionVideoMuteStatusChangedCallback: function (callback) {
            this.onVideoInteractionVideoMuteStatusChanged.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionVideoEnabledStatusChanged<br/>
         * Called when an interaction's video enabled state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionVideoEnabledStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionVideoEnabledStatusChangedCallback: function (callback) {
            this.onVideoInteractionVideoEnabledStatusChanged.add(callback);
        },

        /**
         * Attach an event handler for onVideoInteractionHoldStatusChanged<br/>
         * Called when an interaction's Hold state changes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionHoldStatusChangedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionHoldStatusChangedCallback: function (callback) {
            this.onVideoInteractionHoldStatusChanged.add(callback);
        },


        /**
         * Attach an event handler for onVideoInteractionServiceConnected<br/>
         * Called when the signalling path for a call is available
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionServiceConnectedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionServiceConnectedCallback: function (callback) {
            this.onVideoInteractionServiceConnected.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionServiceConnecting<br/>
         * Called when the signalling path for a call has is attempting to reconnect after an outage, 
         * expect limited call capabilities and the media path to remain active
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionServiceConnectingCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionServiceConnectingCallback: function (callback) {
            this.onVideoInteractionServiceConnecting.add(callback);
        },
        /**
         * Attach an event handler for onVideoInteractionServiceDisconnected<br/>
         * Called when the signalling path for a call has failed or is unavailable
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#addOnVideoInteractionServiceDisconnectedCallback
         * @param {function} callback - the function to invoke
         */
        addOnVideoInteractionServiceDisconnectedCallback: function (callback) {
            this.onVideoInteractionServiceDisconnected.add(callback);
        },
        /**
         * Remove all callback event handlers from the Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#removeCallbacks
         */
        removeCallbacks: function () {
            this.onVideoInteractionInitiating.empty();
            this.onVideoInteractionRemoteAlerting.empty();
            this.onVideoInteractionActive.empty();
            this.onVideoInteractionEnded.empty();
            this.onVideoInteractionFailed.empty();
            //this.onVideoInteractionVideoDisablePoorQuality.empty();
            //this.onVideoInteractionVideoCanBeEnabledGoodQuality.empty();
            this.onVideoInteractionCallQuality.empty();
            this.onVideoInteractionAudioMuteStatusChanged.empty();
            this.onVideoInteractionVideoMuteStatusChanged.empty();
            this.onVideoInteractionVideoEnabledStatusChanged.empty();
            this.onVideoInteractionHoldStatusChanged.empty();
            this.onVideoInteractionServiceConnected.empty();
            this.onVideoInteractionServiceConnecting.empty();
            this.onVideoInteractionServiceDisconnected.empty();
        },
        /**
         * Reads the detailed statistics for the audio streams on the interaction, and returns it asynchronously
         * 
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#readAudioDetails
         */
        readAudioDetails: function (callback) {
            _callProvider.readAudioDetails(callback);
        },
        /**
         * Reads the detailed statistics for the video streams on the interaction, and returns it asynchronously
         * 
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction#readVideoDetails
         */
        readVideoDetails: function (callback) {
            _callProvider.readVideoDetails(callback);
        }
    };

    function _startCallProvider(successCallback) {
        var context = self;
        var awaitingConnectedCallback = true;

        _callProvider.removeListeners('service');
        _callProvider.removeListeners('interaction');

        _callProvider.on('service.connected', function () {
            if (awaitingConnectedCallback === true) {
                awaitingConnectedCallback = false;
                successCallback();
            }
            context.onVideoInteractionServiceConnected.fire();
        });
        _callProvider.on('service.connecting', function () {
            context.onVideoInteractionServiceConnecting.fire();
        });
        _callProvider.on('service.disconnected', function () {
            context.onVideoInteractionServiceDisconnected.fire();
        });

        _callProvider.on('interaction.failed', function (error) {
            //Not needed in case of Elite
            if (_amcSession) {
                _amcProvider.endAmcSession(_amcSession.workRequestId);
            }
            _interactionState = OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.FAILED;
            context.onVideoInteractionFailed.fire(error);
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO }]);
        });
        _callProvider.on('interaction.ended', function () {
            //Not needed in case of Elite
            if (_amcSession) {
                _amcProvider.endAmcSession(_amcSession.workRequestId);
            }
            context.onVideoInteractionEnded.fire();
            self.trigger('interaction.ended', [{ type: OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO }]);
        });
        _callProvider.on('interaction.active', function () {
            context.onVideoInteractionActive.fire();
        });
        _callProvider.on('interaction.alerting', function () {
            context.onVideoInteractionRemoteAlerting.fire();
        });
        /*_callProvider.on('interaction.videoDisabledPoorQuality', function () {
            console.info('vi context - Call videoDisabledPoorQuality!!!');
            context.enableVideo(false);
            context.onVideoInteractionVideoDisablePoorQuality.fire();
        });
        _callProvider.on('interaction.videoCanBeEnabledGoodQuality', function () {
            console.info('vi context - Call videoCanBeEnabledGoodQuality!!!');
            //context.enableVideo(true);
            context.onVideoInteractionVideoCanBeEnabledGoodQuality.fire();
        });*/
        _callProvider.on('interaction.getCallQuality', function (callQuality) {
            //console.info('vi context -: Call quality!!!');
            context.onVideoInteractionCallQuality.fire(callQuality);
        });
        _callProvider.on('interaction.audiomute.statechange', function (state) {
            context.onVideoInteractionAudioMuteStatusChanged.fire(state.newState);
        });
        _callProvider.on('interaction.videomute.statechange', function (state) {
            context.onVideoInteractionVideoMuteStatusChanged.fire(state.newState);
        });
        _callProvider.on('interaction.videoenabled.statechange', function (state) {
            context.onVideoInteractionVideoEnabledStatusChanged.fire(state.newState);
        });
        _callProvider.on('interaction.callhold.statechange', function (state) {
            context.onVideoInteractionHoldStatusChanged.fire(state.newState);
        });


        _callProvider.start(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO, context.device);
    }


    /**
     * Function to validate a video device
     * @private
     * @param {OceanaCustomerWebVoiceVideo.Services.Devices.VideoDevice} device
     * @returns {boolean}
     */
    function _validateDevice(device) {
        var valid = false;

        console.log(device);
        if (device.cameraCaptureResolution && device.localView && device.remoteView) {
            valid = true;
        }

        return valid;
    }

    function _isInteractionActive(state) {
        return state === OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.REMOTE_ALERTING ||
            state === OceanaCustomerWebVoiceVideo.Services.Work.InteractionState.ESTABLISHED;
    }

    function _doPerformOperation(operation) {
        return _callProvider.performOperation(operation);
    }

    function _doPerformMediaOperation(operation) {
        return _callProvider.performMediaOperation(operation);
    }

    _.defaults(VideoInteraction.prototype, OceanaCustomerWebVoiceVideo.Base.Observable.prototype);

    OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction = VideoInteraction;
}(OceanaCustomerWebVoiceVideo));

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    /**
     * @class
     * @classdesc Resource class
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Schema
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource
     */
    function Resource () {
        /**
         * @private
         * @type {String}
         */
        this.NativeResourceId = undefined;
        /**
         * @private
         * @type {String}
         */
        this.SourceName = undefined;
    }

    Resource.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource */
    {
        /**
         * Get the Native Resource Id
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource#getNativeResourceId
         * @returns {String} NativeResourceId
         */
        getNativeResourceId: function () {
            return this.NativeResourceId;
        },
        /**
         * Set the Native Resource Id
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource#setNativeResourceId
         * @param {String} NativeResourceId - the Native Resource Id
         */
        setNativeResourceId: function (NativeResourceId) {
            this.NativeResourceId = NativeResourceId;
        },
        /**
         * Get the Source Name
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource#getSourceName
         * @returns {String} SourceName
         */
        getSourceName: function () {
            return this.SourceName;
        },
        /**
         * Set the Source Name
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource#setSourceName
         * @param {String} SourceName - the Source Name
         */
        setSourceName: function (SourceName) {
            this.SourceName = SourceName;
        }
    };

    OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource = Resource;

})(OceanaCustomerWebVoiceVideo);

/*
 * Copyright Avaya Inc., All Rights Reserved. THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF Avaya Inc.
 * The copyright notice above does not evidence any actual or intended publication of such source code.
 * Some third-party source code components may have been modified from their original versions by Avaya.
 * The modifications are Copyright Avaya Inc., All Rights Reserved. Avaya - Confidential & Restricted.
 * May not be distributed further without written permission of the Avaya owner.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    /**
     * @class
     * @classdesc Service class
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work.Schema
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service
     */
    function Service () {
        /**
         * @private
         * @type {Object}
         */
        this.attributes = undefined;
        /**
         * @private
         * @type {String}
         */
        this.priority = undefined;
        /**
         * @private
         * @type {String}
         */
        this.rank = undefined;
        /**
         * @private
         * @type {String}
         */
        this.resourceCount = undefined;
        /**
         * @private
         * @type {String}
         */
        this.minProficiency = undefined;
        /**
         * @private
         * @type {String}
         */
        this.maxProficiency = undefined;
    }

    Service.prototype =
        /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service */
    {
        /**
         * Get the Service attributes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getAttributes
         * @returns {Object} attributes
         */
        getAttributes: function () {
            return this.attributes;
        },
        /**
         * Set the Service attributes
         *
         * The attributes object should follows this format:
         *      {
					"Service": [
						"Sales"
					],
					"Language": [
						"English", "French"
					]
				}
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setAttributes
         * @param {Object} attributes - the services attribute
         */
        setAttributes: function (attributes) {
            this.attributes = attributes;
        },
        /**
         * Get the Service priority
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getPriority
         * @returns {String} priority
         */
        getPriority: function () {
            return this.priority;
        },
        /**
         * Set the Service priority
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setPriority
         * @param {String} priority - the priority
         */
        setPriority: function (priority) {
            this.priority = priority;
        },
        /**
         * Get the Service rank
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getRank
         * @returns {String} rank
         */
        getRank: function () {
            return this.rank;
        },
        /**
         * Set the Service rank
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setRank
         * @param {String} rank - the rank
         */
        setRank: function (rank) {
            this.rank = rank;
        },
        /**
         * Get the Service resource count
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getResourceCount
         * @returns {String} rank
         */
        getResourceCount: function () {
            return this.resourceCount;
        },
        /**
         * Set the Service resource count
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setResourceCount
         * @param {String} resourceCount - the rank
         */
        setResourceCount: function (resourceCount) {
            this.resourceCount = resourceCount;
        },
        /**
         * Get the Service min proficiency
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getMinProficiency
         * @returns {String} min proficiency
         */
        getMinProficiency: function () {
            return this.minProficiency;
        },
        /**
         * Set the Service min proficiency
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setMinProficiency
         * @param {String} minProficiency - the min proficiency
         */
        setMinProficiency: function (minProficiency) {
            this.minProficiency = minProficiency;
        },
        /**
         * Get the Service max proficiency
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#getMaxProficiency
         * @returns {String} min proficiency
         */
        getMaxProficiency: function () {
            return this.maxProficiency;
        },
        /**
         * Set the Service max proficiency
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service#setMaxProficiency
         * @param {String} maxProficiency - the max proficiency
         */
        setMaxProficiency: function (maxProficiency) {
            this.maxProficiency = maxProficiency;
        }
    };

    OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service = Service;

})(OceanaCustomerWebVoiceVideo);

/**
 * Copyright Avaya Inc.
 * All rights reserved. Usage of this source is bound to the terms described in
 * the file Avaya SDK EULA.pdf, included in this SDK.
 * Avaya – Confidential & Proprietary. Use pursuant to your signed agreement or Avaya Policy.
 */
(function (OceanaCustomerWebVoiceVideo) {
    'use strict';

    var _interactions = [];

    /**
     * @class
     * @classdesc Work class represents a work request to Oceana
     * @memberOf OceanaCustomerWebVoiceVideo.Services.Work
     * @define OceanaCustomerWebVoiceVideo.Services.Work.Work
     */
    function Work() {
        OceanaCustomerWebVoiceVideo.Base.Datastore.clear();
    }

    Work.prototype =
    /** @lends OceanaCustomerWebVoiceVideo.Services.Work.Work */
    {
        /**
         * Get the work request Id for a work request to Oceana.
         * The returned value maybe undefined if no work request Id is available.
         * If a work request Id has been provided by the equivalent setter, than the value provided will be returned
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getWorkRequestId
         * @returns {string|undefined} work request Id
         */
        getWorkRequestId: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().workRequest.id;
        },
        /**
         * Set the work request Id for a work request to Oceana.
         * The parameter provided must be a existing context Id obtained from context store, this would allow interaction context
         * and interaction schema to be associate with already existing context in context store
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setWorkRequestId
         * @param {string} workRequestId - the id to use a the work request Id
         */
        setWorkRequestId: function (workRequestId) {
            var workRequest = { provided: true, id: workRequestId };
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().workRequest = workRequest;
        },
        /**
         * Get the locale provided in the work request to Oceana.
         * If a locale has been provided by the equivalent setter, than the value provided will be returned,
         * otherwise the locale will be undefined
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getLocale
         * @returns {string|undefined} locale
         */
        getLocale: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().locale;
        },
        /**
         * Set the locale to be used in the work request to Oceana.
         * The provided locale will be available in the Oceana WebRTC Engagement Designer workflows.
         * Where one potential use is to play media announcements based on the locale. (Note for this use-case,
         * the announcements must be correctly configured on Avaya Aura Media Server)
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setLocale
         * @param {string} locale - the locale to be used in the work request
         */
        setLocale: function (locale) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().locale = locale;
        },
        /**
         * Get the routing strategy for the work request, this value may be undefined if no routing strategy is provided
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getRoutingStrategy
         * @returns {string|undefined} routingStrategy
         */
        getRoutingStrategy: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().routingStrategy;
        },
        /**
         * Set the routing strategy for the work request, this will determine the resource selection strategy for any
         * interactions created
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setRoutingStrategy
         * @param {string} routingStrategy - the routing strategy to be used in the work request
         */
        setRoutingStrategy: function (routingStrategy) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().routingStrategy = routingStrategy;
        },
        // getDataCenter: function () {
        //     return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().dataCenter;
        // },
        // setDataCenter: function (dataCenter) {
        //     OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().dataCenter = dataCenter;
        // },
        // /**
        //  * Get the data provided by the equivalent setter, this value will be undefined if no data has been provided
        //  *
        //  * @public
        //  * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getData
        //  * @returns {Object|undefined} data
        //  */
        // getData: function () {
        //     return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().contextualData;
        // },
        // /**
        //  * Set extra contextual information to be passed along with the work request.
        //  * The value provided will be inserted in Context Store and will be available to other client applications of Context Store,
        //  * via the various context store APIs.
        //  * This extra contextual will allow be available via the customer journey application
        //  *
        //  * @public
        //  * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setData
        //  * @param {Object} data - the data to pass along with the work request
        //  */
        // setData: function (data) {
        //     OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().contextualData = data;
        // },
        /**
         * Get the service list provided, this value will be undefined if no service list has been provided
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getServices
         * @returns {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service>} services
         */
        getServices: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().services;
        },
        /**
         * Set the service list to be used for resource selection as part of the work request.
         * If a service list is provided, attributes should not be provided via a AttributeList this will cause a work request to be rejected.
         * A channel attribute should be excluded from services in the list, as this will be ignored and the interaction type will determine the channel attribute
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setServices
         * @param {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Schema.Service>} services - the list of services to be used in the work request
         */
        setServices: function (services) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().services = services;
        },
        /**
         * Get the resource list provided by the equivalent setter, this value will be undefined if no resource list has been provided
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getResources
         * @returns {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource>} resources
         */
        getResources: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().resources;
        },
        /**
         * Set the resource list to be used for resource selection as part of the work request.
         * Providing a resource list, means the work request can only be handling by a resource in the list and no one else.
         * If a resource list is provided, attributes should not be provided via a AttributeList this will cause a work request to be rejected.
         * If a service list and resource list are provided together, this will be accepted. If the work request cannot be offered to the
         * specified resource, a resource will be selected based on the service list
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setResources
         * @param {Array.<OceanaCustomerWebVoiceVideo.Services.Work.Schema.Resource>} resources - the list of resources to be used in the work request
         */
        setResources: function (resources) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().resources = resources;
        },
        /**
         * Get a new collection to store Attributes
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getAttributes
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList} Attribute collection
         */
        getAttributes: function () {
            return new OceanaCustomerWebVoiceVideo.Services.Work.Attributes.AttributeList();
        },
        /**
         * Get the customer specific context, if it has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getContext
         * @returns {string} Context
         */
        getContext: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().context;
        },
        /**
         * Set the customer specific context, this value is available for screenpop's within Oceana Workspaces
         * (screenpop's must be configured in Avaya Control Manager)
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setContext
         * @param {string} context - the customer specific context that should be passed with the call
         */
        setContext: function (context) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().context = context;
        },
        /**
         * Get the customer specific topic, if it has been set
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#getTopic
         * @returns {string} Topic
         */
        getTopic: function () {
            return OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().topic;
        },
        /**
         * Set the customer specific topic, this value is passed on to the agent within Oceana Workspaces
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#setTopic
         * @param {string} topic - the customer specific topic  that should be passed with the call
         */
        setTopic: function (topic) {
            OceanaCustomerWebVoiceVideo.Base.Datastore.getInstance().topic = topic;
        },
        /**
         * Create a new Web Voice interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#createAudioInteraction
         *@param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType. Currently supported platform types are OCEANA and ELITE
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction} Audio interaction
         */
        createAudioInteraction: function (platformType) {
            if (!_isWebRtcInteractionActive()) {
                return _createInteraction('AUDIO', platformType);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('WORK: Web Voice interaction already active');
            }
        },
        /**
         * Create a new Video interaction
         *
         * @public
         * @function OceanaCustomerWebVoiceVideo.Services.Work.Work#createVideoInteraction
         * @param {object} platformType OceanaCustomerWebVoiceVideo.Services.Work.PlatformType. Currently supported platform types are OCEANA and ELITE
         * @returns {OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction} Video interaction
         */
        createVideoInteraction: function (platformType) {
            if (!_isWebRtcInteractionActive()) {
                return _createInteraction('VIDEO',platformType);
            } else {
                OceanaCustomerWebVoiceVideo.Base.Logger.warn('WORK: Video interaction already active');
            }
        }
    };

    function _createInteraction(type, platformType) {
        var interaction;

        if (type === 'VIDEO') {
            interaction = new OceanaCustomerWebVoiceVideo.Services.Work.Interactions.VideoInteraction(platformType);
        } else {
            interaction = new OceanaCustomerWebVoiceVideo.Services.Work.Interactions.AudioInteraction(platformType);
        }

        interaction.on('interaction.new', function (interaction) {
            _interactions.push(interaction.type);
        });
        interaction.on('interaction.ended', function (interaction) {
            _removeInteraction(interaction.type);
        });

        return interaction;
    }

    /**
     * check is there a active WebRTC interaction in the interaction collection.
     * @private
     * @return {boolean}
     */
    function _isWebRtcInteractionActive() {
        var webRtcInteraction = true;
        if (_interactions.indexOf(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.VIDEO) === -1 &&
            _interactions.indexOf(OceanaCustomerWebVoiceVideo.Services.Work.InteractionType.AUDIO_ONLY) === -1) {
            webRtcInteraction = false;
        }
        return webRtcInteraction;
    }

    /**
     * removes a interaction type from the interaction collection if present
     * @private
     */
    function _removeInteraction(type) {
        var index = _interactions.indexOf(type);
        if (index > -1) {
            _interactions.splice(index, 1);
        }
    }

    OceanaCustomerWebVoiceVideo.Services.Work.Work = Work;
}(OceanaCustomerWebVoiceVideo));
