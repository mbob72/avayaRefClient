!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a,b,c){var d,e,f=(c=c||la).createElement("script");if(f.text=a,b)for(d in ma)(e=b[d]||b.getAttribute&&b.getAttribute(d))&&f.setAttribute(d,e);c.head.appendChild(f).parentNode.removeChild(f)}function d(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?da[ea.call(a)]||"object":typeof a}function e(a){var b=!!a&&"length"in a&&a.length,c=d(a);return!ja(a)&&!ka(a)&&("array"===c||0===b||"number"==typeof b&&0<b&&b-1 in a)}function f(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()}function g(a,b,c){return ja(b)?oa.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?oa.grep(a,function(a){return a===b!==c}):"string"!=typeof b?oa.grep(a,function(a){return-1<ca.call(b,a)!==c}):oa.filter(b,a,c)}function h(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function i(a){return a}function j(a){throw a}function k(a,b,c,d){var e;try{a&&ja(e=a.promise)?e.call(a).done(b).fail(c):a&&ja(e=a.then)?e.call(a,b,c):b.apply(void 0,[a].slice(d))}catch(a){c.apply(void 0,[a])}}function l(){la.removeEventListener("DOMContentLoaded",l),a.removeEventListener("load",l),oa.ready()}function m(a,b){return b.toUpperCase()}function n(a){return a.replace(Ba,"ms-").replace(Ca,m)}function o(){this.expando=oa.expando+o.uid++}function p(a,b,c){var d,e;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Ha,"-$&").toLowerCase(),"string"==typeof(c=a.getAttribute(d))){try{c="true"===(e=c)||"false"!==e&&("null"===e?null:e===+e+""?+e:Ga.test(e)?JSON.parse(e):e)}catch(a){}Fa.set(a,b,c)}else c=void 0;return c}function q(a,b,c,d){var e,f,g=20,h=d?function(){return d.cur()}:function(){return oa.css(a,b,"")},i=h(),j=c&&c[3]||(oa.cssNumber[b]?"":"px"),k=a.nodeType&&(oa.cssNumber[b]||"px"!==j&&+i)&&Ja.exec(oa.css(a,b));if(k&&k[3]!==j){for(i/=2,j=j||k[3],k=+i||1;g--;)oa.style(a,b,k+j),(1-f)*(1-(f=h()/i||.5))<=0&&(g=0),k/=f;k*=2,oa.style(a,b,k+j),c=c||[]}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}function r(a,b){for(var c,d,e,f,g,h,i,j=[],k=0,l=a.length;k<l;k++)(d=a[k]).style&&(c=d.style.display,b?("none"===c&&(j[k]=Ea.get(d,"display")||null,j[k]||(d.style.display="")),""===d.style.display&&Oa(d)&&(j[k]=(i=g=f=void 0,g=(e=d).ownerDocument,h=e.nodeName,(i=Pa[h])||(f=g.body.appendChild(g.createElement(h)),i=oa.css(f,"display"),f.parentNode.removeChild(f),"none"===i&&(i="block"),Pa[h]=i)))):"none"!==c&&(j[k]="none",Ea.set(d,"display",c)));for(k=0;k<l;k++)null!=j[k]&&(a[k].style.display=j[k]);return a}function s(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&f(a,b)?oa.merge([a],c):c}function t(a,b){for(var c=0,d=a.length;c<d;c++)Ea.set(a[c],"globalEval",!b||Ea.get(b[c],"globalEval"))}function u(a,b,c,e,f){for(var g,h,i,j,k,l,m=b.createDocumentFragment(),n=[],o=0,p=a.length;o<p;o++)if((g=a[o])||0===g)if("object"===d(g))oa.merge(n,g.nodeType?[g]:g);else if(Wa.test(g)){for(h=h||m.appendChild(b.createElement("div")),i=(Ta.exec(g)||["",""])[1].toLowerCase(),j=Va[i]||Va._default,h.innerHTML=j[1]+oa.htmlPrefilter(g)+j[2],l=j[0];l--;)h=h.lastChild;oa.merge(n,h.childNodes),(h=m.firstChild).textContent=""}else n.push(b.createTextNode(g));for(m.textContent="",o=0;g=n[o++];)if(e&&-1<oa.inArray(g,e))f&&f.push(g);else if(k=Ma(g),h=s(m.appendChild(g),"script"),k&&t(h),c)for(l=0;g=h[l++];)Ua.test(g.type||"")&&c.push(g);return m}function v(){return!0}function w(){return!1}function x(a,b){return a===function(){try{return la.activeElement}catch(a){}}()==("focus"===b)}function y(a,b,c,d,e,f){var g,h;if("object"==typeof b){for(h in"string"!=typeof c&&(d=d||c,c=void 0),b)y(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=w;else if(!e)return a;return 1===f&&(g=e,(e=function(a){return oa().off(a),g.apply(this,arguments)}).guid=g.guid||(g.guid=oa.guid++)),a.each(function(){oa.event.add(this,b,e,d,c)})}function z(a,b,c){c?(Ea.set(a,b,!1),oa.event.add(a,b,{namespace:!1,handler:function(a){var d,e,f=Ea.get(this,b);if(1&a.isTrigger&&this[b]){if(f.length)(oa.event.special[b]||{}).delegateType&&a.stopPropagation();else if(f=_.call(arguments),Ea.set(this,b,f),d=c(this,b),this[b](),f!==(e=Ea.get(this,b))||d?Ea.set(this,b,!1):e={},f!==e)return a.stopImmediatePropagation(),a.preventDefault(),e.value}else f.length&&(Ea.set(this,b,{value:oa.event.trigger(oa.extend(f[0],oa.Event.prototype),f.slice(1),this)}),a.stopImmediatePropagation())}})):void 0===Ea.get(a,b)&&oa.event.add(a,b,v)}function A(a,b){return f(a,"table")&&f(11!==b.nodeType?b:b.firstChild,"tr")&&oa(a).children("tbody")[0]||a}function B(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function C(a){return"true/"===(a.type||"").slice(0,5)?a.type=a.type.slice(5):a.removeAttribute("type"),a}function D(a,b){var c,d,e,f,g,h;if(1===b.nodeType){if(Ea.hasData(a)&&(h=Ea.get(a).events))for(e in Ea.remove(b,"handle events"),h)for(c=0,d=h[e].length;c<d;c++)oa.event.add(b,e,h[e][c]);Fa.hasData(a)&&(f=Fa.access(a),g=oa.extend({},f),Fa.set(b,g))}}function E(a,b,d,e){b=aa(b);var f,g,h,i,j,k,l=0,m=a.length,n=m-1,o=b[0],p=ja(o);if(p||1<m&&"string"==typeof o&&!ia.checkClone&&_a.test(o))return a.each(function(c){var f=a.eq(c);p&&(b[0]=o.call(this,c,f.html())),E(f,b,d,e)});if(m&&(g=(f=u(b,a[0].ownerDocument,!1,a,e)).firstChild,1===f.childNodes.length&&(f=g),g||e)){for(i=(h=oa.map(s(f,"script"),B)).length;l<m;l++)j=f,l!==n&&(j=oa.clone(j,!0,!0),i&&oa.merge(h,s(j,"script"))),d.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,oa.map(h,C),l=0;l<i;l++)j=h[l],Ua.test(j.type||"")&&!Ea.access(j,"globalEval")&&oa.contains(k,j)&&(j.src&&"module"!==(j.type||"").toLowerCase()?oa._evalUrl&&!j.noModule&&oa._evalUrl(j.src,{nonce:j.nonce||j.getAttribute("nonce")},k):c(j.textContent.replace(ab,""),j,k))}return a}function F(a,b,c){for(var d,e=b?oa.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||oa.cleanData(s(d)),d.parentNode&&(c&&Ma(d)&&t(s(d,"script")),d.parentNode.removeChild(d));return a}function G(a,b,c){var d,e,f,g,h=a.style;return(c=c||cb(a))&&(""!==(g=c.getPropertyValue(b)||c[b])||Ma(a)||(g=oa.style(a,b)),!ia.pixelBoxStyles()&&bb.test(g)&&eb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function H(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function I(a){var b=oa.cssProps[a]||hb[a];return b||(a in gb?a:hb[a]=function(a){for(var b=a[0].toUpperCase()+a.slice(1),c=fb.length;c--;)if((a=fb[c]+b)in gb)return a}(a)||a)}function J(a,b,c){var d=Ja.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function K(a,b,c,d,e,f){var g="width"===b?1:0,h=0,i=0;if(c===(d?"border":"content"))return 0;for(;g<4;g+=2)"margin"===c&&(i+=oa.css(a,c+Ka[g],!0,e)),d?("content"===c&&(i-=oa.css(a,"padding"+Ka[g],!0,e)),"margin"!==c&&(i-=oa.css(a,"border"+Ka[g]+"Width",!0,e))):(i+=oa.css(a,"padding"+Ka[g],!0,e),"padding"!==c?i+=oa.css(a,"border"+Ka[g]+"Width",!0,e):h+=oa.css(a,"border"+Ka[g]+"Width",!0,e));return!d&&0<=f&&(i+=Math.max(0,Math.ceil(a["offset"+b[0].toUpperCase()+b.slice(1)]-f-i-h-.5))||0),i}function L(a,b,c){var d=cb(a),e=(!ia.boxSizingReliable()||c)&&"border-box"===oa.css(a,"boxSizing",!1,d),g=e,h=G(a,b,d),i="offset"+b[0].toUpperCase()+b.slice(1);if(bb.test(h)){if(!c)return h;h="auto"}return(!ia.boxSizingReliable()&&e||!ia.reliableTrDimensions()&&f(a,"tr")||"auto"===h||!parseFloat(h)&&"inline"===oa.css(a,"display",!1,d))&&a.getClientRects().length&&(e="border-box"===oa.css(a,"boxSizing",!1,d),(g=i in a)&&(h=a[i])),(h=parseFloat(h)||0)+K(a,b,c||(e?"border":"content"),g,d,h)+"px"}function M(a,b,c,d,e){return new M.prototype.init(a,b,c,d,e)}function N(){nb&&(!1===la.hidden&&a.requestAnimationFrame?a.requestAnimationFrame(N):a.setTimeout(N,oa.fx.interval),oa.fx.tick())}function O(){return a.setTimeout(function(){mb=void 0}),mb=Date.now()}function P(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)e["margin"+(c=Ka[d])]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Q(a,b,c){for(var d,e=(R.tweeners[b]||[]).concat(R.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function R(a,b,c){var d,e,f=0,g=R.prefilters.length,h=oa.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=mb||O(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),f=0,g=j.tweens.length;f<g;f++)j.tweens[f].run(d);return h.notifyWith(a,[j,d,c]),d<1&&g?c:(g||h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:oa.extend({},b),opts:oa.extend(!0,{specialEasing:{},easing:oa.easing._default},c),originalProperties:b,originalOptions:c,startTime:mb||O(),duration:c.duration,tweens:[],createTween:function(b,c){var d=oa.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for((!function(a,b){var c,d,e,f,g;for(c in a)if(e=b[d=n(c)],f=a[c],Array.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=oa.cssHooks[d])&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}(k,j.opts.specialEasing));f<g;f++)if(d=R.prefilters[f].call(j,a,k,j.opts))return ja(d.stop)&&(oa._queueHooks(j.elem,j.opts.queue).stop=d.stop.bind(d)),d;return oa.map(k,Q,j),ja(j.opts.start)&&j.opts.start.call(a,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),oa.fx.timer(oa.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j}function S(a){return(a.match(ya)||[]).join(" ")}function T(a){return a.getAttribute&&a.getAttribute("class")||""}function U(a){return Array.isArray(a)?a:"string"==typeof a&&a.match(ya)||[]}function V(a,b,c,e){var f;if(Array.isArray(b))oa.each(b,function(b,d){c||Cb.test(a)?e(a,d):V(a+"["+("object"==typeof d&&null!=d?b:"")+"]",d,c,e)});else if(c||"object"!==d(b))e(a,b);else for(f in b)V(a+"["+f+"]",b[f],c,e)}function W(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(ya)||[];if(ja(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function X(a,b,c,d){function e(h){var i;return f[h]=!0,oa.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===Nb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function Y(a,b){var c,d,e=oa.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&oa.extend(!0,a,d),a}var Z=[],$=Object.getPrototypeOf,_=Z.slice,aa=Z.flat?function(a){return Z.flat.call(a)}:function(a){return Z.concat.apply([],a)},ba=Z.push,ca=Z.indexOf,da={},ea=da.toString,fa=da.hasOwnProperty,ga=fa.toString,ha=ga.call(Object),ia={},ja=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType},ka=function(a){return null!=a&&a===a.window},la=a.document,ma={type:!0,src:!0,nonce:!0,noModule:!0},na="3.5.0",oa=function(a,b){return new oa.fn.init(a,b)};oa.fn=oa.prototype={jquery:na,constructor:oa,length:0,toArray:function(){return _.call(this)},get:function(a){return null==a?_.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=oa.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return oa.each(this,a)},map:function(a){return this.pushStack(oa.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(_.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(oa.grep(this,function(a,b){return(b+1)%2}))},odd:function(){return this.pushStack(oa.grep(this,function(a,b){return b%2}))},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(0<=c&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:ba,sort:Z.sort,splice:Z.splice},oa.extend=oa.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||ja(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)d=a[b],"__proto__"!==b&&g!==d&&(j&&d&&(oa.isPlainObject(d)||(e=Array.isArray(d)))?(c=g[b],f=e&&!Array.isArray(c)?[]:e||oa.isPlainObject(c)?c:{},e=!1,g[b]=oa.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},oa.extend({expando:"jQuery"+(na+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==ea.call(a)||(b=$(a))&&("function"!=typeof(c=fa.call(b,"constructor")&&b.constructor)||ga.call(c)!==ha))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},globalEval:function(a,b,d){c(a,{nonce:b&&b.nonce},d)},each:function(a,b){var c,d=0;if(e(a))for(c=a.length;d<c&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a},makeArray:function(a,b){var c=b||[];return null!=a&&(e(Object(a))?oa.merge(c,"string"==typeof a?[a]:a):ba.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:ca.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d=[],e=0,f=a.length,g=!c;e<f;e++)!b(a[e],e)!==g&&d.push(a[e]);return d},map:function(a,b,c){var d,f,g=0,h=[];if(e(a))for(d=a.length;g<d;g++)null!=(f=b(a[g],g,c))&&h.push(f);else for(g in a)null!=(f=b(a[g],g,c))&&h.push(f);return aa(h)},guid:1,support:ia}),"function"==typeof Symbol&&(oa.fn[Symbol.iterator]=Z[Symbol.iterator]),oa.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){da["[object "+b+"]"]=b.toLowerCase()});var pa=function(a){function b(a,b,c,d){var e,f,g,h,i,j,k,m=b&&b.ownerDocument,o=b?b.nodeType:9;if(c=c||[],"string"!=typeof a||!a||1!==o&&9!==o&&11!==o)return c;if(!d&&(E(b),b=b||F,H)){if(11!==o&&(i=ra.exec(a)))if(e=i[1]){if(9===o){if(!(g=b.getElementById(e)))return c;if(g.id===e)return c.push(g),c}else if(m&&(g=m.getElementById(e))&&L(b,g)&&g.id===e)return c.push(g),c}else{if(i[2])return Z.apply(c,b.getElementsByTagName(a)),c;if((e=i[3])&&u.getElementsByClassName&&b.getElementsByClassName)return Z.apply(c,b.getElementsByClassName(e)),c}if(u.qsa&&!T[a+" "]&&(!I||!I.test(a))&&(1!==o||"object"!==b.nodeName.toLowerCase())){if(k=a,m=b,1===o&&(ja.test(a)||ia.test(a))){for((m=sa.test(a)&&l(b.parentNode)||b)===b&&u.scope||((h=b.getAttribute("id"))?h=h.replace(va,wa):b.setAttribute("id",h=M)),f=(j=y(a)).length;f--;)j[f]=(h?"#"+h:":scope")+" "+n(j[f]);k=j.join(",")}try{return Z.apply(c,m.querySelectorAll(k)),c}catch(b){T(a,!0)}finally{h===M&&b.removeAttribute("id")}}}return A(a.replace(ga,"$1"),b,c,d)}function c(){var a=[];return function b(c,d){return a.push(c+" ")>v.cacheLength&&delete b[a.shift()],b[c+" "]=d}}function d(a){return a[M]=!0,a}function e(a){var b=F.createElement("fieldset");try{return!!a(b)}catch(a){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=c.length;d--;)v.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return function(b){return"form"in b?b.parentNode&&!1===b.disabled?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ya(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function k(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function l(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function m(){}function n(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function o(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=P++;return b.first?function(b,c,e){for(;b=b[d];)if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[O,h];if(i){for(;b=b[d];)if((1===b.nodeType||g)&&a(b,c,i))return!0}else for(;b=b[d];)if(1===b.nodeType||g)if(k=(l=b[M]||(b[M]={}))[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===O&&j[1]===h)return m[2]=j[2];if((k[f]=m)[2]=a(b,c,i))return!0}return!1}}function p(a){return 1<a.length?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function r(a,c,e,f,g,h){return f&&!f[M]&&(f=r(f)),g&&!g[M]&&(g=r(g,h)),d(function(d,h,i,j){var k,l,m,n=[],o=[],p=h.length,r=d||function(a,c,d){for(var e=0,f=c.length;e<f;e++)b(a,c[e],d);return d}(c||"*",i.nodeType?[i]:i,[]),s=!a||!d&&c?r:q(r,n,a,i,j),t=e?g||(d?a:p||f)?[]:h:s;if(e&&e(s,t,i,j),f)for(k=q(t,o),f(k,[],i,j),l=k.length;l--;)(m=k[l])&&(t[o[l]]=!(s[o[l]]=m));if(d){if(g||a){if(g){for(k=[],l=t.length;l--;)(m=t[l])&&k.push(s[l]=m);g(null,t=[],k,j)}for(l=t.length;l--;)(m=t[l])&&-1<(k=g?_(d,m):n[l])&&(d[k]=!(h[k]=m))}}else t=q(t===h?t.splice(p,t.length):t),g?g(null,h,t,j):Z.apply(h,t)})}function s(a){for(var b,c,d,e=a.length,f=v.relative[a[0].type],g=f||v.relative[" "],h=f?1:0,i=o(function(a){return a===b},g,!0),j=o(function(a){return-1<_(b,a)},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==B)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];h<e;h++)if(c=v.relative[a[h].type])k=[o(p(k),c)];else{if((c=v.filter[a[h].type].apply(null,a[h].matches))[M]){for(d=++h;d<e&&!v.relative[a[d].type];d++);return r(1<h&&p(k),1<h&&n(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ga,"$1"),c,h<d&&s(a.slice(h,d)),d<e&&s(a=a.slice(d)),d<e&&n(a))}k.push(c)}return p(k)}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M="sizzle"+1*new Date,N=a.document,O=0,P=0,Q=c(),R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(D=!0),0},V={}.hasOwnProperty,W=[],X=W.pop,Y=W.push,Z=W.push,$=W.slice,_=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},aa="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ba="[\\x20\\t\\r\\n\\f]",ca="(?:\\\\[\\da-fA-F]{1,6}"+ba+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",da="\\["+ba+"*("+ca+")(?:"+ba+"*([*^$|!~]?=)"+ba+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ca+"))|)"+ba+"*\\]",ea=":("+ca+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+da+")*)|.*)\\)|)",fa=new RegExp(ba+"+","g"),ga=new RegExp("^"+ba+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ba+"+$","g"),ha=new RegExp("^"+ba+"*,"+ba+"*"),ia=new RegExp("^"+ba+"*([>+~]|"+ba+")"+ba+"*"),ja=new RegExp(ba+"|>"),ka=new RegExp(ea),la=new RegExp("^"+ca+"$"),ma={ID:new RegExp("^#("+ca+")"),CLASS:new RegExp("^\\.("+ca+")"),TAG:new RegExp("^("+ca+"|[*])"),ATTR:new RegExp("^"+da),PSEUDO:new RegExp("^"+ea),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ba+"*(even|odd|(([+-]|)(\\d*)n|)"+ba+"*(?:([+-]|)"+ba+"*(\\d+)|))"+ba+"*\\)|)","i"),bool:new RegExp("^(?:"+aa+")$","i"),needsContext:new RegExp("^"+ba+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ba+"*((?:-\\d)?\\d*)"+ba+"*\\)|)(?=[^-]|$)","i")},na=/HTML$/i,oa=/^(?:input|select|textarea|button)$/i,pa=/^h\d$/i,qa=/^[^{]+\{\s*\[native \w/,ra=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,sa=/[+~]/,ta=new RegExp("\\\\[\\da-fA-F]{1,6}"+ba+"?|\\\\([^\\r\\n\\f])","g"),ua=function(a,b){var c="0x"+a.slice(1)-65536;return b||(c<0?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,1023&c|56320))},va=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,wa=function(a,b){return b?"\0"===a?"�":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},xa=function(){E()},ya=o(function(a){return!0===a.disabled&&"fieldset"===a.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{Z.apply(W=$.call(N.childNodes),N.childNodes),W[N.childNodes.length].nodeType}catch(t){Z={apply:W.length?function(a,b){Y.apply(a,$.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}for(t in u=b.support={},x=b.isXML=function(a){var b=a.namespaceURI,c=(a.ownerDocument||a).documentElement;return!na.test(b||c&&c.nodeName||"HTML")},E=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:N;return d!=F&&9===d.nodeType&&d.documentElement&&(G=(F=d).documentElement,H=!x(F),N!=F&&(c=F.defaultView)&&c.top!==c&&(c.addEventListener?c.addEventListener("unload",xa,!1):c.attachEvent&&c.attachEvent("onunload",xa)),u.scope=e(function(a){return G.appendChild(a).appendChild(F.createElement("div")),"undefined"!=typeof a.querySelectorAll&&!a.querySelectorAll(":scope fieldset div").length}),u.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),u.getElementsByTagName=e(function(a){return a.appendChild(F.createComment("")),!a.getElementsByTagName("*").length}),u.getElementsByClassName=qa.test(F.getElementsByClassName),u.getById=e(function(a){return G.appendChild(a).id=M,!F.getElementsByName||!F.getElementsByName(M).length}),u.getById?(v.filter.ID=function(a){var b=a.replace(ta,ua);return function(a){return a.getAttribute("id")===b}},v.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&H){var c=b.getElementById(a);return c?[c]:[]}}):(v.filter.ID=function(a){var b=a.replace(ta,ua);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},v.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&H){var c,d,e,f=b.getElementById(a);if(f){if((c=f.getAttributeNode("id"))&&c.value===a)return[f];for(e=b.getElementsByName(a),d=0;f=e[d++];)if((c=f.getAttributeNode("id"))&&c.value===a)return[f]}return[]}}),v.find.TAG=u.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):u.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},v.find.CLASS=u.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&H)return b.getElementsByClassName(a)},J=[],I=[],(u.qsa=qa.test(F.querySelectorAll))&&(e(function(a){var b;G.appendChild(a).innerHTML="<a id='"+M+"'></a><select id='"+M+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&I.push("[*^$]="+ba+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||I.push("\\["+ba+"*(?:value|"+aa+")"),a.querySelectorAll("[id~="+M+"-]").length||I.push("~="),(b=F.createElement("input")).setAttribute("name",""),a.appendChild(b),a.querySelectorAll("[name='']").length||I.push("\\["+ba+"*name"+ba+"*="+ba+"*(?:''|\"\")"),a.querySelectorAll(":checked").length||I.push(":checked"),a.querySelectorAll("a#"+M+"+*").length||I.push(".#.+[+~]"),a.querySelectorAll("\\\f"),I.push("[\\r\\n\\f]")}),e(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=F.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&I.push("name"+ba+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&I.push(":enabled",":disabled"),G.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&I.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),I.push(",.*:")})),(u.matchesSelector=qa.test(K=G.matches||G.webkitMatchesSelector||G.mozMatchesSelector||G.oMatchesSelector||G.msMatchesSelector))&&e(function(a){u.disconnectedMatch=K.call(a,"*"),K.call(a,"[s!='']:x"),J.push("!=",ea)}),I=I.length&&new RegExp(I.join("|")),J=J.length&&new RegExp(J.join("|")),b=qa.test(G.compareDocumentPosition),L=b||qa.test(G.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return D=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c||(1&(c=(a.ownerDocument||a)==(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!u.sortDetached&&b.compareDocumentPosition(a)===c?a==F||a.ownerDocument==N&&L(N,a)?-1:b==F||b.ownerDocument==N&&L(N,b)?1:C?_(C,a)-_(C,b):0:4&c?-1:1)}:function(a,b){if(a===b)return D=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a==F?-1:b==F?1:e?-1:f?1:C?_(C,a)-_(C,b):0;if(e===f)return g(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?g(h[d],i[d]):h[d]==N?-1:i[d]==N?1:0}),F},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if(E(a),u.matchesSelector&&H&&!T[c+" "]&&(!J||!J.test(c))&&(!I||!I.test(c)))try{var d=K.call(a,c);if(d||u.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(a){T(c,!0)}return 0<b(c,F,null,[a]).length},b.contains=function(a,b){return(a.ownerDocument||a)!=F&&E(a),L(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!=F&&E(a);var c=v.attrHandle[b.toLowerCase()],d=c&&V.call(v.attrHandle,b.toLowerCase())?c(a,b,!H):void 0;return void 0!==d?d:u.attributes||!H?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.escape=function(a){return(a+"").replace(va,wa)},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(D=!u.detectDuplicates,C=!u.sortStable&&a.slice(0),a.sort(U),D){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return C=null,a},w=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=w(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=w(b);return c},(v=b.selectors={cacheLength:50,createPseudo:d,match:ma,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ta,ua),a[3]=(a[3]||a[4]||a[5]||"").replace(ta,ua),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return ma.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ka.test(c)&&(b=y(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ta,ua).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=Q[a+" "];return b||(b=new RegExp("(^|"+ba+")"+a+"("+ba+"|$)"))&&Q(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:!c||(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&-1<f.indexOf(d):"$="===c?d&&f.slice(-d.length)===d:"~="===c?-1<(" "+f.replace(fa," ")+" ").indexOf(d):"|="===c&&(f===d||f.slice(0,d.length+1)===d+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(t=(n=(j=(k=(l=(m=q)[M]||(m[M]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===O&&j[1])&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[O,n,t];break}}else if(s&&(t=n=(j=(k=(l=(m=b)[M]||(m[M]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===O&&j[1]),!1===t)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&((k=(l=m[M]||(m[M]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]=[O,t]),m!==b)););return(t-=e)===d||t%d==0&&0<=t/d}}},PSEUDO:function(a,c){var e,f=v.pseudos[a]||v.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[M]?f(c):1<f.length?(e=[a,a,"",c],v.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)a[d=_(a,e[g])]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=z(a.replace(ga,"$1"));return e[M]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return 0<b(a,c).length}}),contains:d(function(a){return a=a.replace(ta,ua),function(b){return-1<(b.textContent||w(b)).indexOf(a)}}),lang:d(function(a){return la.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(ta,ua).toLowerCase(),function(b){var c;do if(c=H?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===G},focus:function(a){return a===F.activeElement&&(!F.hasFocus||F.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:j(!1),disabled:j(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!v.pseudos.empty(a)},header:function(a){return pa.test(a.nodeName)},input:function(a){return oa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:k(function(){return[0]}),last:k(function(a,b){return[b-1]}),eq:k(function(a,b,c){return[c<0?c+b:c]}),even:k(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:k(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:k(function(a,b,c){for(var d=c<0?c+b:b<c?b:c;0<=--d;)a.push(d);return a}),gt:k(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}}).pseudos.nth=v.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})v.pseudos[t]=h(t);for(t in{submit:!0,reset:!0})v.pseudos[t]=i(t);return m.prototype=v.filters=v.pseudos,v.setFilters=new m,y=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=R[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=v.preFilter;h;){for(g in d&&!(e=ha.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ia.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ga," ")}),h=h.slice(d.length)),v.filter)!(e=ma[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):R(a,i).slice(0)},z=b.compile=function(a,c){var e,f,g,h,i,j,k=[],l=[],m=S[a+" "];
if(!m){for(c||(c=y(a)),e=c.length;e--;)(m=s(c[e]))[M]?k.push(m):l.push(m);(m=S(a,(f=l,h=0<(g=k).length,i=0<f.length,j=function(a,c,d,e,j){var k,l,m,n=0,o="0",p=a&&[],r=[],s=B,t=a||i&&v.find.TAG("*",j),u=O+=null==s?1:Math.random()||.1,w=t.length;for(j&&(B=c==F||c||j);o!==w&&null!=(k=t[o]);o++){if(i&&k){for(l=0,c||k.ownerDocument==F||(E(k),d=!H);m=f[l++];)if(m(k,c||F,d)){e.push(k);break}j&&(O=u)}h&&((k=!m&&k)&&n--,a&&p.push(k))}if(n+=o,h&&o!==n){for(l=0;m=g[l++];)m(p,r,c,d);if(a){if(0<n)for(;o--;)p[o]||r[o]||(r[o]=X.call(e));r=q(r)}Z.apply(e,r),j&&!a&&0<r.length&&1<n+g.length&&b.uniqueSort(e)}return j&&(O=u,B=s),p},h?d(j):j))).selector=a}return m},A=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,k=!d&&y(a=j.selector||a);if(c=c||[],1===k.length){if(2<(f=k[0]=k[0].slice(0)).length&&"ID"===(g=f[0]).type&&9===b.nodeType&&H&&v.relative[f[1].type]){if(!(b=(v.find.ID(g.matches[0].replace(ta,ua),b)||[])[0]))return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=ma.needsContext.test(a)?0:f.length;e--&&(g=f[e],!v.relative[h=g.type]);)if((i=v.find[h])&&(d=i(g.matches[0].replace(ta,ua),sa.test(f[0].type)&&l(b.parentNode)||b))){if(f.splice(e,1),!(a=d.length&&n(f)))return Z.apply(c,d),c;break}}return(j||z(a,k))(d,b,!H,c,!b||sa.test(a)&&l(b.parentNode)||b),c},u.sortStable=M.split("").sort(U).join("")===M,u.detectDuplicates=!!D,E(),u.sortDetached=e(function(a){return 1&a.compareDocumentPosition(F.createElement("fieldset"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),u.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(aa,function(a,b,c){var d;if(!c)return!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);oa.find=pa,oa.expr=pa.selectors,oa.expr[":"]=oa.expr.pseudos,oa.uniqueSort=oa.unique=pa.uniqueSort,oa.text=pa.getText,oa.isXMLDoc=pa.isXML,oa.contains=pa.contains,oa.escapeSelector=pa.escape;var qa=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&oa(a).is(c))break;d.push(a)}return d},ra=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},sa=oa.expr.match.needsContext,ta=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;oa.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?oa.find.matchesSelector(d,a)?[d]:[]:oa.find.matches(a,oa.grep(b,function(a){return 1===a.nodeType}))},oa.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(oa(a).filter(function(){for(b=0;b<d;b++)if(oa.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)oa.find(a,e[b],c);return 1<d?oa.uniqueSort(c):c},filter:function(a){return this.pushStack(g(this,a||[],!1))},not:function(a){return this.pushStack(g(this,a||[],!0))},is:function(a){return!!g(this,"string"==typeof a&&sa.test(a)?oa(a):a||[],!1).length}});var ua,va=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(oa.fn.init=function(a,b,c){var d,e;if(!a)return this;if(c=c||ua,"string"==typeof a){if(!(d="<"===a[0]&&">"===a[a.length-1]&&3<=a.length?[null,a,null]:va.exec(a))||!d[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(d[1]){if(b=b instanceof oa?b[0]:b,oa.merge(this,oa.parseHTML(d[1],b&&b.nodeType?b.ownerDocument||b:la,!0)),ta.test(d[1])&&oa.isPlainObject(b))for(d in b)ja(this[d])?this[d](b[d]):this.attr(d,b[d]);return this}return(e=la.getElementById(d[2]))&&(this[0]=e,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):ja(a)?void 0!==c.ready?c.ready(a):a(oa):oa.makeArray(a,this)}).prototype=oa.fn,ua=oa(la);var wa=/^(?:parents|prev(?:Until|All))/,xa={children:!0,contents:!0,next:!0,prev:!0};oa.fn.extend({has:function(a){var b=oa(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(oa.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&oa(a);if(!sa.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?-1<g.index(c):1===c.nodeType&&oa.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(1<f.length?oa.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?ca.call(oa(a),this[0]):ca.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(oa.uniqueSort(oa.merge(this.get(),oa(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),oa.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return qa(a,"parentNode")},parentsUntil:function(a,b,c){return qa(a,"parentNode",c)},next:function(a){return h(a,"nextSibling")},prev:function(a){return h(a,"previousSibling")},nextAll:function(a){return qa(a,"nextSibling")},prevAll:function(a){return qa(a,"previousSibling")},nextUntil:function(a,b,c){return qa(a,"nextSibling",c)},prevUntil:function(a,b,c){return qa(a,"previousSibling",c)},siblings:function(a){return ra((a.parentNode||{}).firstChild,a)},children:function(a){return ra(a.firstChild)},contents:function(a){return null!=a.contentDocument&&$(a.contentDocument)?a.contentDocument:(f(a,"template")&&(a=a.content||a),oa.merge([],a.childNodes))}},function(a,b){oa.fn[a]=function(c,d){var e=oa.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=oa.filter(d,e)),1<this.length&&(xa[a]||oa.uniqueSort(e),wa.test(a)&&e.reverse()),this.pushStack(e)}});var ya=/[^\x20\t\r\n\f]+/g;oa.Callbacks=function(a){var b,c;a="string"==typeof a?(b=a,c={},oa.each(b.match(ya)||[],function(a,b){c[b]=!0}),c):oa.extend({},a);var e,f,g,h,i=[],j=[],k=-1,l=function(){for(h=h||a.once,g=e=!0;j.length;k=-1)for(f=j.shift();++k<i.length;)!1===i[k].apply(f[0],f[1])&&a.stopOnFalse&&(k=i.length,f=!1);a.memory||(f=!1),e=!1,h&&(i=f?[]:"")},m={add:function(){return i&&(f&&!e&&(k=i.length-1,j.push(f)),function b(c){oa.each(c,function(c,e){ja(e)?a.unique&&m.has(e)||i.push(e):e&&e.length&&"string"!==d(e)&&b(e)})}(arguments),f&&!e&&l()),this},remove:function(){return oa.each(arguments,function(a,b){for(var c;-1<(c=oa.inArray(b,i,c));)i.splice(c,1),c<=k&&k--}),this},has:function(a){return a?-1<oa.inArray(a,i):0<i.length},empty:function(){return i&&(i=[]),this},disable:function(){return h=j=[],i=f="",this},disabled:function(){return!i},lock:function(){return h=j=[],f||e||(i=f=""),this},locked:function(){return!!h},fireWith:function(a,b){return h||(b=[a,(b=b||[]).slice?b.slice():b],j.push(b),e||l()),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!g}};return m},oa.extend({Deferred:function(b){var c=[["notify","progress",oa.Callbacks("memory"),oa.Callbacks("memory"),2],["resolve","done",oa.Callbacks("once memory"),oa.Callbacks("once memory"),0,"resolved"],["reject","fail",oa.Callbacks("once memory"),oa.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return oa.Deferred(function(b){oa.each(c,function(c,d){var e=ja(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&ja(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){function f(b,c,d,e){return function(){var h=this,k=arguments,l=function(){var a,l;if(!(b<g)){if((a=d.apply(h,k))===c.promise())throw new TypeError("Thenable self-resolution");l=a&&("object"==typeof a||"function"==typeof a)&&a.then,ja(l)?e?l.call(a,f(g,c,i,e),f(g,c,j,e)):(g++,l.call(a,f(g,c,i,e),f(g,c,j,e),f(g,c,i,c.notifyWith))):(d!==i&&(h=void 0,k=[a]),(e||c.resolveWith)(h,k))}},m=e?l:function(){try{a()}catch(a){oa.Deferred.exceptionHook&&oa.Deferred.exceptionHook(a,m.stackTrace),g<=b+1&&(d!==j&&(h=void 0,k=[a]),c.rejectWith(h,k))}};b?m():(oa.Deferred.getStackHook&&(m.stackTrace=oa.Deferred.getStackHook()),a.setTimeout(m))}}var g=0;return oa.Deferred(function(a){c[0][3].add(f(0,a,ja(e)?e:i,a.notifyWith)),c[1][3].add(f(0,a,ja(b)?b:i)),c[2][3].add(f(0,a,ja(d)?d:j))}).promise()},promise:function(a){return null!=a?oa.extend(a,e):e}},f={};return oa.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[3-a][3].disable,c[0][2].lock,c[0][3].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=_.call(arguments),f=oa.Deferred(),g=function(a){return function(c){d[a]=this,e[a]=1<arguments.length?_.call(arguments):c,--b||f.resolveWith(d,e)}};if(b<=1&&(k(a,f.done(g(c)).resolve,f.reject,!b),"pending"===f.state()||ja(e[c]&&e[c].then)))return f.then();for(;c--;)k(e[c],g(c),f.reject);return f.promise()}});var za=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;oa.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&za.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},oa.readyException=function(b){a.setTimeout(function(){throw b})};var Aa=oa.Deferred();oa.fn.ready=function(a){return Aa.then(a)["catch"](function(a){oa.readyException(a)}),this},oa.extend({isReady:!1,readyWait:1,ready:function(a){(!0===a?--oa.readyWait:oa.isReady)||(oa.isReady=!0)!==a&&0<--oa.readyWait||Aa.resolveWith(la,[oa])}}),oa.ready.then=Aa.then,"complete"===la.readyState||"loading"!==la.readyState&&!la.documentElement.doScroll?a.setTimeout(oa.ready):(la.addEventListener("DOMContentLoaded",l),a.addEventListener("load",l));var Ba=/^-ms-/,Ca=/-([a-z])/g,Da=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};o.uid=1,o.prototype={cache:function(a){var b=a[this.expando];return b||(b=Object.create(null),Da(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[n(b)]=c;else for(d in b)e[n(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][n(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){c=(b=Array.isArray(b)?b.map(n):(b=n(b))in d?[b]:b.match(ya)||[]).length;for(;c--;)delete d[b[c]]}(void 0===b||oa.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!oa.isEmptyObject(b)}};var Ea=new o,Fa=new o,Ga=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ha=/[A-Z]/g;oa.extend({hasData:function(a){return Fa.hasData(a)||Ea.hasData(a)},data:function(a,b,c){return Fa.access(a,b,c)},removeData:function(a,b){Fa.remove(a,b)},_data:function(a,b,c){return Ea.access(a,b,c)},_removeData:function(a,b){Ea.remove(a,b)}}),oa.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=Fa.get(f),1===f.nodeType&&!Ea.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&0===(d=g[c].name).indexOf("data-")&&(d=n(d.slice(5)),p(f,d,e[d]));Ea.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){Fa.set(this,a)}):sdk_$(this,function(b){var c;return f&&void 0===b?void 0!==(c=Fa.get(f,a))?c:void 0!==(c=p(f,a))?c:void 0:void this.each(function(){Fa.set(this,a,b)})},null,b,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){Fa.remove(this,a)})}}),oa.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=Ea.get(a,b),c&&(!d||Array.isArray(c)?d=Ea.access(a,b,oa.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=oa.queue(a,b),d=c.length,e=c.shift(),f=oa._queueHooks(a,b);"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,function(){oa.dequeue(a,b)},f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return Ea.get(a,c)||Ea.access(a,c,{empty:oa.Callbacks("once memory").add(function(){Ea.remove(a,[b+"queue",c])})})}}),oa.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?oa.queue(this[0],a):void 0===b?this:this.each(function(){var c=oa.queue(this,a,b);oa._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&oa.dequeue(this,a)})},dequeue:function(a){return this.each(function(){oa.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=oa.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=Ea.get(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Ia=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ja=new RegExp("^(?:([+-])=|)("+Ia+")([a-z%]*)$","i"),Ka=["Top","Right","Bottom","Left"],La=la.documentElement,Ma=function(a){return oa.contains(a.ownerDocument,a)},Na={composed:!0};La.getRootNode&&(Ma=function(a){return oa.contains(a.ownerDocument,a)||a.getRootNode(Na)===a.ownerDocument});var Oa=function(a,b){return"none"===(a=b||a).style.display||""===a.style.display&&Ma(a)&&"none"===oa.css(a,"display")},Pa={};oa.fn.extend({show:function(){return r(this,!0)},hide:function(){return r(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Oa(this)?oa(this).show():oa(this).hide()})}});var Qa,Ra,Sa=/^(?:checkbox|radio)$/i,Ta=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ua=/^$|^module$|\/(?:java|ecma)script/i;Qa=la.createDocumentFragment().appendChild(la.createElement("div")),(Ra=la.createElement("input")).setAttribute("type","radio"),Ra.setAttribute("checked","checked"),Ra.setAttribute("name","t"),Qa.appendChild(Ra),ia.checkClone=Qa.cloneNode(!0).cloneNode(!0).lastChild.checked,Qa.innerHTML="<textarea>x</textarea>",ia.noCloneChecked=!!Qa.cloneNode(!0).lastChild.defaultValue,Qa.innerHTML="<option></option>",ia.option=!!Qa.lastChild;var Va={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Va.tbody=Va.tfoot=Va.colgroup=Va.caption=Va.thead,Va.th=Va.td,ia.option||(Va.optgroup=Va.option=[1,"<select multiple='multiple'>","</select>"]);var Wa=/<|&#?\w+;/,Xa=/^key/,Ya=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Za=/^([^.]*)(?:\.(.+)|)/;oa.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ea.get(a);if(Da(a))for(c.handler&&(c=(f=c).handler,e=f.selector),e&&oa.find.matchesSelector(La,e),c.guid||(c.guid=oa.guid++),(i=q.events)||(i=q.events=Object.create(null)),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof oa&&oa.event.triggered!==b.type?oa.event.dispatch.apply(a,arguments):void 0}),j=(b=(b||"").match(ya)||[""]).length;j--;)n=p=(h=Za.exec(b[j])||[])[1],o=(h[2]||"").split(".").sort(),n&&(l=oa.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=oa.event.special[n]||{},k=oa.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&oa.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||((m=i[n]=[]).delegateCount=0,l.setup&&!1!==l.setup.call(a,d,o,g)||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),oa.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ea.hasData(a)&&Ea.get(a);if(q&&(i=q.events)){for(j=(b=(b||"").match(ya)||[""]).length;j--;)if(n=p=(h=Za.exec(b[j])||[])[1],o=(h[2]||"").split(".").sort(),n){for(l=oa.event.special[n]||{},m=i[n=(d?l.delegateType:l.bindType)||n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,o,q.handle)||oa.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)oa.event.remove(a,n+b[j],c,d,!0);oa.isEmptyObject(i)&&Ea.remove(a,"handle events")}},dispatch:function(a){var b,c,d,e,f,g,h=new Array(arguments.length),i=oa.event.fix(a),j=(Ea.get(this,"events")||Object.create(null))[i.type]||[],k=oa.event.special[i.type]||{};for(h[0]=i,b=1;b<arguments.length;b++)h[b]=arguments[b];if(i.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,i)){for(g=oa.event.handlers.call(this,i,j),b=0;(e=g[b++])&&!i.isPropagationStopped();)for(i.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!i.isImmediatePropagationStopped();)i.rnamespace&&!1!==f.namespace&&!i.rnamespace.test(f.namespace)||(i.handleObj=f,i.data=f.data,void 0!==(d=((oa.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h))&&!1===(i.result=d)&&(i.preventDefault(),i.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,i),i.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&1<=a.button))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||!0!==j.disabled)){for(f=[],g={},c=0;c<i;c++)void 0===g[e=(d=b[c]).selector+" "]&&(g[e]=d.needsContext?-1<oa(e,this).index(j):oa.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(oa.Event.prototype,a,{enumerable:!0,configurable:!0,get:ja(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[oa.expando]?a:new oa.Event(a)},special:{load:{noBubble:!0},click:{setup:function(a){var b=this||a;return Sa.test(b.type)&&b.click&&f(b,"input")&&z(b,"click",v),!1},trigger:function(a){var b=this||a;return Sa.test(b.type)&&b.click&&f(b,"input")&&z(b,"click"),!0},_default:function(a){var b=a.target;return Sa.test(b.type)&&b.click&&f(b,"input")&&Ea.get(b,"click")||f(b,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},oa.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},oa.Event=function(a,b){return this instanceof oa.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?v:w,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&oa.extend(this,b),this.timeStamp=a&&a.timeStamp||Date.now(),this[oa.expando]=!0,void 0):new oa.Event(a,b)},oa.Event.prototype={constructor:oa.Event,isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=v,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=v,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=v,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},oa.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&Xa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&Ya.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},oa.event.addProp),oa.each({focus:"focusin",blur:"focusout"},function(a,b){oa.event.special[a]={setup:function(){return z(this,a,x),!1},trigger:function(){return z(this,a),!0},delegateType:b}}),oa.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){oa.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;return d&&(d===this||oa.contains(this,d))||(a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b),c}}}),oa.fn.extend({on:function(a,b,c,d){return y(this,a,b,c,d)},one:function(a,b,c,d){return y(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,oa(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=w),this.each(function(){oa.event.remove(this,a,c,b)})}});var $a=/<script|<style|<link/i,_a=/checked\s*(?:[^=]|=\s*.checked.)/i,ab=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;oa.extend({htmlPrefilter:function(a){return a},clone:function(a,b,c){var d,e,f,g,h,i,j,k=a.cloneNode(!0),l=Ma(a);if(!(ia.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||oa.isXMLDoc(a)))for(g=s(k),d=0,e=(f=s(a)).length;d<e;d++)h=f[d],i=g[d],"input"===(j=i.nodeName.toLowerCase())&&Sa.test(h.type)?i.checked=h.checked:"input"!==j&&"textarea"!==j||(i.defaultValue=h.defaultValue);if(b)if(c)for(f=f||s(a),g=g||s(k),d=0,e=f.length;d<e;d++)D(f[d],g[d]);else D(a,k);return 0<(g=s(k,"script")).length&&t(g,!l&&s(a,"script")),k},cleanData:function(a){for(var b,c,d,e=oa.event.special,f=0;void 0!==(c=a[f]);f++)if(Da(c)){if(b=c[Ea.expando]){if(b.events)for(d in b.events)e[d]?oa.event.remove(c,d):oa.removeEvent(c,d,b.handle);c[Ea.expando]=void 0}c[Fa.expando]&&(c[Fa.expando]=void 0)}}}),oa.fn.extend({detach:function(a){return F(this,a,!0)},remove:function(a){return F(this,a)},text:function(a){return sdk_$(this,function(a){return void 0===a?oa.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return E(this,arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||A(this,a).appendChild(a)})},prepend:function(){return E(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=A(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return E(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return E(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(oa.cleanData(s(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return oa.clone(this,a,b)})},html:function(a){return sdk_$(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!$a.test(a)&&!Va[(Ta.exec(a)||["",""])[1].toLowerCase()]){a=oa.htmlPrefilter(a);try{for(;c<d;c++)1===(b=this[c]||{}).nodeType&&(oa.cleanData(s(b,!1)),b.innerHTML=a);b=0}catch(a){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return E(this,arguments,function(b){var c=this.parentNode;oa.inArray(this,a)<0&&(oa.cleanData(s(this)),c&&c.replaceChild(b,this))},a)}}),oa.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){oa.fn[a]=function(a){for(var c,d=[],e=oa(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),oa(e[g])[b](c),ba.apply(d,c.get());return this.pushStack(d)}});var bb=new RegExp("^("+Ia+")(?!px)[a-z%]+$","i"),cb=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},db=function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];for(e in d=c.call(a),b)a.style[e]=f[e];return d},eb=new RegExp(Ka.join("|"),"i");!function(){function b(){if(k){j.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",k.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",La.appendChild(j).appendChild(k);var b=a.getComputedStyle(k);d="1%"!==b.top,i=12===c(b.marginLeft),k.style.right="60%",g=36===c(b.right),e=36===c(b.width),k.style.position="absolute",f=12===c(k.offsetWidth/3),La.removeChild(j),k=null}}function c(a){return Math.round(parseFloat(a))}var d,e,f,g,h,i,j=la.createElement("div"),k=la.createElement("div");k.style&&(k.style.backgroundClip="content-box",k.cloneNode(!0).style.backgroundClip="",ia.clearCloneStyle="content-box"===k.style.backgroundClip,oa.extend(ia,{boxSizingReliable:function(){return b(),e},pixelBoxStyles:function(){return b(),g},pixelPosition:function(){return b(),d},reliableMarginLeft:function(){return b(),i},scrollboxSize:function(){return b(),f},reliableTrDimensions:function(){var b,c,d,e;return null==h&&(b=la.createElement("table"),c=la.createElement("tr"),d=la.createElement("div"),b.style.cssText="position:absolute;left:-11111px",c.style.height="1px",d.style.height="9px",La.appendChild(b).appendChild(c).appendChild(d),e=a.getComputedStyle(c),h=3<parseInt(e.height),La.removeChild(b)),h}}))}();var fb=["Webkit","Moz","ms"],gb=la.createElement("div").style,hb={},ib=/^(none|table(?!-c[ea]).+)/,jb=/^--/,kb={position:"absolute",visibility:"hidden",display:"block"},lb={letterSpacing:"0",fontWeight:"400"};oa.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=G(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n(b),i=jb.test(b),j=a.style;if(i||(b=I(h)),g=oa.cssHooks[b]||oa.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:j[b];"string"==(f=typeof c)&&(e=Ja.exec(c))&&e[1]&&(c=q(a,b,e),f="number"),null!=c&&c==c&&("number"!==f||i||(c+=e&&e[3]||(oa.cssNumber[h]?"":"px")),ia.clearCloneStyle||""!==c||0!==b.indexOf("background")||(j[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i?j.setProperty(b,c):j[b]=c))}},css:function(a,b,c,d){var e,f,g,h=n(b);return jb.test(b)||(b=I(h)),(g=oa.cssHooks[b]||oa.cssHooks[h])&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=G(a,b,d)),"normal"===e&&b in lb&&(e=lb[b]),""===c||c?(f=parseFloat(e),!0===c||isFinite(f)?f||0:e):e}}),oa.each(["height","width"],function(a,b){oa.cssHooks[b]={get:function(a,c,d){if(c)return!ib.test(oa.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?L(a,b,d):db(a,kb,function(){return L(a,b,d)})},set:function(a,c,d){var e,f=cb(a),g=!ia.scrollboxSize()&&"absolute"===f.position,h=(g||d)&&"border-box"===oa.css(a,"boxSizing",!1,f),i=d?K(a,b,d,h,f):0;return h&&g&&(i-=Math.ceil(a["offset"+b[0].toUpperCase()+b.slice(1)]-parseFloat(f[b])-K(a,b,"border",!1,f)-.5)),i&&(e=Ja.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=oa.css(a,b)),J(0,c,i)}}}),oa.cssHooks.marginLeft=H(ia.reliableMarginLeft,function(a,b){if(b)return(parseFloat(G(a,"marginLeft"))||a.getBoundingClientRect().left-db(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),oa.each({margin:"",padding:"",border:"Width"},function(a,b){oa.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+Ka[d]+b]=f[d]||f[d-2]||f[0];return e}},"margin"!==a&&(oa.cssHooks[a+b].set=J)}),oa.fn.extend({css:function(a,b){return sdk_$(this,function(a,b,c){var d,e,f={},g=0;if(Array.isArray(b)){for(d=cb(a),e=b.length;g<e;g++)f[b[g]]=oa.css(a,b[g],!1,d);return f}return void 0!==c?oa.style(a,b,c):oa.css(a,b)},a,b,1<arguments.length)}}),((oa.Tween=M).prototype={constructor:M,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||oa.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(oa.cssNumber[c]?"":"px")},cur:function(){var a=M.propHooks[this.prop];return a&&a.get?a.get(this):M.propHooks._default.get(this)},run:function(a){var b,c=M.propHooks[this.prop];return this.options.duration?this.pos=b=oa.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):M.propHooks._default.set(this),this}}).init.prototype=M.prototype,(M.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=oa.css(a.elem,a.prop,""))&&"auto"!==b?b:0},set:function(a){oa.fx.step[a.prop]?oa.fx.step[a.prop](a):1!==a.elem.nodeType||!oa.cssHooks[a.prop]&&null==a.elem.style[I(a.prop)]?a.elem[a.prop]=a.now:oa.style(a.elem,a.prop,a.now+a.unit)}}}).scrollTop=M.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},oa.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},oa.fx=M.prototype.init,oa.fx.step={};var mb,nb,ob,pb,qb=/^(?:toggle|show|hide)$/,rb=/queueHooks$/;oa.Animation=oa.extend(R,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return q(c.elem,a,Ja.exec(b),c),c}]},tweener:function(a,b){ja(a)?(b=a,a=["*"]):a=a.match(ya);for(var c,d=0,e=a.length;d<e;d++)c=a[d],R.tweeners[c]=R.tweeners[c]||[],R.tweeners[c].unshift(b)},prefilters:[function(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&Oa(a),q=Ea.get(a,"fxshow");for(d in c.queue||(null==(g=oa._queueHooks(a,"fx")).unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,oa.queue(a,"fx").length||g.empty.fire()})})),b)if(e=b[d],qb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||oa.style(a,d)}if((i=!oa.isEmptyObject(b))||!oa.isEmptyObject(n))for(d in l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],null==(j=q&&q.display)&&(j=Ea.get(a,"display")),"none"===(k=oa.css(a,"display"))&&(j?k=j:(r([a],!0),j=a.style.display||j,k=oa.css(a,"display"),r([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===oa.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1,n)i||(q?"hidden"in q&&(p=q.hidden):q=Ea.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&r([a],!0),m.done(function(){for(d in p||r([a]),Ea.remove(a,"fxshow"),n)oa.style(a,d,n[d])})),i=Q(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}],prefilter:function(a,b){b?R.prefilters.unshift(a):R.prefilters.push(a)}}),oa.speed=function(a,b,c){var d=a&&"object"==typeof a?oa.extend({},a):{complete:c||!c&&b||ja(a)&&a,duration:a,easing:c&&b||b&&!ja(b)&&b};return oa.fx.off?d.duration=0:"number"!=typeof d.duration&&(d.duration in oa.fx.speeds?d.duration=oa.fx.speeds[d.duration]:d.duration=oa.fx.speeds._default),null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){ja(d.old)&&d.old.call(this),d.queue&&oa.dequeue(this,d.queue)},d},oa.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Oa).css("opacity",0).show().end().animate({
opacity:b},a,c,d)},animate:function(a,b,c,d){var e=oa.isEmptyObject(a),f=oa.speed(b,c,d),g=function(){var b=R(this,oa.extend({},a),f);(e||Ea.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=oa.timers,g=Ea.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&rb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||oa.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=Ea.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=oa.timers,g=d?d.length:0;for(c.finish=!0,oa.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),oa.each(["toggle","show","hide"],function(a,b){var c=oa.fn[b];oa.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(P(b,!0),a,d,e)}}),oa.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){oa.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),oa.timers=[],oa.fx.tick=function(){var a,b=0,c=oa.timers;for(mb=Date.now();b<c.length;b++)(a=c[b])()||c[b]!==a||c.splice(b--,1);c.length||oa.fx.stop(),mb=void 0},oa.fx.timer=function(a){oa.timers.push(a),oa.fx.start()},oa.fx.interval=13,oa.fx.start=function(){nb||(nb=!0,N())},oa.fx.stop=function(){nb=null},oa.fx.speeds={slow:600,fast:200,_default:400},oa.fn.delay=function(b,c){return b=oa.fx&&oa.fx.speeds[b]||b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},ob=la.createElement("input"),pb=la.createElement("select").appendChild(la.createElement("option")),ob.type="checkbox",ia.checkOn=""!==ob.value,ia.optSelected=pb.selected,(ob=la.createElement("input")).value="t",ob.type="radio",ia.radioValue="t"===ob.value;var sb,tb=oa.expr.attrHandle;oa.fn.extend({attr:function(a,b){return sdk_$(this,oa.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){oa.removeAttr(this,a)})}}),oa.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?oa.prop(a,b,c):(1===f&&oa.isXMLDoc(a)||(e=oa.attrHooks[b.toLowerCase()]||(oa.expr.match.bool.test(b)?sb:void 0)),void 0!==c?null===c?void oa.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:null==(d=oa.find.attr(a,b))?void 0:d)},attrHooks:{type:{set:function(a,b){if(!ia.radioValue&&"radio"===b&&f(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(ya);if(e&&1===a.nodeType)for(;c=e[d++];)a.removeAttribute(c)}}),sb={set:function(a,b,c){return!1===b?oa.removeAttr(a,c):a.setAttribute(c,c),c}},oa.each(oa.expr.match.bool.source.match(/\w+/g),function(a,b){var c=tb[b]||oa.find.attr;tb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=tb[g],tb[g]=e,e=null!=c(a,b,d)?g:null,tb[g]=f),e}});var ub=/^(?:input|select|textarea|button)$/i,vb=/^(?:a|area)$/i;oa.fn.extend({prop:function(a,b){return sdk_$(this,oa.prop,a,b,1<arguments.length)},removeProp:function(a){return this.each(function(){delete this[oa.propFix[a]||a]})}}),oa.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&oa.isXMLDoc(a)||(b=oa.propFix[b]||b,e=oa.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=oa.find.attr(a,"tabindex");return b?parseInt(b,10):ub.test(a.nodeName)||vb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),ia.optSelected||(oa.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),oa.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){oa.propFix[this.toLowerCase()]=this}),oa.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(ja(a))return this.each(function(b){oa(this).addClass(a.call(this,b,T(this)))});if((b=U(a)).length)for(;c=this[i++];)if(e=T(c),d=1===c.nodeType&&" "+S(e)+" "){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");e!==(h=S(d))&&c.setAttribute("class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(ja(a))return this.each(function(b){oa(this).removeClass(a.call(this,b,T(this)))});if(!arguments.length)return this.attr("class","");if((b=U(a)).length)for(;c=this[i++];)if(e=T(c),d=1===c.nodeType&&" "+S(e)+" "){for(g=0;f=b[g++];)for(;-1<d.indexOf(" "+f+" ");)d=d.replace(" "+f+" "," ");e!==(h=S(d))&&c.setAttribute("class",h)}return this},toggleClass:function(a,b){var c=typeof a,d="string"===c||Array.isArray(a);return"boolean"==typeof b&&d?b?this.addClass(a):this.removeClass(a):ja(a)?this.each(function(c){oa(this).toggleClass(a.call(this,c,T(this),b),b)}):this.each(function(){var b,e,f,g;if(d)for(e=0,f=oa(this),g=U(a);b=g[e++];)f.hasClass(b)?f.removeClass(b):f.addClass(b);else void 0!==a&&"boolean"!==c||((b=T(this))&&Ea.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":Ea.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&-1<(" "+S(T(c))+" ").indexOf(b))return!0;return!1}});var wb=/\r/g;oa.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=ja(a),this.each(function(c){var e;1===this.nodeType&&(null==(e=d?a.call(this,c,oa(this).val()):a)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=oa.map(e,function(a){return null==a?"":a+""})),(b=oa.valHooks[this.type]||oa.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=oa.valHooks[e.type]||oa.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:"string"==typeof(c=e.value)?c.replace(wb,""):null==c?"":c:void 0}}),oa.extend({valHooks:{option:{get:function(a){var b=oa.find.attr(a,"value");return null!=b?b:S(oa.text(a))}},select:{get:function(a){var b,c,d,e=a.options,g=a.selectedIndex,h="select-one"===a.type,i=h?null:[],j=h?g+1:e.length;for(d=g<0?j:h?g:0;d<j;d++)if(((c=e[d]).selected||d===g)&&!c.disabled&&(!c.parentNode.disabled||!f(c.parentNode,"optgroup"))){if(b=oa(c).val(),h)return b;i.push(b)}return i},set:function(a,b){for(var c,d,e=a.options,f=oa.makeArray(b),g=e.length;g--;)((d=e[g]).selected=-1<oa.inArray(oa.valHooks.option.get(d),f))&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),oa.each(["radio","checkbox"],function(){oa.valHooks[this]={set:function(a,b){if(Array.isArray(b))return a.checked=-1<oa.inArray(oa(a).val(),b)}},ia.checkOn||(oa.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),ia.focusin="onfocusin"in a;var xb=/^(?:focusinfocus|focusoutblur)$/,yb=function(a){a.stopPropagation()};oa.extend(oa.event,{trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m,n=[d||la],o=fa.call(b,"type")?b.type:b,p=fa.call(b,"namespace")?b.namespace.split("."):[];if(g=m=h=d=d||la,3!==d.nodeType&&8!==d.nodeType&&!xb.test(o+oa.event.triggered)&&(-1<o.indexOf(".")&&(o=(p=o.split(".")).shift(),p.sort()),j=o.indexOf(":")<0&&"on"+o,(b=b[oa.expando]?b:new oa.Event(o,"object"==typeof b&&b)).isTrigger=e?2:3,b.namespace=p.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:oa.makeArray(c,[b]),l=oa.event.special[o]||{},e||!l.trigger||!1!==l.trigger.apply(d,c))){if(!e&&!l.noBubble&&!ka(d)){for(i=l.delegateType||o,xb.test(i+o)||(g=g.parentNode);g;g=g.parentNode)n.push(g),h=g;h===(d.ownerDocument||la)&&n.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=n[f++])&&!b.isPropagationStopped();)m=g,b.type=1<f?i:l.bindType||o,(k=(Ea.get(g,"events")||Object.create(null))[b.type]&&Ea.get(g,"handle"))&&k.apply(g,c),(k=j&&g[j])&&k.apply&&Da(g)&&(b.result=k.apply(g,c),!1===b.result&&b.preventDefault());return b.type=o,e||b.isDefaultPrevented()||l._default&&!1!==l._default.apply(n.pop(),c)||!Da(d)||j&&ja(d[o])&&!ka(d)&&((h=d[j])&&(d[j]=null),oa.event.triggered=o,b.isPropagationStopped()&&m.addEventListener(o,yb),d[o](),b.isPropagationStopped()&&m.removeEventListener(o,yb),oa.event.triggered=void 0,h&&(d[j]=h)),b.result}},simulate:function(a,b,c){var d=oa.extend(new oa.Event,c,{type:a,isSimulated:!0});oa.event.trigger(d,null,b)}}),oa.fn.extend({trigger:function(a,b){return this.each(function(){oa.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return oa.event.trigger(a,b,c,!0)}}),ia.focusin||oa.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){oa.event.simulate(b,a.target,oa.event.fix(a))};oa.event.special[b]={setup:function(){var d=this.ownerDocument||this.document||this,e=Ea.access(d,b);e||d.addEventListener(a,c,!0),Ea.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this.document||this,e=Ea.access(d,b)-1;e?Ea.access(d,b,e):(d.removeEventListener(a,c,!0),Ea.remove(d,b))}}});var zb=a.location,Ab={guid:Date.now()},Bb=/\?/;oa.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(b){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||oa.error("Invalid XML: "+b),c};var Cb=/\[\]$/,Db=/\r?\n/g,Eb=/^(?:submit|button|image|reset|file)$/i,Fb=/^(?:input|select|textarea|keygen)/i;oa.param=function(a,b){var c,d=[],e=function(a,b){var c=ja(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(null==a)return"";if(Array.isArray(a)||a.jquery&&!oa.isPlainObject(a))oa.each(a,function(){e(this.name,this.value)});else for(c in a)V(c,a[c],b,e);return d.join("&")},oa.fn.extend({serialize:function(){return oa.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=oa.prop(this,"elements");return a?oa.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!oa(this).is(":disabled")&&Fb.test(this.nodeName)&&!Eb.test(a)&&(this.checked||!Sa.test(a))}).map(function(a,b){var c=oa(this).val();return null==c?null:Array.isArray(c)?oa.map(c,function(a){return{name:b.name,value:a.replace(Db,"\r\n")}}):{name:b.name,value:c.replace(Db,"\r\n")}}).get()}});var Gb=/%20/g,Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Kb=/^(?:GET|HEAD)$/,Lb=/^\/\//,Mb={},Nb={},Ob="*/".concat("*"),Pb=la.createElement("a");Pb.href=zb.href,oa.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zb.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(zb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ob,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":oa.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Y(Y(a,oa.ajaxSettings),b):Y(oa.ajaxSettings,a)},ajaxPrefilter:W(Mb),ajaxTransport:W(Nb),ajax:function(b,c){function d(b,c,d,h){var j,m,n,u,v,w=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=0<b?4:0,j=200<=b&&b<300||304===b,d&&(u=function(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}(o,x,d)),!j&&-1<oa.inArray("script",o.dataTypes)&&(o.converters["text script"]=function(){}),u=function(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if((h=e.split(" "))[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(a){return{state:"parsererror",error:g?a:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}(o,u,x,j),j?(o.ifModified&&((v=x.getResponseHeader("Last-Modified"))&&(oa.lastModified[f]=v),(v=x.getResponseHeader("etag"))&&(oa.etag[f]=v)),204===b||"HEAD"===o.type?w="nocontent":304===b?w="notmodified":(w=u.state,m=u.data,j=!(n=u.error))):(n=w,!b&&w||(w="error",b<0&&(b=0))),x.status=b,x.statusText=(c||w)+"",j?r.resolveWith(p,[m,w,x]):r.rejectWith(p,[x,w,n]),x.statusCode(t),t=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[x,o,j?m:n]),s.fireWith(p,[x,w]),l&&(q.trigger("ajaxComplete",[x,o]),--oa.active||oa.event.trigger("ajaxStop")))}"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=oa.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?oa(p):oa.event,r=oa.Deferred(),s=oa.Callbacks("once memory"),t=o.statusCode||{},u={},v={},w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h)for(h={};b=Jb.exec(g);)h[b[1].toLowerCase()+" "]=(h[b[1].toLowerCase()+" "]||[]).concat(b[2]);b=h[a.toLowerCase()+" "]}return null==b?null:b.join(", ")},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=v[a.toLowerCase()]=v[a.toLowerCase()]||a,u[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)x.always(a[x.status]);else for(b in a)t[b]=[t[b],a[b]];return this},abort:function(a){var b=a||w;return e&&e.abort(b),d(0,b),this}};if(r.promise(x),o.url=((b||o.url||zb.href)+"").replace(Lb,zb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(ya)||[""],null==o.crossDomain){j=la.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Pb.protocol+"//"+Pb.host!=j.protocol+"//"+j.host}catch(b){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=oa.param(o.data,o.traditional)),X(Mb,o,c,x),k)return x;for(m in(l=oa.event&&o.global)&&0==oa.active++&&oa.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Kb.test(o.type),f=o.url.replace(Hb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Gb,"+")):(n=o.url.slice(f.length),o.data&&(o.processData||"string"==typeof o.data)&&(f+=(Bb.test(f)?"&":"?")+o.data,delete o.data),!1===o.cache&&(f=f.replace(Ib,"$1"),n=(Bb.test(f)?"&":"?")+"_="+Ab.guid++ +n),o.url=f+n),o.ifModified&&(oa.lastModified[f]&&x.setRequestHeader("If-Modified-Since",oa.lastModified[f]),oa.etag[f]&&x.setRequestHeader("If-None-Match",oa.etag[f])),(o.data&&o.hasContent&&!1!==o.contentType||c.contentType)&&x.setRequestHeader("Content-Type",o.contentType),x.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Ob+"; q=0.01":""):o.accepts["*"]),o.headers)x.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(!1===o.beforeSend.call(p,x,o)||k))return x.abort();if(w="abort",s.add(o.complete),x.done(o.success),x.fail(o.error),e=X(Nb,o,c,x)){if(x.readyState=1,l&&q.trigger("ajaxSend",[x,o]),k)return x;o.async&&0<o.timeout&&(i=a.setTimeout(function(){x.abort("timeout")},o.timeout));try{k=!1,e.send(u,d)}catch(b){if(k)throw b;d(-1,b)}}else d(-1,"No Transport");return x},getJSON:function(a,b,c){return oa.get(a,b,c,"json")},getScript:function(a,b){return oa.get(a,void 0,b,"script")}}),oa.each(["get","post"],function(a,b){oa[b]=function(a,c,d,e){return ja(c)&&(e=e||d,d=c,c=void 0),oa.ajax(oa.extend({url:a,type:b,dataType:e,data:c,success:d},oa.isPlainObject(a)&&a))}}),oa.ajaxPrefilter(function(a){var b;for(b in a.headers)"content-type"===b.toLowerCase()&&(a.contentType=a.headers[b]||"")}),oa._evalUrl=function(a,b,c){return oa.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(a){oa.globalEval(a,b,c)}})},oa.fn.extend({wrapAll:function(a){var b;return this[0]&&(ja(a)&&(a=a.call(this[0])),b=oa(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return ja(a)?this.each(function(b){oa(this).wrapInner(a.call(this,b))}):this.each(function(){var b=oa(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=ja(a);return this.each(function(c){oa(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){oa(this).replaceWith(this.childNodes)}),this}}),oa.expr.pseudos.hidden=function(a){return!oa.expr.pseudos.visible(a)},oa.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},oa.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Qb={0:200,1223:204},Rb=oa.ajaxSettings.xhr();ia.cors=!!Rb&&"withCredentials"in Rb,ia.ajax=Rb=!!Rb,oa.ajaxTransport(function(b){var c,d;if(ia.cors||Rb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];for(g in b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.ontimeout=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Qb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=h.ontimeout=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(e){if(c)throw e}},abort:function(){c&&c()}}}),oa.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),oa.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return oa.globalEval(a),a}}}),oa.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),oa.ajaxTransport("script",function(a){var b,c;if(a.crossDomain||a.scriptAttrs)return{send:function(d,e){b=oa("<script>").attr(a.scriptAttrs||{}).prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),la.head.appendChild(b[0])},abort:function(){c&&c()}}});var Sb,Tb=[],Ub=/(=)\?(?=&|$)|\?\?/;oa.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Tb.pop()||oa.expando+"_"+Ab.guid++;return this[a]=!0,a}}),oa.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(Ub.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ub.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=ja(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Ub,"$1"+e):!1!==b.jsonp&&(b.url+=(Bb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||oa.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?oa(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Tb.push(e)),g&&ja(f)&&f(g[0]),g=f=void 0}),"script"}),ia.createHTMLDocument=((Sb=la.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Sb.childNodes.length),oa.parseHTML=function(a,b,c){return"string"!=typeof a?[]:("boolean"==typeof b&&(c=b,b=!1),b||(ia.createHTMLDocument?((d=(b=la.implementation.createHTMLDocument("")).createElement("base")).href=la.location.href,b.head.appendChild(d)):b=la),f=!c&&[],(e=ta.exec(a))?[b.createElement(e[1])]:(e=u([a],b,f),f&&f.length&&oa(f).remove(),oa.merge([],e.childNodes)));var d,e,f},oa.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return-1<h&&(d=S(a.slice(h)),a=a.slice(0,h)),ja(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),0<g.length&&oa.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?oa("<div>").append(oa.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},oa.expr.pseudos.animated=function(a){return oa.grep(oa.timers,function(b){return a===b.elem}).length},oa.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j=oa.css(a,"position"),k=oa(a),l={};"static"===j&&(a.style.position="relative"),h=k.offset(),f=oa.css(a,"top"),i=oa.css(a,"left"),("absolute"===j||"fixed"===j)&&-1<(f+i).indexOf("auto")?(g=(d=k.position()).top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),ja(b)&&(b=b.call(a,c,oa.extend({},h))),null!=b.top&&(l.top=b.top-h.top+g),null!=b.left&&(l.left=b.left-h.left+e),"using"in b?b.using.call(a,l):("number"==typeof l.top&&(l.top+="px"),"number"==typeof l.left&&(l.left+="px"),k.css(l))}},oa.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){oa.offset.setOffset(this,a,b)});var b,c,d=this[0];return d?d.getClientRects().length?(b=d.getBoundingClientRect(),c=d.ownerDocument.defaultView,{top:b.top+c.pageYOffset,left:b.left+c.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var a,b,c,d=this[0],e={top:0,left:0};if("fixed"===oa.css(d,"position"))b=d.getBoundingClientRect();else{for(b=this.offset(),c=d.ownerDocument,a=d.offsetParent||c.documentElement;a&&(a===c.body||a===c.documentElement)&&"static"===oa.css(a,"position");)a=a.parentNode;a&&a!==d&&1===a.nodeType&&((e=oa(a).offset()).top+=oa.css(a,"borderTopWidth",!0),e.left+=oa.css(a,"borderLeftWidth",!0))}return{top:b.top-e.top-oa.css(d,"marginTop",!0),left:b.left-e.left-oa.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===oa.css(a,"position");)a=a.offsetParent;return a||La})}}),oa.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;oa.fn[a]=function(d){return sdk_$(this,function(a,d,e){var f;return ka(a)?f=a:9===a.nodeType&&(f=a.defaultView),void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),oa.each(["top","left"],function(a,b){oa.cssHooks[b]=H(ia.pixelPosition,function(a,c){if(c)return c=G(a,b),bb.test(c)?oa(a).position()[b]+"px":c})}),oa.each({Height:"height",Width:"width"},function(a,b){oa.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){oa.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(!0===e||!0===f?"margin":"border");return sdk_$(this,function(b,c,e){var f;return ka(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?oa.css(b,c,h):oa.style(b,c,e,h)},b,g?e:void 0,g)}})}),oa.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){oa.fn[b]=function(a){return this.on(b,a)}}),oa.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),oa.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){oa.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}});var Vb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;oa.proxy=function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),ja(a))return d=_.call(arguments,2),(e=function(){return a.apply(b||this,d.concat(_.call(arguments)))}).guid=a.guid=a.guid||oa.guid++,e},oa.holdReady=function(a){a?oa.readyWait++:oa.ready(!0)},oa.isArray=Array.isArray,oa.parseJSON=JSON.parse,oa.nodeName=f,oa.isFunction=ja,oa.isWindow=ka,oa.camelCase=n,oa.type=d,oa.now=Date.now,oa.isNumeric=function(a){var b=oa.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},oa.trim=function(a){return null==a?"":(a+"").replace(Vb,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return oa});var Wb=a.sdk_jQuery,Xb=a.sdk_$;return oa.noConflict=function(b){return a.sdk_$===oa&&(a.sdk_$=Xb),b&&a.sdk_jQuery===oa&&(a.sdk_jQuery=Wb),oa},"undefined"==typeof b&&(a.sdk_jQuery=a.sdk_$=oa),oa});var xmlToJSON=function(){this.version="1.3.5";var a={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},b=new RegExp(/(?!xmlns)^.*:/),c=new RegExp(/^\s+|\s+$/g);return this.grokType=function(a){return/^\s*$/.test(a)?null:/^(?:true|false)$/i.test(a)?"true"===a.toLowerCase():isFinite(a)?parseFloat(a):a},this.parseString=function(a,b){return this.parseXML(this.stringToXML(a),b)},this.parseXML=function(d,e){for(var f in e)a[f]=e[f];var g={},h=0,i="";if(a.xmlns&&d.namespaceURI&&(g[a.namespaceKey]=d.namespaceURI),d.attributes&&d.attributes.length>0){var j={};for(h;h<d.attributes.length;h++){var k=d.attributes.item(h);o={};var l="";l=a.stripAttrPrefix?k.name.replace(b,""):k.name,a.grokAttr?o[a.valueKey]=this.grokType(k.value.replace(c,"")):o[a.valueKey]=k.value.replace(c,""),a.xmlns&&k.namespaceURI&&(o[a.namespaceKey]=k.namespaceURI),a.attrsAsObject?j[l]=o:g[a.attrKey+l]=o}a.attrsAsObject&&(g[a.attrKey]=j)}if(d.hasChildNodes())for(var m,n,o,p=0;p<d.childNodes.length;p++)4===(m=d.childNodes.item(p)).nodeType?a.mergeCDATA?i+=m.nodeValue:g.hasOwnProperty(a.cdataKey)?(g[a.cdataKey].constructor!==Array&&(g[a.cdataKey]=[g[a.cdataKey]]),g[a.cdataKey].push(m.nodeValue)):a.childrenAsArray?(g[a.cdataKey]=[],g[a.cdataKey].push(m.nodeValue)):g[a.cdataKey]=m.nodeValue:3===m.nodeType?i+=m.nodeValue:1===m.nodeType&&(0===h&&(g={}),n=a.stripElemPrefix?m.nodeName.replace(b,""):m.nodeName,o=xmlToJSON.parseXML(m),g.hasOwnProperty(n)?(g[n].constructor!==Array&&(g[n]=[g[n]]),g[n].push(o)):(a.childrenAsArray?(g[n]=[],g[n].push(o)):g[n]=o,h++));else i||(a.childrenAsArray?(g[a.textKey]=[],g[a.textKey].push(null)):g[a.textKey]=null);if(i)if(a.grokText){var q=this.grokType(i.replace(c,""));null!==q&&void 0!==q&&(g[a.textKey]=q)}else a.normalize?g[a.textKey]=i.replace(c,"").replace(/\s+/g," "):g[a.textKey]=i.replace(c,"");return g},this.xmlToString=function(a){try{return a.xml?a.xml:(new XMLSerializer).serializeToString(a)}catch(a){return null}},this.stringToXML=function(a){try{var b=null;return window.DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b)}catch(a){return null}},this}.call({});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=xmlToJSON:"function"==typeof define&&define.amd&&define(function(){return xmlToJSON}),!function(a){var b=jQuery;!function(b){"use strict";function c(b){this.clientConfiguration=b,this.user=a,this.mediaServicesFactory=a,this.version="4.7.0.Experemental.154",c.Base.Logger.clearLoggers()}c.prototype={createUser:function(b){return this.user||(this.mediaServicesFactory===a&&(this.mediaServicesFactory=new c.Base.MediaServicesFactory),this.user=new c.User(b,this.mediaServicesFactory,this.version)),this.user},registerLogger:function(a,b){c.Base.Logger.addLogger(a,b)},getMediaServices:function(){return this.mediaServicesFactory===a&&(this.mediaServicesFactory=new c.Base.MediaServicesFactory),this.mediaServicesFactory.getMediaServices()},getVersion:function(){return this.version}},b.AvayaClientServices=c}(window),function(a){"use strict";a.Base=a.Base||{},a.Config=a.Config||{},a.Services=a.Services||{},a.Services.Call=a.Services.Call||{},a.Services.Collaboration=a.Services.Collaboration||{},a.Services.Messaging=a.Services.Messaging||{},a.Services.Conference=a.Services.Conference||{},a.Services.Contacts=a.Services.Contacts||{},a.Services.ContentSharing=a.Services.ContentSharing||{},a.Services.Presence=a.Services.Presence||{},a.Services.VoiceMessaging=a.Services.VoiceMessaging||{}}(AvayaClientServices),function(a){"use strict";a.Base.Validators=a.Base.Validators||{},a.Providers=a.Providers||{},a.Providers.Analytics=a.Providers.Analytics||{},a.Providers.Interfaces=a.Providers.Interfaces||{},a.Providers.AMM=a.Providers.AMM||{},a.Providers.Call=a.Providers.Call||{},a.Providers.CallGateway=a.Providers.CallGateway||{},a.Providers.CallServiceGateway=a.Providers.CallServiceGateway||{},a.Providers.Scopia=a.Providers.Scopia||{},a.Providers.CM=a.Providers.CM||{},a.Providers.Focus=a.Providers.Focus||{},a.Providers.Mpaas=a.Providers.Mpaas||{},a.Providers.RemoteLogger=a.Providers.RemoteLogger||{},a.Providers.RTC=a.Providers.RTC||{},a.Providers.UCCP=a.Providers.UCCP||{},a.Providers.WCS=a.Providers.WCS||{},a.User=a.User||{},a.Services.Call=a.Services.Call||{},a.Services.Call.Capabilities=a.Services.Call.Capabilities||{},a.Services.Call.Modes=a.Services.Call.Modes||{},a.Services.SessionLogs=a.Services.SessionLogs||{},a.Services.Messaging.Common=a.Services.Messaging.Common||{},a.Providers.ACS=a.Providers.ACS||{},a.Services.SessionLogs=a.Services.SessionLogs||{},a.Providers.ContentSharing=a.Providers.ContentSharing||{},a.Services.Analytics=a.Services.Analytics||{},a.Config.Authentication=a.Config.Authentication||{}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbsoluteCategoryRating={EXCELLENT:5,GOOD:4,FAIR:3,POOR:2,BAD:1}}(),function(a){"use strict";function b(a,b){this.pointcutType=a,this.adviceFunction=b}b.prototype={},a.Base.AOPAdvice=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AOPPointcutType={BEFORE:"BEFORE",AROUND:"AROUND"}}(),function(a){"use strict";var c={_exceptionCallbacks:b.Callbacks(),addAdvices:function(a,b,d,e){for(var f=0;f<d.length;f++)c.addAdvicesToProperty(a,b,d[f],e)},addAdvicesToProperty:function(b,d,e,f){var g=c._getAdviceFunction(a.Base.AOPPointcutType.BEFORE,f),h=c._getAdviceFunction(a.Base.AOPPointcutType.AROUND,f),i=b.prototype[e];if("function"!=typeof i)throw Error("AOPTools: "+d+"."+e+" is not a function.");b.prototype[e]=function(){return g&&g(b,d,e,arguments),h?h(b,d,e,this,i,arguments):i.apply(this,arguments)}},addOnExceptionCallback:function(a){c._exceptionCallbacks.add(a)},removeOnExceptionCallback:function(a){c._exceptionCallbacks.remove(a)},triggerExceptionCallback:function(a){c._exceptionCallbacks.fire(a)},_getAdviceFunction:function(a,b){for(var c=0;c<b.length;c++)if(b[c].pointcutType===a)return b[c].adviceFunction}};a.Base.AOPTools=c}(AvayaClientServices),function(a){"use strict";function b(a,b){Error.call(this,a),this.message=a,this.name="BaseError",this._data=b}(b.prototype=Object.create(Error.prototype)).getMessage=function(){return this.message;
},b.prototype.getData=function(){return this._data},b.prototype.getName=function(){return this.name},a.Base.BaseError=b}(AvayaClientServices),function(){"use strict";b.ajaxTransport("+binary",function(a){var b;if(window.FormData&&(a.dataType&&"binary"===a.dataType||a.data&&(window.ArrayBuffer&&a.data instanceof ArrayBuffer||window.Blob&&a.data instanceof Blob)))return{send:function(c,d){b=new window.XMLHttpRequest;var e,f=a.url,g=a.type,h=a.async||!0,i=a.data||null,j=a.username||null,k=a.password||null,l=0;for(e in b.addEventListener("load",function(){var c={};c[a.dataType]=b.response,d(b.status,b.statusText,c,b.getAllResponseHeaders()),l=0}),b.addEventListener("progress",function(){this.readyState&&this.response&&("function"==typeof a.binaryProgressCallback&&a.binaryProgressCallback(AvayaClientServices.Base.Utils.stringToArrayBuffer(this.response.slice(l))),l=this.responseText.length)},!1),b.addEventListener("readystatechange",function(){this.readyState&&a.keepAliveCallback&&a.keepAliveCallback(this.readyState)}),b.open(g,f,h,j,k),b.overrideMimeType("text/xml; charset=x-user-defined"),c)c.hasOwnProperty(e)&&b.setRequestHeader(e,c[e]);b.responseType="text",b.send(i)},abort:function(){b.abort()}}})}(),function(){"use strict";AvayaClientServices.Base.BrowserSubType={CHROME_EXTENSION:"chrome_extension",FIREFOX_EXTENSION:"moz_extension",ELECTRON:"electon",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.BrowserType={CHROME:"chrome",FIREFOX:"firefox",IE:"ie",SAFARI:"safari",EDGE:"edge",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.CacheOptions=function(){this.maxElements=a,this.timeToLive=a,this.auditInterval=a}}(),function(){"use strict";AvayaClientServices.Base.ElementCacheEvents={ELEMENT_ADDED:"ELEMENT_ADDED",ELEMENT_UPDATED:"ELEMENT_UPDATED",ELEMENT_DELETED:"ELEMENT_DELETED"}}(),function(){"use strict";AvayaClientServices.Base.IMDBSearchOptions={EXACT_MATCH:"EXACT_MATCH",CONTAINS:"CONTAINS",BEGINS_WITH:"BEGINS_WITH"}}(),function(b){"use strict";function c(a,c){this._validateKeyNames(a),this._cache=new b.Base.ElementCache(c),this._cache.on(b.Base.ElementCacheEvents.ELEMENT_DELETED,function(a){this._onCacheElementsDelete(a)}.bind(this)),this._keyToCacheIds={};for(var d=0;d<a.length;d++)this._keyToCacheIds[a[d]]={};this._cacheIdLength=6,this._generateIdFailureCounter=0}c.prototype.addElement=function(a,c){var d=new Date;this._validateKeys(a);var e=this._generateCacheId(),f={keys:a,element:c,cacheId:e};if(!this._cache.addElement(e,f))throw c="SimpleIMDB: Failed to add object to underlying single-key cache. CacheId: "+e,b.Base.Logger.error(b.Base.LoggerTags.CACHE,c,f),new Error(c);this._addCacheIdWithKeys(e,a),b.Base.Logger.info(b.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added element in "+(new Date-d)+" milliseconds")},c.prototype.addElements=function(a){for(var c=new Date,d=[],e=[],f=this.getCacheMaxSize(),g=a.length,h=(d=f&&f<g?a.slice(-f):a.slice()).length,i=0;i<h;i++)try{this._validateKeys(d[i].keys);var j=this._generateCacheId();d[i].elementId=j,e.push({elementId:j,element:d[i]})}catch(a){d.splice(i,1),b.Base.Logger.error(b.Base.LoggerTags.CACHE,"Invalid keys of object",a)}var k=this._cache.addElements(e);for(i=0;i<k.length;i++)this._addCacheIdWithKeys(k[i].elementId,k[i].element.keys);b.Base.Logger.info(b.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added elements in "+(new Date-c)+" milliseconds")},c.prototype.getCacheMaxSize=function(){return this._cache.getCacheMaxSize()},c.prototype._addCacheIdWithKeys=function(b,c){for(var d in c)if(c.hasOwnProperty(d))for(var e=c[d],f=0;f<e.length;f++)this._keyToCacheIds[d][e[f]]===a&&(this._keyToCacheIds[d][e[f]]=[]),this._keyToCacheIds[d][e[f]].push(b)},c.prototype.updateElement=function(a,c,d){var e=new Date;this._validateKeys(a),this._validateKeys(c);var f,g=this.searchByKeys(a);if(1<g.length)throw f="SimpleIMDB: Update failed because multiple objects found",b.Base.Logger.error(b.Base.LoggerTags.CACHE,f),new Error(f);if(g.length<1)throw f="SimpleIMDB: Can not find object to update",b.Base.Logger.error(b.Base.LoggerTags.CACHE,f),new Error(f);this.deleteElements(a),this.addElement(c,d),b.Base.Logger.info(b.Base.LoggerTags.CACHE,"Successfully updated element in "+(new Date-e)+" milliseconds")},c.prototype.deleteElements=function(a){for(var c=new Date,d=this._resolveCacheIdsByKeys(a),e=0,f=0;f<d.length;f++){var g=this._cache.getElement(d[f]);g&&(e++,this._cache.deleteElement(d[f])||b.Base.Logger.warn(b.Base.LoggerTags.CACHE,"Failed to delete object with cacheId "+d[f]+" from underlying cache"),g.keys&&this._deleteCacheIdByKeys(d[f],g.keys))}b.Base.Logger.info(b.Base.LoggerTags.CACHE,"Deleted "+e+" element(s) successfully in "+(new Date-c)+" milliseconds")},c.prototype.searchByKeys=function(a,c){for(var d=new Date,e=[],f=this._resolveCacheIdsByKeys(a,c),g=0;g<f.length;g++){var h=this._cache.getElement(f[g]);h&&h.element&&e.push(h.element)}return e=b.Base.Utils.removeDuplicatesFromArray(e),b.Base.Logger.info(b.Base.LoggerTags.CACHE,"Found "+e.length+" results in "+(new Date-d)+" milliseconds"),e},c.prototype.searchBySingleKey=function(a,b,c){var d={};return d[a]=[b],this.searchByKeys(d,c)},c.prototype.searchByAllKeys=function(a,c){var d,e=new Date,f=[],g=[];for(d in this._keyToCacheIds)if(this._keyToCacheIds.hasOwnProperty(d)){var h=this._findMatchingValues(d,a,c);if(h)for(var i=0;i<h.length;i++)g=g.concat(this._keyToCacheIds[d][h[i]])}for(var j=0;j<g.length;j++){var k=this._cache.getElement(g[j]);k&&k.element&&f.push(k.element)}return f=b.Base.Utils.removeDuplicatesFromArray(f),b.Base.Logger.info(b.Base.LoggerTags.CACHE,"Found "+f.length+" results in "+(new Date-e)+" milliseconds"),f},c.prototype.getAllElements=function(){return this._cache.getAllElements().map(function(a){return a.element})},c.prototype._deleteCacheIdByKeys=function(a,b){for(var c in b)if(b.hasOwnProperty(c))for(var d=b[c],e=0;e<d.length;e++){var f=this._keyToCacheIds[c][d[e]],g=f.indexOf(a);0<=g&&f.splice(g,1)}},c.prototype._resolveCacheIdsByKeys=function(a,c){this._validateKeys(a);var d,e,f,g=[];for(f in a)if(a.hasOwnProperty(f)){e=a[d=f][0];break}var h=this._findMatchingValues(d,e,c),i=[];if(h){for(var j=0;j<h.length;j++)i=i.concat(this._keyToCacheIds[d][h[j]]);for(j=0;j<i.length;j++){var k=i[j],l=this._cache.getElement(k);l?this._areKeys1SubsetOfKeys2(a,l.keys,c)&&g.push(k):b.Base.Logger.warn(b.Base.LoggerTags.CACHE,"Cache object with id "+k+" is not found in underlying single-key cache")}}return g},c.prototype._findMatchingValues=function(a,c,d){return d&&d!==b.Base.IMDBSearchOptions.EXACT_MATCH?Object.keys(this._keyToCacheIds[a]).filter(function(a){return d===b.Base.IMDBSearchOptions.CONTAINS?-1<a.indexOf(c):d===b.Base.IMDBSearchOptions.BEGINS_WITH?0===a.indexOf(c):void 0}):this._keyToCacheIds[a].hasOwnProperty(c)?[c]:void 0},c.prototype._areKeys1SubsetOfKeys2=function(a,c,d){function e(a,b){for(var c,e,f=0;f<b.length;f++)if(c=a,e=b[f],d&&d!==g.EXACT_MATCH?d===g.CONTAINS?-1<e.indexOf(c):d===g.BEGINS_WITH?0===e.indexOf(c):void 0:e===c)return 1}var f,g=b.Base.IMDBSearchOptions;for(f in a)if(a.hasOwnProperty(f)){if(!c.hasOwnProperty(f))return!1;for(var h=0;h<a[f].length;h++)if(!e(a[f][h],c[f]))return!1}return!0},c.prototype._validateKeyNames=function(a){if(!a||!(a instanceof Array)||a.length<1)throw new Error('SimpleIMDB: "keyNames" argument is invalid. It should be of Array type and have at least one element. keyNames: '+JSON.stringify(a));for(var b=0;b<a.length;b++)if("string"!=typeof a[b])throw new Error("SimpleIMDB: Cache key name "+JSON.stringify(a[b])+" is not of String type. Type: "+typeof a[b])},c.prototype._validateKeys=function(c){var d,e;for(d in c)if(c.hasOwnProperty(d)){if(this._keyToCacheIds[d]===a)throw e="Key name "+d+" is not registered for this IMDB",b.Base.Logger.error(b.Base.LoggerTags.CACHE,e),new Error(e);for(var f=c[d],g=0;g<f.length;g++){var h=f[g];if("string"!=typeof h)throw e="Value "+JSON.stringify(h)+" of key "+d+" is not of string type",b.Base.Logger.error(b.Base.LoggerTags.CACHE,e),new Error(e);if(""===h)throw e="Key "+d+" has empty value",b.Base.Logger.error(b.Base.LoggerTags.CACHE,e),new Error(e)}}},c.prototype._generateCacheId=function(){for(var a,c;!a;)c=b.Base.Utils.makeId(this._cacheIdLength),this._cache.getElement(c)&&++this._generateIdFailureCounter>this._cacheIdLength&&this._cacheIdLength++,a=c;return this._generateIdFailureCounter=0,a},c.prototype._onCacheElementsDelete=function(a){for(var c=0;c<a.length;c++){var d=a[c];d.cacheId&&d.keys?this._deleteCacheIdByKeys(d.cacheId,d.keys):b.Base.Logger.error(b.Base.LoggerTags.CACHE,"Invalid cache object",d)}},b.Base.SimpleIMDB=c}(AvayaClientServices),function(a){"use strict";function c(c){this.isAllowed=c===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,this.denialReason=c,this._onChangedCallbacks=b.Callbacks()}c.prototype={addOnChangedCallback:function(b){a.Base.Utils.validate(b,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.add(b)},removeOnChangedCallback:function(b){a.Base.Utils.validate(b,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.remove(b)},_updateIfChanged:function(a,b){this.isAllowed===a&&this.denialReason===b||(this.isAllowed=a,this.denialReason=b,this._onChangedCallbacks.fire(this))}},a.Base.Capability=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CapabilityDenialReason={CAPABILITY_NOT_DENIED:"CAPABILITY_NOT_DENIED",CAPABILITY_INVALID_STATE:"CAPABILITY_INVALID_STATE",CAPABILITY_NOT_SUPPORTED:"CAPABILITY_NOT_SUPPORTED",CAPABILITY_CALL_IS_REMOTE:"CAPABILITY_CALL_IS_REMOTE",CAPABILITY_CALL_IS_NOT_REMOTE:"CAPABILITY_CALL_IS_NOT_REMOTE",CAPABILITY_CALL_HAS_NO_AUDIO:"CAPABILITY_CALL_HAS_NO_AUDIO",CAPABILITY_CALL_HAS_NO_VIDEO:"CAPABILITY_CALL_HAS_NO_VIDEO",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CAPABILITY_NEED_SIGNIN:"CAPABILITY_NEED_SIGNIN",CAPABILITY_NEED_MODERATOR:"CAPABILITY_NEED_MODERATOR",CAPABILITY_NEED_SIGNIN_OR_MODERATOR:"CAPABILITY_NEED_SIGNIN_OR_MODERATOR",CAPABILITY_NOT_INSTALLED:"CAPABILITY_NOT_INSTALLED",CAPABILITY_NOT_CONFERENCE_OWNER:"CAPABILITY_NOT_CONFERENCE_OWNER"}}(),function(c){"use strict";function d(d){this._dataSet=d||new c.Base.DataSet,this._status=c.Base.DataRetrievalStatus.IN_PROGRESS,this.isCancelled=!1,this.isCompleted=!1,this._dataRetrievalProgress=b.Callbacks(),this._dataRetrievalDone=b.Callbacks(),this._dataRetrievalFailed=b.Callbacks(),this._onCancel=a}d.prototype={cancel:function(){this._status===c.Base.DataRetrievalStatus.IN_PROGRESS&&(this._status=c.Base.DataRetrievalStatus.CANCELLED,this.isCancelled=!0,c.Base.Utils.isDefined(this._onCancel)&&this._onCancel())},getDataSet:function(){return this._dataSet},_getStatus:function(){return this._status}},c.Base.DataRetrieval=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Base.DataRetrieval.prototype,{addOnDataRetrievalProgressCallback:function(a){this._dataRetrievalProgress.add(a)},removeOnDataRetrievalProgressCallback:function(a){this._dataRetrievalProgress.remove(a)},addOnDataRetrievalDoneCallback:function(a){this._dataRetrievalDone.add(a)},removeOnDataRetrievalDoneCallback:function(a){this._dataRetrievalDone.remove(a)},addOnDataRetrievalFailedCallback:function(a){this._dataRetrievalFailed.add(a)},removeOnDataRetrievalFailedCallback:function(a){this._dataRetrievalFailed.remove(a)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataRetrievalStatus={IN_PROGRESS:"IN_PROGRESS",DONE:"DONE",CANCELLED:"CANCELLED",FAILED:"FAILED"}}(),function(a){"use strict";function c(){Array.apply(this),this.dataSetChangeCallbacks=b.Callbacks(),this.dataSetInvalidatedCallbacks=b.Callbacks()}(c.prototype=Object.create(Array.prototype)).addOnDataSetChangedCallback=function(a){this.dataSetChangeCallbacks.add(a)},c.prototype.removeOnDataSetChangedCallback=function(a){this.dataSetChangeCallbacks.remove(a)},c.prototype.onDataSetChanged=function(a,b){this.dataSetChangeCallbacks.fire(a,b)},c.prototype.addOnDataSetInvalidatedCallback=function(a){this.dataSetInvalidatedCallbacks.add(a)},c.prototype.removeOnDataSetInvalidatedCallback=function(a){this.dataSetInvalidatedCallbacks.remove(a)},c.prototype.onDataSetInvalidated=function(){this.dataSetInvalidatedCallbacks.fire(this)},a.Base.DataSet=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataSetChangeTypes={ADDED:"ADDED",REMOVED:"REMOVED",UPDATED:"UPDATED"}}(),function(){"use strict";AvayaClientServices.Base.DeferredStates={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"}}(),function(a){"use strict";var b={INDETERMINATE:"INDETERMINATE",DETERMINATE:"DETERMINATE"};a.Base.Determinateness=function(a){if(void 0!==b[a])return b[a]}}(AvayaClientServices),function(a){"use strict";function c(){}c.prototype={generateBatteryLogs:function(a){var c=b.Deferred(),d=[];return d.push("----------------------------------"),d.push("Version: "+a.applicationBuildNumber),a="Unknown",-1!==window.navigator.userAgent.indexOf("Windows NT 10")?a="Windows 10":-1!==window.navigator.userAgent.indexOf("Windows NT 6.2")?a="Windows 8":-1!==window.navigator.userAgent.indexOf("Windows NT 6.1")?a="Windows 7":-1!==window.navigator.userAgent.indexOf("Windows NT 6.0")?a="Windows Vista":-1!==window.navigator.userAgent.indexOf("Windows NT 5.1")?a="Windows XP":-1!==window.navigator.userAgent.indexOf("Windows NT 5.0")?a="Windows 2000":-1!==window.navigator.userAgent.indexOf("Mac")?a="Mac/iOS":-1!==window.navigator.userAgent.indexOf("X11")?a="UNIX":-1!==window.navigator.userAgent.indexOf("Android")?a="Android":-1!==window.navigator.userAgent.indexOf("iPad")?a="iPad":-1!==window.navigator.userAgent.indexOf("iPhone")?a="iPhone":-1!==window.navigator.userAgent.indexOf("Linux")&&(a="Linux"),d.push("Operating system: "+a),navigator.getBattery&&"function"==typeof navigator.getBattery?navigator.getBattery().then(function(a){d.push("Is Battery Charging : "+a.charging),d.push("Battery Level (%) : "+(100*a.level).toFixed(0)+"%"),d.push("----------------------------------"),c.resolve(d)},function(){d.push("Battery Level (%) : Unavailable"),d.push("----------------------------------"),c.resolve(d)}):(d.push("Battery Level (%) : Unavailable"),d.push("----------------------------------"),c.resolve(d)),c.promise()},generateMessagingLogs:function(a){var c=b.Deferred(),d=[];return a?(d.push("Number of active conversations: "+a._messagingService.conversations.length),d.push("Number of active messages: "+a._messagingService.conversations.reduce(function(a,b){return a+b.getTotalMessageCount()},0)),d.push("Number of draft conversations: "+a.getDraftConversations().length),d.push("Number of draft messages: "+a._messagingService.conversations.reduce(function(a,b){return a+b._draftMessages.length},0))):d.push("Messaging module is unavailable."),c.resolve(d),d.push("----------------------------------"),c.promise()},generateContactsLogs:function(a){var c=b.Deferred(),d=[];return a?d.push("Number of contacts in cache: "+a._contactsService._contactsDataSet.length):d.push("Contacts module is unavailable."),d.push("----------------------------------"),c.resolve(d),c.promise()},generateCallLogs:function(a){var c=b.Deferred(),d=[];return a?d.push("Number of calls: "+a.getCallCount()):d.push("Calls module is unavailable."),d.push("----------------------------------"),c.resolve(d),c.promise()},generatePerformanceLogs:function(){var a=b.Deferred(),c=[];return c.push("Request time: "+(window.performance.timing.responseEnd-window.performance.timing.requestStart)+"ms"),c.push("Load time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.requestStart)+"ms"),c.push("DOM content loaded time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.domContentLoadedEventStart)+"ms"),c.push("----------------------------------"),window.performance.memory?(c.push("JS Heap Size Limit: "+window.performance.memory.jsHeapSizeLimit),c.push("Total JS Heap Size: "+window.performance.memory.totalJSHeapSize),c.push("Used JS Heap Size: "+window.performance.memory.usedJSHeapSize)):c.push("Memory info is unavailable."),c.push("----------------------------------"),a.resolve(c),a.promise()}},a.Base.DiagnosticDataGenerator=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ErrorReasons={CAPABILITY_INVALID_STATE:"Service is in invalid state.",CAPABILITY_NOT_SUPPORTED:"Feature is not supported.",CAPABILITY_CALL_IS_REMOTE:"",CAPABILITY_CALL_IS_NOT_REMOTE:"",CAPABILITY_CALL_HAS_NO_AUDIO:"",CAPABILITY_CALL_HAS_NO_VIDEO:"",CAPABILITY_NOT_ALLOWED:"Action is not allowed.",CAPABILITY_NEED_SIGN_IN:"",CAPABILITY_NEED_MODERATOR:"",CAPABILITY_NEED_SIGN_IN_OR_MODERATOR:"",CAPABILITY_NOT_INSTALLED:"Extension is not installed.",NETWORK_ERROR:"Failed to perform operation. Network error occurred.",NETWORK_UNAUTHORIZED:"Failed to perform operation due to authorization failure.",NETWORK_AUTHORIZATION_CANCELED:"Failed to perform operation due to canceled authentication.",NETWORK_CANCELED:"Failed to perform operation. Operation was canceled.",INTERNAL_ERROR:"An internal error occurred.",TIMEOUT:"An operation has timed out",LIBRARY_NOT_SUPPORTED:"Library is not supported.",DEPRECATED:"Use of deprecated API is not recommended as if this function may be removed in the future.",BACKOFF_ALGORITHM_CANCELLED:"Backoff Algorithm canceled."}}(),function(a){"use strict";var b={jQuery:{setHandle:function(b){return a.Base.Library.Service.jQuery.setHandle(b)}}};a.Base.Library=b}(AvayaClientServices),function(c){"use strict";function d(){this._onVersionChangedCallbacks=[]}c.Base.Library.Service={SUPPORT_EXTENT_FULL:0,SUPPORT_EXTENT_COMPATIBLE:1,SUPPORT_EXTENT_NONE:2,jQuery:new d},d.prototype.setHandle=function(a){return!!this._isHandle(a)&&(this._triggerCallbacks(a),!0)},d.prototype.addOnVersionChangedCallback=function(a){a instanceof Function&&this._onVersionChangedCallbacks.push(a)},d.prototype.getSupportExtent=function(){var a=this.getSupportedVersion(),b=this.getCurrentVersion();return b===a?c.Base.Library.Service.SUPPORT_EXTENT_FULL:(a=this._parseMajorVersion(a),this._parseMajorVersion(b)===a?c.Base.Library.Service.SUPPORT_EXTENT_COMPATIBLE:c.Base.Library.Service.SUPPORT_EXTENT_NONE)},d.prototype.getSupportedVersion=function(){return"3.6.0"},d.prototype.getCurrentVersion=function(){return b.fn.jquery},d.prototype._isHandle=function(b){return b!==a&&b.fn!==a&&b.fn.jquery!==a&&b.fn.jquery!==this.getCurrentVersion()},d.prototype._triggerCallbacks=function(a){for(var b=0;b<this._onVersionChangedCallbacks.length;++b)this._onVersionChangedCallbacks[b](a)},d.prototype._parseMajorVersion=function(a){return parseInt(a.split(".").shift())}}(AvayaClientServices),function(){"use strict";function a(a,g){var h,i,j,k,l;e&&(l=g[0]+": "+g[1],(h=Array.prototype.slice.call(g,1))[0]=l),f&&(i=(k=new Date).toLocaleString("en"),(l=k.getTimezoneOffset())!==c&&(k=function(a){var b="-",c=-9<a&&a<9?"0":"";return a<0&&(b="+",a*=-1),b+c+Math.floor(a)}(l=(k=c=l)/60),l=l===parseInt(l,10)?"00":"30",b="UTC"+k+":"+l),i="["+i+", "+b+"] "+g[0]+": "+g[1],(j=Array.prototype.slice.call(g,1))[0]=i),d.forEach(function(b){var c,d,e,f=b.disableTimestamps?h:j;"function"==typeof b[a]?(c=b,d=a,e=f,AvayaClientServices.Base.Utils.isDefined(e)&&c[d].apply(c,e)):(e=b,b=a,f=f,AvayaClientServices.Base.Utils.isDefined(f)&&e.log(b,f))})}var b,c,d=[],e=!1,f=!1;AvayaClientServices.Base.Logger={info:function(b,c){a("info",arguments)},error:function(b,c){a("error",arguments)},fatal:function(b,c){a("fatal",arguments)},debug:function(b,c){a("debug",arguments)},trace:function(b,c){a("trace",arguments)},warn:function(b,c){a("warn",arguments)},addLogger:function(a,b){if(!a||void 0===a.log)throw new TypeError("Logger should implement log method.");a.disableTimestamps=b,a.disableTimestamps?e=!0:f=!0,d.push(a)},removeLogger:function(a){if(a=d.indexOf(a),-1===a)throw new Error("Specified error does not exist.");d.splice(a,1)},clearLoggers:function(){d=[]}}}(),function(){"use strict";function a(){this.disableTimestamps=!1}a.prototype={info:function(a,b){},warn:function(a,b){},error:function(a,b){},fatal:function(a,b){},debug:function(a,b){},trace:function(a,b){}},AvayaClientServices.Base.LoggerInterface=a}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.LoggerTags={CACHE:"Cache",MEDIA_ENGINE:"MediaEngine",NETWORK_PROVIDER:"NetworkProvider",REST_NETWORK_PROVIDER:"RESTNetworkProvider",WEBSOCKET_NETWORK_PROVIDER:"WebSocketNetworkProvider",RTC_CALL_CONNECTION_PROVIDER:"RTCCallConnectionProvider",BANDWIDTH_MANAGER:"BandwidthManager",FSM:"FSM",SETTINGS_FILE_PARSER:"SettingsFileParser",UTILS:"Utils",ANALYTICS_SERVICE:"AnalyticsService",CALL_SERVICE:"CallService",COLLABORATION_SERVICE:"CollaborationService",CONFERENCE_SERVICE:"ConferenceService",CONTACTS_SERVICE:"ContactsService",MESSAGING_SERVICE:"MessagingService",PRESENCE_SERVICE:"PresenceService",VOICE_MESSAGING_SERVICE:"VoiceMessagingService",USER_SERVICE:"UserService",CHAT_SERVICE:"ChatService",ACS_CONTACTS_PROVIDER:"ACSContactsProvider",AMM_MESSAGING_PROVIDER:"AMMMessagingProvider",ANALYTICS_PROVIDER:"AnalyticsProvider",CALL_PROVIDER:"CallProvider",CALL_GATEWAY_PROVIDER:"CallGatewayProvider",CSG_PRESENCE_AND_CALL_PROVIDER:"CSGPresenceAndCallProvider",CM_CONFERENCE_PROVIDER:"CMConfProvider",CONTENT_SHARING_COLLABORATION_PROVIDER:"ContentSharingCollabProvider",SCOPIA_CONFERENCE_PROVIDER:"ScopiaConfProvider",UCCP_CONFERENCE_PROVIDER:"UCCPConfProvider",WCS_COLLABORATION_PROVIDER:"WCSCollabProvider",WCS_CONTENT_SHARING_HANDLER:"WCSContentSharingHandler",CALL_STATISTICS:"CallStatistics",CALL_PERFORMANCE_MONITOR:"CallPerformanceMonitor",PARTICIPANT_SERVICE:"ParticipantService"}}(),function(a){"use strict";function b(a,b,c,d){this._kind=d,this._deviceId=a,this._groupId=b,this._label=c}b.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return("audioinput"===this._kind?"Mic":"Speaker")+" [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},a.Base.AudioDevice=b}(AvayaClientServices),function(b){"use strict";function c(){this._audioContext=a,this._volume=1,this._mediaStreamContextMap={}}function d(a,b,c){this.gainFilter=a,this.mediaStreamSource=b,this.origAudioTrack=c}c.prototype.stop=function(){this._audioContext&&(this._audioContext.close&&this._audioContext.close(),this._audioContext=a),this._mediaStreamContextMap={}},c.prototype._initAudioContext=function(){var a=window.AudioContext||window.webkitAudioContext;a?b.Base.Utils.isUndefined(this._audioContext)&&(this._audioContext=new a):b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Web Audio APIs are unavailable on this browser")},c.prototype.setVolume=function(a){if(1<a||a<0)throw new RangeError("Volume must be a double between 0 and 1");if(this._volume=a,b.Base.Utils.isDefined(this._audioContext))for(var c in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(c)&&(this._mediaStreamContextMap[c].gainFilter.gain.value=this._volume)},c.prototype.getVolume=function(){return this._volume},c.prototype.addMediaStream=function(a){var c,e,f,g;b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Adding MediaStream to AudioInputVolumeController "+a.id),this._initAudioContext(),b.Base.Utils.isDefined(this._audioContext)&&(c=this._audioContext.createGain(),(e=this._audioContext.createMediaStreamSource(a)).connect(c),f=(g=this._audioContext.createMediaStreamDestination()).stream,c.connect(g),c.gain.value=this._volume,g=a.getAudioTracks()[0],a.addTrack(f.getAudioTracks()[0]),g.stop(),a.removeTrack(g),this._mediaStreamContextMap[a.id]=new d(c,e,g))},c.prototype.removeMediaStream=function(a){var c;b.Base.Utils.isDefined(this._audioContext)&&a&&(b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Removing MediaStream from AudioInputVolumeController "+a.id),c=this._mediaStreamContextMap[a.id],b.Base.Utils.isDefined(c)&&b.Base.Utils.isDefined(c.mediaStreamSource)&&(c.mediaStreamSource.disconnect(),c.gainFilter.disconnect(),b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Stopping audio track "+c.origAudioTrack.id),c.origAudioTrack.stop(),delete this._mediaStreamContextMap[a.id]))},b.Base.AudioInputVolumeController=c}(AvayaClientServices),function(c){"use strict";function d(){this._muted=!1,this._volume=1,this._mediaStreamContextMap={},this._selectedDevice=a,this._gestureRequiredCallbacks=b.Callbacks()}d.prototype.stop=function(){this._mediaStreamContextMap={}},d.prototype.addOnGestureRequiredCallback=function(a){this._gestureRequiredCallbacks.add(a)},d.prototype.removeOnGestureRequiredCallback=function(a){this._gestureRequiredCallbacks.remove(a)},d.prototype.playAudioStream=function(a,b){var d,e;return!!(a&&0<a.getAudioTracks().length)&&(this.isPlaying(a)?c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+a.getAudioTracks()[0].id):(c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+a.id+"  active: "+a.active),a.getAudioTracks().forEach(function(a){c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+a.id+" enabled: "+a.enabled+" kind: "+a.kind+" label: "+a.label+" muted: "+a.muted+" readyState: "+a.readyState)}),(d=document.createElement("audio")).defaultMuted=!0,d.muted=this._muted||b,d.volume=this._volume,d.autoplay=!0,d.srcObject=a,e=function(a){d.play().then(function(){c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Auto playing remote audio stream..."),d.removeEventListener("canplay",e)}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to auto play remote audio stream",a),this._gestureRequiredCallbacks.fire(e),d.removeEventListener("canplay",e)}.bind(this))}.bind(this),d.addEventListener("canplay",e),this._mediaStreamContextMap[a.id]=new c.Base.MediaStreamContext(d),this._selectedDevice&&(!0===c.Base.Utils.hasProperty(d,"setSinkId")?this._mediaStreamContextMap[a.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},d.prototype.stopPlayingAudioStream=function(a,b){var d,e;a&&(d=this._mediaStreamContextMap[a.id],c.Base.Utils.isDefined(d)&&(c.Base.Utils.isDefined(b)&&!b||this.logStreamChanges(a.getAudioTracks(),"Stopping playing audio for track "),b=function(){e.pause(),e.srcObject=null},0===(e=d.getMediaElement()).readyState?e.ondurationchange=b:b(),delete this._mediaStreamContextMap[a.id]))},d.prototype.isPlaying=function(a){return c.Base.Utils.isDefined(this._mediaStreamContextMap[a.id])},d.prototype.muteStream=function(a){var b;a&&(b=this._mediaStreamContextMap[a.id],c.Base.Utils.isDefined(b)&&(b.setMediaMuted(!0),b.getMediaElement().muted=!0,this.logStreamChanges(a.getAudioTracks(),"Muted audio output for track ")))},d.prototype.unmuteStream=function(a){var b;a&&(b=this._mediaStreamContextMap[a.id],c.Base.Utils.isDefined(b)&&(b.setMediaMuted(!1),this._muted||(b.getMediaElement().muted=!1,this.logStreamChanges(a.getAudioTracks(),"Unmuted audio output for track "))))},d.prototype.logStreamChanges=function(a,b){a&&a[0]&&c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,b+a[0].id)},d.prototype.setVolume=function(a){if(1<a||a<0)throw new RangeError("Volume must be a double between 0 and 1");for(var b in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(b)&&(this._mediaStreamContextMap[b].getMediaElement().volume=a);this._volume=a},d.prototype.getVolume=function(){return this._volume},d.prototype.mute=function(){for(var a in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(a)&&(this._mediaStreamContextMap[a].getMediaElement().muted=!0);this._muted=!0},d.prototype.unmute=function(){for(var a in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(a)&&((a=this._mediaStreamContextMap[a]).isMediaMuted()||(a.getMediaElement().muted=!1));this._muted=!1},d.prototype.isMuted=function(){return this._muted},d.prototype.onSelectedDeviceChanged=function(a){for(var b in this._selectedDevice=a,this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(b)&&(b=this._mediaStreamContextMap[b],!0===c.Base.Utils.hasProperty(b.getMediaElement(),"setSinkId")?b.getMediaElement().setSinkId(a.getDeviceId()):c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))},c.Base.AudioOutput=d}(AvayaClientServices),function(a){"use strict";function b(a,b){this._audioInterface=a,this._videoInterface=b}b.prototype={getAudioInterface:function(){return this._audioInterface},getVideoInterface:function(){return this._videoInterface}},a.Base.MediaServices=b}(AvayaClientServices),function(c){"use strict";function d(){this._audioInputInterfaceService=a,this._audioOutputInterfaceService=a,this._audioInterface=a,this._videoInterfaceService=a,this._videoInterface=a,this._mediaServices=a,this._mediaServicesService=a}d.prototype={start:function(){return b.when(this.getAudioInterface().start(),this.getVideoInterface().start())},stop:function(){return b.when(this.getAudioInterface().stop(),this.getVideoInterface().stop())},getMediaServices:function(){return this._mediaServices||(this._mediaServices=new c.Base.MediaServices(this.getAudioInterface(),this.getVideoInterface())),this._mediaServices},getMediaServicesService:function(){return this._mediaServicesService||(this._mediaServicesService=new c.Base.MediaServicesService(this.getMediaServices(),this.getAudioInputInterfaceService(),this.getAudioOutputInterfaceService(),this.getVideoInterfaceService(),new c.Base.UserMedia)),this._mediaServicesService},getAudioInputInterfaceService:function(){return this._audioInputInterfaceService||this.getAudioInterface(),this._audioInputInterfaceService},getAudioOutputInterfaceService:function(){return this._audioOutputInterfaceService||this.getAudioInterface(),this._audioOutputInterfaceService},getAudioInterface:function(){var a,b;return this._audioInterface||(this._audioInputInterfaceService=new c.Base.AudioInputInterfaceService,a=new c.Base.AudioInputInterface(this._audioInputInterfaceService),this._audioOutputInterfaceService=new c.Base.AudioOutputInterfaceService,b=new c.Base.AudioOutputInterface(this._audioOutputInterfaceService),this._audioInterface=new c.Base.AudioInterface(a,b)),this._audioInterface},getVideoInterfaceService:function(){return this._videoInterfaceService||this.getVideoInterface(),this._videoInterfaceService},getVideoInterface:function(){return this._videoInterface||(this._videoInterfaceService=new c.Base.VideoInterfaceService,this._videoInterface=new c.Base.VideoInterface(this._videoInterfaceService)),this._videoInterface}},c.Base.MediaServicesFactory=d}(AvayaClientServices),function(a){"use strict";function c(a,b,c,d,e){this._userMedia=e,this._audioInputInterfaceService=b,this._audioOutputInterfaceService=c,this._videoInterfaceService=d,this._mediaServices=a}c.prototype={getAudioInputService:function(){return this._audioInputInterfaceService},getAudioOutputService:function(){return this._audioOutputInterfaceService},getVideoInterfaceService:function(){return this._videoInterfaceService},createLocalMediaStream:function(c,d,e,f,g,h,i,j){return e&&!a.Base.Utils.isDefined(h)?b.Deferred().reject("Undefined videoChannelId"):this._userMedia.getUserMedia(d,e,f,g,!1,i,j).then(function(a,b,f){return this._setDefaultDevices(a),d&&c&&this._audioInputInterfaceService.localMediaStreamCreated(c,a),e&&h&&this._videoInterfaceService.localMediaStreamCreated(h,a),{stream:a,videoResolution:b,constraint:f}}.bind(this))},_setDefaultDevices:function(a){var b=a.getAudioTracks()[0];this._setDefaultDevice(b,this._mediaServices.getAudioInterface().getInputInterface()),a=a.getVideoTracks()[0],this._setDefaultDevice(a,this._mediaServices.getVideoInterface()),this._setDefaultOutputDevice(this._mediaServices.getAudioInterface().getOutputInterface())},_setDefaultDevice:function(a,b){var c;!b.getSelectDeviceCapability().isAllowed||!a||b.getSelectedDevice()||(c=b.getAvailableDevices().filter(function(b){
return b._label===a.label})[0])&&b.setSelectedDevice(c)},_setDefaultOutputDevice:function(a){var b;!a.getSelectDeviceCapability().isAllowed||a.getSelectedDevice()||(b=a.getAvailableDevices().filter(function(a){return"default"===a._deviceId})[0])&&a.setSelectedDevice(b)},addVideoTracksToLocalStream:function(c,d,e,f,g){var h=b.Deferred();return a.Base.Utils.isDefined(d)?this._userMedia.addVideoTracksToStream(c,e,f,g).then(function(a){this._videoInterfaceService.localMediaStreamCreated(d,a),h.resolve(a)}.bind(this).bind(d),function(a){h.reject(a)}):h.reject("Undefined videoChannelId"),h},removeLocalVideoTracks:function(b,c){var d=this._videoInterfaceService.getLocalMediaStream(b);if(a.Base.Utils.isDefined(d)){var e=d.getVideoTracks();a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks starting with "+e.length+" tracks.");for(var f=e.length-1;0<=f;f--){var g=e[f],h=e.indexOf(g);-1<h&&(g.stop(),d.removeTrack(g),c&&c.isRTCRtpSenderSupported()&&c.removeIfDoesNotSupportReplaceTrack(g),e.splice(h,1))}e=d.getVideoTracks(),a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks ending with "+e.length+" tracks."),this._videoInterfaceService.removeLocalMediaStream(b)}},getUserMedia:function(){return this._userMedia}},a.Base.MediaServicesService=c}(AvayaClientServices),function(c){"use strict";function d(d){this._selectedDevice=a,this._mediaInterfaceService=d,this._onDevicesAddedCallbacks=b.Callbacks("unique"),this._onDevicesRemovedCallbacks=b.Callbacks("unique"),this._onDevicesUpdatedCallbacks=b.Callbacks("unique"),this._onSelectedDeviceRemovedCallbacks=b.Callbacks("unique"),this._onSelectedDeviceChangedCallbacks=b.Callbacks("unique"),this._notifiedUnavailability=!1,this._onDevicesUnavailable=b.Callbacks("unique"),this._selectDeviceCapability=a,this._mediaAccessCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}d.prototype={start:function(){return this._mediaInterfaceService.start(this).then(function(){this._mediaAccessCapability._updateIfChanged(!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}.bind(this),function(a){this._mediaAccessCapability._updateIfChanged(!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}.bind(this))},stop:function(){return this._mediaInterfaceService.stop(this)},setSelectedDevice:function(a){if(!this.getSelectDeviceCapability().isAllowed)throw new Error("Selecting devices is not supported in current browser.");a&&(c.Base.Utils.isUndefined(this._selectedDevice)||a.getDeviceId()!==this._selectedDevice.getDeviceId())&&(c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"New device selected:",a.toString()),this._selectedDevice=a,this._onSelectedDeviceChangedCallbacks.fire(this,this._selectedDevice))},getAvailableDevices:function(){return this._mediaInterfaceService.getAvailableDevices()},hasAvailableDevices:function(){return this._mediaInterfaceService.hasAvailableDevices()},getSelectedDevice:function(){return this._selectedDevice},getSelectDeviceCapability:function(){var b;return this._selectDeviceCapability===a&&(b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED,c.Base.Utils.isWebRTC_SupportedBrowser()&&this._canPickDevices()&&(b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._selectDeviceCapability=new c.Base.Capability(b)),this._selectDeviceCapability},getMediaAccessCapability:function(){return this._mediaAccessCapability},addOnDevicesAddedCallback:function(a){this._onDevicesAddedCallbacks.add(a)},removeOnDevicesAddedCallback:function(a){this._onDevicesAddedCallbacks.remove(a)},addOnDevicesRemovedCallback:function(a){this._onDevicesRemovedCallbacks.add(a)},removeOnDevicesRemovedCallback:function(a){this._onDevicesRemovedCallbacks.remove(a)},addOnDevicesUpdatedCallback:function(a){this._onDevicesUpdatedCallbacks.add(a)},removeOnDevicesUpdatedCallback:function(a){this._onDevicesUpdatedCallbacks.remove(a)},addOnSelectedDeviceRemovedCallback:function(a){this._onSelectedDeviceRemovedCallbacks.add(a)},removeOnSelectedDeviceRemovedCallback:function(a){this._onSelectedDeviceRemovedCallbacks.remove(a)},addOnDevicesUnavailableCallback:function(a){this._onDevicesUnavailable.add(a)},removeOnDevicesUnavailableCallback:function(a){this._onDevicesUnavailable.remove(a)},addOnSelectedDeviceChangedCallback:function(a){this._onSelectedDeviceChangedCallbacks.add(a)},removeOnSelectedDeviceChangedCallback:function(a){this._onSelectedDeviceChangedCallbacks.remove(a)},_canPickDevices:function(){return!0}},c.Base.MediaInterface=d}(AvayaClientServices),function(c){"use strict";function d(){this._devices=[],this._deviceIdentifier="",this._isStarted=!1,this._observeDevicesInterval=a,this._hasDevices=!1}d.prototype={start:function(a){var d=b.Deferred();return c.Base.Utils.isWebRTC_SupportedBrowser()?(this._isStarted?d.resolve():(this._observeDevicesInterval=setInterval(function(){this._observeDevices(a,d)}.bind(this),1e3),this._observeDevices(a,d)),d.promise()):d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)).promise()},stop:function(c){return this._observeDevicesInterval&&(clearInterval(this._observeDevicesInterval),this._observeDevicesInterval=a),this._isStarted=!1,b.Deferred().resolve().promise()},getAvailableDevices:function(){return this._devices},hasAvailableDevices:function(){return this._hasDevices},_observeDevices:function(a,b){navigator.mediaDevices.enumerateDevices().then(function(c){this._processDevices(a,this._devices,c),this._isStarted||(this._isStarted=!0,b.resolve())}.bind(this))},_processDevices:function(a,b,c){this._scanForAddedDevices(a,b,c),this._scanForRemovedDevices(a,b,c),this._scanForAvailableDevices(a,b,c),this._updateDevicesLabel(a,b,c)},_getAddedDevices:function(a,b){var c=[],b=b.filter(function(a){return a.kind===this._deviceIdentifier}.bind(this));return this._hasDevices=0<b.length,b.forEach(function(b){var d=0<a.filter(function(a){return a.getDeviceId()===b.deviceId}).length,e=0<c.filter(function(a){return a._deviceId===b.deviceId}).length;d||e||!b.deviceId||(e=this._buildDevice(b),c.push(e))}.bind(this)),c},_updateDevicesLabel:function(a,b,d){var e=[];b.filter(function(a){d.forEach(function(b){return a._kind===b.kind&&a.getDeviceId()===b.deviceId&&(a.getLabel()!==b.label&&(a._label=b.label,c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Device label updated:",a.toString()),e.push(a)),!0)})}),0<e.length&&a._onDevicesUpdatedCallbacks.fire(a,e)},_scanForAddedDevices:function(a,b,d){d=this._getAddedDevices(b,d),0<d.length&&(d.forEach(function(a){c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"New device added:",a.toString()),b.push(a)}),a._notifiedUnavailability=!1,a._onDevicesAddedCallbacks.fire(a,d))},_scanForAvailableDevices:function(a,b,d){0!==b.length||a._notifiedUnavailability||(c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Device unavailable:",a.toString()),a._onDevicesUnavailable.fire(a),a._notifiedUnavailability=!0)},_scanForRemovedDevices:function(b,d,e){var f,g=d.filter(function(a){return 0===e.filter(function(b){return"default"===b.deviceId||"communications"===b.deviceId?a.getDeviceId()===b.deviceId&&a.getLabel()===b.label:a.getDeviceId()===b.deviceId}).length});0<g.length&&(g.forEach(function(a){d.splice(d.indexOf(a),1)}),f=0,g.forEach(function(a){a.getDeviceId()&&(f++,c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Device removed:",a.toString()))}),0<f&&b._onDevicesRemovedCallbacks.fire(b,g),-1<g.indexOf(b.getSelectedDevice())&&(g=b._selectedDevice,b._selectedDevice=a,c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"Selected device removed:",g.toString()),b._onSelectedDeviceRemovedCallbacks.fire(b,g)))},_buildDevice:function(a){throw new Error("Unable to build device")}},c.Base.MediaInterfaceService=d}(AvayaClientServices),function(a){"use strict";function b(a){this.mediaElement=a,this.streamMuted=!1}b.prototype={isMediaMuted:function(){return this.streamMuted},setMediaMuted:function(a){this.streamMuted=a},getMediaElement:function(){return this.mediaElement}},a.Base.MediaStreamContext=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.MediaStreamError={ABORT:"AbortError",NOT_ALLOWED:"NotAllowedError",PERMISSION_DENIED:"PermissionDeniedError",NOT_FOUND:"NotFoundError",NOT_READABLE:"NotReadableError",OVERCONSTRAINED:"OverconstrainedError",SECURITY:"SecurityError",TYPE:"TypeError",DEVICES_NOT_FOUND:"DevicesNotFoundError"}}(),function(){"use strict";AvayaClientServices.Base.MediaTypes={AUDIO_INPUT:"audioinput",AUDIO_OUTPUT:"audiooutput",VIDEO_INPUT:"videoinput"}}(),function(b){"use strict";function c(){this._audioElement=a,b.Base.AudioOutput.call(this)}(c.prototype=Object.create(b.Base.AudioOutput.prototype)).playAudioStream=function(a,c){var d;return!!(a&&a.active&&0<a.getAudioTracks().length)&&(this.isPlaying(a)?b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+a.getAudioTracks()[0].id):(b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+a.id+"  active: "+a.active),a.getAudioTracks().forEach(function(a){b.Base.Logger.debug(b.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+a.id+" enabled: "+a.enabled+" kind: "+a.kind+" label: "+a.label+" muted: "+a.muted+" readyState: "+a.readyState)}),this._audioElement&&(this._audioElement.srcObject=null,this._audioElement.remove()),this._audioElement=document.createElement("audio"),this._audioElement.muted=this._muted||c,this._audioElement.volume=this._volume,this._audioElement.autoplay=!0,this._audioElement.addEventListener("canplay",function(a){this._audioElement.play().then(function(){b.Base.Logger.debug("*** Playing remote audio stream...")})["catch"](function(a){b.Base.Logger.error("Failed to play remote audio stream",a)})}.bind(this)),0<a.getVideoTracks().length?(d=new MediaStream,a.getAudioTracks().forEach(function(a){d.addTrack(a)}),this._audioElement.srcObject=d):this._audioElement.srcObject=a,this._mediaStreamContextMap[a.id]=new b.Base.MediaStreamContext(this._audioElement),this._selectedDevice&&(!0===b.Base.Utils.hasProperty(this._audioElement,"setSinkId")?this._mediaStreamContextMap[a.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):b.Base.Logger.info(b.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},b.Base.SafariAudioOutput=c}(AvayaClientServices),function(c){"use strict";function d(){this.isAvailable()||c.Base.Logger.info(c.Base.LoggerTags.MEDIA_ENGINE,"UserMedia not available"),this._isChromeBrowser=this._checkIfBrowserIsChrome(),this._supportedConstaints=this.getMediaTrackConstraints()}d.prototype.isAvailable=function(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia},d.prototype.getMediaTrackConstraints=function(){var a={width:!0,height:!0,aspectRatio:!0,frameRate:!0,facingMode:!0,volume:!0,sampleRate:!0,sampleSize:!0,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,latency:!0,channelCount:!0,deviceId:!0,groupId:!0};return navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?(a=navigator.mediaDevices.getSupportedConstraints(),c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"supportedConstraints: ",a)):c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"navigator.mediaDevices.getSupportedConstraints is not available.  Assuming browser supports all constraints."),a},d.prototype.getUserMedia=function(a,d,e,f,g,h,i){var j=b.Deferred();return this.isAvailable()?(e=this._createAudioConstraints(a,e,i),i=[],d&&(i=this._createVideoConstraintList(h,f)),this._getUserMediaWithConstraints(j,e,i,g)):j.reject(new c.Services.Call.CallException(c.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)),j.promise()},d.prototype._getUserMediaWithConstraints=function(a,b,d,e,f,g){c.Base.Utils.getBrowserType()===c.Base.BrowserType.SAFARI?this._getSafariUserMediaWithConstraints(a,b,d,e,f,g):this._getGenericUserMediaWithConstraints(a,b,d,e,f)},d.prototype._getGenericUserMediaWithConstraints=function(b,d,e,f,g){var h=e.shift(),i=this._buildMediaConstraints(d,h);f&&(i.fake=!0);var j=h?h.resolution:a;i.video?c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",j):i.audio&&c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only");var k=function(a,h){c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),i.video&&!a.getVideoTracks().length&&i.video?this._getUserMediaErrorHandler(b,d,e,f,g,{name:"NotFoundError",message:"No video tracks",constraintName:"OverConstrainedError"}):b.resolve(a,j,h)}.bind(this);c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(k,function(a){var h,j=a.name===c.Base.MediaStreamError.OVERCONSTRAINED&&0===e.length;a.name===c.Base.MediaStreamError.NOT_ALLOWED||a.name===c.Base.MediaStreamError.NOT_READABLE||a.name===c.Base.MediaStreamError.NOT_FOUND||a.name===c.Base.MediaStreamError.ABORT||a.name===c.Base.MediaStreamError.PERMISSION_DENIED||j?i.audio&&i.video?(i.video=!1,c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback: ",a.message),c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback using ",i),navigator.mediaDevices.getUserMedia(i).then(function(b){var c={error:h=this._getMediaStreamErrorCode(a.name,!0),reason:a.name};k(b,c)}.bind(this),function(a){c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed audio only constraints: ",a),this._getUserMediaErrorHandler(b,d,e,f,g,a)}.bind(this))):(h=this._getMediaStreamErrorCode(a.name,i.video),b.reject(new c.Services.Call.CallException(h,c.Services.Call.CallProtocolType.APPLICATION,500,a.name))):i.video?this._getUserMediaErrorHandler(b,d,e,f,g,a):b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))["catch"](function(a){i.video?this._getUserMediaErrorHandler(b,d,e,f,g,a):b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))},d.prototype._getMediaStreamErrorCode=function(a,b){var d;switch(b=b||!1,a){case c.Base.MediaStreamError.NOT_READABLE:case c.Base.MediaStreamError.NOT_FOUND:case c.Base.MediaStreamError.ABORT:c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to add microphone or camera is not accessible"),d=b?c.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE:c.Services.Call.CallError.MICROPHONE_NOT_ACCESSIBLE;break;case c.Base.MediaStreamError.OVERCONSTRAINED:c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to overconstrained"),d=c.Services.Call.CallError.OVERCONSTRAINED;break;default:c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to device permission denied"),d=b?c.Services.Call.CallError.CAMERA_PERMISSION_DENIED:c.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED}return d},d.prototype._getSafariUserMediaWithConstraints=function(b,d,e,f,g,h){var i=e.shift(),j=this._buildMediaConstraints(d,i);f&&(j.fake=!0);var k,l=function(){var k=i?i.resolution:a,l=function(a){c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),h&&h.getTracks().forEach(function(b){a.addTrack(b)}),b.resolve(a,k)}.bind(this);if(j.video)c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",k);else if(j.audio)return c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only"),void b.resolve(h,k);c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(j)),j.audio=!1,navigator.mediaDevices.getUserMedia(j).then(l,function(a){var i,l=a.name===c.Base.MediaStreamError.OVERCONSTRAINED&&j.video&&0===e.length;a.name===c.Base.MediaStreamError.NOT_ALLOWED||a.name===c.Base.MediaStreamError.NOT_READABLE||a.name===c.Base.MediaStreamError.NOT_FOUND||a.name===c.Base.MediaStreamError.ABORT||a.name===c.Base.MediaStreamError.PERMISSION_DENIED||l?h?(i={error:this._getMediaStreamErrorCode(a.name,!0),reason:a.name},b.resolve(h,k,i)):(i=this._getMediaStreamErrorCode(a.name,j.video),b.reject(new c.Services.Call.CallException(i))):j.video?this._getUserMediaErrorHandler(b,d,e,f,g,a,h):b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))}.bind(this);c.Base.Utils.isUndefined(h)&&j.audio?(k={audio:j.audio},navigator.mediaDevices.getUserMedia(k).then(function(a){h=a,l()},function(a){a.name===c.Base.MediaStreamError.NOT_ALLOWED||a.name===c.Base.MediaStreamError.PERMISSION_DENIED||a.name===c.Base.MediaStreamError.NOT_READABLE||a.name===c.Base.MediaStreamError.ABORT||a.name===c.Base.MediaStreamError.NOT_FOUND?(c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track due to device permission denied"),b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED))):(c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track: "+a),b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE)))})):l()},d.prototype._getUserMediaErrorHandler=function(a,b,d,e,f,g,h){return g.name===c.Base.MediaStreamError.DEVICES_NOT_FOUND?(c.Base.Logger.error(c.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",g),void a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.DEVICES_NOT_FOUND))):g.message&&g.message.includes("Failed to allocate")?(c.Base.Logger.error(c.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",g),void((f=f||0)<2?(f++,setTimeout(function(){this._getUserMediaWithConstraints(a,b,d,e,f,h)}.bind(this),1e3)):a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE)))):(c.Base.Logger.warn(c.Base.LoggerTags.MEDIA_ENGINE,"Running constraints fallback: ",g),void this._getUserMediaWithConstraints(a,b,d,e,f,h))},d.prototype.addVideoTracksToStream=function(d,e,f,g){var h=b.Deferred(),i=e.getVideoTracks();return c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream starting with "+i.length+" tracks."),this.getUserMedia(!1,!0,a,d,!1,f).then(function(a){var b;a?(b=a.getVideoTracks(),c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream got new stream with "+b.length+" tracks."),a.getTracks().forEach(function(a){a.kind===c.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(c.Base.Logger.debug(c.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream added a track."+a.id),e.addTrack(a),g&&g.isRTCRtpSenderSupported()?g.replaceLocalMediaTrack(a,e).then(function(){h.resolve(e)},function(a){h.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE))}):h.resolve(e))})):h.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE))},function(a){h.reject(a)}),h},d.prototype._buildMediaConstraints=function(a,b){var c={};return c.audio=a||!1,c.video=!!b&&b.constraints,c},d.prototype._createAudioConstraints=function(a,b,c){var d;return a?b?(d={deviceId:{exact:b}},c&&(d=Object.assign(d,c))):d=c||!0:d=!1,d},d.prototype._createVideoConstraintList=function(b,d){function e(a){return a={resolution:a,constraints:{width:{},height:{}}},d&&(a.constraints.deviceId={exact:d}),a}function f(b,d){var f=e(b);return f.constraints.width.exact=b.getWidth(),f.constraints.height.exact=b.getHeight(),d?f.constraints.frameRate={min:d}:(f.resolution._fps=a,c.Base.Utils.getBrowserType()===c.Base.BrowserType.SAFARI&&(f.constraints.width=b.getWidth(),f.constraints.height=b.getHeight())),f}var g,h,i,j,k,l=(h=[],i=[],g=c.Base.VideoResolution,Object.keys(g).map(function(a){return g[a]}).forEach(function(a){a&&a.getHeight()<=b.getHeight()&&(h.push(f(a,480===a.getHeight()&&25<=b.getFPS()?25:c.Config.CallUserConfiguration.minPreferredVideoFPS||c.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS)),i.push(f(a)))}),h.concat(i));return l.push((j=e(b),k="max",c.Base.Utils.getBrowserType()!==c.Base.BrowserType.CHROME&&(k="ideal"),j.constraints.width[k]=b.getWidth(),j.constraints.height[k]=b.getHeight(),j)),l},d.prototype.createRTCVideoConstraints=function(a,b){var d={};return 180===a.getHeight()?c.Base.Utils.getBrowserType()===c.Base.BrowserType.CHROME?d.video={width:{max:a.getWidth()},height:{max:a.getHeight()}}:d.video={width:{ideal:a.getWidth()},height:{ideal:a.getHeight()}}:c.Base.Utils.getBrowserType()===c.Base.BrowserType.FIREFOX&&360<=a.getHeight()&&a.getHeight()<=480?d.video={width:640,height:360}:d.video={width:a.getWidth(),height:a.getHeight()},b&&(d.deviceId={exact:b}),d},d.prototype.adjustVideoResolution=function(a,d){if(a&&d&&!(d.getMinBandwidth()<=a)){for(var e=b.map(c.Base.VideoResolution,function(a){return a}),d=e.indexOf(d),f=d=-1===d?0:d;f<e.length;f++)if(e[f].getMinBandwidth()<=a&&e[f].getMaxBandwidth()>a)return e[f];return c.Base.VideoResolution.resolution180p}},d.prototype.adjustVideoResolutionForDimensions=function(a,d,e){for(var f=b.map(c.Base.VideoResolution,function(a){return a}),e=f.indexOf(e),g=e=-1===e?0:e;g<f.length;g++)if((c.Base.Utils.isUndefined(d)||0===d||f[g].getWidth()<=d)&&(c.Base.Utils.isUndefined(a)||0===a||f[g].getHeight()<=a))return f[g];return c.Base.VideoResolution.resolution180p},d.prototype.updateStreamUsingApplyConstraints=function(a,d,e,f,g){g=g||b.Deferred();var h=c.Base.UserMedia.prototype.createRTCVideoConstraints(d,f);return a.muted?(a.onunmute||(a.onunmute=function(){setTimeout(this.adjustVideoConstraints.bind(this,a,d,e,f,g),0)}.bind(this)),g.reject("Found video track issues. Can't apply constraints to the video track").promise()):(a.applyConstraints(h).then(function(){e._updateVideoResolution(d),g.resolve()},function(h){var i,j=b.map(c.Base.VideoResolution,function(a){return a}),k=j.indexOf(d);k+1<j.length?i=j[k+1]:g.reject(h),this.updateStreamUsingApplyConstraints(a,i,e,f,g)}.bind(this)),g.promise())},d.prototype._checkIfBrowserIsChrome=function(){return c.Base.Utils.getBrowserType()===c.Base.BrowserType.CHROME},c.Base.UserMedia=d}(AvayaClientServices),function(a){"use strict";function b(b,c,d){this._kind=a.Base.MediaTypes.VIDEO_INPUT,this._deviceId=b,this._groupId=c,this._label=d}b.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return"Camera device [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},a.Base.VideoDevice=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.MediaInterface.call(this,b),this._videoInterfaceService=b}(b.prototype=Object.create(a.Base.MediaInterface.prototype)).getRemoteMediaStream=function(a){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getRemoteMediaStream(a);throw new Error("VideoInterface.getRemoteMediaStream(): Capability not allowed")},b.prototype.getLocalMediaStream=function(a){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getLocalMediaStream(a);throw new Error("VideoInterface.getLocalMediaStream(): Capability not allowed")},b.prototype.toString=function(){return"Camera"},a.Base.VideoInterface=b}(AvayaClientServices),function(a){"use strict";function b(){a.Base.MediaInterfaceService.call(this),this._deviceIdentifier=a.Base.MediaTypes.VIDEO_INPUT,this._localStreamMap={},this._remoteStreamMap={},this._currentChannelId=1}(b.prototype=Object.create(a.Base.MediaInterfaceService.prototype))._buildDevice=function(b){return new a.Base.VideoDevice(b.deviceId,b.groupId,b.label)},b.prototype.createVideoChannel=function(){return this._currentChannelId++},b.prototype.getRemoteMediaStream=function(a){return this._remoteStreamMap[a]},b.prototype.getLocalMediaStream=function(a){return this._localStreamMap[a]},b.prototype.setRemoteMediaStream=function(a,b){this._remoteStreamMap[a]=b},b.prototype.localMediaStreamCreated=function(b,c){var d;0<c.getVideoTracks().length&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(d=new MediaStream,c.getVideoTracks().forEach(function(a){a instanceof MediaStreamTrack&&"live"===a.readyState&&d.addTrack(a)}),this._localStreamMap[b]=d):this._localStreamMap[b]=c)},b.prototype.removeMediaStreams=function(a){delete this._localStreamMap[a],delete this._remoteStreamMap[a]},b.prototype.removeLocalMediaStream=function(a){delete this._localStreamMap[a]},b.prototype.removeRemoteMediaStream=function(a){delete this._remoteStreamMap[a]},b.prototype.replaceLocalMediaStream=function(b,c){var d;this._localStreamMap.hasOwnProperty(b)&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(d=new MediaStream,c.getVideoTracks().forEach(function(a){a instanceof MediaStreamTrack&&"live"===a.readyState&&d.addTrack(a)}),this._localStreamMap[b]=d):this._localStreamMap[b]=c)},a.Base.VideoInterfaceService=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkErrorCodes={HTTP_REDIRECTION:300,HTTP_MOVED_PERMANENTLY:301,HTTP_FOUND:302,HTTP_SEE_OTHER:303,HTTP_NOT_MODIFIED:304,HTTP_USE_PROXY:305,HTTP_TEMPORARY_REDIRECT:307,HTTP_PERMANENT_REDIRECT:308,HTTP_BAD_REQUEST:400,HTTP_UNAUTHORIZED:401,HTTP_PAYMENT_REQUIRED:402,HTTP_FORBIDDEN:403,HTTP_NOT_FOUND:404,HTTP_METHOD_NOT_ALLOWED:405,HTTP_NOT_ACCEPTABLE:406,HTTP_PROXY_AUTHENTICATION_REQUIRED:407,HTTP_REQUEST_TIMEOUT:408,HTTP_CONFLICT:409,HTTP_GONE:410,HTTP_LENGTH_REQUIRED:411,HTTP_PRECONDITION_FAILED:412,HTTP_PAYLOAD_TO_LARGE:413,HTTP_URI_TOO_LONG:414,HTTP_UNSUPPORTED_MEDIA_TYPE:415,HTTP_RANGE_NOT_SATISFIABLE:416,HTTP_EXPECTATION_FAILED:417,HTTP_MISDIRECTED_REQUEST:421,HTTP_UNPROCESSABLE_ENTITY:422,HTTP_LOCKED:423,HTTP_FAILED_DEPENDENCY:424,HTTP_UPGRADE_REQUIRED:426,HTTP_PRECONDITION_REQUIRED:428,HTTP_TOO_MANY_REQUESTS:429,HTTP_REQUEST_HEADERS_TOO_LARGE:431,HTTP_NGINX_NO_RESPONSE:444,HTTP_UNAVAILABLE_FOR_LEGAL:451,HTTP_NGINX_SSL_CERTIFICATE_ERROR:495,HTTP_NGINX_SSL_CERTIFICATE_REQUIRED:496,HTTP_NGINX_HTTP_TO_HTTPS:444,HTTP_NGINX_CLIENT_CLOSED_REQUEST:499,HTTP_INTERNAL_SERVER_ERROR:500,HTTP_NOT_IMPLEMENTED:501,HTTP_BAD_GATEWAY:502,HTTP_SERVICE_UNAVAILABLE:503,HTTP_GATEWAY_TIMEOUT:504,HTTP_NETWORK_AUTHENTICATION_REQUIRED:511,HTTP_NETWORK_ERROR:400001,WEBSOCKET_CLOSE_NORMAL:1e3,WEBSOCKET_UNAUTHORIZED:1006}}(),function(a){"use strict";function b(a,b,c,d,e){this._retryHelper=a,this._deferred=b,this._status=c,this._responseText=d,this._retryAfter=this._parseRetryAfter(e)}b.prototype={getRequestRetryHelper:function(){return this._retryHelper},getStatus:function(){return this._status},getResponseText:function(){return this._responseText},getDeferred:function(){return this._deferred},getRetryAfter:function(){return this._retryAfter},_parseRetryAfter:function(b){if(a.Base.Utils.isDefined(b)&&null!==b){var c=parseInt(b);return isNaN(c)?new Date(b)-new Date:1e3*c}}},a.Base.NetworkErrorEvent=b}(AvayaClientServices),function(c){"use strict";function d(a){this._parentLoggerTag=a,this._blackList=[],this._disableOptionsLogging=!1}d.prototype.registerBlackList=function(a){this._blackList=a},d.prototype.logSendMessage=function(a,d,e){var f,g,h=["PROVIDER:",e.type],i=d;if(e.type&&e.type!==c.Base.ProviderTypes.WEB_SOCKET_PROVIDER&&(i=b.extend({},e.defaultOptions,d),e=e._getServerURL(i),h.push("URL:",e)),a instanceof ArrayBuffer)h.push("BYTES SENT:",a.byteLength);else{try{f=this._generateLoggedMessage(a)}catch(a){f="Failed to generate sent message "+a}h.push("\nMESSAGE SENT:",f)}if(!this._disableOptionsLogging){try{g=this._generateLoggedMessage(i)}catch(a){g="Failed to generate sent options "+a}h.push("\nOPTIONS SENT:",g)}this._log(c.Base.Logger.debug,h)},d.prototype.logRecvMessage=function(a,b,d){if(a&&a.data instanceof ArrayBuffer){var e,f="BYTE LENGTH RECV: "+a.data.byteLength+". ";d&&(d.receivedTime&&(f+="PrTime: "+(e=(new Date).getTime())+". TimeDiff: "+(e-d.receivedTime)+". "),d.wsConnectionId&&(f+="wsConnId: "+d.wsConnectionId)),this._log(c.Base.Logger.debug,f)}else{var g;try{g=this._generateLoggedMessage(a)}catch(a){g="Failed to generate received message "+a}b&&b.getAllResponseHeaders?(b=b.getAllResponseHeaders(),this._log(c.Base.Logger.debug,"\nMESSAGE RECEIVED:",g,"\nHEADERS RECEIVED:",b)):this._log(c.Base.Logger.debug,"\nMESSAGE RECEIVED:",g)}},d.prototype.disableOptionsLogging=function(a){this._disableOptionsLogging=a},d.prototype._generateLoggedMessage=function(c){var d,e,f;if(c)return"string"==typeof(c=c.data||c)?(f=this._blackList.join("|"),this._isXML(c)?(d=new RegExp("("+f+')="(.*?)"',"mig"),e=c.replace(d,'$1="REMOVED"'),this._blackList.reduce(function(a,b){return-1<e.indexOf("<"+b)&&a.push(b),a},[]).forEach(function(a){a=new RegExp("(?:(<"+a+"(?:[\\s\\S]*?))(\\/>))|(?:(<"+a+"(?:[\\s\\S]*?)>)([\\s\\S]*?)(</"+a+">))","mig"),e=e.replace(a,"$1$2$3$5")})):e=this._isJSON(c)?(e=JSON.parse(c),this._removeFromObject(e),JSON.stringify(e,a,2)):(f=new RegExp("((?:"+f+")=)(.*?)([&]|$)","mig"),c.replace(f,"$1REMOVED$3"))):c instanceof Uint8Array?e="Uint8Array["+c.length+"]":"object"==typeof c&&(e=b.extend(!0,{},c),this._removeFromObject(e),e=JSON.stringify(e,a,2)),e},d.prototype._isXML=function(a){return 0===(a=a.trim()).indexOf("<?xml")},d.prototype._isJSON=function(a){return 0===(a=a.trim()).indexOf("{")||0===a.indexOf("[")},d.prototype._removeFromObject=function(a){Object.keys(a).forEach(function(b){if(this._removeFromLogs(b))a[b]="REMOVED";else if("string"!=typeof a[b]&&null!==a[b]&&Object.keys(a[b]).length)this._removeFromObject(a[b]);else if("string"==typeof a[b]&&this._isJSON(a[b]))try{var c=JSON.parse(a[b]);this._removeFromObject(c),a[b]=JSON.stringify(c)}catch(b){}}.bind(this))},d.prototype._removeFromLogs=function(a){return-1<this._blackList.indexOf(a)},d.prototype._log=function(b){var d=Array.prototype.slice.call(arguments,1);d.unshift(this._parentLoggerTag),b.call(a,c.Base.LoggerTags.NETWORK_PROVIDER,d)},c.Base.NetworkLogger=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkProviderEvents={UNAUTHORIZED:"UNAUTHORIZED",AUTHORIZED:"AUTHORIZED",RETRYING:"RETRYING"}}(),function(a){"use strict";function b(a){this._retryCallback=a,this._retryCounter=0}b.prototype={getRetryCallback:function(){return this._retryCallback},getRetryCounter:function(){return this._retryCounter},incrementCounter:function(){this._retryCounter++}},a.Base.NetworkRequestRetryHelper=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProvidersEventTypes={PING:"Ping"}}(),function(a){"use strict";function b(b,c){a.Base.BaseError.call(this,b,c),this.name="NetworkError"}b.prototype=Object.create(a.Base.BaseError.prototype),a.Base.NetworkError=b}(AvayaClientServices),function(c){"use strict";function d(){this._listeners={}}d.prototype={on:function(a,b){return"function"!=typeof b||(this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b)),this},off:function(b,c){if("function"!=typeof c)return this;if(this._listeners[b]===a)throw new Error("There is no such handler for event with name: "+b+".");if(c=this._listeners[b].indexOf(c),-1===c)throw new Error("There is no such handler for event with name: "+b+".");return this._listeners[b].splice(c,1),this},trigger:function(c,d){c=this._listeners[c],c!==a&&(d=d||[],b.each(c,function(a,b){b.apply(window,d)}))},hasListeners:function(b){return b=this._listeners[b],b!==a&&b.length},_removeListeners:function(){for(var a in this._listeners)if(this._listeners.hasOwnProperty(a))for(var b=this._listeners[a].length-1;0<=b;b--)this.off(a,this._listeners[a][b])}},c.Base.Observable=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.PerformanceAlertType={CPU_USAGE_OVERLOADED:"CPU_USAGE_OVERLOADED",CPU_USAGE_WARNING:"CPU_USAGE_WARNING",BANDWIDTH_UNAVAILABLE_OVERLOAD:"BANDWIDTH_UNAVAILABLE_OVERLOAD",BANDWIDTH_UNAVAILABLE_WARNING:"BANDWIDTH_UNAVAILABLE_WARNING"}}(),function(a){"use strict";function b(){}b.prototype={state:function(){},always:function(a){},done:function(a){},fail:function(a){},progress:function(a){},then:function(a,b,c){}},a.Base.Promise=b}(AvayaClientServices),function(c){"use strict";function d(){this.messagingProviders=[],this.conferenceProviders=[],this.callProviders=[],
this.collaborationProviders=[],this._ammProviderFactory={},this._ammProvider={},this._wcsProviderFactory={},this._wcsProvider={},this._contactsProviders=[],this._directorySearchProviders=[],this._acsProviderFactory={},this._acsContactsProvider={},this._acsDirectorySearchProvider={},this._presenceProviders=[],this._csgProviderFactory={},this._csgPresenceProvider={},this._scopiaProvider={},this._sgCallProvider={},this._scopiaConferenceProviderFactory={},this._rtcConnectionProviderFactory={},this._remoteLoggerProvider=a}d.prototype={getMessagingProviders:function(a){return 0<this.messagingProviders.length?this.messagingProviders:(a=this._getAMMProvider(this._getAMMProviderConfiguration(a)),b.isEmptyObject(a)||this.messagingProviders.push(a),this.messagingProviders)},getContactsProviders:function(a){var c;return 0===this._contactsProviders.length&&(c=this._getACSContactsProvider(),b.isEmptyObject(c)||this._contactsProviders.push(c)),this._contactsProviders},_getACSContactsProvider:function(){return b.isEmptyObject(this._acsContactsProvider)&&(b.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new c.Providers.ACS.ACSProviderFactory),this._acsContactsProvider=this._acsProviderFactory.getACSContactsProvider()),this._acsContactsProvider},getDirectorySearchProviders:function(a){var c;return 0===this._directorySearchProviders.length&&(c=this._getACSDirectorySearchProvider(),b.isEmptyObject(c)||this._directorySearchProviders.push(c)),this._directorySearchProviders},_getACSDirectorySearchProvider:function(){return b.isEmptyObject(this._acsDirectorySearchProvider)&&(b.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new c.Providers.ACS.ACSProviderFactory),this._acsDirectorySearchProvider=this._acsProviderFactory.getACSDirectorySearchProvider()),this._acsDirectorySearchProvider},getPresenceProviders:function(a){return 0===this._presenceProviders.length&&(a=this._getCSGPresenceProvider(a),b.isEmptyObject(a)||this._presenceProviders.push(a)),this._presenceProviders},_getCSGPresenceProvider:function(a){return b.isEmptyObject(this._csgPresenceProvider)&&(this._csgPresenceProvider=this._getCSGProviderFactory().getCSGPresenceProvider(a)),this._csgPresenceProvider},getConferenceProviders:function(a){return 0<this.conferenceProviders.length?this.conferenceProviders:(a=this._getScopiaConferenceProvider(a.uccpConfiguration),b.isEmptyObject(a)||this.conferenceProviders.push(a),this.conferenceProviders)},getCallProviders:function(d,e,f){return 0<this.callProviders.length||d.sgConfiguration!==a&&!c.Base.Utils.isBool(d.sgConfiguration.enabled)||(f=this._getSGCallProvider(d.sgConfiguration,e,f),b.isEmptyObject(f)||this.callProviders.push(f)),this.callProviders},getVoiceMessagingProvider:function(a){var b=a.networkProviderConfiguration.restConfig,a=b.isSecure?c.Base.Utils.isDefined(b.port)?b.port:"443":c.Base.Utils.isDefined(b.port)?b.port:"80",a=b.hostName+":"+a;return this._getCSGProviderFactory().getCSGCallsProvider(a)},_getAMMProvider:function(a){return b.isEmptyObject(this._ammProvider)&&(b.isEmptyObject(this._ammProviderFactory)&&(this._ammProviderFactory=new c.Providers.AMM.AMMProviderFactory),this._ammProvider=this._ammProviderFactory.getAMMProvider(a)),this._ammProvider},_getWCSProvider:function(a){return b.isEmptyObject(this._wcsProvider)&&(b.isEmptyObject(this._wcsProviderFactory)&&(this._wcsProviderFactory=new c.Providers.WCS.WCSProviderFactory),this._wcsProvider=this._wcsProviderFactory.getWCSProvider(a)),this._wcsProvider},_getWCSProviderConfiguration:function(a){return a.wcsConfiguration},_getScopiaConferenceProvider:function(a){return b.isEmptyObject(this._scopiaProvider)&&(b.isEmptyObject(this._scopiaConferenceProviderFactory)&&(this._scopiaConferenceProviderFactory=new c.Providers.Scopia.ScopiaConferenceProviderFactory),this._scopiaProvider=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(a)),this._scopiaProvider},_getSGCallProvider:function(a,d,e){return b.isEmptyObject(this._sgCallProvider)&&(this._sgCallProvider=new c.Providers.Call.CallProvider(this._getCSGProviderFactory(),d,e,this._getRTCConnectionProviderFactory())),this._sgCallProvider},_getCSGProviderFactory:function(){return b.isEmptyObject(this._csgProviderFactory)&&(this._csgProviderFactory=new c.Providers.CallServiceGateway.CallServiceGatewayProviderFactory),this._csgProviderFactory},_getRTCConnectionProviderFactory:function(){return b.isEmptyObject(this._rtcConnectionProviderFactory)&&(this._rtcConnectionProviderFactory=new c.Base.RTCConnectionProviderFactory),this._rtcConnectionProviderFactory},_getAMMProviderConfiguration:function(a){return a.ammConfiguration},getCollaborationProviders:function(a){return 0<this.collaborationProviders.length?this.collaborationProviders:(a=this._getWCSProvider(this._getWCSProviderConfiguration(a)),b.isEmptyObject(a)||this.collaborationProviders.push(a),this.collaborationProviders)},createCollaborationProviders:function(a){return[(new c.Providers.WCS.WCSProviderFactory).getWCSProvider(this._getWCSProviderConfiguration(a))]},getRemoteLoggerProvider:function(){return c.Base.Utils.isUndefined(this._remoteLoggerProvider)&&(this._remoteLoggerProvider=new c.Providers.RemoteLogger.RemoteLoggerProvider),this._remoteLoggerProvider}},c.Base.ProviderFactory=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProviderTypes={REST_PROVIDER:"RestProvider",WEB_SOCKET_PROVIDER:"WebSocketProvider",SSE_PROVIDER:"SSEProvider",WCS_COMET_PROVIDER:"WCSCometProvider",UCCP_LONG_POLLING_PROVIDER:"UCCPLongPollingProvider"}}(),function(c){"use strict";function d(d,e,f,g,h){c.Base.Observable.call(this),this.isAvailable()&&(this._rtcConfig=d,this._dtmfSender=a,this._iceNegotiatedCallback=a,this._updateSdpCallback=a,this._sdpErrorCallback=a,this._iceGatheringTimeoutId=a,this._relayCandidatesTimeoutId=a,this._relayIceCandidateCountTimeoutId=a,this._waitForIceGatheringTimeoutId=a,this._localMediaCount=0,this._mediaStreams=[],this._iceCandidates=[],this._iceRelayCandidatesCounter={},this._hasGatheredIceCandidates=!1,this._lookupRelayCandidates=!!d&&!!d.iceTransportPolicy&&"relay"===d.iceTransportPolicy,this._RELAY_CANDIDATES_TIMEOUT=e,this._LAST_RELAY_CANDIDATE_TIMEOUT=f,this._ICE_GATHERING_TIMEOUT=f,this._ICE_RESTART_INTERVAL=g,this._MAX_ICE_RECOVERY_TIME=h,this._statsParser=new c.Base.AbstractRTCStatsReportParser,this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks=b.Callbacks())}var e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,f=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,g=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})) \d+ typ .*/,h=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/,i=/candidate:\w{1,32} \d{1,5} (udp|UDP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/;(d.prototype=Object.create(c.Base.Observable.prototype)).isAvailable=function(){return e&&f},d.prototype.addStream=function(a){c.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig)},d.prototype.removeStream=function(a){},d.prototype.createPeerConnection=function(a){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Closing the peer connection and re-creating it with new config.",a),this.close(),c.Base.Utils.isDefined(a)&&!b.isEmptyObject(a)||(a=null),this._pc=new e(a)},d.prototype.updatePeerConfiguration=function(a,b){this._lookupRelayCandidates=!!a&&!!a.iceTransportPolicy&&"relay"===a.iceTransportPolicy,this._rtcConfig=a,b=b||!1,(this._lookupRelayCandidates||b)&&(this._iceCandidates=[],this._hasGatheredIceCandidates=!1)},d.prototype.updatePeerConnection=function(a){if(this.isRTCRtpSenderSupported()){var b=[];this._pc.getSenders().forEach(function(a){this._haveLiveTrack(a)?(b.push(a.track),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Found track to propagate to the new peer connection.",a.track.id,a.track.type)):a.track&&c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Will NOT propagate track to the new peer connection.",a.track.id,a.track.type,a.track.readyState)}.bind(this)),this.createPeerConnection(a);for(var d=new MediaStream,e=0;e<b.length;++e)this.addTrack(b[e],d)}else{var f=this._pc.getLocalStreams();this.createPeerConnection(a),f.forEach(function(a){this.addStream(a)}.bind(this))}},d.prototype._haveLiveTrack=function(b){return null!==b.track&&b.track!==a&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE},d.prototype.rollbackLocalOfferState=function(){},d.prototype.createOffer=function(a,b,d,e,g,h,i){var j=0;i=!!c.Base.Utils.isDefined(i)&&i,c.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(j=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._lookupRelayCandidates?this.createRelayOffer(a,b,d,e,this._rtcConfig,j,g,h):j&&this._rtcConfig._turnOfferType&&"hostOnly"===this._rtcConfig._turnOfferType?this.createHostOnlyOffer(a,b,d,e,this._rtcConfig,j,g,h,i):(!j||this._hasGatheredIceCandidates||this.hasICECandidates()||(this._rtcConfig._turnOfferType&&"relayOnly"===this._rtcConfig._turnOfferType&&(this._rtcConfig.iceTransportPolicy="relay"),this.updatePeerConnection(this._rtcConfig)),this._localMediaCount=this.getLocalMediaCount(),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),i=this._createOfferOptions(e),g&&(i.iceRestart=g),this._pc.createOffer(i).then(function(i){function k(){!function(){this._iceNegotiatedCallback=a,this._updateSdpCallback=d,this._sdpErrorCallback=b;var c=Math.max(j,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),c)}.call(this),this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var l=i.type,m=i.sdp;"function"==typeof d&&(m=d(m)),l={type:l,sdp:m},this._pc.setLocalDescription(new f(l)).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),k.call(this)}.bind(this))["catch"](function(f){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+f),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+m),g&&Date.now()-h<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(a,b,d,e,g,h)}.bind(this),this._ICE_RESTART_INTERVAL):b(f)}.bind(this))}.bind(this))["catch"](function(f){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+f),g&&Date.now()-h<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(a,b,d,e,g,h)}.bind(this),this._ICE_RESTART_INTERVAL):b(f)}.bind(this)))},d.prototype.createRelayOffer=function(a,d,e,g,h,i,j,k){var l,m,n,o;0===h.iceServers[0].urls.length||i<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?c.Base.Logger.info("Creating Relay Offer using "+h.iceServers[0].urls[0]):(o=b.extend(!0,{},h),l=o.iceServers[0].urls.shift(),o.iceServers[0].urls=[l],this.updatePeerConnection(o),c.Base.Logger.info("Creating Relay Offer using "+l)),n=function(){!function(){this._iceNegotiatedCallback=a,this._updateSdpCallback=e,this._sdpErrorCallback=d,m=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),i);var b=0===h.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(i-=b,h.iceServers[0].urls.shift(),c.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+h.iceServers[0].urls.length),this.createRelayOffer(a,d,e,g,h,i,j,k))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),b)}.call(this),this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))},this._pc.onicecandidate=function(b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===b.candidate?null:b.candidate.candidate)),null!==b.candidate?this._iceCandidates.push(b.candidate.candidate):0<this._iceCandidates.length?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),i-=Date.now()-m,h.iceServers[0].urls.shift(),c.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+h.iceServers[0].urls.length),this.createRelayOffer(a,d,e,g,h,i,j,k))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),o=this._createOfferOptions(g),j&&(o.iceRestart=j),this._pc.createOffer(o).then(function(b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var l=b.type,m=b.sdp,l={type:l,sdp:m="function"==typeof e?e(m):m};this._pc.setLocalDescription(new f(l)).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),n.call(this)}.bind(this))["catch"](function(b){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+b),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+m),j&&Date.now()-k<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,d,e,g,h,i,j,k)}.bind(this),this._ICE_RESTART_INTERVAL):d(b)}.bind(this))}.bind(this))["catch"](function(b){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+b),j&&Date.now()-k<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,d,e,g,h,i,j,k)}.bind(this),this._ICE_RESTART_INTERVAL):d(b)}.bind(this),o))},d.prototype._isHostOnlyUdpCandidate=function(a,b){var d=!0;try{(g.test(a)||h.test(a)||i.test(a)&&!b)&&(d=!1)}catch(b){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to parse ICE candidate: ",a)}return d},d.prototype.createHostOnlyOffer=function(a,b,d,e,g,h,i,j,k){c.Base.Logger.info("Creating host only Offer"),this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection({}),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=function(f){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===f.candidate?null:f.candidate.candidate)),null!==f.candidate?this._isHostOnlyUdpCandidate(f.candidate.candidate,k)&&this._iceCandidates.push(f.candidate.candidate):0<this._iceCandidates.length||this._hasGatheredIceCandidates?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),c.Base.Logger.info("No host only candidates found. Trying relay only servers: "+g.iceServers[0].urls.length),g._turnOfferType="relayOnly",this.createOffer(a,b,d,e,i,j,k))}.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this);var l=this._createOfferOptions(e);i&&(l.iceRestart=i),this._pc.createOffer(l).then(function(h){function l(){!function(){this._iceNegotiatedCallback=a,this._updateSdpCallback=d,this._sdpErrorCallback=b,this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(c.Base.Logger.info("No host only candidates found. Trying relay only servers: "+g.iceServers[0].urls.length),g._turnOfferType="relayOnly",this.createOffer(a,b,d,e,i,j,k))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),this._ICE_GATHERING_TIMEOUT)}.call(this),this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var m=h.type,n=h.sdp;"function"==typeof d&&(n=d(n)),m={type:m,sdp:n},this._pc.setLocalDescription(new f(m)).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),l.call(this)}.bind(this))["catch"](function(f){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+f),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+n),i&&Date.now()-j<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(a,b,d,e,i,j)}.bind(this),this._ICE_RESTART_INTERVAL):b(f)}.bind(this))}.bind(this))["catch"](function(f){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+f),i&&Date.now()-j<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(a,b,d,e,i,j)}.bind(this),this._ICE_RESTART_INTERVAL):b(f)}.bind(this))},d.prototype.receiveAnswer=function(a,b,c){this._pc.setRemoteDescription(new f({type:"answer",sdp:a})).then(b)["catch"](c)},d.prototype.createAnswer=function(a,b,d,e){var g,h=0;c.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(h=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._lookupRelayCandidates?this.createRelayAnswer(a,b,d,e,this._rtcConfig,h):(["SCM-W09","RVL-AL09"].forEach(function(b){navigator.userAgent.includes(b)&&(a=c.Base.SDPUtil.updateProfileLevelId(a,"42E01F"))}),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createAnswer offer SDP:\n"+a),!h||this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection(this._rtcConfig),this._localMediaCount=this.getLocalMediaCount(),(g=function(g,i){return this._pc.setRemoteDescription(new f({type:g,sdp:i})).then(function(){this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),this._pc.createAnswer().then(function(g){function i(){!function(){this._iceNegotiatedCallback=b,this._updateSdpCallback=e,this._sdpErrorCallback=d;var a=Math.max(h,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),a)}.call(this),this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var j=g.type,k=g.sdp,l=c.Base.SDPUtil.getProfileLevelId(a),g=c.Base.SDPUtil.getProfileLevelId(k);l&&g&&(l=l.toUpperCase(),g=g.toUpperCase(),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",l),l===g||"424028"!==l&&"42401F"!==l||(k=c.Base.SDPUtil.updateProfileLevelId(k,l))),"function"==typeof e&&(k=e(k)),k={type:j,sdp:k},this._pc.setLocalDescription(new f(k)).then(function(){i.call(this)}.bind(this),function(a){this._answerError(a,d)}.bind(this))}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+a),d(a)}.bind(this))}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+a),d(a)}.bind(this))}.bind(this))("offer",a)["catch"](function(b){"42401F"===c.Base.SDPUtil.getProfileLevelId(a)?(c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+b),c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Trying to set profile-level-id to 42E01F"),a=c.Base.SDPUtil.updateProfileLevelId(a,"42E01F"),g("offer",a)["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+a),d(a)})):(c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+b),d(b))}))},d.prototype.createRelayAnswer=function(a,d,e,g,h,i){var j,k;c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createRelayAnswer offer SDP:\n"+a),0===h.iceServers[0].urls.length||i<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?c.Base.Logger.info("Creating Relay Answer using "+h.iceServers[0].urls[0]):(j=b.extend(!0,{},h),k=j.iceServers[0].urls.shift(),j.iceServers[0].urls=[k],this.updatePeerConnection(j),c.Base.Logger.info("Creating Relay Answer using "+k)),this._pc.setRemoteDescription(new f({type:"offer",sdp:a})).then(function(){function b(){!function(){this._iceNegotiatedCallback=d,this._updateSdpCallback=g,this._sdpErrorCallback=e,j=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),i);var b=0===h.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(i-=b,h.iceServers[0].urls.shift(),c.Base.Logger.info("No relay candidates found  with "+k+". Remaining turn servers to try: "+h.iceServers[0].urls.length),this.createRelayAnswer(a,d,e,g,h,i))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),b)}.call(this),this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}var j;this._pc.onicecandidate=function(b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===b.candidate?null:b.candidate.candidate)),null!==b.candidate?this._iceCandidates.push(b.candidate.candidate):0<this._iceCandidates.length?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),i-=Date.now()-j,h.iceServers[0].urls.shift(),c.Base.Logger.info("No relay candidates found  with "+k+". Remaining turn servers to try: "+h.iceServers[0].urls.length),this.createRelayAnswer(a,d,e,g,h,i))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this,d),this._pc.createAnswer().then(function(d){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var h=d.type,i=d.sdp,j=c.Base.SDPUtil.getProfileLevelId(a),d=c.Base.SDPUtil.getProfileLevelId(i);j&&d&&(j=j.toUpperCase(),d=d.toUpperCase(),c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",j),j===d||"424028"!==j&&"42401F"!==j||(i=c.Base.SDPUtil.updateProfileLevelId(i,j))),i={type:h,sdp:i="function"==typeof g?g(i):i},this._pc.setLocalDescription(new f(i)).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createAnswer.setLocalDescription"),b.call(this)}.bind(this),function(a){this._answerError(a,e)}.bind(this))}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+a),e(a)}.bind(this))}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+a),e(a)}.bind(this)))},d.prototype._answerError=function(a,b){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+a),b(a)},d.prototype._iceGatheringTimeoutHandler=function(){var b;clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayCandidatesTimeoutId=a,this._relayIceCandidateCountTimeoutId=a,this._iceGatheringTimeoutId=a,this._pc.onicecandidate=function(a){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===a.candidate?null:a.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),c.Base.Utils.isDefined(this._pc)&&(c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),0===this._iceCandidates.length?this._handleIceGatheringTimeoutError():(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering.  Using current SDP"),c.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(b="function"==typeof this._updateSdpCallback?(b=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:b}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+b.sdp),this._iceNegotiatedCallback(b),this._iceNegotiatedCallback=a,this._updateSdpCallback=a))},d.prototype._handleIceGatheringTimeoutError=function(){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering. No candidates found"),c.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=a),c.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=a),this._throwSdpError(),this._iceNegotiatedCallback=a,this._updateSdpCallback=a,this._sdpErrorCallback=a},d.prototype._throwSdpError=function(){this._sdpErrorCallback({errorCode:c.Services.Call.CallError.TRANSPORT_ERROR,protocolType:c.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},d.prototype._relayCandidatesTimeoutHandler=function(){var b;c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice host only or relay candidates gathering: "+this._iceCandidates.length),this._relayCandidatesTimeoutId=a,0<this._iceCandidates.length&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=a,this._pc.onicecandidate=function(a){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===a.candidate?null:a.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),c.Base.Utils.isDefined(this._pc)&&(c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),c.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(b="function"==typeof this._updateSdpCallback?(b=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:b}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+b.sdp),this._iceNegotiatedCallback(b),this._iceNegotiatedCallback=a,this._updateSdpCallback=a))},d.prototype.close=function(){this._pc&&((c.Base.Utils.isDefined(this._pc.connectionState)?this._pc.connnectionState:this._pc.signalingState)!==c.Base.AbstractRTCConnectionProvider.Constants.RTC_PEER_CONNECTION_STATE_CLOSED&&this._pc.close(),this._mediaStreams=[],clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),clearTimeout(this._waitForIceGatheringTimeoutId))},d.prototype.hasICECandidates=function(){return 0<this._iceCandidates.length},d.prototype.onAddStream=function(a){},d.prototype.onAddRemoteTrack=function(a){},d.prototype.onRemoveRemoteTrack=function(a){},d.prototype.onAddTrackInternal=function(a){a=a.track,a&&this.onAddRemoteTrack&&this.onAddRemoteTrack(a)},d.prototype.onRemoveTrackInternal=function(a){a=a.track,a&&this.onRemoveRemoteTrack&&this.onRemoveRemoteTrack(a)},d.prototype.onTrackInternal=function(a){var b,d;this.onAddStream&&(0<a.streams.length?(b=this._mediaStreams.findIndex(function(b){
return b.id===a.streams[0].id}),(d=a.streams[0])&&(d.onaddtrack=this.onAddTrackInternal.bind(this),d.onremovetrack=this.onRemoveTrackInternal.bind(this),-1===b?(this._mediaStreams.push(d),this.onAddStream(d)):this._mediaStreams[b].active||(this._mediaStreams[b]=d,this.onAddStream(d)))):a.track&&a.track.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&this.onAddRemoteTrack&&0<(d=this._pc.getRemoteStreams()).length&&(d[0].addTrack(a.track),d[0].onaddtrack=this.onAddTrackInternal.bind(this),d[0].onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddRemoteTrack(a.track)))},d.prototype._getDTMFSender=function(){},d.prototype._sendUpdatedSdp=function(){var b;c.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(b="function"==typeof this._updateSdpCallback?(b=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:b}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+b.sdp),this._iceNegotiatedCallback(b),this._iceNegotiatedCallback=a,this._updateSdpCallback=a),c.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=a),c.Base.Utils.isDefined(this._relayIceCandidateCountTimeoutId)&&(clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayIceCandidateCountTimeoutId=a),c.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=a)},d.prototype._onIceCandidate=function(a){var b,d;c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===a.candidate?null:a.candidate.candidate)),null!==a.candidate?(this._iceCandidates.push(a.candidate.candidate),this._lookupRelayCandidates||-1===a.candidate.candidate.indexOf("relay")||!(b=this.parseIceRelayCandidate(a.candidate.candidate,a.candidate))||"1"!==b.component&&"rtp"!==b.component||(d=0,a=b.networkId||"0",a=b.foundation+":"+a,this._iceRelayCandidatesCounter.hasOwnProperty(a)&&(d=this._iceRelayCandidatesCounter[a]),this._iceRelayCandidatesCounter[a]=++d,d===this._localMediaCount&&c.Base.Utils.isUndefined(this._relayIceCandidateCountTimeoutId)&&(c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Short circuiting relay candidates"),this._relayIceCandidateCountTimeoutId=setTimeout(function(){this._pc.onicecandidate=function(a){c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===a.candidate?null:a.candidate.candidate))},this._sendUpdatedSdp()}.bind(this),2e3)))):0<this._iceCandidates.length?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(d=this._hasGatheredIceCandidates?1e3:0,setTimeout(function(){0===this._iceCandidates.length&&(this._hasGatheredIceCandidates?this._sendUpdatedSdp():this._handleIceGatheringTimeoutError())}.bind(this),d))},d.prototype._oniceGatheringStateChange=function(b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> oniceGatheringStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this._pc.iceGatheringState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_GATHERING&&(clearTimeout(this._waitForIceGatheringTimeoutId),this._waitForIceGatheringTimeoutId=a,this._hasGatheredIceCandidates||(this._hasGatheredIceCandidates=0!==this._iceCandidates.length),this._iceCandidates=[])},d.prototype._oniceConnectionStateChange=function(a){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< oniceConnectionStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]),this._pc.iceConnectionState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CLOSED&&(this._iceCandidates=[],this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[]))},d.prototype.stopAllStreams=function(){},d.prototype.enableAllStreams=function(){this.enableLocalStreams(),this.enableRemoteStreams()},d.prototype.enableRemoteStreams=function(){this._enableDisableRemoteStreams(!0)},d.prototype.disableRemoteStreams=function(){this._enableDisableRemoteStreams(!1)},d.prototype._enableDisableRemoteStreams=function(a){},d.prototype.enableLocalStreams=function(){this._enableDisableLocalStreams(!0)},d.prototype.disableLocalStreams=function(){this._enableDisableLocalStreams(!1)},d.prototype._enableDisableLocalStreams=function(a){},d.prototype.enableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!0)},d.prototype.disableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!1)},d.prototype._enableDisableLocalAudioStreams=function(a){},d.prototype.enableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!0)},d.prototype.disableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!1)},d.prototype._enableDisableLocalVideoStreams=function(a){},d.prototype.enableRemoteAudioStream=function(){this._enableDisableRemoteAudioStream(!0)},d.prototype.enableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!0)},d.prototype.disableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!1)},d.prototype._enableDisableRemoteAudioStream=function(a){},d.prototype._enableDisableRemoteVideoStreams=function(a){},d.prototype.limitOutgoingVideoBitRate=function(a){this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(b){var d;b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Limiting outgoing video bitrate "+b.track.id+" to "+a),(d=b.getParameters()).encodings.forEach(function(b){b.maxBitRate=1024*a}),b.setParameters(d)["catch"](function(a){c.Base.Logger.warn("Failed to limit outgoing video bitrate",a)}))})},d.prototype.enableRemoteVideoTrack=function(a,b){a.getVideoTracks().forEach(function(d){d.id===b.id?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Enabling video track: "+d.id+" for "+a.id),d.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(a.removeTrack(d),a.addTrack(b)):d.enabled=!0):(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Disabling old video track: "+d.id+" for "+a.id),d.enabled=!1,d.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&a.removeTrack(d))}.bind(this))},d.prototype.sendDTMF=function(a){var b=this._getDTMFSender();return!!c.Base.Utils.isDefined(b)&&(b.insertDTMF(a),!0)},d.prototype.isPlaying=function(a){return!!(0<a.currentTime&&!a.paused&&!a.ended&&2<a.readyState)},d.prototype.stopStream=function(a){c.Base.Utils.isDefined(a)&&null!==a&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping stream "+a.id),a.getTracks().forEach(function(a){a.stop()}))},d.prototype.hasVideo=function(a){return a&&0<a.getVideoTracks().length},d.prototype._createOfferOptions=function(a){return c.Base.Utils.isDefined(a)?this.addTransceiverIfNeeded(a)?{offerToReceiveAudio:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:a!==c.Services.Call.MediaDirection.INACTIVE}:{}},d.prototype.isRTCRtpSenderSupported=function(){return!1},d.prototype.addTrack=function(a,b){c.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this.monitorAudioTrack(a)},d.prototype.monitorAudioTrack=function(b){b&&b.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(b.onended=function(d){var e=b?b.id:a;c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"*** Local audio track ended "+e),this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,[b])}.bind(this))},d.prototype.removeLocalAudioTrack=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local audio track: "+b.track.id),b.track.stop(),a.removeTrack(b.track))}.bind(this))},d.prototype.removeLocalVideoTrack=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local video track: "+b.track.id),b.track.stop(),a.removeTrack(b.track))}.bind(this))},d.prototype.removeIfDoesNotSupportReplaceTrack=function(a){},d.prototype.replaceLocalMediaTrack=function(a,d){var e=b.Deferred(),f=0,g=function(){d?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+a.kind+" track  "+a.id),this.addTrack(a,d),d.addTrack(a),this.monitorAudioTrack(a),e.resolve(!0)):(c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+a.kind+" track  "+a.id+" due to missing media stream"),e.reject("Missing local media stream"))}.bind(this);return this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===a.kind&&(f++,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+a.kind+" track  "+b.track.id+" with "+a.id),b.replaceTrack(a).then(function(){d&&(d.addTrack(a),this.monitorAudioTrack(a)),e.resolve(!1)}.bind(this))["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+a.kind+" track instead due to "+d),b.track.stop(),g()}))}.bind(this)),0===f&&g(),e.promise()},d.prototype.setLocalVideoDirection=function(a){this._pc.getTransceivers().forEach(function(b){!b.stopped&&b.sender.track&&b.sender.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.currentDirection!==a&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+a+":"+b.sender.track.id+":"+b.sender.track.readyState),b.direction=a)}.bind(this))},d.prototype.isSetLocalVideoDirectionSupported=function(){return!!this._pc&&"getTransceivers"in this._pc},d.prototype.hasVideoTrackStopStreaming=function(a){return this.isRTCRtpSenderSupported()?0!==this._pc.getSenders().filter(function(b){return!!b.track&&b.track.id===a.id&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED}.bind(this)).length:!!a&&a.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED},d.prototype.hasVideoTracks=function(){return!!this.isRTCRtpSenderSupported()&&0!==this._pc.getSenders().filter(function(a){return!!a.track&&a.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK}.bind(this)).length},d.prototype.getStats=function(){return this._getStats([c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},d.prototype.getVideoStats=function(){return this._getStats([c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},d.prototype._getStats=function(a){if(this.isRTCRtpSenderSupported()){var d=b.Deferred(),e=new c.Base.AudioStatistics,f=new c.Base.VideoStatistics,g={},h=[],i=!a.includes(c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK);return this._pc.getSenders().forEach(function(b){b.track&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&a.includes(b.track.kind)&&h.push(b.getStats().then(function(a){i?this._statsParser.parseVideoStats(a,f):this._statsParser.parse(a,e,f,g)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(b){b.track&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&a.includes(b.track.kind)&&h.push(b.getStats().then(function(a){i?this._statsParser.parseVideoStats(a,f):this._statsParser.parse(a,e,f,g)}.bind(this)))}.bind(this)),b.when.apply(this,h).then(function(){d.resolve({audioStatistics:e,videoStatistics:f,iceCandidateStatistics:g})},function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+a),d.reject(a)}),d.promise()}return this._pc.getStats(null).then(function(a){return this._statsParser.parse(a)}.bind(this))["catch"](function(a){return c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+a),Promise.reject(a)})},d.prototype.adjustVideoConstraints=function(a,c,d,e){var f=b.Deferred();return a&&c?(e=this._createVideoConstraintsList(a,c,d,e),this._applyVideoConstraints(f,e)):f.reject("Undefined video width or height"),f.promise()},d.prototype.adjustAudioConstraints=function(a){var d=b.Deferred(),e=navigator.mediaDevices.getSupportedConstraints();return c.Base.Utils.isDefined(a)&&e.noiseSuppression?(a={noiseSuppression:a},this._applyAudioConstraints(d,a)):d.reject("Unsupported constraints"),d.promise()},d.prototype.updateMediaConstraints=function(a,b){var c,d=!1;for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)&&b[c]===a[c]||(b[c]=a[c],d=!0));return d},d.prototype._applyAudioConstraints=function(a,b){this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(d){var e;d.track&&d.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&d.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=d.track.getConstraints(),this.updateMediaConstraints(b,e)?(c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",e),d.track.applyConstraints(e).then(function(){var b=d.track.getConstraints();c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",b),a.resolve()})["catch"](function(b){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",b),a.reject("Failed to apply audio constraints")}.bind(this))):a.resolve())}.bind(this)):this._pc.getLocalStreams().forEach(function(d){d.getAudioTracks().forEach(function(d){var e;d.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=d.getConstraints(),this.updateMediaConstraints(b,e)?(c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",b),d.applyConstraints(e).then(function(){var b=d.getConstraints();c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",b),a.resolve()})["catch"](function(b){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",b),a.reject("Failed to apply audio constraints")}.bind(this))):a.resolve())}.bind(this))}.bind(this))},d.prototype._applyVideoConstraints=function(a,b){var d=b.shift();d?this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(e){if(e.track&&e.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",d),c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track: enabled: "+e.track.enabled+" id: "+e.track.id+" kind: "+e.track.kind+" muted: "+e.track.muted+" readyState: "+e.track.readyState+" remote: "+e.track.remote),e.track.muted)return e.track.onunmute||(e.track.onunmute=function(){e.track.applyConstraints(d).then(function(){var b=e.track.getConstraints();c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",b),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(d),a.resolve()})["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",d),this._applyVideoConstraints(a,b)}.bind(this))}),c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),a.reject("Video track is muted. Can't apply constraints to the video track");e.track.applyConstraints(d).then(function(){var b=e.track.getConstraints();c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",b),a.resolve()})["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",d),this._applyVideoConstraints(a,b)}.bind(this))}}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){if(e.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",d),c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track: enabled: "+e.enabled+" id: "+e.id+" kind: "+e.kind+" muted: "+e.muted+" readyState: "+e.readyState+" remote: "+e.remote),e.muted)return e.onunmute||(e.onunmute=function(){e.applyConstraints(d).then(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(d),a.resolve()})["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",d),this._applyVideoConstraints(a,b)}.bind(this))}),c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),a.reject("Video track is muted. Can't apply constraints to the video track");e.applyConstraints(d).then(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),a.resolve()})["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",d),this._applyVideoConstraints(a,b)}.bind(this))}}.bind(this))}.bind(this)):a.reject("Unsupported constraints")},d.prototype.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(a){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.add(a)},d.prototype.removeOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(a){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.remove(a)},d.prototype._createVideoConstraintsList=function(a,b,d,e){function f(a,b){var d={width:{exact:a.getWidth()},height:{exact:a.getHeight()}};return e&&(d.deviceId={exact:e}),b?d.frameRate={min:b}:c.Base.Utils.getBrowserType()===c.Base.BrowserType.SAFARI&&(d.width=a.getWidth(),d.height=a.getHeight()),d}var g=[],h=[],i=d||c.Config.CallUserConfiguration.minPreferredVideoFPS||c.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS;Object.keys(c.Base.VideoResolution).filter(function(a){a=c.Base.VideoResolution[a],a&&a.getHeight()<=b&&(g.push(f(a,i)),h.push(f(a)))});var j=g.concat(h);return c.Base.Utils.getBrowserType()!==c.Base.BrowserType.CHROME?(d={width:{ideal:a},height:{ideal:b}},e&&(d.deviceId={exact:e}),j.push(d)):(a={width:{max:a},height:{max:b}},e&&(a.deviceId={exact:e}),j.push(a)),j},d.prototype.addTransceiverIfNeeded=function(a){return!1},d.prototype.getIceConnectionState=function(){return this._pc?this._pc.iceConnectionState:a},d.prototype.parseIceRelayCandidate=function(b,c){return a},d.prototype.getLocalMediaCount=function(){var a=0;return this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(b){!b.track||b.track.kind!==c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.track.kind!==c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||b.track.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||a++}.bind(this)):this._pc.getLocalStreams().forEach(function(b){b.getTracks().forEach(function(b){b.kind!==c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.kind!==c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||a++})}),a},d.prototype.addOnSelectedCandidatePairIdChanged=function(a){this._statsParser&&this._statsParser.addOnSelectedCandidatePairIdChanged(a)},d.prototype.removeOnSelectedCandidatePairIdChanged=function(a){this._statsParser&&this._statsParser.removeOnSelectedCandidatePairIdChanged(a)},d.prototype.setVideoSendBandwidth=function(a){this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(b){if(b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){var d=b.getParameters();return c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send bandwidth - old parameters: ",d),d.encodings||(d.encodings=[]),d.encodings[0]||(d.encodings[0]={}),d.encodings[0].maxBitrate=1e3*a,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send bandwidth - new parameters: ",d),b.setParameters(d).then(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send bandwidth set to at most "+a+"kbps")}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send bandwidth failed - error: "+a.name)}.bind(this))}}.bind(this))},d.prototype.getVideoSendBandwidth=function(){var a;return this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(b){!b.track||b.track.kind!==c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK||b.track.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||(b=b.getParameters()).encodings&&b.encodings[0]&&c.Base.Utils.isDefined(b.encodings[0].maxBitrate)&&(a=b.encodings[0].maxBitrate)}.bind(this)),a},d.prototype.setVideoSendResolution=function(a,d){var e;if(this.isRTCRtpSenderSupported())return this._pc.getSenders().forEach(function(f){f.track&&f.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&f.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send resolution to at most "+a+"x"+d),e=f.track.muted?b.Deferred().reject("Set video send resolution failed: Video track is muted").promise():f.track.applyConstraints({height:{max:d},width:{max:a}}).then(function(){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send resolution set to at most "+a+"x"+d)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send resolution failed : "+a.name)}.bind(this)))}.bind(this)),e},d.prototype.stopLocalAudioTrack=function(){this._pc.getSenders().forEach(function(a){a.track&&a.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping local audio track: "+a.track.id),a.track.stop())}.bind(this))},d.prototype.isLocalAudioTrackEnded=function(){return this.isLocalMediaTrackEnded(c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK)},d.prototype.isLocalVideoTrackEnded=function(){return this.isLocalMediaTrackEnded(c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK)},d.prototype.isLocalMediaTrackEnded=function(a){var b=!0;return!!this.isRTCRtpSenderSupported()&&(this._pc.getSenders().forEach(function(d){d.track&&d.track.kind===a&&d.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(b=!1)}.bind(this)),b)},c.Base.AbstractRTCConnectionProvider=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.Constants={ICE_GATHERING_STATE_COMPLETE:"complete",ICE_GATHERING_STATE_GATHERING:"gathering",ICE_CONNECTION_STATE_COMPLETED:"completed",ICE_CONNECTION_STATE_CONNECTED:"connected",ICE_CONNECTION_STATE_CHECKING:"checking",ICE_CONNECTION_STATE_FAILED:"failed",ICE_CONNECTION_STATE_DISCONNECTED:"disconnected",ICE_CONNECTION_STATE_NEW:"new",ICE_CONNECTION_STATE_CLOSED:"closed",RTC_PEER_CONNECTION_STATE_CLOSED:"closed",MEDIA_STREAM_TRACK_READY_STATE_LIVE:"live",MEDIA_STREAM_TRACK_READY_STATE_ENDED:"ended",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",RTC_STATS_TYPE:{INBOUND_RTP:"inbound-rtp",REMOTE_OUTBOUND_RTP:"remote-outbound-rtp",OUTBOUND_RTP:"outbound-rtp",REMOTE_INBOUND_RTP:"remote-inbound-rtp",TRACK:"track",CANDIDATE_PAIR:"candidate-pair",LOCAL_CANDIDATE:"local-candidate",REMOTE_CANDIDATE:"remote-candidate",MEDIA_SOURCE:"media-source",CODEC:"codec",TRANSPORT:"transport"},RTC_STATS_MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"}}}(),function(c){"use strict";function d(){this._inboundStatsType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUND_RTP,this._outboundStatsType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP,this._remoteInboundStatsType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_INBOUND_RTP,this._remoteOutboundStatsType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_OUTBOUND_RTP,this._trackType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRACK,this._candidatePairType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CANDIDATE_PAIR,this._localCandidateType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.LOCAL_CANDIDATE,this._remoteCandidateType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_CANDIDATE,this._mediaSourceType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.MEDIA_SOURCE,this._codec=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CODEC,this._transportType=c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRANSPORT,this._localCandidates={},this._remoteCandidates={},this._selectedCandidatePairId=a,this._audioTransportId=a,this._videoTransportId=a,this._selectedCandidatePairIdChangedCallbacks=b.Callbacks()}d.prototype.processOutboundGenericStats=function(a,b){c.Base.Utils.isDefined(a.timestamp)&&(b.timestamp=a.timestamp),c.Base.Utils.isDefined(a.packetsSent)&&(b.packetsTransmitted=a.packetsSent),c.Base.Utils.isDefined(a.bytesSent)&&(b.bytesTransmitted=a.bytesSent),c.Base.Utils.isDefined(a.packetsLost)&&(b.packetLossTotalTransmitted=a.packetsLost),c.Base.Utils.isDefined(a.roundTripTime)&&(b.roundTripTimeMilliseconds=a.roundTripTime)},d.prototype.processInboundGenericStats=function(a,b){c.Base.Utils.isDefined(a.timestamp)&&(b.timestamp=a.timestamp),c.Base.Utils.isDefined(a.packetsReceived)&&(b.packetsReceived=a.packetsReceived),c.Base.Utils.isDefined(a.bytesReceived)&&(b.bytesReceived=a.bytesReceived),c.Base.Utils.isDefined(a.packetsLost)&&(b.packetLossTotalReceived=a.packetsLost),c.Base.Utils.isDefined(a.jitter)&&(b.jitterMillisecondsReceived=1e3*a.jitter),c.Base.Utils.isDefined(a.fractionLost)&&(b.packetsLossFractionReceived=a.fractionLost)},d.prototype.processOutboundVideoStats=function(a,b){c.Base.Utils.isDefined(a.framesEncoded)&&(b.framesEncoded=a.framesEncoded),c.Base.Utils.isDefined(a.totalEncodeTime)&&(b.totalEncodeTime=a.totalEncodeTime),c.Base.Utils.isDefined(a.firCount)&&(b.firCountTransmitted=a.firCount),c.Base.Utils.isDefined(a.pliCount)&&(b.pliCountTransmitted=a.pliCount),c.Base.Utils.isDefined(a.nackCount)&&(b.nackCountTransmitted=a.nackCount)},d.prototype.processInboundVideoStats=function(a,b){c.Base.Utils.isDefined(a.framesDecoded)&&(b.framesDecoded=a.framesDecoded),c.Base.Utils.isDefined(a.totalDecodeTime)&&(b.totalDecodeTime=a.totalDecodeTime),c.Base.Utils.isDefined(a.firCount)&&(b.firCountReceived=a.firCount),c.Base.Utils.isDefined(a.pliCount)&&(b.pliCountReceived=a.pliCount),c.Base.Utils.isDefined(a.nackCount)&&(b.nackCountReceived=a.nackCount)},d.prototype.processInboundStats=function(a,b,d,e){switch(this.getMediaType(a,e)){case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:c.Base.Utils.isDefined(a.transportId)&&(this._audioTransportId=a.transportId),this.processInboundGenericStats(a,b);break;case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:c.Base.Utils.isDefined(a.transportId)&&(this._videoTransportId=a.transportId),this.processInboundGenericStats(a,d),this.processInboundVideoStats(a,d)}},d.prototype.processRemoteOutboundStats=function(a,b,d,e){switch(this.getMediaType(a,e)){case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processInboundGenericStats(a,b);break;case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processInboundGenericStats(a,d),this.processInboundVideoStats(a,d)}},d.prototype.processOutboundStats=function(a,b,d,e){switch(this.getMediaType(a,e)){case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processOutboundGenericStats(a,b);break;case c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processOutboundGenericStats(a,d),this.processOutboundVideoStats(a,d)}},d.prototype.processRemoteInboundStats=function(a,b,c,d){this.processOutboundStats(a,b,c,d)},d.prototype.processVideoTrackStats=function(a,b){c.Base.Utils.isDefined(a.remoteSource)&&(a.remoteSource?(c.Base.Utils.isDefined(a.framesPerSecond)&&(b.actualFrameRateReceived=a.framesPerSecond),c.Base.Utils.isDefined(a.frameHeight)&&(b.heightReceived=a.frameHeight),c.Base.Utils.isDefined(a.frameWidth)&&(b.widthReceived=a.frameWidth),c.Base.Utils.isDefined(a.framesReceived)&&(b.framesReceived=a.framesReceived)):(c.Base.Utils.isDefined(a.framesPerSecond)&&(b.actualFrameRateTransmitted=a.framesPerSecond),c.Base.Utils.isDefined(a.frameHeight)&&(b.heightTransmitted=a.frameHeight),c.Base.Utils.isDefined(a.frameWidth)&&(b.widthTransmitted=a.frameWidth),c.Base.Utils.isDefined(a.framesSent)&&(b.framesTransmitted=a.framesSent)))},d.prototype.processAudioTrackStats=function(a,b){c.Base.Utils.isDefined(a.remoteSource)&&(a.remoteSource?(c.Base.Utils.isDefined(a.totalAudioEnergy)&&(b.totalAudioEnergyReceived=a.totalAudioEnergy),c.Base.Utils.isDefined(a.audioLevel)&&(b.audioLevelReceived=a.audioLevel)):c.Base.Utils.isDefined(a.audioLevel)&&(b.audioLevelTransmitted=a.audioLevel))},d.prototype.processTrackStats=function(a,b,d){switch(a.kind){case c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK:this.processVideoTrackStats(a,d);break;case c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK:this.processAudioTrackStats(a,b)}},d.prototype.processAudioMediaSourceStats=function(a,b){c.Base.Utils.isDefined(a.totalAudioEnergy)&&(b.totalAudioEnergyTransmitted=a.totalAudioEnergy),c.Base.Utils.isDefined(a.audioLevel)&&(b.audioLevelTransmitted=a.audioLevel)},d.prototype.processMediaSourceStats=function(a,b,d){a.kind===c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO&&this.processAudioMediaSourceStats(a,b)},d.prototype.processCodecGenericStats=function(a,b){c.Base.Utils.isDefined(a.mimeType)&&(b.codec=a.mimeType)},d.prototype.processCodecStats=function(a,b,d){this.getCodecMediaType(a)===c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO?this.processCodecGenericStats(a,b):this.processCodecGenericStats(a,d)},d.prototype.getMediaType=function(a){return a.mediaType},d.prototype.processRTCStats=function(a,b,c,d,e){switch(a.type){case this._inboundStatsType:this.processInboundStats(a,b,c,e);break;case this._outboundStatsType:this.processOutboundStats(a,b,c,e);break;case this._remoteInboundStatsType:this.processRemoteInboundStats(a,b,c,e);break;case this._remoteOutboundStatsType:
this.processRemoteOutboundStats(a,b,c,e);break;case this._trackType:this.processTrackStats(a,b,c);break;case this._candidatePairType:this.processCandidatePairStats(a,b,c,d);break;case this._localCandidateType:this.processLocalCandidateStats(a);break;case this._remoteCandidateType:this.processRemoteCandidateStats(a);break;case this._mediaSourceType:this.processMediaSourceStats(a,b,c);break;case this._codec:this.processCodecStats(a,b,c);break;case this._transportType:this.processTransportStats(a,b)}},d.prototype.processVideoRTCStats=function(a,b,d){if(this.getMediaType(a,d)===c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO)switch(a.type){case this._inboundStatsType:this.processInboundGenericStats(a,b),this.processInboundVideoStats(a,b);break;case this._outboundStatsType:this.processOutboundGenericStats(a,b),this.processOutboundVideoStats(a,b)}},d.prototype.processVideoCandidatePairStats=function(a,b){c.Base.Utils.isDefined(a.currentRoundTripTime)&&(b.roundTripTimeMillis=1e3*a.currentRoundTripTime),c.Base.Utils.isDefined(a.availableOutgoingBitrate)&&(b.availableTransmitBitrate=a.availableOutgoingBitrate),c.Base.Utils.isDefined(a.availableIncomingBitrate)&&(b.availableReceiveBitrate=a.availableIncomingBitrate)},d.prototype.processCandidatePairStats=function(a,b,d,e){var f,g,h;"succeeded"===a.state&&(f=this._localCandidates[a.localCandidateId],g=this._remoteCandidates[a.remoteCandidateId],h=a.ID||a.id,f&&g&&(e[h]=new c.Base.CandidatePairStatistics(f,g)),this.getCandidatePairMediaType(a)===c.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(a,d))},d.prototype.getCandidatePairMediaType=function(a){if(c.Base.Utils.isDefined(a.transportId))return-1!==a.transportId.search("audio")||this._audioTransportId===a.transportId?"audio":-1!==a.transportId.search("video")||this._videoTransportId===a.transportId?"video":void 0},d.prototype.getCodecMediaType=function(a){if(c.Base.Utils.isDefined(a.mimeType))return-1!==a.mimeType.search("audio")?"audio":-1!==a.mimeType.search("video")?"video":void 0},d.prototype.processLocalCandidateStats=function(a){var b=a.address||a.ip||"localhost",d=a.ID||a.id;this._localCandidates[d]=new c.Base.CandidateStatistics(b,a.port,a.protocol,a.candidateType)},d.prototype.processRemoteCandidateStats=function(a){var b=a.address||a.ip,d=a.ID||a.id;this._remoteCandidates[d]=new c.Base.CandidateStatistics(b,a.port,a.protocol,a.candidateType)},d.prototype.processTransportStats=function(a,b){var c=a.id||a.rtcpTransportStatsId;!c||-1===c.search("audio")&&c!==this._audioTransportId||(this._selectedCandidatePairId&&this._selectedCandidatePairId!==a.selectedCandidatePairId&&this._selectedCandidatePairIdChangedCallbacks.fire(a.selectedCandidatePairId),this._selectedCandidatePairId=a.selectedCandidatePairId,b.transportBytesReceived=a.bytesReceived)},d.prototype.calculateStats=function(b,d){c.Base.Utils.isDefined(b.packetsReceived)&&(c.Base.Utils.isUndefined(b.packetLossTotalReceived)?b.fractionLostLocal=a:0===b.packetsReceived?b.fractionLostLocal=0:b.fractionLostLocal=b.packetLossTotalReceived/(b.packetsReceived+b.packetLossTotalReceived)),this.calculateVideoStats(d)},d.prototype.calculateVideoStats=function(b){c.Base.Utils.isUndefined(b.packetsLossFractionTransmitted)&&(c.Base.Utils.isUndefined(b.packetsTransmitted)||c.Base.Utils.isUndefined(b.packetLossTotalTransmitted)?b.packetsLossFractionTransmitted=a:0===b.packetsTransmitted?b.packetsLossFractionTransmitted=0:b.packetsLossFractionTransmitted=b.packetLossTotalTransmitted/(b.packetsTransmitted+b.packetLossTotalTransmitted)),c.Base.Utils.isUndefined(b.packetsLossFractionReceived)&&(c.Base.Utils.isUndefined(b.packetsReceived)||c.Base.Utils.isUndefined(b.packetLossTotalReceived)?b.packetsLossFractionReceived=a:0===b.packetsReceived?b.packetsLossFractionReceived=0:b.packetsLossFractionReceived=b.packetLossTotalReceived/(b.packetsReceived+b.packetLossTotalReceived))},d.prototype.parse=function(a,b,d,e){return b=b||new c.Base.AudioStatistics,d=d||new c.Base.VideoStatistics,e=e||{},c.Base.Utils.forEach(a,function(c){this.processRTCStats(c,b,d,e,a)},this),this.calculateStats(b,d),{audioStatistics:b,videoStatistics:d,iceCandidateStatistics:e}},d.prototype.parseVideoStats=function(a,b){return b=b||new c.Base.VideoStatistics,c.Base.Utils.forEach(a,function(c){this.processVideoRTCStats(c,b,a)},this),this.calculateVideoStats(b),{videoStatistics:b}},d.prototype.addOnSelectedCandidatePairIdChanged=function(a){this._selectedCandidatePairIdChangedCallbacks.add(a)},d.prototype.removeOnSelectedCandidatePairIdChanged=function(a){this._selectedCandidatePairIdChangedCallbacks.remove(a)},c.Base.AbstractRTCStatsReportParser=d}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.AudioStatistics=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.bytesTransmitted=b,this.bytesReceived=a,this.packetsTransmitted=d,this.packetsReceived=c,this.roundTripTimeMilliseconds=e,this.packetLossTotalTransmitted=f,this.packetLossTotalReceived=g,this.jitterMillisecondsReceived=h,this.totalAudioEnergyTransmitted=j,this.totalAudioEnergyReceived=i,this.audioLevelTransmitted=l,this.audioLevelReceived=k,this.codec=m,this.fractionLostLocal=n,this.transportBytesReceived=0}}(),function(c){"use strict";function d(b){this._previousAudioStatistics=a,this._previousVideoStatistics=a,this._call=b,this.isStarted=!1,this._interval=a,this._statisticsLog=a,this._config=c.Base.CallStatisticsLoggerConfig}d.prototype.start=function(){this.isStarted?c.Base.Logger.warn(c.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger has already started"):(this._initialize(),this.isStarted=!0,this._logStatistics(),this._interval=setInterval(this._logStatistics.bind(this),this._config.INTERVAL_IN_MILLIS))},d.prototype._logStatistics=function(){var a,d;c.Base.Utils.isDefined(this._call)?(a=this._call.getAudioDetails(),d=this._call.getVideoDetails(),b.when(a,d).done(function(a,b){this._processStatistics(a,b),this._saveStatistics(a,b),this._logStats()}.bind(this)),b.when(a,d).fail(function(){this.stop(),c.Base.Logger.warn(c.Base.LoggerTags.CALL_STATISTICS,"Statistics of call ("+this._call.getCallId()+") are unavailable, stopping CallStatisticLogger")}.bind(this))):(this.stop(),c.Base.Logger.warn(c.Base.LoggerTags.CALL_STATISTICS,"Statistics cannot be processed because the call is not longer available, stopping CallStatisticLogger"))},d.prototype._processStatistics=function(a,b){var c;this._statisticsLog.forEach(function(d){d.mediaType===this._config.MEDIA_TYPE.AUDIO?c=a[d.key]:d.mediaType===this._config.MEDIA_TYPE.VIDEO&&(c=b[d.key]),this._processStatistic(d,c)},this)},d.prototype._processStatistic=function(b,d){c.Base.Utils.isDefined(d)?b.valueType===this._config.VALUE_TYPE.INSTANT?b.value=d:b.valueType===this._config.VALUE_TYPE.CALCULATED&&(this._statHasPreviousValue(b)?b.value=0===d?0:this._calculateStatValue(b,d):b.value=a):b.value=a},d.prototype._calculateStatValue=function(a,b){var c;return a.mediaType===this._config.MEDIA_TYPE.AUDIO?c=this._previousAudioStatistics[a.key]:a.mediaType===this._config.MEDIA_TYPE.VIDEO&&(c=this._previousVideoStatistics[a.key]),b-c},d.prototype._logStats=function(){var a=(new Date).getTime(),b='{"ID":"'+this._call.getCallId().slice(0,4)+'",';b+='"TS":"'+a+'",',this._statisticsLog.forEach(function(a,c){b+=a.getAlias()+":"+a.getValue(),c=c===this._statisticsLog.length-1,b+=c?"}":","}.bind(this)),c.Base.Logger.debug(c.Base.LoggerTags.CALL_STATISTICS,b)},d.prototype.stop=function(){this.isStarted?(this.isStarted=!1,this._cleanStatistics(),clearInterval(this._interval)):c.Base.Logger.warn(c.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger is already stopped")},d.prototype._saveStatistics=function(a,b){this._previousAudioStatistics=a,this._previousVideoStatistics=b},d.prototype._cleanStatistics=function(){this._previousAudioStatistics=a,this._previousVideoStatistics=a,this._statisticsLog.forEach(function(b){b.value=a})},d.prototype._statHasPreviousValue=function(a){return a.mediaType===this._config.MEDIA_TYPE.AUDIO?!!c.Base.Utils.isDefined(this._previousAudioStatistics)&&c.Base.Utils.isDefined(this._previousAudioStatistics[a.key]):a.mediaType===this._config.MEDIA_TYPE.VIDEO?!!c.Base.Utils.isDefined(this._previousVideoStatistics)&&c.Base.Utils.isDefined(this._previousVideoStatistics[a.key]):void 0},d.prototype._initialize=function(){c.Base.Utils.isDefined(this._statisticsLog)||(this._statisticsLog=[],Object.keys(this._config.CALCULATED_AUDIO_STATS).forEach(function(a){this._statisticsLog.push(new c.Base.StatisticLog(a,this._config.CALCULATED_AUDIO_STATS[a],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_AUDIO_STATS).forEach(function(a){this._statisticsLog.push(new c.Base.StatisticLog(a,this._config.INSTANT_AUDIO_STATS[a],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.INSTANT))},this),Object.keys(this._config.CALCULATED_VIDEO_STATS).forEach(function(a){this._statisticsLog.push(new c.Base.StatisticLog(a,this._config.CALCULATED_VIDEO_STATS[a],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_VIDEO_STATS).forEach(function(a){this._statisticsLog.push(new c.Base.StatisticLog(a,this._config.INSTANT_VIDEO_STATS[a],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.INSTANT))},this))},c.Base.CallStatisticsLogger=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CallStatisticsLoggerConfig={INTERVAL_IN_MILLIS:1e4,MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"},VALUE_TYPE:{INSTANT:"instant",CALCULATED:"calculated"},CALCULATED_AUDIO_STATS:{packetsReceived:"AI_PR",bytesReceived:"AI_BR",packetLossTotalReceived:"AI_PL",totalAudioEnergyReceived:"AI_TE",packetsTransmitted:"AO_PT",bytesTransmitted:"AO_BT",totalAudioEnergyTransmitted:"AO_TE"},CALCULATED_VIDEO_STATS:{packetsReceived:"VI_PR",bytesReceived:"VI_BR",packetLossTotalReceived:"VI_PL",framesReceived:"VI_FR",firCountReceived:"VI_FC",pliCountReceived:"VI_PC",nackCountReceived:"VI_NC",packetsTransmitted:"VO_PT",bytesTransmitted:"VO_BT",framesTransmitted:"VO_FT",firCountTransmitted:"VO_FC",pliCountTransmitted:"VO_PC",nackCountTransmitted:"VO_NC"},INSTANT_AUDIO_STATS:{jitterMillisecondsReceived:"AI_JR",audioLevelReceived:"AI_LR",audioLevelTransmitted:"AO_LT",roundTripTimeMilliseconds:"AO_RT"},INSTANT_VIDEO_STATS:{jitterMillisecondsReceived:"VI_JR",widthReceived:"VI_WR",heightReceived:"VI_HR",availableReceiveBitrate:"VI_AB",widthTransmitted:"VO_WT",heightTransmitted:"VO_HT",availableTransmitBitrate:"VO_AB",roundTripTimeMillis:"VO_RT",totalEncodeTime:"VO_TE",totalDecodeTime:"VI_TD",framesEncoded:"VO_FE",framesDecoded:"VI_FD"}}}(),function(){"use strict";(AvayaClientServices||{}).Base.CandidatePairStatistics=function(a,b){this.local=a,this.remote=b}}(),function(a){"use strict";function b(a,b,c,d){this.address=a,this.port=b,this.protocol=c,this.type=d}b.prototype={toString:function(){return"[address: "+this.address+"; port: "+this.port+"; protocol: "+this.protocol+"; type: "+this.type+"]"}},a.Base.CandidateStatistics=b}(AvayaClientServices||{}),function(a){"use strict";function c(b,c,d){this._tlsOrTcpFound=!1,a.Base.RTCConnectionProvider.call(this,b,c,d),this._statsParser=new a.Base.EdgeRTCStatsReportParser}(c.prototype=Object.create(a.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(b){a.Base.RTCConnectionProvider.prototype.addStream.call(this,b)},c.prototype.removeStream=function(b){a.Base.RTCConnectionProvider.prototype.removeStream.call(this,b)},c.prototype.createPeerConnection=function(c){var d;c&&!b.isEmptyObject(c)?(c.bundlePolicy="max-compat",this._tlsOrTcpFound=!1,0<c.iceServers.length&&(Array.isArray(c.iceServers[0].urls)?(c.iceServers[0].urls.length>(d=c.iceServers[0].urls.filter(function(a){return a.includes("turn:")&&a.includes("?transport=udp")})).length&&(this._tlsOrTcpFound=!0),c.iceServers[0].urls=d):c.iceServers[0].urls.includes("stun:")&&(c.iceServers[0].urls=[])),a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,c)):a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,{bundlePolicy:"max-compat",iceTransportPolicy:"all",iceServers:[]}),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this)},c.prototype.onAddStreamInternal=function(b){a.Base.RTCConnectionProvider.prototype.onAddStreamInternal.call(this,b)},c.prototype._getDTMFSender=function(){return null},c.prototype.stopStream=function(b){a.Base.RTCConnectionProvider.prototype.stopStream.call(this,b)},c.prototype.stopAllStreams=function(){a.Base.RTCConnectionProvider.prototype.stopAllStreams.call(this)},c.prototype._enableDisableRemoteStreams=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteStreams.call(this,b)},c.prototype._enableDisableLocalStreams=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableLocalStreams.call(this,b)},c.prototype._enableDisableLocalAudioStreams=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableLocalAudioStreams.call(this,b)},c.prototype._enableDisableLocalVideoStreams=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableLocalVideoStreams.call(this,b)},c.prototype._enableDisableRemoteVideoStreams=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteVideoStreams.call(this,b)},c.prototype._enableDisableRemoteAudioStream=function(b){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteAudioStream.call(this,b)},c.prototype._throwSdpError=function(){this._tlsOrTcpFound?this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found. This browser doesn't support TCP or TLS TURN."}):this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TRANSPORT_ERROR,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},c.prototype._answerError=function(b,c){var d;0===this._iceCandidates.length&&this._tlsOrTcpFound?(d={errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"Error while setting answer as local description: this browser doesn't support TCP or TLS TURN."},a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+d),c(d)):(a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+b),c(b))},c.prototype.addTrack=function(b,c){a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+b.kind+" : "+b.id),a.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,b,c),c.addTrack(b)},c.prototype.removeLocalAudioTrack=function(){this._pc.getLocalStreams().forEach(function(a){a.getAudioTracks().forEach(function(b){b.stop(),a.removeTrack(b)})})},c.prototype.isRTCRtpSenderSupported=function(){return a.Base.RTCConnectionProvider.prototype.isRTCRtpSenderSupported()},c.prototype.adjustVideoConstraints=function(a,c,d){return b.Deferred().reject("Video constraints is NOT support by Edge").promise()},a.Base.EdgeRTCConnectionProvider=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.EdgeRTCConnectionProvider.Constants={RTC_STATS_TYPE:{INBOUNDRTP:"inboundrtp",OUTBOUNDRTP:"outboundrtp"}}}(),function(b){"use strict";function c(){b.Base.AbstractRTCStatsReportParser.call(this),this._inboundStatsType=b.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUNDRTP,this._outboundStatsType=b.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUNDRTP}(c.prototype=Object.create(b.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(a,b,c){0<a.frameHeight||-1!==a.trackIdentifier.search("video")?this.processVideoTrackStats(a,c):this.processAudioTrackStats(a,b)},c.prototype.processInboundGenericStats=function(a,c){b.Base.Utils.isDefined(a.packetsReceived)&&(c.packetsReceived=a.packetsReceived),b.Base.Utils.isDefined(a.bytesReceived)&&(c.bytesReceived=a.bytesReceived),b.Base.Utils.isDefined(a.packetsLost)&&(c.packetLossTotalReceived=a.packetsLost),b.Base.Utils.isDefined(a.jitter)&&(c.jitterMillisecondsReceived=1e3*a.jitter),b.Base.Utils.isDefined(a.fractionLost)&&(c.packetsLossFractionReceived=a.fractionLost),b.Base.Utils.isDefined(a.codecId)&&(c.codec=a.codecId)},c.prototype.processInboundStats=function(c,d,e,f){c.isRemote||(b.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,c,d,e,f),d.bytesReceived=a,e.bytesReceived=a)},c.prototype.processOutboundStats=function(c,d,e,f){c.isRemote||(b.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,c,d,e,f),d.bytesTransmitted=a,e.bytesTransmitted=a)},c.prototype.processAudioTrackStats=function(a,b){},c.prototype.getMediaType=function(a,c){return a.codecId?"H264"===a.codecId?b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:"H264"===c[a.associateStatsId].codecId?b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO},b.Base.EdgeRTCStatsReportParser=c}(AvayaClientServices),function(b){"use strict";function c(a,c,d){b.Base.AbstractRTCConnectionProvider.call(this,a,c,d),this._statsParser=new b.Base.FirefoxRTCStatsReportParser}var d=/candidate:(\w{1,32}) (\d{1,5}) (udp|UDP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+/;(c.prototype=Object.create(b.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(a){b.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,a),a.getTracks().forEach(function(b){this.addTrack(b,a)}.bind(this))},c.prototype.removeStream=function(a){this._pc&&this._pc.getSenders().forEach(function(c){a.getTracks().forEach(function(a){c&&c.track&&a.id===c.track.id&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+a.kind+" : "+a.id),a.stop(),this._pc.removeTrack(c))}.bind(this))}.bind(this))},c.prototype.createPeerConnection=function(a){b.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,a),this._pc.ontrack=this.onTrackInternal.bind(this)},c.prototype._getDTMFSender=function(){return b.Base.Utils.isDefined(this._dtmfSender)||this._pc.getSenders().forEach(function(a){a.track&&a.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&a.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=a.dtmf)}.bind(this)),this._dtmfSender},c.prototype.stopAllStreams=function(){var a;this._pc&&(a=!1,this._pc.getSenders().forEach(function(c){c.track&&(c.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(a=!0),c.track.stop(),this._pc.removeTrack(c))}.bind(this)),a||this._pc.getLocalStreams().forEach(function(a){a.getVideoTracks().forEach(function(a){a.stop()})}),this._pc.getReceivers().forEach(function(a){a.track&&a.track.stop()}.bind(this)))},c.prototype._enableDisableRemoteStreams=function(a){this._pc.getReceivers().forEach(function(c){c.track&&c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling remote ":"Disabling remote ")+c.track.kind+" track: "+c.track.id),c.track.enabled=a)})},c.prototype._enableDisableLocalStreams=function(a){this._pc.getSenders().forEach(function(c){c.track&&c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling local ":"Disabling local ")+c.track.kind+" track: "+c.track.id),c.track.enabled=a)})},c.prototype._enableDisableLocalAudioStreams=function(a){this._pc.getSenders().forEach(function(c){c.track&&c.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local audio track: "+c.track.id),c.track.enabled=a):b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+c.track.id+":"+c.track.readyState))}.bind(this))},c.prototype._enableDisableLocalVideoStreams=function(a){this._pc.getSenders().forEach(function(c){c.track&&c.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?c.track.enabled===a&&!a||(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local video track: "+c.track.id+":"+c.track.readyState),c.track.enabled=a):b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+c.track.id+":"+c.track.readyState))}.bind(this))},c.prototype.setLocalVideoDirection=function(a){this._pc.getTransceivers().forEach(function(c){!c.stopped&&c.sender.track&&c.sender.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&c.currentDirection!==a&&(c.sender.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+a+":"+c.sender.track.id+":"+c.sender.track.readyState),c.direction=a):b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+c.sender.track.id+":"+c.sender.track.readyState))}.bind(this))},c.prototype.isSetLocalVideoDirectionSupported=function(){return!0},c.prototype.hasVideoTrackStopStreaming=function(a){return 0!==this._pc.getTransceivers().filter(function(c){return!!c.sender.track&&c.sender.track.id===a.id&&(c.stopped||c.sender.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED)}.bind(this)).length},c.prototype._enableDisableRemoteVideoStreams=function(a){this._pc.getReceivers().forEach(function(c){c.track&&c.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote video track: "+c.track.id),c.track.enabled=a)}.bind(this))},c.prototype._enableDisableRemoteAudioStream=function(a){this._pc.getReceivers().forEach(function(c){c.track&&c.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&c.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote audio track: "+c.track.id),c.track.enabled=a)}.bind(this))},c.prototype.addTrack=function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+a.kind+" : "+a.id+":"+a.readyState),b.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,a,c),c=this._pc.addTrack(a,c),a.kind===b.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&b.Base.Utils.isDefined(c.dtmf)&&(this._dtmfSender=c.dtmf)},c.prototype.removeIfDoesNotSupportReplaceTrack=function(a){this._pc.getSenders().forEach(function(c){c.track&&c.track.id===a.id&&(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+c.track.id),c.track.stop())}.bind(this))},c.prototype.enableRemoteVideoTrack=function(a,c){var d=0;this._pc.getReceivers().forEach(function(a){a.track&&a.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(d++,a.track.id!==c.id&&a.track.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(a.track.stop(),b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing remote video track  "+a.track.id+" with "+c.id)))}),0===d?(b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding remote video track  "+c.id),this.addTrack(c,a)):0===a.getVideoTracks().length&&a.addTrack(c)},c.prototype.isRTCRtpSenderSupported=function(){return!0},c.prototype.rollbackLocalOfferState=function(){"stable"!==this._pc.signalingState&&this._pc.setLocalDescription({type:"rollback"})},c.prototype.adjustVideoConstraints=function(a,c,d,e){return 360<=c&&c<=480&&(a=640,c=360),b.Base.AbstractRTCConnectionProvider.prototype.adjustVideoConstraints.call(this,a,c,d,e)},c.prototype.parseIceRelayCandidate=function(b,c){return b=d.exec(b),b?{foundation:b[1],component:b[2],networkId:a}:a},c.prototype.addTransceiverIfNeeded=function(a){if(a){var c=!1;if(this._pc.getTransceivers().forEach(function(a){a.receiver&&a.receiver.track&&a.receiver.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(c=!0),a.sender&&a.sender.track&&a.sender.track.kind===b.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(c=!0)}),!c)return b.Base.Logger.debug(b.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+a),this._pc.addTransceiver("video",{direction:a}),!0}return!1},b.Base.FirefoxRTCConnectionProvider=c}(AvayaClientServices),function(a){"use strict";function b(){a.Base.AbstractRTCStatsReportParser.call(this)}(b.prototype=Object.create(a.Base.AbstractRTCStatsReportParser.prototype)).processOutboundVideoStats=function(b,c){a.Base.AbstractRTCStatsReportParser.prototype.processOutboundVideoStats.call(this,b,c),a.Base.Utils.isDefined(b.bitrateMean)&&(c.actualBitRateTransmitted=b.bitrateMean),a.Base.Utils.isDefined(b.framerateMean)&&(c.actualFrameRateTransmitted=b.framerateMean),a.Base.Utils.isDefined(b.roundTripTime)&&(c.roundTripTimeMillis=1e3*b.roundTripTime)},b.prototype.processInboundVideoStats=function(b,c){a.Base.AbstractRTCStatsReportParser.prototype.processInboundVideoStats.call(this,b,c),a.Base.Utils.isDefined(b.bitrateMean)&&(c.actualBitRateReceived=b.bitrateMean),a.Base.Utils.isDefined(b.framerateMean)&&(c.actualFrameRateReceived=b.framerateMean)},b.prototype.processOutboundStats=function(b,c,d,e){!0!==b.isRemote&&a.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,b,c,d,e)},b.prototype.processInboundStats=function(b,c,d,e){!0===b.isRemote?this.processOutboundStats(b,c,d,e):a.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,b,c,d,e)},a.Base.FirefoxRTCStatsReportParser=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.ObservableRTCEvents={ICE_CONNECTION_STATE_CHANGED:"rtcProvider.iceConnectionStateChanged",LOCAL_AUDIO_TRACK_ENDED:"rtcProvider.localAudioTrackEnded"}}(),function(c){"use strict";function d(b,d,e){c.Base.AbstractRTCConnectionProvider.call(this,b,d,e),this.isAvailable()&&(this._statsParser=new c.Base.RTCStatsReportParser,this._iceDisconnectedTimeoutId=a,this._iceConnectionStateFailed=!1)}var e=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .* network-id (\d+)/;(d.prototype=Object.create(c.Base.AbstractRTCConnectionProvider.prototype)).updatePeerConfiguration=function(a,b){c.Base.AbstractRTCConnectionProvider.prototype.updatePeerConfiguration.call(this,a,b)},d.prototype.addStream=function(a){c.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,a),this._isRTCRtpSenderSupported?a.getTracks().forEach(function(b){this.addTrack(b,a)}.bind(this)):this._pc.addStream(a)},d.prototype.addTrack=function(a,b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+a.kind+" : "+a.id+":"+a.readyState),c.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,a,b),b=this._pc.addTrack(a,b),a.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&c.Base.Utils.isDefined(b.dtmf)&&(this._dtmfSender=b.dtmf)},d.prototype.removeStream=function(a){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(b){a.getTracks().forEach(function(a){b&&b.track&&a.id===b.track.id&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+a.kind+" : "+a.id),a.stop(),this._pc.removeTrack(b))}.bind(this))}.bind(this)):this._pc.removeStream(a))},d.prototype.createPeerConnection=function(a){c.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,a),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this),this._isRTCRtpSenderSupported="function"==typeof this._pc.getSenders},d.prototype.onAddStreamInternal=function(a){var b=a.stream;b&&(b.onaddtrack=this.onAddTrackInternal.bind(this),b.onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddStream&&this.onAddStream(a.stream))},d.prototype._getDTMFSender=function(){return c.Base.Utils.isDefined(this._dtmfSender)||(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(a){a.track&&a.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&a.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=a.dtmf)}.bind(this)):this._pc.getLocalStreams().forEach(function(a){a=a.getAudioTracks()[0],c.Base.Utils.isDefined(a)&&(this._dtmfSender=this._pc.createDTMFSender(a))}.bind(this))),this._dtmfSender},d.prototype.stopAllStreams=function(){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(a){a.track&&(a.track.stop(),this._pc.removeTrack(a))}.bind(this)):this._pc.getLocalStreams().forEach(function(a){a.getAudioTracks().forEach(function(a){a.stop()}),a.getVideoTracks().forEach(function(a){a.stop()}),this._pc.removeStream(a)}.bind(this)),this._pc.getRemoteStreams().forEach(function(a){a.getAudioTracks().forEach(function(a){a.stop()}),a.getVideoTracks().forEach(function(a){a.stop()})}))},d.prototype._enableDisableRemoteStreams=function(a){this._pc.getRemoteStreams().forEach(function(b){b.getAudioTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote audio track: "+b.id),b.enabled=a)}),b.getVideoTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote video track: "+b.id),b.enabled=a)})})},d.prototype._enableDisableLocalStreams=function(a){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(b){b.track&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling local ":"Disabling local ")+b.track.kind+" track: "+b.track.id),b.track.enabled=a)}):this._pc.getLocalStreams().forEach(function(b){b.getAudioTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local audio track: "+b.id),b.enabled=a)}),b.getVideoTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local video track: "+b.id),
b.enabled=a)})})},d.prototype._enableDisableLocalAudioStreams=function(a){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local audio track: "+b.track.id),b.track.enabled=a):c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+b.track.id+":"+b.track.readyState))}.bind(this)):this._pc.getLocalStreams().forEach(function(b){b.getAudioTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local audio track: "+b.id),b.enabled=a)})})},d.prototype._enableDisableLocalVideoStreams=function(a){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(b.track.enabled=a,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local video track: "+b.track.id+":"+b.track.readyState)):(b.track.enabled=a,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+b.track.id+":"+b.track.readyState)))}.bind(this)):this._pc.getLocalStreams().forEach(function(b){b.getVideoTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local video track: "+b.id),b.enabled=a)})})},d.prototype._enableDisableRemoteVideoStreams=function(a){this._pc.getRemoteStreams().forEach(function(b){b.getVideoTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote video track: "+b.id),b.enabled=a)})})},d.prototype._enableDisableRemoteAudioStream=function(a){this._pc.getRemoteStreams().forEach(function(b){b.getAudioTracks().forEach(function(b){b.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote audio track: "+b.id),b.enabled=a)})})},d.prototype.removeIfDoesNotSupportReplaceTrack=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.id===a.id&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+b.track.id),b.track.stop(),"function"!=typeof b.replaceTrack&&this._pc.removeTrack(b))}.bind(this))},d.prototype.replaceLocalMediaTrack=function(a,d){var e=b.Deferred(),f=0,g=function(b){b&&this._pc.removeTrack(b),d?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+a.kind+" track  "+a.id),this.addTrack(a,d),d.addTrack(a),this.monitorAudioTrack(a),e.resolve(!0)):(c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+a.kind+" track  "+a.id+" due to missing media stream"),e.reject("Missing local media stream"))}.bind(this);return this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===a.kind&&"function"==typeof b.replaceTrack&&(f++,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+a.kind+" track  "+b.track.id+" with "+a.id),b.replaceTrack(a).then(function(){d&&(d.addTrack(a),this.monitorAudioTrack(a)),e.resolve(!1)}.bind(this))["catch"](function(d){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+a.kind+" track instead due to "+d),b.track.stop(),g(b)}))}.bind(this)),0===f&&g(),e.promise()},d.prototype.getStats=function(){if(this.isRTCRtpSenderSupported()){var a=b.Deferred(),d=new c.Base.AudioStatistics,e=new c.Base.VideoStatistics,f={},g=[];return this._pc.getSenders().forEach(function(a){a.track&&a.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&g.push(a.getStats().then(function(a){this._statsParser.parse(a,d,e,f)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(a){a.track&&a.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&g.push(a.getStats().then(function(a){this._statsParser.parse(a,d,e,f)}.bind(this)))}.bind(this)),b.when.apply(this,g).then(function(){a.resolve({audioStatistics:d,videoStatistics:e,iceCandidateStatistics:f})},function(b){c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+b),a.reject(b)}),a.promise()}if(0===RTCPeerConnection.prototype.getStats.length)return this._pc.getStats().then(function(a){return this._statsParser.parse(a)}.bind(this))["catch"](function(a){return c.Base.Logger.error(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+a),Promise.reject(a)});var h=b.Deferred();return this._pc.getStats(function(a){a=this._statsParser.fallback(a),h.resolve(a)}),h.promise()},d.prototype.isRTCRtpSenderSupported=function(){return this._isRTCRtpSenderSupported},d.prototype.parseIceRelayCandidate=function(b,c){return b=e.exec(b),b?c?{foundation:c.foundation||b[1],component:c.component||b[2],networkId:b[3]}:{foundation:b[1],component:b[2],networkId:b[3]}:a},d.prototype.close=function(){c.Base.AbstractRTCConnectionProvider.prototype.close.call(this),clearTimeout(this._iceDisconnectedTimeoutId)},d.prototype._oniceConnectionStateChange=function(a){c.Base.AbstractRTCConnectionProvider.prototype._oniceConnectionStateChange.call(this,a),this._pc.iceConnectionState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?(clearTimeout(this._iceDisconnectedTimeoutId),this._iceDisconnectedTimeoutId=setTimeout(function(){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Forced iceConnectionState to failed ["+this._pc.iceGatheringState+"]"),this._iceConnectionStateFailed=!0,this.trigger(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED])}.bind(this),15e3)):this._pc.iceConnectionState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED?clearTimeout(this._iceDisconnectedTimeoutId):this._pc.iceConnectionState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED&&(clearTimeout(this._iceDisconnectedTimeoutId),this._iceConnectionStateFailed=!1)},d.prototype.getIceConnectionState=function(){return this._pc?!0===this._iceConnectionStateFailed&&this._pc.iceConnectionState===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED:this._pc.iceConnectionState:a},c.Base.RTCConnectionProvider=d}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={create:function(c,d,e){var f=b.Base.Utils.getBrowserType();return f===b.Base.BrowserType.CHROME?new b.Base.RTCConnectionProvider(c,d,e):f===b.Base.BrowserType.EDGE?new b.Base.EdgeRTCConnectionProvider(c,d,e):f===b.Base.BrowserType.SAFARI?new b.Base.SafariRTCConnectionProvider(c,d,e):f===b.Base.BrowserType.FIREFOX?new b.Base.FirefoxRTCConnectionProvider(c,d,e):a}},b.Base.RTCConnectionProviderFactory=c}(AvayaClientServices),function(b){"use strict";function c(){b.Base.AbstractRTCStatsReportParser.call(this)}(c.prototype=Object.create(b.Base.AbstractRTCStatsReportParser.prototype)).fallback=function(c){var d,e,f,g,h,i,j;return c.result().forEach(function(a){var b=a.stat("mediaType");"ssrc"===a.type&&-1<a.id.indexOf("send")&&"audio"===b&&(d=a),"ssrc"===a.type&&-1<a.id.indexOf("send")&&"video"===b&&(f=a),"ssrc"===a.type&&-1<a.id.indexOf("recv")&&"audio"===b&&(e=a),"ssrc"===a.type&&-1<a.id.indexOf("recv")&&"video"===b&&(g=a)}),e&&d&&(h={bytesReceived:parseInt(e.stat("bytesReceived")),packetsReceived:parseInt(e.stat("packetsReceived")),packetsLost:parseInt(e.stat("packetsLost")),googJitterReceived:parseInt(e.stat("googJitterReceived"))},i={bytesSent:parseInt(d.stat("bytesSent")),packetsSent:parseInt(d.stat("packetsSent")),googRtt:parseInt(d.stat("googRtt")),packetsLost:parseInt(d.stat("packetsLost"))},""===d.stat("packetsLost")&&(i.packetsLost=0),""===d.stat("googRtt")&&(i.googRtt=0),i=new b.Base.AudioStatistics(h.bytesReceived,i.bytesSent,h.packetsReceived,i.packetsSent,i.googRtt,i.packetsLost,h.packetsLost,h.googJitterReceived)),g&&f&&(j={bytesReceived:parseInt(g.stat("bytesReceived")),actualBitRateReceived:a,packetsReceived:parseInt(g.stat("packetsReceived")),packetsLost:parseInt(g.stat("packetsLost")),googFrameRateReceived:parseInt(g.stat("googFrameRateReceived"))},b.Base.Utils.isUndefined(j.packetsLost)&&(j.packetsLost=0),b.Base.Utils.isUndefined(j.packetsReceived)&&(j.packetsReceived=0),0===j.packetsReceived?j.packetsLossFractionReceived=0:j.packetsLossFractionReceived=g.stat("packetsLost")/g.stat("packetsReceived"),h={bytesSent:parseInt(f.stat("bytesSent")),actualBitRateTransmitted:a,packetsSent:parseInt(f.stat("packetsSent")),packetsLost:parseInt(f.stat("packetsLost")),googFrameRateSent:parseInt(f.stat("googFrameRateSent"))},b.Base.Utils.isUndefined(h.packetsLost)&&(h.packetsLost=0),b.Base.Utils.isUndefined(h.packetsSent)&&(h.packetsSent=0),0===h.packetsSent?h.packetsLossFractionTransmitted=0:h.packetsLossFractionTransmitted=f.stat("packetsLost")/f.stat("packetsSent"),j=new b.Base.VideoStatistics(h.bytesSent,j.bytesReceived,h.actualBitRateTransmitted,j.actualBitRateReceived,h.packetsSent,j.packetsReceived,h.packetsLost,j.packetsLost,h.packetsLossFractionTransmitted,j.packetsLossFractionReceived,h.googFrameRateSent,j.googFrameRateReceived)),{audioStatistics:i,videoStatistics:j}},b.Base.RTCStatsReportParser=c}(AvayaClientServices),function(c){"use strict";function d(b,d,e){this._sdkStream=a,this._foundCandidates=!1,c.Base.AbstractRTCConnectionProvider.call(this,b,d,e),this._statsParser=new c.Base.SafariRTCStatsReportParser}var e=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .*/;(d.prototype=Object.create(c.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(a){c.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,a),a.getTracks().forEach(function(b){this.addTrack(b,a)}.bind(this))},d.prototype.removeStream=function(a){this._pc&&this._pc.getSenders().forEach(function(b){a.getTracks().forEach(function(a){b&&b.track&&a.id===b.track.id&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+a.kind+" : "+a.id),a.stop(),this._pc.removeTrack(b))}.bind(this))}.bind(this))},d.prototype.createPeerConnection=function(a){c.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,a),this._pc.ontrack=this.onTrackInternal.bind(this)},d.prototype._getDTMFSender=function(){return this._dtmfSender!==a&&this._pc.getSenders().forEach(function(b){b.track!==a&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(this._dtmfSender=b.dtmf)}),this._dtmfSender},d.prototype.stopAllStreams=function(){this._pc&&(this._pc.getSenders().forEach(function(a){a.track&&(a.track.stop(),this._pc.removeTrack(a))}.bind(this)),this._pc.getReceivers().forEach(function(a){a.track&&a.track.stop()}.bind(this)))},d.prototype._enableDisableRemoteStreams=function(a){this._pc.getReceivers().forEach(function(b){b.track&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling remote ":"Disabling remote ")+b.track.kind+" track: "+b.track.id),b.track.enabled=a)})},d.prototype._enableDisableLocalStreams=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling local ":"Disabling local ")+b.track.kind+" track: "+b.track.id),b.track.enabled=a)})},d.prototype._enableDisableLocalAudioStreams=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local audio track: "+b.track.id),b.track.enabled=a):c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+b.track.id+":"+b.track.readyState))}.bind(this))},d.prototype._enableDisableLocalVideoStreams=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" local video track: "+b.track.id),b.track.enabled=a):c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+b.track.id+":"+b.track.readyState))}.bind(this))},d.prototype._enableDisableRemoteVideoStreams=function(a){this._pc.getReceivers().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(a?"Enabling":"Disabling")+" remote video track: "+b.track.id),b.track.enabled=a)}.bind(this))},d.prototype.addTrack=function(a,b){c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+a.kind+" : "+a.id),c.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,a,b),b=this._pc.addTrack(a,b),a.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&c.Base.Utils.isDefined(b.dtmf)&&(this._dtmfSender=b.dtmf)},d.prototype.replaceLocalVideoTrack=function(a){this._pc.getSenders().forEach(function(b){b.track&&b.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local video track "+b.track.id+" with "+a.id),b.track.stop(),b.replaceTrack(a))})},d.prototype.isRTCRtpSenderSupported=function(){return!0},d.prototype.addTransceiverIfNeeded=function(a){if(a){var b=!1;if(this._pc.getTransceivers().forEach(function(a){a.receiver&&a.receiver.track&&a.receiver.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(b=!0),a.sender&&a.sender.track&&a.sender.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(b=!0)}),!b)return c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+a),this._pc.addTransceiver("video",{direction:a}),!0}return!1},d.prototype.parseIceRelayCandidate=function(b,c){return b=e.exec(b),b?{foundation:b[1],component:b[2],networkId:a}:a},d.prototype.setLocalVideoDirection=function(a){this._pc.getTransceivers().forEach(function(b){!b.stopped&&b.sender.track&&b.sender.track.kind===c.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&b.currentDirection!==a&&(b.sender.track.readyState===c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+a+":"+b.sender.track.id+":"+b.sender.track.readyState),b.direction=a):c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+b.sender.track.id+":"+b.sender.track.readyState))}.bind(this))},d.prototype.isSetLocalVideoDirectionSupported=function(){return!0},d.prototype.removeIfDoesNotSupportReplaceTrack=function(a){this._pc.getTransceivers().forEach(function(b){b.sender.track&&b.sender.track.id===a.id&&b.sender.track.stop()})},d.prototype.replaceLocalMediaTrack=function(a,d){var e=b.Deferred(),f=0,g=function(){d?(c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+a.kind+" track  "+a.id),this.addTrack(a,d),d.addTrack(a),e.resolve()):(c.Base.Logger.warn(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+a.kind+" track  "+a.id+" due to missing media stream"),e.reject("Missing local media stream"))}.bind(this);return this._pc.getTransceivers().forEach(function(b){b.sender.track&&b.sender.track.kind===a.kind&&(f++,c.Base.Logger.debug(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+a.kind+" track  "+b.sender.track.id+" with "+a.id),b.sender.track.stop(),b.sender.replaceTrack(a).then(function(){d&&d.addTrack(a),b.direction===c.Services.Call.MediaDirection.INACTIVE&&(b.direction=c.Services.Call.MediaDirection.SEND_RECV),e.resolve()})["catch"](function(b){c.Base.Logger.info(c.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+a.kind+" track instead due to "+b),g()}))}),0===f&&g(),e.promise()},c.Base.SafariRTCConnectionProvider=d}(AvayaClientServices),function(b){"use strict";function c(){b.Base.AbstractRTCStatsReportParser.call(this)}(c.prototype=Object.create(b.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(b,c,d){b.frameHeight!==a?this.processVideoTrackStats(b,d):this.processAudioTrackStats(b,c)},c.prototype.processCandidatePairStats=function(a,c,d,e){var f,g,h;"succeeded"===a.state&&(f=this._localCandidates[a.localCandidateId],g=this._remoteCandidates[a.remoteCandidateId],h=a.ID||a.id,f&&g&&(e[h]=new b.Base.CandidatePairStatistics(f,g)),this.getCandidatePairMediaType(a,c,d)===b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(a,d))},c.prototype.getMediaType=function(a,c){return a.type===b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP?a.mediaType:-1!==a.id.indexOf("Audio")?b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:b.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO},c.prototype.getCandidatePairMediaType=function(a,c,d){if(b.Base.Utils.isDefined(a.transportId))return this._audioTransportId===a.transportId?"audio":this._videoTransportId===a.transportId?"video":void 0},b.Base.SafariRTCStatsReportParser=c}(AvayaClientServices),function(b){"use strict";function c(b,c,d,e){this.key=b,this.value=a,this.valueType=e,this.mediaType=d,this.alias=c}c.prototype.getValue=function(){return b.Base.Utils.isDefined(this.value)?'"'+this.value+'"':'"undefined"'},c.prototype.getAlias=function(){return'"'+this.alias+'"'},b.Base.StatisticLog=c}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.VideoStatistics=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){this.bytesTransmitted=a,this.bytesReceived=b,this.actualBitRateTransmitted=c,this.actualBitRateReceived=d,this.packetsTransmitted=e,this.packetsReceived=f,this.packetLossTotalTransmitted=g,this.packetLossTotalReceived=h,this.packetsLossFractionTransmitted=i,this.packetsLossFractionReceived=j,this.actualFrameRateTransmitted=k,this.actualFrameRateReceived=l,this.framesEncoded=m,this.framesDecoded=n,this.codec=o,this.roundTripTimeMillis=p,this.heightTransmitted=r,this.heightReceived=q,this.widthTransmitted=t,this.widthReceived=s,this.firCountTransmitted=v,this.firCountReceived=u,this.pliCountTransmitted=x,this.pliCountReceived=w,this.framesTransmitted=y,this.framesReceived=z,this.nackCountTransmitted=B,this.nackCountReceived=A,this.availableTransmitBitrate=C,this.availableReceiveBitrate=D,this.jitterMillisecondsReceived=E,this.totalEncodeTime=F,this.totalDecodeTime=G}}(),function(b){"use strict";function c(c){this._isStarted=!1,this._initialDelay=b.Base.Utils.queryJSONObject(c,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,this._evaluationWindowDuration=b.Base.Utils.queryJSONObject(c,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this._delayOverloadThreshold=b.Base.Utils.queryJSONObject(c,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorOverloadThreshold")||200,this._delayWarningThreshold=b.Base.Utils.queryJSONObject(c,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorWarningThreshold")||40,this._evaluateInterval=500,this._accumulatedMeasurements=0,this._measurements=[],this._minimumMeasurements=a,this._setInterval=a,this.onPerformanceMonitorAlert=function(){}}c.prototype.start=function(){this._isStarted||(b.Base.Logger.debug(b.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor starting in - "+this._initialDelay+"s"),setTimeout(function(){this._isStarted=!0,this._minimumMeasurements=this._evaluationWindowDuration/this._evaluateInterval*1e3,this._setInterval=setInterval(this._measureRuntimeDelay.bind(this),this._evaluateInterval)}.bind(this),1e3*this._initialDelay))},c.prototype._measureRuntimeDelay=function(){var a,b,c;this._isStarted&&document.hasFocus()&&(c=Date.now(),setTimeout(function(c){a=Date.now(),b=a-c,this._registerMeasure(b)}.bind(this,c),0))},c.prototype._registerMeasure=function(a){this._measurements.push(a),this._accumulatedMeasurements+=a,this._measurements.length>=this._minimumMeasurements&&this._evaluate(this._measurements)},c.prototype._evaluate=function(a){var c=this._accumulatedMeasurements/a.length;a[a.length-1]>this._delayWarningThreshold&&this.onPerformanceMonitorAlert(b.Base.PerformanceAlertType.CPU_USAGE_WARNING),c>this._delayOverloadThreshold&&(c="JS Scheduling delay exceeds treshold - delay= "+Math.round(c)+"ms",this.onPerformanceMonitorAlert(b.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,c)),a=a.shift(),this._accumulatedMeasurements-=a},c.prototype.stop=function(){this._isStarted&&(this._isStarted=!1,this._measurements=[],clearInterval(this._setInterval),b.Base.Logger.debug(b.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor stopped"))},b.Base.RuntimePerformanceMonitor=c}(AvayaClientServices),function(b){"use strict";var c="m=audio",d="m=video",e="a=recvonly",f="a=sendonly",g="a=sendrecv",h="a=inactive",i="profile-level-id";b.Base.SDPUtil={updateAudioSdpInactive:function(a){return b.Base.SDPUtil.updateSdp(a,c,h)},updateAudioSdpRecvOnly:function(a){return b.Base.SDPUtil.updateSdp(a,c,e)},updateAudioSdpSendOnly:function(a){return b.Base.SDPUtil.updateSdp(a,c,f)},updateAudioSdpSendRecv:function(a){return b.Base.SDPUtil.updateSdp(a,c,g)},updateVideoSdpInactive:function(a){return b.Base.SDPUtil.updateSdp(a,d,h)},updateVideoSdpRecvOnly:function(a){return b.Base.SDPUtil.updateSdp(a,d,e)},updateVideoSdpSendOnly:function(a){return b.Base.SDPUtil.updateSdp(a,d,f)},updateVideoSdpSendRecv:function(a){return b.Base.SDPUtil.updateSdp(a,d,g)},updateSdp:function(a,b,e){if(-1===a.indexOf(b))return a;var f=a.indexOf(c),g=a.indexOf(d);return b===c?f<g?a.substring(0,f)+a.substring(f,g).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,e)+a.substring(g):a.substring(0,f)+a.substring(f).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,e):g<f?a.substring(0,g)+a.substring(g,f).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,e)+a.substring(f):a.substring(0,g)+a.substring(g).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,e)},rejectMedia:function(a,b){return-1===a.indexOf(b)?a:b===c?a.replace(/(m=audio)\s+(\d+)\s+(.*)/,"m=audio 0 $3"):b===d?a.replace(/(m=video)\s+(\d+)\s+(.*)/,"m=video 0 $3"):a},updateProfileLevelId:function(a,c){var d=a.indexOf(i);return-1<d&&(d=a.substring(d+i.length+1,d+i.length+1+6))!==c&&(a=a.replace(d,c),b.Base.Logger.debug(b.Base.LoggerTags.UTILS,"CHANGED the profile-level-id value of the SDP from:",d,"to:",c)),a},getProfileLevelId:function(b){var c=b.indexOf(i);return-1<c?b.substring(c+i.length+1,c+i.length+1+6):a},hasH264:function(a){var b=a.indexOf(d);if(-1===b)return!1;var e=a.indexOf(c);return null!==(b<e?a.substring(b,e):a.substring(b)).match(/a=rtpmap:\d+ H264\/\d+/)}}}(AvayaClientServices),function(b){"use strict";function c(b,c,d){this._data="",this._currentLineIndex=0,this._getSettingsFileVariable="function"==typeof b?b:a,this._setSettingsFileVariable="function"==typeof c?c:a,this._onAdditionalSettingsFileRequested="function"==typeof d?d:a}c.prototype.parse=function(a){return"string"!=typeof a||0===a.length||(this._data=a,this._currentLineIndex=0,this.proceed())},c.prototype.proceed=function(){for(var a,c=this._splitByLines(this._data),d=c.length,e=!0;this._currentLineIndex<d;this._currentLineIndex++)if(0!==(f=c[this._currentLineIndex].trim()).length&&"#"!==f.charAt(0)){var f=this._getLineArr(f);if(f.length){var g=f[0].toUpperCase(),h=f.slice(1);switch(g){case"SET":this._processSET(h);break;case"GOTO":0<=(a=this._processGOTO(h))&&(this._currentLineIndex=a);break;case"IF":0<=(a=this._processIF(h))&&(this._currentLineIndex=a);break;case"GET":this._currentLineIndex++,e=this._processGET(h);break;default:b.Base.Logger.warn(b.Base.LoggerTags.SETTINGS_FILE_PARSER,"SettingsFileParser: Unknown command",g)}}if(!e)return!1}return!0},c.prototype._splitByLines=function(a){return a.split(/\r\n|\r|\n/g)},c.prototype._trimSharp=function(a){return a.trim().replace(/^#+|#+$/g,"").trim()},c.prototype._getLineArr=function(a){var b=a.match(/("([^"]*)"|([^"\s]+))+(?=(\s*|\s*$))/g)||[];return b.length&&b.forEach(function(a,c,d){b[c]=a.replace(/"/g,"")}),b},c.prototype._processSET=function(a){var b,c;!this._setSettingsFileVariable||(b=a.length)&&(c=a[0],a=1<b?a[1]:"",this._setSettingsFileVariable(c,a))},c.prototype._processGET=function(a){return!this._onAdditionalSettingsFileRequested||!a.length||(this._onAdditionalSettingsFileRequested(a[0]),!1)},c.prototype._processGOTO=function(a){var b=-1;if(a.length)for(var c,d=a[0],e=this._splitByLines(this._data),f=e.length,g=0;g<f;g++)if(c=e[g].trim(),"#"===c.charAt(0)&&"#"!==c.charAt(1)&&d===this._trimSharp(c)){b=g;break}return b},c.prototype._processIF=function(a){if(!this._getSettingsFileVariable)return-1;if(a.length<5)return-1;var b=a[0],c=a[1],d=a[2],e=a[3],a=a[4];return b.toString().length<=1||"$"!==b.charAt(0)?-1:"SEQ"!==c.toUpperCase()?-1:0===d.toString().length?-1:"GOTO"!==e.toUpperCase()?-1:(b=b.substr(1).toUpperCase(),this._getSettingsFileVariable(b)===d?this._processGOTO([a]):-1)},b.Base.SettingsFileParser=c}(AvayaClientServices),function(a){"use strict";function b(){this._handlers={},this.currentState=null}a.Base.SimpleFsm=function(){},b.prototype={handleEvent:function(b){var c;b.stringValue?this.currentState&&this._handlers?this._handlers[this.currentState.stringValue]&&this._handlers[this.currentState.stringValue][b.stringValue]?(a.Base.Logger.debug(a.Base.LoggerTags.FSM,"Executing handler for state "+this.currentState.stringValue+" and event "+b.stringValue+" "+this._handlers[this.currentState.stringValue][b.stringValue].name),c=this._handlers[this.currentState.stringValue][b.stringValue](b),a.Base.Logger.debug(a.Base.LoggerTags.FSM,"Executed handler "+this._handlers[this.currentState.stringValue][b.stringValue].name),c&&c.nextState&&(a.Base.Logger.debug(a.Base.LoggerTags.FSM,"Next state: "+c.nextState.stringValue),this.currentState=c.nextState),c&&c.nextEvent&&(a.Base.Logger.debug(a.Base.LoggerTags.FSM,"Next event: "+c.nextEvent.stringValue),this.handleEvent(c.nextEvent))):a.Base.Logger.error(a.Base.LoggerTags.FSM,"No handler bound for state "+this.currentState.stringValue+" and event "+b.stringValue):a.Base.Logger.error(a.Base.LoggerTags.FSM,"State machine's state was not initialized"):a.Base.Logger.error(a.Base.LoggerTags.FSM,"Unknown event: "+b)},registerHandler:function(a,b,c){if(this._handlers[a.stringValue]||(this._handlers[a.stringValue]={}),this._handlers[a.stringValue][b.stringValue])throw"Duplicate FSM registration state "+a.stringValue+" event "+b.stringValue;this._handlers[a.stringValue][b.stringValue]=c},registerNoOpHandler:function(a,b){this.registerHandler(a,b,function(){})},start:function(a){this.currentState=a}},a.Base.SimpleFsm.SimpleFsm=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.stringValue=a,this.data=b}b.prototype={},a.Base.SimpleFsm.SimpleFsmEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.stringValue=a}b.prototype={},a.Base.SimpleFsm.SimpleFsmState=b}(AvayaClientServices),function(b){"use strict";var c="AVAYA_JSCSDK_1.0";b.Base.Storage={TYPES:{LOCAL:function(){try{return window.localStorage}catch(a){return}}(),SESSION:function(){try{return window.sessionStorage}catch(a){return}}()},KEYS:{VIDEO_RESOLUTIONS:"videoResolutions"},get:function(b,d){return b?(b[c]||this._initNamespace(b),JSON.parse(b[c])[d]):a},set:function(a,b,d){if(!a)return!1;a[c]||this._initNamespace(a);var e=JSON.parse(a[c]);return e[b]=d,a[c]=JSON.stringify(e),!0},remove:function(a,b){if(!a||!a[c])return!1;var d=JSON.parse(a[c]);return delete d[b],a[c]=JSON.stringify(d),!0},_initNamespace:function(a){return a[c]=JSON.stringify({}),!0}}}(AvayaClientServices),function(a){"use strict";function b(a,b,c){Error.call(this,a),this.message=a,this.validatedObject=b,this.violatedRule=c,this.name="ValidationError"}b.prototype=Object.create(Error.prototype),a.Base.ValidationError=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={validate:function(){throw new Error("Function is not implemented!")},_processCondition:function(a,b,c,d){return!!a||(a=c.message||this.defaultMessage,this._handleValidationError(a,b,c,d))},_handleValidationError:function(b,c,d,e){if(e)return!1;throw new a.Base.ValidationError(b,c,d)}},a.Base.Validators.BaseValidator=b}(AvayaClientServices),function(a){"use strict";function b(){this.defaultMessage="Provided element is not defined."}(b.prototype=Object.create(a.Base.Validators.BaseValidator.prototype)).validate=function(a,b,c){var d=void 0!==a;return this._processCondition(d,a,b,c)},a.Base.Validators.DefinedValidator=b}(AvayaClientServices),function(a){"use strict";function b(){this.defaultMessage="Provided element is not compatible with required type."}(b.prototype=Object.create(a.Base.Validators.BaseValidator.prototype)).validate=function(a,b,c){var d=typeof a===b.expected||"object"==typeof a&&a instanceof b.expected;return this._processCondition(d,a,b,c)},a.Base.Validators.TypeValidator=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e){this._width=a,this._height=b,this._fps=e||30,this._minBandwidth=c,this._maxBandwidth=d}(b.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getFPS:function(){return this._fps},getMinBandwidth:function(){return this._minBandwidth},getMaxBandwidth:function(){return this._maxBandwidth},toString:function(){return this._width+"x"+this._height+" (bandwidth: min. "+this._minBandwidth+"kbps, max. "+this._maxBandwidth+"kbps)"}}).convertToConfigVideoResolution=function(b){var c,d;for(d in a.Base.VideoResolution)a.Base.VideoResolution.hasOwnProperty(d)&&a.Base.VideoResolution[d].getHeight()===b.getHeight()&&(c=d);return c},a.Base.VideoResolutionDetails=b}(AvayaClientServices),function(a){"use strict";function c(){this._onInvalidCredentialsProvidedCallbacks=b.Callbacks();
}c.prototype={onAuthenticationChallenge:function(a,b){},addOnInvalidCredentialsCallback:function(a){this._onInvalidCredentialsProvidedCallbacks.add(a)},removeOnInvalidCredentialsCallback:function(a){this._onInvalidCredentialsProvidedCallbacks.remove(a)}},a.Config.AbstractCredentialProvider=c}(AvayaClientServices),function(a){"use strict";function b(){this.enabled=!1,this.credentialProvider=new a.Config.AbstractCredentialProvider,this.networkProviderConfiguration=new a.Config.NetworkProviderConfiguration}b.prototype={},a.Config.ACSConfiguration=b}(AvayaClientServices),function(a){"use strict";function b(){this.enabled=!1,this.pollingIntervalInMinutes=0,this.networkProviderConfiguration=new a.Config.NetworkProviderConfiguration,this.credentialProvider=new a.Config.CredentialProvider}b.prototype={},a.Config.AMMConfiguration=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.AnalyticsConfiguration=function(){this.enabled=!1}}(),function(){"use strict";function a(a,b){return a+" "+b}var b={basic:function(a,b){return"Basic "+btoa(a+":"+b)},bearer:a};AvayaClientServices.Config.Authentication.Header=b}(),function(){"use strict";AvayaClientServices.Config.Authentication.Scheme={BASIC:"Basic",BEARER:"Bearer"}}(),function(){"use strict";AvayaClientServices.Config.Authentication.TokenType={BEARER:"Bearer",UPTOKEN:"UPToken",ESGTOKEN:"ESGToken"}}(),function(a){"use strict";var b={INCOMING_VIDEO_REQUEST_TIMEOUT:15e3,VIDEO_MAX_BANDWIDTH_ANY_NETWORK:1024,TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT:5e3,ICE_CANDIDATES_GATHERING_TIMEOUT:12e3,ICE_CONNECTION_RETRY_INTERVAL:5e3,MIN_PREFERRED_VIDEO_FPS:15};a.Config.CallUserConfiguration=function(){this.incomingCall=!1,this.videoEnabled=!1,this.startRingingOnIncomingCall=!0,this.incomingVideoRequestTimeout=b.INCOMING_VIDEO_REQUEST_TIMEOUT,this.videoMaxBandwidthAnyNetwork=b.VIDEO_MAX_BANDWIDTH_ANY_NETWORK,this.iceCandidatesGatheringTimeout=b.ICE_CANDIDATES_GATHERING_TIMEOUT,this.turnRelayCandidatesGatheringTimeout=b.TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT,this.iceConnectionRestartInterval=b.ICE_CONNECTION_RETRY_INTERVAL,this.minPreferredVideoFPS=b.MIN_PREFERRED_VIDEO_FPS},a.Config.CallUserConfiguration.DefaultValues=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.CollaborationConfiguration=function(){this.contentSharingWorkerPath=a,this.imageQuality=1}}(),function(a){"use strict";function b(b,c,d){a.Config.AbstractCredentialProvider.call(this),this.username=b,this.password=c,this.domain=d,this.displayName="",this.isGuest=!1}(b.prototype=Object.create(a.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(a,b){b({username:this.username,password:this.password,domain:this.domain,isGuest:this.isGuest,displayName:this.displayName})},a.Config.CredentialProvider=b}(AvayaClientServices),function(b){"use strict";function c(c,d){b.Config.AbstractCredentialProvider.call(this),this.token=c,this.bearer="string"==typeof d?d.trim():a}(c.prototype=Object.create(b.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(a,b){b({bearer:this.bearer,token:this.token})},b.Config.CredentialTokenProvider=c}(AvayaClientServices),function(a){"use strict";function b(b){a.Config.CredentialProvider.call(this),this.username=this._createGuestUser(),this.password="",this.domain="",this.displayName=b,this.isGuest=!0}(b.prototype=Object.create(a.Config.CredentialProvider.prototype)).getDisplayName=function(){return this.displayName},b.prototype.setDisplayName=function(a){this.displayName=a},b.prototype._generateUUID=function(){var a=window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=a.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"===b?c:3&c|8).toString(16)})},b.prototype._createGuestUser=function(){return"csaGuest/jsg-"+this._generateUUID()},a.Config.GuestCredentialProvider=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this._failureCount=a,this._retryCallback=b,this._cancelCallback=c}b.prototype={getFailureCount:function(){return this._failureCount},retry:function(a){this._retryCallback(a)},cancel:function(){this._cancelCallback()}},a.Config.InvalidCredentialsEvent=b}(AvayaClientServices),function(a){"use strict";function b(){this.voipConfigurationAudio=new a.Config.VoIPConfigurationAudio,this.voipConfigurationVideo=new a.Config.VoIPConfigurationVideo,this.mediaEngineEnabled=!0,this.retrieveDeviceLabelsEnabled=!0}b.prototype={},a.Config.MediaConfiguration=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.MediaServiceConfiguration=function(){this.sessionId=a,this.accessToken=a,this.userAgentURL=a}}(),function(a){"use strict";function b(a,b,c,d){this.webSocketConfig=b,this.sseConfig=c,this.restConfig=a,this.maxConnectionErrorCount=d||5}b.prototype={},a.Config.NetworkProviderConfiguration=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this.frametimeThreshold=a,this.overloadsThreshold=b,this.evaluateInterval=c}b.prototype={},a.Config.PerformanceManagerConfiguration=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.PresenceConfiguration=function(){this.enabled=!1}}(),function(){"use strict";AvayaClientServices.Config.SecurityPolicy={BEST_EFFORT:"BEST_EFFORT",DISABLED:"DISABLED",REQUIRED:"REQUIRED"}}(),function(a){"use strict";function b(a,b,c,d,e,f){this.hostName=a||"",this.port=b,this.isSecure=!!c,this.path=d||"",this.credentials=e||"",this.query=f||""}b.prototype={getUrl:function(a){return a=a?"ws":"http",this.isSecure&&(a+="s"),a+="://",this.credentials&&(a+=this.credentials+"@"),a+=this.hostName,this.port&&(a+=":"+this.port),a+=this.path,a+=this.query}},a.Config.ServerInfo=b}(AvayaClientServices),function(a){"use strict";function b(){this.enabled=!1,this.networkProviderConfiguration=new a.Config.NetworkProviderConfiguration,this.credentialProvider=new a.Config.CredentialProvider,this.maxCallStartReconnectionAttempts=-1,this._disableWebRTCForTheseBrowsers=[]}b.prototype={},a.Config.SGConfiguration=b}(AvayaClientServices),function(a){"use strict";function b(){this.enabled=!1,this.networkProviderConfiguration=new a.Config.NetworkProviderConfiguration,this.credentialProvider=new a.Config.CredentialProvider}b.prototype={},a.Config.UCCPConfiguration=b}(AvayaClientServices),function(a){"use strict";function b(){this.applicationBuildNumber="",this.applicationProductName="",this.applicationProductVersion="",this.ammConfiguration=new a.Config.AMMConfiguration,this.acsConfiguration=new a.Config.ACSConfiguration,this.uccpConfiguration=new a.Config.UCCPConfiguration,this.sgConfiguration=new a.Config.SGConfiguration,this.callUserConfiguration=new a.Config.CallUserConfiguration,this.presenceConfiguration=new a.Config.PresenceConfiguration,this.wcsConfiguration=new a.Config.WCSConfiguration,this.mediaConfiguration=new a.Config.MediaConfiguration,this.collaborationConfiguration=new a.Config.CollaborationConfiguration,this.analyticsConfiguration=new a.Config.AnalyticsConfiguration,this.mediaServiceContext="",this._mediaServiceConfiguration=null}b.prototype={},a.Config.UserConfiguration=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.VideoResolution={RESOLUTION_1080p:"resolution1080p",RESOLUTION_720p:"resolution720p",RESOLUTION_480p:"resolution480p",RESOLUTION_360p:"resolution360p",RESOLUTION_240p:"resolution240p",RESOLUTION_180p:"resolution180p"}}(),function(a){"use strict";function b(){this.bgnMode=!1,this.codecList=[],this.echoMode=!1,this.mediaMode=!1,this.mobileEchoMode=!1,this.noiseSupMode=!1,this.opusMode=!1,this.receiveGainMode=!1,this.receiveSupMode=!1,this.transmitGainMode=!1,this.vadMode=!1}b.prototype={},a.Config.VoIPConfigurationAudio=b}(AvayaClientServices),function(a){"use strict";function b(){this.anyNetworkBandwidthMode=!1,this.congestionControlAlgorithm=!1,this.videoResolution=a.Config.VideoResolution.RESOLUTION_720p,this.presentationHigherPriorityThanPeopleVideo=!1,this.maxAvgVideoEncodingTime=35,this.maxAvgVideoDecodingTime=40,this.maxWarningVideoEncodingTime=13,this.maxWarningVideoDecodingTime=13,this.performanceMonitorGracePeriod=5,this.performanceMonitorWindowDuration=10,this.performanceAdjustmentsReleaseWindowDuration=60,this.minVideoResolutionReductionInterval=10,this.minVideoResolutionIncrementInterval=60,this.runtimePerformanceMonitorOverloadThreshold=200,this.runtimePerformanceMonitorWarningThreshold=40,this.konvaSharingGracePeriod=15,this.konvaSharingMeasurementsInterval=.5,this.konvaSharingMeasurementsWindowDuration=10,this.konvaSharingFramesAverageLimit=2.5,this.konvaSharingFramesWarningLimit=1}b.prototype={},a.Config.VoIPConfigurationVideo=b}(AvayaClientServices),function(a){"use strict";function b(){this.enabled=!1,this.networkProviderConfiguration=new a.Config.NetworkProviderConfiguration,this.credentialProvider=new a.Config.CredentialProvider}b.prototype={},a.Config.WCSConfiguration=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.WCSCredentials=function(a,b,c,d,e){this.token=a,this.username=b,this.participantId=c,this.sessionId=d,this.mode=e}}(),function(a){"use strict";function b(b,c,d,e,f){a.Config.AbstractCredentialProvider.call(this),this.token=b,this.username=c,this.attendeeId=d,this.sessionId=e,this.mode=f}(b.prototype=Object.create(a.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(b,c){c(new a.Config.WCSCredentials(this.token,this.username,this.attendeeId,this.sessionId,this.mode))},a.Config.WCSCredentialTokenProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSConstants={SVC_GET_CONTACTS:"getContacts",SVC_SEARCH_CONTACTS:"searchContacts",TERMINAL_TYPE:"TERMINAL",PROVENANCE_TYPE_AVAYA:"Avaya",PROVENANCE_SUBTYPE_ADMINISTERED:"Administered"}}(),function(a){"use strict";function b(){this._quickSerachCache=new a.Base.SimpleIMDB(["searchString","searchScope"],{maxElements:250,timeToLive:1728e5,auditInterval:5e3})}b.prototype.addQuickSearchResultsToCache=function(a){for(var b,c=[],d=this._quickSerachCache.getCacheMaxSize(),e=this._trimToCacheMaxSize(a,d),f=0;f<e.length;f++)b={keys:{searchString:[e[f].searchString],searchScope:[e[f].searchScope]},element:e[f]},c.push(b);this._quickSerachCache.addElements(c)},b.prototype.getQuickSearchResultsFromCache=function(b,c){return c={searchString:[b],searchScope:[c]},this._quickSerachCache.searchByKeys(c,a.Base.IMDBSearchOptions.EXACT_MATCH)},b.prototype._trimToCacheMaxSize=function(a,b){return a=b&&a.length>b?a.slice(-b):a.slice()},a.Providers.ACS.ACSContactsCache=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={convertACSContactArraytoContactArray:function(a){var b=[];if(a&&0<a.length)for(var c=0;c<a.length;c++)b.push(this.convertACSContactV1toContact(a[c]));return b},convertACSContactV1toContact:function(b){var c=a.Base.Utils,d=new a.Services.Contacts.Contact;if(c.isDefined(b)){c.isDefined(b.id)&&c.isDefined(b.id.value)&&(d.id=b.id),c.isDefined(b.contactUrl)&&c.isDefined(b.contactUrl.value)?d._uniqueAddressForMatching=b.contactUrl.value:c.isDefined(b.loginID)&&b.loginID?d._uniqueAddressForMatching=b.loginID:c.isDefined(b.terminalId)&&b.terminalId&&(d._uniqueAddressForMatching=b.terminalId);var e,f=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),g=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),h=function(a,b,d){var e;c.isDefined(a)&&a&&(c.isDefined(a.value)?("string"===d?e=a.value:"boolean"===d?e="true"===a.value:"float"===d&&(e=parseFloat(a.value)),b()._value=e,e=c.isDefined(a)&&c.isDefined(a.editable)&&!a.editable,b()._setWriteCapability(e?f:g)):"string"!=typeof a&&"boolean"!=typeof a&&"number"!=typeof a||(a={value:e=a,editable:!1,provenance:[]},b()._value=e,b()._setWriteCapability(f)))};if(h(b.surName||b.lastName,d.getLastName.bind(d),"string"),h(b.givenName||b.firstName||b.name,d.getFirstName.bind(d),"string"),h(b.displayName||b.name,d.getDisplayName.bind(d),"string"),h(b.asciiSurName,d.getASCIILastName.bind(d),"string"),h(b.asciiGivenName,d.getASCIIFirstName.bind(d),"string"),h(b.asciiDisplayName,d.getASCIIDisplayName.bind(d),"string"),h(b.alias,d.getAlias.bind(d),"string"),h(b.location,d.getLocation.bind(d),"string"),h(b.workRoomNo,d.getWorkRoomNumber.bind(d),"string"),h(b.streetAddress,d.getStreetAddress.bind(d),"string"),h(b.city,d.getCity.bind(d),"string"),h(b.state,d.getState.bind(d),"string"),h(b.country,d.getCountry.bind(d),"string"),h(b.postalCode,d.getPostalCode.bind(d),"string"),h(b.company,d.getCompany.bind(d),"string"),h(b.manager,d.getManager.bind(d),"string"),h(b.department,d.getDepartment.bind(d),"string"),h(b.preferredLanguage,d.getLanguage.bind(d),"string"),h(b.notes,d.getNotes.bind(d),"string"),h(b.scopiaUserId||b.userId,d.getScopiaUserId.bind(d),"string"),h(b.scopiaLoginId||b.loginID,d.getScopiaLoginId.bind(d),"string"),h(b.rank,d.getRank.bind(d),"float"),h(b.isBuddy,d.isBuddy.bind(d),"boolean"),h(b.favourite,d.isFavorite.bind(d),"boolean"),h(b.videoCapable,d.isVideoCapable.bind(d),"boolean"),c.isDefined(b.pictureUrl)&&b.pictureUrl&&("string"==typeof b.pictureUrl?e=b.pictureUrl:c.isDefined(b.pictureUrl.value)&&""!==b.pictureUrl.value&&(e=b.pictureUrl.value),e))for(var i in a.Services.Contacts.ContactPictureSize)a.Services.Contacts.ContactPictureSize.hasOwnProperty(i)&&d.addPictureUrl(i,e+"?size="+a.Services.Contacts.ContactPictureSize[i].toLowerCase());if(c.isDefined(b.emailAddresses))for(var j=b.emailAddresses.length,k=0;k<j;k++){var l=new a.Services.Contacts.ContactEmailAddressField;c.isDefined(b.emailAddresses[k].value)&&(l._address=b.emailAddresses[k].value),c.isDefined(b.emailAddresses[k].type)&&(l._emailAddressType=this._convertACSEmailAddressTypeToContactEmailAddressType(b.emailAddresses[k].type)),b.emailAddresses[k].editable?l._setWriteCapability(g):l._setWriteCapability(f),d.getEmailAddresses().getValues().push(l)}if(c.isDefined(b.email)&&b.email&&((q=new a.Services.Contacts.ContactEmailAddressField)._address=b.email,q._setWriteCapability(f),d.getEmailAddresses().getValues().push(q)),c.isDefined(b.phoneNumberList)){var m=b.phoneNumberList.length;for(k=0;k<m;k++){var n=new a.Services.Contacts.ContactPhoneField;c.isDefined(b.phoneNumberList[k].phoneNumber)&&(n._phoneNumber=b.phoneNumberList[k].phoneNumber),c.isDefined(b.phoneNumberList[k].label1)&&(n._label1=b.phoneNumberList[k].label1),c.isDefined(b.phoneNumberList[k].label2)&&(n._label2=b.phoneNumberList[k].label2),c.isDefined(b.phoneNumberList[k].type)&&(n._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(b.phoneNumberList[k].type)),c.isDefined(b.phoneNumberList[k].speedDialEnabled)&&(n._speedDialEnabled="true"===b.phoneNumberList[k].speedDialEnabled),c.isDefined(b.phoneNumberList[k].isPrimary)&&(n._default="true"===b.phoneNumberList[k].isPrimary),b.phoneNumberList[k].editable?n._setWriteCapability(g):n._setWriteCapability(f);var o=b.phoneNumberList[k].provenance;if(o)for(var p=0;p<o.length;p++)o[p].type===a.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&o[p].subType===a.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&n.setAvayaAdministered(!0);d.getPhoneNumbers().getValues().push(n)}}var q,r,s,t=[];for(b.telephoneMobile&&t.push(b.telephoneMobile),b.telephoneOffice&&t.push(b.telephoneOffice),k=0;k<t.length;k++){var u=new a.Services.Contacts.ContactPhoneField;u._phoneNumber=t[k],u._setWriteCapability(f),d.getPhoneNumbers().getValues().push(u)}if(c.isDefined(b.type)&&b.type===a.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(q=!1,(r=new a.Services.Contacts.ContactPhoneField)._setWriteCapability(f),b.protocol&&(r._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(b.protocol),q=!0),b.description&&(r._label1=b.description,q=!0),b.number&&(r._phoneNumber=b.number,q=!0),q&&d.getPhoneNumbers().getValues().push(r)),c.isDefined(b.imaddresses)){var v=b.imaddresses.length;for(k=0;k<v;k++){var w=new a.Services.Contacts.ContactIMAddressField;c.isDefined(b.imaddresses[k].value)&&(w._address=b.imaddresses[k].value),c.isDefined(b.imaddresses[k].type)&&(w._imAddressType=this._convertACSHandleTypeToContactHandleType(b.imaddresses[k].type)),b.imaddresses[k].editable?w._setWriteCapability(g):w._setWriteCapability(f);var x=b.imaddresses[k].provenance;if(x)for(var y=0;y<x.length;y++)x[y].type===a.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&x[y].subType===a.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&w.setAvayaAdministered(!0);d.getIMAddresses().getValues().push(w)}}c.isDefined(b.custom1)&&c.isDefined(b.custom1.value)&&((r=new a.Services.Contacts.ContactStringField)._value=b.custom1.value,r._setWriteCapability(f),d.getCustom1().getValues().push(r)),d.getCustom1()._setWriteCapability(f),c.isDefined(b.custom2)&&c.isDefined(b.custom2.value)&&((s=new a.Services.Contacts.ContactStringField)._value=b.custom2.value,s._setWriteCapability(f),d.getCustom2().getValues().push(s)),d.getCustom2()._setWriteCapability(f),c.isDefined(b.custom3)&&c.isDefined(b.custom3.value)&&((s=new a.Services.Contacts.ContactStringField)._value=b.custom3.value,s._setWriteCapability(f),d.getCustom3().getValues().push(s)),d.getCustom3()._setWriteCapability(f),c.isDefined(b.type)&&b.type===a.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(b.contactIdentifier?d.getTerminal()._terminalId=b.contactIdentifier.value:d.getTerminal()._terminalId=b.terminalId,b.givenName?d.getTerminal()._terminalName=b.givenName.value:d.getTerminal()._terminalName=b.name)}return d},convertQuickSearchResults:function(b,c,d){for(var e=[],f=0;f<b.length;f++){var g=c[b[f].correlationId],h=this.convertACSContactArraytoContactArray(b[f].contacts),h=new a.Services.Contacts.ResolveContactResult(g,d,h);e.push(h)}return e},convertContactToACSContactV1:function(b){return this.mergeContactWithACSContactV1(b,new a.Providers.ACS.ContactV1)},mergeContactWithACSContactV1:function(b,c){if(b&&c){var d=new a.Providers.ACS.ContactV1;b._getUniqueAddressWithoutChanges()&&(d.contactUrl.value=b._getUniqueAddressWithoutChanges()),d.id.value=c.id.value,a.Base.Utils.isDefined(b._terminal)&&""!==b.getTerminal().getTerminalId()?d.contactIdentifier.value=b.getTerminal().getTerminalId():d.contactIdentifier.value=c.contactIdentifier.value,d.pictureUrl.value=c.pictureUrl.value,d.asciiSurName.value=b.getASCIILastName().getValue(),d.asciiGivenName.value=b.getASCIIFirstName().getValue(),d.asciiDisplayName.value=b.getASCIIDisplayName().getValue(),d.surName.value=b.getLastName().getValue(),d.givenName.value=b.getFirstName().getValue(),d.displayName.value=b.getDisplayName().getValue(),d.alias.value=b.getAlias().getValue(),d.location.value=b.getLocation().getValue(),d.workRoomNo.value=b.getWorkRoomNumber().getValue(),d.streetAddress.value=b.getStreetAddress().getValue(),d.city.value=b.getCity().getValue(),d.state.value=b.getState().getValue(),d.country.value=b.getCountry().getValue(),d.postalCode.value=b.getPostalCode().getValue(),d.company.value=b.getCompany().getValue(),d.manager.value=b.getManager().getValue(),d.department.value=b.getDepartment().getValue(),d.preferredLanguage.value=b.getLanguage().getValue(),d.notes.value=b.getNotes().getValue(),a.Base.Utils.isDefined(b._scopiaUserId)&&(d.scopiaUserId.value=b.getScopiaUserId().getValue()),a.Base.Utils.isDefined(b._scopiaLoginId)&&(d.scopiaLoginId.value=b.getScopiaLoginId().getValue()),d.rank.value=b.getRank().getValue().toString(),d.isBuddy.value=b.isBuddy().getValue().toString(),d.favourite.value=b.isFavorite().getValue().toString(),d.videoCapable.value=b.isVideoCapable().getValue().toString();for(var e=[],f=b.getEmailAddresses().getValues(),g=0;g<f.length;g++){var h=new a.Providers.ACS.ContactEmailData;h.value=f[g].getAddress(),h.type=this._convertContactEmailAddressTypeToACSEmailAddressType(f[g].getEmailAddressType()),e.push(h)}d.emailAddresses=e;var i=[],j=b.getPhoneNumbers().getValues();for(g=0;g<j.length;g++){var k=new a.Providers.ACS.ContactPhoneData;k.phoneNumber=j[g].getPhoneNumber(),k.label1=j[g].getLabel1(),k.label2=j[g].getLabel2(),k.type=this._convertContactPhoneNumberTypeToACSPhoneType(j[g].getPhoneNumberType()),k.speedDialEnabled=j[g].isSpeedDialEnabled().toString(),k.isPrimary=j[g].isDefault().toString(),i.push(k)}d.phoneNumberList=i;var l=[],m=b.getIMAddresses().getValues();for(g=0;g<m.length;g++){var n=new a.Providers.ACS.ContactHandleData;n.value=m[g].getAddress(),n.type=this._convertContactHandleTypeToACSHandleType(m[g].getIMAddressType()),l.push(n)}d.imaddresses=l}return d},_convertACSPhoneNumberTypeToContactPhoneNumberType:function(b){if(!b)return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;switch(b){case a.Providers.ACS.ACSPhoneNumberType.WORK:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;case a.Providers.ACS.ACSPhoneNumberType.HOME:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME;case a.Providers.ACS.ACSPhoneNumberType.HANDLE:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE;case a.Providers.ACS.ACSPhoneNumberType.MOBILE:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE;case a.Providers.ACS.ACSPhoneNumberType.FAX:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX;case a.Providers.ACS.ACSPhoneNumberType.PAGER:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER;default:return a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}},_convertContactPhoneNumberTypeToACSPhoneType:function(b){if(!b)return a.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK;switch(b){case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK:return a.Providers.ACS.ACSPhoneNumberType.WORK;case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE:return a.Providers.ACS.ACSPhoneNumberType.HANDLE;case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME:return a.Providers.ACS.ACSPhoneNumberType.HOME;case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE:return a.Providers.ACS.ACSPhoneNumberType.MOBILE;case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX:return a.Providers.ACS.ACSPhoneNumberType.FAX;case a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER:return a.Providers.ACS.ACSPhoneNumberType.PAGER;default:return a.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK}},_convertACSEmailAddressTypeToContactEmailAddressType:function(b){if(!b)return a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER;switch(b){case a.Providers.ACS.ACSEmailAddressType.WORK:return a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK;case a.Providers.ACS.ACSEmailAddressType.OTHER:default:return a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER}},_convertContactEmailAddressTypeToACSEmailAddressType:function(b){if(!b)return a.Providers.ACS.ACSEmailAddressType.OTHER;switch(b){case a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK:return a.Providers.ACS.ACSEmailAddressType.WORK;case a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER:default:return a.Providers.ACS.ACSEmailAddressType.OTHER}},_convertACSHandleTypeToContactHandleType:function(b){if(!b)return a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER;switch(b){case a.Providers.ACS.ACSHandleType.WORK:return a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK;case a.Providers.ACS.ACSHandleType.OTHER:default:return a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER}},_convertContactHandleTypeToACSHandleType:function(b){if(!b)return a.Providers.ACS.ACSHandleType.OTHER;switch(b){case a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK:return a.Providers.ACS.ACSHandleType.WORK;case a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER:default:return a.Providers.ACS.ACSHandleType.OTHER}},extendAcsContact:function(b){var c=a.Base.Utils.deepMerge;if((b=c(new a.Providers.ACS.ContactV1,b)).emailAddresses)for(var d=b.emailAddresses.length,e=0;e<d;e++)b.emailAddresses[e]=c(new a.Providers.ACS.ContactEmailData,b.emailAddresses[e]);if(b.phoneNumberList){var f=b.phoneNumberList.length;for(e=0;e<f;e++)b.phoneNumberList[e]=c(new a.Providers.ACS.ContactPhoneData,b.phoneNumberList[e])}if(b.imaddresses){var g=b.imaddresses.length;for(e=0;e<g;e++)b.imaddresses[e]=c(new a.Providers.ACS.ContactHandleData,b.imaddresses[e])}return b}},a.Providers.ACS.ACSContactsConverter=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSContentsActions={ADD:"ADD",UPDATE:"UPDATE",DELETE:"DELETE",REFRESH:"refreshContactList"}}(),function(b){"use strict";function c(){this._acsRequestBuilder=null,this._acsContactsConverter=null,this._acsNetworkProvider=null,this._acsContactsProvider=null,this._acsDirectorySearchProvider=null,this._contactsAnalyticsService=new b.Services.Analytics.ContactsAnalyticsService,this._acsContactsCache=new b.Providers.ACS.ACSContactsCache}c.prototype={getACSContactsProvider:function(){var a;return this._acsContactsProvider||(a=this._createACSContactsProviderV1(),this._acsContactsProvider=new b.Providers.ACS.ACSContactsProvider,this._acsContactsProvider.registerACSContactsProvider(1,a)),this._acsContactsProvider},getACSDirectorySearchProvider:function(){var a;return this._acsDirectorySearchProvider||(a=this._createACSDirectorySearchProviderV1(),this._acsDirectorySearchProvider=new b.Providers.ACS.ACSDirectorySearchProvider,this._acsDirectorySearchProvider.registerACSDirectorySearchProvider(1,a)),this._acsDirectorySearchProvider},_createACSContactsProviderV1:function(){return new b.Providers.ACS.ACSContactsProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder())},_createACSDirectorySearchProviderV1:function(){return new b.Providers.ACS.ACSDirectorySearchProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder(),this._contactsAnalyticsService,this._acsContactsCache)},_getACSContactsConverter:function(){return this._acsContactsConverter||(this._acsContactsConverter=new b.Providers.ACS.ACSContactsConverter),this._acsContactsConverter},_getACSRequestBuilder:function(){return this._acsRequestBuilder||(this._acsRequestBuilder=new b.Providers.ACS.ACSRequestBuilder),this._acsRequestBuilder},_getACSNetworkProvider:function(){var c,d;return this._acsNetworkProvider||(d=[b.Providers.ACS.ACSEventTypes.CAS_NOTIFICATION,b.Providers.ACS.ACSEventTypes.PING],c=new b.Base.SSEProvider(d),d=new b.Base.RESTProvider,d=new b.Base.SSEIntegrationProvider(d,c),c=new b.Base.WebSocketProvider,c=new b.Base.NetworkProvider(c,d,b.Base.LoggerTags.ACS_CONTACTS_PROVIDER),d=new b.Base.NetworkProvider(new b.Base.RESTProvider,a,b.Base.LoggerTags.ACS_CONTACTS_PROVIDER),this._acsNetworkProvider=new b.Providers.ACS.ACSNetworkProvider(this._getACSRequestBuilder(),d,c,this._contactsAnalyticsService)),this._acsNetworkProvider}},b.Providers.ACS.ACSProviderFactory=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSProviderStates={STARTING:"STARTING",STARTED:"STARTED",STOPPING:"STOPPING",STOPPED:"STOPPED"}}(),function(b){"use strict";function c(){this._acsResources={},this._endpoints={},this._contentTypes={resourcesV1:"application/vnd.avaya.acs.resources.v1+json",resourcesV2:"application/vnd.avaya.acs.resources.v2+json",resourcesV7:"application/vnd.avaya.acs.resources.v7+json",errorV1:"application/vnd.avaya.acs.error.v1+json",contactsV1:"application/vnd.avaya.acs.contacts.v1+json",contactV1:"application/vnd.avaya.acs.contact.v1+json",searchV1:"application/vnd.avaya.acs.search.v1+json",searchresultV1:"application/vnd.avaya.acs.searchresult.v1+json",quicksearchV1:"application/vnd.avaya.acs.quicksearch.v1+json",searchresultiviewV1:"application/vnd.avaya.acs.searchresult-iview.v1+json"},this._usedIds={}}(c.prototype={}).setResources=function(a){this._acsResources=a,this._endpoints.searchContactsIView="",this._acsResources.resources.contacts&&(this._acsResources.resources.contacts.GET&&(this._acsResources.resources.contacts.GET.getContacts&&(this._endpoints.getContacts=this._acsResources.resources.contacts.GET.getContacts.href,this._endpoints.searchContacts=this._endpoints.getContacts+"/searches",this._endpoints.quickSearchContacts=this._endpoints.getContacts+"/quicksearches"),this._acsResources.resources.contacts.GET.searchIViewContacts&&(this._endpoints.searchContactsIView=this._acsResources.resources.contacts.GET.searchIViewContacts.href)),this._acsResources.resources.contacts.POST&&(this._acsResources.resources.contacts.POST.addUpdateContact&&(this._endpoints.addUpdateContact=this._acsResources.resources.contacts.POST.addUpdateContact.href),this._acsResources.resources.contacts.POST.performUnifiedSearch&&(this._endpoints.searchContacts=this._acsResources.resources.contacts.POST.performUnifiedSearch.href),this._acsResources.resources.contacts.POST.performQuickSearch&&(this._endpoints.quickSearchContacts=this._acsResources.resources.contacts.POST.performQuickSearch.href))),this._acsResources&&this._acsResources.sessionManagement&&this._acsResources.sessionManagement.href&&(this._endpoints.refreshRestSession=this._acsResources.sessionManagement.href)},c.prototype.setNotificationResources=function(a){a&&a.sessionManagement&&a.sessionManagement.href&&(this._endpoints.refreshNotificationSession=a.sessionManagement.href)},c.prototype.buildResourcesOptions=function(a,b){var c=[this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "),c={urlSuffix:"/acs/resources",sendType:"GET",dataType:"JSON",crossDomain:!0,headers:{Accept:c=b?[this._contentTypes.resourcesV7,this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "):c}};return a&&(c.headers["X-Avaya-Requested-With"]="XMLHttpRequest"),c},c.prototype.buildInvalidateSessionOptions=function(){return{urlSuffix:"/acs/session",sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},c.prototype.buildRefreshRestSessionOptions=function(){return this._endpoints.refreshRestSession?{url:this._endpoints.refreshRestSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/acs/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},c.prototype.buildRefreshNotificationSessionOptions=function(){return this._endpoints.refreshNotificationSession?{url:this._endpoints.refreshNotificationSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/notification/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},c.prototype.buildGetContactsOptions=function(c){if(b.Base.Utils.isUndefined(this._endpoints.getContacts))return a;var d={headers:{}},e=this._acsResources.resources.contacts&&this._acsResources.resources.contacts.GET.getContacts&&this._acsResources.resources.contacts.GET.getContacts.limits&&this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal?this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal:250;return d.url=this._endpoints.getContacts+"?count="+e,c&&(d.url+="&after="+c),d.sendType="GET",d.dataType="JSON",d.headers.Accept=[this._contentTypes.contactsV1,this._contentTypes.errorV1].join(", "),d},c.prototype.buildGetContactOptions=function(a){return{url:a,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", ")}}},c.prototype.buildAddContactOptions=function(){return b.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?a:{url:this._endpoints.addUpdateContact,sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},c.prototype.buildUpdateContactOptions=function(){return b.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?a:{url:this._endpoints.addUpdateContact,sendType:"PUT",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},c.prototype.buildAddUpdateContactData=function(a){
return JSON.stringify({userEmail:this._acsResources.self,contacts:[a]},this._stringifyReplacer)},c.prototype.buildDeleteContactOptions=function(a){return{url:a,sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},c.prototype.buildSearchContactsData=function(c){var d,e=c.getSearchString(),f=c.getSearchField();return f===b.Services.Contacts.SearchFieldType.NAME?d=["Displayname,"+e]:f===b.Services.Contacts.SearchFieldType.HANDLE?d=["EmailAddress,"+e]:f===b.Services.Contacts.SearchFieldType.LOGIN_ID?d=["LoginID,"+e]:f===b.Services.Contacts.SearchFieldType.TERMINAL?d=["Terminal,"+e]:f===b.Services.Contacts.SearchFieldType.ALL&&(d=["ALL,"+e]),c=c.getMaxResults(),0===c&&(c=a),JSON.stringify({searchCriteria:d,maxResults:c})},c.prototype.buildSearchContactsIViewOnlyData=function(c){var d=c.getSearchString();b.Base.Utils.getBrowserType()!==b.Base.BrowserType.IE&&b.Base.Utils.getBrowserType()!==b.Base.BrowserType.EDGE||(d=encodeURIComponent(d));var e=c.getSearchField();e===b.Services.Contacts.SearchFieldType.NAME?f="displayname="+d:e===b.Services.Contacts.SearchFieldType.HANDLE?f="emailAddress="+d:e===b.Services.Contacts.SearchFieldType.LOGIN_ID?f="loginID="+d:e===b.Services.Contacts.SearchFieldType.TERMINAL?f="terminal="+d:e===b.Services.Contacts.SearchFieldType.ALL&&(f="all="+d);var f=[f],c=c.getMaxResults();return(c=0===c?a:c)&&f.push("maxResults="+c),f.join("&")},c.prototype.buildQuickSearchContactsOptions=function(){return{url:this._endpoints.quickSearchContacts+"?maxResults=100",sendType:"POST",dataType:"text",headers:{Accept:[this._contentTypes.searchresultV1,this._contentTypes.errorV1],"Content-Type":this._contentTypes.quicksearchV1}}},c.prototype.buildQuickSearchContactsData=function(a,c){var d,e=[],f=b.Services.Contacts.ResolveContactsFieldType;switch(c){case f.HANDLE:d="Handle";break;case f.PHONE_NUMBER:d="PhoneNumber";break;default:b.Base.Logger.warn(b.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Invalid field type of resolving contacts",c)}if(d)for(var g=0;g<a.length;g++){var h={correlationId:String(g),criteria:{}};h.criteria[d]=a[g],e.push(h)}return JSON.stringify({filter:["EmailAddress","FirstName","LastName","PhoneNumber","IMHandle"],searchCriteria:e})},c.prototype.buildSearchContactsOptions=function(){return{url:this._endpoints.searchContacts+"?searchDirectory=true",sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.searchV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},c.prototype.buildSearchContactsIViewOnlyOptions=function(){return{url:this._endpoints.searchContactsIView,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.searchresultiviewV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},c.prototype.buildNotificationsOptions=function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},c.prototype.buildSubscribeForACSNotifications=function(a){return{subscribe:{requestId:"subscribe-"+this._generateId(),resources:[{application:"acs",service:a,resource:this._endpoints[a]}],version:"1"}}},c.prototype.buildUnsubscribeFromACSNotifications=function(a){return{unsubscribe:{requestId:"unsubscribe-"+this._generateId(),resources:[{application:"acs",service:a,resource:this._endpoints[a]}],version:"1"}}},c.prototype._stringifyReplacer=function(b,c){return c&&c.hasOwnProperty("value")&&c.value===a?a:c},c.prototype._generateId=function(a,c){for(var d;d=b.Base.Utils.makeId(),this._usedIds[d];);return d},b.Providers.ACS.ACSRequestBuilder=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEmailAddressType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSHandleType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSPhoneNumberType={WORK:"work",HANDLE:"handle",MOBILE:"mobile",HOME:"home",FAX:"fax",PAGER:"pager"}}(),function(b){"use strict";function c(){this.value=a,this.editable=a}c.prototype={equals:function(a){return this.value===a.value&&this.editable===a.editable}},b.Providers.ACS.ContactAttribute=c}(AvayaClientServices),function(b){"use strict";function c(){this.value=a,this.type=b.Providers.ACS.ACSEmailAddressType.OTHER,this.editable=a}c.prototype={equals:function(a){return this.value===a.value&&this.type===a.type&&this.editable===a.editable}},b.Providers.ACS.ContactEmailData=c}(AvayaClientServices),function(b){"use strict";function c(){this.value=a,this.type=b.Providers.ACS.ACSHandleType.OTHER,this.editable=a,this.provenance=a}c.prototype={equals:function(a){return this.value===a.value&&this.type===a.type&&this.editable===a.editable&&this.provenance===a.provenance}},b.Providers.ACS.ContactHandleData=c}(AvayaClientServices),function(b){"use strict";function c(){this.phoneNumber=a,this.label1=a,this.label2=a,this.type=b.Providers.ACS.ACSPhoneNumberType.WORK,this.speedDialEnabled=!1,this.isPrimary=!1,this.editable=a}c.prototype={equals:function(a){return this.phoneNumber===a.phoneNumber&&this.label1===a.label1&&this.label2===a.label2&&this.type===a.type&&this.speedDialEnabled===a.speedDialEnabled&&this.isPrimary===a.isPrimary&&this.editable===a.editable}},b.Providers.ACS.ContactPhoneData=c}(AvayaClientServices),function(a){"use strict";function b(){this.userEmail="",this.contacts=[],this.hasMoreResults=!1}b.prototype={},a.Providers.ACS.ContactsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.id=new a.Providers.ACS.ContactAttribute,this.contactIdentifier=new a.Providers.ACS.ContactAttribute,this.contactUrl=new a.Providers.ACS.ContactAttribute,this.surName=new a.Providers.ACS.ContactAttribute,this.givenName=new a.Providers.ACS.ContactAttribute,this.displayName=new a.Providers.ACS.ContactAttribute,this.alias=new a.Providers.ACS.ContactAttribute,this.company=new a.Providers.ACS.ContactAttribute,this.location=new a.Providers.ACS.ContactAttribute,this.workRoomNo=new a.Providers.ACS.ContactAttribute,this.streetAddress=new a.Providers.ACS.ContactAttribute,this.city=new a.Providers.ACS.ContactAttribute,this.state=new a.Providers.ACS.ContactAttribute,this.country=new a.Providers.ACS.ContactAttribute,this.postalCode=new a.Providers.ACS.ContactAttribute,this.manager=new a.Providers.ACS.ContactAttribute,this.department=new a.Providers.ACS.ContactAttribute,this.asciiGivenName=new a.Providers.ACS.ContactAttribute,this.asciiSurName=new a.Providers.ACS.ContactAttribute,this.asciiDisplayName=new a.Providers.ACS.ContactAttribute,this.pictureUrl=new a.Providers.ACS.ContactAttribute,this.isBuddy=new a.Providers.ACS.ContactAttribute,this.favourite=new a.Providers.ACS.ContactAttribute,this.videoCapable=new a.Providers.ACS.ContactAttribute,this.preferredLanguage=new a.Providers.ACS.ContactAttribute,this.notes=new a.Providers.ACS.ContactAttribute,this.rank=new a.Providers.ACS.ContactAttribute,this.custom1=new a.Providers.ACS.ContactAttribute,this.custom2=new a.Providers.ACS.ContactAttribute,this.custom3=new a.Providers.ACS.ContactAttribute,this.scopiaUserId=new a.Providers.ACS.ContactAttribute,this.scopiaLoginId=new a.Providers.ACS.ContactAttribute,this.phoneNumberList=[],this.emailAddresses=[],this.imaddresses=[]}b.prototype={equals:function(a){if(!(this.id.equals(a.id)&&this.contactIdentifier.equals(a.contactIdentifier)&&this.contactUrl.equals(a.contactUrl)&&this.surName.equals(a.surName)&&this.givenName.equals(a.givenName)&&this.displayName.equals(a.displayName)&&this.alias.equals(a.alias)&&this.company.equals(a.company)&&this.location.equals(a.location)&&this.workRoomNo.equals(a.workRoomNo)&&this.streetAddress.equals(a.streetAddress)&&this.city.equals(a.city)&&this.state.equals(a.state)&&this.country.equals(a.country)&&this.postalCode.equals(a.postalCode)&&this.manager.equals(a.manager)&&this.department.equals(a.department)&&this.asciiGivenName.equals(a.asciiGivenName)&&this.asciiSurName.equals(a.asciiSurName)&&this.asciiDisplayName.equals(a.asciiDisplayName)&&this.pictureUrl.equals(a.pictureUrl)&&this.isBuddy.equals(a.isBuddy)&&this.favourite.equals(a.favourite)&&this.videoCapable.equals(a.videoCapable)&&this.preferredLanguage.equals(a.preferredLanguage)&&this.notes.equals(a.notes)&&this.rank.equals(a.rank)&&this.custom1.equals(a.custom1)&&this.custom2.equals(a.custom2)&&this.custom3.equals(a.custom3)&&this.scopiaUserId.equals(a.scopiaUserId)&&this.scopiaLoginId.equals(a.scopiaLoginId))||this.phoneNumberList.length!==a.phoneNumberList.length||this.emailAddresses.length!==a.emailAddresses.length||this.imaddresses.length!==a.imaddresses.length)return!1;for(var b=0;b<this.phoneNumberList.length;b++)if(!this.phoneNumberList[b].equals(a.phoneNumberList[b]))return!1;for(b=0;b<this.emailAddresses.length;b++)if(!this.emailAddresses[b].equals(a.emailAddresses[b]))return!1;for(b=0;b<this.imaddresses.length;b++)if(!this.imaddresses[b].equals(a.imaddresses[b]))return!1;return!0}},a.Providers.ACS.ContactV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.displayMsg="",this.errorMsg=""}b.prototype={},a.Providers.ACS.ErrorV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}b.prototype={},a.Providers.ACS.NotificationResourcesV1=b}(AvayaClientServices),function(b){"use strict";function c(){this.version=1,this.resources={avayaRequestTimeout:{maximum:a,minimum:a,recommended:a},capabilities:[],contactSearchCapabilities:[],resources:{notification:{websocket:{href:a},sse:{href:a}},contacts:{POST:{addUpdateContact:{href:a}},GET:{getContacts:{href:a,limits:{maxSearchResultsPerPage:a,maxSearchResultsTotal:a}},searchIViewContacts:{href:a,limits:{maxSearchResultsTotal:a}}}},pictures:{GET:{getUserPicture:{href:a}}}},self:a,sessionManagement:{href:a,timeout:a}}}c.prototype={},b.Providers.ACS.ResourcesV1=c}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.ACS.ResourcesV1.call(this),this.version=2,this.v2MediaType=!0}b.prototype={},a.Providers.ACS.ResourcesV2=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ObservableEvents={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMM3EventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStateActions={TYPING:"typing",RECORDING_AUDIO:"recordingAudio",RECORDING_VIDEO:"recordingVideo",ATTACHING_FILE:"attachingFile",TAKING_PICTURE:"takingPicture",OTHER:"other"}}(),function(a){"use strict";a.Providers.AMM.AMMChatStateNotification=function(b,c,d,e,f){this.action=b.action,this.state=b.state,this.self=c,this.timeout=setTimeout(function(){c?f(b):(b.action="",b.state=a.Providers.AMM.ChatStates.PAUSED,d.fire(b))},e)}}(AvayaClientServices),function(a){"use strict";function c(){this._chatStateNotifications=[],this._conversationId="",this._localComposingInactivityTimeout=15e3,this._remoteComposingInactivityTimeout=6e4,this._composingRefreshTimeout=5e3,this._chatStateRefresh=!1,this._chatStateRefreshTimeout={}}c.prototype={setConversationId:function(a){this._conversationId=a},getConversationId:function(){return this._conversationId},setChatStateNotification:function(b,c,d){b.state===a.Providers.AMM.ChatStates.COMPOSING?this._setTypingNotification(b,c,d):this._chatStateNotifications[b.address]&&b.state===a.Providers.AMM.ChatStates.PAUSED&&(clearTimeout(this._chatStateNotifications[b.address].timeout),delete this._chatStateNotifications[b.address])},setChatStateRefreshTimeout:function(){this._chatStateRefresh=!0,this._chatStateRefreshTimeout=setTimeout(function(){this._chatStateRefresh=!1}.bind(this),this._composingRefreshTimeout)},getChatNotification:function(a){return this._chatStateNotifications[a]},clearChatStateRefreshTimeout:function(){this._chatStateRefresh=!1,clearTimeout(this._chatStateRefreshTimeout)},clearChatStateNotifications:function(){this._chatStateNotifications=[]},isChatStateAdded:function(){return this._chatStateRefresh},onPauseChatState:function(a,c){return b.Deferred().reject().promise()},_setTypingNotification:function(b,c,d){var e=c?this._localComposingInactivityTimeout:this._remoteComposingInactivityTimeout,f=function(a){this._localTimeoutEvent(a,d)}.bind(this);this._chatStateNotifications[b.address]?(clearTimeout(this._chatStateNotifications[b.address].timeout),this._chatStateNotifications[b.address].timeout=setTimeout(function(){c?this._localTimeoutEvent(b,d):this._remoteTimeoutEvent(b,d)}.bind(this),e)):this._chatStateNotifications[b.address]=new a.Providers.AMM.AMMChatStateNotification(b,c,d,e,f)},_localTimeoutEvent:function(b,c){this.onPauseChatState(b.action,this._conversationId).fail(function(d){a.Base.Logger.error(a.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"An attempt to update typing status was failed.",d),this._remoteTimeoutEvent(b,c)}.bind(this))},_remoteTimeoutEvent:function(b,c){b.action="",b.state=a.Providers.AMM.ChatStates.PAUSED,c.fire(b)}},a.Providers.AMM.AMMChatStateNotifications=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStates={COMPOSING:"composing",PAUSED:"paused"}}(),function(b){"use strict";function c(){this._parsers=[]}c.prototype={register:function(a,b){this._parsers[a]=b},unregister:function(b){this._parsers[b]=a},parse:function(a,b){return this._parsers[a]?this._delegateParser(a,b):b},_delegateParser:function(c,d){return this._parsers[c]!==a?this._parsers[c].parse(d):void b.Base.Logger.error(b.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"No parser specified!",c)}},b.Providers.AMM.AMMMessagesParser=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.MessagesService={CONVERSATION:"conversation",CHAT_STATE:"chatState"}}(),function(c){"use strict";function d(){this._ammProvider={}}d.prototype={getAMMProvider:function(a){if(c.Base.Utils.isDefined(a)&&a.enabled)return b.isEmptyObject(this._ammProvider)&&(this._ammProvider=new c.Providers.AMM.AMMProvider,this._ammProvider.registerAMMProvider(2.1,this._createAMM2_1Provider()),this._ammProvider.registerAMMProvider(3,this._createAMM3_XProvider("AMM3Provider")),this._ammProvider.registerAMMProvider(3.2,this._createAMM3_XProvider("AMM3_2Provider"))),this._ammProvider},_createAMM2_1Provider:function(){var b=new c.Base.RESTProvider,d=new c.Base.NetworkProvider(b,a,c.Base.LoggerTags.AMM_MESSAGING_PROVIDER),b=this._createEventsV2Parser();return new c.Providers.AMM.AMM2_1Provider(d,b)},_createEventsV2Parser:function(){var a=new c.Providers.AMM.AMMMessagesParser;return a.register(c.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new c.Providers.AMM.GetConversationsParser),a.register(c.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new c.Providers.AMM.ValidateUsersParser),a.register(c.Providers.AMM.AMMResponsesTypes.SEND,new c.Providers.AMM.SendParser),a.register(c.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new c.Providers.AMM.GetMessagesParser),a.register(c.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new c.Providers.AMM.AddParticipantsParser),a.register(c.Providers.AMM.AMMResponsesTypes.CLOSE,new c.Providers.AMM.CloseParser),a.register(c.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new c.Providers.AMM.NotificationParser),a.register(c.Providers.AMM.AMMResponsesTypes.NOTIFIED,new c.Providers.AMM.NotifiedParser),a.register(c.Providers.AMM.AMMResponsesTypes.DISCOVERY,new c.Providers.AMM.DiscoveryV2Parser),a.register(c.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new c.Providers.AMM.SubscribedParser),a.register(c.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new c.Providers.AMM.UnsubscribedParser),a},_createAMM3_XProvider:function(b){var d=[c.Providers.AMM.AMM3EventTypes.CAS_NOTIFICATION,c.Providers.AMM.AMM3EventTypes.PING],e=new c.Base.SSEProvider(d),f=new c.Base.RESTProvider,g=new c.Base.SSEIntegrationProvider(f,e),d=new c.Base.WebSocketProvider,f=new c.Base.NetworkProvider(d,g,c.Base.LoggerTags.AMM_MESSAGING_PROVIDER),e=new c.Base.RESTProvider,d=new c.Base.NetworkProvider(e,a,c.Base.LoggerTags.AMM_MESSAGING_PROVIDER),g=this._createEventsV3Parser(),e=new c.Providers.AMM.AMMChatStateNotifications;return new c.Providers.AMM[b](d,f,e,g)},_createEventsV3Parser:function(){var a=new c.Providers.AMM.AMMMessagesParser;return a.register(c.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new c.Providers.AMM.GetConversationsParser),a.register(c.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new c.Providers.AMM.ValidateUsersParser),a.register(c.Providers.AMM.AMMResponsesTypes.SEND,new c.Providers.AMM.SendParser),a.register(c.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new c.Providers.AMM.GetMessagesParser),a.register(c.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new c.Providers.AMM.AddParticipantsParser),a.register(c.Providers.AMM.AMMResponsesTypes.CLOSE,new c.Providers.AMM.CloseParser),a.register(c.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new c.Providers.AMM.NotificationParser),a.register(c.Providers.AMM.AMMResponsesTypes.NOTIFIED,new c.Providers.AMM.NotifiedParser),a.register(c.Providers.AMM.AMMResponsesTypes.DISCOVERY,new c.Providers.AMM.DiscoveryV3Parser),a.register(c.Providers.AMM.AMMResponsesTypes.DISCOVERY_NOTIFICATION,new c.Providers.AMM.DiscoveryNotificationParser),a.register(c.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new c.Providers.AMM.SubscribedParser),a.register(c.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new c.Providers.AMM.UnsubscribedParser),a.register(c.Providers.AMM.AMMResponsesTypes.RESOURCE_STATE,new c.Providers.AMM.ResourceStateParser),a}},c.Providers.AMM.AMMProviderFactory=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ProviderStates={AVAILABLE:"available",UNAVAILABLE:"unavailable"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMMResponsesTypes={ADD_PARTICIPANTS:"AddParticipants",GET_CONVERSATIONS:"GetConversations",VALIDATE_USERS:"ValidateUsers",SEND:"Send",GET_MESSAGES:"GetMessages",CLOSE:"Close",NOTIFICATION:"Notification",NOTIFIED:"Notified",DISCOVERY:"Discovery",DISCOVERY_NOTIFICATION:"DiscoveryNotification",SUBSCRIBED:"Subscribed",UNSUBSCRIBED:"Unsubscribed",RESOURCE_STATE:"ResourceState"}}(),function(a){"use strict";function b(){}b.prototype={parse:function(a){throw new Error("Method not implemented!")}},a.Providers.AMM.AbstractParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){for(var c={participants:[]},d=0;d<b.participants.length;d++){var e=new a.Providers.AMM.AddParticipantsResponse(b.participants[d].address,b.participants[d].givenName,b.participants[d].language,b.participants[d].modalities,b.participants[d].nativeGivenName,b.participants[d].nativeSurname,b.participants[d].surname,b.participants[d].type);c.participants.push(e)}return c},a.Providers.AMM.AddParticipantsParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.CloseResponse(b.closed,b.href,b.sensitivity)},a.Providers.AMM.CloseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.DiscoveryNotificationResponse(b.applications,b.capabilities,b.sessionManagement,b.version,b.commandURL)},a.Providers.AMM.DiscoveryNotificationParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.DiscoveryV2Response(b.addresses,b.avayaRequestTimeout,b.capabilities,b.conversationsResource,b.domains,b.limits,b.messages,b.outbox,b.self,b.services)},a.Providers.AMM.DiscoveryV2Parser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.DiscoveryV3Response(b.avayaRequestTimeout,b.contacts,b.conversationsResource,b.domains,b.messages,b.notificationService,b.notifications,b.outbox,b.picture,b.self,b.services,b.sessionManagement,b.users)},a.Providers.AMM.DiscoveryV3Parser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.GetConversationsResponse(b.conversations,b.href,b.lastUpdated,b.moreSearchResults)},a.Providers.AMM.GetConversationsParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.GetMessagesResponse(b.attachmentCount,b.counts,b.flags,b.href,b.id,b.lastAccessedTime,b.lastUpdated,b.latestEntryTimestamp,b.messages,b.participants,b.subject,b.totalCount,b.type,b.unreadAttachmentCount,b.unreadCount)},a.Providers.AMM.GetMessagesParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.NotificationResponse(b.application,b.contents,b.resource,b.service,b.version)},a.Providers.AMM.NotificationParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.NotifiedResponse(b.requestId,b.results,b.version)},a.Providers.AMM.NotifiedParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.ResourceStateResponse(b.results,b.version)},a.Providers.AMM.ResourceStateParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.SendResponse(b.body,b.event,b.flags,b.from,b.href,b.id,b.lastModifiedDate,b.parts,b.receivedDate,b.subject,b.threadId,b.to,b.inReplyTo)},a.Providers.AMM.SendParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.SubscribedResponse(b.results,b.version)},a.Providers.AMM.SubscribedParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){return new a.Providers.AMM.UnsubscribedResponse(b.results,b.version)},a.Providers.AMM.UnsubscribedParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.AMM.AbstractParser.prototype)).parse=function(b){for(var c={validatedAddresses:[]},d=0;d<b.validatedAddresses.length;d++){var e=new a.Providers.AMM.ValidateUsersResponse(b.validatedAddresses[d].addresses,b.validatedAddresses[d].query);c.validatedAddresses.push(e)}return c},a.Providers.AMM.ValidateUsersParser=b}(AvayaClientServices),function(a){"use strict";function b(){this.active=!1,this.closed=!1,this.href="",this.sensitivity=""}b.prototype={},a.Providers.AMM.ConversationFlagsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.conversationIds=[],this.href="",this.lastUpdated=""}b.prototype={},a.Providers.AMM.ConversationIdsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.href="",this.id="",this.lastAccessedTime="",this.lastUpdated=""}b.prototype={},a.Providers.AMM.ConversationIdV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.conversations=[],this.href="",this.lastUpdated="",this.moreSearchResults=!1}b.prototype={},a.Providers.AMM.ConversationsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.attachmentCount=0,this.href="",this.id="",this.flags=new a.Providers.AMM.ConversationFlagsV1,this.lastAccessedTime="",this.lastUpdated="",this.latestEntryTimestamp="",this.messages=[],this.name="",this.owner="",this.participants={href:""},this.totalCount=0,this.type="",this.unreadAttachmentCount=0,this.unreadCount=0,this.counts={eventCount:0,eventUnreadMessage:0,messageAttachment:0,messageCount:0,messageUnreadAttachment:0,messageUnreadMessage:0}}b.prototype={},a.Providers.AMM.ConversationV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.address="",this.givenName="",this.language="",this.modalities=[],this.nativeGivenName="",this.nativeSurname="",this.picture="",this.surname="",this.subType="",this.type=""}b.prototype={},a.Providers.AMM.EntityV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.displayMsg="",this.errorMsg="",this.errorCode=0}b.prototype={},a.Providers.AMM.ErrorV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.participants=[],this.reason="",this.type="",this.units="",this.value=0}b.prototype={},a.Providers.AMM.EventV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.doNotForward=!1,this.href="",this.importance="",this.read=!1,this.sensitivity=""}b.prototype={},a.Providers.AMM.MessageFlagsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.body="",this.event=new a.Providers.AMM.EventV1,this.flags=new a.Providers.AMM.MessageFlagsV1,this.from=new a.Providers.AMM.EntityV1,this.href="",this.id="",this.inReplyTo="",this.lastModifiedDate="",this.parts=[],this.receivedDate="",this.subject="",this.threadId="",this.to=[]}b.prototype={},a.Providers.AMM.MessageV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}b.prototype={},a.Providers.AMM.NotificationResourcesV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.action="",this.address="",this.state="",this.timestamp=""}b.prototype={},a.Providers.AMM.NotificationContentsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.participants=[]}b.prototype={},a.Providers.AMM.ParticipantsV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.disposition="",this.duration=0,this.media="",this.mimeType="",this.partId="",this.size=0}b.prototype={},a.Providers.AMM.PartV1=b}(AvayaClientServices),function(a){"use strict";function b(){this.version=2,this.addresses="",this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.services={markAsReadIf:"",validateAddress:""}}b.prototype={},a.Providers.AMM.ResourcesV2=b}(AvayaClientServices),function(a){"use strict";function b(){this.version=3,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.picture="",this.contacts="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}}}b.prototype={},a.Providers.AMM.ResourcesV3=b}(AvayaClientServices),function(a){"use strict";function b(){this.version=4,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.contacts={href:""},this.conversationsResource={href:"",capabilities:{automaticLastAccessedDate:!1,postSessionEvent:!1,subjectChange:!1},limits:{maxMessageCount:0,maxIdsLimit:0}},this.domains=[],this.messages={href:"",capabilities:{html:!1}},this.notifications={href:""},this.outbox={href:"",capabilities:{richContent:!1},limits:{maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0}},this.picture={href:""},this.self="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}},this.notificationService={sse:{href:""},websocket:{href:""}},this.users={href:""},this.sessionManagement={href:"",timeout:0,username:""}}b.prototype={},a.Providers.AMM.ResourcesV4=b}(AvayaClientServices),function(a){"use strict";function b(){this.query="",this.addresses=[]}b.prototype={},a.Providers.AMM.ValidatedAddressesV1=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.AddParticipantsResponse=function(a,b,c,d,e,f,g,h){this._address=a,this.givenName=b,this.language=c,this.modalities=d,this.nativeGivenName=e,this.nativeSurname=f,this.surname=g,this.type=h}}(),function(){"use strict";AvayaClientServices.Providers.AMM.CloseResponse=function(a,b,c){this.closed=a,this.href=b,this.sensitivity=c}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryNotificationResponse=function(a,b,c,d,e){this.applications=a,this.capabilities=b,this.sessionManagement=c,this.version=d,this.commandURL=e}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV2Response=function(a,b,c,d,e,f,g,h,i,j){this.addresses=a,this.avayaRequestTimeout=b,this.capabilities=c,this.conversationsResource=d,this.domains=e,this.limits=f,this.messages=g,this.outbox=h,this.self=i,this.services=j}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV3Response=function(a,b,c,d,e,f,g,h,i,j,k,l,m){this.avayaRequestTimeout=a,this.contacts=b,this.conversationsResource=c,this.domains=d,this.messages=e,this.notificationService=f,this.notifications=g,this.outbox=h,this.picture=i,this.self=j,this.services=k,this.sessionManagement=l,this.users=m}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetConversationsResponse=function(a,b,c,d){this.conversations=a,this.href=b,this.lastUpdated=c,this.moreSearchResults=d;for(var e=0;e<this.conversations.length;e++)for(var f=0;f<this.conversations[e].messages.length;f++){this.conversations[e].messages[f].from._address=this.conversations[e].messages[f].from.address,delete this.conversations[e].messages[f].from.address;for(var g=0;g<this.conversations[e].messages[f].to.length;g++)this.conversations[e].messages[f].to[g]._address=this.conversations[e].messages[f].to[g].address,delete this.conversations[e].messages[f].to[g].address}}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetMessagesResponse=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.attachmentCount=a,this.counts=b,this.flags=c,this.href=d,this.id=e,this.lastAccessedTime=f,this.lastUpdated=g,this.latestEntryTimestamp=h,this.messages=i,this.participants=j,this.subject=k,this.totalCount=l,this.type=m,this.unreadAttachmentCount=n,this.unreadCount=o}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotificationResponse=function(a,b,c,d,e){this.application=a,this.contents=b,this.resource=c,this.service=d,this.version=e}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotifiedResponse=function(a,b,c){this.requestId=a,this.results=b,this.version=c}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ResourceStateResponse=function(a,b){this.results=a,this.version=b}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SendResponse=function(a,b,c,d,e,f,g,h,i,j,k,l,m){this.body=a,this.event=b,this.flags=c,this.from=d,this.href=e,this.id=f,this.lastModifiedDate=g,this.parts=h,this.receivedDate=i,this.subject=j,this.threadId=k,this.to=l,this.inReplyTo=m}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SubscribedResponse=function(a,b){this.results=a,this.version=b}}(),function(){"use strict";AvayaClientServices.Providers.AMM.UnsubscribedResponse=function(a,b){this.results=a,this.version=b}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ValidateUsersResponse=function(a,b){this.addresses=[],this.query=b;for(var c=0;c<a.length;c++){
var d={_address:a[c].address,givenName:a[c].givenName,language:a[c].language,modalities:a[c].modalities,nativeGivenName:a[c].nativeGivenName,nativeSurname:a[c].nativeSurname,surname:a[c].surname,type:a[c].type};this.addresses.push(d)}}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCategories={CLIENT:"Client",USER:"User",SERVICES:"Services",PROVIDERS:"Providers",ANALYTICS:"Analytics",MESSAGING:"Messaging",CONTACTS:"Contacts",CALLS:"Calls",COLLABORATIONS:"Collaborations",CALL_FEATURES:"Call Features"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCustomDimensions={PRODUCT_VENDOR:1,PRODUCT_NAME:2,PRODUCT_VERSION:3,PROVIDER_TYPE:4,MIME_TYPE:5}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsProvidersTypes={CONTACTS:"AADS",MESSAGING:"AMM",CALLS:"AAWG",PRESENCE:"AAWG",VOICE_MESSAGING:"AAWG",COLLABORATION:"WCS",CONFERENCE:"UCCP"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsServicesNames={CALL:"CALL",COLLABORATION:"COLLAB",CONTACT:"CONTACT",MESSAGING:"MSG",PRESENCE:"PRES",VOICE_MESSAGING:"VM"}}(),function(b){"use strict";function c(c){this._servers=[],this._config=c,this._performanceManagerProfile=a,this._callService=a,this._contentSharingService=a,this._screenCapturers=[],this._currentResolution=b.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution],this._isMonitoringAdjustment=!1,this._cameraDeallocated=!1,this._lastCpuUsageWarning=a,this._lastLowBandwidthWarning=a,this._lastBandwidthAvailableWarning=a,this._lastPerformanceAdjustment=0,this._isAdjustmentInProgress=!1,this._performanceAdjustmentsReleaseWindow=b.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.performanceAdjustmentsReleaseWindowDuration")||60,this._interval=2e3,this._isAdjustmentBlocked=!1,this._checkForLowCpuUsage=function(){},this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME=b.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionReductionInterval")||10,this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME=b.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionIncrementInterval")||60,this.CONTENT_SHARING_LOW_QUALITY_PROFILE=1,this.CONTENT_SHARING_HIGH_QUALITY_PROFILE=5,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH=400,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH=800}c.prototype.setCallService=function(a){this._callService=a,this._callService.on(b.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,function(a){this._updatePerformanceManagerProfile(a)}.bind(this)),this._callService.on(b.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,function(a){a?this._cameraDeallocated=a:this._cameraDeallocated&&(this._cameraDeallocated=!this._cameraDeallocated,this._startMonitoringAdjustment())}.bind(this)),this._callService.on(b.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,function(a,b){this._onPerformanceMonitorAlert(a,b)}.bind(this)),this._callService.on(b.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,function(){this._startMonitoringAdjustment()}.bind(this))},c.prototype.registerScreenCapturer=function(a){this._screenCapturers.push(a),a.setPerformanceManagerProfile(this._performanceManagerProfile),a.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},c.prototype.setContentSharingService=function(a){this._contentSharingService=a,this._contentSharingService.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},c.prototype.registerServer=function(a){this._servers.push(a),a.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),a._onStart=function(){}.bind(this),a._onStop=function(){this._lastBandwidthAvailableWarning=0,this._lastLowBandwidthWarning=0,this._servers.splice(this._servers.indexOf(a),1),this._increaseContentSharingQuality(),this._startMonitoringAdjustment()}.bind(this)},c.prototype._stepDownVideoResolution=function(a,c){var d,e,f=1e3*this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME,g=this._callService.getActiveCall();b.Base.Utils.isDefined(g)?this._callService.hasVideoTracks(g)?this._isAdjusmentBlocked(f)||(this._isAdjustmentInProgress=!0,e=this._callService.getVideoSendResolution(g),f=(d=b.Providers.Call.CPUtils.nextLowerVideoResolution(e)).getHeight()<e.getHeight(),e=360<=d.getHeight(),f&&e?(b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Lowering video resolution to "+d+". "+a),this._setVideoResolution(g,d).then(function(){this._startMonitoringAdjustment(),b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Lowered video resolution: ",d)}.bind(this),function(a){b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Failed to lower video resolution: ",a)}.bind(this))):(c&&this._decreaseContentSharingQuality(),this._isAdjustmentInProgress=!1)):c&&this._decreaseContentSharingQuality():(c&&this._decreaseContentSharingQuality(),this._stopMonitoringAdjustment())},c.prototype._stepUpVideoResolution=function(){var a,c,d,e=1e3*this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME,f=this._callService.getActiveCall();b.Base.Utils.isDefined(f)?this._callService.hasVideoTracks(f)&&(this._isAdjusmentBlocked(e)||(this._isAdjustmentInProgress=!0,d=this._callService.getVideoSendResolution(f),a=this._callService.getVideoResolution(f),e=(c=b.Providers.Call.CPUtils.nextHighestVideoResolution(d)).getHeight()>d.getHeight(),d=c.getHeight()<=a.getHeight(),e&&d?(b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Increasing video resolution to "+c),this._setVideoResolution(f,c).then(function(){this._lastCpuUsageWarning=Date.now(),c===a&&this._stopMonitoringAdjustment(),b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Video resolution increased to: ",c)}.bind(this),function(a){this._stopMonitoringAdjustment(),b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Failed to increase video resolution: ",a)}.bind(this))):this._isAdjustmentInProgress=!1)):this._stopMonitoringAdjustment()},c.prototype._increaseContentSharingQuality=function(){this._setContentSharingQuality(this.CONTENT_SHARING_HIGH_QUALITY_PROFILE,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH)},c.prototype._decreaseContentSharingQuality=function(){this._contentSharingService&&this._contentSharingService.isContentSharingActive()&&this._setContentSharingQuality(this.CONTENT_SHARING_LOW_QUALITY_PROFILE,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH)},c.prototype._setContentSharingQuality=function(a,c){this._contentSharingService.getMaxUploadSpeed()!==c?(b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Setting content sharing quality to ("+a+", "+c+"kbps)"),this._contentSharingService.setImageQuality(a),this._contentSharingService.setMaxUploadSpeed(c),this._lastPerformanceAdjustment=Date.now()):b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Content sharing quality remains unchanged, current max upload speed:"+c+"kbps")},c.prototype._setVideoResolution=function(a,c){return this._callService.setVideoSendResolution(a,c).then(function(){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),this._startMonitoringAdjustment(),b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Setting video resolution to: ",c)}.bind(this),function(a){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Failed to set video resolution: ",a)}.bind(this))},c.prototype._throttleAdjustment=function(a){this._isAdjustmentBlocked||(this._isAdjustmentBlocked=!0,a.apply(this,arguments),setTimeout(function(){this._isAdjustmentBlocked=!1}.bind(this),1e3))},c.prototype._isAdjusmentBlocked=function(a){return a=Date.now()-this._lastPerformanceAdjustment<a,this._isAdjustmentInProgress||a},c.prototype._startMonitoringAdjustment=function(){this._isMonitoringAdjustment||(this._isMonitoringAdjustment=!0,this._lastCpuUsageWarning=Date.now(),this._lastLowBandwidthWarning=Date.now(),this._lastBandwidthAvailableWarning=Date.now(),this._checkForLowCpuUsage=function(){var a=(Date.now()-this._lastLowBandwidthWarning)/1e3,b=(Date.now()-this._lastCpuUsageWarning)/1e3,c=(Date.now()-this._lastBandwidthAvailableWarning)/1e3;b>this._performanceAdjustmentsReleaseWindow&&a>this._performanceAdjustmentsReleaseWindow&&c>this._performanceAdjustmentsReleaseWindow&&this._throttleAdjustment(this._stepUpVideoResolution)},this._setInterval=setInterval(this._checkForLowCpuUsage.bind(this),this._interval))},c.prototype._stopMonitoringAdjustment=function(){this._isMonitoringAdjustment&&(this._isMonitoringAdjustment=!1,this._lastCpuUsageWarning=a,this._lastLowBandwidthWarning=a,this._lastBandwidthAvailableWarning=a,clearInterval(this._setInterval))},c.prototype._onPerformanceMonitorAlert=function(a,c){switch(a){case b.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED:this._throttleAdjustment(this._stepDownVideoResolution.bind(this,c,!0));break;case b.Base.PerformanceAlertType.CPU_USAGE_WARNING:this._lastCpuUsageWarning=Date.now();break;case b.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD:this._lastLowBandwidthWarning=Date.now(),this._throttleAdjustment(this._stepDownVideoResolution.bind(this,c,!1));break;case b.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING:this._lastBandwidthAvailableWarning=Date.now()}},c.prototype._updatePerformanceManagerProfile=function(a){this._performanceManagerProfile=b.Providers.ContentSharing.PerformanceManagerProfiles[a]},b.Base.CallPerformanceManager=c}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f){c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Initializing"),c.Base.Observable.call(this),this._config=a,this._csgwProviderFactory=b,this._configCallGwProvider=a,this._mediaServiceFactory=d,this._cpCalls={},this._sdpMediaOfferNotifications={},this._callFailureNotificationsQueue={},this._callEstablishedNotificationsQueue={},this._rtcConfiguration={},this._videoResolution={},this._consultConferencePromises={},this._callsAnalyticsService=e,this._rtcConnectionProviderFactory=f,this._isVideoAllowed=!0,this._browserType=c.Base.Utils.getBrowserType(),this._isServerSupportsNailedUpVideoConnection=a,this._activeCallVideoTrack=a,this._pendingVideoMuteState=a,this._pendingAudioMuteState=a,this._pendingSpeakerMuteState=a,c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Initialized")}(d.prototype=Object.create(c.Base.Observable.prototype)).start=function(d,e){if(this._config=d,this._updateVideoLicense(),!this._isBrowserSupported()&&!this._isConfiguredForMPaaSCollabCall())return b.Deferred().resolve().promise();if(this._config.sgConfiguration===a||!1===this._config.sgConfiguration.enabled)return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Call gateway provider started without config"),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),b.Deferred().resolve().promise();if(this._videoResolution=e,d=this._getHost(),this._configCallGwProvider=this._csgwProviderFactory.getCSGCallsProvider(d),d=!1,this._config.sgConfiguration&&this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest){if(!this._config.mediaServiceContext||!this._config._mediaServiceConfiguration)return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Created default call gateway provider for Guest user"),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),b.Deferred().resolve().promise();var f="csaGuest/sessionId-"+this._getMediaServiceSessionId();this._config.sgConfiguration.credentialProvider.username=f,d=!0}else if(this._configCallGwProvider._isExternalGateway){if(this._configCallGwProvider._started)return c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Registered user CANNOT be assigned to an external call gateway provider."),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[]),b.Deferred().reject("CANNOT be assigned to an external call gateway provider").promise();this._configCallGwProvider._isExternalGateway=!1}return f=!this._config.callUserConfiguration.presentationOnly&&!this._config.mediaServiceContext&&this._config.callUserConfiguration.incomingCall,this._startCallGwProvider(this._configCallGwProvider,this._config.sgConfiguration,f,e,d)},d.prototype._isConfiguredForMPaaSCollabCall=function(){var a=!!this._config.sgConfiguration&&!!this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest,b=!!this._config.wcsConfiguration&&this._config.wcsConfiguration.enabled;return a&&!!this._config.mediaServiceContext&&b},d.prototype.supportsMPaaSCollabCall=function(){var a=!!this._config._mediaServiceConfiguration&&this._config._mediaServiceConfiguration.sessionId;return this._isConfiguredForMPaaSCollabCall()&&a},d.prototype.detectIPv6OnlySupport=function(){var a=b.Deferred(),c=this._rtcConnectionProviderFactory.create();return c._pc.onicecandidate=function(b){var d;b.candidate?(d="candidate:",d=(b=b.candidate.candidate).indexOf(d)+d.length,null!==(d=b.substr(d).split(" ")[4].match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))&&5===d.length&&d[1]<=255&&d[2]<=255&&d[3]<=255&&d[4]<=255&&(c.close(),a.reject())):(c.close(),a.resolve())},c._pc.onicegatheringstatechange=function(){"complete"===c._pc.iceGatheringState&&(c.close(),a.resolve())},c._pc.createOffer({offerToReceiveAudio:1}).then(function(a){c._pc.setLocalDescription(a)},function(b){c.close(),a.reject()}),a.promise()},d.prototype._startCallGwProvider=function(b,d,e,f,g){if(b._removeListeners(),b.on(c.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,this._answerCallRequestedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,this._callRingingHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,this._createMediaRequestHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,this._remoteCallEndedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,this._incomingCallHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,this._callFailureHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,this._callStateFailureHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,this._makeCallRequestedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._callsServiceActivatedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._callsServiceDeactivatedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._networkFailureHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._networkAvailabilityHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.MAX_NETWORK_RECONNECTION_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,this._updateTransferStatusHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,this._updateConsultConferenceStatusHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,this._updateCallDataHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,this._updateCallRequestedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,this._iceConfigUpdatesHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,this._terminateCallRequestedHandler.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,function(a){a&&a.includes("mediaChannelGuidelines")?(this._isServerSupportsNailedUpVideoConnection=!0,this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,[])):(this._isServerSupportsNailedUpVideoConnection=!1,this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,[]))}.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,function(a,b,d){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,[a,b,d])}.bind(this)),b.on(c.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,function(a){this.trigger(c.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,[a])}.bind(this)),b.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),b.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this.isNailedUpVideoConnectionRequired()){var h={};return this.isVideoAllowed()?h.requiredDirection=c.Services.Call.MediaDirection.RECV_ONLY:h.permittedDirection=c.Services.Call.MediaDirection.INACTIVE,b.start(this,d,e,f,h,g)}return b.start(this,d,e,f,a,g)},d.prototype._stopCallGwProvider=function(a,d){var e,f=[],g=this._csgwProviderFactory.getCSGCallsProviderAsArray(),h=[];d?0<(e=g.filter(function(a){return a._host===d})).length&&(h.push(e[0]),f.push(e[0].stop())):g.forEach(function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Stopping call gateway provider for "+a._host),h.push(a),f.push(a.stop())}),b.when.apply(b,f).then(function(){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Stopped call gateway provider(s)");for(var b=0;b<h.length;b++)h[b]._removeListeners(),h[b]._cpCalls={};a.resolve()}.bind(this),function(b){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Error encountered while stopping call gateway provider(s)",b);for(var d=0;d<h.length;d++)h[d]._removeListeners(),h[d]._cpCalls={};a.reject(b)}.bind(this)).always(function(){for(var a=0;a<h.length;a++)delete this._csgwProviderFactory._csgCallsProviderMap[h[a]._host]}.bind(this))},d.prototype.stop=function(a){if(!this._isBrowserSupported())return b.Deferred().resolve().promise();this._triggerEndCalls(a);var c=b.Deferred();return this._stopCallGwProvider(c,a),c.promise()},d.prototype.stopImmediately=function(){var a=b.Deferred(),d=[];return this._csgwProviderFactory.getCSGCallsProviderAsArray().forEach(function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Force stopping call gateway provider for "+a._host),d.push(a.stopImmediately())}),b.when.apply(b,d).then(function(){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Force stopped call gateway provider(s)"),a.resolve()}.bind(this),function(b){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Failed to force stop call gateway provider(s)"),a.reject()}.bind(this)),a.promise()},d.prototype.startCall=function(d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r=b.Deferred();return d._isGuestUser?(p=this._config.sgConfiguration.networkProviderConfiguration.restConfig,l=this._configCallGwProvider._host,m=this._csgwProviderFactory.getCSGCallsProvider(l),n=new c.Config.ServerInfo(p.hostName,p.port,p.isSecure,p.path),o=this._config.sgConfiguration.credentialProvider.getDisplayName()):c.Base.Utils.isDefined(d._callCreationInfo)&&c.Base.Utils.isDefined(d._callCreationInfo.getServiceGatewayURL())&&(p=d._callCreationInfo.getServiceGatewayURL(),q=c.Base.Utils.parseUrl(p),l=c.Base.Utils.getHost(q),m=this._csgwProviderFactory.getCSGCallsProvider(l),p=l.split(":"),n=new c.Config.ServerInfo(p[0],p[1],q.isSecure,q.path),q=d._callCreationInfo.getAuthorizationToken(),o=d._callCreationInfo.getMeetMeUserName()),m?m._started&&!m._isExternalGateway?(c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Guest user cannot be assigned non external gateway provider"),r.reject("CANNOT assign guest to non external gateway provider")):this._getGatewayCalls(d,l).length||m._isExternalGateway?this._startNewCall(d,e,f,g,h,i,j,r,m,k):this._startExternalGwCall(m,n,o,q,d,e,f,g,h,i,j,r,k):this._startNewCall(d,e,f,g,h,i,j,r,a,k),r.promise()},d.prototype._startExternalGwCall=function(b,d,e,f,g,h,i,j,k,l,m,n,o){var p=new c.Config.SGConfiguration;f!==a?p.credentialProvider=new c.Config.CredentialTokenProvider(f,c.Config.Authentication.TokenType.ESGTOKEN):(p.credentialProvider=new c.Config.GuestCredentialProvider(e),p.credentialProvider.username=this._config.sgConfiguration.credentialProvider.username),p.enabled=!0,p.networkProviderConfiguration=new c.Config.NetworkProviderConfiguration,p.networkProviderConfiguration.restConfig=d,this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.maxCallStartReconnectionAttempts?p.maxCallStartReconnectionAttempts=this._config.sgConfiguration.maxCallStartReconnectionAttempts:p.maxCallStartReconnectionAttempts=-1,this._startCallGwProvider(b,p,!1,m,!0).then(function(){this.isNailedUpVideoConnectionRequired()&&!this.isServerSupportsNailedUpVideoConnection()?n.reject():(this._startNewCall(g,h,i,j,k,l,m,n,b,o),n.resolve())}.bind(this),function(a){n.reject(a)})},d.prototype._startNewCall=function(b,c,d,e,f,g,h,i,j,k){this._createCPCall(b,a,a,h,j).startCall(f,g,c,d,e,k),i.resolve()},d.prototype._createCPCall=function(a,b,d,e,f){return f=c.Base.Utils.isDefined(f)?f:this._configCallGwProvider,e=new c.Providers.Call.CPCall(a,this,f,e),e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),e.callId=b,e.incomingCallInfo=d,e},d.prototype.updateCpCall=function(a,b){a.call.getCallId()!==b&&(delete this._cpCalls[a.call.getCallId()],a.call._setCallId(b),this._cpCalls[b]=a)},d.prototype.updateVideoResolution=function(a,d){var e=this._cpCalls[a.getCallId()];if(e){var f=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),a=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return e.updateVideoResolution(a,f,d)}return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.updateDevices=function(a,d){var e=this._cpCalls[a.getCallId()];if(e){if(e.isMPaaSCollabCall())return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var f=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),a=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return e.updateDevice(a,f,d)}return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.startContentVideoSharing=function(a,d){var e=this._cpCalls[a];return e?(a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e.startContentVideoSharing(d,a)):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.stopContentVideoSharing=function(a){return a=this._cpCalls[a],a?a.stopContentVideoSharing():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.updateAudioSourceForVideoSharing=function(a,d){return a=this._cpCalls[a],a?a.updateAudioSourceForVideoSharing(d):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.stopCall=function(a,d){var e=b.Deferred(),f=this._cpCalls[a.getCallId()];return f?(f.end(d),this.stopExternalGatewayProvider(a).always(function(){e.resolve()})):e.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),e.promise()},d.prototype.stopExternalGatewayProvider=function(d){var e,f,g=b.Deferred();return d._isGuestUser&&c.Base.Utils.isUndefined(d._sessionId)?f=this._configCallGwProvider._host:d._callCreationInfo!==a&&d._callCreationInfo.getServiceGatewayURL()!==a&&d._callCreationInfo.getAuthorizationToken()!==a&&(e=d._callCreationInfo.getServiceGatewayURL(),e=c.Base.Utils.parseUrl(e),f=c.Base.Utils.getHost(e)),f&&0===this._getGatewayCalls(d,f).length?this._stopCallGwProvider(g,f):g.reject(),g.promise()},d.prototype.isExternalGatewayCall=function(a,b){var d;return a._isGuestUser?d=this._configCallGwProvider._host:a._callCreationInfo&&c.Base.Utils.isDefined(a._callCreationInfo.getServiceGatewayURL())&&c.Base.Utils.isDefined(a._callCreationInfo.getAuthorizationToken())&&(a=a._callCreationInfo.getServiceGatewayURL(),a=c.Base.Utils.parseUrl(a),d=c.Base.Utils.getHost(a)),b===d},d.prototype.accept=function(a,d,e){var f=b.Deferred(),g=this._cpCalls[a.getCallId()];return g?(g.call.getVideoChannels().length||this.setVideoMode(a,c.Services.Call.VideoMode.DISABLE,e,!1),g.acceptCall(d,e),f.resolve()):f.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),f.promise()},d.prototype.acceptSendVideo=function(a,d,e){var f=this._cpCalls[a.getCallId()];if(f){if(f.isMPaaSCollabCall())return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var g,a=f.call.getVideoChannels();return 0<a.length?(a[0]._setRequestedDirection(c.Providers.Call.Utils.getVideoDirection(e)),g=a[0]):(g=this._createVideoChannel_VideoMode(e),f.call.getVideoChannels().push(g)),this.triggerVideoChannelUpdate(f.call),f.acceptSendVideo(d,g)}return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype.denySendVideo=function(a){var d=b.Deferred(),a=this._cpCalls[a.getCallId()];if(a){if(a.isMPaaSCollabCall())return d.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));a.denySendVideo(),d.resolve()}else d.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND));return d.promise()},d.prototype.registerIncomingOrRemoteCall=function(a){var b,d=this._cpCalls[a.getCallId()];d&&(c.Base.Utils.isUndefined(a.getAudioChannel())&&(b=this.createAudioChannel_AudioMode(c.Services.Call.AudioMode.SEND_RECEIVE),a._audioChannel=b),d.call=a,this.registerCall(a.getCallId(),a,d))},d.prototype.getCalls=function(a){return c.Base.Utils.isDefined(a)?this._csgwProviderFactory.getCSGCallsProvider(a).getCalls():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)).promise()},d.prototype.getClients=function(a){return c.Base.Utils.isDefined(a)?this._csgwProviderFactory.getCSGCallsProvider(a).getClients():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)).promise()},d.prototype.getCall=function(a,d){return c.Base.Utils.isDefined(d)?this._csgwProviderFactory.getCSGCallsProvider(d).getCall(a):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)).promise()},d.prototype.getClient=function(a,d){return c.Base.Utils.isDefined(d)?this._csgwProviderFactory.getCSGCallsProvider(d).getClient(a):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)).promise()},d.prototype.lookupCall=function(b){return this._cpCalls.hasOwnProperty(b)?this._cpCalls[b].call:a},d.prototype.muteAudio=function(a){var c=this._cpCalls[a.getCallId()];return c?(c.muteAudio(),a.isConference()&&a.getConference()._sendLocalMuteEvent(!0),b.Deferred().resolve().promise()):(this._pendingAudioMuteState=a._audioMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.unmuteAudio=function(a){var c=this._cpCalls[a.getCallId()];return c?(c.unmuteAudio(),a.isConference()&&a.getConference()._sendLocalMuteEvent(!1),b.Deferred().resolve().promise()):(this._pendingAudioMuteState=a._audioMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.muteVideo=function(a){var c=this._cpCalls[a.getCallId()];return c?c.muteVideo():(this._pendingVideoMuteState=a._videoMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.unmuteVideo=function(a){var c=this._cpCalls[a.getCallId()];return c?c.unmuteVideo():(this._pendingVideoMuteState=a._videoMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.muteSpeaker=function(a){var c=this._cpCalls[a.getCallId()];return c?(c.muteSpeaker(),b.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=a._speakerMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.unmuteSpeaker=function(a){var c=this._cpCalls[a.getCallId()];return c?(c.unmuteSpeaker(),b.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=a._speakerMuteState,b.Deferred().resolve("Queued").promise())},d.prototype.hold=function(a){return(a=this._cpCalls[a.getCallId()])?a.hold():void b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.unhold=function(a){return a=this._cpCalls[a.getCallId()],a?a.unhold():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.transfer=function(a,d){return a=this._cpCalls[a.getCallId()],a?a.transfer(d):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.attendedTransfer=function(a,d){return a=this._cpCalls[a.getCallId()],a?a.attendedTransfer(d.getCallId()):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.join=function(a,d){return a=this._cpCalls[a.getCallId()],a?a.join(d):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.sendDTMF=function(a,d){var e=b.Deferred(),a=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(a)?(a.sendDTMF(d),e.resolve()):e.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),e.promise()},d.prototype.setVideoMode=function(a,d,e,f){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"setVideoMode direction: "+d);var g,h=this._cpCalls[a.getCallId()];return 0===a.getVideoChannels().length&&(g=this._createVideoChannel_VideoMode(a,d),d===c.Services.Call.VideoMode.DISABLE&&(a.isIncoming()?g._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER):g._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),a._videoChannels.push(g)),c.Base.Utils.isDefined(h)&&a.getState()!==c.Services.Call.CallStates.IDLE&&a.getState()!==c.Services.Call.CallStates.ALERTING&&a.getState()!==c.Services.Call.CallStates.IGNORED?h.updateVideoMode(d,e,f):(this.triggerVideoChannelUpdate(a),b.Deferred().resolve())},d.prototype.setVideoSendResolution=function(a,b){return this._cpCalls[a.getCallId()].setVideoSendResolution(b)},d.prototype.getVideoSendBandwidth=function(a){return this._cpCalls[a.getCallId()].getVideoSendBandwidth()},d.prototype.getVideoBandwidth=function(a){return this._cpCalls[a.getCallId()].getVideoBandwidth()},d.prototype.getVideoResolution=function(a){if(a=this._cpCalls[a.getCallId()])return a.getVideoResolution()},d.prototype.getVideoSendResolution=function(a){if(a=this._cpCalls[a.getCallId()])return a.getVideoSendResolution()},d.prototype.hasVideoTracks=function(a){return!(!c.Base.Utils.isDefined(a)||!(a=this._cpCalls[a.getCallId()]))&&a.hasVideoTracks()},d.prototype.setAudioMode=function(a,d){var e,f,g=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(a.getAudioChannel())||(f=this.createAudioChannel_AudioMode(d),a._audioChannel=f),c.Base.Utils.isDefined(g)?(e=b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.FAILED)),c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"set audio is not supported")):(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"audio is set: "+d),e=b.Deferred().resolve()),e},d.prototype.setWebCollaboration=function(a,d){var e,a=this._cpCalls[a.getCallId()];
return c.Base.Utils.isDefined(a)?(e=b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.FAILED)),c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"set web collaboration is not supported")):(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"web collaboration is set: "+d),e=b.Deferred().resolve()),e},d.prototype.addParticipantFromCall=function(a,d){var e=this._cpCalls[a];return c.Base.Utils.isDefined(e)?e.call.getConference().getAddParticipantFromCallCapability(d).isAllowed?(a=d.getCallId(),this._consultConferencePromises[a]=b.Deferred(),e.addParticipantFromCall(d),this._consultConferencePromises[a]):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype.getCallStatistics=function(a){var d,e=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(e)?(d=a.getAudioChannel(),a=a.getVideoChannels(),d=!!d&&d.getRequestedDirection()!==c.Services.Call.MediaDirection.DISABLE&&d._getNegotiatedDirection()!==c.Services.Call.MediaDirection.DISABLE,a=!!a&&0!==a.length&&a[0].getRequestedDirection()!==c.Services.Call.MediaDirection.DISABLE&&a[0].getNegotiatedDirection()!==c.Services.Call.MediaDirection.DISABLE,d||a?e.getCallStatistics():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.STATISTICS_UNAVAILABLE)).promise()):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)).promise()},d.prototype._triggerEndCalls=function(a){for(var b in this._cpCalls)!this._cpCalls.hasOwnProperty(b)||this._cpCalls[b]._callGatewayProvider._host!==a&&a||((b=this._cpCalls[b]).stopAllStreams(),this.unRegisterCall(b.call)&&this._triggerAsyncEndCall(b.call))},d.prototype._triggerAsyncEndCall=function(a){setTimeout(function(){this.triggerCallEnded(a)}.bind(this),0)},d.prototype.getMediaServiceFactory=function(){return this._mediaServiceFactory},d.prototype.startRinging=function(a){var d=b.Deferred(),a=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(a)?(a.startRinging(),d.resolve()):d.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),d.promise()},d.prototype.acceptAnswerCallRequest=function(a){return this._acceptCallRequest(a,c.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},d.prototype.acceptUpdateCallRequest=function(a,b){return this._acceptCallRequest(a,c.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,b)},d.prototype.acceptTerminateCallRequest=function(a){return this._acceptCallRequest(a,c.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},d.prototype.acceptMakeCallRequest=function(a){return this._acceptCallRequest(a,c.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},d.prototype._acceptCallRequest=function(a,d,e){var f=b.Deferred(),a=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(a)?a.acceptCallRequest(f,d,e):f.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),f.promise()},d.prototype.rejectAnswerCallRequest=function(a){return this._rejectCallRequest(a,c.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},d.prototype.rejectUpdateCallRequest=function(a,b){return this._rejectCallRequest(a,c.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED)},d.prototype.rejectTerminateCallRequest=function(a){return this._rejectCallRequest(a,c.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},d.prototype.rejectMakeCallRequest=function(a){return this._rejectCallRequest(a,c.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},d.prototype._rejectCallRequest=function(a,d){var e=b.Deferred(),a=this._cpCalls[a.getCallId()];return c.Base.Utils.isDefined(a)?a.rejectCallRequest(e,d):e.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)),e.promise()},d.prototype.getOfferSDP=function(b,c,d,e,f,g,h,i){var j=this._cpCalls[b];j&&j.isReadyToReceiveMediaRequest()?j.getOfferSDP(c,d,e,f,a,a,g,h,i):this._sdpMediaOfferNotifications[b]={action:c,audioStream:d,videoStreams:e,videoBandwidth:f,turnData:g,restartTurnGathering:h,useIPv6Candidates:i}},d.prototype.getQueuedMediaOfferNotification=function(a){var b=this._sdpMediaOfferNotifications[a];return b&&delete this._sdpMediaOfferNotifications[a],b},d.prototype.getQueuedCallFailure=function(a){var b=this._callFailureNotificationsQueue[a];return b&&delete this._callFailureNotificationsQueue[a],b},d.prototype.getQueuedVideoMuteState=function(){var b=this._pendingVideoMuteState;return this._pendingVideoMuteState=a,b},d.prototype.getQueuedAudioMuteState=function(){var b=this._pendingAudioMuteState;return this._pendingAudioMuteState=a,b},d.prototype.getQueuedSpeakerMuteState=function(){var b=this._pendingSpeakerMuteState;return this._pendingSpeakerMuteState=a,b},d.prototype.queueCallEstablishedNotification=function(a,b,c,d,e,f,g,h,i,j,k,l){this._callEstablishedNotificationsQueue[a]={address:b,displayName:c,audioStream:d,videoStreams:e,isConference:f,uccpUrl:g,webCollabUrl:h,ucid:j,parentUcid:k,contextId:l}},d.prototype.getQueuedCallEstablishedNotification=function(a){var b=this._callEstablishedNotificationsQueue[a];return b&&delete this._callEstablishedNotificationsQueue[a],b},d.prototype.offerSDP=function(a,b,c,d,e,f,g){var h=this._cpCalls[a];h&&h.isReadyToReceiveMediaRequest()?h.offerSDP(c,b,d,e,f,g):this._sdpMediaOfferNotifications[a]={action:b,audioStream:d,videoStreams:e,offer:c,videoBandwidth:f,turnData:g}},d.prototype.callRinging=function(a,b,d,e,f,g,h,i,j){var k=this._cpCalls[a];k?(k.call._isEarlyMedia&&!h&&this.stopEarlyMedia(k.call),k.callRinging(b,d,e,f,g,h,i,j)):c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+a)},d.prototype.answerSDP=function(a,b,d,e,f,g){var h=this._cpCalls[a];h?h.answerSDP(d,b,e,f,g):c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+a)},d.prototype.answerSdpAck=function(a,b,d,e){var f=this._cpCalls[a];f?f.answerSdpAck(b,d,e):c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+a)},d.prototype.callEstablished=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=this._cpCalls[a];if(c.Base.Utils.isDefined(j)&&this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[j]),t)c.Base.Utils.isDefined(q)?t.callEstablished(b,d,k,l,m,n,o,f,q,r,s):t.callEstablished(b,d,k,l,m,n,o,f);else{if(!f)return c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Queue established because call is not found: ",a),void this.queueCallEstablishedNotification(a,b,d,k,l,m,n,o,p,q,r,s);this._isWebRTCSupportedBrowser()?(p={remoteAddress:b,remoteDisplayName:d,isAuraAsserted:i,isPrivate:g,alertType:h,audioStream:k,videoStreams:l,videoResolution:k=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(p,this._videoResolution)||this._videoResolution},t=this._createCPCall(null,a,p,k),this.isSolutionSupportsNailedUpConnection()&&t.setNailedUpVideoConnectionSupported(!0),this._cpCalls[a]=t,this.triggerRemoteCallCreated(a,b,d,i,g,this._isVideoCall(l),h,e)):c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Remote call is not supported: ",a)}},d.prototype.callEndedRemotely=function(a,b){var d=this._cpCalls[a];d?d.callEndedRemotely(b):c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+a)},d.prototype.callStateFailure=function(a,b){a=this._cpCalls[a],a&&a.callStateFailure(b)},d.prototype.callFailure=function(a,b,c,d,e){var f=this._cpCalls[a];f?f.callFailure(b,c,d,e):this._callFailureNotificationsQueue[a]={errorCode:b,protocolType:c,protocolErrorCode:d,failureReason:e}},d.prototype.stopEarlyMedia=function(a){var b,d=this._cpCalls[a];d?(b=this.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),d.stopEarlyMedia(b)):c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+a)},d.prototype.triggerCallStarted=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,[a])},d.prototype.triggerCallRinging=function(a,b){b=!!c.Base.Utils.isDefined(b)&&b,this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,[a,b])},d.prototype.triggerCallEstablished=function(a,b,d,e,f,g,h,i){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,[a,b,f,g,h,i]),this.triggerConferenceEscalation(a,d,e,b)},d.prototype.triggerCallEstablishing=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,[a])},d.prototype.triggerRemoteStreamAdded=function(a,b){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.REMOTE_STREAM_ADDED,[a,b])},d.prototype.triggerCallEnded=function(a,b,d){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,[a,b,d])},d.prototype.triggerRemoteCallCreated=function(a,b,d,e,f,g,h,i){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,[a,b,d,e,f,g,h,i])},d.prototype.triggerIncomingCall=function(a,b,d,e,f,g,h,i,j,k,l){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,[a,b,d,e,f,g,h,i,j,k,l])},d.prototype.triggerIncomingAddVideoRequest=function(a,b){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,[a,b])},d.prototype.triggerIncomingAddVideoAccepted=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,[a])},d.prototype.triggerIncomingAddVideoDenied=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,[a])},d.prototype.triggerIncomingAddVideoTimedout=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,[a])},d.prototype.triggerVideoChannelUpdate=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,[a])},d.prototype.triggerConferenceEscalation=function(a,b,d,e){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,[a,b,d,e])},d.prototype.triggerVideoEscalationRejected=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.VIDEO_ESCALATION_REJECTED,[a])},d.prototype.triggerCallFailure=function(a,b,d,e,f){a=this._cpCalls[a],a&&this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[a.call,b,d,e,f])},d.prototype.triggerCallServiceUnavailable=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[a])},d.prototype.triggerRemoteHold=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,[a])},d.prototype.triggerRemoteUnhold=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,[a])},d.prototype.triggerRemoteAddressChanged=function(a,b,d,e,f,g){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,[a,b,d,e,f,g])},d.prototype.triggerAllowedNailedUpVideoModes=function(a,b){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,[a,b])},d.prototype.triggerMediaConnectionUpdate=function(a,b){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,[a,b])},d.prototype.triggerCallMediaFailed=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,[a])},d.prototype.triggerMediaRecoveryInitiated=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,[a])},d.prototype.registerCall=function(a,b,d){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"register call: "+a),b._setCallId(a),this._cpCalls[a]=d},d.prototype.unRegisterCall=function(a){if(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"unregister call: "+a.getCallId());var b=this._cpCalls[a.getCallId()];if(b)return b.cleanupImmediately(),delete this._cpCalls[a.getCallId()],!0}return!1},d.prototype.isVideoConfigurationEnabled=function(){return this._config.callUserConfiguration.videoEnabled},d.prototype._callRingingHandler=function(a,b,d,e,f,g,h,i,j){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Call Ringing"),this.callRinging(a,b,d,e,f,g,h,i,j)},d.prototype._callEstablishedHandler=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Received Call Established"),this.callEstablished(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s)},d.prototype._createMediaRequestHandler=function(a,b,d,e,f,g,h){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Create Media Request"),this.getOfferSDP(a,b,d,e,f,g,!1,h)},d.prototype._remoteCallEndedHandler=function(a,b){var d="Received Remote Call Ended";b&&(d=d+": ["+b.getProtocol()+","+b.getCause()+","+b.getText()+"]"),c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,d),this.callEndedRemotely(a,b)},d.prototype._incomingCallHandler=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(m,this._videoResolution)||this._videoResolution;c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Received Incoming Call"),q={remoteAddress:b,remoteDisplayName:d,isAuraAsserted:e,isPrivate:f,alertType:g,sdp:i,audioStream:j,videoStreams:k,turnData:q},r=this._createCPCall(null,a,q,r),r.determineIfNailedUpVideoConnectionSupported(k),r._isReadyToReceiveMediaRequest=!0,r._updateVideoBandwidth(m),this._cpCalls[a]=r,this.triggerIncomingCall(a,b,d,e,f,this._isVideoCall(k),g,l,n,o,p)},d.prototype._callFailureHandler=function(a,b,d,e,f){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Call Failure: ["+b+":"+d+":"+e+":"+f+"]"),this.callFailure(a,b,d,e,f)},d.prototype._callStateFailureHandler=function(a,b,d,e,f){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Call State Failure: ["+b+":"+d+":"+e+":"+f+"]"),this.callStateFailure(a,b)},d.prototype._networkFailureHandler=function(a,b,d){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Network Failure: ["+a+":"+b+":"+d+"]");var e,f,g=!1;for(e in this._cpCalls)!this._cpCalls.hasOwnProperty(e)||(f=this._cpCalls[e])&&f.call&&f._callGatewayProvider&&f._callGatewayProvider._host===a&&(f.setCallServiceAvailable(!1),this.triggerCallServiceUnavailable(f.call),this._callsAnalyticsService.sendUnavailableEvent(c.Services.Analytics.AnalyticsErrorCode.NETWORK_ERROR),g=!0);g||(this.triggerCallServiceUnavailable(),this._callsAnalyticsService.sendUnavailableEvent(c.Services.Analytics.AnalyticsErrorCode.NO_CALL_WAS_CREATED_ERROR))},d.prototype._maxNetworkRecoveryAttemptedHandler=function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Maximum Network Recover Attempted: "+a),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,[a])},d.prototype._callsServiceDeactivatedHandler=function(a,b){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Calls Service Deactivated: "+a+":"+b),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,[a,b])},d.prototype._networkAvailabilityHandler=function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Network Availability: "+a),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),this.getCalls(a).then(function(b){for(var d in this._cpCalls)if(this._cpCalls.hasOwnProperty(d)){var e=this._cpCalls[d];if(e._callGatewayProvider&&e._callGatewayProvider._host===a){for(var f=!1,g=0;g<b.length;g++)b[g].callId===d&&(f=!0,e.setCallServiceAvailable(!0),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[e.call]));f||e.triggerCallMediaFailed()}}}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Failed to get list of active calls from server",a)}.bind(this))},d.prototype._callsServiceActivatedHandler=function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Calls Service Activated: "+a),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,[a])},d.prototype._updateTransferStatusHandler=function(a,b){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Transfer Status Update: "+b),this._cpCalls.hasOwnProperty(a)&&((a=this._cpCalls[a])._transferPromise.notify(b),b===c.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_DONE?a.transferCompleted():b===c.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_FAILED&&a.transferFailed())},d.prototype._updateConsultConferenceStatusHandler=function(a,b){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Consult Conference Status Update: "+b),this._consultConferencePromises.hasOwnProperty(a)&&(this._consultConferencePromises[a].notify(b),b===c.Providers.Call.CallProvider.Constants.CONSULT_CONFERENCE_STATUS_DONE?(this._consultConferencePromises[a].resolve(),delete this._consultConferencePromises[a]):(b===c.Providers.Call.CallProvider.CONSULT_CONFERENCE_STATUS_FAILED||-1<b.indexOf(c.Providers.Call.CallProvider.Constants.ERROR))&&(c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Failed to add "+a+" to Consult Conference: "+b),this._consultConferencePromises[a].reject(b),delete this._consultConferencePromises[a]))},d.prototype._updateCallDataHandler=function(a,b,d,e,f,g,h,i,j){var k,l,m,n,o;c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Received Call Data Update: ["+a+":"+b+":"+d+":"+f+":"+g+":"+h+"]"),this._cpCalls.hasOwnProperty(a)&&(o=(m=(l=(k=this._cpCalls[a]).call).isConference())&&l.getConference(),n=m&&o._isConferenceStarted(),a=m&&o._isStarting,o=m?o._getType():"unknown",c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,(m?"Conference":"Non-Conference")+" Data Update: [Existing conference call? "+m+"; Is conference started? "+n+"; Is conference starting? "+a+"; Conference type="+o+"; uucpUrl="+f+"; webCollabUrl="+g+"]"),c.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(this,l,b,d,h,i,j),e&&(!m||m&&!n&&!a||f||g)&&k.hasReceivedCallEstablishedEvent()&&this.triggerConferenceEscalation(k.call,f,g,e))},d.prototype._iceConfigUpdatesHandler=function(a){if(a&&0<a.length)if(this._rtcConfiguration={iceServers:[{urls:""}]},1===a.length)this._rtcConfiguration.iceServers[0].urls="stun:"+a[0];else{for(var b=[],c=0;c<a.length;c++)b.push("stun:"+a[c]);this._rtcConfiguration.iceServers[0].urls=b}},d.prototype._videoLicenseUpdatedHandler=function(a){this._updateVideoLicense(a),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,[a])},d.prototype._createVideoChannel_VideoMode=function(a,b){return a=new c.Services.Call.VideoChannel(a),a._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),a._setRequestedDirection(c.Providers.Call.Utils.getVideoDirection(b)),a},d.prototype.createAudioChannel_AudioMode=function(a){var b=new c.Services.Call.AudioChannel;return b._setRequestedDirection(c.Providers.Call.Utils.getAudioDirection(a)),b},d.prototype.createVideoChannel_MediaDirection=function(a,b){return a=new c.Services.Call.VideoChannel(a),a._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),a._setRequestedDirection(b),a},d.prototype.hasVideoDevices=function(){return this._mediaServiceFactory.getVideoInterface().hasAvailableDevices()},d.prototype.isNailedUpVideoConnectionRequired=function(){return this._browserType===c.Base.BrowserType.EDGE},d.prototype.isServerSupportsNailedUpVideoConnection=function(){return!c.Base.Utils.isDefined(this._isServerSupportsNailedUpVideoConnection)||this._isServerSupportsNailedUpVideoConnection},d.prototype.isSolutionSupportsNailedUpConnection=function(){return this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()},d.prototype.isVideoAllowed=function(){return this._isVideoAllowed},d.prototype._isVideoCall=function(a){if(c.Base.Utils.isDefined(a)&&0<a.length&&a[0].enabled){var b=a[0].direction;return this.isSolutionSupportsNailedUpConnection()?!c.Services.Call.MediaDirection._isDisabled(b)&&a[0].logicalDirection!==c.Services.Call.MediaDirection.INACTIVE:!c.Services.Call.MediaDirection._isDisabled(b)&&b!==c.Services.Call.MediaDirection.INACTIVE}return!1},d.prototype._ringbackToneURLsChangedHandler=function(a){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,[a])},d.prototype._isBrowserSupported=function(){var a=c.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers");return c.Base.Utils.isWebRTC_SupportedBrowser(a)},d.prototype._isTurnTlsHasHighestPriority=function(){return c.Base.Utils.queryJSONObject(this._config,"sgConfiguration._setTurnTlsToHighestPriority")},d.prototype._answerCallRequestedHandler=function(a,b){this._cpCalls.hasOwnProperty(a)&&((a=this._cpCalls[a]).setCallRequestedTransactionalId(c.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED,b),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,[a.call]))},d.prototype._terminateCallRequestedHandler=function(a,b){this._cpCalls.hasOwnProperty(a)&&((a=this._cpCalls[a]).setCallRequestedTransactionalId(c.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED,b),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,[a.call]))},d.prototype._updateCallRequestedHandler=function(a,b,d){this._cpCalls.hasOwnProperty(a)&&((a=this._cpCalls[a]).setCallRequestedTransactionalId(c.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,b),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,[a.call,d]))},d.prototype._makeCallRequestedHandler=function(b,d,e,f,g,h){var i=this._createCPCall(null,b,a,this._videoResolution);(this._cpCalls[b]=i).setCallRequestedTransactionalId(c.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED,e),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,[b,d,f,g,h])},d.prototype._updateVideoLicense=function(a){var b=c.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");c.Base.Utils.isDefined(b)&&(this._isVideoAllowed=this._isVideoAllowed&&b),a&&(this._isVideoAllowed=this._isVideoAllowed&&a)},d.prototype._isWebRTCSupportedBrowser=function(){var a=c.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),a=c.Base.Utils.isWebRTC_SupportedBrowser(a);return this.isNailedUpVideoConnectionRequired()?a&&this.isServerSupportsNailedUpVideoConnection():a},d.prototype.setActiveCallVideoTrack=function(b){this._activeCallVideoTrack=a,this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()&&(!this._cpCalls.hasOwnProperty(b)||0<(b=this._cpCalls[b]).getVideoStreams().length&&b.localStream.getVideoTracks().forEach(function(a){a.readyState!==c.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(this._activeCallVideoTrack=a)}.bind(this)))},d.prototype.getActiveCallVideoTrack=function(){return this._activeCallVideoTrack},d.prototype._getGatewayCalls=function(a,b){return a._callService._callManager.getAllCalls().filter(function(c){return!!c.getCallId()&&!!this._cpCalls[c.getCallId()]&&c.getCallId()!==a.getCallId()&&this._cpCalls[c.getCallId()]._callGatewayProvider._host===b}.bind(this))},d.prototype._getHost=function(){var a=this._config.sgConfiguration.networkProviderConfiguration.restConfig,b=a.isSecure?c.Base.Utils.isDefined(a.port)?a.port:"443":c.Base.Utils.isDefined(a.port)?a.port:"80";return a.hostName+":"+b},d.prototype._getCsgCallsProvider=function(){var a=this._getHost();return this._csgwProviderFactory.getCSGCallsProvider(a)},d.prototype.setOnNetworkEvents=function(a,d){var e=this._getMediaServiceSessionId();if(!e){var f=new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE);return c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,f),b.Deferred().reject(f).promise()}return a={sessionId:e,acceptedEvents:a},this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.setOnNetworkEvents(a,d)},d.prototype.isNetworkEventsUrlDefined=function(){var a=!1;return this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(this._csgCallsProvider=this._getCsgCallsProvider(),a=this._csgCallsProvider.isNetworkEventsUrlDefined()),a},d.prototype.removeOnNetworkEvents=function(){var a=this._getMediaServiceSessionId();return a?(this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.removeOnNetworkEvents(a)):(a=new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE),c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,a),b.Deferred().reject(a).promise())},d.prototype._getMediaServiceSessionId=function(){var a;return a=this._config._mediaServiceConfiguration?this._config._mediaServiceConfiguration.sessionId:a},d.prototype.isMediaConnected=function(a){return a=this._cpCalls[a.getCallId()],!!a&&a.isMediaConnected()},d.prototype.updatePreferredResolution=function(d,e){var f=this._cpCalls[d._call.getCallId()];return f===a?b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND)):f.updatePreferredResolution(d,e)},d.prototype.setPreferredReceiveResolution=function(a,d,e){return a=this._cpCalls[a.getCallId()],a?a.setPreferredReceiveResolution(d,e):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_NOT_FOUND))},d.prototype._onPerformanceMonitorAlert=function(a,b){this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,[a,b])},c.Providers.Call.CallProvider=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallProvider.Constants={DISABLE_STATE:"DISABLE",ENABLE_STATE:"ENABLE",ERROR:"ERROR",ADD_VIDEO:"ADD_VIDEO",UPDATE_VIDEO:"UPDATE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",HOLD:"HOLD",INCOMING_UNHOLD:"INCOMING_UNHOLD",UNHOLD:"UNHOLD",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",ADD_PARTICIPANT_ACTION:"ADD_PARTICIPANT",ADD_VIDEO_ACTION:"ADD_VIDEO",HOLD_ACTION:"HOLD",UNHOLD_ACTION:"UNHOLD",INCOMING_ADD_VIDEO_ACTION:"INCOMING_ADD_VIDEO",INCOMING_REMOVE_VIDEO_ACTION:"INCOMING_REMOVE_VIDEO",INCOMING_UPDATE_VIDEO_ACTION:"INCOMING_UPDATE_VIDEO",INCOMING_HOLD_ACTION:"INCOMING_HOLD",INCOMING_UNHOLD_ACTION:"INCOMING_UNHOLD",TRANSFER_ACTION:"TRANSFER",TRANSFER_STATUS_DONE:"DONE",TRANSFER_STATUS_FAILED:"FAILED",CONSULT_CONFERENCE_STATUS_DONE:"DONE",CONSULT_CONFERENCE_STATUS_FAILED:"FAILED",END_CALL_BY_REMOTE:"remote",END_CALL_NORMAL:"normal",END_CALL_DENY_WITH_REASON:"denyWithReason",INITIAL_MEDIA:"INITIAL_MEDIA",DEFAULT_CALL_GW_PROVIDER:"DefaultCallGWProvider",ANSWER_CALL_REQUESTED:"AnswerCallRequested",MAKE_CALL_REQUESTED:"MakeCallRequested",TERMINATE_CALL_REQUESTED:"TerminateCallRequested",UPDATE_CALL_REQUESTED:"UpdateCallRequested",ICE_CANDIDATE_TYPE_RELAY_ONLY:"relayOnly",ICE_CANDIDATE_TYPE_HOST_ONLY:"hostOnly"}}(),function(a){"use strict";var b=a.Providers.Call.States={};b.INITIAL=new a.Base.SimpleFsm.SimpleFsmState("INITIAL"),b.STARTING=new a.Base.SimpleFsm.SimpleFsmState("STARTING"),b.ALERTING=new a.Base.SimpleFsm.SimpleFsmState("ALERTING"),b.MEDIA_RECOVERY=new a.Base.SimpleFsm.SimpleFsmState("MEDIA_RECOVERY"),b.ACTIVE=new a.Base.SimpleFsm.SimpleFsmState("ACTIVE"),b.ACTIVE_RENEGOTIATE=new a.Base.SimpleFsm.SimpleFsmState("ACTIVE_RENEGOTIATE"),b.FAILED=new a.Base.SimpleFsm.SimpleFsmState("FAILED"),b.ENDING=new a.Base.SimpleFsm.SimpleFsmState("ENDING"),b.ENDED=new a.Base.SimpleFsm.SimpleFsmState("ENDED")}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f){this._username=a,this._credential=b,this._address=c,this._transportTypes=d,this._iceTransportPolicy=e||"relay",this._expiryTime=f}b.prototype={getUsername:function(){return this._username},getCredential:function(){return this._credential},getAddress:function(){return this._address},getTransportTypes:function(){return this._transportTypes},getIceTransportPolicy:function(){return this._iceTransportPolicy},getExpiryTime:function(){return this._expiryTime}},a.Providers.Call.TurnData=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this._address=a,this._protocol=b,this._transport=c,this._port=d,this._transportPrecedence=0,this._tlsHasHighestPriority=!1}b.prototype={getProtocol:function(){return this._protocol},getTransport:function(){return this._transport},getPort:function(){return this._port},getUrl:function(){return this._protocol+":"+this._address+":"+this._port+"?transport="+this._transport},_setTlsToHighestPriority:function(a){this._tlsHasHighestPriority=a},getTransportPrecedence:function(){if("udp"===this._transport)return 3;if("tcp"!==this._transport)return 0;var a=this._tlsHasHighestPriority?100:1;return"turn"===this._protocol?2:a}},a.Providers.Call.TurnTransportType=b}(AvayaClientServices),function(a){"use strict";a.Providers.Call.Utils={updateVideoSdp:function(b,c){switch(b.direction){case a.Services.Call.MediaDirection.SEND_ONLY:return a.Base.SDPUtil.updateVideoSdpSendOnly(c);case a.Services.Call.MediaDirection.SEND_RECV:return a.Base.SDPUtil.updateVideoSdpSendRecv(c);case a.Services.Call.MediaDirection.RECV_ONLY:return a.Base.SDPUtil.updateVideoSdpRecvOnly(c);default:return a.Base.SDPUtil.updateVideoSdpInactive(c)}},updateAudioSdp:function(b,c){switch(b.direction){case a.Services.Call.MediaDirection.SEND_ONLY:return a.Base.SDPUtil.updateAudioSdpSendOnly(c);case a.Services.Call.MediaDirection.SEND_RECV:return a.Base.SDPUtil.updateAudioSdpSendRecv(c);case a.Services.Call.MediaDirection.RECV_ONLY:return a.Base.SDPUtil.updateAudioSdpRecvOnly(c);default:return a.Base.SDPUtil.updateAudioSdpInactive(c)}},updateAndTriggerRemoteAddressChangedIfNeeded:function(b,c,d,e,f,g,h){var i=a.Base.Utils.isDefined(e)&&c.getRemoteDisplayName()!==e,j=a.Base.Utils.isDefined(d)&&c.getRemoteAddress()!==d,k=c.getUserToUserInfo(),k=a.Base.Utils.isDefined(f)&&(a.Base.Utils.isUndefined(k)||k.getUCID()!==f);(j||i||k)&&b.triggerRemoteAddressChanged(c,d,e,f,g,h)},getVideoDirection:function(b){switch(b){case a.Services.Call.VideoMode.SEND_RECEIVE:return a.Services.Call.MediaDirection.SEND_RECV;case a.Services.Call.VideoMode.SEND_ONLY:return a.Services.Call.MediaDirection.SEND_ONLY;case a.Services.Call.VideoMode.RECEIVE_ONLY:return a.Services.Call.MediaDirection.RECV_ONLY;case a.Services.Call.VideoMode.INACTIVE:return a.Services.Call.MediaDirection.INACTIVE;case a.Services.Call.VideoMode.DISABLE:return a.Services.Call.MediaDirection.DISABLE;default:return a.Services.Call.MediaDirection.UNDEFINED}},getAudioDirection:function(b){switch(b){case a.Services.Call.AudioMode.SEND_RECEIVE:case a.Services.Call.AudioMode.ENABLE:return a.Services.Call.MediaDirection.SEND_RECV;case a.Services.Call.AudioMode.DISABLE:return a.Services.Call.MediaDirection.DISABLE;default:return a.Services.Call.MediaDirection.UNDEFINED}},getVideoMode:function(b){switch(b){case a.Services.Call.MediaDirection.SEND_RECV:return a.Services.Call.VideoMode.SEND_RECEIVE;case a.Services.Call.MediaDirection.SEND_ONLY:return a.Services.Call.VideoMode.SEND_ONLY;case a.Services.Call.MediaDirection.RECV_ONLY:return a.Services.Call.VideoMode.RECEIVE_ONLY;case a.Services.Call.MediaDirection.INACTIVE:return a.Services.Call.VideoMode.INACTIVE;default:return a.Services.Call.VideoMode.DISABLE}}}}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this._protocol=a,this._cause=b,this._text=c}b.prototype={getProtocol:function(){return this._protocol},getCause:function(){return this._cause},getText:function(){return this._text},_setCause:function(a){this._cause=a},_setProtocol:function(a){this._protocol=a}},a.Providers.Call.CallReason=b}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f){this._callGatewayProvider=e,this._callProvider=d,this.call=b,this.localStream=null,this.remoteStream=null,this.remote=!1,this.callId=null,this.incomingCallInfo={},this.incomingVideoRequestTimer=a,this.mediaTransactionDfd=a,this.noMediaTransactionDfd=a,this._mediaTransactionInitialEvent=a,this.audioStream=null,this.videoStreams=[],this._videoChannelId=a,this._audioDevice=a,this._videoDevice=a,this._videoSharingStream=a,this._videoSharingAudioContext=a,
this._videoSharingAudioConstraints=a,this._videoSharingMicrophoneGainNode=a;var g=d._config?d._config.callUserConfiguration.turnRelayCandidatesGatheringTimeout:5e3,e=d._config?d._config.callUserConfiguration.iceCandidatesGatheringTimeout:15e3,b=d._config?d._config.callUserConfiguration.iceConnectionRestartInterval:5e3;this._rtConnection=d._rtcConnectionProviderFactory.create(d._rtcConfiguration,g,e,b,3e5),this._rtcConfiguration=d._rtcConfiguration,this._transferPromise=a,this._joinRemotePromise=a,this._isEarlyMedia=!1,this._videoResolution=f,this._videoBandwidth=a,this._videoSendResolution=a,this._maxVideoResolution=f,this._activeRenegotiateEventQueue=[],this._queuedRemoteCallEstablishedEvent=a,this._isReadyToReceiveMediaRequest=!1,this._3pccRequestTransactionMap={},this._mediaAction=a,this._prevMediaAction=a,this._latestVideoModeDirection=a,this._latestNonHoldingVideoDirection=a,this._isNailedUpVideoConnectionSupported=!1,this._isRingingStarted=!1,this._isCallServiceAvailable=!0,this._iceConnectionRestartTimestamp=a,this._iceRestartTransactionDfd=a,this._iceRestartRelayType="",this._iceRestartAttempts=0,this._selectedCandidatePairChangedTimerId=a,this._selectedCandidatePairChangedTimestamp=a,this._serviceAvailableIceRecoveryTimerId=a,this._pendingVideoMuteUnmuteFunctor=a,this._hasReceivedCallEstablishedEvent=!1,this._hasLoggedRelayICECandidates=!1,this._isMPaaSCollabCall=!1,this._videoStatsInterval=a,this._videoStatsTimer=a,this._videoStatsFloatingWindow=[],this._avgVideoEncodeMs=0,this._avgVideoDecodeMs=0,this._isMediaConnected=!1,this._hadMediaConnected=!1,this._hasInitiatedMediaConnection=!1,this._iceRestartInProgress=!1,this._hasTriggeredMediaFailed=!1,this._initialGetOfferEvent=a,this._browserType=c.Base.Utils.getBrowserType(),this._runtimePerformanceMonitor=new c.Base.RuntimePerformanceMonitor(d._config),this.onPerformanceMonitorAlert=function(){},this._getOfferSDPEventInMultipleHandler=new c.Providers.Call.GetOfferSDPEventInMultipleHandler,this._offerSDPEventInMultipleHandler=new c.Providers.Call.OfferSDPEventInMultipleHandler,this._escalateVideoGetOfferEventInActiveRenegotiateHandler=new c.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler,this._escalateVideoOfferEventInActiveRenegotiateHandler=new c.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler,this._fsm=new c.Base.SimpleFsm.SimpleFsm,this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.StartCallEvent,c.Providers.Call.StartCallEventInInitialHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.AcceptCallEvent,c.Providers.Call.AcceptCallEventInInitialHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.JoinRemoteCallEvent,c.Providers.Call.JoinRemoteCallEventInInitialHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.RevertStateEvent,c.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.AcceptCallRequestEvent,c.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.RejectCallRequestEvent,c.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.StartRingingEvent,c.Providers.Call.StartRingingEventInInitialHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.DeviceRetrievalFailedEvent,c.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.INITIAL,c.Providers.Call.AudioEndedEvent),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.StartCallResponseEvent,c.Providers.Call.StartCallResponseEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.GetOfferSDPEvent,c.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.OfferSDPEvent,c.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.CallRingingEvent,c.Providers.Call.CallRingingEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.AnswerSDPEvent,c.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.MuteAudioEvent,c.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UnmuteAudioEvent,c.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.MuteSpeakerEvent,c.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UnmuteSpeakerEvent,c.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.OnAddStreamEvent,c.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.DeviceRetrievalFailedEvent,c.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UpdateLocalStreamEvent,c.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.StartContentVideoSharingEvent,c.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UpdateIceRestartMediaEvent,c.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.STARTING,c.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.STARTING,c.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.STARTING,c.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.STARTING,c.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.STARTING,c.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.CallRingingEvent),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.AnswerSDPEvent,c.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.MuteAudioEvent,c.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.UnmuteAudioEvent,c.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.MuteSpeakerEvent,c.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.UnmuteSpeakerEvent,c.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.OnAddStreamEvent,c.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.SendDTMFEvent,c.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.GetOfferSDPEvent,c.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.OfferSDPEvent,c.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.OnRemoveRemoteTrackEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ALERTING,c.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.AnswerSDPEvent,c.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.MuteAudioEvent,c.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UnmuteAudioEvent,c.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.MuteSpeakerEvent,c.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UnmuteSpeakerEvent,c.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.OnAddStreamEvent,c.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.OnAddRemoteTrackEvent,c.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.OnRemoveRemoteTrackEvent,c.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.ServiceAvailableEvent,c.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UpdateIceRestartMediaEvent,c.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.CallStateFailureEvent,c.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.BlockCameraEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UnBlockCameraEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.EscalateVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.EscalateNailedUpVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.DeEscalateVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.UpdatePreferredReceiveResolutionEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.SendDTMFEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.MEDIA_RECOVERY,c.Providers.Call.AudioEndedEvent),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.IncomingAddVideoEvent,c.Providers.Call.IncomingAddVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.IncomingRemoveVideoEvent,c.Providers.Call.IncomingRemoveVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.IncomingAddVideoTimedoutEvent,c.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AcceptSendVideoEvent,c.Providers.Call.AcceptSendVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.DenySendVideoEvent,c.Providers.Call.DenySendVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.MuteAudioEvent,c.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UnmuteAudioEvent,c.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.MuteSpeakerEvent,c.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UnmuteSpeakerEvent,c.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.BlockCameraEvent,c.Providers.Call.BlockCameraEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UnBlockCameraEvent,c.Providers.Call.UnBlockCameraEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.EscalateVideoEvent,c.Providers.Call.EscalateVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.EscalateNailedUpVideoEvent,c.Providers.Call.EscalateNailedUpVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.DeEscalateVideoEvent,c.Providers.Call.DeEscalateVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.RejectOfferSDPEvent,c.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.SendDTMFEvent,c.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.OnAddStreamEvent,c.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.OnAddRemoteTrackEvent,c.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.OnRemoveRemoteTrackEvent,c.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.DeviceRetrievalFailedEvent,c.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UpdateRemoteVideoEvent,c.Providers.Call.UpdateRemoteVideoEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.HoldEvent,c.Providers.Call.HoldEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UnHoldEvent,c.Providers.Call.UnHoldEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UpdateLocalStreamEvent,c.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.StartContentVideoSharingEvent,c.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.StopContentVideoSharingEvent,c.Providers.Call.StopContentVideoSharingHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UpdateContentVideoSharingAudioEvent,c.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AttendedTransferEvent,c.Providers.Call.AttendedTransferEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.TransferEvent,c.Providers.Call.TransferEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.CallRingingEvent,c.Providers.Call.CallRingingEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.EscalateVideoRejectedEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AddParticipantFromExistingCallEvent,c.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.IncomingGenericOfferSDPEvent,c.Providers.Call.IncomingGenericOfferSDPEventInActive),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AcceptCallRequestEvent,c.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.RejectCallRequestEvent,c.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.RevertStateEvent,c.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UpdateIceRestartMediaEvent,c.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.ServiceAvailableEvent,c.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.UpdatePreferredReceiveResolutionEvent,c.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AnswerSDPEvent,c.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.AudioEndedEvent,c.Providers.Call.AudioEndedEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.ACTIVE,c.Providers.Call.CallStateFailureEvent),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.RejectOfferSDPEvent,c.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.AnswerSDPEvent,c.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.AnswerSdpAckEvent,c.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.MuteAudioEvent,c.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UnmuteAudioEvent,c.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.MuteVideoEvent,c.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UnmuteVideoEvent,c.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.MuteSpeakerEvent,c.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UnmuteSpeakerEvent,c.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateVideoGetOfferEvent,this._escalateVideoGetOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoGetOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateVideoAnswerEvent,c.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateVideoRejectedEvent,c.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.RevertStateEvent,c.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.OnAddStreamEvent,c.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.DeviceRetrievalFailedEvent,c.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.OnAddRemoteTrackEvent,c.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.OnRemoveRemoteTrackEvent,c.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.CallStateFailureEvent,c.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.CallFailureEvent,c.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.IncomingGenericOfferSDPEvent,c.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.AcceptCallRequestEvent,c.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.RejectCallRequestEvent,c.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UpdateLocalStreamEvent,this._queueUpdateLocalStreamEvent.bind(this)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.StartContentVideoSharingEvent,this._queueStartContentVideoSharingEvent.bind(this)),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.ServiceAvailableEvent,c.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UpdateIceRestartMediaEvent,c.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UpdatePreferredReceiveResolutionEvent,c.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.BlockCameraEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.UnBlockCameraEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.EscalateNailedUpVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.DeEscalateVideoEvent,c.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.ACTIVE_RENEGOTIATE,c.Providers.Call.AudioEndedEvent),this._fsm.registerHandler(c.Providers.Call.States.ENDING,c.Providers.Call.EndCallEvent,c.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(c.Providers.Call.States.ENDING,c.Providers.Call.EndCallResponseEvent,c.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(c.Providers.Call.States.ENDING,c.Providers.Call.CallEstablishedEvent,c.Providers.Call.IncomingCallEstablishedEventInEndingHandler),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.RejectOfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.StopContentVideoSharingEvent),
this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDING,c.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.EndCallResponseEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.EndCallEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.CallEstablishedEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.StopContentVideoSharingEvent),this._fsm.registerNoOpHandler(c.Providers.Call.States.ENDED,c.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.start(c.Providers.Call.States.INITIAL),this._rtConnection&&(this._rtConnection.on(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,function(a){this._processIceConnectionStateChange(a)}.bind(this)),this._rtConnection.on(c.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,function(a){this.recoverLocalAudio()}.bind(this))),this._selectedCandidatePairChangedCallback=function(a){a&&(c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"*** Selected ICE candidate pair updates "+a),this._selectedCandidatePairChangedTimestamp=Date.now(),this.initiateIceRecoveryIfSelectedCandidatePairChanged())}.bind(this),c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Initialized CPCall")}var e=window.AudioContext||window.webkitAudioContext;(d.prototype={}).prepareEvent=function(a){return a.data||(a.data={}),a.data.cpCall=this,a.data.callProvider=this._callProvider,a},d.prototype.handleEvent=function(a){this.prepareEvent(a),this._fsm.handleEvent(a)},d.prototype.revertFsmState=function(a){var b=new c.Providers.Call.RevertStateEvent;b.data={state:a},this.handleEvent(b)},d.prototype.startCall=function(a,b,d,e,f,g){this._audioDevice=a,this._videoDevice=b,e=e||!1,f=f||!1,this._rtConnection&&this._rtConnection.addOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback);var h=new c.Providers.Call.StartCallEvent;h.data={remoteAddress:this.call.getRemoteAddress(),audioDevice:a,videoDevice:b,video:d,videoResolution:this._videoResolution,webCollab:e,uccp:f,nailedUpVideoConnection:g},this.handleEvent(h)},d.prototype.generateTemporarilyCallId=function(){return"temp-"+c.Base.Utils.generateUUID()},d.prototype.getOfferSDP=function(a,b,d,e,f,g,h,i,j){var k=!1;this._rtcConfiguration&&this._rtcConfiguration._expiryTime&&(k=Date.now()>=this._rtcConfiguration._expiryTime),h=this.updateIceServers(h),h&&(this._hasLoggedRelayICECandidates=!1,!i&&"relayOnly"===this.getIceRestartRelayType()&&k&&(i=!0)),this._prevMediaAction=this._mediaAction,k=new((this._mediaAction=a)===c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?c.Providers.Call.EscalateVideoGetOfferEvent:c.Providers.Call.GetOfferSDPEvent),e=this.adjustVideoResolution(a,d,e),f=f||this._audioDevice,g=g||this._videoDevice,k.data={action:a,audioStream:b,videoStreams:d,audioDevice:f,videoDevice:g,videoResolution:e,iceServerChanged:h,restartTurnGathering:i,useIPv6Candidates:j},a!==c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&(this._initialGetOfferEvent=k),this.handleEvent(k)},d.prototype.offerSDP=function(a,b,d,e,f,g){var h,g=this.updateIceServers(g);g&&(this._hasLoggedRelayICECandidates=!1);var i={offer:a,action:b,audioStream:d,videoStreams:e,audioDevice:this._callProvider.getMediaServiceFactory().getAudioInterface().getInputInterface().getSelectedDevice(),videoDevice:this._callProvider.getMediaServiceFactory().getVideoInterface().getSelectedDevice(),iceServerChanged:g};switch(this._prevMediaAction=this._mediaAction,this._mediaAction=b,c.Base.Utils.isDefined(this.mediaTransactionDfd)&&this.mediaTransactionDfd.state()!==c.Base.DeferredStates.PENDING&&this.call.getState()===c.Services.Call.CallStates.ESTABLISHED&&this.call._setState(c.Services.Call.CallStates.FAR_END_RENEGOTIATING),b){case c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION:h=new(0===e.length||!1===e[0].enabled?c.Providers.Call.OfferSDPEvent:c.Providers.Call.EscalateVideoOfferEvent)(i);break;case c.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:case c.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:case c.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:case c.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:case c.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:h=new c.Providers.Call.IncomingGenericOfferSDPEvent(i);break;default:h=new c.Providers.Call.OfferSDPEvent(i)}if(0<this.videoStreams.length&&0<e.length)d=this.getStreamDirection(this.videoStreams[0]),g=this.getStreamDirection(e[0]),d!==c.Services.Call.MediaDirection.INACTIVE&&g===c.Services.Call.MediaDirection.INACTIVE&&this._browserType===c.Base.BrowserType.EDGE?(this.determineIfNailedUpVideoConnectionSupported(e),this.isNailedUpVideoConnectionSupported()?(h.data.videoBandwidth=f,h.data.videoResolution=this.adjustVideoResolution(b,e,f)):b===c.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?this.callFailure(c.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,c.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):this.callFailure(c.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,c.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser")):(h.data.videoBandwidth=f,h.data.videoResolution=this.adjustVideoResolution(b,e,f));else if(this.isNailedUpVideoConnectionSupported()&&b===c.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION)return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Reject SDP Offer: "+b),void this.rejectOfferSDP(4880001,"Video escalation prohibited","Add video is not supported");this.handleEvent(h)},d.prototype.callRinging=function(a,b,d,e,f,g,h,i){var j=new c.Providers.Call.CallRingingEvent;j.data={address:a,displayName:b,isAuraAsserted:d,isPrivate:e,alertType:f,earlyMedia:g,audioStream:h,videoStreams:i},this.handleEvent(j)},d.prototype.answerSDP=function(a,b,d,e,f){var g=new(b===c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?c.Providers.Call.EscalateVideoAnswerEvent:c.Providers.Call.AnswerSDPEvent);this._updateVideoBandwidth(f),g.data={answer:a,action:b,audioStream:d,videoStreams:e,videoBandwidth:f},this.handleEvent(g)},d.prototype.answerSdpAck=function(a,b,d){var e=new(a!==c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION||0!==d.length&&!1!==d[0].enabled?c.Providers.Call.AnswerSdpAckEvent:c.Providers.Call.EscalateVideoRejectedEvent);e.data={action:a,audioStream:b,videoStreams:d},this.handleEvent(e)},d.prototype.buildCallEstablishedEvent=function(a,b,d,e,f,g,h,i,j,k,l){this._hasReceivedCallEstablishedEvent=!0;var m=new c.Providers.Call.CallEstablishedEvent;return m.data={address:a,displayName:b,audioStream:d,videoStreams:e,isConf:f,isRemote:i},f&&(m.data.uccpUrl=g,m.data.webCollabUrl=h),j&&(m.data.ucid=j,m.data.parentUcid=k,m.data.contextId=l),m},d.prototype.callEstablished=function(a,b,c,d,e,f,g,h,i,j,k){this.startPerformanceMonitoring(),k=this.buildCallEstablishedEvent(a,b,c,d,e,f,g,h,i,j,k),this.handleEvent(k)},d.prototype.muteAudio=function(){var a=new c.Providers.Call.MuteAudioEvent;this.handleEvent(a)},d.prototype.unmuteAudio=function(){var a=new c.Providers.Call.UnmuteAudioEvent;this.handleEvent(a)},d.prototype.recoverLocalAudio=function(){var a=new c.Providers.Call.AudioEndedEvent;this.handleEvent(a)},d.prototype.sendMuteUnmuteVideo=function(){switch(this.call._videoMuteState){case c.Services.Call.MediaMuteStates.MUTED:this.muteVideo();break;case c.Services.Call.MediaMuteStates.UNMUTED:this.unmuteVideo()}},d.prototype.muteVideo=function(){var a;return this.noMediaTransactionDfd=b.Deferred(),this.videoStreams.length?(a=new c.Providers.Call.MuteVideoEvent,this.handleEvent(a)):this.noMediaTransactionDfd.resolve("Queued").promise(),this.noMediaTransactionDfd.promise()},d.prototype.unmuteVideo=function(){var a;return this.noMediaTransactionDfd=b.Deferred(),this.videoStreams.length?(a=new c.Providers.Call.UnmuteVideoEvent,this.handleEvent(a)):this.noMediaTransactionDfd.resolve("Queued").promise(),this.noMediaTransactionDfd.promise()},d.prototype.muteSpeaker=function(){var a=new c.Providers.Call.MuteSpeakerEvent;this.handleEvent(a)},d.prototype.unmuteSpeaker=function(){var a=new c.Providers.Call.UnmuteSpeakerEvent;this.handleEvent(a)},d.prototype.end=function(a){c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"Local call ending: "+a),this.cleanup();var b=new c.Providers.Call.EndCallEvent;b.data={remote:!1,denialReason:a},-1===this.call.getCallId().indexOf("temp-")&&this.handleEvent(b)},d.prototype.cleanup=function(){this.stopAllStreams(),this.removeVideoSharingAudioContext(),clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.stopPerformanceMonitoring(),this._rtConnection&&this._rtConnection.removeOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback)},d.prototype.stopMonitoringVideoDelays=function(){clearTimeout(this._videoStatsTimer),clearInterval(this._videoStatsInterval)},d.prototype.cleanupImmediately=function(){this.cleanup(),this._rtConnection&&this._rtConnection.close()},d.prototype.callEndedRemotely=function(a){this.cleanup();var b=new c.Providers.Call.EndCallEvent;b.data={remote:!0,callReason:a},this.handleEvent(b)},d.prototype.incomingCall=function(){var a=new c.Providers.Call.IncomingCallEvent;this.handleEvent(a)},d.prototype.acceptCall=function(a,b){this._audioDevice=a,this._videoDevice=b;var d=new c.Providers.Call.AcceptCallEvent;d.data={audioDevice:a},a=this.call.getVideoChannels(),0<a.length&&(d.data.videoDevice=b,d.data.videoChannel=a[0],d.data.videoResolution=this.getVideoResolution()),this.handleEvent(d)},d.prototype.acceptSendVideo=function(a,d){this.mediaTransactionDfd=b.Deferred(),this._videoDevice=a;var e=new c.Providers.Call.AcceptSendVideoEvent;return e.data={videoChannel:d,videoDevice:a,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=e,a=this.mediaTransactionDfd.promise(),this.handleEvent(e),a},d.prototype.denySendVideo=function(){var a=new c.Providers.Call.DenySendVideoEvent;this.handleEvent(a)},d.prototype.callFailed=function(a,b,d){var e=new c.Providers.Call.EndCallEvent;e.data={remote:!1,reason:d},this.handleEvent(e)},d.prototype.callStateFailure=function(a){!a||a!==c.Services.Call.CallError.CALL_STATE_MISMATCH||!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()?(a=new c.Providers.Call.CallStateFailureEvent,this.handleEvent(a)):this.triggerCallMediaFailed()},d.prototype.callFailure=function(a,b,d,e){e={errorCode:a,protocolType:b,protocolErrorCode:d,failureReason:e},e=new c.Providers.Call.CallFailureEvent(e),this.handleEvent(e)},d.prototype.rejectOfferSDP=function(a,b,d){d={errorCode:a,errorMsg:b,displayMsg:d},d=new c.Providers.Call.RejectOfferSDPEvent(d),this.handleEvent(d)},d.prototype.blockCamera=function(a){return this.mediaTransactionDfd=b.Deferred(),a={deallocateCamera:a=!this.isNailedUpVideoConnectionSupported()&&a||!1},a=new c.Providers.Call.BlockCameraEvent(a),this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.unBlockCamera=function(a){this.mediaTransactionDfd=b.Deferred();var d=new c.Providers.Call.UnBlockCameraEvent;return d.data={videoDevice:a,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=d,this.handleEvent(d),this.mediaTransactionDfd.promise()},d.prototype.updateRemoteVideo=function(){this.mediaTransactionDfd=b.Deferred();var a=new c.Providers.Call.UpdateRemoteVideoEvent;return this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.updatePreferredResolution=function(d,e){var f=c.Base.VideoResolution[e],g=d.getNegotiatedResolution();f.getMinBandwidth()>g.getMinBandwidth()&&(e="Given resolution exceeds negotiated, using "+g+" instead",c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,e),f=g);var h=(new c.Base.VideoResolutionDetails).convertToConfigVideoResolution(f);d._preferredResolution=h;var i,j,k=b.Deferred();return d.getNegotiatedDirection()!==c.Services.Call.MediaDirection.SEND_ONLY&&(i=this.setPreferredReceiveResolution(d.getChannelId(),h)),d.getNegotiatedDirection()!==c.Services.Call.MediaDirection.RECV_ONLY&&(j=this.setVideoSendResolution(f)),b.when(i,j).done(function(){Array.prototype.slice.call(arguments).forEach(function(b){b!==a&&"resolved"!==b.state()&&"rejected"!==k.state()&&k.reject(b)}),"resolved"===k.state()&&(d._preferredResolution=h)}),k},d.prototype.setPreferredReceiveResolution=function(a,d){var e,f,g;return this.noMediaTransactionDfd=b.Deferred(),0<this.call.getVideoChannels().filter(function(b){return a===b.getChannelId()}).length?(e=new c.Providers.Call.UpdatePreferredReceiveResolutionEvent,f=c.Base.VideoResolution[d],g=new c.Base.VideoResolutionDetails,d=f.getHeight()>this._videoResolution.getHeight()?g.convertToConfigVideoResolution(this._videoResolution):d,e.data={videoResolution:d},this.handleEvent(e)):this.noMediaTransactionDfd.reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)),this.noMediaTransactionDfd.promise()},d.prototype.updateVideoResolution=function(a,d,e){return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Update video resolution: ",e),this.mediaTransactionDfd=b.Deferred(),d=new c.Providers.Call.UpdateLocalStreamEvent({audioDevice:a,videoDevice:d,videoResolution:e,videoResolutionChanged:!0}),d.data.videoResolution.getMinBandwidth()>this._maxVideoResolution.getMinBandwidth()&&(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Given resolution exceeds the maximum allowed, using "+this._maxVideoResolution+" instead"),d.data.videoResolution=this._maxVideoResolution),d.data.videoResolution.getMinBandwidth()===this._videoResolution.getMinBandwidth()?(c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Given resolution is the same as current ("+e+")"),this.mediaTransactionDfd.resolve().promise()):(this._updateVideoResolution(d.data.videoResolution),this._mediaTransactionInitialEvent=d,this.handleEvent(d),this.mediaTransactionDfd.promise().then(function(){return this._videoResolution}.bind(this)))},d.prototype.setVideoSendResolution=function(a){if(c.Base.Utils.isDefined(a)){var d=b.Deferred(),e=a.getMinBandwidth(),f=a.getHeight(),g=a.getWidth();return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Setting video send resolution to: "+a.toString()),e=this._rtConnection.setVideoSendBandwidth(e),f=this._rtConnection.setVideoSendResolution(g,f),b.when(f,e).then(function(){this._updateVideoSendResolution(a),d.resolve()}.bind(this)).fail(function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Failed set video set video send resolution and bandwidth"),d.reject(a)}.bind(this)),d.promise()}return c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Undefined video resolution details"),b.Deferred().reject().promise()},d.prototype.adjustVideoConstraints=function(a,d,e){if(this._videoResolution.getHeight()>d||this._videoResolution.getWidth()>a||this._videoResolution.getFPS()>e){d=Math.min(this._videoResolution.getHeight(),d),a=Math.min(this._videoResolution.getWidth(),a),e=Math.min(this._videoResolution.getFPS(),e);var f=this;return this._rtConnection.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks(function(){var a=Object.keys(c.Base.VideoResolution).filter(function(a){return c.Base.VideoResolution[a].getHeight()===d})[0];a&&this._updateVideoResolution(c.Base.VideoResolution[a])}.bind(this)),this._rtConnection.adjustVideoConstraints(a,d,e,this._videoDevice.getDeviceId()).then(function(){var a=Object.keys(c.Base.VideoResolution).filter(function(a){return c.Base.VideoResolution[a].getHeight()===d})[0];a&&f._updateVideoResolution(c.Base.VideoResolution[a])}).fail(function(a){return b.Deferred().reject(a).promise()}.bind(this))}return b.Deferred().resolve().promise()},d.prototype.updateDevice=function(a,d,e){if(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Update to new device: ",e),e._kind===c.Base.MediaTypes.VIDEO_INPUT){if(this._videoDevice=e,0<this.videoStreams.length&&(c.Base.Utils.isDefined(this._videoSharingStream)||this._getPreviousVideoDirection()===c.Services.Call.MediaDirection.RECV_ONLY))return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_STATE_MISMATCH)).promise()}else this._audioDevice=e;var f=new c.Providers.Call.UpdateLocalStreamEvent;return f.data={audioDevice:a,videoDevice:d,selectedDevice:e,videoResolution:this._videoResolution,videoResolutionChanged:!1},c.Base.Utils.isDefined(e)?(c.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=b.Deferred()),this._mediaTransactionInitialEvent=f,this.handleEvent(f),this.mediaTransactionDfd.promise()):(c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"No device selected"),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.FAILED)).promise())},d.prototype.startContentVideoSharing=function(a,d){return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"startContentVideoSharing: replacing video by content"),d&&(this._videoDevice=d),0===this.call.getVideoChannels().length?b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise():(this._videoSharingStream=a,d=new c.Providers.Call.StartContentVideoSharingEvent,d.data={stream:a,videoResolution:this._videoResolution,videoResolutionChanged:!1},c.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=b.Deferred()),this._mediaTransactionInitialEvent=d,this.handleEvent(d),this.mediaTransactionDfd.promise())},d.prototype.stopContentVideoSharing=function(){if(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),this.isScreenSharingUsingVideo()){var a=new c.Providers.Call.StopContentVideoSharingEvent;return c.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=b.Deferred()),this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()}return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.updateAudioSourceForVideoSharing=function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"updateAudioSourceForVideoSharing: from microphone: "+a);var d=new c.Providers.Call.UpdateContentVideoSharingAudioEvent;return d.data={stream:this._videoSharingStream,fromMicrophone:a},c.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=b.Deferred()),this._mediaTransactionInitialEvent=d,this.handleEvent(d),this.mediaTransactionDfd.promise()},d.prototype.replaceContentWithVideo=function(){var a;c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),c.Base.Utils.isDefined(this._videoDevice)?((a=new c.Providers.Call.UpdateLocalStreamEvent).data={audioDevice:this._audioDevice,videoDevice:this._videoDevice,selectedDevice:this._videoDevice,videoResolution:this._videoResolution,videoResolutionChanged:!1},this.handleEvent(a)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"No device selected"),this.mediaTransactionDfd.reject(new c.Services.Call.CallException(c.Services.Call.CallError.FAILED)))},d.prototype.escalateVideo=function(a){this.mediaTransactionDfd=b.Deferred();var d=new c.Providers.Call.EscalateVideoEvent;return d.data={videoDevice:a,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=d,this.handleEvent(d),this.mediaTransactionDfd.promise()},d.prototype.escalateNailedUpVideo=function(){this.mediaTransactionDfd=b.Deferred();var a=new c.Providers.Call.EscalateNailedUpVideoEvent;return this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.deEscalateVideo=function(){this.mediaTransactionDfd=b.Deferred();var a=new c.Providers.Call.DeEscalateVideoEvent;return this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.resolveMediaTransaction=function(b){setTimeout(function(){c.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.resolve(b),this.mediaTransactionDfd=a)}.bind(this),0)},d.prototype.rejectMediaTransaction=function(b){c.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.reject(b),this.mediaTransactionDfd=a)},d.prototype.sendDTMF=function(a){var b=new c.Providers.Call.SendDTMFEvent;b.data={dtmf:a},this.handleEvent(b)},d.prototype.incomingVideoRequestTimedout=function(){var a=new c.Providers.Call.IncomingAddVideoTimedoutEvent;this.handleEvent(a)},d.prototype.deviceRetrievalFailure=function(a){var b=new c.Providers.Call.DeviceRetrievalFailedEvent,a=c.Base.Utils.isDefined(a)?a:c.Services.Call.CallStates.FAILED;b.data={nextState:a},this.handleEvent(b)},d.prototype.hold=function(){this.mediaTransactionDfd=b.Deferred();var a=new c.Providers.Call.HoldEvent;return this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.unhold=function(){this.mediaTransactionDfd=b.Deferred();var a=new c.Providers.Call.UnHoldEvent;return a.data={videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},d.prototype.transfer=function(a){this._transferPromise=b.Deferred();var d=new c.Providers.Call.TransferEvent;return d.data={targetRemoteAddress:a},this.handleEvent(d),this._transferPromise.promise()},d.prototype.attendedTransfer=function(a){this._transferPromise=b.Deferred();var d=new c.Providers.Call.AttendedTransferEvent;return d.data={targetCallId:a},this.handleEvent(d),this._transferPromise.promise()},d.prototype.addParticipantFromCall=function(a){var b=new c.Providers.Call.AddParticipantFromExistingCallEvent;b.data={participantCallId:a.getCallId()},this.handleEvent(b)},d.prototype.join=function(a){this._joinRemotePromise=b.Deferred();var d=new c.Providers.Call.JoinRemoteCallEvent;return d.data={audioDevice:a,videoResolution:this._videoResolution},this.handleEvent(d),this._joinRemotePromise.promise()},d.prototype.startRinging=function(){var a;this.isRingingStarted()?c.Base.Logger.warn("StartRinging request ignored: already started"):(a=new c.Providers.Call.StartRingingEvent,this.handleEvent(a))},d.prototype.acceptCallRequest=function(a,b){var d=new c.Providers.Call.AcceptCallRequestEvent;d.data={deferred:a,requestedType:b},this.handleEvent(d)},d.prototype.rejectCallRequest=function(a,b){var d=new c.Providers.Call.RejectAnswerCallRequestEvent;d.data={deferred:a,requestedType:b},this.handleEvent(d)},d.prototype.updateAudioVideoStreamsDirection=function(a,b,c){this.updateAudioStreamDirection(a,c),this.updateVideoStreamsDirection(b,c)},d.prototype.updateAudioNoiseReduction=function(a){a.serverNoiseReduction&&(this.audioStream.serverNoiseReduction=a.serverNoiseReduction)},d.prototype.updateAudioStreamDirection=function(a,b){if(a&&this.audioStream){switch(a.direction){case c.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.direction=c.Services.Call.MediaDirection.RECV_ONLY;break;case c.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.direction=c.Services.Call.MediaDirection.SEND_ONLY;break;case c.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==c.Services.Call.CallStates.HELD&&this.call.getState()!==c.Services.Call.CallStates.HOLDING||b===c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.direction=a.direction);break;default:this.audioStream.direction=a.direction}this.isNailedUpVideoConnectionSupported()&&this._updateAudioStreamLogicalDirection(a,b)}},d.prototype._updateAudioStreamLogicalDirection=function(a,b){if(a)switch(a.logicalDirection){case c.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.logicalDirection=c.Services.Call.MediaDirection.RECV_ONLY;break;case c.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.logicalDirection=c.Services.Call.MediaDirection.SEND_ONLY;break;case c.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==c.Services.Call.CallStates.HELD&&this.call.getState()!==c.Services.Call.CallStates.HOLDING||b===c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.logicalDirection=a.logicalDirection);break;default:this.audioStream.logicalDirection=a.logicalDirection}},d.prototype.updateVideoStreamsDirection=function(a,b){this._updateVideoStreamsDirection(a,b,this._calculateDirectVideoUpdateDirection.bind(this))},d.prototype.updateVideoStreamsDirectionBasedOnVideoMode=function(a,b){this._latestVideoModeDirection?this._updateVideoStreamsDirection(a,b,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoStreamsDirection(a,b)},d.prototype._updateVideoStreamsDirection=function(a,b,d){if(a){for(var e=0;e<this.videoStreams.length;e++)a[e]&&(a[e].enabled?this.isNailedUpVideoConnectionSupported()||this.call.getState()!==c.Services.Call.CallStates.HELD&&this.call.getState()!==c.Services.Call.CallStates.HOLDING||b===c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[e].direction=d.call(this,a[e].direction,this.videoStreams[e].direction,!0,b):this.videoStreams[e].direction=c.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[e].enabled=!1,this.videoStreams[e].direction=c.Services.Call.MediaDirection.INACTIVE));this.isNailedUpVideoConnectionSupported()&&this._updateVideoStreamsLogicalDirection(a,b,d),0<this.videoStreams.length&&this.call.getState()!==c.Services.Call.CallStates.HELD&&this.call.getState()!==c.Services.Call.CallStates.HOLDING&&b!==c.Providers.Call.CallProvider.Constants.HOLD_ACTION&&b!==c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION&&b!==c.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&b!==c.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION&&(this._latestNonHoldingVideoDirection=this.getStreamDirection(this.videoStreams[0]))}},d.prototype._calculateDirectVideoUpdateDirection=function(a,b,d,e){if(!d)return c.Services.Call.MediaDirection.INACTIVE;switch(a){case c.Services.Call.MediaDirection.SEND_ONLY:return b===c.Services.Call.MediaDirection.SEND_ONLY?c.Services.Call.MediaDirection.INACTIVE:c.Services.Call.MediaDirection.RECV_ONLY;case c.Services.Call.MediaDirection.RECV_ONLY:return b===c.Services.Call.MediaDirection.RECV_ONLY?c.Services.Call.MediaDirection.INACTIVE:c.Services.Call.MediaDirection.SEND_ONLY;case c.Services.Call.MediaDirection.SEND_RECV:return c.Base.Utils.isDefined(e)&&e===c.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION?this.call._videoChannels[0]._getInternalRequestedDirection():a;default:return a}},d.prototype._calculateVideoModeUpdateVideoDirection=function(b){switch(b){case c.Services.Call.MediaDirection.SEND_RECV:switch(this._latestVideoModeDirection){case c.Services.Call.MediaDirection.SEND_RECV:return c.Services.Call.MediaDirection.SEND_RECV;case c.Services.Call.MediaDirection.RECV_ONLY:return c.Services.Call.MediaDirection.RECV_ONLY;case c.Services.Call.MediaDirection.SEND_ONLY:return c.Services.Call.MediaDirection.SEND_ONLY;default:return a}break;case c.Services.Call.MediaDirection.RECV_ONLY:switch(this._latestVideoModeDirection){case c.Services.Call.MediaDirection.SEND_RECV:return c.Services.Call.MediaDirection.SEND_ONLY;case c.Services.Call.MediaDirection.RECV_ONLY:return c.Services.Call.MediaDirection.INACTIVE;case c.Services.Call.MediaDirection.SEND_ONLY:return c.Services.Call.MediaDirection.SEND_ONLY;default:return a}break;case c.Services.Call.MediaDirection.SEND_ONLY:switch(this._latestVideoModeDirection){case c.Services.Call.MediaDirection.SEND_RECV:case c.Services.Call.MediaDirection.RECV_ONLY:return c.Services.Call.MediaDirection.RECV_ONLY;case c.Services.Call.MediaDirection.SEND_ONLY:return c.Services.Call.MediaDirection.INACTIVE;default:return a}break;default:return a}},d.prototype._updateVideoStreamsLogicalDirection=function(a,b,d){if(a)for(var e=0;e<this.videoStreams.length;e++)a[e]&&(a[e].enabled?this.call.getState()!==c.Services.Call.CallStates.HELD&&this.call.getState()!==c.Services.Call.CallStates.HOLDING||b===c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[e].logicalDirection=this.videoStreams[e].logicalDirection=d.call(this,a[e].logicalDirection,this.videoStreams[e].logicalDirection,this.videoStreams[e].enabled,b):this.videoStreams[e].logicalDirection=c.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[e].enabled=!1,this.videoStreams[e].logicalDirection=c.Services.Call.MediaDirection.INACTIVE))},d.prototype.getStreamDirection=function(a){var b;return b=a?this.isNailedUpVideoConnectionSupported()&&a.logicalDirection||a.direction:b},d.prototype.updateVideoChannelDirection=function(a){this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(a,this.getReversedVideoChannelDirection.bind(this)):this._updateVideoChannelDirection(a,this.getReversedVideoChannelDirection.bind(this))},d.prototype.updateVideoChannelDirectionBasedOnVideoMode=function(a){this._latestVideoModeDirection?this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(a,this._calculateVideoModeUpdateVideoDirection.bind(this)):this._updateVideoChannelDirection(a,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoChannelDirection(a);
},d.prototype._updateVideoChannelDirection=function(a,b){if(a)for(var d=this.call.getVideoChannels(),e=0;e<d.length;e++)a[e]&&(a[e].enabled?d[e]._setNegotiatedDirection(b.call(this,a[e].direction)):d[e]._setNegotiatedDirection(c.Services.Call.MediaDirection.DISABLE))},d.prototype._updateVideoChannelLogicalDirection=function(a,b){if(a)for(var d,e=this.call.getVideoChannels(),f=0;f<e.length;f++)a[f]&&(a[f].enabled?(d=a[f].logicalDirection||a[f].direction,e[f]._setNegotiatedDirection(b.call(this,d))):e[f]._setNegotiatedDirection(c.Services.Call.MediaDirection.DISABLE))},d.prototype.calculateUpdateVideoDirection=function(b){return b&&0<this.videoStreams.length?(b=this.getStreamDirection(b),this._calculateVideoModeUpdateVideoDirection(b)):a},d.prototype.getReversedVideoChannelDirection=function(a){switch(a){case c.Services.Call.MediaDirection.SEND_ONLY:return c.Services.Call.MediaDirection.RECV_ONLY;case c.Services.Call.MediaDirection.RECV_ONLY:return c.Services.Call.MediaDirection.SEND_ONLY;default:return a}},d.prototype.updateAudioChannelDirection=function(a){var b=this.call.getAudioChannel();b&&a&&(a.enabled?b._setNegotiatedDirection(a.direction):b._setNegotiatedDirection(c.Services.Call.MediaDirection.DISABLE))},d.prototype.setAVStreams=function(a,b){this.audioStream=a,this.videoStreams=b},d.prototype.removeLocalVideoTracks=function(){var a=this.call.getVideoChannels();this.localStream&&0<a.length&&(this._callProvider.getMediaServiceFactory().getMediaServicesService().removeLocalVideoTracks(a[0].getChannelId(),this._rtConnection),this.localStream.getVideoTracks().forEach(function(a){this.localStream.removeTrack(a)}.bind(this)),this.setAVStreams(this.getAudioStream(),[]))},d.prototype.hasVideoTracks=function(){return!!this.localStream&&0<this.localStream.getVideoTracks().length},d.prototype.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty=function(a){0===this.getVideoStreams().length||0!==a.length&&a[0]||(this.call.getVideoChannels().forEach(function(a){a._setNegotiatedDirection(c.Services.Call.MediaDirection.DISABLE),a._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}),this.removeLocalVideoTracks())},d.prototype.getAudioStream=function(){return this.audioStream},d.prototype.getVideoStreams=function(){return this.videoStreams},d.prototype.stopAllStreams=function(){this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().stopPlayingAudioStream(this.remoteStream),this._rtConnection&&(this._rtConnection.stopAllStreams(),this._rtConnection.removeStream(this.localStream)),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._callProvider.getMediaServiceFactory().getAudioInputInterfaceService().removeLocalMediaStream(this.call.getCallId()),this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().removeRemoteMediaStream(this.call.getCallId())},d.prototype.getVideoChannelId=function(){return this._videoChannelId},d.prototype.setVideoChannelId=function(a){this._videoChannelId!==a&&c.Base.Utils.isDefined(this._videoChannelId)&&this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._videoChannelId=a},d.prototype.updateVideoMode=function(a,d,e){var f;if(!this._callProvider.hasVideoDevices()&&a!==c.Services.Call.VideoMode.DISABLE)return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Camera not found"),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAMERA_NOT_FOUND));if(0===this.videoStreams.length){var g=c.Providers.Call.Utils.getVideoDirection(a);this.call._videoChannels[0]._setRequestedDirection(g),this._latestVideoModeDirection=g,f=this.escalateVideo(d)}else{if(a===c.Services.Call.VideoMode.INACTIVE)return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Inactive video mode is not supported"),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.UNHANDLED_VIDEO_DIRECTION)).promise();var h=this._getPreviousVideoDirection(),g=this._setNewVideoDirection(a);switch(this._latestVideoModeDirection=g,this.call._videoChannels[0]._setRequestedDirection(g),a){case c.Services.Call.VideoMode.SEND_RECEIVE:f=h===c.Services.Call.MediaDirection.SEND_ONLY?this.updateRemoteVideo():h===c.Services.Call.MediaDirection.INACTIVE?this.videoStreams[0].enabled||this.isNailedUpVideoConnectionSupported()?(this.videoStreams[0].enabled=!0,this.call.getVideoChannels()[0].isCameraAccessDenied()?this.escalateVideo():this.escalateNailedUpVideo()):(this.removeLocalVideoTracks(),this.escalateVideo()):this.unBlockCamera(d);break;case c.Services.Call.VideoMode.SEND_ONLY:f=h===c.Services.Call.MediaDirection.SEND_RECV?this.updateRemoteVideo():h===c.Services.Call.MediaDirection.RECV_ONLY?(this.videoStreams[0].direction=c.Services.Call.MediaDirection.INACTIVE,this.videoStreams[0].logicalDirection=c.Services.Call.MediaDirection.INACTIVE,this.updateRemoteVideo()):this.unBlockCamera(d);break;case c.Services.Call.VideoMode.RECEIVE_ONLY:f=h===c.Services.Call.MediaDirection.SEND_ONLY?this.deEscalateVideo():h!==c.Services.Call.MediaDirection.INACTIVE||this._rtConnection.hasVideo(this.localStream)?this.blockCamera(e):this.escalateVideo(d);break;case c.Services.Call.VideoMode.DISABLE:f=this.deEscalateVideo();break;default:return c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Unsupported video mode: "+a),b.Deferred().reject()}}return f},d.prototype._setNewVideoDirection=function(a){return a=c.Providers.Call.Utils.getVideoDirection(a),this.videoStreams[0].direction=a,this.isNailedUpVideoConnectionSupported()&&(this.videoStreams[0].logicalDirection=a),a},d.prototype._getPreviousVideoDirection=function(){return this.isNailedUpVideoConnectionSupported()&&this.videoStreams[0].logicalDirection||this.videoStreams[0].direction},d.prototype.notifyCallServiceOfMediaChanges=function(){this.isNailedUpVideoConnectionSupported()?this._notifyCallServiceOfLogicalMediaChanges():this._notifyCallServiceOfMediaChanges()},d.prototype._notifyCallServiceOfMediaChanges=function(){for(var a=this.call.getVideoChannels(),b=0;b<a.length&&b<this.videoStreams.length;b++){var d=this.videoStreams[b].direction;d!==c.Services.Call.MediaDirection.INACTIVE&&d!==c.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(a[b].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),d!==c.Services.Call.MediaDirection.SEND_RECV&&d!==c.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(d,!0),a[b]._setNegotiatedDirection(d),this._callProvider.triggerVideoChannelUpdate(this.call,a[b])):(a[b]._setNegotiatedDirection(c.Services.Call.MediaDirection.INACTIVE),this.videoStreams[b].enabled||a[b].getRequestedDirection()===c.Services.Call.MediaDirection.DISABLE||a[b]._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this.disableLocalVideoStreams(),this._callProvider.triggerVideoChannelUpdate(this.call))}},d.prototype._notifyCallServiceOfLogicalMediaChanges=function(){for(var a=this.call.getVideoChannels(),b=0;b<a.length&&b<this.videoStreams.length;b++){var d=this.videoStreams[b].logicalDirection||this.videoStreams[b].direction;d!==c.Services.Call.MediaDirection.INACTIVE&&d!==c.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(a[b].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),d!==c.Services.Call.MediaDirection.SEND_RECV&&d!==c.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(d),a[b]._setNegotiatedDirection(d),this._callProvider.triggerVideoChannelUpdate(this.call,a[b])):(a[b]._setNegotiatedDirection(c.Services.Call.MediaDirection.INACTIVE),this.videoStreams[b].enabled||a[b].getRequestedDirection()===c.Services.Call.MediaDirection.DISABLE||a[b]._setVideoDisabledReason(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this._callProvider.triggerVideoChannelUpdate(this.call))}},d.prototype.transferCompleted=function(){c.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.resolve()},d.prototype.transferFailed=function(){c.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.reject()},d.prototype.isFirefoxBrowser=function(){return this._browserType===c.Base.BrowserType.FIREFOX},d.prototype.getCallStatistics=function(){var a=b.Deferred(),d=!!this.audioStream&&this.audioStream.enabled,e=0!==this.videoStreams.length&&this.videoStreams[0].enabled;return(d||e)&&c.Base.Utils.isDefined(this._rtConnection)&&null!==this._rtConnection&&c.Base.Utils.isDefined(this._rtConnection._pc)?this._rtConnection.getStats().then(function(b){this._logSelectedCandidates(b),this._checkCallStatisticReport(b,a)}.bind(this),function(){a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.STATISTICS_UNAVAILABLE))}):a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.STATISTICS_UNAVAILABLE)),a.promise()},d.prototype.monitorVideoDelays=function(){var a,b,d,e,f,g;0!==this.videoStreams.length&&this.videoStreams[0].enabled&&(a=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,b=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoDecodingTime")||40,d=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoEncodingTime")||35,e=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoDecodingTime")||13,f=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoEncodingTime")||13,g=c.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this.stopMonitoringVideoDelays(),this._videoStatsTimer=setTimeout(function(){this._videoStatsInterval=setInterval(function(){this._rtConnection.getVideoStats().then(function(a){var h=this._videoStatsFloatingWindow.length;g<=h&&this._videoStatsFloatingWindow.shift(),this._videoStatsFloatingWindow.push(a.videoStatistics),g<=h&&(a=this._getLastVideoEncodingTime(this._videoStatsFloatingWindow),h=this._getLastVideoDecodingTime(this._videoStatsFloatingWindow),(f<a||e<h)&&this._onPerformanceMonitorAlert(c.Base.PerformanceAlertType.CPU_USAGE_WARNING),a=this._calculateAvgVideoEncodingTime(this._videoStatsFloatingWindow,g),h=this._calculateAvgVideoDecodingTime(this._videoStatsFloatingWindow,g),(b<=h||d<=a)&&(a="Average video encoding/decoding above threshold: ["+h+", "+a+"]",this._onPerformanceMonitorAlert(c.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,a)))}.bind(this))}.bind(this),1e3)}.bind(this),1e3*a))},d.prototype._calculateAvgVideoEncodingTime=function(a,b){if(0===a.length||a.length<b)this._avgVideoEncodeMs=0;else if(c.Base.Utils.isDefined(a[0].totalEncodeTime)){for(var d=0,e=1;e<a.length;e++){var f=a[e].framesEncoded-a[0].framesEncoded;0<f&&(d+=(a[e].totalEncodeTime-a[0].totalEncodeTime)/f)}this._avgVideoEncodeMs=d/(a.length-1)*1e3}return this._avgVideoEncodeMs},d.prototype._calculateAvgVideoDecodingTime=function(a,b){if(0===a.length||a.length<b)this._avgVideoDecodeMs=0;else if(c.Base.Utils.isDefined(a[0].totalDecodeTime)){for(var d=0,e=1;e<a.length;e++){var f=a[e].framesDecoded-a[0].framesDecoded;0<f&&(d+=(a[e].totalDecodeTime-a[0].totalDecodeTime)/f)}this._avgVideoDecodeMs=d/(a.length-1)*1e3}return this._avgVideoDecodeMs},d.prototype._getLastVideoDecodingTime=function(a){var b,d,e=0;return c.Base.Utils.isDefined(a[0].totalDecodeTime)&&2<=a.length&&(b=a[a.length-1].framesDecoded,d=a[a.length-2].framesDecoded,e=(a[a.length-1].totalDecodeTime-a[a.length-2].totalDecodeTime)/(b-d)*1e3),e},d.prototype._getLastVideoEncodingTime=function(a){var b,d,e=0;return c.Base.Utils.isDefined(a[0].totalEncodeTime)&&2<=a.length&&(b=a[a.length-1].framesEncoded,d=a[a.length-2].framesEncoded,e=(a[a.length-1].totalEncodeTime-a[a.length-2].totalEncodeTime)/(b-d)*1e3),e},d.prototype._onPerformanceMonitorAlert=function(a,b){this.onPerformanceMonitorAlert(a,b)},d.prototype.startPerformanceMonitoring=function(){this.monitorVideoDelays(),this._runtimePerformanceMonitor.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),this._runtimePerformanceMonitor.start()},d.prototype.stopPerformanceMonitoring=function(){this.stopMonitoringVideoDelays(),this._runtimePerformanceMonitor.stop()},d.prototype._checkCallStatisticReport=function(a,b){a?b.resolve(a):b.reject(new c.Services.Call.CallException(c.Services.Call.CallError.STATISTICS_UNAVAILABLE))},d.prototype._logSelectedCandidates=function(a){if(!this._hasLoggedRelayICECandidates&&a.iceCandidateStatistics)for(var b in a.iceCandidateStatistics){var d;a.iceCandidateStatistics.hasOwnProperty(b)&&(d=a.iceCandidateStatistics[b].local,b=a.iceCandidateStatistics[b].remote,d&&b&&(this._hasLoggedRelayICECandidates=!0,c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"*** Selected local ICE  candidate",d.toString()),c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"*** Selected remote ICE candidate",b.toString())))}},d.prototype.stopEarlyMedia=function(a){this._isEarlyMedia&&this.remoteStream&&a.isPlaying(this.remoteStream)&&(this._rtConnection.disableRemoteStreams(),a.stopPlayingAudioStream(this.remoteStream))},d.prototype.getVideoResolution=function(){return this._videoResolution},d.prototype.getVideoBandwidth=function(){return this._videoBandwidth},d.prototype.getVideoSendResolution=function(){return c.Base.Utils.isDefined(this._videoSendResolution)||this._updateVideoSendResolution(this._videoResolution),this._videoSendResolution},d.prototype.getVideoSendBandwidth=function(){var b=this._rtConnection.getVideoSendBandwidth();return b!==a?b/1e3:this.getVideoBandwidth()},d.prototype._updateVideoBandwidth=function(b){b!==a&&(this._videoBandwidth=b)},d.prototype._updateVideoResolution=function(a){this._videoResolution=a,this._callProvider._videoResolution=a},d.prototype._updateVideoSendResolution=function(a){this._videoSendResolution=a},d.prototype.popQueuedActiveRenegotiateEvent=function(){return this._activeRenegotiateEventQueue.shift()},d.prototype.setQueuedActiveRenegotiateEvent=function(a){this._activeRenegotiateEventQueue.push(a)},d.prototype.isReadyToReceiveMediaRequest=function(){return this._isReadyToReceiveMediaRequest},d.prototype.popQueuedRemoteCallEstablishedEvent=function(){var b=this._queuedRemoteCallEstablishedEvent;return this._queuedRemoteCallEstablishedEvent=a,b},d.prototype.setQueuedRemoteCallEstablishedEvent=function(a){this._queuedRemoteCallEstablishedEvent=a},d.prototype.getMediaTransactionInitialEvent=function(){return this._mediaTransactionInitialEvent},d.prototype.setMediaTransactionInitialEvent=function(a){this._mediaTransactionInitialEvent=a},d.prototype.adjustVideoResolution=function(a,b,d){var e=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(d,this._videoResolution)||this._videoResolution;return b&&b[0]&&(d=b[0].maxHeight,(b=b[0].maxWidth)&&d&&(e=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolutionForDimensions(d,b,e))),e.getMinBandwidth()<this._maxVideoResolution.getMinBandwidth()&&a!==c.Providers.Call.CallProvider.Constants.UPDATE_VIDEO&&(this._maxVideoResolution=e),e},d.prototype.setCallRequestedTransactionalId=function(a,b){this._3pccRequestTransactionMap[a]=b},d.prototype.getCallRequestedTransactionalId=function(a){return this._3pccRequestTransactionMap[a]},d.prototype.updateIceServers=function(a){var b,c=!1;return a&&(b=[],a.getTransportTypes().sort(function(a,b){return a.getTransportPrecedence()>b.getTransportPrecedence()?-1:a.getTransportPrecedence()<b.getTransportPrecedence()?1:0}),a.getTransportTypes().forEach(function(a){b.push(a.getUrl())}),c=this._addTurnServers(a.getUsername(),a.getCredential(),b,a.getIceTransportPolicy(),a.getExpiryTime())),c},d.prototype.isNailedUpVideoConnectionSupported=function(){return this._isNailedUpVideoConnectionSupported},d.prototype.setNailedUpVideoConnectionSupported=function(a){this._isNailedUpVideoConnectionSupported=a},d.prototype.determineIfNailedUpVideoConnectionSupported=function(a){a=!!a&&0<a.length&&!!a[0].logicalDirection,this._isNailedUpVideoConnectionSupported=this._callProvider.isSolutionSupportsNailedUpConnection()&&a},d.prototype.setRingingStarted=function(a){this._isRingingStarted=a},d.prototype.isRingingStarted=function(){return this._isRingingStarted},d.prototype.disableVideoStreamsAndChannels=function(a){0<this.videoStreams.length&&(this.videoStreams[0].enabled=!1,this.isNailedUpVideoConnectionSupported()?this.videoStreams[0].logicalDirection=c.Services.Call.MediaDirection.INACTIVE:this.videoStreams[0].direction=c.Services.Call.MediaDirection.INACTIVE);var b=this.call.getVideoChannels();0<b.length&&(b[0]._setNegotiatedDirection(c.Services.Call.MediaDirection.DISABLE),b[0]._setVideoDisabledReason(a))},d.prototype._addTurnServers=function(a,b,d,e,f){return!!(a&&b&&d)&&(this._rtcConfiguration={iceServers:[{username:a,credential:b,credentialType:"password",urls:d}],iceTransportPolicy:e},f&&(30<f&&(f-=30),this._rtcConfiguration._expiryTime=Date.now()+1e3*f),"relay"!==e&&this.isIceRecoverySupportedConference()&&(this._rtcConfiguration._turnOfferType=this.getIceRestartRelayType()||c.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY),!0)},d.prototype.resetAudioOnlyNailedUpConnection=function(){return!(!this._callProvider.isSolutionSupportsNailedUpConnection()||!this.hasNailedUpConnectionVideoChannel()||(this.disableVideoStreamsAndChannels(c.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),this.disableLocalVideoStreams(),0))},d.prototype.hasNailedUpConnectionVideoChannel=function(){return 0<this.call.getVideoChannels().filter(function(a){return a.getChannelId().toString().includes("NailedUp_")}).length},d.prototype._queueUpdateLocalStreamEvent=function(a){this.setQueuedActiveRenegotiateEvent(a)},d.prototype._queueStartContentVideoSharingEvent=function(a){this.setQueuedActiveRenegotiateEvent(a)},d.prototype.hasVideoTrackStopStreaming=function(a){return this._rtConnection.hasVideoTrackStopStreaming(a)},d.prototype.disableLocalVideoStreams=function(a){this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()?(a=a||c.Services.Call.MediaDirection.INACTIVE,this._rtConnection.setLocalVideoDirection(a)):this._rtConnection.disableLocalVideoStreams()},d.prototype.enableLocalVideoStreams=function(a,b){0<this.videoStreams.length&&(this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()&&(a=a||c.Services.Call.MediaDirection.SEND_RECV,this._rtConnection.setLocalVideoDirection(a),b&&this.call._videoMuteState===c.Services.Call.MediaMuteStates.UNMUTED&&this.isSendingVideoDirection()&&(this._mediaAction===c.Providers.Call.CallProvider.Constants.UNHOLD_ACTION||this._mediaAction===c.Providers.Call.CallProvider.Constants.UPDATE_VIDEO||this._mediaAction===c.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION)&&(this.call._videoMuteState=c.Services.Call.MediaMuteStates.UNDEFINED,this._rtConnection.disableLocalVideoStreams())),this.isLocalVideoMuted()||this._rtConnection.enableLocalVideoStreams())},d.prototype.isSendingVideoDirection=function(){if(0<this.videoStreams.length){var a=this.getStreamDirection(this.videoStreams[0]);return a===c.Services.Call.MediaDirection.SEND_RECV||a===c.Services.Call.MediaDirection.SEND_ONLY}return!1},d.prototype.muteLocalVideo=function(){this._rtConnection.disableLocalVideoStreams()},d.prototype.unmuteLocalVideo=function(){this._rtConnection.enableLocalVideoStreams()},d.prototype.isLocalVideoMuted=function(){return this.call._videoMuteState===c.Services.Call.MediaMuteStates.MUTED},d.prototype.enableLocalStreams=function(){this.call.isAudioMuted()||this._rtConnection.enableLocalAudioStreams(),this.enableLocalVideoStreams()},d.prototype.disableLocalStreams=function(){this._rtConnection.disableLocalAudioStreams(),this.disableLocalVideoStreams()},d.prototype.queueMuteUnumteFunctor=function(a){this._pendingVideoMuteUnmuteFunctor=a},d.prototype.execQueuedVideoMuteUnmuteFunctor=function(){this._pendingVideoMuteUnmuteFunctor&&this._pendingVideoMuteUnmuteFunctor(this.callId,this.call._sessionId,this.getVideoStreams()),this._pendingVideoMuteUnmuteFunctor=a},d.prototype.hasReceivedCallEstablishedEvent=function(){return this._hasReceivedCallEstablishedEvent},d.prototype.isMPaaSCall=function(){return!!this.call._sessionId},d.prototype.isMPaaSCollabCall=function(){return this._isMPaaSCollabCall},d.prototype.isIceRecoverySupportedBrowser=function(){return this._browserType!==c.Base.BrowserType.EDGE},d.prototype.isIceRecoverySupportedConference=function(){return this.isMPaaSCall()&&this.isIceRecoverySupportedBrowser()&&!this.isMPaaSCollabCall()},d.prototype.iceConnectionFailedHandler=function(){var b;clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this._selectedCandidatePairChangedTimerId=a,this._selectedCandidatePairChangedTimestamp=a,this.isIceRecoverySupportedConference()&&this.call.getState()!==c.Services.Call.CallStates.ENDING&&this.call.getState()!==c.Services.Call.CallStates.ENDED&&(b=!0,this.isCallServiceAvailable()&&this._iceRestartAttempts++,c.Base.Utils.isUndefined(this.getIceConnectionRestartTimestamp())?(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,">>> Starting ICE media recovery"),this.setIceConnectionRestartTimestamp(Date.now()),this._callProvider.triggerMediaRecoveryInitiated(this.call)):this.hasIceRecoveryElapsed()?(b=!1,c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,">>> ICE recovery has elapsed"),this.triggerCallMediaFailed()):c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,">>> Continuing ICE media recovery"),b&&(b=new c.Providers.Call.UpdateIceRestartMediaEvent,this.handleEvent(b)))},d.prototype.iceRecoveryCleanup=function(){this.isIceRecoverySupportedConference()&&(c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,">>> Cleanup ICE media recovery"),this.setIceRestartInProgress(!1),this.setIceConnectionRestartTimestamp(a))},d.prototype.hasIceRecoveryElapsed=function(){return!this._iceConnectionRestartTimestamp||3e5<Date.now()-this._iceConnectionRestartTimestamp},d.prototype.setIceConnectionRestartTimestamp=function(a){this.isIceRecoverySupportedConference()&&(this._iceConnectionRestartTimestamp=a)},d.prototype.getIceConnectionRestartTimestamp=function(){return this._iceConnectionRestartTimestamp},d.prototype.setIceRestartRelayType=function(a){this._iceRestartRelayType=a},d.prototype.getIceRestartRelayType=function(){return this._iceRestartRelayType},d.prototype.getIceRestartAttemtps=function(){return this._iceRestartAttempts},d.prototype.initiateIceRecoveryIfSelectedCandidatePairChanged=function(){this._selectedCandidatePairChangedTimestamp&&this.isIceRecoverySupportedConference()&&!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(a){var b=a.audioStatistics.transportBytesReceived,d=function(a){this._selectedCandidatePairChangedTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){a++,e=e.audioStatistics.transportBytesReceived-b,0!=e&&(this._iceRestartAttempts=0),!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&0==e&&(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=a?(c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after ICE candidatePair changes"),this.iceConnectionFailedHandler()):d(a))}.bind(this))}.bind(this),5e3)}.bind(this);d(0)}.bind(this)))},d.prototype.initiateIceRecoveryIfDetectedMediaPathProblem=function(){this.isIceRecoverySupportedConference()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(a){var b=a.audioStatistics.transportBytesReceived,d=function(a){this._serviceAvailableIceRecoveryTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){0<e.audioStatistics.transportBytesReceived&&(a++,e.audioStatistics.transportBytesReceived-b==0?(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=a?(c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after calls service available"),this.iceConnectionFailedHandler()):d(a)):(this._iceRestartAttempts=0,this._isMediaConnected||(this._isMediaConnected=!0,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected))))}.bind(this))}.bind(this),5e3)}.bind(this);d(0)}.bind(this)))},d.prototype.setCallServiceAvailable=function(a){this._isCallServiceAvailable=a,this._isCallServiceAvailable&&(a=new c.Providers.Call.ServiceAvailableEvent,this.handleEvent(a))},d.prototype.isCallServiceAvailable=function(){return this._isCallServiceAvailable},d.prototype.triggerCallMediaFailed=function(){c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,">>> Failed to recovery media"),this.iceRecoveryCleanup(),!this._hasTriggeredMediaFailed&&this.isIceConnectionStateFailed()&&(this._hasTriggeredMediaFailed=!0,this._callProvider.triggerCallMediaFailed(this.call))},d.prototype.isIceConnectionStateFailed=function(){return!!this._rtConnection&&this._rtConnection.getIceConnectionState()===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED},d.prototype.getIceConnectionState=function(){var a;return a=this._rtConnection?this._rtConnection.getIceConnectionState():a},d.prototype.isMediaConnected=function(){return this._isMediaConnected},d.prototype.setIceRestartInProgress=function(a){this._iceRestartInProgress=a},d.prototype.isIceRestartInProgress=function(){return this._iceRestartInProgress},d.prototype._recalculateMediaConnection=function(a){var b=this._isMediaConnected;this._isMediaConnected=a===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED||a===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED,this._isMediaConnected&&(this._hadMediaConnected=!0),this._isMediaConnected!==b&&a!==c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CHECKING&&this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)},d.prototype._processIceConnectionStateChange=function(a,b){this._recalculateMediaConnection(a),this._isMediaConnected?this.iceRecoveryCleanup():(a===c.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED||b&&!this.isIceRestartInProgress())&&this.iceConnectionFailedHandler()},d.prototype._replaceAudioTrackIfNeeded=function(a,d){return a=a||!1,this._rtConnection.isLocalAudioTrackEnded()||d?(d=this.getNoiseSuppressionConstraints(),c.Providers.Call.CPUtils.replaceLocalAudioTrack(this,this._callProvider.getMediaServiceFactory(),a,d)):b.Deferred().reject("Condition failed").promise()},d.prototype.applyAudioConstraintsIfNeeded=function(){var a,b=this.getAudioStream();if(b.serverNoiseReduction&&"ENABLE"===b.serverNoiseReduction)a=!1;else switch(this.call.getNoiseReductionSetting()){case c.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case c.Services.Call.NoiseReductionSetting.DISABLE_ALL:a=!1;break;case c.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case c.Services.Call.NoiseReductionSetting.ENABLED:a=!0;break;default:"DISABLE"===b.serverNoiseReduction&&(a=!0)}c.Base.Utils.isDefined(a)&&this._rtConnection.adjustAudioConstraints(a)},d.prototype.getNoiseSuppressionConstraints=function(){var a,b=this.getAudioStream();if(b.serverNoiseReduction&&"ENABLE"===b.serverNoiseReduction)a={noiseSuppression:!1};else switch(this.call.getNoiseReductionSetting()){case c.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case c.Services.Call.NoiseReductionSetting.DISABLE_ALL:a={noiseSuppression:!1};break;case c.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case c.Services.Call.NoiseReductionSetting.ENABLED:a={noiseSuppression:!0};break;default:"DISABLE"===b.serverNoiseReduction&&(a={noiseSuppression:!0})}return a},d.prototype.setVideoSharingAudioContext=function(a){this.removeVideoSharingAudioContext(),this._videoSharingAudioContext=a},d.prototype.removeVideoSharingAudioContext=function(){this._videoSharingAudioContext&&(this._videoSharingAudioContext.close(),this._videoSharingAudioContext=a,this._videoSharingAudioConstraints=a,this._videoSharingMicrophoneGainNode=a)},d.prototype.setVideoSharingAudioConstraints=function(a){this._videoSharingAudioConstraints=a},d.prototype.getVideoSharingAudioConstraints=function(){return this._videoSharingAudioConstraints},d.prototype.setVideoSharingMicrophoneGainNode=function(a){this._videoSharingMicrophoneGainNode=a},d.prototype.updateVideoSharingMicrophoneVolume=function(a){this._videoSharingAudioContext&&this._videoSharingMicrophoneGainNode&&this._videoSharingMicrophoneGainNode.gain.setValueAtTime(a,this._videoSharingAudioContext.currentTime)},d.prototype.stopVideoSharingStream=function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(a){a.stop(),a.kind===c.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&this._rtConnection.replaceLocalMediaTrack(this.localStream.getAudioTracks()[0])}.bind(this)),this._videoSharingStream=a)},d.prototype.isScreenSharingUsingVideo=function(){return c.Base.Utils.isDefined(this._videoSharingStream)},d.prototype.mixVideoSharingAudio=function(a,b){this.removeVideoSharingAudioContext();var d=new e;this.setVideoSharingAudioContext(d),a.getAudioTracks().forEach(function(a){var b=a.getConstraints();b.echoCancellation=!0,b.autoGainControl=!1,a.applyConstraints(b)["catch"](function(a){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Apply "+b+" constraints rejected: "+a)})}),b=b||this._videoSharingStream;var f=d.createMediaStreamSource(b),g=d.createMediaStreamSource(a),h=d.createMediaStreamDestination(),b=d.createGain();return b.gain.setValueAtTime(.75,d.currentTime),f.connect(b),b.connect(h),d=d.createGain(),this.setVideoSharingMicrophoneGainNode(d),this.updateVideoSharingMicrophoneVolume(this.call.isAudioMuted()?0:1),g.connect(d),d.connect(h),a.getAudioTracks()[0].enabled=!0,h.stream.getAudioTracks()[0]},c.Providers.Call.CPCall=d}(AvayaClientServices),function(c){"use strict";c.Providers.Call.CPUtils={createLocalMediaStream:function(d,e,f,g,h,i,j,k){function l(){f._rtConnection.stopStream(f.localStream),f._rtConnection.removeStream(f.localStream);var b=function(){var b=k?k.data.constraints:a;g.getMediaServicesService().createLocalMediaStream(f.call.getCallId(),!0,p.enable,n,p.videoDeviceId,p.videoChannelId,h,b).then(function(b){var d=b.stream;b.videoResolution&&f._updateVideoResolution(b.videoResolution);var e=f.getAudioStream(),g=[];d.getTracks().forEach(function(a){var b,d;a.kind===c.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(d=(b=f.getVideoStreams()[0])?b.direction:c.Services.Call.MediaDirection.INACTIVE,d=new c.Providers.Interfaces.VideoStream(a.id,d),f.isNailedUpVideoConnectionSupported()&&(d.logicalDirection=b.logicalDirection),g.push(d))}),p.enable&&b.constraint&&0<o.length&&c.Providers.Call.CPUtils.updateVideoDeniedStreams(o,g,b.constraint),f.setAVStreams(e,g),f.localStream=d,f._rtConnection.addStream(f.localStream),f.call.isAudioMuted()&&f._rtConnection.disableLocalAudioStreams(),0!==g.length&&f.isLocalVideoMuted()&&f.muteLocalVideo(),i.call(a,f,k),m.resolve(b.videoResolution)},function(b){
j.call(a,f,b),m.reject(b)})}.bind(this);c.Base.Utils.getBrowserType()===c.Base.BrowserType.EDGE?setTimeout(function(){b()}.bind(this),500):b()}c.Base.Logger.debug(c.Base.LoggerTags.CALL_PROVIDER,"The video resolution of the localStream has to be changed due to bandwidth management.");var m=b.Deferred(),n=d?d.getDeviceId():a,o=f.call.getVideoChannels(),p=this.getVideoOptions(o,e);return p.enable?f._rtConnection.adjustVideoConstraints(h.getWidth(),h.getHeight(),h.getFPS()).then(function(){f._updateVideoResolution(h),i.call(a,f,k),m.resolve(h)},function(){l()}):l(),m.promise()},updateVideoResolutionFirefox:function(b,d,e,f,g,h){c.Base.Logger.debug("The video resolution of the localStream has to be changed due to bandwidth management.");var i=f.localStream.getVideoTracks()[0];i?d.getMediaServicesService().getUserMedia().updateStreamUsingApplyConstraints(i,e,f,b.getDeviceId()).always(function(){g.call(a,f)}):h.call(a,f,"Missing video track")},updateDevices:function(d,e,f,g,h,i,j,k){var l,m=!1,n=!1,o={videoDeviceId:a,videoChannelId:a},p=f.call.getVideoChannels();if(e){if(!(0<p.length&&p[0].getRequestedDirection()!==c.Services.Call.MediaDirection.DISABLE))return c.Base.Logger.debug("Ignoring. Video channels is empty or disabled"),i.call(a,f),b.Deferred().resolve().promise();m=!0,l=a,o=this.getVideoOptions(p,e),f._rtConnection.removeLocalVideoTrack(f.localStream),c.Base.Logger.debug("Changing to new video device: "+e.getLabel())}return d&&(n=!0,l=d.getDeviceId(),f._rtConnection.removeLocalAudioTrack(f.localStream),c.Base.Logger.debug("Changing to new audio device: "+d.getLabel())),g.getMediaServicesService().createLocalMediaStream(f.call.getCallId(),n,m,l,o.videoDeviceId,o.videoChannelId,h,k).then(function(c){var h=c.stream;c.videoResolution&&f._updateVideoResolution(c.videoResolution);var k=[];h.getTracks().forEach(function(a){k.push(f._rtConnection.replaceLocalMediaTrack(a,f.localStream))}),b.when.apply(this,k).then(function(){m&&(f._videoDevice=e,g.getVideoInterfaceService().replaceLocalMediaStream(o.videoChannelId,f.localStream),f.isLocalVideoMuted()&&f.muteLocalVideo()),n&&(f._audioDevice=d,g.getAudioInputInterfaceService().replaceLocalMediaStream(f.call.getCallId(),f.localStream),f.call.isAudioMuted()&&f._rtConnection.disableLocalAudioStreams()),i.call(a,f)},function(b){j.call(a,f,b)})},function(b){j.call(a,f,b)})},updateVideoResolution:function(d,e,f,g,h,i){var j=this.getVideoOptions(d.call.getVideoChannels(),d._videoDevice);return d._rtConnection.removeLocalVideoTrack(d.localStream),c.Base.Logger.debug("Updating video resolution: "+f.getWidth()+"x"+f.getHeight()),e.getMediaServicesService().createLocalMediaStream(d.call.getCallId(),!1,!0,a,j.videoDeviceId,j.videoChannelId,f).then(function(c){var f=c.stream;c.videoResolution&&d._updateVideoResolution(c.videoResolution);var k=[];f.getTracks().forEach(function(a){k.push(d._rtConnection.replaceLocalMediaTrack(a,d.localStream))}),b.when.apply(this,k).then(function(){e.getVideoInterfaceService().replaceLocalMediaStream(j.videoChannelId,d.localStream),d.isLocalVideoMuted()&&d.muteLocalVideo(),g.call(a,d,i)},function(b){h.call(a,d,b)})}.bind(this),function(b){var e=d.call.getVideoChannels(),f=d.getVideoStreams(),j=b.getError();0<e.length&&j&&(j===c.Services.Call.CallError.CAMERA_PERMISSION_DENIED||j===c.Services.Call.CallError.OVERCONSTRAINED)?(c.Providers.Call.CPUtils.updateVideoDeniedStreams(e,f,{error:j,reason:b.getProtocolErrorReason()}),g.call(a,d,i)):h.call(a,d,b)})},replaceLocalAudioTrack:function(d,e,f,g){c.Base.Logger.info("Replacing local audio track");var h=d._audioDevice?d._audioDevice.getDeviceId():a,i=b.Deferred();return d._rtConnection.removeLocalAudioTrack(d.localStream),e.getMediaServicesService().createLocalMediaStream(d.call.getCallId(),!0,!1,h,a,a,a,g).then(function(a){a.stream.getTracks().forEach(function(a){d._rtConnection.replaceLocalMediaTrack(a,d.localStream).then(function(a){e.getAudioInputInterfaceService().replaceLocalMediaStream(d.call.getCallId(),d.localStream),d.call.isAudioMuted()&&d._rtConnection.disableLocalAudioStreams(),a&&f?(c.Base.Logger.debug("Send media negotiation"),d._callGatewayProvider.updateVideo(d.callId,d.getAudioStream(),d.getVideoStreams()).then(function(){i.resolve()},function(a){c.Base.Logger.error("Failed to send media negotiation: "+a),i.reject(a)})):i.resolve()},function(a){c.Base.Logger.error("Failed to replace audio track: "+a),i.reject(a)})})},function(a){i.reject(a)}),i},updateVideoDeniedStreams:function(a,b,d){a[0]._setCameraConstraint(d);var e=a[0]._getInternalRequestedDirection();e===c.Services.Call.MediaDirection.SEND_RECV?(a[0]._setRequestedDirection(c.Services.Call.MediaDirection.RECV_ONLY),c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY: "+d.error),0===b.length?b.push(new c.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",c.Services.Call.MediaDirection.RECV_ONLY)):b[0].direction=c.Services.Call.MediaDirection.RECV_ONLY):e===c.Services.Call.MediaDirection.SEND_ONLY&&(a[0]._setRequestedDirection(c.Services.Call.MediaDirection.INACTIVE),c.Base.Logger.warn(c.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE: "+d.error),0!==b.length&&(b[0].direction=c.Services.Call.MediaDirection.INACTIVE))},getVideoOptions:function(a,b){var d,e,f=!1;if(c.Base.Utils.isDefined(a))for(var g=0;g<a.length;g++)a[g]._getInternalRequestedDirection()!==c.Services.Call.MediaDirection.INACTIVE&&a[g].getNegotiatedDirection()!==c.Services.Call.MediaDirection.DISABLE&&(f=!0,d=a[g].getChannelId(),b&&(e=b.getDeviceId()));return{enable:f,videoChannelId:d,videoDeviceId:e}},nextLowerVideoResolution:function(a){var d=b.map(c.Base.VideoResolution,function(a){return a}),e=d.indexOf(a);return e+1<d.length?d[e+1]:a},nextHighestVideoResolution:function(a){var d=b.map(c.Base.VideoResolution,function(a){return a}),e=d.indexOf(a);return 0!==e?d[e-1]:a}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallFsmEvent=function(b,c){a.Base.SimpleFsm.SimpleFsmEvent.call(this,b,c),this.data=c}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallFsmEventData=function(){this.cpCall=a,this.callProvider=a}}(),function(b){"use strict";function c(){b.Providers.Call.CallFsmEvent.call(this),this.audioDevice=a,this.videoDevice=a}c.prototype={},b.Providers.Call.ReplaceVideoStreamWithContentEventData=c}(AvayaClientServices),function(b){"use strict";function c(){b.Providers.Call.CallFsmEvent.call(this),this.audioDevice=a,this.videoDevice=a}c.prototype={},b.Providers.Call.UpdateLocalStreamEventData=c}(AvayaClientServices),function(b){"use strict";function c(){this.event=a}c.prototype={handleEvent:function(a){throw new Error("Cannot call abstract method")}},b.Providers.Call.AbstractEventHandler=c}(AvayaClientServices),function(b){"use strict";b.Providers.Call.AcceptCallEventInInitialHandler=function(c){var d,e,f=c.data.cpCall,g=c.data.callProvider,h=f._callGatewayProvider,i=c.data.videoChannel,j=!1,k=!1,l=c.data.audioDevice?c.data.audioDevice.getDeviceId():a,m=c.data.videoResolution||f.getVideoResolution();g.hasVideoDevices()&&b.Base.Utils.isDefined(i)&&(i._getInternalRequestedDirection()===b.Services.Call.MediaDirection.INACTIVE||i.isDisabled()||(j=!0,e=i.getChannelId(),c.data.videoDevice&&(d=c.data.videoDevice.getDeviceId()))),f.isNailedUpVideoConnectionSupported()&&!b.Base.Utils.isDefined(i)&&(k=j=!0,d=c.data.videoDevice?c.data.videoDevice.getDeviceId():a,(i=g._createVideoChannel_VideoMode(b.Services.Call.VideoMode.DISABLE))._setChannelId("NailedUp_"+i.getChannelId()),e=i.getChannelId(),f.call._videoChannels.push(i)),g.triggerCallEstablishing(f.call);var n=c.data.audioDevice?c.data.audioDevice.toString():"Default Audio",c=c.data.videoDevice?c.data.videoDevice.toString():"Default Camera";return b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Accepting call using",n,c),g.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(f.call.getCallId(),!0,j,l,d,e,m).then(function(a){var c=a.stream;a.videoResolution&&f._updateVideoResolution(a.videoResolution),b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var d,e=null,l=null,m=[],n=b.Services.Call.MediaDirection.SEND_RECV;return c.getTracks().forEach(function(a){if("audio"===a.kind)e=new b.Providers.Interfaces.AudioStream(a.id,b.Services.Call.MediaDirection.SEND_RECV);else if("video"===a.kind){var c;if(k)n=b.Services.Call.MediaDirection.RECV_ONLY,c=b.Services.Call.MediaDirection.INACTIVE;else if(f.incomingCallInfo.videoStreams&&0<f.incomingCallInfo.videoStreams.length){switch(f.incomingCallInfo.videoStreams[0].direction){case b.Services.Call.MediaDirection.SEND_ONLY:n=b.Services.Call.MediaDirection.RECV_ONLY;break;case b.Services.Call.MediaDirection.RECV_ONLY:n=b.Services.Call.MediaDirection.SEND_ONLY;break;default:n=f.incomingCallInfo.videoStreams[0].direction}c=n}l=new b.Providers.Interfaces.VideoStream(a.id,n),f.isNailedUpVideoConnectionSupported()&&(l.logicalDirection=c),m.push(l)}}),null===e?(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void g.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[f.call,b.Services.Call.CallError.MICROPHONE_NOT_FOUND])):(j&&0===m.length&&f.isNailedUpVideoConnectionSupported()&&(d=g.getActiveCallVideoTrack(),b.Base.Utils.isDefined(d)&&(c.addTrack(d.clone()),(l=new b.Providers.Interfaces.VideoStream(d.id,n)).logicalDirection=f.getReversedVideoChannelDirection(f.incomingCallInfo.videoStreams[0].logicalDirection),m.push(l))),(!j||0===m.length)&&i&&!i.isDisabled()&&f.incomingCallInfo.videoStreams&&0<f.incomingCallInfo.videoStreams.length&&f.incomingCallInfo.videoStreams[0].enabled&&(a.constraint&&f.call.getVideoChannels()[0]._setCameraConstraint(a.constraint),n=f.incomingCallInfo.videoStreams[0].direction===b.Services.Call.MediaDirection.INACTIVE||f.incomingCallInfo.videoStreams[0].direction===b.Services.Call.MediaDirection.RECV_ONLY?b.Services.Call.MediaDirection.INACTIVE:b.Services.Call.MediaDirection.RECV_ONLY,l=new b.Providers.Interfaces.VideoStream(1,n),f.isNailedUpVideoConnectionSupported()&&(l.logicalDirection=k?b.Services.Call.MediaDirection.INACTIVE:n),m.push(l)),f.setAVStreams(e,m),f.localStream=c,c=f._rtConnection,void(c&&(f.updateIceServers(f.incomingCallInfo.turnData)&&c.updatePeerConfiguration(f._rtcConfiguration),c.addStream(f.localStream),c.disableLocalStreams(),c.onAddStream=function(a){f.handleEvent(new b.Providers.Call.OnAddStreamEvent({newStream:a}))},c.createAnswer(f.incomingCallInfo.sdp,function(a){0<m.length&&!b.Base.SDPUtil.hasH264(a.sdp)&&f.isFirefoxBrowser()&&(b.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),f.disableVideoStreamsAndChannels(b.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),h.acceptCall(f.callId,a.type,a.sdp,f.getAudioStream(),f.getVideoStreams()).fail(function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to send accept call",a),g.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[f.call,b.Services.Call.CallError.SEND_ERROR])})},function(a){b.Base.Utils.isDefined(a.errorCode)?(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",a.errorMsg),g.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[f.call,a.errorCode,a.protocolType,a.protocolErrorCode,a.errorMsg])):(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",a),g.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[f.call,b.Services.Call.CallError.INTERNAL_ERROR]))},function(a){return a=0<m.length&&m[0].enabled?b.Providers.Call.Utils.updateVideoSdp(m[0],a):b.Base.SDPUtil.rejectMedia(a,"m=video")}))))},function(a){var c="Error while retrieving local stream: "+JSON.stringify(a);b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,c),a.getError&&a.getError()?f.callFailure(a.getError()):g.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[f.call,b.Services.Call.CallError.MEDIA_CREATION_FAILURE])}),{nextState:b.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AcceptCallRequestEventInMultipleHandler=function(a){var b=a.data.cpCall,c=b._callGatewayProvider,d=a.data.deferred;c.acceptCallRequest(b.callId,b.getCallRequestedTransactionalId(a.data.requestedType),a.data.action).done(function(){d.resolve()},function(a){d.reject(a)})}}(),function(a){"use strict";a.Providers.Call.AcceptSendVideoEventInActiveHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=c._callGatewayProvider,f=c.call.getVideoChannels(),g=c.getVideoStreams();if(clearTimeout(c.incomingVideoRequestTimer),d.isVideoConfigurationEnabled()&&d.hasVideoDevices()){var h,i=f[0].getChannelId();a.Base.Utils.isDefined(b.data.videoDevice)&&(h=b.data.videoDevice.getDeviceId()),0===(g=c.getVideoStreams()).length&&(g.push(new a.Providers.Interfaces.VideoStream(0,a.Services.Call.MediaDirection.RECV_ONLY)),0!==f.length&&f[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.RECV_ONLY));var j=function(){var b=c.incomingCallInfo;g=c.getVideoStreams(),c.updateIceServers(b.turnData)&&c._rtConnection.updatePeerConfiguration(c._rtcConfiguration),g[0].direction!==a.Services.Call.MediaDirection.SEND_ONLY&&g[0].direction!==a.Services.Call.MediaDirection.DISABLE&&(g[0].direction=a.Services.Call.MediaDirection.SEND_RECV,c.isNailedUpVideoConnectionSupported()&&(g[0].logicalDirection=a.Services.Call.MediaDirection.SEND_RECV)),c._latestVideoModeDirection=g[0].direction,c.isLocalVideoMuted()&&c.muteLocalVideo(),e.updateVideo(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){c.notifyCallServiceOfMediaChanges()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)})}.bind(this);return c.isNailedUpVideoConnectionSupported()?j():(0<(f=c.localStream.getVideoTracks()).length&&(f[0].stop(),c.localStream.removeTrack(f[0])),d.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(h,i,c.localStream,b.data.videoResolution,c._rtConnection).then(function(){a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success"),j()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to add video to local media stream: ",b);var d=a.Services.Call.CallError.MEDIA_CREATION_FAILURE;b.getError()===a.Services.Call.CallError.CAMERA_PERMISSION_DENIED&&(d=a.Services.Call.CallError.CAMERA_PERMISSION_DENIED),c.rejectMediaTransaction(new a.Services.Call.CallException(d)),c.revertFsmState(a.Providers.Call.States.ACTIVE)})),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to accept send video - no video configured"),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.VIDEO_DENIED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler=function(a){var b=a.data.cpCall,c=a.data.callProvider;b._callGatewayProvider.addParticipantFromCall(b.callId,a.data.participantCallId,b.getAudioStream(),b.getVideoStreams()).then(function(){},function(d){c._updateConsultConferenceStatusHandler(a.data.participantCallId,"ERROR: "+d.errorMsg,b.callId)})}}(),function(b){"use strict";b.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler=function(c){var d=c.data.cpCall,e=c.data.callProvider,f=d.getVideoStreams(),g=c.data.videoStreams,h=c.data.audioStream,i=d.call.getVideoChannels(),j=g&&0<g.length?d.getStreamDirection(g[0]):a,h=d.getStreamDirection(h);if(j!==b.Services.Call.MediaDirection.INACTIVE&&d._rtConnection.enableRemoteVideoStreams(),h!==b.Services.Call.MediaDirection.INACTIVE&&d._rtConnection.enableRemoteAudioStream(),d.call.isAudioMuted()||c.data.action===b.Providers.Call.CallProvider.Constants.HOLD||d._rtConnection.enableLocalAudioStreams(),c.data.action===b.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)d.isNailedUpVideoConnectionSupported()||d.removeLocalVideoTracks(),(j===b.Services.Call.MediaDirection.INACTIVE||g&&0<g.length&&g[0].state===b.Providers.Call.CallProvider.Constants.DISABLE_STATE)&&(0<i.length&&(i[0]._setNegotiatedDirection(b.Services.Call.MediaDirection.INACTIVE),i[0]._setVideoDisabledReason(b.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),e.triggerVideoChannelUpdate(d.call));else{d.updateVideoStreamsDirection(g,c.data.action),d.updateVideoChannelDirection(g);for(var k=0;k<f.length;k++){var l=d.getStreamDirection(f[k]);l===b.Services.Call.MediaDirection.INACTIVE||l===b.Services.Call.MediaDirection.DISABLE?(i[k]._setNegotiatedDirection(l),i[k]._setVideoDisabledReason(b.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)):(d.setVideoChannelId(i[k].getChannelId()),l=i[k].getNegotiatedDirection(),c.data.action===b.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&l!==b.Services.Call.MediaDirection.SEND_RECV&&l!==b.Services.Call.MediaDirection.SEND_ONLY?d.isNailedUpVideoConnectionSupported()||d.removeLocalVideoTracks():l!==b.Services.Call.MediaDirection.SEND_RECV&&l!==b.Services.Call.MediaDirection.SEND_ONLY||c.data.action===b.Providers.Call.CallProvider.Constants.HOLD?l!==b.Services.Call.MediaDirection.RECV_ONLY&&l!==b.Services.Call.MediaDirection.INACTIVE||d.disableLocalVideoStreams(l):d.enableLocalVideoStreams(l),d._rtConnection.hasVideo(d.remoteStream)?e.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(i[k].getChannelId(),d.remoteStream):e.getMediaServiceFactory().getVideoInterfaceService().removeRemoteMediaStream(i[k].getChannelId())),e.triggerVideoChannelUpdate(d.call);break}}return d.resolveMediaTransaction(),{nextState:b.Providers.Call.States.ACTIVE,nextEvent:d.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=c._rtConnection,f=c.getVideoStreams(),g=c.call.getVideoChannels(),h=c.call;return c.updateAudioVideoStreamsDirection(b.data.audioStream,b.data.videoStreams,b.data.action),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+b.data.answer),e.receiveAnswer(b.data.answer,function(){if(c.notifyCallServiceOfMediaChanges(),b.data.action===a.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)c.removeLocalVideoTracks(),d.triggerVideoChannelUpdate(c.call);else if(0<b.data.videoStreams.length&&b.data.videoStreams[0].maxHeight!==c._videoResolution._height)c.adjustVideoConstraints.call(c,[b.data.videoStreams[0].maxWidth,b.data.videoStreams[0].maxHeight,b.data.videoStreams[0].maxFrames]);else if(h.getState()===a.Services.Call.CallStates.HOLDING||h.isHeldRemotely())for(var e=0;e<f.length;e++){var i=c.getStreamDirection(f[e]);i!==a.Services.Call.MediaDirection.INACTIVE&&i!==a.Services.Call.MediaDirection.DISABLE||(g[e]._setNegotiatedDirection(i),g[e]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER))}c.resolveMediaTransaction()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:c.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.AnswerSDPEventInMultipleHandler=function(b){var c=b.data.cpCall,d=(b.data.callProvider,c._callGatewayProvider),e=c._rtConnection;if(a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+b.data.answer),0<(f=c.getVideoStreams()).length){var f=c.getStreamDirection(f[0]),g=c.getStreamDirection(b.data.videoStreams[0]);if(f!==a.Services.Call.MediaDirection.INACTIVE&&g===a.Services.Call.MediaDirection.INACTIVE&&a.Base.Utils.getBrowserType()===a.Base.BrowserType.EDGE)return void(b.data.action===a.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?c.callFailure(a.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,a.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):c.callFailure(a.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,a.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"))}(g=b.data.videoStreams)&&0<g.length&&(c.updateVideoChannelDirectionBasedOnVideoMode(g),c.updateVideoStreamsDirectionBasedOnVideoMode(g),g.forEach(function(b){var d=c.getStreamDirection(b);!a.Services.Call.MediaDirection._isDisabled(d)&&b.enabled||a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE&&c._hasReceivedCallEstablishedEvent&&c.removeLocalVideoTracks()})),b.data.audioStream&&!b.data.audioStream.enabled&&e.removeLocalAudioTrack(c.localStream),e.receiveAnswer(b.data.answer,function(){d.answerSDPResponse(c.callId,c.getAudioStream(),c.getVideoStreams()),0<b.data.videoStreams.length&&c._videoResolution._height!==b.data.videoStreams[0].maxHeight&&(c.adjustVideoConstraints(b.data.videoStreams[0].maxWidth,b.data.videoStreams[0].maxHeight,b.data.videoStreams[0].maxFrames),a.Base.Utils.isDefined(b.data.videoBandwidth)&&c._updateVideoBandwidth(b.data.videoBandwidth))},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+b)})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.AttendedTransferEventInActiveHandler=function(b){var c=b.data.cpCall;c._callGatewayProvider.attendedTransfer(c.callId,b.data.targetCallId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){c._transferPromise.reject(new a.Services.Call.CallException(b.errorCode,b.protocolType,b.protocolErrorCode,b.errorMsg))})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.AudioEndedEventInMultipleHandler=function(b){var c=b.data.cpCall;c.localStream&&c._replaceAudioTrackIfNeeded(!0).always(function(){b.data.callProvider.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[c.call,c.localStream])})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.BlockCameraEventInActiveHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;return c.disableLocalVideoStreams(a.Services.Call.MediaDirection.RECV_ONLY),b.data.deallocateCamera&&c._rtConnection.removeLocalVideoTrack(c.localStream),d.blockUnBlockCamera(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to block camera: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallEstablishedEventInMultipleHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider;c.remoteStream&&c._rtConnection.enableRemoteStreams(),c.updateAudioStreamDirection(b.data.audioStream),c.updateAudioChannelDirection(c.getAudioStream()),c.execQueuedVideoMuteUnmuteFunctor(),c.call.isAudioMuted()||c.call.getAudioChannel().getRequestedDirection()===a.Services.Call.MediaDirection.DISABLE||c.call.getState()===a.Services.Call.CallStates.HELD||c._rtConnection.enableLocalAudioStreams();var e=c.getVideoStreams(),f=b.data.videoStreams,g=c.call.getVideoChannels();if(f&&0<f.length){c.updateVideoChannelDirectionBasedOnVideoMode(f),c.updateVideoStreamsDirectionBasedOnVideoMode(f);for(var h=0;h<g.length&&h<e.length;h++){var i=c.getStreamDirection(e[h]);if(!a.Services.Call.MediaDirection._isDisabled(i)){c.setVideoChannelId(g[h].getChannelId());var j=c.getStreamDirection(f[h]);a.Services.Call.MediaDirection._isDisabled(j)||!f[h].enabled?a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE&&c.removeLocalVideoTracks():(i!==a.Services.Call.MediaDirection.SEND_RECV&&i!==a.Services.Call.MediaDirection.SEND_ONLY||c.call.getState()===a.Services.Call.CallStates.HELD||c.enableLocalVideoStreams(),c._rtConnection.hasVideo(c.remoteStream)&&d.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(g[h].getChannelId(),c.remoteStream)),d.triggerVideoChannelUpdate(c.call,g[h]);break}}}var k=d.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return c.remoteStream&&!k.playAudioStream(c.remoteStream,c.call.isSpeakerMuted())&&a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."),a.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(d,c.call,b.data.address,b.data.displayName),d.triggerCallEstablished(c.call,b.data.isConf,b.data.uccpUrl,b.data.webCollabUrl,b.data.isRemote,b.data.ucid,b.data.parentUcid,b.data.contextId),{nextState:a.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallFailureEventInActiveRenegotiateHandler=function(b){var c,d=b.data.cpCall,e=b.data.callProvider,f=d.getAudioStream(),g=d.getVideoStreams();if(d.getMediaTransactionInitialEvent())switch(d.getMediaTransactionInitialEvent().stringValue){case a.Providers.Call.EscalateVideoEvent.stringValue:d.removeLocalVideoTracks();break;case a.Providers.Call.DeEscalateVideoEvent.stringValue:case a.Providers.Call.BlockCameraEvent.stringValue:d.enableLocalVideoStreams();break;case a.Providers.Call.UnBlockCameraEvent.stringValue:d.disableLocalVideoStreams();break;case a.Providers.Call.HoldEvent.stringValue:d.enableLocalStreams(),f.direction=a.Services.Call.MediaDirection.SEND_RECV;for(var h=0;h<g.length;h++)d.call.getVideoChannels()[h]&&(g[h].direction=d.call.getVideoChannels()[h].getNegotiatedDirection());d.setAVStreams(f,g);break;case a.Providers.Call.UnHoldEvent.stringValue:d.disableLocalStreams(),f.direction=a.Services.Call.MediaDirection.SEND_ONLY;for(var i=0;i<g.length;i++)g[i].direction=a.Services.Call.MediaDirection.INACTIVE}return b.data.errorCode===a.Services.Call.CallError.MEDIA_PRESERVED&&d&&d.call&&(b.data.callProvider.triggerCallServiceUnavailable(d.call),b.data.callProvider._callsAnalyticsService.sendUnavailableEvent(a.Services.Analytics.AnalyticsErrorCode.MEDIA_PRESERVED_ERROR)),d.mediaTransactionDfd?(c=b.data.errorCode===a.Services.Call.CallError.VIDEO_DENIED?b.data.errorCode:a.Services.Call.CallError.CALL_STATE_MISMATCH,d.rejectMediaTransaction(new a.Services.Call.CallException(c))):e.triggerCallFailure(d.callId,b.data.errorCode,b.data.protocolType,b.data.protocolErrorCode,b.data.failureReason),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:d.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.Logger.info("Initiating ICE restart with relay only"),b.setIceRestartRelayType(a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY),b.iceConnectionFailedHandler()}a.Providers.Call.CallFailureEventInMultipleHandler=function(c){var d,e=c.data.cpCall,f=c.data.callProvider,g=5e6===c.data.protocolErrorCode&&-1!==c.data.failureReason.indexOf("415 Media Failed"),h=422002===c.data.protocolErrorCode&&-1!==c.data.failureReason.indexOf("Notification rejected"),i=!a.Base.Utils.isUndefined(e.call.getEstablishedTime()),j=c.data.protocolErrorCode===a.Providers.CallServiceGateway.Constants.SEE_OTHER_RESOURCE;!i||g?(d="all"===e._rtcConfiguration.iceTransportPolicy,g=!!e._rtcConfiguration.iceServers&&0<e._rtcConfiguration.iceServers.length&&!!e._rtcConfiguration.iceServers[0].urls&&0<e._rtcConfiguration.iceServers[0].urls.length,g=d&&g&&e.getIceRestartRelayType()!==a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY,i?e._hadMediaConnected?(a.Base.Logger.error("Initiating ICE restart with "+e.getIceRestartRelayType()),e._processIceConnectionStateChange(e.getIceConnectionState(),!0)):g?b(e):h||f.triggerCallFailure(e.callId,c.data.errorCode,c.data.protocolType,c.data.protocolErrorCode,c.data.failureReason):g?b(e):(a.Base.Logger.error("Initiating ICE restart with "+e.getIceRestartRelayType()),e._processIceConnectionStateChange(e.getIceConnectionState(),!0))):j?(e._rtConnection.updatePeerConnection(e._rtConnection._rtcConfig),a.Base.Logger.info("Initiating ICE restart due to the 303 See Other"),e.iceConnectionFailedHandler()):h||f.triggerCallFailure(e.callId,c.data.errorCode,c.data.protocolType,c.data.protocolErrorCode,c.data.failureReason)}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallRingingEventInActiveHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider;a.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(d,c.call,b.data.address,b.data.displayName),c.call._isPrivateCallerID=!!a.Base.Utils.isDefined(b.data.isPrivate)&&b.data.isPrivate,c.call._isAuraAsserted=!!a.Base.Utils.isDefined(b.data.isAuraAsserted)&&b.data.isAuraAsserted,d.triggerCallRinging(c.call,b.data.earlyMedia)}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallRingingEventInStartingHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=c._rtConnection,f=d.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return a.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(d,c.call,b.data.address,b.data.displayName),c.call._isPrivateCallerID=!!a.Base.Utils.isDefined(b.data.isPrivate)&&b.data.isPrivate,c.call._isAuraAsserted=!!a.Base.Utils.isDefined(b.data.isAuraAsserted)&&b.data.isAuraAsserted,d.triggerCallRinging(c.call,b.data.earlyMedia),a.Base.Utils.isDefined(b.data.earlyMedia)&&(c._isEarlyMedia=b.data.earlyMedia,c._isEarlyMedia&&c.remoteStream&&!f.isPlaying(c.remoteStream)&&(e.enableRemoteStreams(),c.call.isAudioMuted()||e.enableLocalAudioStreams(),f.playAudioStream(c.remoteStream,c.call.isSpeakerMuted())||a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."))),{nextState:a.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.DeEscalateVideoEventInActiveHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,b=c._callGatewayProvider,e=c.call.getVideoChannels();c.disableLocalVideoStreams();for(var f=c.getVideoStreams(),g=0;g<f.length;g++)c.isNailedUpVideoConnectionSupported()?(f[g].direction=a.Services.Call.MediaDirection.RECV_ONLY,f[g].logicalDirection=a.Services.Call.MediaDirection.INACTIVE):f[g].direction=a.Services.Call.MediaDirection.INACTIVE,f[g].enabled=!1,d.triggerVideoChannelUpdate(c.call,e[g]);return b.deEscalateVideo(c.callId,c.getAudioStream(),f).then(function(){c.stopPerformanceMonitoring()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to deescalate video: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.DenySendVideoEventInActiveHandler=function(a){var b=a.data.cpCall,c=a.data.callProvider;0<(a=b.getVideoStreams()).length&&(b._latestVideoModeDirection=a[0].direction,b._latestNonHoldingVideoDirection=a[0].direction),clearTimeout(b.incomingVideoRequestTimer),c.triggerIncomingAddVideoDenied(b.call)}}(),function(a){"use strict";a.Providers.Call.DevicesFailureHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=b.data.callError||a.Services.Call.CallError.DEVICES_NOT_FOUND;return d.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[c.call,e]),{nextState:b.data.nextState}}}(AvayaClientServices),function(b){"use strict";b.Providers.Call.EndCallEventInMultipleHandler=function(c){var d=c.data.cpCall,e=d._callGatewayProvider,f=new b.Providers.Call.EndCallResponseEvent;return f.data={},d.stopAllStreams(),d.setVideoChannelId(a),f.data.remote=c.data.remote,f.data.host=c.data.cpCall._callGatewayProvider._host,c.data.remote?(f.data.callReason=c.data.callReason,{nextState:b.Providers.Call.States.ENDING,
nextEvent:d.prepareEvent(f)}):(e.endCall(d.callId,c.data.denialReason).then(function(){d.handleEvent(f)},function(a){d.handleEvent(f)}),{nextState:b.Providers.Call.States.ENDING})}}(AvayaClientServices),function(b){"use strict";b.Providers.Call.EndCallResponseEventInEndingHandler=function(c){var d,e=c.data.cpCall,f=c.data.callProvider,g=e.popQueuedRemoteCallEstablishedEvent();e.localStream=null,e.remoteStream=null,e._rtConnection&&(e._rtConnection.close(),e._rtConnection=null),b.Base.Utils.isDefined(e.mediaTransactionDfd)&&"pending"===e.mediaTransactionDfd.state()&&e.mediaTransactionDfd.reject(new b.Services.Call.CallException(b.Services.Call.CallError.ENDED)),f.unRegisterCall(e.call)&&f.triggerCallEnded(e.call,c.data.remote,c.data.callReason),g&&(d=(i=g.data.cpCall).call,f.callEstablished(d.getCallId(),d.getRemoteAddress(),d.getRemoteDisplayName(),d.getSubject(),g.data.isRemote,d.isCallerIdentityPrivate(),d.getAlertType(),d._isAuraAsserted,i.getAudioStream(),i.getVideoStreams()));var h=e._callGatewayProvider._host,i=e.call._callService._callManager.getAllCalls().filter(function(a){return!!a.getCallId()&&!!f._cpCalls[a.getCallId()]&&f._cpCalls[a.getCallId()]._callGatewayProvider._host===h});return e.call._callCreationInfo&&e.call._callCreationInfo.getAuthorizationToken()!==a&&!i.length&&f.stop(c.data.host),{nextState:b.Providers.Call.States.ENDED}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateNailedUpVideoEventInActiveHandler=function(b){var c=b.data.cpCall,b=c._callGatewayProvider;return c.enableLocalVideoStreams(),b.escalateVideo(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){c.disableLocalVideoStreams(),a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate nailedup video: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler=function(b){var c=b.data.cpCall,d=c._rtConnection;return c.updateVideoStreamsDirection(b.data.videoStreams,b.data.action),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+b.data.answer),d.receiveAnswer(b.data.answer,function(){var b=c.getVideoStreams();0<b.length&&(b=c.getStreamDirection(b[0]))!==a.Services.Call.MediaDirection.SEND_RECV&&b!==a.Services.Call.MediaDirection.SEND_ONLY&&c.removeLocalVideoTracks(),c.notifyCallServiceOfMediaChanges(),c.resolveMediaTransaction(),c.sendMuteUnmuteVideo()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Video escalation failed while receiving answer SDP: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:c.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoEventInActiveHandler=function(b){var c,d=b.data.cpCall,e=b.data.callProvider,f=d._callGatewayProvider,g=d.call.getVideoChannels(),h=g[0].getChannelId();return a.Base.Utils.isDefined(b.data.videoDevice)&&(c=b.data.videoDevice.getDeviceId()),d.setVideoChannelId(g[0].getChannelId()),e.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(c,h,d.localStream,b.data.videoResolution,d._rtConnection).then(function(b){a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var c=d.getAudioStream(),e=[];b.getTracks().forEach(function(b){var c;b.kind===a.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&b.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c=g[0]._getInternalRequestedDirection(),e.push(new a.Providers.Interfaces.VideoStream(b.id,c)))}),d.setAVStreams(c,e),d.isLocalVideoMuted()&&d.muteLocalVideo(),f.escalateVideo(d.callId,d.getAudioStream(),d.getVideoStreams()).then(function(){d.startPerformanceMonitoring()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate video: "+b),d.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),d.removeLocalVideoTracks(),d.revertFsmState(a.Providers.Call.States.ACTIVE)})},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. "+b),b.getError()===a.Services.Call.CallError.CAMERA_PERMISSION_DENIED||b.getError()===a.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(d.rejectMediaTransaction(b),d.revertFsmState(a.Providers.Call.States.ACTIVE)):(g[0]._negotiatedDirection=a.Services.Call.MediaDirection.INACTIVE,d.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),d.deviceRetrievalFailure(a.Providers.Call.States.ACTIVE))}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Call.GetOfferSDPEventInMultipleHandler.call(this)}(b.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(b){a.Providers.Call.GetOfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[b])},b.prototype.handleError=function(b){var c=this.event.data.cpCall,d=this.event.data.callProvider,e=c.call.getVideoChannels();c.removeLocalVideoTracks(),e[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),e[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),d.triggerVideoChannelUpdate(c.call),c.rejectMediaTransaction(b),c.revertFsmState(a.Providers.Call.States.ACTIVE)},a.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Call.OfferSDPEventInMultipleHandler.call(this)}(b.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(b){a.Providers.Call.OfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[b])},b.prototype.handleError=function(b){var c=this.event.data.cpCall,d=c.call.getVideoChannels();c.removeLocalVideoTracks(),d[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),d[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),c.rejectMediaTransaction(b),c.revertFsmState(a.Providers.Call.States.ACTIVE)},a.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler=b}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,b=c.call.getVideoChannels();return c.removeLocalVideoTracks(),b[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),b[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),d.triggerVideoChannelUpdate(c.call),c._rtConnection.rollbackLocalOfferState(),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.VIDEO_DENIED)),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:c.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Call.AbstractEventHandler.call(this)}(b.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(c){var d=c.data.cpCall,e=null!==d.localStream&&d._rtConnection.hasVideo(d.localStream)&&0<d.videoStreams.length&&d.videoStreams[0].enabled;d._replaceAudioTrackIfNeeded().always(function(){e&&c.data.videoResolution&&(d._videoResolution.getWidth()>c.data.videoResolution.getWidth()||d._videoResolution.getHeight()>c.data.videoResolution.getHeight())?d._rtConnection.isRTCRtpSenderSupported()?a.Providers.Call.CPUtils.updateVideoResolution(d,c.data.callProvider.getMediaServiceFactory(),c.data.videoResolution,b.prototype.getOffer.bind(this),b.prototype.errorHandler.bind(this),c):a.Providers.Call.CPUtils.createLocalMediaStream(c.data.audioDevice,c.data.videoDevice,d,c.data.callProvider.getMediaServiceFactory(),c.data.videoResolution,b.prototype.getOffer.bind(this),b.prototype.errorHandler.bind(this),c):b.prototype.getOffer.call(this,d,c)}.bind(this))},b.prototype.getOffer=function(c,d){var e=d.data.callProvider,f=c._callGatewayProvider,g=c._rtConnection;d.data.iceServerChanged&&c._rtConnection.updatePeerConfiguration(c._rtcConfiguration,d.data.restartTurnGathering),g.onAddStream=function(b){c.handleEvent(new a.Providers.Call.OnAddStreamEvent({newStream:b,action:d.data.action}))};var h,i,j,k=c.getVideoStreams(),l=!1;switch(d.data.action){case a.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:e.triggerRemoteHold(c.call);break;case a.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:e.triggerRemoteUnhold(c.call);break;case a.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:0<d.data.videoStreams.length&&(d.data.videoStreams[0].direction===a.Services.Call.MediaDirection.SEND_RECV&&c._prevMediaAction===a.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?k[0].direction=a.Services.Call.MediaDirection.RECV_ONLY:(i=c.calculateUpdateVideoDirection(d.data.videoStreams[0]),a.Base.Utils.isDefined(i)&&(k[0].direction=i,c._latestNonHoldingVideoDirection=i)));break;case a.Providers.Call.CallProvider.Constants.UPDATE_VIDEO:h=c.getIceConnectionRestartTimestamp(),l=c.isCallServiceAvailable()&&!!h}var m=c.call.getVideoChannels();0<k.length?c.getStreamDirection(k[0])===a.Services.Call.MediaDirection.RECV_ONLY&&(j=a.Services.Call.MediaDirection.RECV_ONLY):0<m.length&&m[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.DISABLE&&(j=a.Services.Call.MediaDirection.INACTIVE),g.createOffer(function(e){f.offerSDPResponse(c.callId,e,d.data.action,c.getAudioStream(),c.getVideoStreams()).then(function(){c.isIceRestartInProgress()&&c.setIceRestartInProgress(!1),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)},function(d){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while sending offer: "+d),this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR),c),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)}.bind(this))}.bind(this),function(d){a.Base.Utils.isDefined(d.errorCode)?(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer",d.errorMsg),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[c.call,d.errorCode,d.protocolType,d.protocolErrorCode,d.errorMsg])):(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer: "+d),this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR),c)),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c),l&&c.iceConnectionFailedHandler()}.bind(this),function(b){return b=0<k.length?a.Providers.Call.Utils.updateVideoSdp(k[0],b):a.Base.SDPUtil.rejectMedia(b,"m=video"),c.call.getState()===a.Services.Call.CallStates.HOLDING||c.call.getState()===a.Services.Call.CallStates.HELD||c.call.isHeldRemotely()?c.call.getState()!==a.Services.Call.CallStates.HELD&&c.call.getState()!==a.Services.Call.CallStates.HOLDING||(b=a.Providers.Call.Utils.updateAudioSdp(c.getAudioStream(),b)):b=a.Base.SDPUtil.updateAudioSdpSendRecv(b),b},j,l,h,d.data.useIPv6Candidates)},b.prototype.handleError=function(a,b){b.rejectMediaTransaction(a)},b.prototype.errorHandler=function(c){this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE),c),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)},b.prototype.resetFarEndRenegotiateStateIfNeeded=function(b){b.call.getState()===a.Services.Call.CallStates.FAR_END_RENEGOTIATING&&b.call._setState(a.Services.Call.CallStates.ESTABLISHED)},a.Providers.Call.GetOfferSDPEventInMultipleHandler=b}(AvayaClientServices),function(b){"use strict";b.Providers.Call.GetOfferSDPEventInStartingHandler=function(c){function d(a){a.deviceRetrievalFailure(b.Providers.Call.States.ACTIVE)}var e=c.data.cpCall,f=c.data.callProvider;e.setNailedUpVideoConnectionSupported(!1);var g=e.resetAudioOnlyNailedUpConnection();c.data.iceServerChanged&&e._rtConnection.updatePeerConfiguration(e._rtcConfiguration),e.updateAudioNoiseReduction(c.data.audioStream),e.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(c.data.videoStreams);var h=function(d){var e=d._callGatewayProvider,g=d._rtConnection;d._hasInitiatedMediaConnection=!0,g.onAddStream=function(a){d.handleEvent(new b.Providers.Call.OnAddStreamEvent({newStream:a}))};var i,j=d.getVideoStreams();0<j.length&&d.getStreamDirection(j[0])===b.Services.Call.MediaDirection.RECV_ONLY&&(i=b.Services.Call.MediaDirection.RECV_ONLY),g.createOffer(function(c){0<j.length&&!b.Base.SDPUtil.hasH264(c.sdp)&&d.isFirefoxBrowser()&&b.Base.Logger.warn(">>> H.264 video codec plugin is NOT installed <<<");var g=d.isMPaaSCall()?d.isLocalVideoMuted():a;e.getOfferSDPResponse(d.callId,c,d.getAudioStream(),d.getVideoStreams(),g).fail(function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to send get offer response",a),f.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,b.Services.Call.CallError.SEND_ERROR])})},function(a){b.Base.Utils.isDefined(a.errorCode)?(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",a.errorMsg),f.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,a.errorCode,a.protocolType,a.protocolErrorCode,a.errorMsg])):(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",a),a.includes("Failed to set local video description recv parameters")&&0<j.length?(d.videoStreams[0].direction===b.Services.Call.MediaDirection.SEND_RECV?(b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Retrying with recvonly video"),d.disableLocalVideoStreams(),d.videoStreams[0].direction=b.Services.Call.MediaDirection.RECV_ONLY):(b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Retrying with audio only"),d.removeLocalVideoTrack(d.localStream)),h(d)):f.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,b.Services.Call.CallError.INTERNAL_ERROR]))},function(a){return 0<j.length&&(a=b.Providers.Call.Utils.updateVideoSdp(j[0],a),j[0].enabled||(a=b.Base.SDPUtil.rejectMedia(a,"m=video"))),a},i,!1,0,c.data.useIPv6Candidates)},i=b.Base.Utils.isDefined(e.getNoiseSuppressionConstraints());e._replaceAudioTrackIfNeeded(!1,i).always(function(){null!==e.localStream&&e._rtConnection.hasVideo(e.localStream)&&(g||c.data.videoResolution&&c.data.videoResolution.getWidth()!==e._videoResolution.getWidth()&&c.data.videoResolution.getHeight()!==e._videoResolution.getHeight())?e._rtConnection.isRTCRtpSenderSupported()?b.Providers.Call.CPUtils.updateVideoResolution(e,c.data.callProvider.getMediaServiceFactory(),c.data.videoResolution,h,d,c):b.Providers.Call.CPUtils.createLocalMediaStream(c.data.audioDevice,c.data.videoDevice,e,c.data.callProvider.getMediaServiceFactory(),c.data.videoResolution,h,d,c):h(e)}.bind(this))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.HoldEventInActiveHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;c._rtConnection.disableLocalAudioStreams(),c.disableLocalVideoStreams();var b=c.getAudioStream(),e=c.getVideoStreams();c.isNailedUpVideoConnectionSupported()?b.logicalDirection=a.Services.Call.MediaDirection.SEND_ONLY:b.direction=a.Services.Call.MediaDirection.SEND_ONLY;for(var f=0;f<e.length;f++)c.isNailedUpVideoConnectionSupported()?(e[f].direction=a.Services.Call.MediaDirection.RECV_ONLY,e[f].logicalDirection=a.Services.Call.MediaDirection.INACTIVE):e[f].direction=a.Services.Call.MediaDirection.INACTIVE;return c.setAVStreams(b,e),d.holdCall(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to hold: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.IncomingAddVideoEventInActiveHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=c._callGatewayProvider,f=c._rtConnection,g=d._config.callUserConfiguration.incomingVideoRequestTimeout,h=d.isVideoConfigurationEnabled();a.Base.Utils.isDefined(g)||(g=a.Config.CallUserConfiguration.DefaultValues.INCOMING_VIDEO_REQUEST_TIMEOUT);var i,j,k=c.getAudioStream(),l=c.getVideoStreams();h&&(0===l.length?l.push(new a.Providers.Interfaces.VideoStream(0,a.Services.Call.MediaDirection.RECV_ONLY)):(l[0].enabled=b.data.videoStreams[0].enabled,l[0].direction=a.Services.Call.MediaDirection.RECV_ONLY),b.data.videoStreams[0].direction!==a.Services.Call.MediaDirection.SEND_RECV&&b.data.videoStreams[0].direction!==a.Services.Call.MediaDirection.SEND_ONLY&&c.updateVideoStreamsDirection(b.data.videoStreams,b.data.action),c._latestVideoModeDirection=l[0].direction,c._latestNonHoldingVideoDirection=l[0].direction,c.isNailedUpVideoConnectionSupported()&&(l[0].logicalDirection=l[0].direction,f.enableRemoteVideoStreams()),0===(j=c.call.getVideoChannels()).length?((i=d.createVideoChannel_MediaDirection(c.call,b.data.videoStreams[0].direction))._setNegotiatedDirection(a.Services.Call.MediaDirection.RECV_ONLY),j.push(i)):j[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.RECV_ONLY),b.data.videoStreams[0].direction!==a.Services.Call.MediaDirection.SEND_RECV&&b.data.videoStreams[0].direction!==a.Services.Call.MediaDirection.SEND_ONLY&&c.updateVideoChannelDirection(b.data.videoStreams),d.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(j[0].getChannelId(),c.remoteStream),d.triggerVideoChannelUpdate(c.call)),f.createAnswer(b.data.offer,function(a){e.offerSDPResponse(c.callId,a,b.data.action,k,l).then(function(){h&&(c.incomingCallInfo={offer:b.data.offer,audioStream:b.data.audioStream,videoStreams:b.data.videoStreams,action:b.data.action},c.incomingVideoRequestTimer=setTimeout(function(){c.incomingVideoRequestTimedout()},g),d.triggerIncomingAddVideoRequest(c.call))})},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"IncomingAddVideo error while creating answer: "+b)},function(b){return 0<l.length?a.Providers.Call.Utils.updateVideoSdp(l[0],b):a.Base.SDPUtil.rejectMedia(b,"m=video")})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler=function(b){var c=b.data.cpCall,b=b.data.callProvider;a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Timed out waiting for incoming add video request to be accepted"),b.triggerIncomingAddVideoTimedout(c.call)}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.IncomingCallEstablishedEventInEndingHandler=function(a){var b=a.data.cpCall;a.data.isRemote&&b.setQueuedRemoteCallEstablishedEvent(a)}}(),function(b){"use strict";b.Providers.Call.IncomingGenericOfferSDPEventInActive=function(c){var d=c.data.cpCall,e=d.getVideoStreams(),f=d.call.getVideoChannels();switch(c.data.action){case b.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:var g=0===e.length||!1===e[0].enabled||d.isNailedUpVideoConnectionSupported()&&e[0].logicalDirection===b.Services.Call.MediaDirection.INACTIVE,h=0<f.length&&f[0].getNegotiatedDirection()===b.Services.Call.MediaDirection.DISABLE,i=g||h?new b.Providers.Call.IncomingAddVideoEvent(c.data):(e[0].enabled=!0,d._mediaAction=b.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new b.Providers.Call.OfferSDPEvent(c.data));break;case b.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:i=c.data.videoStreams&&c.data.videoStreams[0].enabled?(e[0].enabled=!0,d._mediaAction=b.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new b.Providers.Call.OfferSDPEvent(c.data)):new b.Providers.Call.IncomingRemoveVideoEvent(c.data);break;case b.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:g=0===e.length||!1===e[0].enabled||d.isNailedUpVideoConnectionSupported()&&e[0].logicalDirection===b.Services.Call.MediaDirection.INACTIVE,h=0<f.length&&f[0].getNegotiatedDirection()===b.Services.Call.MediaDirection.DISABLE,i=g||h?(d._mediaAction=b.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION,new b.Providers.Call.IncomingAddVideoEvent(c.data)):new b.Providers.Call.OfferSDPEvent(c.data);break;default:i=new b.Providers.Call.OfferSDPEvent(c.data)}return{nextState:a,nextEvent:i}}}(AvayaClientServices),function(b){"use strict";b.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate=function(c){var d=c.data.cpCall;return b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"Received incoming offer event while in ACTIVE_RENEGOTIATE. Queuing for later processing."),d.setQueuedActiveRenegotiateEvent(c),{nextState:a,nextEvent:a}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.IncomingRemoveVideoEventInActiveHandler=function(b){function c(){d.call.getState()===a.Services.Call.CallStates.FAR_END_RENEGOTIATING&&d.call._setState(a.Services.Call.CallStates.ESTABLISHED)}var d=b.data.cpCall,e=b.data.callProvider,f=d._callGatewayProvider,g=d._rtConnection,h=d.call.getVideoChannels();d.disableLocalVideoStreams(),g.disableRemoteVideoStreams(),d.updateVideoStreamsDirection(b.data.videoStreams,b.data.action),0<h.length&&(d.isNailedUpVideoConnectionSupported()||d.removeLocalVideoTracks(),h[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),h[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)),e.triggerVideoChannelUpdate(d.call),g.createAnswer(b.data.offer,function(g){f.offerSDPResponse(d.callId,g,b.data.action,d.getAudioStream(),d.getVideoStreams()).then(function(){c()}.bind(this),function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",b),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,a.Services.Call.CallError.SEND_ERROR]),c()}.bind(this))},function(b){a.Base.Utils.isDefined(b.errorCode)?(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",b.errorMsg),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,b.errorCode,b.protocolType,b.protocolErrorCode,b.errorMsg])):(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",b),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[d.call,a.Services.Call.CallError.INTERNAL_ERROR])),c()})}}(AvayaClientServices),function(b){"use strict";b.Providers.Call.JoinRemoteCallEventInInitialHandler=function(c){var d,e=c.data.cpCall,f=c.data.callProvider,g=e._callGatewayProvider,h=c.data.audioDevice?c.data.audioDevice.getDeviceId():a,i=e._videoDevice?e._videoDevice.getDeviceId():a,j=e.isNailedUpVideoConnectionSupported()&&f.hasVideoDevices()&&f.isVideoAllowed();return j&&((c=f._createVideoChannel_VideoMode(b.Services.Call.VideoMode.DISABLE))._setInternalRequestedDirection(b.Services.Call.MediaDirection.RECV_ONLY),d="NailedUp_"+c.getChannelId(),c._setChannelId(d),e.call._videoChannels.push(c)),e._isReadyToReceiveMediaRequest=!0,f.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(e.call.getCallId(),!0,j,h,i,d,e._videoResolution).then(function(a){a=a.stream,e.localStream=a,e._rtConnection.addStream(e.localStream),e._rtConnection.disableLocalStreams();var c,d=null,f=[];a.getTracks().forEach(function(a){"audio"===a.kind?d=new b.Providers.Interfaces.AudioStream(a.id,b.Services.Call.MediaDirection.SEND_RECV):"video"===a.kind&&e.isNailedUpVideoConnectionSupported()&&((a=new b.Providers.Interfaces.VideoStream(a.id,b.Services.Call.MediaDirection.RECV_ONLY)).logicalDirection=b.Services.Call.MediaDirection.INACTIVE,f.push(a),c=new b.Providers.Call.NailedUpVideoConnectionInfo(b.Services.Call.MediaDirection.INACTIVE,b.Services.Call.MediaDirection.RECV_ONLY))}),e.setAVStreams(d,f),g.joinRemoteCall(e.callId,e.getAudioStream(),e.getVideoStreams(),c).then(function(){e._joinRemotePromise.resolve()},function(a){b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Failed to join to remote call: "+e.callId),e._joinRemotePromise.reject(new b.Services.Call.CallException(a.errorCode,a.protocolType,a.protocolErrorCode,a.errorMsg)),e.revertFsmState(b.Providers.Call.States.INITIAL)})},function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams to join remote call. "+a),e._joinRemotePromise.reject(new b.Services.Call.CallException(b.Services.Call.CallError.MEDIA_CREATION_FAILURE)),e.revertFsmState(b.Providers.Call.States.INITIAL),e.handleEvent(new b.Providers.Call.DeviceRetrievalFailedEvent)}),{nextState:b.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.MuteAudioEventInMultipleHandler=function(b){var c=b.data.cpCall;c.localStream&&(c.call._getIsContentVideoSharingStarted()?c.updateVideoSharingMicrophoneVolume(0):c._rtConnection.disableLocalAudioStreams(),b.data.callProvider.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[c.call,c.localStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.MuteSpeakerEventInMultipleHandler=function(a){var b=a.data.cpCall,a=a.data.callProvider;b.remoteStream&&a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().muteStream(b.remoteStream)}}(),function(a){"use strict";a.Providers.Call.MuteVideoEventInMultipleHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;c.muteLocalVideo(),c.isMPaaSCall()?c.hasReceivedCallEstablishedEvent()?d.muteVideo(c.callId,c.call._sessionId,c.getVideoStreams()).then(function(){c.noMediaTransactionDfd.resolve()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+b),c.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))}):(c.queueMuteUnumteFunctor(function(){d.muteVideo(c.callId,c.call._sessionId,c.getVideoStreams()).fail(function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+b)})}),c.noMediaTransactionDfd.resolve()):c.noMediaTransactionDfd.resolve()}}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Call.AbstractEventHandler.call(this)}(b.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(c){var d=(this.event=c).data.cpCall,e=c.data.callProvider,f=null!==d.localStream&&d._rtConnection.hasVideo(d.localStream)&&0<d.videoStreams.length&&d.videoStreams[0].enabled;c.data.iceServerChanged&&d._rtConnection.updatePeerConfiguration(d._rtcConfiguration),a.Base.Utils.isDefined(c.data.videoBandwidth)&&d._updateVideoBandwidth(c.data.videoBandwidth),d._replaceAudioTrackIfNeeded().always(function(){f&&c.data.videoResolution&&(d._videoResolution.getWidth()>c.data.videoResolution.getWidth()||d._videoResolution.getHeight()>c.data.videoResolution.getHeight())?a.Providers.Call.CPUtils.createLocalMediaStream(c.data.audioDevice,c.data.videoDevice,d,e.getMediaServiceFactory(),c.data.videoResolution,b.prototype.offerSDP.bind(this),b.prototype.errorHandler.bind(this),c):b.prototype.offerSDP.call(this,d,c)}.bind(this))},b.prototype.handleError=function(b){a.Base.Utils.isDefined(this.event.data.cpCall.mediaTransactionDfd)&&this.event.data.cpCall.rejectMediaTransaction(b)},b.prototype.errorHandler=function(c){this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)},b.prototype.resetFarEndRenegotiateStateIfNeeded=function(b){b.call.getState()===a.Services.Call.CallStates.FAR_END_RENEGOTIATING&&b.call._setState(a.Services.Call.CallStates.ESTABLISHED)},b.prototype.offerSDP=function(c,d){var e=d.data.callProvider,f=c._callGatewayProvider,g=c._rtConnection,h=c.call.getVideoChannels();g.onAddStream=function(b){c.handleEvent(new a.Providers.Call.OnAddStreamEvent({newStream:b,action:d.data.action}))},c.updateAudioVideoStreamsDirection(d.data.audioStream,d.data.videoStreams,d.data.action);var i,j,k=c.getVideoStreams();if(!(0<k.length)||d.data.action!==a.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION&&(i=c._mediaAction,j=d.data.action,i!==a.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION||j!==a.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION&&j!==a.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION)){if(0<k.length&&d.data.action===a.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&0<d.data.videoStreams.length&&(d.data.videoStreams[0].direction===a.Services.Call.MediaDirection.INACTIVE||d.data.videoStreams[0].direction===a.Services.Call.MediaDirection.DISABLE))for(var l=0;l<k.length;l++)h[l]._setNegotiatedDirection(d.data.videoStreams[0].direction),h[l]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}else{var m,n=c.getStreamDirection(k[0]);n===a.Services.Call.MediaDirection.SEND_RECV&&c._prevMediaAction===a.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?n=a.Services.Call.MediaDirection.RECV_ONLY:0<d.data.videoStreams.length&&(m=c.calculateUpdateVideoDirection(d.data.videoStreams[0]),a.Base.Utils.isDefined(m)&&(n=m,c._latestNonHoldingVideoDirection=m)),c.isNailedUpVideoConnectionSupported()?k[0].logicalDirection=n:k[0].direction=n}g.createAnswer(d.data.offer,function(h){switch(d.data.action){case a.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:c.call.isAudioMuted()||c.audioStream.direction!==a.Services.Call.MediaDirection.RECV_ONLY&&c.audioStream.direction!==a.Services.Call.MediaDirection.INACTIVE||g.disableLocalAudioStreams(),e.triggerRemoteHold(c.call);break;case a.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:c.call.isAudioMuted()||c.audioStream.direction!==a.Services.Call.MediaDirection.SEND_RECV&&c.audioStream.direction!==a.Services.Call.MediaDirection.SEND_ONLY||g.enableLocalAudioStreams(),e.triggerRemoteUnhold(c.call)}var i;0<k.length&&((i=c.getStreamDirection(k[0]))!==a.Services.Call.MediaDirection.RECV_ONLY&&i!==a.Services.Call.MediaDirection.INACTIVE||c.disableLocalVideoStreams(i)),c.notifyCallServiceOfMediaChanges(d.data.action),f.offerSDPResponse(c.callId,h,d.data.action,c.getAudioStream(),c.getVideoStreams()).then(function(){b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)}.bind(this),function(d){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while sending answer: "+d),this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)}.bind(this))}.bind(this),function(d){a.Base.Utils.isDefined(d.errorCode)?(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer",d.errorMsg),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[c.call,d.errorCode,d.protocolType,d.protocolErrorCode,d.errorMsg])):(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer: "+d),this.handleError(new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR))),b.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,c)}.bind(this),function(b){return b=0<k.length&&(k[0].enabled||c.isNailedUpVideoConnectionSupported())?a.Providers.Call.Utils.updateVideoSdp(k[0],b):a.Base.SDPUtil.rejectMedia(b,"m=video"),c.call.getState()===a.Services.Call.CallStates.HOLDING||c.call.getState()===a.Services.Call.CallStates.HELD||c.call.isHeldRemotely()||d.data.action===a.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION?c.call.getState()!==a.Services.Call.CallStates.HELD&&c.call.getState()!==a.Services.Call.CallStates.HOLDING||(b=a.Providers.Call.Utils.updateAudioSdp(c.getAudioStream(),b)):b=d.data.audioStream.direction!==a.Services.Call.MediaDirection.SEND_ONLY?a.Base.SDPUtil.updateAudioSdpSendRecv(b):a.Providers.Call.Utils.updateAudioSdp(c.getAudioStream(),b),
b})},a.Providers.Call.OfferSDPEventInMultipleHandler=b}(AvayaClientServices),function(a){"use strict";function b(b,c){var d=b._callGatewayProvider,e=c.data.callProvider,f=b._rtConnection;f.onAddStream=function(c){b.handleEvent(new a.Providers.Call.OnAddStreamEvent({newStream:c}))};var g=b.getVideoStreams();f.createAnswer(c.data.offer,function(f){0<g.length&&0<c.data.videoStreams.length&&!a.Base.SDPUtil.hasH264(f.sdp)&&b.isFirefoxBrowser()&&(a.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),b.disableVideoStreamsAndChannels(a.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),a.Base.Utils.isDefined(c.data.videoBandwidth)&&b._updateVideoBandwidth(c.data.videoBandwidth),d.offerSDPResponse(b.callId,f,c.data.action,b.getAudioStream(),g).fail(function(c){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",c),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[b.call,a.Services.Call.CallError.SEND_ERROR])})},function(c){a.Base.Utils.isDefined(c.errorCode)?(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",c.errorMsg),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[b.call,c.errorCode,c.protocolType,c.protocolErrorCode,c.errorMsg])):(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",c),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[b.call,a.Services.Call.CallError.INTERNAL_ERROR]))})}function c(b){b.revertFsmState(a.Providers.Call.States.ACTIVE)}a.Providers.Call.OfferSDPEventInStartingHandler=function(d){var e=d.data.cpCall,f=d.data.callProvider;e.determineIfNailedUpVideoConnectionSupported(d.data.videoStreams),d.data.iceServerChanged&&e._rtConnection.updatePeerConfiguration(e._rtcConfiguration),e.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(d.data.videoStreams),e._replaceAudioTrackIfNeeded().always(function(){null!==e.localStream&&e._rtConnection.hasVideo(e.localStream)&&d.data.videoResolution&&d.data.videoResolution.getWidth()!==e._videoResolution.getWidth()&&d.data.videoResolution.getHeight()!==e._videoResolution.getHeight()?a.Providers.Call.CPUtils.createLocalMediaStream(d.data.audioDevice,d.data.videoDevice,e,f.getMediaServiceFactory(),d.data.videoResolution,b,c,d):b(e,d)}.bind(this))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.OnAddRemoteTrackEventInActiveHandler=function(b){var c,d=b.data.cpCall,e=b.data.callProvider;a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,">>> Add new remote track: "+b.data.newTrack.kind+" id: "+b.data.newTrack.id),b.data.newTrack.kind===a.Providers.Call.CallProvider.Constants.VIDEO_TRACK?0<(c=d.call.getVideoChannels()).length&&(d._rtConnection.enableRemoteVideoTrack(d.remoteStream,b.data.newTrack),e.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(c[0].getChannelId(),d.remoteStream),e.triggerVideoChannelUpdate(d.call)):(c=e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),d.remoteStream&&!c.playAudioStream(d.remoteStream,d.call.isSpeakerMuted())&&a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not replay remote audio."),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[d.call,d.remoteStream]))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.OnAddStreamEventInActiveHandler=function(b){var c,d=b.data.cpCall,e=b.data.callProvider,f=null===d.remoteStream;0<b.data.newStream.getAudioTracks().length&&((c=e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput()).stopPlayingAudioStream(d.remoteStream),d.remoteStream=b.data.newStream,c.playAudioStream(d.remoteStream,d.call.isSpeakerMuted()),e.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(d.call.getCallId(),d.remoteStream),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[d.call,d.remoteStream])),!f&&null!==d.remoteStream.onaddtrack||(a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+d.remoteStream.id),d._rtConnection.onAddRemoteTrack=function(b){d.handleEvent(new a.Providers.Call.OnAddRemoteTrackEvent({newTrack:b}))},d._rtConnection.onRemoveRemoteTrack=function(b){d.handleEvent(new a.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:b}))}),d._rtConnection.enableRemoteStreams(),a.Base.Utils.isDefined(b.data.action)&&b.data.action===a.Providers.Call.CallProvider.Constants.UNHOLD&&(d.call.isAudioMuted()?d.enableLocalVideoStreams():d.enableLocalStreams()),d.notifyCallServiceOfMediaChanges(b.data.action)}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.OnAddStreamEventPreActiveHandler=function(b){var c=b.data.cpCall,d=c._rtConnection,e=b.data.callProvider,f=e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),g=null===c.remoteStream;c.remoteStream=b.data.newStream,e.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(c.call.getCallId(),c.remoteStream),e.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[c.call,c.remoteStream]),c._isEarlyMedia&&!f.isPlaying(c.remoteStream)?(d.enableRemoteStreams(),c.call.isAudioMuted()||d.enableLocalAudioStreams(),f.playAudioStream(c.remoteStream,c.call.isSpeakerMuted())||a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found.  Could not play remote audio.")):d.disableRemoteStreams(),g&&(a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+c.remoteStream.id),c._rtConnection.onAddRemoteTrack=function(b){c.handleEvent(new a.Providers.Call.OnAddRemoteTrackEvent({newTrack:b}))},c._rtConnection.onRemoveRemoteTrack=function(b){c.handleEvent(new a.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:b}))})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider;a.Base.Logger.debug(a.Base.LoggerTags.CALL_PROVIDER,">>> Removed remote track: "+b.data.newTrack.kind+" id: "+b.data.newTrack.id),b.data.newTrack.kind===a.Providers.Call.CallProvider.Constants.AUDIO_TRACK&&(c.remoteStream.getAudioTracks().forEach(function(a){a.id===b.data.newTrack.id&&d.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().stopPlayingAudioStream(c.remoteStream,!1)}),d.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[c.call,c.remoteStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectCallRequestEventInMultipleHandler=function(a){var b=a.data.cpCall,c=b._callGatewayProvider,d=a.data.deferred;c.rejectCallRequest(b.callId,b.getCallRequestedTransactionalId(a.data.requestedType),a.data.action).then(function(){d.resolve()},function(a){d.reject(a)})}}(),function(a){"use strict";a.Providers.Call.RejectMidCallEventInMultipleHandler=function(b){var c=b.data.cpCall;a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Reject mid call event in invalid state: ",b.data.action),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.INVALID_STATE))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectOfferSDPEventInMultipleHandler=function(a){var b=a.data.cpCall;b._callGatewayProvider.rejectOfferSDPResponse(b.callId,a.data)}}(),function(){"use strict";AvayaClientServices.Providers.Call.ReplaceVideoStreamWithContentHandler=function(a){var c=a.data.cpCall,d=[];a.data.stream.getTracks().forEach(function(a){d.push(c._rtConnection.replaceLocalMediaTrack(a,c.localStream))}),b.when.apply(this,d).then(function(){c.mediaTransactionDfd.resolve().promise()})}}(),function(){"use strict";AvayaClientServices.Providers.Call.RevertStateEventInMultipleHandler=function(a){return{nextState:a.data.state}}}(),function(){"use strict";AvayaClientServices.Providers.Call.SendDTMFEventInMultipleHandler=function(a){a.data.cpCall._rtConnection.sendDTMF(a.data.dtmf)}}(),function(){"use strict";AvayaClientServices.Providers.Call.ServiceAvailableEventInMultipleHandler=function(a){(a=a.data.cpCall).isIceConnectionStateFailed()?a.iceConnectionFailedHandler():a.initiateIceRecoveryIfDetectedMediaPathProblem()}}(),function(b){"use strict";b.Providers.Call.StartCallEventInInitialHandler=function(c){var d,e,f,g=c.data.cpCall,h=c.data.callProvider,i=g._callGatewayProvider,j=g.call.getVideoChannels(),k=g.call.getAudioChannel(),l=!0,m=!1,n=!1,o=c.data.audioDevice?c.data.audioDevice.getDeviceId():a;if(b.Base.Utils.isDefined(j))for(var p=0;p<j.length;p++){var q=j[p]._getInternalRequestedDirection();q===b.Services.Call.MediaDirection.SEND_ONLY||q===b.Services.Call.MediaDirection.SEND_RECV?(m=!0,c.data.videoDevice&&(d=c.data.videoDevice.getDeviceId())):q===b.Services.Call.MediaDirection.RECV_ONLY&&(n=!0,b.Base.Utils.getBrowserType()===b.Base.BrowserType.EDGE&&h.hasVideoDevices()&&(m=!0)),q!==b.Services.Call.MediaDirection.INACTIVE&&(e=j[p].getChannelId())}return(l=(!b.Base.Utils.isDefined(k)||k.getRequestedDirection()!==b.Services.Call.MediaDirection.DISABLE)&&l)||m||!c.data.webCollab?l?(l=c.data.audioDevice?c.data.audioDevice.toString():"Default Audio",f=c.data.videoDevice?c.data.videoDevice.toString():"Default Camera",b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Starting call using",l,f),h.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(g.call.getCallId(),!0,m,o,d,e,c.data.videoResolution).then(function(d){if(g.call.getState()===b.Services.Call.CallStates.ENDING||g.call.getState()===b.Services.Call.CallStates.ENDED)return b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Start call rejected for inactive call"),void d.stream.getTracks().forEach(function(a){a.stop()});var e=d.stream;d.videoResolution&&g._updateVideoResolution(d.videoResolution),b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var f=0,k=null,l=[];if(e.getTracks().forEach(function(a){var c;"audio"===a.kind?k=new b.Providers.Interfaces.AudioStream(a.id,b.Services.Call.MediaDirection.SEND_RECV):"video"===a.kind&&(c=b.Services.Call.MediaDirection.SEND_RECV,f<j.length&&(c=j[f]._getInternalRequestedDirection(),f++),l.push(new b.Providers.Interfaces.VideoStream(a.id,c)))}),null===k)return b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void h.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[g.call,b.Services.Call.CallError.MICROPHONE_NOT_FOUND]);var o,p=c.data.nailedUpVideoConnection;if(m&&0===l.length&&p&&(o=h.getActiveCallVideoTrack(),b.Base.Utils.isDefined(o)&&(e.addTrack(o.clone()),l.push(new b.Providers.Interfaces.VideoStream(o.id,j[0]._getInternalRequestedDirection())))),0===l.length)if(m&&!n){if(d.constraint&&j[0]._setCameraConstraint(d.constraint),d=j[0]._getInternalRequestedDirection(),d===b.Services.Call.MediaDirection.SEND_RECV)j[0]._setRequestedDirection(b.Services.Call.MediaDirection.RECV_ONLY),b.Base.Logger.warn(b.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY"),l.push(new b.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",b.Services.Call.MediaDirection.RECV_ONLY));else if(d===b.Services.Call.MediaDirection.SEND_ONLY)j[0]._setRequestedDirection(b.Services.Call.MediaDirection.INACTIVE),b.Base.Logger.warn(b.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE");else{if(!p){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to get video media streams for call."),g._rtConnection.stopStream(e);var q=new b.Providers.Call.DeviceRetrievalFailedEvent;return void g.handleEvent(q)}h.triggerAllowedNailedUpVideoModes(g.call,[b.Services.Call.VideoMode.RECEIVE_ONLY,b.Services.Call.VideoMode.DISABLE]),g.hasNailedUpConnectionVideoChannel()?(j[0]._setRequestedDirection(b.Services.Call.MediaDirection.DISABLE),j[0]._setInternalRequestedDirection(b.Services.Call.MediaDirection.RECV_ONLY)):j[0]._setRequestedDirection(b.Services.Call.MediaDirection.RECV_ONLY),p._setLogicalDirection(b.Services.Call.MediaDirection.INACTIVE);var r=new b.Providers.Interfaces.VideoStream("nailedUpVideo",b.Services.Call.MediaDirection.RECV_ONLY);l.push(r)}p&&p._setRequiredDirection(j[0]._getInternalRequestedDirection())}else n&&l.push(new b.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",b.Services.Call.MediaDirection.RECV_ONLY));p&&0<l.length&&(l[0].logicalDirection=p.getLogicalDirection()),g.setAVStreams(k,l),g.localStream=e,g._rtConnection.addStream(g.localStream),g._rtConnection.disableLocalStreams(),q=g.isMPaaSCall()?g.isLocalVideoMuted():a,r=g.call.getCallId(),b.Base.Utils.isUndefined(r)&&(e=g.generateTemporarilyCallId(),h.registerCall(e,g.call,g)),i.startCall(c.data.remoteAddress,g.call.getSubject(),g.call._callCreationInfo,c.data.video,c.data.webCollab,g.getAudioStream(),g.getVideoStreams(),q,c.data.uccp,r,g.call._sessionId,p,g.call.getNoiseReductionSetting()).then(function(a){b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(a));var d=new b.Providers.Call.StartCallResponseEvent;d.data={},d.data.callId=a.callId,d.data.videoResolution=c.data.videoResolution,d.data.audioDevice=c.data.audioDevice,d.data.videoDevice=c.data.videoDevice,d.data.clientCpuUsageMgmt=a.clientCpuUsageMgmt,g.handleEvent(d)},function(a){g._rtConnection.stopAllStreams(),h.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[g.call,a.errorCode,a.protocolType,a.protocolErrorCode,a.errorMsg])})},function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",a);var c=new b.Providers.Call.DeviceRetrievalFailedEvent;a.getError&&a.getError()&&(c.data={callError:a.getError()}),g.handleEvent(c)})):(b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Video only call is not supported"),h.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[g.call,b.Services.Call.CallError.VIDEO_ONLY_CALL_NOT_SUPPORTED])):(g.call._dataOnly=!0,g._isMPaaSCollabCall=g.isMPaaSCall(),b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Starting Collaboration only call"),f=g.call.getCallId(),b.Base.Utils.isUndefined(f)&&(o=g.generateTemporarilyCallId(),h.registerCall(o,g.call,g)),i.startCall(c.data.remoteAddress,g.call.getSubject(),g.call._callCreationInfo,!1,c.data.webCollab,null,null,!1,c.data.uccp,f,g.call._sessionId).then(function(a){b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(a));var c=new b.Providers.Call.StartCallResponseEvent;c.data={},c.data.callId=a.callId,g.handleEvent(c)},function(a){h.trigger(b.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[g.call,a.errorCode,a.protocolType,a.protocolErrorCode,a.errorMsg])})),{nextState:b.Providers.Call.States.STARTING}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.StartCallResponseEventInStartingHandler=function(b){var c=b.data.cpCall,d=b.data.callProvider,e=b.data.callId;if(c.callId=e,c._isReadyToReceiveMediaRequest=!0,d.updateCpCall(c,e),c.call.getState()===a.Services.Call.CallStates.ENDING)d.stopCall(c.call);else{d.triggerCallStarted(c.call),a.Base.Utils.isDefined(b.data.clientCpuUsageMgmt)&&d.trigger(a.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[b.data.clientCpuUsageMgmt]),d.getMediaServiceFactory().getAudioInputInterfaceService().replaceLocalMediaStream(e,c.localStream);var f=d.getQueuedCallFailure(e);if(f)c.callFailure(f.errorCode,f.protocolType,f.protocolErrorCode,f.failureReason);else{var g=d.getQueuedCallEstablishedNotification(e);if(g){var h=c.buildCallEstablishedEvent(g.remoteAddress,g.remoteDisplayName,g.audioStream,g.videoStreams,g.isConference,g.uccpUrl,g.webCollabUrl,!1,g.ucid,g.parentUcid,g.contextId);return c.prepareEvent(h),{nextEvent:h}}var i,j=function(){var f=d.getQueuedMediaOfferNotification(e);f&&(a.Base.Utils.isDefined(f.offer)?c.offerSDP(f.offer,f.action,f.audioStream,f.videoStreams,f.videoBandwidth,f.turnData):c.getOfferSDP(f.action,f.audioStream,f.videoStreams,f.videoBandwidth,b.data.audioDevice,b.data.videoDevice,f.turnData,f.restartTurnGathering,f.useIPv6Candidates))},k=d.getQueuedVideoMuteState(),f=d.getQueuedAudioMuteState(),g=d.getQueuedSpeakerMuteState(),h=[];k&&(k===a.Services.Call.MediaMuteStates.MUTED?i=c.muteVideo():k===a.Services.Call.MediaMuteStates.UNMUTED&&(i=c.unmuteVideo()),h.push(i)),f&&(i=f?c.muteAudio():c.unmuteAudio(),h.push(i)),g&&(i=g?c.muteSpeaker():c.unmuteSpeaker(),h.push(i)),h.length?h.forEach(function(a){a?a.always(function(){j()}):j()}):j()}}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.StartContentVideoSharingHandler=function(c){var d,e,f,g=c.data.cpCall,h=[],i=g._callGatewayProvider,j=c.data.callProvider,k=g.getVideoStreams();g.isMPaaSCall()&&0<k.length?((d=k[0].direction===a.Services.Call.MediaDirection.RECV_ONLY)?k[0].direction=a.Services.Call.MediaDirection.SEND_RECV:(g._rtConnection.removeLocalVideoTrack(g.localStream),j.triggerVideoChannelUpdate(g.call)),c.data.stream.getTracks().forEach(function(b){var e;b.kind===a.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK?(g.localStream.getAudioTracks().forEach(function(a){g.setVideoSharingAudioConstraints(a.getConstraints())}),e=g.mixVideoSharingAudio(g.localStream,c.data.stream),h.push(g._rtConnection.replaceLocalMediaTrack(e))):d&&!g._rtConnection.hasVideoTracks()?g._rtConnection.addTrack(b,g.localStream):h.push(g._rtConnection.replaceLocalMediaTrack(b))}),e=function(){g.call._setIsContentVideoSharingStarted(!0),g.resolveMediaTransaction()},f=function(b,c){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,c),i.stopVideoSharing(g.callId,g.call._sessionId,k),g.rejectMediaTransaction(new a.Services.Call.CallException(b))},i.startVideoSharing(g.callId,g.call._sessionId,k).then(function(){b.when.apply(this,h).then(function(){d?i.updateVideo(g.call.getCallId(),g.getAudioStream(),k,!1).then(e,function(b){f(a.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+b)}):e()},function(b){i.stopVideoSharing(g.callId,g.call._sessionId,k),f(a.Services.Call.CallError.MEDIA_CREATION_FAILURE,"Failed to replace video sharing track: "+b)})},function(b){f(a.Services.Call.CallError.SEND_ERROR,"Failed to notify server of start video sharing: "+b)})):g.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.StartRingingEventInInitialHandler=function(a){var b=a.data.cpCall;b._callGatewayProvider.startRinging(b.callId).then(function(){b.setRingingStarted(!0)})}}(),function(b){"use strict";b.Providers.Call.StopContentVideoSharingHandler=function(c){var d,e,f=c.data.cpCall,g=f._callGatewayProvider,h=f.getVideoStreams(),i=f.getVideoSharingAudioConstraints();i&&(f.localStream.getAudioTracks().forEach(function(a){a.applyConstraints(i)["catch"](function(a){b.Base.Logger.info(b.Base.LoggerTags.CALL_PROVIDER,"Resetting "+i+" constraints rejected: "+a)})}.bind(this)),f.setVideoSharingAudioConstraints(a)),f.isMPaaSCall()&&0<h.length?((d="recvOnlyVideoStreamId"===h[0].id)&&(h[0].direction=b.Services.Call.MediaDirection.RECV_ONLY),e=function(a,c){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,c),g.stopVideoSharing(f.callId,f.call._sessionId,h),f.mediaTransactionDfd.reject(new b.Services.Call.CallException(a))},g.stopVideoSharing(f.callId,f.call._sessionId,f.getVideoStreams()).then(function(){f.call.isAudioMuted()&&(f.localStream.getAudioTracks()[0].enabled=!1),f.stopVideoSharingStream(),f.removeVideoSharingAudioContext(),f.call._setIsContentVideoSharingStarted(!1),d?(f._rtConnection.removeLocalVideoTrack(f.localStream),g.updateVideo(f.call.getCallId(),f.getAudioStream(),h,!1).then(function(){f.mediaTransactionDfd.resolve().promise()},function(a){e(b.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+a)})):f.replaceContentWithVideo()},function(a){e(b.Services.Call.CallError.SEND_ERROR,"Failed to notify server of stop video sharing: "+a)})):f.mediaTransactionDfd.reject(new b.Services.Call.CallException(b.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.TransferEventInActiveHandler=function(b){var c=b.data.cpCall;c._callGatewayProvider.transfer(c.callId,b.data.targetRemoteAddress,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){c._transferPromise.reject(new a.Services.Call.CallException(b.errorCode,b.protocolType,b.protocolErrorCode,b.errorMsg))})}}(AvayaClientServices),function(b){"use strict";b.Providers.Call.UnBlockCameraEventInActiveHandler=function(c){var d,e,f,g=c.data.cpCall,h=g._callGatewayProvider,i=g.localStream.getVideoTracks();return 0<i.length&&!g.hasVideoTrackStopStreaming(i[0])?(g.enableLocalVideoStreams(),h.blockUnBlockCamera(g.callId,g.getAudioStream(),g.getVideoStreams()).then(function(){},function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+a),g.rejectMediaTransaction(new b.Services.Call.CallException(b.Services.Call.CallError.SEND_ERROR)),g.revertFsmState(b.Providers.Call.States.ACTIVE)})):(0<i.length&&g.localStream.removeTrack(i[0]),d=c.data.callProvider,e=g.call.getVideoChannels(),f=b.Base.Utils.isDefined(c.data.videoDevice)?c.data.videoDevice.getDeviceId():a,i=e[0].getChannelId(),g.setVideoChannelId(e[0].getChannelId()),d.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(f,i,g.localStream,c.data.videoResolution,g._rtConnection).then(function(a){b.Base.Logger.debug(b.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var c=g.getAudioStream(),d=[];a.getTracks().forEach(function(a){var c;a.kind===b.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&a.readyState===b.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(c=b.Services.Call.MediaDirection.SEND_RECV,d.push(new b.Providers.Interfaces.VideoStream(a.id,c)))}),g.setAVStreams(c,d),g.isLocalVideoMuted()&&g.muteLocalVideo(),h.blockUnBlockCamera(g.callId,g.getAudioStream(),g.getVideoStreams()).then(function(){},function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+a),g.rejectMediaTransaction(new b.Services.Call.CallException(b.Services.Call.CallError.SEND_ERROR)),g.revertFsmState(b.Providers.Call.States.ACTIVE)})},function(a){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",a);for(var c=g.getVideoStreams(),d=0;d<c.length;d++)c[d].direction=e[d].getNegotiatedDirection();a.getError()===b.Services.Call.CallError.CAMERA_PERMISSION_DENIED||a.getError()===b.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(g.rejectMediaTransaction(a),g.revertFsmState(b.Providers.Call.States.ACTIVE)):(g.rejectMediaTransaction(new b.Services.Call.CallException(b.Services.Call.CallError.MEDIA_CREATION_FAILURE)),g.deviceRetrievalFailure(b.Providers.Call.States.ACTIVE))})),{nextState:b.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UnHoldEventInActiveHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;0===(b=c.call.getVideoChannels()).length||b[0]._getInternalRequestedDirection()!==a.Services.Call.MediaDirection.SEND_RECV&&b[0]._getInternalRequestedDirection()!==a.Services.Call.MediaDirection.SEND_ONLY?(c.call.isAudioMuted()||c._rtConnection.enableLocalAudioStreams(),0<b.length&&b[0]._getInternalRequestedDirection()===a.Services.Call.MediaDirection.RECV_ONLY&&c.enableLocalVideoStreams(b[0]._getInternalRequestedDirection())):(c.call.isAudioMuted()||c._rtConnection.enableLocalAudioStreams(),c.enableLocalVideoStreams());var b=c.getAudioStream(),e=c.getVideoStreams();b.direction=a.Services.Call.MediaDirection.SEND_RECV,c.isNailedUpVideoConnectionSupported()&&(b.logicalDirection=a.Services.Call.MediaDirection.SEND_RECV);for(var f=0;f<e.length;f++)c.isNailedUpVideoConnectionSupported()?(e[f].direction=a.Services.Call.MediaDirection.SEND_RECV,e[f].logicalDirection=c._latestNonHoldingVideoDirection):e[f].direction=c._latestNonHoldingVideoDirection;return c.setAVStreams(b,e),d.unholdCall(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to unhold: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UnmuteAudioEventInMultipleHandler=function(b){var c=b.data.cpCall;c.localStream&&(c.call._getIsContentVideoSharingStarted()?c.updateVideoSharingMicrophoneVolume(1):c._replaceAudioTrackIfNeeded(!0).always(function(){c._rtConnection.enableLocalAudioStreams(),b.data.callProvider.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[c.call,c.localStream])}))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.UnmuteSpeakerEventInMultipleHandler=function(a){var b=a.data.cpCall,a=a.data.callProvider;b.remoteStream&&a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().unmuteStream(b.remoteStream)}}(),function(a){"use strict";a.Providers.Call.UnmuteVideoEventInMultipleHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;c.unmuteLocalVideo(),c.isMPaaSCall()?c.hasReceivedCallEstablishedEvent()?d.unmuteVideo(c.callId,c.call._sessionId,c.getVideoStreams()).then(function(){c.noMediaTransactionDfd.resolve()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+b),c.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))}):(c.queueMuteUnumteFunctor(function(){d.unmuteVideo(c.callId,c.call._sessionId,c.getVideoStreams()).fail(function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+b)})}),c.noMediaTransactionDfd.resolve()):c.noMediaTransactionDfd.resolve()}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler=function(b){var c=b.data.cpCall;c.isMPaaSCall()?b.data.fromMicrophone?c.localStream.getAudioTracks().forEach(function(b){c._rtConnection.replaceLocalMediaTrack(b).then(function(){a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Updated content video sharing audio from microphone"),c.mediaTransactionDfd.resolve()},function(b){c.mediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE,a.Services.Call.CallProtocolType.APPLICATION,500,b))})}):b.data.stream.getAudioTracks().forEach(function(b){c._rtConnection.replaceLocalMediaTrack(b).then(function(){a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Reverted content video sharing audio"),c.mediaTransactionDfd.resolve()},function(b){c.mediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE,a.Services.Call.CallProtocolType.APPLICATION,500,b))})}):c.mediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateIceRestartMediaEventInActiveHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;if(c.isCallServiceAvailable()){c.setIceRestartInProgress(!0),a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var e="all"===c._rtcConfiguration.iceTransportPolicy,f=!!c._rtcConfiguration.iceServers&&0<c._rtcConfiguration.iceServers.length&&!!c._rtcConfiguration.iceServers[0].urls&&0<c._rtcConfiguration.iceServers[0].urls.length,b=c._rtcConfiguration._turnOfferType===a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return e&&f&&b&&1<c.getIceRestartAttemtps()&&(a.Base.Logger.info("Initiating ICE restart with relay only"),c.setIceRestartRelayType(a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),c._replaceAudioTrackIfNeeded().always(function(){d.updateVideo(c.callId,c.getAudioStream(),c.getVideoStreams(),!0).then(function(){},function(b){c.setIceRestartInProgress(!1),c.revertFsmState(a.Providers.Call.States.ACTIVE),a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+b)})}.bind(this)),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}c.setIceRestartInProgress(!1),a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;if(c.isCallServiceAvailable()){c.setIceRestartInProgress(!0),a.Base.Logger.info(a.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var e="all"===c._rtcConfiguration.iceTransportPolicy,f=!!c._rtcConfiguration.iceServers&&0<c._rtcConfiguration.iceServers.length&&!!c._rtcConfiguration.iceServers[0].urls&&0<c._rtcConfiguration.iceServers[0].urls.length,b=c._rtcConfiguration._turnOfferType===a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return e&&f&&b&&(!c._hadMediaConnected||1<c.getIceRestartAttemtps())&&(a.Base.Logger.info("Initiating ICE restart with relay only"),c.setIceRestartRelayType(a.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),c._replaceAudioTrackIfNeeded().always(function(){d.updateVideo(c.callId,c.getAudioStream(),c.getVideoStreams(),!0).then(function(){},function(b){c.setIceRestartInProgress(!1),a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+b)})}.bind(this)),{nextState:a.Providers.Call.States.MEDIA_RECOVERY}}c.setIceRestartInProgress(!1),a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateLocalStreamHandler=function(b){function c(){a.Base.Logger.debug("Sending UPDATE_VIDEO request for new local stream"),g._callGatewayProvider.updateVideo(g.callId,g.getAudioStream(),g.getVideoStreams()).then(function(){a.Base.Utils.isDefined(b.data.videoResolutionChanged)||g.revertFsmState(a.Providers.Call.States.ACTIVE),b.data.selectedDevice&&b.data.selectedDevice._kind===a.Base.MediaTypes.AUDIO_INPUT&&b.data.callProvider.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[g.call,g.localStream])},function(b){a.Base.Logger.error("Failed to update local stream: "+g.getVideoResolution()),g.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),g.revertFsmState(a.Providers.Call.States.ACTIVE)})}function d(){a.Base.Logger.error("Create local media error: "+g.getVideoResolution()),g.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),g.revertFsmState(a.Providers.Call.States.ACTIVE)}var e,f,g=b.data.cpCall;return null!==g.localStream?(g._rtConnection.isRTCRtpSenderSupported()?b.data.videoResolutionChanged?a.Providers.Call.CPUtils.updateVideoResolution(g,b.data.callProvider.getMediaServiceFactory(),b.data.videoResolution,c,d):(b.data.selectedDevice._kind===a.Base.MediaTypes.VIDEO_INPUT?f=b.data.selectedDevice:e=b.data.selectedDevice,e&&g.isScreenSharingUsingVideo()?a.Providers.Call.CPUtils.updateDevices(e,f,g,b.data.callProvider.getMediaServiceFactory(),b.data.videoResolution,function(){var b=g.mixVideoSharingAudio(g.localStream);g._rtConnection.replaceLocalMediaTrack(b).then(function(){c()},function(b){a.Base.Logger.error("Failed to replace new content video sharing audio track"),g.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),g.revertFsmState(a.Providers.Call.States.ACTIVE)})},d,g.getNoiseSuppressionConstraints()):a.Providers.Call.CPUtils.updateDevices(e,f,g,b.data.callProvider.getMediaServiceFactory(),b.data.videoResolution,c,d,g.getNoiseSuppressionConstraints())):a.Providers.Call.CPUtils.createLocalMediaStream(b.data.audioDevice,b.data.videoDevice,g,b.data.callProvider.getMediaServiceFactory(),b.data.videoResolution,c,d),
{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}):void c()}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler=function(b){var c,d=b.data.cpCall,e=d._callGatewayProvider;d.hasReceivedCallEstablishedEvent()?(c=(c=a.Base.VideoResolution[b.data.videoResolution]).getWidth()+"x"+c.getHeight(),e.updatePreferredReceiveResolution(d.callId,d.call._sessionId,d.getVideoStreams(),c).then(function(){d.call.getVideoChannels()[0]._preferredReceiveResolution=b.data.videoResolution,d.noMediaTransactionDfd.resolve()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution: "+b),d.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))})):(a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution due to invalid state ",d.call.getState()),d.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateRemoteVideoEventInActiveHandler=function(b){var c=b.data.cpCall,d=c._callGatewayProvider;return 0!==(b=c.getVideoStreams()).length&&b[0].enabled&&c._rtConnection.setLocalVideoDirection(b[0].direction),d.updateVideo(c.callId,c.getAudioStream(),c.getVideoStreams()).then(function(){},function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+b),c.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),c.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this._verifySupportedLogicalDirection(a),this._verifySupportedGuidelinesDirection(b),this._verifySupportedGuidelinesDirection(c),this._logicalDirection=a,this._requiredDirection=b,this._permittedDirection=c}b.prototype={getLogicalDirection:function(){return this._logicalDirection},getRequiredDirection:function(){return this._requiredDirection},getPermittedDirection:function(){return this._permittedDirection},_setLogicalDirection:function(a){this._verifySupportedLogicalDirection(a),this._logicalDirection=a},_setRequiredDirection:function(a){this._verifySupportedGuidelinesDirection(a),this._requiredDirection=a},_setPermittedDirection:function(a){this._verifySupportedGuidelinesDirection(a),this._permittedDirection=a},_verifySupportedLogicalDirection:function(b){if(b===a.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported logical video direction: "+b)},_verifySupportedGuidelinesDirection:function(b){if(b&&b===a.Services.Call.MediaDirection.SEND_ONLY||b===a.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported video guidelines direction: "+b)}},a.Providers.Call.NailedUpVideoConnectionInfo=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Base.Observable.call(this),this._networkProvider=b,this._config={},this._notificationProvider=c,this._notificationParser=d}(b.prototype=Object.create(a.Base.Observable.prototype)).init=function(b){return this._config=b,this._networkProvider.onMessage=function(a){},this._networkProvider.onError=function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_GATEWAY_PROVIDER,b)},this._networkProvider.init(this._config),this._notificationProvider.onMessage=function(b){var c,d,e=b.data&&b.type!==a.Base.ProvidersEventTypes.PING?JSON.parse(b.data):b;try{c=JSON.parse(e.message),d=(d=this._notificationParser.parse(c))||c}catch(b){d=e}d.type?this.trigger("call."+d.type,[d]):this.trigger("call.message",[d])}.bind(this),this._notificationProvider.onError=function(b){a.Base.Logger.error(a.Base.LoggerTags.CALL_GATEWAY_PROVIDER,b)},this._notificationProvider.init(this._config),this},b.prototype.startCall=function(b){return b=JSON.stringify({remoteAddress:b}),this._networkProvider.send(b,{sendType:"POST",urlSuffix:"/restgateway/calls",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(b){return new a.Providers.CallGateway.StartCallData(b.callHref,b.callId)})},b.prototype.endCall=function(a){return a={sendType:"DELETE",urlSuffix:"/restgateway/calls/"+a,dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json"}},this._networkProvider.send(null,a)},b.prototype.acceptCall=function(a,b){return b={sendType:"POST",urlSuffix:"/restgateway/calls/"+a+"/connections/"+b,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json;"}},this._networkProvider.send(null,b)},b.prototype.holdCall=function(a,b){return b={sendType:"POST",urlSuffix:"/restgateway/calls/"+a+"/connections/"+b+"/hold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}},this._networkProvider.send(null,b)},b.prototype.unholdCall=function(a,b){return b={sendType:"POST",urlSuffix:"/restgateway/calls/"+a+"/connections/"+b+"/unhold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}},this._networkProvider.send(null,b)},a.Providers.CallGateway.CallGatewayProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallGateway.ActiveCallMessage=function(a,b,c,d,e,f,g,h,i,j){this.type="active",this.callEvent="ACTIVE",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.connectionId=g,this.connectionHref=h,this.address=i,this.operations=j}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AlertingCallMessage=function(a,b,c,d,e,f,g,h,i,j,k){this.type="alerting",this.callEvent="ALERTING",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.connectionId=g,this.connectionHref=h,this.address=i,this.operations=j,this.alertingParticipant=k}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AnsweredCallMessage=function(a,b,c,d,e,f,g,h,i,j,k){this.type="answered",this.callEvent="ANSWERED",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.connectionId=g,this.connectionHref=h,this.address=i,this.operations=j,this.answeringParticipant=k}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.FailedCallMessage=function(a,b,c,d,e,f,g,h){this.type="failed",this.callEvent="FAILED",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.address=g,this.reason=h}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.HeldCallMessage=function(a,b,c,d,e,f,g,h,i,j){this.type="held",this.callEvent="HELD",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.connectionId=g,this.connectionHref=h,this.address=i,this.operations=j}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.ParticipantDroppedCallMessage=function(a,b,c,d,e){this.type="participantDropped",this.callEvent="PARTICIPANTDROPPED",this.participants=a,this.callId=b,this.callHref=c,this.address=d,this.droppingParticipant=e}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.StartCallData=function(a,b){this.callId=b,this.callHref=a}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.SubscriptionCallMessage=function(a,b,c){this.type="subscription",this.callEvent="SUBSCRIPTION",this.status=a,this.subscriptionId=b,this.additionalProperties=c}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.UnheldCallMessage=function(a,b,c,d,e,f,g,h,i,j){this.type="unheld",this.callEvent="UNHELD",this.originalCallingParticipant=a,this.originalCalledParticipant=b,this.participants=c,this.callId=d,this.ucId=e,this.callHref=f,this.connectionId=g,this.connectionHref=h,this.address=i,this.operations=j}}(),function(a){"use strict";function b(){}b.prototype={parse:function(a){throw new Error("Method not implemented!")}},a.Providers.CallGateway.AbstractParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.ActiveCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.connectionId,b.connectionHref,b.address,b.operations)},a.Providers.CallGateway.ActiveCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.AlertingCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.connectionId,b.connectionHref,b.address,b.operations,b.alertingParticipant)},a.Providers.CallGateway.AlertingCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.AnsweredCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.connectionId,b.connectionHref,b.address,b.operations,b.answeringParticipant)},a.Providers.CallGateway.AnsweredCallMessageParser=b}(AvayaClientServices),function(b){"use strict";function c(){this._parsers=[]}c.prototype={register:function(a,b){this._parsers[a]=b},unregister:function(b){this._parsers[b]=a},parse:function(a){return a.callEvent?this._delegateParser(a.callEvent,a):a.subscriptionId?this._delegateParser("subscription",a):a},_delegateParser:function(c,d){return this._parsers[c]!==a?this._parsers[c].parse(d):void b.Base.Logger.error(b.Base.LoggerTags.CALL_GATEWAY_PROVIDER,"No parser specified!",c)}},b.Providers.CallGateway.CallNotificationParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.FailedCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.address,b.reason)},a.Providers.CallGateway.FailedCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.HeldCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.connectionId,b.connectionHref,b.address,b.operations)},a.Providers.CallGateway.HeldCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.ParticipantDroppedCallMessage(b.participants,b.callId,b.callHref,b.address,b.droppingParticipant)},a.Providers.CallGateway.ParticipantDroppedCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.SubscriptionCallMessage(b.status,b.subscriptionId,b.additionalProperties)},a.Providers.CallGateway.SubscriptionCallMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.CallGateway.AbstractParser.prototype)).parse=function(b){return new a.Providers.CallGateway.UnheldCallMessage(b.originalCallingParticipant,b.originalCalledParticipant,b.participants,b.callId,b.ucId,b.callHref,b.connectionId,b.connectionHref,b.address,b.operations)},a.Providers.CallGateway.UnheldCallMessageParser=b}(AvayaClientServices),function(b){"use strict";function c(){this._csgCallsProviderMap={},this._csgProviderMap={},this._csgPresenceProvider=a,this._messageBuilder=new b.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder}c.prototype={getCSGCallsProvider:function(a){return this._csgCallsProviderMap.hasOwnProperty(a)||(this._csgCallsProviderMap[a]=new b.Providers.CallServiceGateway.CSGCallsProvider(this._getCSGProvider(a),this._messageBuilder,a)),this._csgCallsProviderMap[a]},getCSGCallsProviderAsArray:function(){var a,b=[];for(a in this._csgCallsProviderMap)this._csgCallsProviderMap.hasOwnProperty(a)&&b.push(this._csgCallsProviderMap[a]);return b},getCSGPresenceProvider:function(a){return this._csgPresenceProvider||(this._csgPresenceProvider=new b.Providers.CallServiceGateway.CSGPresenceProvider(this._getCSGProvider(a),this._messageBuilder)),this._csgPresenceProvider},_getCSGProvider:function(c){var d,e,f,g;return this._csgProviderMap.hasOwnProperty(c)||(f=[b.Providers.CallServiceGateway.CSGNotificationEventType.CAS_NOTIFICATION,b.Providers.CallServiceGateway.CSGNotificationEventType.PING],e=new b.Base.SSEProvider(f),d=new b.Base.RESTProvider,g=new b.Base.SSEIntegrationProvider(d,e),f=new b.Base.WebSocketProvider,d=new b.Base.NetworkProvider(f,g,b.Base.LoggerTags.CALL_GATEWAY_PROVIDER),e=new b.Base.NetworkProvider(new b.Base.RESTProvider,a,b.Base.LoggerTags.CALL_GATEWAY_PROVIDER),f=new b.Base.PollingRESTProvider,g=new b.Base.PollingRESTProvider,this._csgProviderMap[c]=new b.Providers.CallServiceGateway.CSGProvider(this._messageBuilder,e,d,f,g)),this._csgProviderMap[c]}},b.Providers.CallServiceGateway.CallServiceGatewayProviderFactory=c}(AvayaClientServices),function(b){"use strict";function c(){this._requestCounter=0}var d={CSA_RESOURCE:"application/vnd.avaya.csa.resources.v1+json",CSA_SERVICES:"application/vnd.avaya.csa.services.v1+json",CSA_ERROR:"application/vnd.avaya.csa.error.v1+json",CSA_CONFIGURATION:"application/vnd.avaya.csa.configuration.v1+json",CSA_CALL:"application/vnd.avaya.csa.call.v1+json",CSA_CALLS:"application/vnd.avaya.csa.calls.v1+json",CSA_CLIENT:"application/vnd.avaya.csa.client.v1+json",CSA_CLIENTS:"application/vnd.avaya.csa.clients.v1+json",CSA_CALL_ACTION:"application/vnd.avaya.csa.callaction.v1+json",CSA_CALL_PREFERENCE:"application/vnd.avaya.csa.callpreferences.v1+json",CSA_PRESENCE_CONTAINER:"application/vnd.avaya.presence-im.container.v1+json",CSA_PRESENCE_PUBLICATION:"application/vnd.avaya.presence.presence-pub.v1+json",CSA_PRESENCE_RESOURCE_LIST:"application/vnd.avaya.csa.resourcelist.v1+json",MPAAS_CALL_PROPERTIES:"application/vnd.avaya.mpaas.callproperties.v1+json"},e="://";c.prototype={buildStartCallOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:d.CSA_CALL,"Content-Type":d.CSA_CALL_PREFERENCE}}},buildActivateServiceOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:d.CSA_SERVICES,"Content-Type":d.CSA_SERVICES}}},buildActivateServiceData:function(a,c){return a={action:b.Providers.CallServiceGateway.CallActionType.ACTIVATE,service:a,extendedData:{mode:b.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:b.Providers.CallServiceGateway.Constants.WEBRTC,register:c.isRegisterUser()}},c.getMinBandwidth()&&(a.extendedData.videoBandwidth=c.getMinBandwidth()),c.getVideoChannelGuidelines()&&(c=c.getVideoChannelGuidelines(),a.extendedData.videoChannelGuidelines={},c.requiredDirection&&(a.extendedData.videoChannelGuidelines.requiredClientLegDirections=b.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(c.requiredDirection)),c.permittedDirection&&(a.extendedData.videoChannelGuidelines.permittedLogicalDirections=b.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(c.permittedDirection)),a.extendedData.audioChannelGuidelines={requiredClientLegDirections:b.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(b.Services.Call.MediaDirection.SEND_RECV)}),a},buildDeactivateServiceOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:d.CSA_SERVICES,"Content-Type":d.CSA_SERVICES}}},buildDeactivateServiceData:function(a){return{action:b.Providers.CallServiceGateway.CallActionType.DEACTIVATE,service:a,extendedData:{mode:b.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:b.Providers.CallServiceGateway.Constants.WEBRTC,recoveryToken:null,register:!1}}},buildResourceDiscoveryOptions:function(a){return{urlSuffix:a||b.Providers.CallServiceGateway.Constants.CSA_RESOURCE_PATH,sendType:b.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[d.CSA_RESOURCE,d.CSA_ERROR].join(", ")}}},buildResourceDiscoveryData:function(a){var b={};return a&&(b.existingclientid=a),b},buildUpdateCallOptions:function(a,c){var f,a=b.Base.Utils.parseUrl(a);return a&&(f=a.protocol+e+a.host,f={urlSuffix:(a.path||"")+"/"+c,url:f,sendType:b.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:b.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,crossDomain:!0,headers:{"Content-Type":d.CSA_CALL_ACTION}}),f},buildGetCallsOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[d.CSA_CALLS,d.CSA_ERROR].join(", ")}}},buildGetCallOptions:function(a,c){var f=b.Base.Utils.parseUrl(a),a=f.protocol+e+f.host;return{urlSuffix:f.path||"",url:a+"/"+c,sendType:b.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[d.CSA_CALL,d.CSA_ERROR].join(", ")}}},buildGetClientsOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[d.CSA_CLIENTS,d.CSA_ERROR].join(", ")}}},buildGetClientOptions:function(a,c){var f=b.Base.Utils.parseUrl(a),a=f.protocol+e+f.host;return{urlSuffix:f.path||"",url:a+"/"+c,sendType:b.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[d.CSA_CLIENT,d.CSA_ERROR].join(", ")}}},buildKeepAliveOptions:function(a){var c={crossDomain:!0};return b.Base.Utils.isUndefined(a)||(b.Base.Utils.isDefined(a.credentialProvider)&&"string"==typeof a.credentialProvider.username&&"string"==typeof a.credentialProvider.password?c.authentication={type:b.Config.Authentication.Scheme.BASIC,username:a.credentialProvider.username,password:a.credentialProvider.password}:b.Base.Utils.isDefined(a.credentialProvider)&&"string"==typeof a.credentialProvider.token&&(c.authentication={type:b.Config.Authentication.Scheme.BEARER,bearer:a.credentialProvider.bearer,token:a.credentialProvider.token})),c},buildDeleteSessionOptions:function(a){var c=b.Base.Utils.parseUrl(a),a=c.protocol+e+c.host;return{urlSuffix:c.path||"",url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_DELETE,crossDomain:!0}},buildSubscribeRequest:function(a,c){return{subscribe:{requestId:this._generateRequestId(),resources:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:a,resource:c}],version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildUnsubscribeRequest:function(a,c){return{unsubscribe:{requestId:this._generateRequestId(),resources:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:a,resource:c}],version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildSubscribeGenericEventsOptions:function(a){return this._generateGenericEventsOptions(a,b.Providers.CallServiceGateway.Constants.HTTP_POST,b.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildUnsubscribeGenericEventsOptions:function(a,c){return a=this._generateGenericEventsOptions(a,b.Providers.CallServiceGateway.Constants.HTTP_DELETE,b.Providers.CallServiceGateway.Constants.CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS,b.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE),a.urlSuffix=a.urlSuffix+"?sessionId="+c,a},buildUpdateGenericEventsOptions:function(a){return this._generateGenericEventsOptions(a,b.Providers.CallServiceGateway.Constants.HTTP_PUT,b.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,b.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildNotificationsOptions:function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},buildProcessMediaOfferResponseNotification:function(a,c,e,f,g,h,i){return i={action:e,actionDetails:{targetCallId:null,participants:null,sdpType:f.toUpperCase(),sdp:g,audioChannel:b.Base.Utils.isDefined(h)?h:null,videoChannels:b.Base.Utils.isDefined(i)?i:null,conferenceData:null}},{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:d.CSA_CALL_ACTION,messageData:JSON.stringify(i)}}]}}},buildRejectOfferResponseNotification:function(a,c,e,f,g){return g={error:[{errorCode:e,errorMsg:f,displayMsg:g}]},{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:d.CSA_ERROR,messageData:JSON.stringify(g)}}]}}},buildProcessMediaAnswerResponseNotification:function(a,c,d,e){return{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreateMediaResponseNotification:function(a,c,e,f,g,h){return h={action:null,actionDetails:{targetCallId:null,participants:null,sdpType:e.toUpperCase(),sdp:f,audioChannel:b.Base.Utils.isDefined(g)?g:null,videoChannels:b.Base.Utils.isDefined(h)?h:null,conferenceData:null}},{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.CREATE_MEDIA_RESPONSE,messageDataType:d.CSA_CALL_ACTION,messageData:JSON.stringify(h)}}]}}},buildUpdateMediaRequestNotification:function(a,c,e,f,g,h){return h=!!h,h={action:e,actionDetails:{targetCallId:null,participants:null,sdpType:null,sdp:null,audioChannel:b.Base.Utils.isDefined(f)?f:null,videoChannels:b.Base.Utils.isDefined(g)?g:null,conferenceData:null,forceIceRestart:h}},{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_REQUEST,messageDataType:d.CSA_CALL_ACTION,messageData:JSON.stringify(h)}}]}}},buildGetConfigurationOptions:function(a){return{url:a,sendType:"GET",dataType:"JSON",headers:{Accept:[d.CSA_CONFIGURATION,d.CSA_ERROR].join(", ")}}},buildAcceptCallResponse:function(a,c,d){return{notify:{requestId:b.Base.Utils.isDefined(d)&&null!==d?d:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.ACCEPT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildRejectCallResponse:function(a,c,d){return{notify:{requestId:b.Base.Utils.isDefined(d)&&null!==d?d:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.REJECT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreatePubSubContainerOptions:function(a){return{url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:b.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,headers:{Accept:[d.CSA_PRESENCE_CONTAINER,d.CSA_ERROR].join(", "),"Content-Type":d.CSA_PRESENCE_CONTAINER}}},buildDeletePubSubContainerOptions:function(a){return{url:a,sendType:b.Providers.CallServiceGateway.Constants.HTTP_DELETE,headers:{Accept:d.CSA_ERROR}}},buildCreateOrExtendPubSubContainerData:function(b,c,d){if(!b||c||d)return JSON.stringify({pubSubContainer:{additionalResources:{presencePublication:c?{}:a,presenceSubscriptions:d?[{}]:a}}})},buildPublishPresenceOptions:function(a){return{url:a,sendType:"PUT",headers:{Accept:[d.CSA_ERROR,d.CSA_PRESENCE_PUBLICATION].join(", "),"Content-Type":d.CSA_PRESENCE_PUBLICATION}}},buildDeleteManualPresenceOptions:function(a){return{url:a,sendType:"DELETE",headers:{Accept:d.CSA_ERROR}}},buildPublishManualPresenceData:function(a,c){var d={presencePublication:{}};return a===b.Providers.CallServiceGateway.Constants.MANUAL_STATE?d.presencePublication.manualState={stateEnum:b.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(c)}:a===b.Providers.CallServiceGateway.Constants.MODE?d.presencePublication.mode={modeEnum:b.Providers.CallServiceGateway.Utils.convertPresenceModeToCSGPresenceMode(c)}:a===b.Providers.CallServiceGateway.Constants.NOTE&&(d.presencePublication.note={content:c}),JSON.stringify(d)},buildPublishAutoPresenceData:function(a){var c=[],d=a.getEnterpriseIMState(),e=a.getEnterpriseIMContact(),f=a.getVideoState(),g=a.getVideoContact(),h=a.getPhoneState(),i=a.getPhoneContact(),a=b.Services.Presence.PresenceState;return f&&f!==a.PRESENCE_STATE_UNSPECIFIED&&c.push({channel:"video",contact:g,stateEnum:b.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(f),subType:b.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),d&&d!==a.PRESENCE_STATE_UNSPECIFIED&&c.push({channel:"im",contact:e,stateEnum:b.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(d),subType:b.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),h&&h!==a.PRESENCE_STATE_UNSPECIFIED&&c.push({channel:"phone",contact:i,stateEnum:b.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(h),subType:b.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),JSON.stringify({presencePublication:{channelPresence:c}})},buildPresenceSubscriptionData:function(a,b){var c=[];return b.forEach(function(a){c.push({userIdentity:{userId:a}})}),JSON.stringify({resourceList:{listDefaults:{action:a,aclConfirmHandling:"prompt",docType:"full"},presentities:c}})},buildPresenceSubscriptionOptions:function(a){return{url:a,sendType:"POST",dataType:"JSON",headers:{Accept:[d.CSA_ERROR,d.CSA_PRESENCE_RESOURCE_LIST].join(", "),"Content-Type":d.CSA_PRESENCE_RESOURCE_LIST}}},buildUpdateCallPropertiesNotification:function(a,c,e,f,g){return e={sessionId:e,videoChannels:b.Base.Utils.isDefined(f)?f:null},f&&0!==f.length&&(b.Base.Utils.isDefined(g.localVideoMute)?e.videoChannels[0].localVideoMute=g.localVideoMute:e.videoChannels[0].localVideoMute=null,b.Base.Utils.isDefined(g.preferredReceiveResolution)?e.videoChannels[0].preferredReceiveResolution=g.preferredReceiveResolution:e.videoChannels[0].preferredReceiveResolution=null,b.Base.Utils.isDefined(g.screenSharing)?e.videoChannels[0].screenSharing=g.screenSharing:e.videoChannels[0].screenSharing=null,e.videoChannels[0].maxFrames=null,e.videoChannels[0].bandwidth=null),{notify:{requestId:this._generateRequestId(c),notifications:[{application:b.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:b.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:b.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:a,contents:{callId:c,messageType:b.Providers.CallServiceGateway.Constants.UPDATE_CALL_PROPERTIES,messageDataType:d.MPAAS_CALL_PROPERTIES,messageData:JSON.stringify(e)}}]}}},_generateRequestId:function(a){return a?"jscsdk."+a+".req-"+this._requestCounter++:"jscsdk.null.req-"+this._requestCounter++},_isFirefoxBrowser:function(){return b.Base.Utils.getBrowserType()===b.Base.BrowserType.FIREFOX},_generateCommonGenericEventsOptions:function(c){var d=b.Base.Utils.parseUrl(c),c=d.protocol+e+d.host;return{urlSuffix:d.path||"",url:c,sendType:a,dataType:a,headers:a,crossDomain:!0}},_generateGenericEventsOptions:function(a,b,c,d){return a=this._generateCommonGenericEventsOptions(a),a.dataType=d,a.sendType=b,a.headers={"Content-type":c},a}},b.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGNotificationEventType={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGToneType={RINGBACK:"ringback",INTERCEPT:"intercept",REORDER:"reorder",FASTBUSY:"fastBusy"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallActionType={ACCEPT_AUDIO:"ACCEPT_AUDIO",ACCEPT_VIDEO:"ACCEPT_VIDEO",ACTIVATE:"ACTIVATE",ADD_PARTICIPANT:"ADD_PARTICIPANT",ADD_VIDEO:"ADD_VIDEO",ANSWER:"ANSWER",DEACTIVATE:"DEACTIVATE",DENY_AUDIO:"DENY_AUDIO",DENY_VIDEO:"DENY_VIDEO",END:"END",HOLD:"HOLD",INCOMING_ADD_VIDEO:"INCOMING_ADD_VIDEO",JOIN:"JOIN",MUTE_VIDEO:"MUTE_VIDEO",UNMUTE_VIDEO:"UNMUTE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",REMOTE_VIDEO_REMOVED_ACK:"REMOTE_VIDEO_REMOVED_ACK",RINGING:"RINGING",TRANSFER:"TRANSFER",UNHOLD:"UNHOLD",UPDATE_VIDEO:"UPDATE_VIDEO"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.Constants={TELEPHONY_SERVICE:"telephony",CSA_APPLICATION:"CSA",CREATE_MEDIA_RESPONSE:"createMediaResponse",PROCESS_MEDIA_REQUEST:"processMediaRequest",PROCESS_MEDIA_RESPONSE:"processMediaResponse",ACCEPT_CALL_RESPONSE:"acceptCallResponse",REJECT_CALL_RESPONSE:"rejectCallResponse",UPDATE_CALL_PROPERTIES:"updatecallproperties",MUTE_VIDEO:"muteVideo",UNMUTE_VIDEO:"unmuteVideo",HTTP:"HTTP",HTTP_POST:"POST",HTTP_GET:"GET",HTTP_DELETE:"DELETE",HTTP_PUT:"PUT",HTTP_BAD_REQUEST:400,JSON_DATA_TYPE:"json",TEXT_DATA_TYPE:"text",CSA_RESOURCE_PATH:"/csa/resources/tenants/default",CSA_VERSION_1:"1",COMPUTER:"COMPUTER",CALLS:"CALLS",PRESENCE:"PRESENCE",WEBRTC:"WEBRTC",STANDARD:"STANDARD",SEND:"SEND",RECEIVE:"RECEIVE",SEND_ONLY:"SEND_ONLY",RECV_ONLY:"RECEIVE_ONLY",SEND_RECV:"SEND_RECEIVE",INACTIVE:"INACTIVE",ENABLE:"ENABLE",DISABLE:"DISABLE",SDP_TYPE_ANSWER:"answer",SDP_TYPE_OFFER:"offer",ACTIVATED:"activated",CALL_STATE_FAILURE_ERROR_CODE:4220072,CALL_DOES_NOT_EXISTS:4040009,SEE_OTHER_RESOURCE:303e4,
SVC_PRESENCE:"presence",MANUAL_STATE:"manualState",STATE:"state",MODE:"mode",NOTE:"note",SUBSCRIPTION_ADD:"add",SUBSCRIPTION_REMOVE:"remove",STATUS_ACTIVE:"active",AVAYA_COMMUNICATOR:"AVAYA_COMMUNICATOR",RESOURCE_DISCOVERY_USERNAME_MISMATCH:"Mismatch username",MWI_ON:"ON",MWI_OFF:"OFF",CLIENT_SESSION_EXPIRED:"CLIENT_SESSION_EXPIRED",DEACTIVATED_BY_CLIENT:"DEACTIVATED_BY_CLIENT",GUEST_SESSION_EXPIRED:"GUEST_SESSION_EXPIRED",PERMANENT_REGISTRATION_FAILURE:"PERMANENT_REGISTRATION_FAILURE",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",USER_DOES_NOT_MATCH:"USER_DOES_NOT_MATCH",TEMPORARY_REGISTRATION_FAILURE:"TEMPORARY_REGISTRATION_FAILURE",CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS:"application/vnd.avaya.mpaas.eventsubscription+json",CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS:"application/json"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ResourceType={Users:"users",Clients:"clients",Calls:"calls",Services:"services",KeepAlive:"keepalive",SessionManagement:"sessionManagement",Websocket:"websocket",SSE:"sse",iViewToken:"iviewtoken",RestSessionMgmt:"RestSessionMgmt",ClientKeepAlive:"ClientKeepAlive",ClientTerminate:"ClientTerminate",Configuration:"configuration",FastDelete:"fastDelete",UploadLogs:"upload-logs",PresenceSubscriptions:"presence-subscriptions",PresencePublications:"presence-publications",CreatePresenceContainer:"CreatePresenceContainer",PublishPresenceState:"PublishPresenceState",PublishPresenceMode:"PublishPresenceMode",PublishPresenceNote:"PublishPresenceNote",DeletePresenceState:"DeletePresenceState",DeletePresenceMode:"DeletePresenceMode",DeletePresenceNote:"DeletePresenceNote"}}(),function(b){"use strict";var c=b.Providers.CallServiceGateway.Constants;b.Providers.CallServiceGateway.Utils={convertToAudioChannel:function(a,d,e){var f=null;if(a&&((f={channelId:a.id}).state=a.enabled?c.ENABLE:c.DISABLE,f.direction=this.convertToChannelDirection(a.direction),d?f.logicalDirection=this.convertToChannelDirection(d.getLogicalDirection()):a.logicalDirection&&(f.logicalDirection=this.convertToChannelDirection(a.logicalDirection)),e))switch(e){case b.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case b.Services.Call.NoiseReductionSetting.ENABLED:f.serverNoiseReduction="ENABLE";break;case b.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case b.Services.Call.NoiseReductionSetting.DISABLE_ALL:f.serverNoiseReduction="DISABLE"}return f},convertToVideoChannels:function(a,d,e){var f=[];return a&&a.forEach(function(a){var g;a&&((g={channelId:a.id}).state=a.enabled?c.ENABLE:c.DISABLE,g.direction=this.convertToChannelDirection(a.direction),d?g.logicalDirection=this.convertToChannelDirection(d.getLogicalDirection()):a.logicalDirection&&(g.logicalDirection=this.convertToChannelDirection(a.logicalDirection)),b.Base.Utils.isDefined(e)&&(g.localVideoMute=e),f.push(g))}.bind(this)),f},convertToVideoChannelGuidelines:function(a){var b={};return a&&(a.getRequiredDirection()&&(b.requiredClientLegDirections=this.convertToChannelGuideLine(a.getRequiredDirection())),a.getPermittedDirection()&&(b.permittedLogicalDirections=this.convertToChannelGuideLine(a.getPermittedDirection()))),b},convertToChannelDirection:function(a){switch(a){case b.Services.Call.MediaDirection.SEND_ONLY:return c.SEND_ONLY;case b.Services.Call.MediaDirection.RECV_ONLY:return c.RECV_ONLY;case b.Services.Call.MediaDirection.SEND_RECV:return c.SEND_RECV;default:return c.INACTIVE}},convertToChannelGuideLine:function(a){switch(a){case b.Services.Call.MediaDirection.SEND_ONLY:return[c.SEND];case b.Services.Call.MediaDirection.RECV_ONLY:return[c.RECEIVE];case b.Services.Call.MediaDirection.SEND_RECV:return[c.SEND,c.RECEIVE];default:return[]}},convertToAudioStream:function(a,d){var e=null;return a&&((e=new b.Providers.Interfaces.AudioStream(a.channelId,this.convertToMediaDirection(a.direction))).enabled=a.state===c.ENABLE,d&&a.logicalDirection&&(e.logicalDirection=this.convertToMediaDirection(a.logicalDirection)),a.serverNoiseReduction&&(e.serverNoiseReduction=a.serverNoiseReduction)),e},convertToVideoStreams:function(a,d){var e=[];return a&&a.forEach(function(a){var f;a&&((f=new b.Providers.Interfaces.VideoStream(a.channelId,this.convertToMediaDirection(a.direction),a.maxHeight,a.maxWidth,a.maxFrames)).enabled=a.state===c.ENABLE,d&&a.logicalDirection&&(f.logicalDirection=this.convertToMediaDirection(a.logicalDirection)),e.push(f))}.bind(this)),e},convertToMediaDirection:function(a){switch(a){case c.SEND_ONLY:return b.Services.Call.MediaDirection.SEND_ONLY;case c.RECV_ONLY:return b.Services.Call.MediaDirection.RECV_ONLY;case c.SEND_RECV:return b.Services.Call.MediaDirection.SEND_RECV;default:return b.Services.Call.MediaDirection.INACTIVE}},convertAlertType:function(a){switch(a){case"ALERT_TYPE_UNSPECIFIED":return b.Services.Call.AlertType.UNSPECIFIED;case"ALERT_TYPE_NONE":return b.Services.Call.AlertType.NONE;case"ALERT_TYPE_INTERNAL":return b.Services.Call.AlertType.INTERNAL;case"ALERT_TYPE_EXTERNAL":return b.Services.Call.AlertType.EXTERNAL;case"ALERT_TYPE_PRIORITY":return b.Services.Call.AlertType.PRIORITY;case"ALERT_TYPE_INTERCOM":return b.Services.Call.AlertType.INTERCOM;case"ALERT_TYPE_AUTO_CALLBACK":return b.Services.Call.AlertType.AUTO_CALLBACK;case"ALERT_TYPE_HOLD_RECALL":return b.Services.Call.AlertType.HOLD_RECALL;case"ALERT_TYPE_DIRECT_AGENT_CALL_INTERNAL":return b.Services.Call.AlertType.DIRECT_AGENT_CALL_INTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_EXTERNAL":return b.Services.Call.AlertType.DIRECT_AGENT_CALL_EXTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_PRIORITY":return b.Services.Call.AlertType.DIRECT_AGENT_CALL_PRIORITY;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_INTERNAL":return b.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_INTERNAL;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL":return b.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL;default:return b.Base.Logger.info(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled alert type: "+a),b.Services.Call.AlertType.UNSPECIFIED}},convertErrorCode:function(a){switch(a){case 4010001:return b.Services.Call.CallError.NOT_AUTHORIZED;case 4010003:return b.Services.Call.CallError.UNAUTHORIZED;case 4040009:return b.Services.Call.CallError.NOT_FOUND;case 4040011:return b.Services.Call.CallError.SESSION_ID_NOT_FOUND;case 4040013:return b.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED;case 4220072:return b.Services.Call.CallError.CALL_STATE_MISMATCH;case 4220078:return b.Services.Call.CallError.MEDIA_PRESERVED;case 5000010:return b.Services.Call.CallError.USER_NOT_FOUND;case 5000022:return b.Services.Call.CallError.BUSY;case 5000036:return b.Services.Call.CallError.VIDEO_DENIED;default:return b.Services.Call.CallError.INTERNAL_ERROR}},convertPresenceStateToCSGPresenceState:function(c){switch(c){case b.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE:return b.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE;case b.Services.Presence.PresenceState.PRESENCE_STATE_AWAY:return b.Providers.CallServiceGateway.CSGPresenceState.AWAY;case b.Services.Presence.PresenceState.PRESENCE_STATE_BUSY:return b.Providers.CallServiceGateway.CSGPresenceState.BUSY;case b.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB:return b.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB;case b.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE:return b.Providers.CallServiceGateway.CSGPresenceState.OFFLINE;case b.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL:return b.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL;case b.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE:return b.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE;default:return a}},convertCSGPresenceStateToPresenceState:function(a){switch(a){case b.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE:return b.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE;case b.Providers.CallServiceGateway.CSGPresenceState.AWAY:return b.Services.Presence.PresenceState.PRESENCE_STATE_AWAY;case b.Providers.CallServiceGateway.CSGPresenceState.BUSY:return b.Services.Presence.PresenceState.PRESENCE_STATE_BUSY;case b.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB:return b.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB;case b.Providers.CallServiceGateway.CSGPresenceState.OFFLINE:return b.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE;case b.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL:return b.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL;case b.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE:return b.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE;default:return b.Services.Presence.PresenceState.PRESENCE_STATE_UNSPECIFIED}},convertPresenceModeToCSGPresenceMode:function(c){switch(c){case b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME:return b.Providers.CallServiceGateway.CSGPresenceMode.HOME;case b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE:return b.Providers.CallServiceGateway.CSGPresenceMode.MOBILE;case b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE:return b.Providers.CallServiceGateway.CSGPresenceMode.OFFICE;case b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING:return b.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING;default:return a}},convertCSGPresenceModeToPresenceMode:function(a){switch(a){case b.Providers.CallServiceGateway.CSGPresenceMode.HOME:return b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME;case b.Providers.CallServiceGateway.CSGPresenceMode.MOBILE:return b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE;case b.Providers.CallServiceGateway.CSGPresenceMode.OFFICE:return b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE;case b.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING:return b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING;default:return b.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_UNSPECIFIED}}}}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this._registerUser=a||!1,this._minBandwidth=b||null,this._videoChannelGuidelines=c}b.prototype={isRegisterUser:function(){return this._registerUser},getMinBandwidth:function(){return this._minBandwidth},getVideoChannelGuidelines:function(){return this._videoChannelGuidelines}},a.Providers.CallServiceGateway.ServiceActivationParameters=b}(AvayaClientServices),function(a){"use strict";a.Providers.CallServiceGateway.AbstractCallMessage=function(){this.type=a.Providers.CallServiceGateway.CallMessageTypes.UNDEFINED}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallMessageTypes={UNDEFINED:"Undefined",SUBSCRIPTION:"Subscription",USER_CLIENTS:"UserClients",PROCESS_MEDIA_REQUEST:"ProcessMediaRequest"}}(),function(b){"use strict";function c(){this.vmnumber=a}c.prototype={},b.Providers.CallServiceGateway.ConfigurationMessage=c}(AvayaClientServices),function(b){"use strict";function c(){this.expires=a,this.containerResources={container:{get:{method:a,href:a},updateOrExtend:{method:a,href:a},"delete":{method:a,href:a}}},this.additionalResources={presencePublication:{replace:{method:a,href:a}},presenceSubscriptions:[{update:{method:a,href:a},replace:{method:a,href:a}}]}}c.prototype={},b.Providers.CallServiceGateway.CSGPresenceContainer=c}(AvayaClientServices),function(b){"use strict";function c(){this.presenceDoc={userIdentity:{userId:a}},this.presenceSummary={stateEnum:a},this.manualState={stateEnum:a},this.mode={modeEnum:a},this.note={content:a},this.channelPresence=[]}c.prototype={},b.Providers.CallServiceGateway.CSGPresenceDocument=c}(AvayaClientServices),function(a){"use strict";a.Providers.CallServiceGateway.CSGPresenceState={AVAILABLE:"AVAILABLE",BUSY:"BUSY",DO_NOT_DISTURB:"DO_NOT_DISTURB",ON_A_CALL:"ON_A_CALL",AWAY:"AWAY",OUT_OF_OFFICE:"OUT_OF_OFFICE",OFFLINE:"OFFLINE"},a.Providers.CallServiceGateway.CSGPresenceMode={OFFICE:"OFFICE",HOME:"HOME",MOBILE:"MOBILE",TRAVELING:"TRAVELING"}}(AvayaClientServices),function(b){"use strict";function c(){this.applications=[],this.capabilities=[],this.commandURL=a,this.sessionManagement={href:a,timeout:a}}c.prototype={},b.Providers.CallServiceGateway.NotificationResources=c}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=a.Providers.CallServiceGateway.CallMessageTypes.PROCESS_MEDIA_REQUEST,this.callId=b,this.sdp=c}b.prototype=Object.create(a.Providers.CallServiceGateway.AbstractCallMessage.prototype),a.Providers.CallServiceGateway.ProcessMediaRequestMessage=b}(AvayaClientServices),function(b){"use strict";function c(c){b.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=b.Providers.CallServiceGateway.CallMessageTypes.CALLINFO,this.registrationId=c,this.href=a,this.mode="Computer"}c.prototype=Object.create(b.Providers.CallServiceGateway.AbstractCallMessage.prototype),b.Providers.CallServiceGateway.RegistrationInfoMessage=c}(AvayaClientServices),function(b){"use strict";function c(){this.resources={avayaRequestTimeout:{maximum:a,minimum:a,recommended:a},capabilities:[],clientId:a,notificationService:{websocket:{href:a},sse:{href:a}},resources:[],sessionManagement:{href:a,timeout:a,username:a},clientManagement:{timeout:a}}}c.prototype={},b.Providers.CallServiceGateway.RestResources=c}(AvayaClientServices),function(b){"use strict";function c(c){b.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=b.Providers.CallServiceGateway.CallMessageTypes.SUBSCRIPTION,this.isSubscribed=!1,this.subscriptionId=c,this.application=a,this.service=a,this.resource=a}c.prototype=Object.create(b.Providers.CallServiceGateway.AbstractCallMessage.prototype),b.Providers.CallServiceGateway.SubscriptionCallMessage=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.UserClient=function(b){this.clientId=b,this.version=a,this.endpointLabel=a,this.productName=a}}(),function(a){"use strict";function b(){a.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=a.Providers.CallServiceGateway.CallMessageTypes.USER_CLIENTS,this._clients=[]}(b.prototype=Object.create(a.Providers.CallServiceGateway.AbstractCallMessage.prototype)).add=function(a){this._clients.push(a)},b.prototype.getClients=function(){return this._clients},a.Providers.CallServiceGateway.UserClientsMessage=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ObservableEvents={ANSWER_CALL_REQUEST:"csgwprovider.answerCallRequest",CREATE_MEDIA_REQUEST:"csgwprovider.createMediaRequest",CALL_ENDED:"csgwprovider.call.ended",CALL_ESTABLISHED:"csgwprovider.call.established",CALL_FAILURE:"csgwprovider.call.failure",CALL_HELD:"csgwprovider.call.held",CALL_INCOMING:"csgwprovider.call.incoming",CALL_RINGING:"csgwprovider.call.ringing",CALL_STATE_FAILURE:"csgwprovider.call.stateFailure",CALL_UNHELD:"csgwprovider.call.unheld",CALLS_SERVICE_ACTIVATED:"csgwprovider.callsActivated",CALLS_SERVICE_DEACTIVATED:"csgwprovider.callsDeactivated",ICE_CONFIG_UPDATES:"csgwprovider.ice.config.updates",IVIEW_TOKEN_UPDATE:"csgwprovider.iviewTokenUpdate",MAKE_CALL_REQUEST:"csgwprovider.makeCallRequeset",MAX_NETWORK_RECONNECTION_ATTEMPTED:"csgwprovider.maxReconnectionAttempted",NETWORK_PROVIDER_IS_AVAILABLE:"csgwprovider.network.available",NETWORK_PROVIDER_IS_UNAVAILABLE:"csgwprovider.network.unavailable",PROCESS_ANSWER_REQUEST:"csgwprovider.processAnswerRequest",RINGBACK_TONE_URLS_CHANGED:"csgwprovider.ringbackToneUrlsChanged",SUPPORTED_CALL_ENHANCEMENTS:"csgwprovider.supportedCallEnhancements",TERMINATE_CALL_REQUEST:"csgwprovider.terminateCallRequest",UPDATE_TRANSFER_STATUS:"csgwprovider.update.transferStatus",UPDATE_CALL_DATA:"csgwprovider.update.callData",UPDATE_CALL_REQUEST:"csgwprovider.update.callRequest",UPDATE_CONSULT_CONFERENCE_STATUS:"csgwprovider.update.consultConferenceStatus",UPLOAD_LOGS_UPDATE:"csgwprovider.uploadlogs",VIDEO_LICENSE_UPDATED:"csgwprovider.videoLicenceUpdated"}}(),function(a){"use strict";function b(){}b.prototype={parse:function(b){var c=new a.Providers.Interfaces.Call;return c.callId=b.callId,c.capabilities=b.capabilities,c.clientCpuUsageMgmt=b.clientCpuUsageMgmt,c}},a.Providers.CallServiceGateway.CallInfoParser=b}(AvayaClientServices),function(a){"use strict";function b(a){this._callInfoParser=a}b.prototype={parse:function(a){for(var b=[],c=0;c<a.calls.length;c++)b.push(this._callInfoParser.parse(a.calls[c]));return b}},a.Providers.CallServiceGateway.ClientCallsParser=b}(AvayaClientServices),function(a){"use strict";function c(){}c.prototype={parse:function(c){return b.extend(new a.Providers.CallServiceGateway.ConfigurationMessage,c)}},a.Providers.CallServiceGateway.ConfigurationParser=c}(AvayaClientServices),function(b){"use strict";function c(a){this._provider=a}c.prototype={parse:function(c){var d=b.Base.Utils.isDefined(c.messageData)?JSON.parse(c.messageData):a;switch(c.messageType){case b.Providers.CallServiceGateway.NotificationType.CallFailure:var e=b.Base.Utils.queryJSONObject(d,"error[0].errorCode"),f=b.Providers.CallServiceGateway.Utils.convertErrorCode(e),g=b.Base.Utils.queryJSONObject(d,"error[0].displayMsg");e===b.Providers.CallServiceGateway.Constants.CALL_STATE_FAILURE_ERROR_CODE?this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,[c.callId,f,b.Services.Call.CallProtocolType.APPLICATION,e,g]):this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[c.callId,f,b.Services.Call.CallProtocolType.APPLICATION,e,g]);break;case b.Providers.CallServiceGateway.NotificationType.IncomingCall:j=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.UCID"),k=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.parentUCID"),l=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.contextId"),this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,[c.callId,d.actionDetails.participants[0].remoteAddress,d.actionDetails.participants[0].remoteDisplayName,d.actionDetails.avayaAsserted,d.actionDetails["private"],b.Providers.CallServiceGateway.Utils.convertAlertType(d.actionDetails.alertType),d.actionDetails.sdpType,d.actionDetails.sdp,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),d.actionDetails.subject,d.actionDetails.videoBandwidth,j,k,l,this.processTurnData(d.actionDetails.turnData)]);break;case b.Providers.CallServiceGateway.NotificationType.CallRinging:e=!1,g=b.Base.Utils.queryJSONObject(c,"alertingTypeEarlyMedia"),b.Base.Utils.isDefined(g)&&("boolean"==typeof g?e=g:"string"==typeof g&&(e="true"===g.toLowerCase())),this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,[c.callId,d.actionDetails.participants[0].remoteAddress,d.actionDetails.participants[0].remoteDisplayName,d.actionDetails.avayaAsserted,d.actionDetails["private"],b.Providers.CallServiceGateway.Utils.convertAlertType(d.actionDetails.alertType),e,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection())]);break;case b.Providers.CallServiceGateway.NotificationType.CallEstablished:var h=b.Base.Utils.queryJSONObject(d,"actionDetails.conferenceData.conference");h&&(p=d.actionDetails.conferenceData.uccpUrl);var i=b.Base.Utils.queryJSONObject(d,"actionDetails.conferenceData.webCollaborationUrl"),j=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.UCID"),k=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.parentUCID"),l=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.contextId"),h=[c.callId,d.actionDetails.participants[0].remoteAddress,d.actionDetails.participants[0].remoteDisplayName,d.actionDetails.subject,d.actionDetails.remote,d.actionDetails["private"],d.actionDetails.alertType,d.actionDetails.avayaAsserted,d.actionDetails.clientCpuUsageMgmt,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),h,p,i,d.actionDetails.videoBandwidth,j,k,l];this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,h);break;case b.Providers.CallServiceGateway.NotificationType.CallHeld:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_HELD,[c.callId]);break;case b.Providers.CallServiceGateway.NotificationType.CallUnheld:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_UNHELD,[c.callId]);break;case b.Providers.CallServiceGateway.NotificationType.CallEnded:var m=!1;if(c.endCallReason)try{var n=JSON.parse(c.endCallReason);n&&(n=new b.Providers.Call.CallReason(n.reasonProtocol,n.reasonCode,n.reasonText),this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[c.callId,n]),m=!0)}catch(d){b.Base.Logger.error(b.Base.LoggerTags.CALL_PROVIDER,"Failed to parse end call reason: "+c.endCallReason)}m||this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[c.callId]);break;case b.Providers.CallServiceGateway.NotificationType.CreateMediaRequest:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,[c.callId,d.action,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),d.actionDetails.videoBandwidth,this.processTurnData(d.actionDetails.turnData),d.actionDetails.usesIPv6Cand]);break;case b.Providers.CallServiceGateway.NotificationType.ProcessMediaRequest:this.processMediaRequestHandler(c.callId,d.action,d.actionDetails.sdpType,d.actionDetails.sdp,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),d.actionDetails.videoBandwidth,this.processTurnData(d.actionDetails.turnData),d.actionDetails.forceIceRestart,d.actionDetails.usesIPv6Cand);break;case b.Providers.CallServiceGateway.NotificationType.ProcessMediaResponse:this.processMediaResponseHandler(c.callId,d.action,d.actionDetails.sdpType,d.actionDetails.sdp,b.Providers.CallServiceGateway.Utils.convertToAudioStream(d.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()),b.Providers.CallServiceGateway.Utils.convertToVideoStreams(d.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()));break;case b.Providers.CallServiceGateway.NotificationType.UpdateTransferStatus:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,[c.callId,c.transferStatus]);break;case b.Providers.CallServiceGateway.NotificationType.UpdateCallData:var o,p=d.actionDetails.participants[0],i=b.Base.Utils.queryJSONObject(d,"actionDetails.conferenceData.conference"),h=!1;b.Base.Utils.isDefined(i)&&("boolean"==typeof i?h=i:"string"==typeof i&&(h="true"===i.toLowerCase()),o=d.actionDetails.conferenceData.uccpUrl,q=d.actionDetails.conferenceData.webCollaborationUrl),j=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.UCID"),k=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.parentUCID"),l=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.contextId"),this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,[c.callId,p.remoteAddress,p.remoteDisplayName,h,o,q,j,k,l]);break;case b.Providers.CallServiceGateway.NotificationType.MWIStatusChanged:var q=c.status;q===b.Providers.CallServiceGateway.Constants.MWI_OFF||q===b.Providers.CallServiceGateway.Constants.MWI_ON?this._provider.setVoicemailMWI(q):b.Base.Logger.warn(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received MWIStatusChanged notification in invalid format");break;case b.Providers.CallServiceGateway.NotificationType.EndpointConfigurationUpdate:this._provider.setVoicemailNumber(c.voiceMailNumber),this._provider.trigger(b.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,[c.voiceMailNumber]),c.IPVideoEnable&&this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,["true"===c.IPVideoEnable]);break;case b.Providers.CallServiceGateway.NotificationType.AddParticipantStatus:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,[c.callId,c.status]);break;case b.Providers.CallServiceGateway.NotificationType.AnswerCallRequest:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,[c.callId,c.requestId]);break;case b.Providers.CallServiceGateway.NotificationType.TerminateCallRequest:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,[c.callId,c.requestId]);break;case b.Providers.CallServiceGateway.NotificationType.UpdateCallRequest:this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,[c.callId,c.requestId,c.callactiontype]);break;case b.Providers.CallServiceGateway.NotificationType.MakeCallRequest:j=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.UCID"),k=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.parentUCID"),l=b.Base.Utils.queryJSONObject(d,"actionDetails.userToUserData.contextId"),this._provider.trigger(b.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,[c.callId,c.dialToAddress,c.requestId,j,k,l]);break;case b.Providers.CallServiceGateway.NotificationType.ServiceStatusChanged:this._provider.activateService(c.service,c.status,c.deactivationReason);break;case b.Providers.CallServiceGateway.NotificationType.NetworkEvents:this._provider.networkEventNotification(d);break;default:b.Base.Logger.info(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Ignoring telephony notification: [Id:"+c.callId+",Type:"+c.messageType+"]")}},processMediaRequestHandler:function(a,c,d,e,f,g,h,i,j,k){b.Base.Logger.debug(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Request: ["+c+","+d+"]"),d&&d.toLowerCase()===b.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(a,c,e,f,g,h):e?this._provider.getCallProvider().offerSDP(a,c,e,f,g,h,i):(e=!1,b.Base.Utils.isDefined(j)&&(e=j),this._provider.getCallProvider().getOfferSDP(a,c,f,g,h,i,e,k))},processMediaResponseHandler:function(a,c,d,e,f,g){b.Base.Logger.debug(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Response: "+d),b.Base.Utils.isDefined(e)&&null!==e?d&&d.toLowerCase()===b.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(a,c,e,f,g):b.Base.Logger.info(b.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled SDP from process media response for ["+c+","+d+"]"):this._provider.getCallProvider().answerSdpAck(a,c,f,g)},processTurnData:function(c){if(c){var d=c.turnAddressDetails.turnAddress,e=c.sessionId,f=c.accessToken,g="relay";b.Base.Utils.isDefined(c.forceTurn)&&!1===c.forceTurn&&(g="all");for(var h=[],i=0;i<c.turnAddressDetails.turnTypesPriorities.length;i++){var j=c.turnAddressDetails.turnTypesPriorities[i],k=j.turnAddress||d,l="turn",m=j.port,n=j.transportType;"tls"===j.transportType&&(l="turns",n="tcp"),m=new b.Providers.Call.TurnTransportType(k,l,n,m),this._provider.getCallProvider()._isTurnTlsHasHighestPriority()&&m._setTlsToHighestPriority(!0),h.push(m)}return new b.Providers.Call.TurnData(e,f,d,h,g,c.expiryTime)}return a}},b.Providers.CallServiceGateway.NotificationParser=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.NotificationType={CreateMediaRequest:"createMediaRequest",ProcessMediaRequest:"processMediaRequest",ProcessMediaResponse:"processMediaResponse",IncomingCall:"callIncoming",CallRinging:"callRinging",CallEstablished:"callEstablished",CallEnded:"callEnded",CallFailure:"callFailure",CallHeld:"onCallRemoteHeld",CallUnheld:"onCallRemoteUnheld",UpdateTransferStatus:"updateTransferStatus",UpdateCallData:"updateCallData",MWIStatusChanged:"MWIStatusChanged",EndpointConfigurationUpdate:"EndpointConfigurationUpdate",AddParticipantStatus:"addParticipantStatus",AnswerCallRequest:"answerCallRequest",AnswerCallResponse:"answerCallResponse",TerminateCallRequest:"terminateCallRequest",UpdateCallRequest:"updateCallRequest",MakeCallRequest:"makeCallRequest",ServiceStatusChanged:"serviceStatusChanged",NetworkEvents:"mpaasevents"}}(),function(a){"use strict";function b(){}b.prototype={parse:function(b){for(var c=new a.Providers.CallServiceGateway.UserClientsMessage,d=0;d<b.clients.length;d++){var e=this.parseClient(b.clients[d]);c.add(e)}return c},parseClient:function(b){var c=new a.Providers.CallServiceGateway.UserClient(b.clientId);return c.version=b.version,c.endpointLabel=b.endpointLabel,c.productName=b.productName,c}},a.Providers.CallServiceGateway.UserClientsParser=b}(AvayaClientServices),function(c){"use strict";c.Providers.ContentSharing.BandwidthManager=function(b){this._serverManager=b,this._queue=[],this._intervals=[],this._encodingTimes=[],this._run=!1,this._outstandingDataSize=0,this._isAcksActivated=!0,this._minimalInterval=100,this._lastIntervalsToConsiderCount=10,this._maxBytesPerSecond=37500,this._bytesSentLastSecond=0,this._queueSize=0,this._sendTimeout=a},c.Providers.ContentSharing.BandwidthManager.prototype={start:function(a){this._interval=a.captureInterval,this._maxBytesPerSecond=a.maxBytesPerSecond;for(var b=0;b<this._lastIntervalsToConsiderCount;b++)this._intervals.push(a.captureInterval);this._serverManager.onBandwidthAvailable=function(){this._process()}.bind(this),this._serverManager.start(a)},stop:function(){var a=b.Deferred();return this._queue=[],this._queueSize=0,this._outstandingDataSize=0,this._serverManager.stop(),clearTimeout(this._sendTimeout),a.resolve(),a.promise()},pause:function(){this._serverManager.stop()},resume:function(){var a={maxBytesPerSecond:this._maxBytesPerSecond};this._serverManager.start(a)},addToQueue:function(a){var b;a._keyFrame&&(this._lostSize=0,this._queue.forEach(function(a){this._lostSize+=a.byteLength}.bind(this)),b=(this._bytesSentLastSecond+this._lostSize)/this._maxBytesPerSecond,this._intervals.push(Math.floor(this._interval*b)),this._determineInterval(),this._queue=[]),this._queue.push(a),this._run||(this._run=!0,this._process())},onIntervalChanged:function(a){},setMaxUploadSpeed:function(a){this._maxBytesPerSecond=a/8*1e3},isFrameNeeded:function(a){if(this._queueSize=this._queue.reduce(function(a,b){return a+b.byteLength},0),this._isAcksActivated){var b=Math.min(this._serverManager.getActualBandwidth(),this._maxBytesPerSecond);this._maxCapacity=.333*b,this._outstandingDataSize=this._serverManager.getOutstandingDataSize();var c=b*a/1e3,b=b*this._getAverageEncodingTime()/1e3,b=this._maxCapacity+c+b>=this._queueSize+this._outstandingDataSize;return this._serverManager.setIsFrameNeeded(b),b}return(c=this._maxBytesPerSecond*a/1e3)>=this._queueSize;
},_determineInterval:function(){for(var a=0,b=this._intervals.length-this._lastIntervalsToConsiderCount;b<this._intervals.length;b++)a+=this._intervals[b];var c=a/this._lastIntervalsToConsiderCount;c<this._minimalInterval&&(c=this._minimalInterval),this._interval=Math.floor(c),this.onIntervalChanged(this._interval)},_process:function(){this._queueSize=this._queue.reduce(function(a,b){return a+b.byteLength},0),c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Current screen sharing queue size: "+this._queueSize+" bytes.  Length: "+this._queue.length);var a=this._queue.shift();a?this._serverManager.canSend(a.byteLength)?(c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Sending "+a.byteLength+" bytes from screen sharing queue."),this._send(a),this._process()):this._queue.unshift(a):this._run=!1},_send:function(a){this._serverManager.send(a),this._bytesSentLastSecond+=a.getByteLength(),this._sendTimeout=setTimeout(function(){this._bytesSentLastSecond-=a.getByteLength()}.bind(this),1e3)},addToEncodingTimes:function(a){100<this._encodingTimes.length&&this._encodingTimes.slice(this._encodingTimes.length-100),this._encodingTimes.push(a)},setAcksActivated:function(a){this._isAcksActivated=a,this._serverManager.setAcksActivated(this._isAcksActivated)},_getAverageEncodingTime:function(){return 0===this._encodingTimes.length?0:this._encodingTimes.reduce(function(a,b){return a+b/this._encodingTimes.length}.bind(this),0)}}}(AvayaClientServices),function(a){"use strict";function b(){this._jpegImageQuality=.35,this._messageId=1,this._maxMessageId=Math.pow(2,31)}b.prototype={createStartTag:function(b,c,d,e){var f=new a.Providers.WCS.ScreenSharingStartTag;return e&&(f.messageId=this._getMessageId()),f.isKeyFrame=b,f.width=c,f.height=d,f.creationTime=Date.now(),f},createBlockTag:function(b,c){var d=new a.Providers.WCS.ScreenSharingBlockTag;return c&&(d.messageId=this._getMessageId()),d.x=b._x,d.y=b._y,d.width=b._width,d.height=b._height,c=this._jpegImageQuality,b._type?(b._type===a.Providers.WCS.ScreenSharingImageTypes.JPEG_RED_WITH_BLACK&&(b._type=a.Providers.WCS.ScreenSharingImageTypes.JPEG,c=Math.max(.8,c)),d.imageType=b._type):d.imageType=a.Providers.WCS.ScreenSharingImageTypes.JPEG,c=this._getImageData(b,b._type,c),d.length=c.length,d.data=c,d},createEndTag:function(b){var c=new a.Providers.WCS.ScreenSharingEndTag;return b&&(c.messageId=this._getMessageId()),c},_getImageData:function(b,c,d){var e=document.createElement("canvas");return e.width=b._width,e.height=b._height,e.getContext("2d").putImageData(b._imgData,0,0),c=c===a.Providers.WCS.ScreenSharingImageTypes.JPEG?"jpeg":"png",d=e.toDataURL("image/"+c,d),this._getImageBuffer(d)},_getImageBuffer:function(a){for(var a=a.split(","),b=atob(a[1]),c=b.length,d=new Uint8Array(c);c--;)d[c]=b.charCodeAt(c);return d},setJpegImageQuality:function(a){a&&(this._jpegImageQuality=a)},_getMessageId:function(){var a=this._messageId;return this._setMessageId(),a},_setMessageId:function(){return this._messageId<this._maxMessageId-1?this._messageId++:this._messageId=1}},a.Providers.ContentSharing.ContentSharingTagBuilder=b}(AvayaClientServices),function(c,d){"use strict";var e="SCREEN_SHARING",f="PONG",g="START",h="Chrome",i="Firefox",j="message",k="CANCELED";c.Providers.ContentSharing.ExtensionNetworkProvider=function(d){this._pingTimer=a,this._pingTime=0,this._pongTime=0,this._pingInterval=500,this._requestBuilder=d,this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.INVALID,this._onMediaAvailableCallbacks=b.Callbacks(),this._onCapabilityChangeCallbacks=b.Callbacks(),this._onMediaCancelledCallbacks=b.Callbacks(),this._listenerFunction=a,this._isExtensionAvailable=!1},c.Providers.ContentSharing.ExtensionNetworkProvider.prototype={setExtensionAvailable:function(a){this._isExtensionAvailable=a,this._onCapabilityChangeCallbacks.fire(c.Providers.ContentSharing.InstalledExtensionType.CHROME,this._isExtensionAvailable)},start:function(){this._startWindowEventListener(),c.Base.Utils.getBrowserSubType()===c.Base.BrowserSubType.ELECTRON?this.setExtensionAvailable(!0):(this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.INVALID,this._startPingTask())},send:function(a){d.postMessage(a,"*")},stop:function(){this._stopPingTimer(),this._removeWindowEventListener()},addOnMediaAvailableCallback:function(a){this._onMediaAvailableCallbacks.add(a)},removeOnMediaAvailableCallback:function(a){this._onMediaAvailableCallbacks.remove(a)},addOnMediaCancelledCallback:function(a){this._onMediaCancelledCallbacks.add(a)},removeOnMediaCancelledCallback:function(a){this._onMediaCancelledCallbacks.remove(a)},addOnCapabilityChange:function(a){this._onCapabilityChangeCallbacks.add(a)},removeOnCapabilityChange:function(a){this._onCapabilityChangeCallbacks.remove(a)},getInstalledExtensionType:function(){return this._installedExtensionType},_stopPingTimer:function(){this._pingTimer&&d.clearTimeout(this._pingTimer)},_startWindowEventListener:function(){this._listenerFunction=function(a){var b;a.source===d&&a.data.type&&(a.data.type===g?this._onMediaAvailableCallbacks.fire(a):a.data.type===k?this._onMediaCancelledCallbacks.fire(a):a.data.type===f&&a.data.app===e&&(this._pongTime=Date.now(),b=this._installedExtensionType,a.data.extension===h?this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.CHROME:a.data.extension===i&&(this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.FIREFOX),b!==c.Providers.ContentSharing.InstalledExtensionType.CHROME&&b!==c.Providers.ContentSharing.InstalledExtensionType.FIREFOX&&(this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!0),this._pingInterval=2e3)))}.bind(this),d.addEventListener(j,this._listenerFunction,!1),this._pingTime=Date.now(),this.send(this._requestBuilder.createPingRequest()),c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Started receiving pings from extension")},_removeWindowEventListener:function(){d.removeEventListener(j,this._listenerFunction,!1),c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Stopped receiving pings from extension")},_startPingTask:function(){this._pingTimer&&d.clearTimeout(this._pingTimer),this._pingTimer=d.setTimeout(function(){var a;0===this._pongTime&&this._installedExtensionType===c.Providers.ContentSharing.InstalledExtensionType.INVALID?(this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!1),this._pingInterval=2e3<=this._pingInterval?2e3:Math.max(2e3,2*this._pingInterval)):this._pingTime-this._pongTime>this._pingInterval&&(this._installedExtensionType===c.Providers.ContentSharing.InstalledExtensionType.CHROME||this._installedExtensionType===c.Providers.ContentSharing.InstalledExtensionType.FIREFOX)&&(a=this._installedExtensionType,this._installedExtensionType=c.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(a,!1)),this._pingTime=Date.now(),!0===this._isExtensionAvailable?this._pongTime=Date.now():this.send(this._requestBuilder.createPingRequest()),this._startPingTask()}.bind(this),this._pingInterval)}}}(AvayaClientServices,window),function(a){"use strict";function b(){}var c="SCREEN_SHARING_PAGE",d="STOP",e="START",f="PING";b.prototype={createStartSharingRequest:function(a){return{type:c,text:e,capture:a}},createStopSharingRequest:function(a){return{type:c,text:d,mediaSourceId:a}},createPingRequest:function(){return{type:c,text:f}}},a.Providers.ContentSharing.ExtensionRequestBuilder=b}(AvayaClientServices),function(a){"use strict";a.Providers.ContentSharing.FeatureSupported={isSharingApplicationWindowAvailable:function(){var b=a.Base.Utils.getBrowserType();return b===a.Base.BrowserType.CHROME||b===a.Base.BrowserType.FIREFOX},isSharingFullScreenAvailable:function(){var b=a.Base.Utils.getBrowserType();return b===a.Base.BrowserType.CHROME||b===a.Base.BrowserType.FIREFOX},isSharingAnyTypeAvailable:function(){var b=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,c=a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI;return!0===b&&0==c},isSharingContentVideoAvailable:function(){var b=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,c=a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI;return b&&0==c}}}(AvayaClientServices),function(a){"use strict";function b(a){this._blocks=[],this.byteLength=0,this._keyFrame=a,this._processingTime=0}b.prototype={addBlock:function(a){this._blocks.push(a),this.byteLength+=a.byteLength},getBlocks:function(){return this._blocks},getByteLength:function(){return this.byteLength}},a.Providers.ContentSharing.FrameBlocks=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.InstalledExtensionType={CHROME:"Chrome",FIREFOX:"Firefox",NOT_INSTALLED:"Not Installed",INVALID:"Invalid"}}(),function(b){"use strict";function c(c){this._isStarted=!1,this._setInterval=a,this._framesCount=0,this._frametimeAcum=0,this._overloadsCount=0,this._frametimeThreshold=b.Base.Utils.isDefined(c)?c.frametimeThreshold:2e3,this._overloadsThreshold=b.Base.Utils.isDefined(c)?c.overloadsThreshold:2,this._interval=b.Base.Utils.isDefined(c)?c.evaluateInterval:15e3,this._startDelay=7e3,this.onPerformanceMonitorAlert=function(){}}c.prototype.start=function(){this._isStarted?b.Base.Logger.warn(b.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager already started"):(b.Base.Logger.info(b.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager starting in - "+this._startDelay/1e3+"s"),setTimeout(function(){this._isStarted=!0,this._setInterval=setInterval(function(){0<this._framesCount&&this._evaluate()}.bind(this),this._interval)}.bind(this),this._startDelay))},c.prototype.stop=function(){this._isStarted?(this._isStarted=!1,this._clearMeasures(),clearInterval(this._setInterval),b.Base.Logger.info(b.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager stopped")):b.Base.Logger.warn(b.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager is already stop")},c.prototype.registerMeasure=function(a){this._isStarted&&(b.Base.Utils.isDefined(a)?(this._framesCount++,this._frametimeAcum+=a):b.Base.Logger.warn(b.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Invalid frametime measaure"))},c.prototype._evaluate=function(){var a=Math.round(this._frametimeAcum/this._framesCount);a>this._frametimeThreshold?(this._overloadsCount++,this._overloadsCount===this._overloadsThreshold&&(a="Average frametime ("+a+"ms) higher than maximum expected ("+this._frametimeThreshold+"ms), overloads acummulated: "+this._overloadsCount,this.onPerformanceMonitorAlert(b.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,a),this._overloadsCount=0)):this._overloadsCount=0,this._clearMeasures()},c.prototype._clearMeasures=function(){this._framesCount=0,this._frametimeAcum=0},b.Providers.ContentSharing.PerformanceManager=c}(AvayaClientServices),function(a){"use strict";var b={0:"Disabled",1:new a.Config.PerformanceManagerConfiguration(2500,2,15e3),2:new a.Config.PerformanceManagerConfiguration(2250,2,15e3),3:new a.Config.PerformanceManagerConfiguration(2e3,2,15e3),4:new a.Config.PerformanceManagerConfiguration(1750,2,15e3),5:new a.Config.PerformanceManagerConfiguration(1500,2,15e3)};a.Providers.ContentSharing.PerformanceManagerProfiles=b}(AvayaClientServices),function(b){"use strict";b.Providers.ContentSharing.ScreenBlock=function(c,d,e,f,g,h,i,j){this._x=c,this._y=d,this._row=e,this._column=f,this._height=h,this._width=g,this._imgData=i,this._previousBase64=a,this._blocks=j||[],this._type=b.Providers.WCS.ScreenSharingImageTypes.JPEG}}(AvayaClientServices),function(c){"use strict";function d(b){c.Base.Observable.call(this),this._config=a,this._video=a,this._videoTrack=a,this._screenScraper=b,this._capturingTimeout=a,this._delayInterval=a,this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._workerHealthCheckInterval=3e4,this._captureInterval=a,this._captureIntervalMinimum=250,this._lastWorkerHealthCheckTime=0,this._lastWorkerMessageLength=0,this._isFrameNeededCounter=0,this._isFrameNeededCounterMaxValue=33,this._isVideoResolutionSmallerCounter=0,this._isVideoResolutionSmallerMaxValue=99,this._processTimes=[],this._scale=1,this._oldScale=a,this._performanceManager=a,this.onPerformanceMonitorAlert=function(){},this.isFrameNeeded=function(a){}}d.prototype=Object.create(c.Base.Observable.prototype),(c.Providers.ContentSharing.ScreenCapturer=d).prototype.start=function(d,e,f){var g=b.Deferred();return this._manuallyStopped=!1,this._config=e,this._captureInterval=this._config.captureInterval,this._delayInterval=a,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._startPerformanceManager(),this._worker=new Worker(this._config.contentSharingWorkerPath),this._worker.postMessage({type:c.Providers.ContentSharing.ScreenCapturerWorkerEvents.INITIALIZE,browser:f,config:e}),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),this._worker.onerror=function(a){d.getVideoTracks()[0].stop(),g.reject(a)},this._worker.onmessage=function(a){this._handleWorkerMessage(a,g,d)}.bind(this),g.promise()},d.prototype._handleWorkerMessage=function(a,b,d){switch(a.data.type){case c.Providers.ContentSharing.ScreenCapturerWorkerEvents.CHANGED_BLOCKS:this._handleChangedBlocksMessage(a.data);break;case c.Providers.ContentSharing.ScreenCapturerWorkerEvents.WORKER_STARTED:this._handleWorkerStartedMessage(a.data,b,d);break;default:c.Base.Logger.warn(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Unknown message data type received: {0}",a.data.type)}},d.prototype._calculateScale=function(a,b,c,d){var e=1,f=1;return c<a&&(e=c/a),d<b&&(f=d/b),Math.min(e,f)},d.prototype._handleChangedBlocksMessage=function(a){this._changedBlocksMessageReceived=!0,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._lastWorkerMessageLength=a.data.length,0<a.data.length&&(this._processTimes.unshift(a.meta.processingTime),this._registerFrametime(a.meta.processingTime),this.trigger(c.Providers.ContentSharing.ScreenCapturerEvents.BLOCKS_CHANGED,[a.data,a.meta.keyFrame,this._getAverageProcessingTime()])),this._capturingTimeout=setTimeout(function(){this._capture()}.bind(this),this._config.captureInterval)},d.prototype._handleWorkerStartedMessage=function(a,b,d){this._workerStartedMessageReceived=!0,this._videoTrack=d.getVideoTracks()[0];var e=this._videoTrack.getSettings();c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"displaySurface: "+e.displaySurface),this._videoTrack.onended=function(){this._manuallyStopped?c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was ended successfully"):(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.trigger(c.Providers.ContentSharing.ScreenCapturerEvents.WINDOW_CLOSED,[]))}.bind(this),this._video=window.document.createElement("video"),this._video.setAttribute("hidden","true"),this._video.srcObject=d,this._video.play().then(function(){c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was successfully executed")})["catch"](function(){c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was interrupted before completion")}),this._capture(),b.resolve()},d.prototype._getAverageProcessingTime=function(){return 100<this._processTimes.length&&this._processTimes.slice(this._processTimes.length-100),this._processTimes.reduce(function(a,b){return a+b/this._processTimes.length}.bind(this),0)},d.prototype.stop=function(){var c=b.Deferred();return this._removeListeners(),this._videoTrack&&(this._manuallyStopped=!0,this._videoTrack.stop(),this._videoTrack=a),this._video&&(this._video.srcObject=null,this._video=a),this._processTimes=[],this._worker&&this._worker.terminate(),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._delayInterval=a,this._stopPerformanceManager(),c.resolve(),c.promise()},d.prototype.pause=function(){var c=b.Deferred(),d=!0;return this._video&&!this._video.paused&&(d=!1,this._video.pause()),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._delayInterval=a,c.resolve(d),c.promise()},d.prototype.getWidth=function(){return this._scale*this._video.videoWidth},d.prototype.getHeight=function(){return this._scale*this._video.videoHeight},d.prototype.resume=function(){var a=b.Deferred(),c=!1;return this._video&&this._video.paused&&(c=!0,this._video.play(),this._capture(!0)),a.resolve(c),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),a.promise()},d.prototype._capture=function(b){var d=this._getAverageProcessingTime();this._captureInterval=this._captureInterval-d>this._captureIntervalMinimum?this._captureInterval-d:d>this._captureIntervalMinimum?d:this._captureIntervalMinimum;var e,f;this._videoTrack&&"ended"!==this._videoTrack.readyState&&!this._video.paused?this.isFrameNeeded(this._getAverageProcessingTime())?8<=this._video.videoWidth&&8<=this._video.videoHeight?(e=window.document.createElement("canvas"),this._scale=this._calculateScale(this._video.videoHeight,this._video.videoWidth,this._config.maxHeight,this._config.maxWidth),d=+(this._scale*this._video.videoWidth).toFixed(0),f=+(this._scale*this._video.videoHeight).toFixed(0),e.width=d,e.height=f,e=e.getContext("2d"),1!==this._scale&&(e.scale(this._scale,this._scale),this._scale!==this._oldScale&&(this._oldScale=this._scale,c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Resolution of shared content is too high. Scaling down from  "+this._video.videoWidth+"x"+this._video.videoHeight+" to "+d+"x"+f))),e.drawImage(this._video,0,0),e=e.getImageData(0,0,d,f).data,this._worker.postMessage({type:c.Providers.ContentSharing.ScreenCapturerWorkerEvents.SEND_IMAGE_DATA,imgData:e,config:this._config,width:d,height:f,forceKeyFrame:b},[e.buffer]),this._lastCapturedImageTime=(new Date).getTime(),this._lastCapturedImageResolution={width:d,height:f}):(this._isVideoResolutionSmallerCounter++,this._isVideoResolutionSmallerCounter===this._isVideoResolutionSmallerMaxValue&&(c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Capture skipped due to low video resolution: "+{width:this._video.videoWidth,height:this._video.videoHeight}),this._isVideoResolutionSmallerCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=a,this._capture(!0)}.bind(this),this._captureInterval)):(this._isFrameNeededCounter++,this._isFrameNeededCounter===this._isFrameNeededCounterMaxValue&&(c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"isFrameNeeded delaying the _capture method"),this._isFrameNeededCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=a,this._capture()}.bind(this),this._captureInterval)):(f=this._videoTrack?{enabled:this._videoTrack.enabled,kind:this._videoTrack.kind,muted:this._videoTrack.muted,readyState:this._videoTrack.readyState}:a,c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"videoTrack: "+JSON.stringify(f)))},d.prototype._registerFrametime=function(a){c.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.registerMeasure(a)},d.prototype._stopPerformanceManager=function(){c.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.stop()},d.prototype.setServerCapabilities=function(a){this._config=b.extend({},this._config,a)},d.prototype.setPerformanceManagerProfile=function(a){this._performanceManagerProfile=a},d.prototype._startPerformanceManager=function(){"Disabled"!==this._performanceManagerProfile&&(this._performanceManager=new c.Providers.ContentSharing.PerformanceManager(this._performanceManagerProfile),this._performanceManager.onPerformanceMonitorAlert=function(a,b){this.onPerformanceMonitorAlert(a,b)}.bind(this),this._performanceManager.start())},d.prototype._checkWorkerHealth=function(){var a=(new Date).getTime();a-this._lastWorkerHealthCheckTime>this._workerHealthCheckInterval&&c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Worker not generating new blocks, block message length: "+this._lastWorkerMessageLength+", worker message received: "+this._workerStartedMessageReceived+", changed blocks message received: "+this._changedBlocksMessageReceived+", resolution: "+JSON.stringify(this._lastCapturedImageResolution)+", last captured time: "+(a-this._lastCapturedImageTime)+"ms ago, last changed block time: "+(a-this._lastWorkerHealthCheckTime)+"ms ago.")}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerConfig=function(){this.captureInterval=333,this.losslessColorLimit=32,this.blockSize=64,this.framesPerKeyFrame=75,this.maxBytesPerSecond=37500,this.maxWidth=1920,this.maxHeight=1080}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerEvents={BLOCKS_CHANGED:"blocks_changed",KEY_FRAME:"key_frame",WINDOW_CLOSED:"window_changed"}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerWorkerEvents={INITIALIZE:"initialize",CHANGED_BLOCKS:"changedBlocksMessage",SEND_IMAGE_DATA:"wholeImgData",WORKER_STARTED:"workerStarted"}}(),function(b){"use strict";b.Providers.ContentSharing.ScreenScraper=function(){this._previousBlocks=[],this._blockWidth=64,this._blockHeight=64,this._previousBase64=a,this._captureKeyFrame=!1},b.Providers.ContentSharing.ScreenScraper.prototype={getChangedBlocks:function(a,b,c){return a.videoWidth?(this._blockWidth=b,this._blockHeight=b,b=window.document.createElement("canvas"),b.width=a.videoWidth,b.height=a.videoHeight,b=b.getContext("2d"),b.drawImage(a,0,0),b=this._determineChangedBlocks(a,b),0<b.length&&(b=this._mergeBlocks(b),b=this._determineTypes(b,c)),b):[]},_determineTypes:function(a,c){return a.forEach(function(a){var d=this._getColorsCount(a._imgData);a._type=c<d?b.Providers.WCS.ScreenSharingImageTypes.JPEG:b.Providers.WCS.ScreenSharingImageTypes.PNG}.bind(this)),a},_mergeBlocks:function(a){return a=this._sortByColumn(a),a=this._mergeByColumn(a),a=this._sortByRow(a),(a=this._mergeByRow(a)).map(this._createMergedBlock)},_createMergedBlock:function(a){var c=document.createElement("canvas");c.width=a._width,c.height=a._height;var d=c.getContext("2d");return a._blocks.forEach(function(b){d.putImageData(b._imgData,b._x-a._x,b._y-a._y)}),c=d.getImageData(0,0,a._width,a._height),new b.Providers.ContentSharing.ScreenBlock(a._x,a._y,a._row,a._column,a._width,a._height,c)},_determineChangedBlocks:function(c,d){var e=[],f=[],g=Math.ceil(c.videoHeight/this._blockHeight);if(!this._imageChanged(c,d))return e;for(var h=0;h<c.videoWidth;h+=this._blockWidth)for(var i=h/this._blockWidth,j=h+this._blockWidth>c.videoWidth?c.videoWidth-h:this._blockWidth,k=0;k<c.videoHeight;k+=this._blockHeight){var l=k+this._blockHeight>c.videoHeight?c.videoHeight-k:this._blockHeight,m=d.getImageData(h,k,j,l),l=new b.Providers.ContentSharing.ScreenBlock(h,k,k/this._blockHeight,i,j,l,m);l._previousBase64=this._getBase64Image(l._imgData),0<this._previousBlocks.length&&!this._captureKeyFrame?(m=l._column*g+l._row,(m=this._previousBlocks[m])&&m._previousBase64===l._previousBase64||(m._previousBase64=a,f.push(l))):f.push(l),e.push(l)}return this._captureKeyFrame&&(this._captureKeyFrame=!1),this._previousBlocks=e,f},_imageChanged:function(a,b){var c=!0,a=b.getImageData(0,0,a.videoWidth,a.videoHeight),a=this._getBase64Image(a);return a!==this._previousBase64||this._captureKeyFrame?this._previousBase64=a:c=!1,c},_getColorsCount:function(a){for(var b={},c=new Uint32Array(a.data.buffer),d=0,e=c.length,f=0;f<e;f++){var g=""+(16777215&c[f]);b[g]||(b[g]=0,d++),b[g]++}return d},_getBase64Image:function(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")},_mergeByColumn:function(a){return this._merge(a,this._compareBlocksByColumn,function(a,b){a._height+=b._height})},_mergeByRow:function(a){return this._merge(a,this._compareBlocksByRow,function(a,b){a._width+=b._width})},_merge:function(a,b,c){for(var d=[],e=this._copyBlock(a[0]),f=1;f<a.length;f++)b(e,a[f])?(0<a[f]._blocks.length?this._copyBlocks(a,f,e):e._blocks.push(a[f]),c(e,a[f])):(d.push(e),e=this._copyBlock(a[f]));return d.push(e),d},_copyBlocks:function(a,b,c){a[b]._blocks.forEach(function(a){c._blocks.push(a)})},_copyBlock:function(a){var c;return 0===a._blocks.length?(c=new b.Providers.ContentSharing.ScreenBlock(a._x,a._y,a._row,a._column,a._width,a._height))._blocks.push(a):c=a,c},_sortByColumn:function(a){return a.sort(function(a,b){return a._column===b._column?a._row-b._row:a._column-b._column})},_sortByRow:function(a){return a.sort(function(a,b){return a._row===b._row?a._column-b._column:a._row-b._row})},_compareBlocksByColumn:function(a,b){return a._x===b._x&&a._width===b._width&&(a._y+a._height===b._y||b._y+b._height===a._y)},_compareBlocksByRow:function(a,b){return a._y===b._y&&a._height===b._height&&(a._x+a._width===b._x||b._x+b._width===a._x)}}}(AvayaClientServices),function(a){"use strict";function b(b,c){this._collaborationProvider=b,this._extensionNetworkProvider=new a.Providers.ContentSharing.ExtensionNetworkProvider(new a.Providers.ContentSharing.ExtensionRequestBuilder);var d=new a.Providers.ContentSharing.ScreenScraper;this._screenCapturer=new a.Providers.ContentSharing.ScreenCapturer(d),this._extensionRequestBuilder=new a.Providers.ContentSharing.ExtensionRequestBuilder,this._contentSharingTagBuilder=new a.Providers.ContentSharing.ContentSharingTagBuilder,b=new a.Providers.ContentSharing.ServerManager(b.sendBlocks.bind(b),b.getBufferedAmount.bind(b)),this._bandwidthManager=new a.Providers.ContentSharing.BandwidthManager(b),this._screenSharingTagEncoder=new a.Providers.WCS.ScreenSharingTagEncoder,c.registerServer(b),c.registerScreenCapturer(this._screenCapturer)}b.prototype={getScreenSharingProvider:function(b){var c=a.Base.Utils.getBrowserType();return c===a.Base.BrowserType.CHROME?new a.Providers.ContentSharing.ChromeScreenSharingProvider(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,b,this._extensionNetworkProvider,this._extensionRequestBuilder):new(c===a.Base.BrowserType.FIREFOX?a.Providers.ContentSharing.FirefoxScreenSharingProvider:c===a.Base.BrowserType.EDGE?a.Providers.ContentSharing.EdgeScreenSharingProvider:a.Providers.ContentSharing.AbstractScreenSharingProvider)(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,b)}},a.Providers.ContentSharing.ScreenSharingProviderFactory=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this._sentData=0,this._isFrameNeeded=!0,this._videoResolutionChangeThreshold=9,this._outstandingDataSize=0,this._videoStepDownBandwidthThreshold=.75,this._videoStepUpBandwidthThreshold=.95,this._idlePackageSizeThreshold=2e3,this._videoResolutionChangeMonitoringInterval=1e4,this._dataEntryMonitoringInterval=1e3,this._observationStartedTime=0,this._sentDataSum=0,this._cumulativeDataTransferred=0,this._lastCumulativeDataTransferred=0,this._isAcksActivated=!0,this._maxBytesPerSecond=5e4,this._sendingFunction=a,this._blocksSentHistory=[],this._dataEntryForVideoResolutionChange=[],this._monitoringFunction=b,this._checkBandwidthforVideoResolutionDelay=5e3,this.onPerformanceMonitorAlert=function(){},this._history=[{buffered:0,bufferedSum:0,sent:0,sentSum:0}],this._actualBandwidth=this._maxBytesPerSecond,this._observationInterval=5,this._onStop=function(){},this._onStart=function(){}}b.prototype={start:function(a){this._onStart(),this._blocksSentHistory.length=0,this.resetOutstandingDataSize(),this._maxBytesPerSecond=a.maxBytesPerSecond,this._observationStartedTime=(new Date).getTime();var b={};this._interval=setInterval(function(){var a,c,d,e,f,g=this._history[this._history.length-1],g={buffered:this._monitoringFunction()-g.bufferedSum,bufferedSum:this._monitoringFunction(),sent:this._sentDataSum-g.sentSum,sentSum:this._sentDataSum};this._history.push(g),0!==this._blocksSentHistory.length&&(d=!(c=g=a=0),f=e=0,this._blocksSentHistory.forEach(function(c){a+=c.size,b[c.started]=b[c.started]||{},b[c.started].remainingDataSize=c.remainingDataSize,b[c.started].finished=c.finished}.bind(this)),this._blocksSentHistory.length=0,Object.keys(b).forEach(function(a){var g=parseInt(a)>this._observationStartedTime?parseInt(a):this._observationStartedTime;!0===d?(e=g,f=b[a].finished,d=!1):(f<g&&(c+=f-g),f=b[a].finished),0===b[a].remainingDataSize&&delete b[a]}.bind(this)),g=f-e+c,0!==a&&(this._actualBandwidth=1e3*a/g)),this._observationStartedTime=(new Date).getTime()}.bind(this),1e3*this._observationInterval),this.checkBandwidthForVideoResolution()},getHistory:function(){return this._history},stop:function(){this._onStop(),this.resetOutstandingDataSize(),this._blocksSentHistory.length=0,this._dataEntryForVideoResolutionChange.length=0,clearInterval(this._interval),clearInterval(this._dataEntryInterval),clearInterval(this._videoResolutionChangeInterval)},send:function(b){this._sentDataSum+=b.getByteLength(),this._sentData+=b.getByteLength();var c,d,e=b.getByteLength()/this._maxBytesPerSecond*1e3;this._isAcksActivated?(c=b.getByteLength(),this._outstandingDataSize+=b.getByteLength(),d=(new Date).getTime(),b.getBlocks().forEach(function(b){var e=new a.Providers.WCS.ByteArray(b).readInt();this._sendingFunction(b,e).always(function(){this._cumulativeDataTransferred+=b.byteLength;var a={};a.started=d,a.finished=(new Date).getTime(),c-=b.byteLength,a.size=b.byteLength,a.remainingDataSize=c,this._blocksSentHistory.push(a),this._outstandingDataSize-=b.byteLength}.bind(this))}.bind(this))):b.getBlocks().forEach(function(a){this._sendingFunction(a)}.bind(this));var f=this._monitoringFunction();a.Base.Logger.debug(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Sent frame WebSocket bufferedAmount: "+f);var g=function(){var b=this._monitoringFunction();b<this._maxBytesPerSecond?(a.Base.Logger.debug(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Outgoing queue cleared, reporting bandwidth available.  WebSocket bufferedAmount: "+b),this.onBandwidthAvailable()):setTimeout(g,500)}.bind(this);setTimeout(function(){this._sentData-=b.getByteLength(),g()}.bind(this),e)},canSend:function(a){return 0===this._sentData||a+this._sentData<=this._maxBytesPerSecond},measureDataSentPerSecond:function(){if(0===this._lastCumulativeDataTransferred)return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,this._lastCumulativeDataTransferred;var a=this._cumulativeDataTransferred-this._lastCumulativeDataTransferred;return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,a},checkBandwidthForVideoResolution:function(){setTimeout(function(){this._isAcksActivated&&(this._dataEntryInterval=setInterval(this.addDataEntryEverySecond.bind(this),this._dataEntryMonitoringInterval),this._videoResolutionChangeInterval=setInterval(this.monitorBandwidthForVideoResolutionChange.bind(this),this._videoResolutionChangeMonitoringInterval))}.bind(this),this._checkBandwidthforVideoResolutionDelay)},addDataEntryEverySecond:function(){this._dataEntryForVideoResolutionChange.push({
data:this.measureDataSentPerSecond(),bandwidth:this.getActualBandwidth(),isNeeded:this._isFrameNeeded})},monitorBandwidthForVideoResolutionChange:function(){var b,c=0,d=0;this._dataEntryForVideoResolutionChange.forEach(function(a){this._videoStepUpBandwidthThreshold*this._maxBytesPerSecond>=a.bandwidth&&(0===a.data&&!1===a.isNeeded||a.data>this._idlePackageSizeThreshold)&&(this._videoStepDownBandwidthThreshold*this._maxBytesPerSecond>=a.bandwidth?d++:c++)}.bind(this)),d>=this._videoResolutionChangeThreshold&&(b="Send screen sharing bandwidth is limited to "+(8*this.getActualBandwidth()/1e3).toFixed(2)+"kbps",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD,b)),c>=this._videoResolutionChangeThreshold&&(b="Prevent video resolution increase...",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING,b)),this._dataEntryForVideoResolutionChange.length=0},getOutstandingDataSize:function(){return this._outstandingDataSize<0&&this.resetOutstandingDataSize(),this._outstandingDataSize},getActualBandwidth:function(){return(!isFinite(this._actualBandwidth)||this._actualBandwidth<0)&&(this._actualBandwidth=this._maxBytesPerSecond),this._actualBandwidth},resetOutstandingDataSize:function(){this._outstandingDataSize=0},onBandwidthAvailable:function(){},setIsFrameNeeded:function(a){this._isFrameNeeded=a},setAcksActivated:function(a){this._isAcksActivated=a}},a.Providers.ContentSharing.ServerManager=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.Observable.call(this),this._networkProvider=b}(b.prototype=Object.create(a.Base.Observable.prototype)).init=function(a){this._networkProvider.init(a)},b.prototype.login=function(a){return this._networkProvider.send({loginId:a.username,password:a.password},{sendType:"GET"}).then(function(a){return this.trigger("focus.login.success",[a]),a}.bind(this),function(a){this.trigger("focus.login.error",[a])}.bind(this))},a.Providers.Focus.FocusProvider=b}(AvayaClientServices),function(a){"use strict";function b(){a.Base.Observable.call(this)}(b.prototype=Object.create(a.Base.Observable.prototype)).start=function(){},b.prototype.stop=function(){},a.Providers.Interfaces.AbstractProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.AbstractStream=function(b,c,d){this.type=b,this.id=c,this.enabled=!0,this.direction=d,this.logicalDirection=a}}(),function(b){"use strict";function c(c,d){this.serverNoiseReduction=a,b.Providers.Interfaces.AbstractStream.call(this,"audio",c,d)}c.prototype=Object.create(b.Providers.Interfaces.AbstractStream.prototype),b.Providers.Interfaces.AudioStream=c}(AvayaClientServices),function(b){"use strict";function c(){this.callId=a}c.prototype={},b.Providers.Interfaces.Call=c}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).accept=function(a,b,c,d){},b.prototype.setVideoMode=function(a,b,c){},b.prototype.ignore=function(){},b.prototype.deny=function(){},b.prototype.hold=function(a){},b.prototype.unhold=function(a){},b.prototype.sendDigits=function(){},b.prototype.getRemoteAddress=function(){},b.prototype.getAccessCode=function(){},b.prototype.getSessionDetails=function(){},b.prototype.isConference=function(){},b.prototype.isIncoming=function(){},b.prototype.canAutoAnswer=function(){},b.prototype.isRemote=function(){},b.prototype.isServiceAvailable=function(){},b.prototype.isCallerIdentityPrivate=function(){},b.prototype.getAlertType=function(){},b.prototype.getSubject=function(){},b.prototype.getState=function(){},b.prototype.join=function(){},b.prototype.addCall=function(a){},b.prototype.addParticipant=function(a){},b.prototype.muteAudio=function(a){},b.prototype.unmuteAudio=function(a){},b.prototype.muteVideo=function(a){},b.prototype.unmuteVideo=function(a){},b.prototype.muteSpeaker=function(a){},b.prototype.unmuteSpeaker=function(a){},b.prototype.updateDevices=function(a,b,c){},b.prototype.startContentVideoSharing=function(a,b){},b.prototype.stopContentVideoSharing=function(a){},b.prototype.setPreferredResolution=function(a,b,c){},b.prototype.setPreferredReceiveResolution=function(a,b,c){},a.Providers.Interfaces.CallProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallProviderCallbackIds={ALLOWED_NAILEDUP_VIDEO_MODES:"allowedNailedUpVideoModes",ANSWER_CALL_REQUESTED:"answerCallRequested",AUDIO_STREAM_UPDATED:"audioStreamUpdated",CALL_STARTED:"callStarted",CALL_RINGING:"callRinging",CALL_ESTABLISHED:"callEstablished",CALL_ESTABLISHING:"callEstablishing",CALL_ENDED:"callEnded",CALL_FAILURE:"callFailure",CALL_SERVICE_AVAILABLE:"callServiceAvailable",CALL_SERVICE_ACTIVATED:"callServiceActivated",CALL_SERVICE_DEACTIVATED:"callServiceDeactivated",CALL_SERVICE_UNAVAILABLE:"callServiceUnavailable",CALL_SERVICE_UNSUPPORTED:"callServiceUnsupported",CALL_MEDIA_FAILED:"callMediaFailed",CONFERENCE_ESCALATION:"conferenceEscalation",ICE_CONNECTION_UPDATE:"iceConnectionUpdate",INCOMING_CALL:"incomingCall",INCOMING_ADD_VIDEO_REQUEST:"incomingAddVideoRequest",INCOMING_ADD_VIDEO_ACCEPTED:"incomingAddVideoAccepted",INCOMING_ADD_VIDEO_DENIED:"incomingAddVideoDenied",INCOMING_ADD_VIDEO_TIMEDOUT:"incomingAddVideoTimedout",INCOMING_HOLD:"incomingHold",INCOMING_UNHOLD:"incomingUnhold",INITIATING_MEDIA_RECOVERY:"initiatingMediaRecovery",MAKE_CALL_REQUESTED:"makeCallRequested",MAX_NETWORK_RECOVERY_ATTEMPTED:"maxNetworkRecoveryAttempted",MEDIA_CHANNEL_GUIDELINES_AVAILABLE:"mediaChannelGuidelinesAvailable",MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE:"mediaChannelGuidelinesUnavailable",REMOTE_ADDRESS_CHANGED:"remoteAddressChanged",REMOTE_CALL_CREATED:"remoteCallCreated",TERMINATE_CALL_REQUESTED:"terminateCallRequested",UPDATE_CALL_REQUESTED:"updateCallRequested",UPLOAD_LOGS_UPDATE:"uploadLogUpdate",VIDEO_CHANNEL_UPDATE:"videoChannelUpdate",VIDEO_ESCALATION_REJECTED:"videoEscalationRejected",VIDEO_LICENSE_UPDATED:"VIDEO_LICENSE_UPDATED",RINGBACK_TONE_URLS_CHANGED:"RINGBACK_TONE_URLS_CHANGED",PERFORMANCE_MANAGER_PROFILE_CHANGED:"PERFORMANCE_MANAGER_PROFILE_CHANGED",PERFORMANCE_MONITOR_ALERT:"PERFORMANCE_MONITOR_ALERT"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallServiceCallbackIds={INCOMING_CALL:"incomingCall",MAKE_CALL_REQUESTED:"makeCallRequested",PERFORMANCE_MANAGER_PROFILE_CHANGED:"performanceManagerProfileChanged",PERFORMANCE_MONITOR_ALERT:"performanceMonitorAlert",PERFORMANCE_MONITOR_START:"performanceMonitorStart",CAMERA_DEALLOCATED:"CameraDeallocated"}}(),function(a){"use strict";function b(b,c,d,e,f){a.Providers.Interfaces.AbstractStream.call(this,"video",b,c),this.maxHeight=d,this.maxWidth=e,this.maxFrames=f}b.prototype=Object.create(a.Providers.Interfaces.AbstractStream.prototype),a.Providers.Interfaces.VideoStream=b}(AvayaClientServices),function(a){"use strict";function b(){a.Base.Observable.call(this)}(b.prototype=Object.create(a.Base.Observable.prototype)).start=function(){},b.prototype.stop=function(){},b.prototype.startWhiteboard=function(a){},b.prototype.endWhiteboard=function(a){},b.prototype.addWhiteboardSurface=function(){},b.prototype.removeWhiteboardSurface=function(a){},b.prototype.observeCollaboration=function(){},b.prototype.addCircle=function(){},b.prototype.addShape=function(){},b.prototype.startDrawShape=function(){},b.prototype.discoverResources=function(a){},b.prototype.liveDrawShape=function(){},b.prototype.endDrawShape=function(){},b.prototype.addText=function(){},b.prototype.getReceivingBitrate=function(){},b.prototype.startScreenSharing=function(){},b.prototype.stopScreenSharing=function(){},b.prototype.pauseScreenSharing=function(){},b.prototype.sendBlocks=function(a){},b.prototype.sendLiveEvent=function(a){},b.prototype.removeShape=function(a,b){},b.prototype.clearContent=function(a){},b.prototype.getParticipants=function(){},b.prototype.pause=function(){},b.prototype.resume=function(){},b.prototype.isOpened=function(){},b.prototype.isFeatureAvailable=function(a){},b.prototype.getServerCapabilities=function(){},b.prototype.getAcksActivated=function(){},a.Providers.Interfaces.CollaborationProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CollaborationProviderCallbackIds={SERVER_CAPABILITIES:"server_capabilities"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.ConferenceCallbackIds={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).sendHandshake=function(a){},b.prototype.subscribeMeetingInfo=function(a){},b.prototype.subscribeRoster=function(a){},b.prototype.subscribeActiveTalker=function(a){},b.prototype.subscribePermissions=function(a){},b.prototype.subscribeSlider=function(a){},b.prototype.subscribeMeetingNote=function(a){},b.prototype.subscribeWebCollab=function(a){},b.prototype.subscribeAvailableLayouts=function(a){},b.prototype.getCurrentVideoLayout=function(a){},b.prototype.setAsLecturer=function(a,b){},b.prototype.disconnectParticipant=function(a,b){},b.prototype.terminateConference=function(a){},b.prototype.requestToBecomeModerator=function(a,b){},b.prototype.signIn=function(a,b){},b.prototype.videoPin=function(a,b,c,d,e,f){},b.prototype.extendMeeting=function(a,b){},b.prototype.addParticipant=function(a,b){},b.prototype.cancelDialoutParticipant=function(a,b){},b.prototype.unsetAsLecturer=function(a){},b.prototype.controlRemoteCamera=function(a,b,c){},b.prototype.muteUnmute=function(a,b,c,d){},b.prototype.sendChatMessage=function(a,b,c){},b.prototype.muteUnmuteAll=function(a,b){},b.prototype.raiseLowerHand=function(a,b){},b.prototype.moderatorLowerHand=function(a,b,c){},b.prototype.sendModeratorAdmissionRequest=function(a){},b.prototype.sendAdmissionRequest=function(a,b){},b.prototype.changeParticipantName=function(a,b,c){},a.Providers.Interfaces.ConferenceDataProvider=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(a){},b.prototype.observeConference=function(a){},b.prototype.disconnectParticipant=function(a){},b.prototype.setAsLecturer=function(a){},b.prototype.setLocked=function(a){},b.prototype.setVideoLayoutTextOverlay=function(a){},b.prototype.setVideoLayoutSelfSee=function(a){},b.prototype.setVideoLayout=function(a){},b.prototype.terminateConference=function(){},b.prototype.removeLastParticipant=function(){},b.prototype.requestToBecomeModerator=function(a){},b.prototype.signIn=function(a){},b.prototype.videoPin=function(a,b,c,d,e){},b.prototype.extendMeeting=function(a){},b.prototype.addParticipant=function(a){},b.prototype.addParticipantFromCall=function(a){},b.prototype.cancelDialoutParticipant=function(a){},b.prototype.startRecording=function(a,b,c){},b.prototype.stopRecording=function(a){},b.prototype.pauseRecording=function(a){},b.prototype.resumeRecording=function(a){},b.prototype.unsetAsLecturer=function(){},b.prototype.controlRemoteCamera=function(a,b){},b.prototype.muteUnmute=function(a,b,c){},b.prototype.sendChatMessage=function(a,b){},b.prototype.muteUnmuteAll=function(a){},b.prototype.raiseLowerHand=function(a){},b.prototype.moderatorLowerHand=function(a,b){},b.prototype.getDialInInfo=function(){},b.prototype.changeParticipantName=function(a,b){},a.Providers.Interfaces.ConferenceProvider=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(a,b){},b.prototype.stop=function(){},b.prototype.getProviderType=function(){},b.prototype.createContactForAdd=function(){},b.prototype.addContact=function(a){},b.prototype.updateContact=function(a){},b.prototype.deleteContact=function(a){},b.prototype.retrieveAllContacts=function(){},b.prototype.getContactsChanges=function(){},b.prototype.getAddContactCapability=function(){},b.prototype.getUpdateContactCapability=function(){},b.prototype.getDeleteContactCapability=function(){},b.prototype.getExtendedContactDetailsCapability=function(){},a.Providers.Interfaces.ContactsProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.ContactsProviderCallbackIds={CONTACT_ADDED:"contact_added",CONTACT_UPDATED:"contact_updated",CONTACT_DELETED:"contact_deleted",CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(a){},b.prototype.stop=function(){},b.prototype.getProviderType=function(){},b.prototype.startDirectorySearch=function(a){},b.prototype.startResolvingContacts=function(a,b){},b.prototype.stopDirectorySearch=function(a){},b.prototype.getNetworkSearchContactCapability=function(){},b.prototype.getNetworkResolveContactsCapability=function(){},b.prototype.getNetworkSearchTerminalCapability=function(){},b.prototype.getSelfContact=function(){},a.Providers.Interfaces.DirectorySearchProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.DirectorySearchProviderCallbackIds={CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(a){},b.prototype.logout=function(){},b.prototype.getRoutableDomains=function(){},b.prototype.getConversations=function(a){},b.prototype.getConversationIds=function(a){},b.prototype.getConversationsByQuery=function(a){},b.prototype.discoverResources=function(){},b.prototype.getResources=function(){},b.prototype.validateUsers=function(a){},b.prototype.getParticipants=function(a,b){},b.prototype.sendMessage=function(a,b){},b.prototype.sendMessageWithAttachments=function(a,b,c){},b.prototype.leaveConversation=function(a){},b.prototype.markAllAsRead=function(a){},b.prototype.changeSubject=function(a){},b.prototype.markAsReadBatch=function(a){},b.prototype.getMessages=function(a,b,c,d,e){},b.prototype.reportTyping=function(){},b.prototype.observeConversations=function(){},b.prototype.callEscalationEvent=function(a,b){},b.prototype.setLastAccessTime=function(a,b){},b.prototype.addParticipantsToConversation=function(a,b){},b.prototype.close=function(a){},b.prototype.isStarted=function(){},b.prototype.getMaxImageSize=function(){},b.prototype.getMaxVideoSize=function(){},b.prototype.getMaxAudioSize=function(){},b.prototype.getMaxTextLength=function(){},b.prototype.getMaxGenericAttachmentSize=function(){},a.Providers.Interfaces.MessagingProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.MessagingProviderHandlers={CONVERSATIONS_UPDATE:"conversations.update"}}(),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(a){},b.prototype.stop=function(){},b.prototype.subscribeForPresence=function(a){},b.prototype.unsubscribeFromPresence=function(a){},b.prototype.unsubscribeFromAllAddressesPresence=function(){},b.prototype.publishManualState=function(a){},b.prototype.publishLocationMode=function(a){},b.prototype.publishNote=function(a){},b.prototype.publishAutomaticPresence=function(a){},a.Providers.Interfaces.PresenceProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.PresenceProviderCallbackIds={PRESENCE_NOTIFICATION:"PRESENCE_NOTIFICATION",PRESENCE_HANDLE_RECEIVED:"PRESENCE_HANDLE_RECEIVED"}}(),function(a){"use strict";function b(){a.Providers.Interfaces.AbstractProvider.call(this)}(b.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).getVoicemailNumber=function(){},b.prototype.getVoicemailMWI=function(){},b.prototype.isServiceAvailable=function(){},a.Providers.Interfaces.VoiceMessagingProvider=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.VoiceMessagingProviderCallbackIds={VOICEMAIL_NUMBER_CHANGED:"VOICEMAIL_NUMBER_CHANGED",MWI_STATUS_CHANGED:"MWI_STATUS_CHANGED"}}(),function(a){"use strict";function c(a,b,c,d,e){this._href=a,this._bucketName=b,this._sessionId=c,this._clientId=d,this._displayName=e}var d="text/plain",e="POST";c.prototype={buildMultipartOptions:function(){var b=a.Base.Utils.parseUrl(this._href),c=b.protocol+"://"+b.host;return{urlSuffix:b.path||"",url:c,contentType:!1,processData:!1,sendType:e,method:e,crossDomain:!0}},buildMultipartData:function(a){var b=new FormData;return b.append("metadata",this._buildMetadata()),a=this._buildLogfile(a),b.append("logfile",a,this._logFilename(".log")),b},buildMultipartDataAsZip:function(a){var c=b.Deferred(),d=new FormData;return d.append("metadata",this._buildMetadata()),this._buildLogfileAsZip(a).then(function(a){d.append("logfile",a,this._logFilename(".zip")),c.resolve(d)}.bind(this),function(a){c.reject(a)}),c.promise()},_buildMetadata:function(){var a={bucketName:this._bucketName,contentType:d,sessionID:this._sessionId};return this._displayName&&(a.displayName=this._displayName),this._clientId&&(a.clientID=this._clientId),JSON.stringify(a)},_buildLogfile:function(a){return new Blob([a],{type:"text/plain; charset=UTF-8"})},_buildLogfileAsZip:function(a){var c=b.Deferred(),d=new JSZip;return d.file("jscsdk_upload.log",a),d.generateAsync({type:"blob",compression:"DEFLATE"}).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise()},_logFilename:function(a){var b=this._sessionId+"_"+this._clientId;return this._displayName&&(b+="_"+this._trimDisplayName()),b+=a},_trimDisplayName:function(){return this._displayName.replace(/\s/g,"")}},a.Providers.Mpaas.GoogleCloudMessageBuilder=c}(AvayaClientServices),function(c){"use strict";function d(){this.MAX_RETRIES=3,this.RETRY_WAIT_TIME=1e3,this._serverInfo=a,this._href=a,this._messageBuilder=a,this._credentialProvider=a,this._isStarted=!1,this._startPromise=a,this._uploadTimer=a,this._hasPendingUpload=!1,this._restProvider=new c.Base.NetworkProvider(new c.Base.RESTProvider)}(d.prototype={}).start=function(a,d,e,f,g,h){if(this._isStarted){if(this._href===d)return b.Deferred().resolve().promise();var i=b.Deferred();return this._stop().always(function(){this._startProvider().then(function(){i.resolve()},function(a){i.reject(a)})}.bind(this)),i.promise()}return this._serverInfo=a,this._href=d,this._credentialProvider=h,this._messageBuilder=new c.Providers.Mpaas.GoogleCloudMessageBuilder(d,e,f,g),this._startProvider()},d.prototype.stop=function(){return this._stopProvider()},d.prototype._startProvider=function(){return c.Base.Utils.isUndefined(this._serverInfo)?b.Deferred().reject("Uninitialized remote server").promise():(this._isStarted||(this._isStarted=!0,this._startPromise=b.Deferred(),this._restProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._restProvider.onConnectionUnavailable=function(a){c.Base.Logger.error("Error communicating with upload log server:",a),this._stopProvider()}.bind(this),this._restProvider.onOpen=function(){this._startPromise.resolve()}.bind(this),this._restProvider.onError=function(a){c.Base.Logger.error("Error encountered with upload log server:",a),this._stopProvider()}.bind(this),this._restProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(a){c.Base.Logger.error("Unauthorized connection to upload log server:",a),this._stopProvider(),this._startPromise.reject(c.Base.NetworkProviderEvents.UNAUTHORIZED)}.bind(this)),this._restProvider.disableNetworkLogging(),this._restProvider.start(new c.Config.NetworkProviderConfiguration(this._serverInfo),this._credentialProvider)),this._startPromise.promise())},d.prototype._onCredentialsRequired=function(a,b){b&&b!==this._credentialProvider&&c.Base.Utils.deepMerge(this._credentialProvider,b),this._credentialProvider.onAuthenticationChallenge(void 0,function(b){this._onCredentialsRetrieved(b,a)}.bind(this))},d.prototype._onCredentialsRetrieved=function(a,b){c.Base.Utils.isDefined(b.options)&&(b.options.authentication=b.options.authentication||{},a.token?(a.bearer=a.bearer||c.Config.Authentication.TokenType.BEARER,this._credentialProvider.token!==a.token&&(this._credentialProvider.token=a.token),b.options.authentication.type=c.Config.Authentication.Scheme.BEARER,b.options.authentication.token=a.token,b.options.authentication.bearer=a.bearer):(b.options.authentication.type=c.Config.Authentication.Scheme.BASIC,b.options.authentication.username=a.username,b.options.authentication.password=a.password))},d.prototype._stopProvider=function(){return this._uploadTimer&&(clearTimeout(this._uploadTimer),this._uploadTimer=a),this._isStarted?this._restProvider.close().always(function(){this._isStarted=!1}.bind(this)):b.Deferred().reject("LoggerProvider: Provider is not started").promise()},d.prototype.upload=function(a){return this._hasPendingUpload?b.Deferred().reject("There is pending upload").promise():a?this._upload(a,this._sendLogs.bind(this)):b.Deferred().reject("Invalid logs").promise()},d.prototype.uploadZip=function(a){return this._hasPendingUpload?b.Deferred().reject("There is pending upload").promise():a?this._isZipLibraryInstalled()?this._upload(a,this._sendLogsAsZip.bind(this)):(c.Base.Logger.warn("Missing required JSZip library. Will upload as uncompressed file"),this._upload(a,this._sendLogs.bind(this))):b.Deferred().reject("Invalid logs").promise()},d.prototype._isZipLibraryInstalled=function(){return"undefined"!=typeof JSZip},d.prototype._upload=function(a,c){var d=b.Deferred();this._hasPendingUpload=!0;var e=function(b){var f;b++>=this.MAX_RETRIES?(this._hasPendingUpload=!1,d.reject("Max attempts reached")):(f=this.RETRY_WAIT_TIME*Math.pow(2,b),this._isStarted?c(a).then(function(){this._hasPendingUpload=!1,d.resolve()}.bind(this),function(a){this._uploadTimer=setTimeout(function(){e(b)},f)}.bind(this)):this._startProvider().then(function(){c(a).then(function(){this._hasPendingUpload=!1,d.resolve()}.bind(this),function(a){this._uploadTimer=setTimeout(function(){e(b)},f)}.bind(this))}.bind(this),function(a){this._uploadTimer=setTimeout(function(){e(b)},f)}.bind(this)))}.bind(this);return e(0),d.promise()},d.prototype._sendLogs=function(a){var b=this._messageBuilder.buildMultipartOptions(),a=this._messageBuilder.buildMultipartData(a);return this._restProvider.send(a,b)},d.prototype._sendLogsAsZip=function(a){var c=b.Deferred(),d=this._messageBuilder.buildMultipartOptions();return this._messageBuilder.buildMultipartDataAsZip(a).then(function(a){this._restProvider.send(a,d).then(function(){c.resolve()},function(a){c.reject(a)})}.bind(this),function(a){c.reject(a)}),c.promise()},c.Providers.Mpaas.LoggerProvider=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.CallbackIds={MAX_SIZE_REACHED:"maxSizeReached"}}(),function(a){"use strict";function b(){a.Base.Observable.call(this),this._output="",this._oldOutput=[],this._outputBytesCount=0,this._loggingLevel=a.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG,this._loggingEnabled=!0,this.MAX_LOG_SIZE=2097152,this.MAX_LOG_COUNT=5,this._maxSizeReachedCount=0}(b.prototype=Object.create(a.Base.Observable.prototype)).log=function(a,b){if(this._loggingEnabled)switch(a){case"debug":this._debug(b);break;case"info":this._info(b);break;case"trace":this._trace(b);break;case"warn":this._warn(b);break;case"error":this._error(b);break;case"fatal":this._fatal(b);break;default:this._info(b)}},b.prototype.getOutput=function(){var a=this._oldOutput.join("");return a+=this._output},b.prototype.clear=function(b){if(b)for(var c=b;0<c;){var d,e=this._oldOutput.shift();e?c-e.length<0?(d=e.substring(c),this._oldOutput.unshift(d),c=0):c-=e.length:(this._output=this._output.substring(c),this._outputBytesCount=a.Base.Utils.getBytesCount(this._output),c=0)}else this._output="",this._oldOutput=[],this._outputBytesCount=0},b.prototype.enableLogging=function(a){this._loggingEnabled=a},b.prototype.setLoggingLevel=function(a){this._loggingLevel=a},b.prototype._info=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.INFO&&this._prettyPrint("[I]",b)},b.prototype._error=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.ERROR&&this._prettyPrint("[E]",b)},b.prototype._fatal=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.FATAL&&this._prettyPrint("[F]",b)},b.prototype._debug=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG&&this._prettyPrint("[D]",b)},b.prototype._trace=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.TRACE&&this._prettyPrint("[T]",b)},b.prototype._warn=function(b){this._loggingLevel<=a.Providers.RemoteLogger.LOGGING_LEVELS.WARN&&this._prettyPrint("[W]",b)},b.prototype._prettyPrint=function(b,c){b=b+" "+c.shift(),0<c.length&&(b+=" "+this._format(c)),b+="\n",c=a.Base.Utils.getBytesCount(b),this._output+=b,this._outputBytesCount+=c,this._outputBytesCount>=this.MAX_LOG_SIZE&&(this._oldOutput.push(this._output),this._oldOutput.length>=this.MAX_LOG_COUNT&&this._oldOutput.shift(),this._output="",this._outputBytesCount=0,this._triggerMaxSizeReached())},b.prototype._format=function(a){var b="",c=0;return a.forEach(function(a){switch(0!==c&&(b+=" "),typeof a){case"boolean":b+=a?"true":"false";break;case"object":b+=JSON.stringify(a);break;default:b+=a}c++}),b},b.prototype._triggerMaxSizeReached=function(){this.trigger(a.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,[])},a.Providers.RemoteLogger.Logger=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.LOGGING_LEVELS={DEBUG:0,TRACE:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}(),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.Names={MPAAS:"MPaaS"}}(),function(a){"use strict";function c(){this._logger=new a.Providers.RemoteLogger.Logger,this._uploadProviders={},this._logger.on(a.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,function(){this.uploadLogs()}.bind(this))}(c.prototype={}).getLogger=function(){return this._logger},c.prototype.getProvider=function(b){var c;return this._uploadProviders.hasOwnProperty(b)?c=this._uploadProviders[b]:b===a.Providers.RemoteLogger.Names.MPAAS&&(c=new a.Providers.Mpaas.LoggerProvider,this._uploadProviders[a.Providers.RemoteLogger.Names.MPAAS]=c),c},c.prototype.uploadLogs=function(a){var c=this._logger.getOutput(),d=c.length;if(0===c.length)return b.Deferred().resolve().promise();var e,f,g=b.Deferred(),h=[];return a?this._upload(a,c,h):this._multipleUploads(c,h),0===h.length?g.reject("No upload logger provider found."):(f=e=0,h.forEach(function(a){a.then(function(){++e+f===h.length&&(this._logger.clear(d),g.resolve())}.bind(this),function(a){e+ ++f===h.length&&(0<e?(this._logger.clear(d),g.resolve()):g.reject(a))}.bind(this))}.bind(this))),g.promise()},c.prototype._upload=function(a,b,c){!this._uploadProviders.hasOwnProperty(a)||(a=this._uploadProviders[a])&&c.push(a.uploadZip(b))},c.prototype._multipleUploads=function(a,b){for(var c in this._uploadProviders)!this._uploadProviders.hasOwnProperty(c)||(c=this._uploadProviders[c])&&b.push(c.uploadZip(a))},a.Providers.RemoteLogger.RemoteLoggerProvider=c}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype.updateMeetingInfo=function(c,d){var e,f=0<c._activeParticipants.length;b.Base.Utils.isDefined(d.eventConference)&&c._eventConference!==d.eventConference&&(c._eventConference=d.eventConference,c._onEventConferenceStatusChangedCallbacks.fire(c,c._eventConference)),d.meetingName&&d.meetingName!==c._subject&&(c._subject=d.meetingName,c._onConferenceSubjectChangedCallbacks.fire(c,d.meetingName)),d.lecturerId&&"none"!==d.lecturerId!==c._isLectureModeActive&&(c._isLectureModeActive="none"!==d.lecturerId,c._onConferenceLectureModeStatusChangedCallbacks.fire(c,c._isLectureModeActive)),d.lecturerId&&d.lecturerId!==c._lecturerId&&(f?((e=c._activeParticipants.filter(function(a){return!!a._participantId&&a._participantId===c._lecturerId})[0])&&(e._lecturer=!1,e._onParticipantUnsetAsLecturerCallbacks.fire(e)),c._lecturerId=d.lecturerId,(e=c._activeParticipants.filter(function(a){return a._participantId===c._lecturerId})[0])&&(e._lecturer=!0,e._onParticipantSetAsLecturerCallbacks.fire(e))):c._lecturerId=d.lecturerId),d.virtualRoomOwnerId&&d.virtualRoomOwnerId!==c._conferenceOwnerAddress&&(c._conferenceOwnerAddress=d.virtualRoomOwnerId,c._activeParticipants.forEach(function(a){a._isConferenceOwner=a._userId===d.virtualRoomOwnerId,a._recalculateAllCapabilities()}),c._onConferenceOwnerAddressChangedCallbacks.fire(c,d.virtualRoomOwnerId)),d.recorderAvailable&&d.recorderAvailable!==c._recorderStatus&&(c._recorderStatus=d.recorderAvailable),d.recording&&d.recording!==c._recordingStatus&&(c._recordingStatus=d.recording,c._onConferenceRecordingStatusChangedCallbacks.fire(c,c._recordingStatus)),!d.locked&&!1!==d.locked||d.locked===c._isLocked||(c._isLocked=d.locked,c._admissionPasscodeNeeded=d.locked,c._admissionPermissionNeeded=d.locked,c._onConferenceLockStatusChangedCallbacks.fire(c,c._isLocked,c._admissionPasscodeNeeded,c._admissionPermissionNeeded)),d.media&&"video"===d.media!==c._isVideoAllowed&&(c._isVideoAllowed="video"===d.media,c._onConferenceVideoStatusChangedCallbacks.fire(c,c._isVideoAllowed)),d.presenterId&&"none"!==d.presenterId!==c._isApplicationSharingActive&&(c._isApplicationSharingActive="none"!==d.presenterId,c._onConferencePresentationModeStatusChangedCallbacks.fire(c,c._isApplicationSharingActive)),d.presenterId&&d.presenterId!==c._presenterId&&(f?((f=c._activeParticipants.filter(function(a){return a._participantId===c._presenterId})[0])&&(f._presenter=!1,f._onParticipantUnsetAsPresenterCallbacks.fire(f)),c._presenterId=d.presenterId,(e=c._activeParticipants.filter(function(a){return a._participantId===c._presenterId})[0])&&(e._presenter=!0,e._onParticipantSetAsPresenterCallbacks.fire(e))):c._presenterId=d.presenterId),d.encrypted&&d.encrypted!==c._encryptionStatus&&(c._encryptionStatus=d.encrypted,c._onConferenceEncryptionStatusChangedCallbacks.fire(c,c._encryptionStatus)),d.streaming!==a&&d.streaming!==c._isStreamingActive&&(c._isStreamingActive=d.streaming,c._onConferenceStreamingStatusChangedCallbacks.fire(c,c._isStreamingActive)),d.terminationTime&&d.terminationTime!==c._terminationTime&&(c._terminationTime=d.terminationTime,c._onConferenceMeetingTerminationTimeChangedCallbacks.fire(c,c._terminationTime)),d.moderatorPinNeeded!==a&&d.moderatorPinNeeded!==c._isPasscodeRequiredToBecomeModerator&&(c._isPasscodeRequiredToBecomeModerator=d.moderatorPinNeeded),d.mediaStatus&&d.mediaStatus!==c._mediaStatus&&(c._mediaStatus?d.mediaStatus===b.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(c._mediaStatus=d.mediaStatus,c._onConferenceAllParticipantsMutedCallbacks.fire(c)):d.mediaStatus===b.Services.Conference.MediaStatus.ACTIVE&&c._mediaStatus===b.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(c._mediaStatus=d.mediaStatus,c._onConferenceAllParticipantsUnmutedCallbacks.fire(c)):d.mediaStatus===b.Services.Conference.MediaStatus.ACTIVE&&c._mediaStatus===b.Services.Conference.MediaStatus.WAITING_ROOM?(c._mediaStatus=d.mediaStatus,c._onConferenceStartingCallbacks.fire(c,c._mediaStatus)):c._mediaStatus=d.mediaStatus:(c._mediaStatus=d.mediaStatus,c._mediaStatus===b.Services.Conference.MediaStatus.WAITING_ROOM?c._onConferenceWaitingToStartCallbacks.fire(c,c._mediaStatus):c._mediaStatus===b.Services.Conference.MediaStatus.MUTE_ALL_AUDIO&&c._onConferenceAllParticipantsMutedCallbacks.fire(c)))},c.prototype.updateRoster=function(a,c){var d=[],e=[],f={};c.participants.forEach(function(b){
f=this._buildActiveParticipant(b,a),e.push(f),0<a._activeParticipants.filter(function(a){return a._participantId===f._participantId}).length||(f._participantId===a._selfParticipantId&&(f._localUser=!0,a._selfParticipant=f,a.getInConferenceChat()._setSelfParticipant(f),f._isSelfParticipant=!0),d.push(f),a._activeParticipants.push(f))}.bind(this)),c=a.getActiveParticipants().filter(function(a){return 0===e.filter(function(b){return b._participantId===a._participantId}).length}),c.concat(a.getPendingParticipants().filter(function(a){return 0===e.filter(function(b){return b._participantId===a._participantId}).length})),c.forEach(function(c){var d=new b.Providers.UCCP.UCCPParticipantLeftEvent(c._participantId);b.Base.Logger.info("Dropping participant that is no longer in roster list: ",c._participantId),this.dropParticipant(a,d)}.bind(this)),a._activeParticipants.forEach(function(a){a._recalculateAllCapabilities()}),a._conferenceService._updateMatchedContactsForConference(a),0<d.length&&a._onConferenceParticipantsAddedCallbacks.fire(a,d),a._isLectureModeActive&&(f=a._activeParticipants.filter(function(b){return b._participantId===a._lecturerId})[0])&&(f._lecturer=!0,f._onParticipantSetAsLecturerCallbacks.fire(f)),a._isApplicationSharingActive&&(f=a._activeParticipants.filter(function(b){return b._participantId===a._presenterId})[0])&&(f._presenter=!0,f._onParticipantSetAsPresenterCallbacks.fire(f))},c.prototype.updateSlider=function(a,b){},c.prototype.addActiveParticipant=function(a,b){var c;0<a._activeParticipants.filter(function(a){return a._participantId===b.participantId}).length?this._buildActiveExistingParticipant(b,a):((c=this._buildActiveParticipant(b,a))._participantId===a._selfParticipantId&&(c._localUser=!0,a._selfParticipant=c,a.getInConferenceChat()._setSelfParticipant(c),c._isSelfParticipant=!0,a._recalculateAllCapabilities()),a._activeParticipants.push(c),a._onConferenceParticipantsAddedCallbacks.fire(a,[c]),a._conferenceService._updateMatchedContactsForParticipant(c),c._recalculateAllCapabilities())},c.prototype.addDialoutParticipant=function(a,c,d){if(0<a._activeParticipants.filter(function(a){return a._participantId===c.participantId}).length)return!1;var e=new b.Services.Conference.ActiveParticipant(a._participantService,a);return e._participantId=c.participantId,e._displayName=d,a._activeParticipants.push(e),e._connectionStatus=b.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTING,!0},c.prototype.updateDialoutParticipant=function(a,c,d){c._connectionStatus=b.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED,c._onParticipantConnectionStatusChangedCallbacks.fire(c,c._connectionStatus)},c.prototype.removeDialoutParticipant=function(a,c,d){var e=a._activeParticipants.filter(function(a){return a._participantId===c})[0];b.Base.Utils.isDefined(e)&&a._activeParticipants.splice(a._activeParticipants.indexOf(e),1)},c.prototype.addPendingParticipant=function(a,b){var c;0<a._pendingParticipants.filter(function(a){return a._participantId===b.participantId}).length||(c=this._buildPendingParticipant(b,a),a._pendingParticipants.push(c),a._conferenceService._updateMatchedContactsForParticipant(c),a._onConferencePendingParticipantCallbacks.fire(a,c))},c.prototype.removePendingParticipant=function(a,c){var d,e=a._pendingParticipants.filter(function(a){return a._participantId===c.participantId||a._participantId===c._participantId})[0];b.Base.Utils.isDefined(e)&&(d=a._pendingParticipants.indexOf(e),a._pendingParticipants.splice(d,1),a._onConferencePendingParticipantRemovedCallbacks.fire(a,e))},c.prototype.pendingParticipantAccepted=function(a,b){a._onPendingParticipantAcceptedCallbacks.fire(a,b.anotherModerator),this.removePendingParticipant(a._conference,a)},c.prototype.pendingParticipantCancelled=function(a,c){a=a._pendingParticipants.filter(function(a){return a._participantId===c.participantId})[0],b.Base.Utils.isDefined(a)&&(a._onPendingParticipantCancelledCallbacks.fire(a,c.reason,c.anotherModerator),this.removePendingParticipant(a._conference,a))},c.prototype.pendingParticipantDenied=function(a,b){a._onPendingParticipantDeniedCallbacks.fire(a,b.anotherModerator),this.removePendingParticipant(a._conference,a)},c.prototype.dropParticipant=function(a,c){var d,e=a._activeParticipants.filter(function(a){return a._participantId===c.participantId})[0],f=a._pendingParticipants.filter(function(a){return a._participantId===c.participantId})[0];b.Base.Utils.isDefined(e)&&(a._activeParticipants.splice(a._activeParticipants.indexOf(e),1),d=this._buildDroppedParticipant(e,a),a._droppedParticipants.push(d),a._conferenceService._updateMatchedContactsForParticipant(d),a._onConferenceParticipantsRemovedCallbacks.fire(a,[e]),a._onConferenceDroppedParticipantAddedCallbacks.fire(a,d)),b.Base.Utils.isDefined(f)&&(a._pendingParticipants.splice(a._pendingParticipants.indexOf(f),1),a._onConferencePendingParticipantRemovedCallbacks.fire(a,f))},c.prototype.updateMeetingNote=function(a,b){},c.prototype.updateActiveTalker=function(a,c){var d;c.participantId!==a._activeTalkerId&&(d=a._activeParticipants.filter(function(b){return b._participantId===a._activeTalkerId})[0],b.Base.Utils.isDefined(d)&&d._onParticipantActiveTalkerStatusChangedCallbacks.fire(d,!1),d=a._activeParticipants.filter(function(a){return a._participantId===c.participantId})[0],b.Base.Utils.isDefined(d)&&(a._activeTalkerId=c.participantId,a._onConferenceActiveTalkersChangedCallbacks.fire(a,d),d._lastSpokenTime=new Date,d._onParticipantActiveTalkerStatusChangedCallbacks.fire(d,!0))),a._activeTalkerId&&d&&(a._recentTalkersList=a.getRecentTalkers().filter(function(b){return b._participantId!==a._activeTalkerId}),a.getRecentTalkers().push(d),a.getRecentTalkers().length>b.Services.Conference.RecentTalkersConfiguration.SIZE&&(a._recentTalkersList=a.getRecentTalkers().slice(-b.Services.Conference.RecentTalkersConfiguration.SIZE)))},c.prototype.updateWebCollab=function(a,c){b.Base.Utils.isDefined(c)&&b.Base.Utils.isDefined(c.webCollabUrl)&&0<c.webCollabUrl.length?a._collaborationURI=c.webCollabUrl+"/viewer.php?token="+c.token+"&participantId="+c.participantId+"&meeting_id="+c.meeting_id+"&mode="+c.mode+"&login="+c.login:a._collaborationURI="",a._onConferenceCollaborationURIChangedCallbacks.fire(a,a._collaborationURI)},c.prototype.updatePermissions=function(a,c){b.Base.Utils.isDefined(c.dialout)&&c.dialout!==a._dialoutPermissions&&(a._dialoutPermissions=c.dialout),b.Base.Utils.isDefined(c.recording)&&c.recording!==a._recordingPermissions&&(a._recordingPermissions=c.recording),b.Base.Utils.isDefined(c.lock)&&c.lock!==a._lockPermissions&&(a._lockPermissions=c.lock),b.Base.Utils.isDefined(c.unmuteSelf)&&c.unmuteSelf!==a._unmuteSelfPermissions&&(a._unmuteSelfPermissions=c.unmuteSelf),b.Base.Utils.isDefined(c.unmuteAll)&&c.unmuteAll!==a._unmuteAllPermissions&&(a._unmuteAllPermissions=c.unmuteAll),b.Base.Utils.isDefined(c.sendFecc)&&c.sendFecc!==a._sendFeccPermissions&&(a._sendFeccPermissions=c.sendFecc),b.Base.Utils.isDefined(c.allowVideo)&&c.allowVideo!==a._allowVideoDirection&&(a._allowVideoDirection=c.allowVideo,a._isAvailable&&b.Base.Utils.isDefined(a._selfParticipant)&&a._onConferenceAllowVideoDirectionChangedCallbacks.fire(a)),a._recalculateAllCapabilities()},c.prototype.updateAvailableLayouts=function(a,c){if(b.Base.Utils.isDefined(c.textOverlay)&&c.textOverlay!==a._isVideoParticipantNameDisplayChangeAllowed&&(a._isVideoParticipantNameDisplayChangeAllowed=c.textOverlay,a._recalculateAllCapabilities(),a._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.fire(a,a._isVideoParticipantNameDisplayChangeAllowed)),b.Base.Utils.isDefined(c.LPPOn)&&c.LPPOn!==a._isVideoPersonalLayoutActive&&(a._isVideoPersonalLayoutActive=c.LPPOn,a._recalculateAllCapabilities()),b.Base.Utils.isDefined(c.noSelfSee)&&c.noSelfSee!==a._isVideoSelfSeeChangeAllowed&&(a._isVideoSelfSeeChangeAllowed=c.noSelfSee,a._recalculateAllCapabilities(),a._onConferenceVideoSelfSeeAllowedCallbacks.fire(a,a._isVideoSelfSeeChangeAllowed)),b.Base.Utils.isDefined(c.videoPin)&&c.videoPin!==a._isVideoPinAllowed&&(a._isVideoPinAllowed=c.videoPin,a._recalculateAllCapabilities(),a._onConferenceVideoPinAllowedCallbacks.fire(a,a._isVideoPinAllowed)),b.Base.Utils.isDefined(c.geometries)){var d=a._supportedVideoLayouts.slice(0);a._supportedVideoLayouts=c.geometries.slice(0);var e=!1;if(d.length===a._supportedVideoLayouts.length){for(var f=0;f<d.length;f++)if(d[f]!==a._supportedVideoLayouts[f]){e=!0;break}}else e=!0;e&&(a._recalculateAllCapabilities(),a._onConferenceAvailableVideoLayoutsChangedCallbacks.fire(a,a._supportedVideoLayouts))}},c.prototype.updateCurrentLayout=function(a,c){var d;b.Base.Utils.isDefined(c.textOverlay)&&c.textOverlay!==a._isVideoParticipantNameDisplayActive&&(a._isVideoParticipantNameDisplayActive=c.textOverlay,a._onConferenceDisplayVideoParticipantNameChangedCallbacks.fire(a,a._isVideoParticipantNameDisplayActive)),b.Base.Utils.isDefined(c.LPPOn)&&c.LPPOn!==a._isVideoPersonalLayoutActive&&(a._isVideoPersonalLayoutActive=c.LPPOn),b.Base.Utils.isDefined(c.noSelfSee)&&(d=a._isVideoSelfSeeActive,a._isVideoSelfSeeActive=!c.noSelfSee,a._isVideoSelfSeeActive!==d&&a._onConferenceVideoSelfSeeChangedCallbacks.fire(a,a._isVideoSelfSeeActive)),b.Base.Utils.isDefined(c.geometry)&&c.geometry!==a._currentVideoLayout&&(a._currentVideoLayout=c.geometry,a._onConferenceVideoLayoutChangedCallbacks.fire(a,a._currentVideoLayout))},c.prototype.addChatMessage=function(a,c){var d=a.getInConferenceChat(),e=a._activeParticipants.filter(function(a){return a._participantId===c.participantId})[0];c.participantId!==a._selfParticipantId&&(e=new b.Services.Conference.ChatMessage(c.text,e,d._selfParticipant,c.type===b.Services.Conference.ChatType.PRIVATE),d._addMessage(e))},c.prototype._buildActiveParticipant=function(a,c){var d=new b.Services.Conference.ActiveParticipant(c._participantService,c);return d._participantId=a.participantId,d._displayName=a.participantName,d._address=a.userId,d._userId=a.userId,d._joinTime=a.joinTime,d._sourceID=a.sourceID,d._status=a.status,d._handRaised=a.handRaised,d._role=a.role,d._feccRecvSupport=a.feccRecvSupport,d._audioFromParticipant=a.audioFromParticipant,d._audioToParticipant=a.audioToParticipant,d._videoFromParticipant=a.videoFromParticipant,d._videoToParticipant=a.videoToParticipant,d._contentFromParticipant=a.contentFromParticipant,d._contentToParticipant=a.contentToParticipant,d._canLecture=a.canLecture,d._wasPreviouslyNotVisibleInParticipantList=a.wasHidden,d._isConferenceOwner=a.userId===c._conferenceOwnerAddress,d},c.prototype._buildDroppedParticipant=function(a,c){return c=new b.Services.Conference.DroppedParticipant(c._participantService,c),c._participantId=a._participantId,c._userId=a._userId,c._displayName=a._displayName,c._address=a._address,c._localUser=!1,c._conference=a._conference,c._recalculateAllCapabilities(),c},c.prototype._buildPendingParticipant=function(a,c){var d=new b.Services.Conference.PendingParticipant(c._participantService,c);return d._participantId=a.participantId,d._userId=a.userId,d._displayName=a.participantName,d._address=a.userId,d._status=a.status,d._localUser=!1,d._conference=c,d._recalculateAllCapabilities(),d},c.prototype._buildActiveExistingParticipant=function(a,c){var d=c._activeParticipants.filter(function(b){return b._participantId===a.participantId})[0];return d._connectionStatus===b.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED?(d._displayName=a.participantName,d._userId=a.userId,d._address=a.userId,d._joinTime=a.joinTime,d._sourceID=a.sourceID,d._status=a.status,d._handRaised=a.handRaised,d._role=a.role,d._feccRecvSupport=a.feccRecvSupport,d._audioFromParticipant=a.audioFromParticipant,d._audioToParticipant=a.audioToParticipant,d._videoFromParticipant=a.videoFromParticipant,d._videoToParticipant=a.videoToParticipant,d._contentFromParticipant=a.contentFromParticipant,d._contentToParticipant=a.contentToParticipant,d._canLecture=a.canLecture,d._wasPreviouslyNotVisibleInParticipantList=a.wasHidden,c._onConferenceParticipantsAddedCallbacks.fire(c,[d]),d._recalculateAllCapabilities()):this._updateParticipantsData(c,d,a),d},c.prototype.updateParticipant=function(a,c,d){var e=a._activeParticipants.filter(function(a){return a._participantId===c.participantId});b.Base.Utils.isDefined(e[0])?(this._updateParticipantsData(a,e[0],c),a._conferenceService._updateMatchedContactsForParticipant(e[0])):(d=b.Base.Utils.isDefined(d)?d:0,b.Base.Logger.info(b.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"updateParticipant: Participant is not found."),d<2&&setTimeout(function(){this.updateParticipant(a,c,++d)}.bind(this),500))},c.prototype._updateParticipantsData=function(a,c,d){var e;b.Base.Utils.isDefined(d.audioFromParticipant)&&c._audioFromParticipant!==d.audioFromParticipant&&(c._audioFromParticipant=d.audioFromParticipant,c._isAudioMuted=d.audioFromParticipant!==b.Services.Conference.MediaFromParticipantStatus.ACTIVE,c._onParticipantAudioStatusChangedCallbacks.fire(c,c._audioFromParticipant),c._recalculateAllCapabilities()),b.Base.Utils.isDefined(d.videoFromParticipant)&&c._videoFromParticipant!==d.videoFromParticipant&&(c._videoFromParticipant=d.videoFromParticipant,c._isVideoBlocked=d.videoFromParticipant!==b.Services.Conference.MediaFromParticipantStatus.ACTIVE,c._onParticipantVideoStatusChangedCallbacks.fire(c,c._videoFromParticipant),c._recalculateAllCapabilities()),b.Base.Utils.isDefined(d.status)&&c._status!==d.status&&(c._status=d.status,c._onParticipantStatusChangedCallbacks.fire(c,c._status)),b.Base.Utils.isDefined(d.handRaised)&&c._handRaised!==d.handRaised&&(c._handRaised=d.handRaised,c.isLocalUser()&&(a._isHandRaised=d.handRaised),(c._handRaised?c._onParticipantHandRaisedCallbacks:c._onParticipantHandLoweredCallbacks).fire(c)),b.Base.Utils.isDefined(d.role)&&c._role!==d.role&&(e=c._role,c._role=d.role,c._role===b.Services.Conference.ParticipantRole.MODERATOR?c._onParticipantSetAsModeratorCallbacks.fire(c):e===b.Services.Conference.ParticipantRole.MODERATOR&&c._role!==b.Services.Conference.ParticipantRole.MODERATOR&&c._onParticipantUnsetAsModeratorCallbacks.fire(c),a._recalculate()),b.Base.Utils.isDefined(d.canLecture)&&c._canLecture!==d.canLecture&&(c._canLecture=d.canLecture,c._recalculateAllCapabilities()),b.Base.Utils.isDefined(d.participantName)&&c._displayName!==d.participantName&&(c._displayName=d.participantName,c._onParticipantDisplayNameChangedCallbacks.fire(c),c._onParticipantNameChangedCallbacks.fire(c)),b.Base.Utils.isDefined(d.feccRecvSupport)&&c._feccRecvSupport!==d.feccRecvSupport&&(c._feccRecvSupport=d.feccRecvSupport),b.Base.Utils.isDefined(d.audioToParticipant)&&c._audioToParticipant!==d.audioToParticipant&&(c._audioToParticipant=d.audioToParticipant),b.Base.Utils.isDefined(d.videoToParticipant)&&c._videoToParticipant!==d.videoToParticipant&&(c._videoToParticipant=d.videoToParticipant),b.Base.Utils.isDefined(d.contentFromParticipant)&&c._contentFromParticipant!==d.contentFromParticipant&&(c._contentFromParticipant=d.contentFromParticipant,c._onParticipantCollaborationStatusChangedCallbacks.fire(c)),b.Base.Utils.isDefined(d.contentToParticipant)&&c._contentToParticipant!==d.contentToParticipant&&(c._contentToParticipant=d.contentToParticipant),b.Base.Utils.isDefined(d.userId)&&c._userId!==d.userId&&(c._userId=d.userId)},c.prototype.updateDialInInfo=function(a,b){a._joinMeetingURI=b.webLink,a._streamingURI=b.streamingLink,a._dialInInformation=b.dialInInformation,a._dialInInformationHtml=b.dialInInformationHtml,a._onConferenceStreamingURIUpdatedCallbacks.fire(a),a._onConferenceJoinMeetingURIUpdatedCallbacks.fire(a),a._onConferenceDialInInfoUpdatedCallbacks.fire(a)},c.prototype.recordingFailed=function(a,b){a._onConferenceRecordingFailedCallbacks.fire(a)},c.prototype.meetingTerminationInProgress=function(a,b){a._onConferenceMeetingTerminationInProgressCallbacks.fire(a,b.reason,b.userName)},c.prototype.handleDisconnectEvent=function(a,c){b.Base.Logger.info(b.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference received disconnect event. Reason: "+c.reason),a._conferenceService._isDisconnecting=!0,a._onConferenceConnectionEndedCallbacks.fire(a,c.reason),a.stop()},c.prototype.networkFailureHandler=function(a){a._isAvailable&&(a._isAvailable=!1,a._inConferenceChatCapability.denialReason=b.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED,a._inConferenceChatCapability.isAllowed=!1,a._onConferenceServiceUnavailableCallbacks.fire(a,new b.Services.Conference.ConferenceException(b.Services.Conference.ConferenceError.NETWORK_UNAVAILABLE))),a._recalculate()},c.prototype.networkAvailabilityHandler=function(a){a._isAvailable||(a._isAvailable=!0,a._inConferenceChatCapability.denialReason=b.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,a._inConferenceChatCapability.isAllowed=!0,a._onConferenceServiceAvailableCallbacks.fire(a)),a._recalculate()},c.prototype.connectionRecoveryFailureHandler=function(a){a._isAvailable&&(a._isAvailable=!1),a._onConferenceServiceUnavailableCallbacks.fire(a,new b.Services.Conference.ConferenceException(b.Services.Conference.ConferenceError.CONFERENCE_CONNECTION_FAILED_TO_RECOVER)),a._recalculate()},b.Providers.Scopia.ScopiaConferenceBuilder=c}(AvayaClientServices),function(c){"use strict";function d(b,d){c.Providers.Interfaces.ConferenceProvider.call(this),this._dataProvider=b,this._conferenceBuilder=d,this._transaction={id:1},this._isAvailable=!1,this._networkFailureTimer=a}(d.prototype=Object.create(c.Providers.Interfaces.ConferenceProvider.prototype)).start=function(a,d){if(this._isAvailable)return b.Deferred().resolve();var e=c.Base.Utils.queryJSONObject(d,"networkProviderConfiguration.webSocketConfig");return!1!==d.enabled&&c.Base.Utils.isDefined(e)?(this._startNetworkFailureTimer(a),this._dataProvider.start(d,a).then(function(){return this._dataProvider.sendHandshake(this._transaction.id++)}.bind(this)).then(function(d){var e=b.Deferred();this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._conferenceBuilder.networkAvailabilityHandler(a),a._selfParticipantId=d.participantId,a._admissionPermissionNeeded=d.admissionPermissionNeeded,a._admissionPasscodeNeeded=d.admissionPasscodeNeeded,a._knockDoorTimeout=d.knockDoorTimeout;var f=a._getPreEnteredPasscode();return d.admissionPermissionNeeded?(this._stopNetworkFailureTimer(),d.admissionPasscodeNeeded?e.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):e.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference admission is needed"})):d.admissionPasscodeNeeded?(this._stopNetworkFailureTimer(),f?a.sendPasscode(f).then(function(){e.resolve()},function(){e.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):e.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference passcode is needed"})):"fail"===d.responseCode?(c.Base.Logger.warn(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),e.reject({name:c.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),a._isAvailable=!0,a._onConferenceServiceAvailableCallbacks.fire(a),this._startListenersAndSubscribes(a),this._isAvailable=!0,e.resolve()),e.promise()}.bind(this),function(b){(b._data&&(502===b._data._status||403===b._data._status)||b.code&&"fail"===b.code)&&(c.Base.Logger.warn(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))):b.Deferred().reject({name:c.Services.Conference.ConferenceStartStatus.CONFERENCE_CONFIG_NOT_ENABLED,message:"Conference config is not enabled"})},d.prototype._startListenersAndSubscribes=function(a,b){return this.addConferenceEventListeners(a,b),this.observeConference(a),c.Base.Logger.info(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference service is started."),a},d.prototype.observeConference=function(a){this._dataProvider.getDialInInfo(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateDialInInfo(a,b),b}.bind(this)),this._dataProvider.subscribeMeetingInfo(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateMeetingInfo(a,b),a._recalculateAllCapabilities(),b}.bind(this)),this._dataProvider.subscribeRoster(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateRoster(a,b),a._recalculateAllCapabilities(),b}.bind(this)),this._dataProvider.subscribeActiveTalker(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateActiveTalker(a,b),b}.bind(this)),this._dataProvider.subscribeMeetingNote(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateMeetingNote(a,b),b}.bind(this)),this._dataProvider.subscribeWebCollab(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateWebCollab(a,b),b}.bind(this)),this._dataProvider.subscribeAvailableLayouts(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateAvailableLayouts(a,b),b}.bind(this)),this._dataProvider.subscribePermissions(this._transaction.id++).then(function(b){return this._conferenceBuilder.updatePermissions(a,b),b}.bind(this)),this._dataProvider.getCurrentVideoLayout(this._transaction.id++).then(function(b){return this._conferenceBuilder.updateCurrentLayout(a,b),a._recalculateAllCapabilities(),b}.bind(this))},d.prototype.sendAdmissionRequest=function(a,b){return this._dataProvider.sendAdmissionRequest(this._transaction.id++,b).then(function(b){if(b.responseCode===c.Services.Conference.AdmissionResponseCode.SUCCESS)return a._isAvailable=!0,a._setConferenceStarted(!0),a._onConferenceServiceAvailableCallbacks.fire(a),a._admissionPasscodeNeeded=!1,this._isAvailable=!0,a.addOnConferenceRecordingStatusChangedCallback(a._conferenceService._recalculateConferenceRecordingStatuses),this._startListenersAndSubscribes(a)}.bind(this))},d.prototype.addConferenceEventListeners=function(a,b){var d;b||((d=this._dataProvider.getSelectedProvider()).on(c.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,function(b){this._conferenceBuilder.addActiveParticipant(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,function(b){this._conferenceBuilder.dropParticipant(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,function(b){this._conferenceBuilder.updateActiveTalker(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,function(b){this._conferenceBuilder.handleDisconnectEvent(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,function(b){this._conferenceBuilder.updatePermissions(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,function(b){this._conferenceBuilder.updateParticipant(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,function(b){this._conferenceBuilder.updateMeetingInfo(a,b),a._recalculateInConferenceChatCapability()}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,function(b){this._conferenceBuilder.updateAvailableLayouts(a,b),b.geometries&&0<b.geometries.length&&d.getCurrentVideoLayout(this._transaction.id++).then(function(b){this._conferenceBuilder.updateCurrentLayout(a,b)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Failed to retrieve current layout",a)})}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,function(b){this._conferenceBuilder.updateCurrentLayout(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,function(b){this._conferenceBuilder.meetingTerminationInProgress(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,function(b){this._conferenceBuilder.addPendingParticipant(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,function(b){this._conferenceBuilder.pendingParticipantCancelled(a,b),this._conferenceBuilder.removePendingParticipant(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,function(b){this._conferenceBuilder.recordingFailed(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,function(b){this._conferenceBuilder.updateWebCollab(a,b)}.bind(this)),d.on(c.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,function(b){this._conferenceBuilder.addChatMessage(a,b)}.bind(this)),d.on(c.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._startNetworkFailureTimer(a),this._conferenceBuilder.networkFailureHandler(a)}.bind(this)),d.on(c.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_AVAILABLE,function(){this._resubscribe(a)}.bind(this)))},d.prototype.stop=function(){return this._isAvailable=!1,this._stopNetworkFailureTimer(),this._dataProvider.stop().fail(function(a){c.Base.Logger.error(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"failed to stop data provider: ",a)})},d.prototype._startNetworkFailureTimer=function(a){c.Base.Utils.isUndefined(this._networkFailureTimer)&&(this._networkFailureTimer=setTimeout(function(){this._conferenceBuilder.connectionRecoveryFailureHandler(a)}.bind(this),2e4))},d.prototype._stopNetworkFailureTimer=function(){this._networkFailureTimer&&(clearTimeout(this._networkFailureTimer),this._networkFailureTimer=a)},d.prototype._startLongPollHandshakeResponseTimer=function(){this._stopLongPollHandshakeResponseTimer(),this._longPollHandshakeResponseTimer=setTimeout(function(){this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&(c.Base.Logger.warn("UCCP long polling handshake timeout"),this._abortLongPollProvider(this._dataProvider.getSelectedProvider()),this._longPollHandshakeResponseTimer=a)}.bind(this),2e4)},d.prototype._abortLongPollProvider=function(a){this._isLongPollingUccpProvider(a)&&a._networkProvider._communicationAdapter.abort()},d.prototype._stopLongPollHandshakeResponseTimer=function(){this._longPollHandshakeResponseTimer&&(clearTimeout(this._longPollHandshakeResponseTimer),this._longPollHandshakeResponseTimer=a)},d.prototype._resubscribe=function(a){return this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._startLongPollHandshakeResponseTimer(),this._dataProvider.sendHandshake(this._transaction.id++).then(function(d){var e,f=b.Deferred();return this._stopLongPollHandshakeResponseTimer(),a._selfParticipantId=d.participantId,a._admissionPermissionNeeded=d.admissionPermissionNeeded,a._admissionPasscodeNeeded=d.admissionPasscodeNeeded,a._knockDoorTimeout=d.knockDoorTimeout,d.admissionPermissionNeeded||d.admissionPasscodeNeeded?(e=a._getPreEnteredPasscode(),this._stopNetworkFailureTimer(),d.admissionPermissionNeeded?d.admissionPasscodeNeeded?f.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):f.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference admission is needed"}):d.admissionPasscodeNeeded&&(e?a.sendPasscode(e).then(function(){f.resolve()},function(){f.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):f.reject({name:c.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:d.admissionPasscodeNeeded,admissionPermissionNeeded:d.admissionPermissionNeeded,message:"Conference passcode is needed"}))):"fail"===d.responseCode?(c.Base.Logger.warn(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),f.reject({name:c.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),this._conferenceBuilder.networkAvailabilityHandler(a),this._startListenersAndSubscribes(a,!0),f.resolve()),f.promise()}.bind(this),function(b){this._stopLongPollHandshakeResponseTimer(),(b._data&&(502===b._data._status||403===b._data._status)||b.code&&"fail"===b.code)&&(c.Base.Logger.warn(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))},d.prototype.setAsLecturer=function(a){return this._dataProvider.setAsLecturer(this._transaction.id++,a)},d.prototype.setLocked=function(a){return this._dataProvider.setLocked(this._transaction.id++,a)},d.prototype.unsetAsLecturer=function(){return this._dataProvider.unsetAsLecturer(this._transaction.id++)},d.prototype.disconnectParticipant=function(a){return this._dataProvider.disconnectParticipant(this._transaction.id++,a)},d.prototype.startRecording=function(a,b,c){return this._dataProvider.startRecording(this._transaction.id++,b,c)},d.prototype.stopRecording=function(a){return this._dataProvider.stopRecording(this._transaction.id++)},d.prototype.pauseRecording=function(a){return this._dataProvider.pauseRecording(this._transaction.id++)},d.prototype.resumeRecording=function(a){return this._dataProvider.resumeRecording(this._transaction.id++)},d.prototype.muteUnmute=function(a,b,c){return this._dataProvider.muteUnmute(this._transaction.id++,a,b,c)},d.prototype.controlRemoteCamera=function(a,b){return this._dataProvider.controlRemoteCamera(this._transaction.id++,a,b)},d.prototype.muteUnmuteAll=function(a){return this._dataProvider.muteUnmuteAll(this._transaction.id++,a)},d.prototype.sendLocalMuteEvent=function(a,b){return this._dataProvider.sendLocalMuteEvent(this._transaction.id++,a,b)},d.prototype.sendDisconnectEvent=function(a){return this._isAvailable?this._dataProvider.sendDisconnectEvent(this._transaction.id++,a):b.Deferred().reject("Service unavailable")},d.prototype.setVideoLayout=function(a){return this._dataProvider.setVideoLayout(this._transaction.id++,a)},d.prototype.setVideoLayoutSelfSee=function(a){return this._dataProvider.setVideoLayoutSelfSee(this._transaction.id++,a)},d.prototype.setVideoLayoutTextOverlay=function(a){return this._dataProvider.setVideoLayoutTextOverlay(this._transaction.id++,a)},d.prototype.getCurrentVideoLayout=function(){return this._dataProvider.getCurrentVideoLayout(this._transaction.id++)},d.prototype.terminateConference=function(){return this._dataProvider.terminateConference(this._transaction.id++)},d.prototype.removeLastParticipant=function(){var a=b.Deferred();return c.Base.Logger.info(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"removeLastParticipant method is not implemented"),a.reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"removeLastParticipant method is not implemented")),a.promise()},d.prototype.requestToBecomeModerator=function(a){return this._dataProvider.requestToBecomeModerator(this._transaction.id++,a)},d.prototype.signIn=function(a){return this._dataProvider.signIn(this._transaction.id++,a)},d.prototype.videoPin=function(a,b,c,d,e){return this._dataProvider.videoPin(this._transaction.id++,a,b,c,d,e);
},d.prototype.extendMeeting=function(a){return this._dataProvider.extendMeeting(this._transaction.id++,a)},d.prototype.addParticipantFromCall=function(a){var d=b.Deferred();return c.Base.Logger.info(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"addParticipantFromCall method is not implemented"),d.reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"addParticipantFromCall method is not implemented")),d.promise()},d.prototype.addParticipant=function(a,d){var e=b.Deferred();return this._dataProvider.addParticipant(this._transaction.id++,d).then(function(b){this._conferenceBuilder.addDialoutParticipant(a,b,d)&&e.notify(b),this._dataProvider.getSelectedProvider().on(c.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,function(b){var d=a._activeParticipants.filter(function(a){return a._participantId===b.participantId})[0];c.Base.Utils.isDefined(d)?b.result===c.Services.Conference.DialoutStatus.CONNECT?(this._conferenceBuilder.updateDialoutParticipant(a,d,b),e.resolve(b)):(a._activeParticipants.splice(a._activeParticipants.indexOf(d),1),e.reject({name:"UCCPServerError",code:b.result,message:"UCCP server responded with "+b.result,type:c.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT})):c.Base.Logger.info(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Update dialout participant: unknown or canceled participant with participantId",b.participantId),this._dataProvider.getSelectedProvider().off(c.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,this._dataProvider.getSelectedProvider()._listeners[c.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT][0])}.bind(this))}.bind(this),function(a){e.reject(a)}.bind(this)),e.promise()},d.prototype.cancelDialoutParticipant=function(a,c){var d=b.Deferred();return this._dataProvider.cancelDialoutParticipant(this._transaction.id++,c).then(function(b){this._conferenceBuilder.removeDialoutParticipant(a,c,b),d.resolve(b)}.bind(this),function(a){d.reject(a)}.bind(this)),d.promise()},d.prototype.sendChatMessage=function(a,b){return this._dataProvider.sendChatMessage(this._transaction.id++,a,b)},d.prototype.moderatorAdmission=function(a,b){return this._dataProvider.moderatorAdmission(this._transaction.id++,a.getParticipantId(),b).then(function(d){switch(b){case c.Services.Conference.ModeratorAdmissionActions.ADMIT:this._conferenceBuilder.pendingParticipantAccepted(a,d);break;case c.Services.Conference.ModeratorAdmissionActions.REJECT:this._conferenceBuilder.pendingParticipantDenied(a,d);break;default:c.Base.Logger.warn(c.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Unknown action value received: {0}",b)}return d}.bind(this))},d.prototype.raiseLowerHand=function(a){return this._dataProvider.raiseLowerHand(this._transaction.id++,a)},d.prototype.moderatorLowerHand=function(a,b){return this._dataProvider.moderatorLowerHand(this._transaction.id++,a,b)},d.prototype.getDialInInfo=function(){return this._dataProvider.getDialInInfo(this._transaction.id++)},d.prototype.recalculateAddParticipantFromCallCapability=function(a,b){},d.prototype.recalculateAddParticipantFromCallCapabilityByCallId=function(a,b){},d.prototype._isLongPollingUccpProvider=function(a){return!(!a||!a._networkProvider)&&a._networkProvider._communicationAdapter instanceof c.Providers.UCCP.UCCPLongPollingProvider},d.prototype.changeParticipantName=function(a,b){return this._dataProvider.changeParticipantName(this._transaction.id++,a,b)},c.Providers.Scopia.ScopiaConferenceProvider=d}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={getScopiaConferenceProvider:function(b){if(a.Base.Utils.isDefined(b)&&b.enabled){var c=new a.Providers.UCCP.UCCPMessageBuilder,d=new a.Providers.UCCP.UCCPMessageParser;return d.register(a.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_RESPONSE,new a.Providers.UCCP.UCCPHandshakeResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeRosterResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE,new a.Providers.UCCP.UCCPSubscribePermissionsResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_RESPONSE,new a.Providers.UCCP.UCCPSubscribeWebCollabResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE,new a.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,new a.Providers.UCCP.UCCPParticipantJoinedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,new a.Providers.UCCP.UCCPParticipantLeftEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,new a.Providers.UCCP.UCCPActiveTalkerChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,new a.Providers.UCCP.UCCPPermissionsChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPMeetingInfoChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPParticipantInfoChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStartResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStopResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.FECC_RESPONSE,new a.Providers.UCCP.UCCPFeccResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE,new a.Providers.UCCP.UCCPMuteAllResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_RESPONSE,new a.Providers.UCCP.UCCPDisconnectParticipantResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,new a.Providers.UCCP.UCCPDisconnectEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,new a.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_RESPONSE,new a.Providers.UCCP.UCCPTerminateMeetingResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_RESPONSE,new a.Providers.UCCP.UCCPDialInInfoResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_RESPONSE,new a.Providers.UCCP.UCCPDialoutResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,new a.Providers.UCCP.UCCPDialoutCompletedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_RESPONSE,new a.Providers.UCCP.UCCPDialoutCancelResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE,new a.Providers.UCCP.UCCPStartModerationResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE,new a.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_RESPONSE,new a.Providers.UCCP.UCCPChatResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,new a.Providers.UCCP.UCCPChatEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_RESPONSE,new a.Providers.UCCP.UCCPLockMeetingResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_RESPONSE,new a.Providers.UCCP.UCCPRecordingResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_RESPONSE,new a.Providers.UCCP.UCCPExtendMeetingResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,new a.Providers.UCCP.UCCPRecordingResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_RESPONSE,new a.Providers.UCCP.UCCPCurrentLayoutResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,new a.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,new a.Providers.UCCP.UCCPCurrentLayoutChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE,new a.Providers.UCCP.UCCPVideoPinResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE,new a.Providers.UCCP.UCCPRaiseHandResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE,new a.Providers.UCCP.UCCPModeratorLowerHandResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPAdmissionResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPModeratorAdmissionResponseParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,new a.Providers.UCCP.UCCPRecordingFailedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,new a.Providers.UCCP.UCCPWebCollabChangedEventParser),d.register(a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,new a.Providers.UCCP.UCCPKeepAliveRequestEventParser),b=this._createUccpNetworkProvider(d),c=new a.Providers.UCCP.UCCPProviderFactory(b,c,d).getUCCPProvider(),d=new a.Providers.Scopia.ScopiaConferenceBuilder,new a.Providers.Scopia.ScopiaConferenceProvider(c,d)}},_createUccpNetworkProvider:function(b){var c=new a.Base.TransactionalWebSocketProvider(a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER),b=new a.Providers.UCCP.UCCPLongPollingProvider(b);return new a.Base.NetworkProvider(c,b,a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER)}},a.Providers.Scopia.ScopiaConferenceProviderFactory=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessage=function(a){this.protocolType="UCCP",this.name=a}}(),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT),this.participantId=b,this.reason=c,this.anotherModerator=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT),this.participantId=b,this.participantName=c,this.userId=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE),this.transId=b,this.responseCode=c,this.anotherModerator=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorLowerHandResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE),this.transId=b,this.responseCode=c,this.audioMute=d,this.videoMute=e}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorMuteResponse=b}(AvayaClientServices),function(a){"use strict";a.Providers.UCCP.UCCPMuteAllResponse=function(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE),this.transId=b,this.responseCode=c}}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.Providers.UCCP.UCCPMessage.call(this,"participantInfoChangedEvent"),this.participantId=c,this.participantName=b,this.status=d,this.handRaised=e,this.role=f,this.feccRecvSupport=g,this.audioFromParticipant=h,this.audioToParticipant=i,this.videoFromParticipant=j,this.videoToParticipant=k,this.contentFromParticipant=l,this.contentToParticipant=m,this.userId=n,this.canLecture=o}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPParticipantInfoChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){a.Providers.UCCP.UCCPMessage.call(this,"participantJoinedEvent"),this.participantId=b,this.participantName=c,this.userId=d,this.sourceID=e,this.status=f,this.handRaised=g,this.role=h,this.feccRecvSupport=i,this.audioFromParticipant=j,this.audioToParticipant=k,this.videoFromParticipant=l,this.videoToParticipant=m,this.contentFromParticipant=n,this.contentToParticipant=o,this.joinTime=p,this.canLecture=q,this.wasHidden=r}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPParticipantJoinedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.UCCP.UCCPMessage.call(this,"participantLeftEvent"),this.participantId=b}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPParticipantLeftEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT),this.dialout=b,this.recording=c,this.lock=d,this.unmuteSelf=e,this.unmuteAll=f,this.sendFecc=g,this.allowVideo=h}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPPermissionsChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPRaiseHandResponse=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.UCCP.UCCPMessage.call(this,"recordingFailedEvent")}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPRecordingFailedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"recordingResponse"),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPRecordingResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPStartModerationResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,"subscribeActiveTalkerResponse"),this.transId=b,this.responseCode=c,this.participantId=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeActiveTalkerResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE),this.transId=b,this.responseCode=c,this.textOverlay=d,this.noSelfSee=e,this.videoPin=f,this.geometries=g,this.LPPOn=h}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){a.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingInfoResponse"),this.transId=b,this.responseCode=c,this.meetingId=d,this.meetingName=e,this.virtualRoomName=f,this.virtualRoomOwnerId=g,this.media=h,this.eventConference=i,this.locked=j,this.mediaStatus=k,this.lecturerId=l,this.lecturerName=m,this.presenterId=n,this.presenterName=o,this.recording=p,this.streaming=q,this.encrypted=r,this.moderatorPinNeeded=s,this.slidesAvailable=t,this.recorderAvailable=u,this.terminationTime=v}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeMeetingInfoResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingNoteResponse"),this.transId=b,this.responseCode=c,this.notes=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeMeetingNoteResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE),this.transId=b,this.responseCode=c,this.dialout=d,this.recording=e,this.lock=f,this.unmuteSelf=g,this.unmuteAll=h,this.sendFecc=i,this.allowVideo=j}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribePermissionsResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.UCCP.UCCPMessage.call(this,"subscribeRosterResponse"),this.transId=b,this.responseCode=c,this.fragmentation=d,this.participants=e}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeRosterResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,"subscribeSliderResponse"),this.transId=b,this.responseCode=c,this.slides=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeSliderResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j){a.Providers.UCCP.UCCPMessage.call(this,"subscribeWebCollabResponse"),this.transId=b,this.responseCode=c,this.webCollabUrl=d,this.token=i,this.participantId=h,this.meeting_id=f,this.mode=g,this.login=e,this.gsid=j}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeWebCollabResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"terminateMeetingResponse"),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPTerminateMeetingResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPUpdateCredentialsTokenResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPVideoPinResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT),this.webCollabUrl=b,this.token=c,this.participantId=d,this.meeting_id=e}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPWebCollabChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPActiveTalkerChangedEvent(b.params.participantId)}},a.Providers.UCCP.UCCPActiveTalkerChangedEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPAdmissionResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPAdmissionResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){return new b.Providers.UCCP.UCCPAvailableLayoutsChangedEvent(c.params.textOverlay?"true"===c.params.textOverlay:a,c.params.noSelfSee?"true"===c.params.noSelfSee:a,c.params.videoPin?"true"===c.params.videoPin:a,c.params.geometries,c.params.LPPOn?"true"===c.params.LPPOn:a)}},b.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPChangeLayoutGeometryResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){var c="";return a.Base.Utils.isDefined(b.params.time)&&(c=b.params.time),new a.Providers.UCCP.UCCPChatEvent(b.params.participantId,b.params.type,c,b.params.text)}},a.Providers.UCCP.UCCPChatEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPChatResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPChatResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){return new b.Providers.UCCP.UCCPCurrentLayoutChangedEvent(c.params.textOverlay?"true"===c.params.textOverlay:a,c.params.noSelfSee?"true"===c.params.noSelfSee:a,c.params.geometry,c.params.LPPOn?"true"===c.params.LPPOn:a)}},b.Providers.UCCP.UCCPCurrentLayoutChangedEventParser=c}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){return new b.Providers.UCCP.UCCPCurrentLayoutResponse(c.params.transId,c.params.responseCode,"true"===c.params.textOverlay,"true"===c.params.noSelfSee,c.params.geometry,c.params.LPPOn?"true"===c.params.LPPOn:a)}},b.Providers.UCCP.UCCPCurrentLayoutResponseParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDialInInfoResponse(b.params.transId,b.params.responseCode,b.params.webLink,b.params.streamingLink,b.params.dialInInformation,b.params.dialInInformationHtml)}},a.Providers.UCCP.UCCPDialInInfoResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDialoutCancelResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPDialoutCancelResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDialoutCompletedEvent(b.params.participantId,b.params.result)}},a.Providers.UCCP.UCCPDialoutCompletedEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDialoutResponse(b.params.transId,b.params.responseCode,b.params.participantId)}},a.Providers.UCCP.UCCPDialoutResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDisconnectEvent(b.params.reason)}},a.Providers.UCCP.UCCPDisconnectEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPDisconnectParticipantResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPDisconnectParticipantResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(a){return new AvayaClientServices.Providers.UCCP.UCCPExtendMeetingResponse(a.params.transId,a.params.responseCode)}},a.Providers.UCCP.UCCPExtendMeetingResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPFeccResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPFeccResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){var d=c.params.currentTime?new Date(Date.parse(c.params.currentTime)):a;return new b.Providers.UCCP.UCCPHandshakeResponse(c.params.transId,c.params.responseCode,c.params.version,c.params.participantId,"true"===c.params.externalAdmissionNeeded,"true"===c.params.admissionPasscodeNeeded,"true"===c.params.admissionPermissionNeeded,c.params.commands,d,c.params.longPollEmptyResponseTimeout,isNaN(parseInt(c.params.knockDoorTimeout))?a:parseInt(c.params.knockDoorTimeout))}},b.Providers.UCCP.UCCPHandshakeResponseParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPKeepAliveRequestEvent(b.params.transId)}},a.Providers.UCCP.UCCPKeepAliveRequestEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPLectureModeStartResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPLectureModeStartResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPLectureModeStopResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPLectureModeStopResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPLockMeetingResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPLockMeetingResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){var d=c.params.terminationTime?new Date(Date.parse(c.params.terminationTime)):a,e=c.params.locked?"true"===c.params.locked:a;return new b.Providers.UCCP.UCCPMeetingInfoChangedEvent(c.params.media,e,c.params.mediaStatus,c.params.lecturerId,c.params.lecturerName,c.params.presenterId,c.params.presenterName,c.params.recording,c.params.streaming?"enabled"===c.params.streaming:a,c.params.encrypted,"true"===c.params.slidesAvailable,d)}},b.Providers.UCCP.UCCPMeetingInfoChangedEventParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPMeetingTerminationInProgressEvent(b.params.reason,b.params.userName)}},a.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent(b.params.participantId,b.params.reason,b.params.anotherModerator)}},a.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPModeratorAdmissionEvent(b.params.participantId,b.params.name,b.params.userId)}},a.Providers.UCCP.UCCPModeratorAdmissionEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPModeratorAdmissionResponse(b.params.transId,b.params.responseCode,b.params.anotherModerator)}},a.Providers.UCCP.UCCPModeratorAdmissionResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPModeratorLowerHandResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPModeratorLowerHandResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPModeratorMuteResponse(b.params.transId,b.params.responseCode,"true"===b.params.audioMute,"true"===b.params.videoMute)}},a.Providers.UCCP.UCCPModeratorMuteResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPMuteAllResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPMuteAllResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){var c,d,e;return a.Base.Utils.isDefined(b.params.handRaised)&&(c="true"===b.params.handRaised),a.Base.Utils.isDefined(b.params.feccRecvSupport)&&(d="true"===b.params.feccRecvSupport),a.Base.Utils.isDefined(b.params.canLecture)&&(e="true"===b.params.canLecture),new a.Providers.UCCP.UCCPParticipantInfoChangedEvent(b.params.name,b.params.participantId,b.params.status,c,b.params.role,d,b.params.audioFromParticipant,b.params.audioToParticipant,b.params.videoFromParticipant,b.params.videoToParticipant,b.params.contentFromParticipant,b.params.contentToParticipant,b.params.userId,e)}},a.Providers.UCCP.UCCPParticipantInfoChangedEventParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){return new b.Providers.UCCP.UCCPParticipantJoinedEvent(c.params.participantId,c.params.name,c.params.userId,c.params.sourceID,c.params.status,"true"===c.params.handRaised,c.params.role,"true"===c.params.feccRecvSupport,c.params.audioFromParticipant,c.params.audioToParticipant,c.params.videoFromParticipant,c.params.videoToParticipant,c.params.contentFromParticipant,c.params.contentToParticipant,new Date(Date.parse(c.params.joinTime)),c.params.canLecture?"true"===c.params.canLecture:a,c.params.wasHidden)}},b.Providers.UCCP.UCCPParticipantJoinedEventParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPParticipantLeftEvent(b.params.participantId)}},a.Providers.UCCP.UCCPParticipantLeftEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPPermissionsChangedEvent(b.params.dialout,b.params.recording,b.params.lock,b.params.unmuteSelf,b.params.unmuteAll,b.params.sendFecc,b.params.allowVideo)}},a.Providers.UCCP.UCCPPermissionsChangedEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPRaiseHandResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPRaiseHandResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPRecordingFailedEvent}},a.Providers.UCCP.UCCPRecordingFailedEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPRecordingResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPRecordingResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPStartModerationResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPStartModerationResponseParser=b;
}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPSubscribeActiveTalkerResponse(b.params.transId,b.params.responseCode,b.params.participantId)}},a.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(c){return new b.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse(c.params.transId,c.params.responseCode,"true"===c.params.textOverlay,"true"===c.params.noSelfSee,"true"===c.params.videoPin,c.params.geometries,c.params.LPPOn?"true"===c.params.LPPOn:a)}},b.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){var c=new Date(Date.parse(b.params.terminationTime));return new a.Providers.UCCP.UCCPSubscribeMeetingInfoResponse(b.params.transId,b.params.responseCode,b.params.meetingId,b.params.meetingName,b.params.virtualRoomName,b.params.virtualRoomOwnerId,b.params.media,"true"===b.params.eventConference,"true"===b.params.locked,b.params.mediaStatus,b.params.lecturerId,b.params.lecturerName,b.params.presenterId,b.params.presenterName,b.params.recording,"enabled"===b.params.streaming,b.params.encrypted,"true"===b.params.moderatorPinNeeded,"true"===b.params.slidesAvailable,b.params.recorderAvailable,c)}},a.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){var c=b.params.notes.map(function(a){return{participantId:a.participantId,participantDisplayName:a.participantDisplayName,noteId:a.noteId,text:a.text,time:new Date(Date.parse(a.time))}});return new a.Providers.UCCP.UCCPSubscribeMeetingNoteResponse(b.params.transId,b.params.responseCode,c)}},a.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPSubscribePermissionsResponse(b.params.transId,b.params.responseCode,b.params.dialout,b.params.recording,b.params.lock,b.params.unmuteSelf,b.params.unmuteAll,b.params.sendFecc,b.params.allowVideo)}},a.Providers.UCCP.UCCPSubscribePermissionsResponseParser=b}(AvayaClientServices),function(b){"use strict";function c(){}c.prototype={parse:function(a){var c=a.params.participants.map(function(a){return this._buildActiveParticipant(a)}.bind(this));return new b.Providers.UCCP.UCCPSubscribeRosterResponse(a.params.transId,a.params.responseCode,a.params.fragmentation,c)},_buildActiveParticipant:function(b){var c,d,e,f={},g="";return f.participantId=b.participantId,f.participantName=b.name,f.userId=b.userId,b.joinTime&&(d=new RegExp(/(\d{2}:\d{2}:\d{2})\s(\d{2})-(\d{2})-(\d{4})\s(-?\+?\d{4})/),e=new RegExp(/(\d{4}-\d{2}-\d{2})[a-zA-Z](\d{2}:\d{2}:\d{2})(-?\+?\d{2}:\d{2})/),d.test(b.joinTime)?g=(c=d.exec(b.joinTime))[4]+"-"+c[3]+"-"+c[2]+" "+c[1]+" GMT"+c[5]:e.test(b.joinTime)&&(g=b.joinTime),g&&(f.joinTime=new Date(Date.parse(g)))),f.sourceID=b.sourceID,f.status=b.status,f.handRaised="true"===b.handRaised,f.role=b.role,f.feccRecvSupport="true"===b.feccRecvSupport,f.audioFromParticipant=b.audioFromParticipant,f.audioToParticipant=b.audioToParticipant,f.videoFromParticipant=b.videoFromParticipant,f.videoToParticipant=b.videoToParticipant,f.contentFromParticipant=b.contentFromParticipant,f.contentToParticipant=b.contentToParticipant,f.canLecture=b.canLecture?"true"===b.canLecture:a,f}},b.Providers.UCCP.UCCPSubscribeRosterResponseParser=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPSubscribeSliderResponse(b.params.transId,b.params.responseCode,b.params.slides)}},a.Providers.UCCP.UCCPSubscribeSliderResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPSubscribeWebCollabResponse(b.params.transId,b.params.responseCode,b.params.webCollabUrl,b.params.login,b.params.meeting_id,b.params.mode,b.params.participantId,b.params.token,b.params.gsid)}},a.Providers.UCCP.UCCPSubscribeWebCollabResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPTerminateMeetingResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPTerminateMeetingResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPUpdateCredentialsTokenResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPVideoPinResponse(b.params.transId,b.params.responseCode)}},a.Providers.UCCP.UCCPVideoPinResponseParser=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(b){return new a.Providers.UCCP.UCCPWebCollabChangedEvent(b.params.webCollabUrl,b.params.token,b.params.participantId,b.params.meeting_id)}},a.Providers.UCCP.UCCPWebCollabChangedEventParser=b}(AvayaClientServices),function(a){"use strict";function b(){}var c=a.Base.Storage,d="JSCSDK_UCCP_ClientId";b.prototype={buildHandshakeRequest:function(b){var c=new Date,d=-c.getTimezoneOffset(),e=0<=d?"+":"-",d=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2)+"T"+("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2)+e+("0"+parseInt(Math.abs(d/60))).slice(-2)+":"+("0"+Math.abs(d%60)).slice(-2),d={clientId:this._getClientID(),transId:b.toString(),clientType:"Web Client",clientUserAgent:navigator.userAgent,version:"1.0",features:[{featureName:"passcode",version:"1.0"},{featureName:"knockOnTheDoorParticipant",version:"1.0"},{featureName:"knockOnTheDoorModerator",version:"1.0"}],currentTime:d};return this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_REQUEST,d)},buildSubscribeMeetingInfoRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_REQUEST,b)},buildSubscribeSliderRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_SLIDER_REQUEST,b)},buildSubscribeActiveTalkerRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_REQUEST,b)},buildSubscribePermissionsRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_REQUEST,b)},buildSubscribeMeetingNoteRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_REQUEST,b)},buildSubscribeRosterRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_REQUEST,b)},buildSubscribeWebCollabRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_REQUEST,b)},buildSubscribeAvailableLayoutsRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST,b)},buildSetAsLecturerRequest:function(b,c){return c={transId:b.toString(),participantId:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_REQUEST,c)},buildUnsetAsLecturerRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_REQUEST,b)},buildMuteAllRequest:function(b,c){return c={transId:b.toString(),audioMute:c.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_REQUEST,c)},buildModeratorMuteRequest:function(b,c,d,e){return e={transId:b.toString(),participantId:c,mediaType:d,mute:e.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_REQUEST,e)},buildFeccRequest:function(b,c,d){return d={transId:b.toString(),participantId:c,action:d.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.FECC_REQUEST,d)},buildDisconnectParticipantRequest:function(b,c){return c={transId:b.toString(),participantId:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_REQUEST,c)},buildLocalMuteEvent:function(b,c,d){return d={transId:b.toString(),participantId:c,audioMute:d.toString(),videoMute:"false"},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.LOCAL_MUTE_EVENT,d)},buildDisconnectEvent:function(b,c){return c={transId:b.toString(),reason:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,c)},buildTerminateMeetingRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_REQUEST,b)},buildStartModerationRequest:function(b,c){return b={transId:b.toString()},a.Base.Utils.isDefined(c)&&(b.pin=c),this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.START_MODERATION_REQUEST,b)},buildUpdateCredentialsTokenRequest:function(b,c){return c={transId:b.toString(),token:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_REQUEST,c)},buildDialoutRequest:function(b,c){return c={transId:b.toString(),dialTo:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_REQUEST,c)},buildCancelDialoutRequest:function(b,c){return c={transId:b.toString(),participantId:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_REQUEST,c)},buildSendChatMessage:function(b,c,d){return d={transId:b.toString(),text:c.toString(),participantId:d||"public"},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CHAT_REQUEST,d)},buildExtendMeetingRequest:function(b,c){return c={transId:b.toString(),additionalTimeInMinutes:c.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_REQUEST,c)},buildLockMeetingRequest:function(b,c){return c={transId:b.toString(),lock:c.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_REQUEST,c)},buildCurrentLayoutRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_REQUEST,b)},buildChangeLayoutGeometryRequest:function(b,c){return c={transId:b.toString(),geometry:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_REQUEST,c)},buildChangeLayoutTextOverlayRequest:function(b,c){return c={transId:b.toString(),textOverlay:c.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_REQUEST,c)},buildChangeLayoutNoSelfSeeRequest:function(b,c){return c={transId:b.toString(),enableNoSelfSee:c.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_REQUEST,c)},buildSetRecordingRequest:function(b,c,d,e){return c={transId:b.toString(),recording:c},a.Base.Utils.isDefined(d)&&(c.name=d),a.Base.Utils.isDefined(e)&&(c.description=e),this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,c)},buildVideoPinRequest:function(b,c,d,e,f,g){return g={transId:b.toString(),destXCord:f.toString(),destYCord:g.toString()},a.Base.Utils.isDefined(c)?g.sourceParticipantId=c:a.Base.Utils.isDefined(d)&&a.Base.Utils.isDefined(e)&&(g.sourceXCord=d.toString(),g.sourceYCord=e.toString()),this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_REQUEST,g)},buildRaiseHandRequest:function(b,c){return c={transId:b.toString(),action:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_REQUEST,c)},buildModeratorLowerHandRequest:function(b,c,d){return d={transId:b.toString(),participantId:c.toString(),unmuteAudio:d.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_REQUEST,d)},buildAdmissionRequest:function(b,c){return b={transId:b.toString()},a.Base.Utils.isDefined(c)&&(b.passcode=c),this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.ADMISSION_REQUEST,b)},buildModeratorAdmissionRequest:function(b,c,d){return d={transId:b.toString(),participantId:c,action:d},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_REQUEST,d)},buildDialInInfoRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_REQUEST,b)},buildKeepaliveRequest:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,b)},buildKeepAliveResponse:function(b){return b={transId:b.toString()},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_RESPONSE,b)},_getClientID:function(){var b=c.get(c.TYPES.LOCAL,d);return a.Base.Utils.isUndefined(b)&&(b=a.Base.Utils.generateUUID(),c.set(c.TYPES.LOCAL,d,b)),b},_wrapParams:function(a,b){return{protocolType:"UCCP",name:a,params:b}},buildChangeParticipantNameRequest:function(b,c,d){return c={transId:b.toString(),participantName:d,participantId:c},this._wrapParams(a.Providers.UCCP.UCCPMessageTypes.CHANGE_PARTICIPANT_NAME_REQUEST,c)}},a.Providers.UCCP.UCCPMessageBuilder=b}(AvayaClientServices),function(a){"use strict";function b(){this._parsers={}}b.prototype={parse:function(a){return this._parsers[a.name]?this._parsers[a.name].parse(a):a},register:function(a,b){this._parsers[a]=b}},a.Providers.UCCP.UCCPMessageParser=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessageTypes={HANDSHAKE_REQUEST:"handshakeRequest",HANDSHAKE_RESPONSE:"handshakeResponse",SUBSCRIBE_MEETING_INFO_REQUEST:"subscribeMeetingInfoRequest",SUBSCRIBE_MEETING_INFO_RESPONSE:"subscribeMeetingInfoResponse",SUBSCRIBE_ROSTER_REQUEST:"subscribeRosterRequest",SUBSCRIBE_ROSTER_RESPONSE:"subscribeRosterResponse",SUBSCRIBE_ACTIVE_TALKER_REQUEST:"subscribeActiveTalkerRequest",SUBSCRIBE_ACTIVE_TALKER_RESPONSE:"subscribeActiveTalkerResponse",SUBSCRIBE_PERMISSIONS_REQUEST:"subscribePermissionsRequest",SUBSCRIBE_PERMISSIONS_RESPONSE:"subscribePermissionsResponse",SUBSCRIBE_SLIDER_REQUEST:"subscribeSliderInfoRequest",SUBSCRIBE_SLIDER_RESPONSE:"subscribeSliderInfoResponse",SUBSCRIBE_MEETING_NOTE_REQUEST:"subscribeMeetingNoteRequest",SUBSCRIBE_MEETING_NOTE_RESPONSE:"subscribeMeetingNoteResponse",SUBSCRIBE_WEB_COLLAB_REQUEST:"subscribeWebCollabRequest",SUBSCRIBE_WEB_COLLAB_RESPONSE:"subscribeWebCollabResponse",SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"subscribeAvailableLayoutsRequest",SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"subscribeAvailableLayoutsResponse",START_MODERATION_REQUEST:"startModerationRequest",START_MODERATION_RESPONSE:"startModerationResponse",TERMINATE_MEETING_REQUEST:"terminateMeetingRequest",TERMINATE_MEETING_RESPONSE:"terminateMeetingResponse",DIRECTORY_LOOKUP_REQUEST:"directoryLookupRequest",DIRECTORY_LOOKUP_NOTE_RESPONSE:"directoryLookupResponse",DIAL_IN_INFO_REQUEST:"dialInInfoRequest",DIAL_IN_INFO_RESPONSE:"dialInInfoResponse",DIALOUT_REQUEST:"dialoutRequest",DIALOUT_RESPONSE:"dialoutResponse",DIALOUT_CANCEL_REQUEST:"dialoutCancelRequest",DIALOUT_CANCEL_RESPONSE:"dialoutCancelResponse",DISCONNECT_PARTICIPANT_REQUEST:"disconnectParticipantRequest",DISCONNECT_PARTICIPANT_RESPONSE:"disconnectParticipantResponse",LECTURE_MODE_START_REQUEST:"lectureModeStartRequest",LECTURE_MODE_START_RESPONSE:"lectureModeStartResponse",LECTURE_MODE_STOP_REQUEST:"lectureModeStopRequest",LECTURE_MODE_STOP_RESPONSE:"lectureModeStopResponse",RECORDING_REQUEST:"recordingRequest",RECORDING_RESPONSE:"recordingResponse",LOCK_MEETING_REQUEST:"lockMeetingRequest",LOCK_MEETING_RESPONSE:"lockMeetingResponse",EXTEND_MEETING_REQUEST:"extendMeetingRequest",EXTEND_MEETING_RESPONSE:"extendMeetingResponse",MUTE_ALL_REQUEST:"muteAllRequest",MUTE_ALL_RESPONSE:"muteAllResponse",MODERATOR_MUTE_REQUEST:"moderatorMuteRequest",MODERATOR_MUTE_RESPONSE:"moderatorMuteResponse",RAISE_HAND_REQUEST:"raiseHandRequest",RAISE_HAND_RESPONSE:"raiseHandResponse",MODERATOR_LOWER_HAND_REQUEST:"moderatorLowerHandRequest",MODERATOR_LOWER_HAND_RESPONSE:"moderatorLowerHandResponse",CURRENT_LAYOUT_REQUEST:"currentLayoutRequest",CURRENT_LAYOUT_RESPONSE:"currentLayoutResponse",CHANGE_LAYOUT_GEOMETRY_REQUEST:"changeLayoutGeometryRequest",CHANGE_LAYOUT_GEOMETRY_RESPONSE:"changeLayoutGeometryResponse",CHANGE_LAYOUT_NO_SELF_SEE_REQUEST:"changeLayoutNoSelfSeeRequest",CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE:"changeLayoutNoSelfSeeResponse",VIDEO_PIN_REQUEST:"videoPinRequest",VIDEO_PIN_RESPONSE:"videoPinResponse",FECC_REQUEST:"feccRequest",FECC_RESPONSE:"feccResponse",CHANGE_LAYOUT_OVERLAY_REQUEST:"changeLayoutTextOverlayRequest",CHANGE_LAYOUT_OVERLAY_RESPONSE:"changeLayoutTextOverlayResponse",CHAT_REQUEST:"chatRequest",CHAT_RESPONSE:"chatResponse",ADD_MEETING_NOTE_REQUEST:"addMeetingNoteRequest",ADD_MEETING_NOTE_RESPONSE:"addMeetingNoteResponse",UPDATE_MEETING_NOTE_REQUEST:"updateMeetingNoteRequest",UPDATE_MEETING_NOTE_RESPONSE:"updateMeetingNoteResponse",DELETE_MEETING_NOTE_REQUEST:"deleteMeetingNoteRequest",DELETE_MEETING_NOTE_RESPONSE:"deleteMeetingNoteResponse",LOGGING_REQUEST:"loggingRequest",LOGGING_RESPONSE:"loggingResponse",ADMISSION_REQUEST:"admissionRequest",ADMISSION_RESPONSE:"admissionResponse",MODERATOR_ADMISSION_REQUEST:"moderatorAdmissionRequest",MODERATOR_ADMISSION_RESPONSE:"moderatorAdmissionResponse",MOBILE_LINK_ID_REQUEST:"mobileLinkIdRequest",MOBILE_LINK_ID_RESPONSE:"mobileLinkIdResponse",MOBILE_LINK_ROOM_SYSTEM_LIST_REQUEST:"mobileLinkRoomSystemListRequest",MOBILE_LINK_ROOM_SYSTEM_LIST_RESPONSE:"mobileLinkRoomSystemListResponse",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkChooseRoomSystemRequest",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkChooseRoomSystemResponse",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkManualChooseRoomSystemRequest",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkManualChooseRoomSystemResponse",MOBILE_LINK_DISCONNECT_REQUEST:"mobileLinkDisconnectRequest",MOBILE_LINK_DISCONNECT_RESPONSE:"mobileLinkDisconnectResponse",UPDATE_CREDENTIALS_TOKEN_REQUEST:"updateCredentialsTokenRequest",UPDATE_CREDENTIALS_TOKEN_RESPONSE:"updateCredentialsTokenResponse",UNSUBSCRIBE_MEETING_INFO_REQUEST:"unsubscribeMeetingInfoRequest",UNSUBSCRIBE_MEETING_INFO_RESPONSE:"unsubscribeMeetingInfoResponse",UNSUBSCRIBE_ROSTER_REQUEST:"unsubscribeRosterRequest",UNSUBSCRIBE_ROSTER_RESPONSE:"unsubscribeRosterResponse",UNSUBSCRIBE_SLIDER_REQUEST:"unsubscribeSliderInfoRequest",UNSUBSCRIBE_SLIDER_RESPONSE:"unsubscribeSliderInfoResponse",UNSUBSCRIBE_ACTIVE_TALKER_REQUEST:"unsubscribeActiveTalkerRequest",UNSUBSCRIBE_ACTIVE_TALKER_RESPONSE:"unsubscribeActiveTalkerResponse",UNSUBSCRIBE_PERMISSIONS_REQUEST:"unsubscribePermissionsRequest",UNSUBSCRIBE_PERMISSIONS_RESPONSE:"unsubscribePermissionsResponse",UNSUBSCRIBE_MEETING_NOTE_REQUEST:"unsubscribeMeetingNoteRequest",UNSUBSCRIBE_MEETING_NOTE_RESPONSE:"unsubscribeMeetingNoteResponse",UNSUBSCRIBE_WEB_COLLAB_REQUEST:"unsubscribeWebCollabRequest",UNSUBSCRIBE_WEB_COLLAB_RESPONSE:"unsubscribeWebCollabResponse",UNSUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"unsubscribeAvailableLayoutsRequest",UNSUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"unsubscribeAvailableLayoutsResponse",KEEPALIVE_REQUEST:"keepaliveRequest",KEEPALIVE_RESPONSE:"keepaliveResponse",CHANGE_PARTICIPANT_NAME_REQUEST:"changeParticipantNameRequest",PARTICIPANT_JOINED_EVENT:"participantJoinedEvent",PARTICIPANT_LEFT_EVENT:"participantLeftEvent",ACTIVE_TALKER_CHANGED_EVENT:"activeTalkerChangedEvent",PERMISSIONS_CHANGED_EVENT:"permissionsChangedEvent",CHAT_EVENT:"chatEvent",MEETING_NOTE_ADDED_EVENT:"meetingNoteAddedEvent",MEETING_NOTE_UPDATED_EVENT:"meetingNoteUpdatedEvent",MEETING_NOTE_DELETED_EVENT:"meetingNoteDeletedEvent",LOGGING_EVENT:"loggingEvent",MEETING_INFO_CHANGED_EVENT:"meetingInfoChangedEvent",MEETING_TERMINATION_IN_PROGRESS_EVENT:"meetingTerminationInProgressEvent",NEW_SLIDE_EVENT:"newSlideEvent",PARTICIPANT_INFO_CHANGED_EVENT:"participantInfoChangedEvent",USER_MOVED_EVENT:"userMovedEvent",DIALOUT_COMPLETED_EVENT:"dialoutCompletedEvent",LOCAL_MUTE_EVENT:"localMuteEvent",AVAILABLE_LAYOUTS_CHANGED_EVENT:"availableLayoutsChangedEvent",CURRENT_LAYOUT_CHANGED_EVENT:"currentLayoutChangedEvent",RECORDING_FAILED_EVENT:"recordingFailedEvent",MODERATOR_ADMISSION_EVENT:"moderatorAdmissionEvent",MODERATOR_ADMISSION_CANCELED_EVENT:"moderatorAdmissionCanceledEvent",WEB_COLLAB_CHANGED_EVENT:"webCollabChangedEvent",DISCONNECT_EVENT:"disconnectEvent"}}(),function(a){"use strict";function c(a,b,c){this._networkProvider=a,this._messageBuilder=b,this._messageParser=c,this._uccpProvider={}}c.prototype={getUCCPProvider:function(){var c;return b.isEmptyObject(this._uccpProvider)&&(c=this._createUCCP1Provider(),this._uccpProvider=new a.Providers.UCCP.UCCPProvider,this._uccpProvider.registerUCCPProvider(1,c)),this._uccpProvider},_createUCCP1Provider:function(){return new a.Providers.UCCP.UCCP1Provider(this._networkProvider,this._messageBuilder,this._messageParser)}},a.Providers.UCCP.UCCPProviderFactory=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={_validateTagLength:function(b,c){var d=0;switch(c){case a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:case a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:d=14;break;case a.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG:d=13;break;case a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:d=1;break;case a.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG:d=5}return d<=b||(a.Base.Logger.warn(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Byte array size: {0} < Min Tag length: {1} Tag type: {2}",b,d,c),!1)},_get64bitNumber:function(a){return a=a.readBytes(8),4294967296*a.readUnsignedInt()+a.readUnsignedInt()}},a.Providers.WCS.AbstractBinaryParser=b}(AvayaClientServices),function(b){"use strict";function c(){}(c.prototype=Object.create(b.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(c){var d=c.byteArray,c=c.id;return this._validateTagLength(d.length,b.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG)?(d=new b.Providers.WCS.ScreenSharingAcknowledgementTag,d.messageId=c,d):a},b.Providers.WCS.AcknowledgementTagBinaryParser=c}(AvayaClientServices),function(b){"use strict";function c(){}(c.prototype=Object.create(b.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(c){var d=c.byteArray;if(!this._validateTagLength(d.length,b.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG))return a;if(c=new b.Providers.WCS.ScreenSharingBlockTag,c.width=d.readShort(),c.height=d.readShort(),c.x=d.readShort(),c.y=d.readShort(),c.imageType=d.readByte(),c.length=d.readInt(),c.length===d.getBytesAvailable())c.data=d.readBytes(c.length);else{if(c.length+4!==d.getBytesAvailable())return b.Base.Logger.error(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Invalid type "+b.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG+". Tried to read: "+c.length+". BytesAvailable "+d.getBytesAvailable()),a;d.readInt(),c.data=d.readBytes(c.length)}return c},b.Providers.WCS.BlockTagBinaryParser=c}(AvayaClientServices),function(b){"use strict";function c(){}(c.prototype=Object.create(b.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(c){var d=c.byteArray;return this._validateTagLength(d.length,b.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG)?(c=new b.Providers.WCS.ScreenSharingCursorTag,c.x=d.readShort(),c.y=d.readShort(),c.creationTime=this._get64bitNumber(d),c):a},b.Providers.WCS.CursorTagBinaryParser=c}(AvayaClientServices),function(b){"use strict";function c(){}(c.prototype=Object.create(b.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(c){return c=c.byteArray,this._validateTagLength(c.length,b.Providers.WCS.WCSScreenSharingTagTypes.END_TAG)?new b.Providers.WCS.ScreenSharingEndTag:a},b.Providers.WCS.EndTagBinaryParser=c}(AvayaClientServices),function(b){"use strict";function c(){}(c.prototype=Object.create(b.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(c){var d=c.byteArray;return this._validateTagLength(c.byteArray.length,b.Providers.WCS.WCSScreenSharingTagTypes.START_TAG)?(c=new b.Providers.WCS.ScreenSharingStartTag,c.isKeyFrame=Boolean(d.readByte()),c.width=d.readShort(),c.height=d.readShort(),c.creationTime=this._get64bitNumber(d),d=(new Date).getTime(),b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Start Tag [keyframe={0}]: {1}x{2} isKeyFrame: "+c.isKeyFrame+". width: "+c.width+". height: "+c.height+". creationTime: "+c.creationTime+". TimeDiff: "+(d-c.creationTime)),c):a},b.Providers.WCS.StartTagBinaryParser=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.AbstractEvent=function(a){this.type=a}}(),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractEvent.call(this,b),c&&(this.from=c.from,this.fromname=c.fromname,this.eventId=c.eventId,this.senderId=c.senderId,this.senderName=c.senderName,this.time=c.time,this.useragent=c.useragent,this.wsConnectionId=c.wsConnectionId,this.data={})}(b.prototype=Object.create(a.Providers.WCS.AbstractEvent)).isServerInitiated=function(){return"Web Collaboration Server"===this.from},a.Providers.WCS.AbstractLiveEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.ADD_NOTE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.AddNoteEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e){this.noteType=a,this.text=b,this.meetingOwner=c,this.isPersonal=d,e&&(this.targetId=e)}b.prototype={},a.Providers.WCS.AddNoteEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.AddWhiteboardEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.AllowPresentingEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.targetId=a,this.targetName=b}b.prototype={},a.Providers.WCS.AllowPresentingEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.CLEAR_DRAWING),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.ClearDrawingEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.groupId=a,this.layerType=b}b.prototype={},a.Providers.WCS.ClearDrawingEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DELETE_NOTE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DeleteNoteEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.noteId=a}b.prototype={},a.Providers.WCS.DeleteNoteEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DELETE_SELECTION),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DeleteSelectionEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e){this.groupId=a,this.layerType=b,this.shapeId=c,this.selectionX=d,this.selectionY=e}b.prototype={},a.Providers.WCS.DeleteSelectionEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DeleteWhiteboardEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.id=a}b.prototype={},a.Providers.WCS.DeleteWhiteboardEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.REQUEST_CONTROL),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DenyControlEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DENY_PRESENTING),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DenyPresentingEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.targetId=a,this.targetName=b}b.prototype={},a.Providers.WCS.DenyPresentingEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DRAW_CIRCLE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DrawCircleEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j,k,l){this.alpha=a,b&&(this.fillColor=b),c&&(this.color=c),k&&(this.filled=k),l&&(this.contour=l),this.groupId=d,this.layerType=e,this.width=f,this.x0=g,this.x1=h,this.y0=i,this.y1=j}b.prototype={},a.Providers.WCS.DrawCircleEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DRAW_SHAPE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DrawShapeEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j){a&&(this.alpha=a),b&&(this.fillColor=b),c&&(this.color=c),d&&(this.groupId=d),e&&(this.layerType=e),!f&&0!==f||(this.width=f),!g&&0===g.length||(this.l=g),!h&&0===h.length||(this.m=h),j&&(this.contour=j),i&&(this.filled=i)}b.prototype={},a.Providers.WCS.DrawShapeEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.DRAW_TEXT),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.DrawTextEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g){this.fillColor=a,this.fontSize=b,this.groupId=c,this.layerType=d,this.text=e||"",this.x=f,this.y=g}b.prototype={},a.Providers.WCS.DrawTextEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EjectParticipantEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this.targetId=a,this.targetName=b,this.targetParticipantId=c,this.time=d}b.prototype={},a.Providers.WCS.EjectParticipantEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_CONTROL),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndControlEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndDrawShapeEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.groupId=a,this.layerType=b}b.prototype={},a.Providers.WCS.EndDrawShapeEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_MEETING),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndMeetingEvent=b;
}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,b)}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndScreenSharingEvent=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,b)}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndVideoSharingEvent=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.END_WHITEBOARD),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.EndWhiteboardEvent=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.ERROR),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.ErrorEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this.code=a,this.message=b,this.requestId=c,this.wsConnectionId=d}b.prototype={},a.Providers.WCS.ErrorEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.FRAME_REPORT),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.FrameReportEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f){this.droppedFrames=a,this.droppedFramesPercentageRounded=b,this.period=c,this.successfulFrames=d,this.timeEnd=e,this.timeStart=f}b.prototype={},a.Providers.WCS.FrameReportEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.GRANT_CONTROL),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.GrantControlEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.osType=a}b.prototype={},a.Providers.WCS.GrantControlEventData=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g,h){this.attendeeId=a,this.clientVersion=b,this.privateChatSupported=c,this.startTime=d,this.userAgent=e,this.userIp=f,this.userName=g,this.wsConnectionId=h}b.prototype={},a.Providers.WCS.LiveAttendeeEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.LiveAttendeesEvent=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.LiveCapabilitiesEvent=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={},a.Providers.WCS.LiveCapabilitiesEventData=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.LiveEventCommonData=function(a,b,c,d,e,f,g,h,i){this.from=a,this.fromname=b,this.eventId=c,this.senderId=d,this.senderName=e,this.time=f,this.type=g,this.useragent=h,this.wsConnectionId=i}}(),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.LIVE_SESSION),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.LiveSessionEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g){this.requestId=a,this.idleTimeout=b,this.serverTimeDiff=c,this.wsConnectionId=d,this.meeting=e,this.liveAttendee=f,this.features=g}b.prototype={},a.Providers.WCS.LiveSessionEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.LIVE_VIEWER),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.LiveViewerEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j,k,l,m){this.brandId=a,this.wcsVersion=b,this.websocketPath=c,this.websocketCacheSize=d,this.uploadSize=e,this.uploadMaxImageSize=f,this.uploadMaxImageResolution=g,this.uploadTypes=h,this.maxDuration=i,this.eventWaitTime=j,this.uploadMaxFile=k,this.themesLocation=l,this.internalUiControls=m}b.prototype={},a.Providers.WCS.LiveViewerEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.MOVE_SELECTION),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.MoveSelectionEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g){this.groupId=a,this.layerType=b,this.shapeId=c,this.moveToX=d,this.moveToY=e,this.selectionX=f,this.selectionY=g}b.prototype={},a.Providers.WCS.MoveSelectionEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,b)}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.PauseScreenSharingEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SEND_DOCUMENT),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SendDocumentEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c){this.filename=a,this.filesize=b,this.fileurl=c}b.prototype={},a.Providers.WCS.SendDocumentEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SEND_MESSAGE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SendMessageEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this.message=a,this.targetName=b,this.isPrivate=c,d&&(this.targetId=d)}b.prototype={},a.Providers.WCS.SendMessageEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SEND_SLIDE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SendSlideEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f,g,h){this.count=a,this.index=b,this.title=c,this.presentationId=d,this.slideUrl=e,this.slideBaseUrl=f,this.tocUrl=g,this.includeToc=h}b.prototype={},a.Providers.WCS.SendSlideEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractEvent.call(this,a.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES),this.data=b}b.prototype=Object.create(a.Providers.WCS.AbstractEvent.prototype),a.Providers.WCS.ServerCapabilitiesEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.maxHeight=a,this.maxWidth=b}b.prototype={},a.Providers.WCS.ServerCapabilitiesEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SET_NOTE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SetNoteEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f){this.noteId=a,this.noteType=b,this.text=c,this.attendeeId=d,this.isPersonal=e,f&&(this.targetId=f)}b.prototype={},a.Providers.WCS.SetNoteEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SLIDER_EMPTY),this.liveEventCommonData=b}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SliderEmptyEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.SLIDER_SLIDE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.SliderSlideEvent=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this.slideURL=a,this.thumbUrl=b}b.prototype={},a.Providers.WCS.SliderSlideEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.StartDrawShapeEvent=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.StartDrawShapeEventData=function(a,b,c,d,e){this.alpha=a,this.color=b,this.groupId=c,this.layerType=d,this.width=e}}(),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.START_MEETING),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.StartMeetingEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.userkey=a}b.prototype={},a.Providers.WCS.StartMeetingEventData=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,b),this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.StartScreenSharingEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.transportVersion=a}b.prototype={},a.Providers.WCS.StartScreenSharingEventData=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,b)}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.StartVideoSharingEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.WCS.AbstractLiveEvent.call(this,a.Providers.WCS.WCSEventTypes.START_WHITEBOARD),this.liveEventCommonData=b,this.data=c}b.prototype=Object.create(a.Providers.WCS.AbstractLiveEvent.prototype),a.Providers.WCS.StartWhiteboardEvent=b}(AvayaClientServices),function(a){"use strict";function b(a){this.id=a}b.prototype={},a.Providers.WCS.StartWhiteboardEventData=b}(AvayaClientServices),function(b){"use strict";function c(){this.lastStartScreenSharingWsId="",this.latestKeyEvents={sharing:a,slider:a}}c.prototype={getOptimizedQueue:function(c){var d=[];if(c.length<=1)d=c;else{for(var e=c.length-1;0<=e;e--){var f=c[e];this.isEventValid(f)?(c[e].type!==b.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&c[e].type!==b.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||c[e].wsConnectionId!==this.lastStartScreenSharingWsId)&&d.push(f):b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Event is not relevant: ",f.type)}d.reverse()}for(var g=0;g<=d.length-1;g++)d[g].type!==b.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&d[g].type!==b.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||(this.lastStartScreenSharingWsId=d[g].wsConnectionId);return this.latestKeyEvents={sharing:a,videoSharing:a,slider:a},d},isEventValid:function(a){return this.isStartContentSharingEvent(a)?this.isStartSharingEventValid(a):this.isEndContentSharingEvent(a)?this.isEndSharingEventValid(a):this.isStartContentVideoSharingEvent(a)?this.isStartVideoSharingEventValid(a):this.isEndContentVideoSharingEvent(a)?this.isEndVideoSharingEventValid(a):this.isMidSharingEvent(a)?this.isMidSharingEventValid():this.isSliderEvent(a)?this.isSliderEventValid():!this.isEmptySliderEvent(a)||this.isEmptySliderEventValid(a)},isStartContentSharingEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING},isEndContentSharingEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING||a.type===b.Providers.WCS.WCSEventTypes.END_PRESENTATION},isStartContentVideoSharingEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING},isEndContentVideoSharingEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING},isMidSharingEvent:function(a){switch(a.type){case b.Providers.WCS.WCSEventTypes.REQUEST_CONTROL:case b.Providers.WCS.WCSEventTypes.GRANT_CONTROL:case b.Providers.WCS.WCSEventTypes.DECLINE_CONTROL:case b.Providers.WCS.WCSEventTypes.DENY_CONTROL:case b.Providers.WCS.WCSEventTypes.START_CONTROL:case b.Providers.WCS.WCSEventTypes.END_CONTROL:case b.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING:case b.Providers.WCS.WCSEventTypes.DENY_PRESENTING:case b.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING:case b.Providers.WCS.WCSEventTypes.SEND_SLIDE:return!0;default:return!1}},isSliderEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.SLIDER_SLIDE},isEmptySliderEvent:function(a){return a.type===b.Providers.WCS.WCSEventTypes.SLIDER_EMPTY},isStartSharingEventValid:function(a){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=a,!0)},isEndSharingEventValid:function(a){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=a,!0)},isStartVideoSharingEventValid:function(a){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=a,!0)},isEndVideoSharingEventValid:function(a){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=a,!0)},isMidSharingEventValid:function(){return!this.latestKeyEvents.sharing},isEmptySliderEventValid:function(a){return this.latestKeyEvents.slider||(this.latestKeyEvents.slider=a),!1},isSliderEventValid:function(){return!this.latestKeyEvents.slider}},b.Providers.WCS.LiveEventQueueOptimizer=c}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={parse:function(a){throw new Error("Method not implemented!")},colorHexToInt:function(a){return parseInt("0x".concat(a.slice(1))).toString()},stringToCamel:function(a){return a.replace(/(_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})}},a.Providers.WCS.AbstractParser=b}(AvayaClientServices),function(c){"use strict";function d(){this._onMessageParsedCallbacks=b.Callbacks(),this.msgHeaderDetails={headerSize:8,msgSize:3,flagSize:1,lengthIndicatorSize:4,msgTxt:"msg",textFlagValue:128},this._activeMsg=a}d.prototype.parse=function(a){var b;a instanceof ArrayBuffer&&0<(b=a.byteLength)&&this._extractDataFromMsg(0,a,b)},d.prototype.addOnMessageParsedCallback=function(a){this._onMessageParsedCallbacks.add(a)},d.prototype.removeOnMessageParsedCallback=function(a){this._onMessageParsedCallbacks.remove(a)},d.prototype._parseToString=function(a){for(var b=new Uint8Array(a),c="",d=0;d<b.length;d++)c+=String.fromCharCode(b[d]);return c},d.prototype._utf8Decoder=function(a){for(var b,c=new Uint8Array(a),d="",e=c.length,f=0;f<e;f++)b=c[f],d+=String.fromCharCode(251<b&&b<254&&f+5<e?1073741824*(b-252)+(c[++f]-128<<24)+(c[++f]-128<<18)+(c[++f]-128<<12)+(c[++f]-128<<6)+c[++f]-128:247<b&&b<252&&f+4<e?(b-248<<24)+(c[++f]-128<<18)+(c[++f]-128<<12)+(c[++f]-128<<6)+c[++f]-128:239<b&&b<248&&f+3<e?(b-240<<18)+(c[++f]-128<<12)+(c[++f]-128<<6)+c[++f]-128:223<b&&b<240&&f+2<e?(b-224<<12)+(c[++f]-128<<6)+c[++f]-128:191<b&&b<224&&f+1<e?(b-192<<6)+c[++f]-128:b);return d},d.prototype._extractDataFromMsg=function(a,b,c){var d,e;a<c&&(c-this.msgHeaderDetails.headerSize>=this.msgHeaderDetails.headerSize+1?this._utf8Decoder(b.slice(a,a+this.msgHeaderDetails.msgSize))===this.msgHeaderDetails.msgTxt?(e=this._getMessageLength(b.slice(a+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize,a+this.msgHeaderDetails.headerSize)),d=b.slice(a+this.msgHeaderDetails.headerSize,a+this.msgHeaderDetails.headerSize+e),this._isMsgBinary(b.slice(a+this.msgHeaderDetails.msgSize,a+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize))||(d=this._utf8Decoder(d)),e+this.msgHeaderDetails.headerSize+a<=c?(this._onMessageParsedCallbacks.fire({data:d}),this._extractDataFromMsg(e+this.msgHeaderDetails.headerSize+a,b,c)):this._activeMsg=b.slice(a,c)):(e=this._concatBuffers(this._activeMsg,b),this._extractDataFromMsg(0,e,e.byteLength)):this._activeMsg=b.slice(a,c))},d.prototype._isMsgBinary=function(a){return 0===new Uint8Array(a)[0]},d.prototype._getMessageLength=function(a){for(var b=new Uint8Array(a),c=0,d=0;d<this.msgHeaderDetails.lengthIndicatorSize;++d)c+=b[d],d<this.msgHeaderDetails.lengthIndicatorSize-1&&(c<<=8);return c},d.prototype._concatBuffers=function(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);return c.set(new Uint8Array(a),0),c.set(new Uint8Array(b),a.byteLength),c.buffer},c.Providers.WCS.CometParser=d}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){var c={};return c.droppedFrames=a.Base.Utils.queryJSONObject(b,"dropped_frames[0]._text"),c.droppedFramesPercentageRounded=a.Base.Utils.queryJSONObject(b,"dropped_frames_percentage_rounded[0]._text"),c.period=a.Base.Utils.queryJSONObject(b,"period[0]._text"),c.successfulFrames=a.Base.Utils.queryJSONObject(b,"successful_frames[0]._text"),c.timeEnd=a.Base.Utils.queryJSONObject(b,"time_end[0]._text"),c.timeStart=a.Base.Utils.queryJSONObject(b,"time_start[0]._text"),c=new a.Providers.WCS.FrameReportEventData(c.droppedFrames,c.droppedFramesPercentageRounded,c.period,c.successfulFrames,c.timeEnd,c.timeStart),new a.Providers.WCS.FrameReportEvent(c)},a.Providers.WCS.FrameReportParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){for(var c={liveAttendees:[]},d=0;d<b.live_attendee.length;d++){var e=a.Base.Utils.queryJSONObject(b.live_attendee[d],"attendee_id[0]._text"),f=a.Base.Utils.queryJSONObject(b.live_attendee[d],"client_version[0]._text"),g=a.Base.Utils.queryJSONObject(b.live_attendee[d],"private_chat_supported[0]._text"),h=a.Base.Utils.queryJSONObject(b.live_attendee[d],"start_time[0]._text"),i=a.Base.Utils.queryJSONObject(b.live_attendee[d],"user_agent[0]._text"),j=a.Base.Utils.queryJSONObject(b.live_attendee[d],"user_ip[0]._text"),k=a.Base.Utils.queryJSONObject(b.live_attendee[d],"user_name[0]._text"),l=a.Base.Utils.queryJSONObject(b.live_attendee[d],"ws_connection_id[0]._text");c.liveAttendees.push(new a.Providers.WCS.LiveAttendeeEventData(e,f,g,h,i,j,k,l))}return new a.Providers.WCS.LiveAttendeesEvent(c)},a.Providers.WCS.LiveAttendeesParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){var c=new a.Providers.WCS.LiveCapabilitiesEventData;return new a.Providers.WCS.LiveCapabilitiesEvent(c)},a.Providers.WCS.LiveCapabilitiesParser=b}(AvayaClientServices),function(a){"use strict";function c(){}var d={whiteboard:"whiteboard_",slide:"slide_"};(c.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).stripCommonData=function(c){var d={};return b.each(c._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),new a.Providers.WCS.LiveEventCommonData(d.from,d.fromname,d.id,d.senderId,d.senderName,d.time,d.type,d.useragent,d.wsConnectionId)},c.prototype.convertGroup=function(c){var e;return b.each(d,function(a,b){if(0===c.indexOf(b))return!(e={groupId:parseInt(c.split(b)[1]),layerType:a})}.bind(this)),e?e:void a.Base.Logger.error(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown group prefix type!")},a.Providers.WCS.LiveEventParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){var c={request_id:a.Base.Utils.queryJSONObject(b,"request_id[0]._text"),idle_timeout:a.Base.Utils.queryJSONObject(b,"idle_timeout[0]._text"),ws_connection_id:a.Base.Utils.queryJSONObject(b,"ws_connection_id[0]._text"),server_time_diff:a.Base.Utils.queryJSONObject(b,"server_time_diff[0]._text")},b={attendeeId:a.Base.Utils.queryJSONObject(b,"attendee_id[0]._text"),userName:a.Base.Utils.queryJSONObject(b,"username[0]._text")},b=new a.Providers.WCS.LiveSessionEventData(c.request_id,c.idle_timeout,c.ws_connection_id,c.server_time_diff,{},b,{});return new a.Providers.WCS.LiveSessionEvent(b)},a.Providers.WCS.LiveSessionParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){return b=new a.Providers.WCS.LiveViewerEventData(a.Base.Utils.queryJSONObject(b,"brand_id[0]._text"),a.Base.Utils.queryJSONObject(b,"wcs_version[0]._text"),a.Base.Utils.queryJSONObject(b,"websocket_path[0]._text"),(+a.Base.Utils.queryJSONObject(b,"websocket_cache_size[0]._text")),(+a.Base.Utils.queryJSONObject(b,"upload_size[0]._text")),(+a.Base.Utils.queryJSONObject(b,"upload_max_image_size[0]._text")),(+a.Base.Utils.queryJSONObject(b,"upload_max_image_resolution[0]._text")),a.Base.Utils.queryJSONObject(b,"upload_types[0]._text"),(+a.Base.Utils.queryJSONObject(b,"max_duration[0]._text")),(+a.Base.Utils.queryJSONObject(b,"event_wait_time[0]._text")),(+a.Base.Utils.queryJSONObject(b,"upload_max_file[0]._text")),a.Base.Utils.queryJSONObject(b,"themes_location[0]._text"),"true"===a.Base.Utils.queryJSONObject(b,"internal_ui_controls[0]._text")),new a.Providers.WCS.LiveViewerEvent(b)},a.Providers.WCS.LiveViewerParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.selection[0]._attr&&b.each(c.selection[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.MoveSelectionEventData(d.groupId,d.layerType,d.id,d.moveToX,d.moveToY,d.selectionX,d.selectionY);return new a.Providers.WCS.MoveSelectionEvent(this.stripCommonData(c),e)},a.Providers.WCS.MoveSelectionParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.PauseScreenSharingEvent(this.stripCommonData(b))},a.Providers.WCS.PauseScreenSharingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return c.filename=a.Base.Utils.queryJSONObject(b,"documentinfo[0]._attr.filename._value"),c.filesize=a.Base.Utils.queryJSONObject(b,"documentinfo[0]._attr.filesize._value"),c.fileurl=a.Base.Utils.queryJSONObject(b,"documentinfo[0]._attr.fileurl._value"),c=new a.Providers.WCS.SendDocumentEventData(c.filename,c.filesize,c.fileurl),new a.Providers.WCS.SendDocumentEvent(this.stripCommonData(b),c)},a.Providers.WCS.SendDocumentParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return b.message&&(c.message=a.Base.Utils.queryJSONObject(b,"message[0]._text")),c.targetName=a.Base.Utils.queryJSONObject(b,"_attr.target_name._value"),b._attr.target_id?(c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c["private"]=!0):c["private"]=!1,c=new a.Providers.WCS.SendMessageEventData(c.message,c.targetName,c["private"],c.targetId),new a.Providers.WCS.SendMessageEvent(this.stripCommonData(b),c)},a.Providers.WCS.SendMessageParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={},d=a.Base.Utils.queryJSONObject(b,"slide[0]._attr");return c.count=d.count._value,c.index=d.index._value,c.title=d.title._value,c.presentationId=d.presentationid._value,c.slideUrl=d.slideurl._value,c.slideBaseUrl=d.slideurl._value,c.tocUrl=d.toc._value,c.includeToc="true"===d.includetoc._value,c=new a.Providers.WCS.SendSlideEventData(c.count,c.index,c.title,c.presentationId,c.slideUrl,c.slideBaseUrl,c.tocUrl,c.includeToc),new a.Providers.WCS.SendSlideEvent(this.stripCommonData(b),c)},a.Providers.WCS.SendSlideParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){var c=a.Base.Utils.queryJSONObject(b,"server_capabilities[0].max_frame_height[0]._text"),b=a.Base.Utils.queryJSONObject(b,"server_capabilities[0].max_frame_width[0]._text"),b=new a.Providers.WCS.ServerCapabilitiesEventData(c,b);return new a.Providers.WCS.ServerCapabilitiesEvent(b)},a.Providers.WCS.ServerCapabilitiesParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return b.note&&(c.type=a.Base.Utils.queryJSONObject(b,"note[0]._attr.type._value"),c.text=a.Base.Utils.queryJSONObject(b,"note[0]._text"),c.noteId=a.Base.Utils.queryJSONObject(b,"note[0]._attr.event_id._value"),c.attendeeId=a.Base.Utils.queryJSONObject(b,"note[0]._attr.attende_id._value")),b._attr.target_id?(c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c.personal=!0):c.personal=!1,c=new a.Providers.WCS.SetNoteEventData(c.noteId,c.type,c.text,c.attendeeId,c.personal,c.targetId),new a.Providers.WCS.SetNoteEvent(this.stripCommonData(b),c)},a.Providers.WCS.SetNoteParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.SliderEmptyEvent(this.stripCommonData(b))},a.Providers.WCS.SliderEmptyParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return a.Base.Utils.queryJSONObject(b,"data[0].slide_url[0]")?(c.slideURL=a.Base.Utils.queryJSONObject(b,"data[0].slide_url[0]._text"),c.thumbUrl=a.Base.Utils.queryJSONObject(b,"data[0].thumbnail_url[0]._text")):(c.slideURL=a.Base.Utils.queryJSONObject(b,"data[0].sliderUrl[0]._text"),c.thumbUrl=a.Base.Utils.queryJSONObject(b,"data[0].thumbUrl[0]._text")),c=new a.Providers.WCS.SliderSlideEventData(c.slideURL,c.thumbUrl),new a.Providers.WCS.SliderSlideEvent(this.stripCommonData(b),c)},a.Providers.WCS.SliderSlideParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.lines[0]._attr&&b.each(c.lines[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),a.Base.Utils.isDefined(d.color)&&(d.color=a.Base.Utils.colorIntToHex(d.color)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.StartDrawShapeEventData(d.alpha,d.color,d.groupId,d.layerType,d.width);return new a.Providers.WCS.StartDrawShapeEvent(this.stripCommonData(c),e)},a.Providers.WCS.StartDrawShapeParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c=new a.Providers.WCS.StartMeetingEventData("173621");return new a.Providers.WCS.StartMeetingEvent(this.stripCommonData(b),c)},a.Providers.WCS.StartMeetingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c=a.Base.Utils.queryJSONObject(b,"transport_version[0]._text"),c=new a.Providers.WCS.StartScreenSharingEventData(c);return new a.Providers.WCS.StartScreenSharingEvent(this.stripCommonData(b),c)},a.Providers.WCS.StartScreenSharingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.StartVideoSharingEvent(this.stripCommonData(b))},a.Providers.WCS.StartVideoSharingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c=a.Base.Utils.queryJSONObject(b,"whiteboard[0]._attr.index._value"),c=new a.Providers.WCS.StartWhiteboardEventData(c);return new a.Providers.WCS.StartWhiteboardEvent(this.stripCommonData(b),c)},a.Providers.WCS.StartWhiteboardParser=b}(AvayaClientServices),function(a){"use strict";function b(a){this._position=0,this._buffer=a,this.length=this._buffer.byteLength}b.prototype={getBuffer:function(){return this._buffer},setPosition:function(a){this._position=a},getPosition:function(){return this._position},getBytesAvailable:function(){return this._buffer.byteLength-this._position},readBytes:function(b){var c=new a.Providers.WCS.ByteArray(this._buffer.slice(this._position,this._position+b));return this._position+=b,c},readByte:function(){var a=new Int8Array(this._buffer.slice(this._position,this._position+1));return this._position++,a[0]},readUnsignedInt:function(){var a=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,a.getUint32(0)},readShort:function(){var a=new DataView(this._buffer.slice(this._position,this._position+2));return this._position+=2,a.getInt16(0)},readInt:function(){var a=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,a.getInt32(0)}},a.Providers.WCS.ByteArray=b}(AvayaClientServices),function(a){"use strict";function b(){this._bitmapElements=[],this.width=0,this.height=0,this.isKeyFrame=!1}b.prototype={setStartTag:function(a){return this.width=a.width,this.height=a.height,this.isKeyFrame=a.isKeyFrame,this},addBitmapElement:function(a){return this._bitmapElements.push(a),this}},a.Providers.WCS.Frame=b}(AvayaClientServices),function(a){"use strict";function b(a){this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.bitmapData=a.data.getBuffer(),this.imageType=a.imageType}b.prototype={},a.Providers.WCS.FrameBitmapLoader=b}(AvayaClientServices),function(b){"use strict";function c(){this._frame=a}c.prototype={processTag:function(a,c){switch(a.type){case b.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:this._startFrame(a);break;case b.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:this._addBinaryBlock(a);break;case b.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:this._endFrame(c);break;default:b.Base.Logger.warn(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",a.type)}},_startFrame:function(a){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add start Tag"),this._frame=new b.Providers.WCS.Frame,this._frame.setStartTag(a)},_addBinaryBlock:function(a){this._frame&&0<a.data.length&&(a=new b.Providers.WCS.FrameBitmapLoader(a),this._frame.addBitmapElement(a))},_endFrame:function(c){this._frame?(b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add End Tag - end Frame",this._frame._bitmapElements.length),c(this._frame),this._frame=a):b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"There was no Start Tag for this End Tag")}},b.Providers.WCS.FrameBuilder=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingImageTypes={JPEG:0,PNG:1,JPEG_RED_WITH_BLACK:2}}(),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingKeyFrameTypes={INTRA_FRAME:0,KEY_FRAME:1}}(),function(a){"use strict";a.Providers.WCS.ScreenSharingTagEncoder=function(){},a.Providers.WCS.ScreenSharingTagEncoder.prototype={encodeTag:function(b){switch(b.type){case a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:return this._encodeStartFrame(b);case a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:return this._encodeBinaryBlock(b);case a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:return this._encodeEndFrame(b);default:a.Base.Logger.warn(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",b.type);
}},_encodeStartFrame:function(b){var c,d,e=0;0!==b.messageId?(e=4,c=new ArrayBuffer(14+e),(d=new DataView(c)).setInt32(0,b.messageId)):(c=new ArrayBuffer(14+e),d=new DataView(c)),d.setInt8(0+e,a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG),d.setInt8(1+e,b.isKeyFrame?a.Providers.WCS.ScreenSharingKeyFrameTypes.KEY_FRAME:a.Providers.WCS.ScreenSharingKeyFrameTypes.INTRA_FRAME),d.setInt16(2+e,b.width),d.setInt16(4+e,b.height);for(var f=this._getCurrentTimeStamp(b.creationTime),g=0;g<f.length;g++)d.setInt8(6+e+g,f[g]);return c},_encodeBinaryBlock:function(b){var c,d,e,f=0;return 0!==b.messageId?(f=4,c=new ArrayBuffer(18+f+b.data.length),d=new Uint8Array(c),(e=new DataView(c)).setInt32(0,b.messageId)):(c=new ArrayBuffer(18+f+b.data.length),d=new Uint8Array(c),e=new DataView(c)),e.setInt8(0+f,a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG),e.setInt16(1+f,b.width),e.setInt16(3+f,b.height),e.setInt16(5+f,b.x),e.setInt16(7+f,b.y),e.setInt8(9+f,b.imageType),0===b.length?e.setInt32(10+f,b.data.length):e.setInt32(10+f,b.length),e.setInt32(14+f,0),d.set(b.data,18+f),c},_encodeEndFrame:function(b){var c,d,e=0;return 0!==b.messageId?(e=4,c=new ArrayBuffer(1+e),(d=new DataView(c)).setInt32(0,b.messageId)):(c=new ArrayBuffer(1+e),d=new DataView(c)),d.setInt8(0+e,a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG),c},_getCurrentTimeStamp:function(a){return a=this._longToByteArray(a),a.reverse(),a},_longToByteArray:function(a){for(var b=[0,0,0,0,0,0,0,0],c=0;c<b.length;c++){var d=255&a;a=(a-(b[c]=d))/256}return b}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSScreenSharingTagTypes={START_TAG:0,BLOCK_TAG:1,CURSOR_TAG:2,END_TAG:3,ACK_TAG:4}}(),function(){"use strict";AvayaClientServices.Providers.WCS.WCSSharingTag=function(a){this.type=a,this.messageId=0}}(),function(a){"use strict";function b(){this._parsers={},this._ackPackageSize=5}b.prototype={parse:function(b){var c,d,e,f={};return 0<b.byteLength?(d=new a.Providers.WCS.ByteArray(b),b.byteLength===this._ackPackageSize&&(f.id=d.readInt()),b=(e=d.readByte())>>4,e=15&e,f.byteArray=d,this._parsers[b]&&this._parsers[b][e]&&(c=this._parsers[b][e].parse(f))):a.Base.Logger.warn(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Buffer length = 0. Parse process skipped."),c},registerParser:function(a,b,c){this._parsers[a]||(this._parsers[a]={}),this._parsers[a][b]=c}},a.Providers.WCS.WCSBinaryParser=b}(AvayaClientServices),function(b){"use strict";function c(b){this._frameBuilder=b,this._lastPoint=a,this._timeout=a,this._isKeyFrameArrived=!1}c.prototype={updateFrame:function(a,c){this._frameBuilder.processTag(c,function(c){var d=c._bitmapElements.map(function(a){return new b.Services.Collaboration.Bitmap(a.x,a.y,a.width,a.height,a.imageType,a.bitmapData)}),c=new b.Services.Collaboration.Frame(c.width,c.height,d,c.isKeyFrame);c.isKeyFrame()?(this._isKeyFrameArrived=!0,a._contentSharing._onFrameReceivedCallbacks.fire(a._contentSharing,c)):this._isKeyFrameArrived?a._contentSharing._onFrameChangedCallbacks.fire(a._contentSharing,c):b.Base.Logger.warn(b.Base.LoggerTags.WCS_CONTENT_SHARING_HANDLER,"A normal frame has arrived before the key frame")}.bind(this))},updateCursor:function(c,d){this._lastPoint=new b.Services.Collaboration.Point(d.x,d.y),this._timeout||(this._timeout=setTimeout(function(){c._contentSharing._onCursorReceivedCallbacks.fire(c._contentSharing,this._lastPoint),this._timeout=a}.bind(this),100))},startScreenSharing:function(a,c){var d=this._getParticipant(a,c),c=a._contentSharing._contentSharingService._sharingState;a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.SHARING,!0===a._contentSharing._isPaused&&c!==b.Services.Collaboration.ContentSharingState.NOT_SHARING?(a._contentSharing._isPaused=!1,a._contentSharing._onContentSharingResumedCallbacks.fire(a._contentSharing,d)):(a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.SHARING,a._contentSharing._onContentSharingStartedCallbacks.fire(a._contentSharing,d))},pauseScreenSharing:function(a,c){a._contentSharing._isPaused=!0,c=this._getParticipant(a,c),a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.PAUSED,a._contentSharing._onContentSharingPausedCallbacks.fire(a._contentSharing,c)},endScreenSharing:function(a,c){this._isKeyFrameArrived=!1,c=this._getParticipant(a,c),a._contentSharing._isPaused=!1,a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.NOT_SHARING,a._contentSharing._onContentSharingEndedCallbacks.fire(a._contentSharing,c)},endScreenSharingByParticipant:function(a,c){this._isKeyFrameArrived=!1,a._contentSharing._isPaused=!1,a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.NOT_SHARING,a._contentSharing._onContentSharingEndedCallbacks.fire(a._contentSharing,c)},startVideoSharing:function(a,c){c=this._getParticipant(a,c),a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.SHARING,a._contentSharing._onScreenSharingUsingVideoStartedCallbacks.fire(a._contentSharing,c)},endVideoSharing:function(a,b){var c=this._getParticipant(a,b);this.endVideoSharingByParticipant(a,c,b.isServerInitiated())},endVideoSharingByParticipant:function(a,c,d){a._contentSharing._contentSharingService.isScreenSharingUsingVideo()?a._contentSharing._contentSharingService._sharingState=b.Services.Collaboration.ContentSharingState.NOT_SHARING:c.isLocalUser()&&a._contentSharing._contentSharingService.stopScreenSharingUsingVideo(a._contentSharing,!1),a._contentSharing._onScreenSharingUsingVideoEndedCallbacks.fire(a._contentSharing,c,d)},frameReport:function(a,b){a._contentSharing._onFrameReportReceivedCallbacks.fire(a._contentSharing,b)},_getParticipant:function(a,c){var d=a._participants.filter(function(a){return a.getParticipantId()===c.senderId})[0];return d||(d=new b.Services.Collaboration.Participant(c.senderId,c.senderName),a._participants.push(d)),d}},b.Providers.WCS.WCSContentSharingHandler=c}(AvayaClientServices),function(c,d){"use strict";function e(){this.parsers=[],this.optimizer=new c.Providers.WCS.LiveEventQueueOptimizer}e.prototype={register:function(a,b){this.parsers[a]=b},unregister:function(b){this.parsers[b]=a},parse:function(e){"string"==typeof e?i=d.parseString(e):"object"==typeof e&&(i=e);var f=i.response[0],g=[],e=[];if(f.error){var h=c.Providers.WCS.WCSEventTypes.ERROR,i=f.error[0];return g.push(this.delegateParser(h,i)),g}if(f.live_events)return f.live_events[0]&&f.live_events[0].event&&(b.each(f.live_events[0].event,function(b,c){h=c._attr.type._value,c=this.delegateParser(h,c),c!==a&&g.push(c)}.bind(this)),e=this.optimizer.getOptimizedQueue(g)),e;if(f.live_event||f.live_ping)return[];if(f.live_session)return h=c.Providers.WCS.WCSEventTypes.LIVE_SESSION,g.push(this.delegateParser(h,f.live_session[0])),g;if(f.frame_report)return h=c.Providers.WCS.WCSEventTypes.FRAME_REPORT,g.push(this.delegateParser(h,f.frame_report[0])),g;if(f.live_viewer)return h=c.Providers.WCS.WCSEventTypes.LIVE_VIEWER,g.push(this.delegateParser(h,f.live_viewer[0])),g;if(f.live_capabilities)return h=c.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,g.push(this.delegateParser(h,f.live_capabilities[0])),g;if(f.live_attendees)return h=c.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,g.push(this.delegateParser(h,f.live_attendees[0])),g;throw new Error("No parser specified!")},delegateParser:function(b,d){return this.parsers[b]!==a?this.parsers[b].parse(d):void c.Base.Logger.error(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"No parser specified!",b)}},c.Providers.WCS.WCSEventsParser=e}(AvayaClientServices,xmlToJSON),function(){"use strict";AvayaClientServices.Providers.WCS.WCSEventTypes={START_WHITEBOARD:"StartWhiteboard",ADD_WHITEBOARD:"AddWhiteboard",DELETE_WHITEBOARD:"DeleteWhiteboard",START_DRAW_SHAPE:"StartDrawShape",DRAW_SHAPE:"DrawShape",END_DRAW_SHAPE:"EndDrawShape",DRAW_CIRCLE:"DrawCircle",DRAW_TEXT:"DrawText",MOVE_SELECTION:"MoveSelection",DELETE_SELECTION:"DeleteSelection",CLEAR_DRAWING:"ClearDrawing",END_WHITEBOARD:"EndWhiteboard",SEND_SLIDE:"SendSlide",END_PRESENTATION:"EndPresentation",SEND_MESSAGE:"SendMessage",ADD_NOTE:"AddNote",SET_NOTE:"SetNote",DELETE_NOTE:"DeleteNote",START_SCREEN_SHARING:"StartScreenSharing",PAUSE_SCREEN_SHARING:"PauseScreenSharing",END_SCREEN_SHARING:"EndScreenSharing",REQUEST_CONTROL:"RequestControl",GRANT_CONTROL:"GrantControl",START_CONTROL:"StartControl",DECLINE_CONTROL:"DeclineControl",DENY_CONTROL:"DenyControl",SEND_DOCUMENT:"SendDocument",END_CONTROL:"EndControl",ALLOW_PRESENTING:"AllowPresenting",DENY_PRESENTING:"DenyPresenting",EJECT_PARTICIPANT:"EjectParticipant",START_MEETING:"StartMeeting",END_MEETING:"EndMeeting",DRAW_CURSOR:"DrawCursor",DRAW_FRAME:"DrawFrame",LIVE_VIEWER:"LiveViewer",FRAME_REPORT:"FrameReport",START_VIDEO_SHARING:"StartVideoSharing",END_VIDEO_SHARING:"EndVideoSharing",ERROR:"Error",LIVE_SESSION:"LiveSession",LIVE_ATTENDEES:"LiveAttendees",LIVE_ATTENDEE:"LiveAttendee",LIVE_CAPABILITIES:"LiveCapabilities",SERVER_CAPABILITIES:"ServerCapabilities",SLIDER_SLIDE:"SliderSlide",SLIDER_EMPTY:"SliderEmpty"}}(),function(b){"use strict";function c(){this._config=a,this._participant=a,this._meetingId=a}c.prototype={buildDrawCircleMessage:function(a,c,d,e,f){return c=this._buildDrawCircleEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,d,e,f,c)},buildResourceDiscoveryMessage:function(a,b,c,d,e){return{mode:a,meeting_id:b,participant_id:c,username:d,token:e}},buildMoveSelectionMessage:function(a,c,d,e,f,g,h){return e=this._buildMoveSelectionEventData(a,c,d,e),this._decorateRequest(b.Providers.WCS.WCSEventTypes.MOVE_SELECTION,f,g,h,e)},buildDrawShapeMessage:function(a,c,d,e,f){return c=this._buildDrawShapeEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DRAW_SHAPE,d,e,f,c)},buildLiveDrawShapeMessage:function(a,c,d,e,f){return c=this._buildLiveDrawShapeEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DRAW_SHAPE,d,e,f,c)},buildFirstPointLiveDrawShapeMessage:function(a,c,d,e){return a=this._buildFirstPointLiveDrawShapeEventData(a),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DRAW_SHAPE,c,d,e,a)},buildStartDrawShapeMessage:function(a,c,d,e,f){return c=this._buildStartDrawShapeEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,d,e,f,c)},buildEndDrawShapeMessage:function(a,c,d,e,f){return c=this._buildEndDrawShapeEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,d,e,f,c)},buildDrawTextMessage:function(a,c,d,e,f){return c=this._buildDrawTextEventData(a,c),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DRAW_TEXT,d,e,f,c)},buildAddWhiteboardMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,a,c,d)},buildEndWhiteboardMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.END_WHITEBOARD,a,c,d)},buildRemoveWhiteboardMessage:function(a,c,d,e){return a='<whiteboard index="'+a+'"/>',this._decorateRequest(b.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,c,d,e,a)},buildStartWhiteboardMessage:function(a,c,d,e){var f='<whiteboard index="';return b.Base.Utils.isDefined(e)&&(f+=e),f+='"/>',this._decorateRequest(b.Providers.WCS.WCSEventTypes.START_WHITEBOARD,a,c,d,f)},buildLiveEventMessage:function(a,b,c,d){return this._decorateRequest(a,b,c,d)},buildStartScreenSharingMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,a,c,d,"<transport_version>1</transport_version>")},buildStopScreenSharingMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,a,c,d)},buildPauseScreenSharingMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,a,c,d)},buildStartVideoSharingMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,a,c,d)},buildStopVideoSharingMessage:function(a,c,d){return this._decorateRequest(b.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,a,c,d)},buildClearContentMessage:function(a,c,d,e){return a='<selection group="whiteboard_'+a+'"/>',this._decorateRequest(b.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,c,d,e,a)},buildGetParticipantsMessage:function(a){return"live_attendees?rc_only="+!!a+"&request_id="+b.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},buildMaxDownloadMessage:function(a){return"live_capabilities?max_download_bandwidth="+a+"&request_id="+b.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},_buildMoveSelectionEventData:function(a,b,c,d){var e=a.getTranslation();return'<selection group="whiteboard_'+b+'" id="'+a.getId()+'" moveToX="'+e.getX()+'" moveToY="'+e.getY()+'" selectionX="'+c+'" selectionY="'+d+'"/>'},buildDeleteSelectionMessage:function(a,c,d,e,f,g,h){return e=this._buildDeleteSelectionEventData(a,c,d,e),this._decorateRequest(b.Providers.WCS.WCSEventTypes.DELETE_SELECTION,f,g,h,e)},buildPauseMessage:function(){return"live_capabilities?sharing_reception=false&request_id="+b.Base.Utils.makeId(32,"0123456789abcdef")},buildResumeMessage:function(){return"live_capabilities?sharing_reception=true&request_id="+b.Base.Utils.makeId(32,"0123456789abcdef")},_buildDeleteSelectionEventData:function(a,b,c,d){return'<selection group="whiteboard_'+b+'" id="'+a._id+'" selectionX="'+c+'" selectionY="'+d+'"/>'},_buildDrawCircleEventData:function(a,b){return b='<circle alpha="'+a.getAlpha()+'" group="whiteboard_'+b+'" x0="'+a.getTopLeft().getX()+'" x1="'+a.getBottomRight().getX()+'" y0="'+a.getTopLeft().getY()+'" y1="'+a.getBottomRight().getY()+'"',b+=a.isFilled()?' fillColor="'+a.getColor()+'"':' color="'+a.getColor()+'"',b=b+' width="'+a.getWidth()+'" />'},_buildDrawShapeEventData:function(a,b){var c='<lines group="whiteboard_'+b+'" alpha="'+a.getAlpha()+'" width="'+a.getWidth()+'"';c+=a.isFilled()?' fillColor="'+a.getColor()+'"':' color="'+a.getColor()+'"',c+=">";for(var d=0,e=a.getPoints();d<e.length;d++){var f=e[d];c+=f.isMove?'<m x="'+f.point.getX()+'" y="'+f.point.getY()+'"/>':'<l x="'+f.point.getX()+'" y="'+f.point.getY()+'"/>'}return c+="</lines>"},_buildFirstPointLiveDrawShapeEventData:function(a){return'<m x="'+a.getX()+'" y="'+a.getY()+'"/>'},_buildLiveDrawShapeEventData:function(a,b){var c="",d=0;for(a[0].isMove&&(d=1,c+='<m x="'+a[0].point.getX()+'" y="'+a[0].point.getY()+'"/>'),c+='<lines group="whiteboard_'+b+'">';d<a.length;d++){var e=a[d];c+=e.isMove?'<m x="'+e.point.getX()+'" y="'+e.point.getY()+'"/>':'<l x="'+e.point.getX()+'" y="'+e.point.getY()+'"/>'}return c+="</lines>"},_buildStartDrawShapeEventData:function(a,b){return b='<lines group="whiteboard_'+b+'" alpha="'+a.getAlpha()+'" width="'+a.getWidth()+'"',b+=a.isFilled()?' fillColor="'+a.getColor()+'"':' color="'+a.getColor()+'"',b+="/>"},_buildEndDrawShapeEventData:function(a,b){return'<lines group="whiteboard_'+b+'"/>'},_buildDrawTextEventData:function(a,b){return'<drawText fillColor="'+a.getColor()+'" fontSize="'+a.getFontSize()+'" group="whiteboard_'+b+'" text="'+this._escapeXMLSpecialChars(a.getContent())+'" x="'+a.getPosition().getX()+'" y="'+a.getPosition().getY()+'"/>'},_translateColor:function(a){return parseInt("0x".concat(a.slice(1))).toString()},_decorateRequest:function(a,c,d,e,f){return"live_event"+(f?"?event_data="+encodeURIComponent(f)+"&":"?")+"event_type="+a+"&meeting_id="+c+"&sender_id="+d+"&sender_name="+encodeURIComponent(e)+"&request_id="+b.Base.Utils.makeId(32,"0123456789abcdef")},_escapeXMLSpecialChars:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"&#xA;")}},b.Providers.WCS.WCSMessageBuilder=c}(AvayaClientServices),function(c){"use strict";function d(){c.Providers.Interfaces.CollaborationProvider.call(this),this._providers=[],this._selectedProvider=a,this._config={}}(d.prototype=Object.create(c.Providers.Interfaces.CollaborationProvider.prototype)).stop=function(){return c.Base.Utils.isDefined(this._selectedProvider)?this._selectedProvider.stop():b.Deferred().resolve().promise()},d.prototype.registerWCSProvider=function(a,b){this._providers.push({version:a,provider:b})},d.prototype.start=function(a,c){return b.isEmptyObject(a)||this._config===a||(this._config=a.wcsConfiguration),this._selectedProvider=this._providers[0].provider,this._selectedProvider.start(a.wcsConfiguration,c)},d.prototype.on=function(a,b){this._selectedProvider.on(a,b)},d.prototype.off=function(a,b){this._selectedProvider.off(a,b)},d.prototype.getReceivingBitrate=function(){return this._selectedProvider.getReceivingBitrate()},d.prototype.getBufferedAmount=function(){return this._selectedProvider.getBufferedAmount()},d.prototype.addCircle=function(a,b){return this._selectedProvider.addCircle(a,b)},d.prototype.pause=function(){return this._selectedProvider.pause()},d.prototype.resume=function(){return this._selectedProvider.resume()},d.prototype.addText=function(a,b){return this._selectedProvider.addText(a,b)},d.prototype.addShape=function(a,b){return this._selectedProvider.addShape(a,b)},d.prototype.discoverResources=function(a){return this._selectedProvider.discoverResources(a)},d.prototype.startDrawShape=function(a,b){return this._selectedProvider.startDrawShape(a,b)},d.prototype.liveDrawShape=function(a,b){return this._selectedProvider.liveDrawShape(a,b)},d.prototype.endDrawShape=function(a,b){return this._selectedProvider.endDrawShape(a,b)},d.prototype.moveSelection=function(a,b,c){return this._selectedProvider.moveSelection(a,b,c)},d.prototype.observeCollaboration=function(a){this._selectedProvider.observeCollaboration(a)},d.prototype.startWhiteboard=function(a){return this._selectedProvider.startWhiteboard(a)},d.prototype.endWhiteboard=function(a){return this._selectedProvider.endWhiteboard(a)},d.prototype.addWhiteboardSurface=function(){return this._selectedProvider.addWhiteboardSurface()},d.prototype.removeWhiteboardSurface=function(a){return this._selectedProvider.removeWhiteboardSurface(a)},d.prototype.sendBlocks=function(a,b){return this._selectedProvider.sendBlocks(a,b)},d.prototype.startScreenSharing=function(){return this._selectedProvider.startScreenSharing()},d.prototype.stopScreenSharing=function(){return this._selectedProvider.stopScreenSharing()},d.prototype.startVideoSharing=function(){return this._selectedProvider.startVideoSharing()},d.prototype.stopVideoSharing=function(){return this._selectedProvider.stopVideoSharing()},d.prototype.pauseScreenSharing=function(){return this._selectedProvider.pauseScreenSharing()},d.prototype.sendLiveEvent=function(a){return this._selectedProvider.sendLiveEvent(a)},d.prototype.removeShape=function(a,b,c){return this._selectedProvider.removeShape(a,b,c)},d.prototype.clearContent=function(a){return this._selectedProvider.clearContent(a)},d.prototype.getParticipants=function(){return this._selectedProvider.getParticipants()},d.prototype.isOpened=function(){return this._selectedProvider&&this._selectedProvider.isOpened()},d.prototype.isFeatureAvailable=function(a){return this._selectedProvider&&this._selectedProvider.isFeatureAvailable(a)},d.prototype.run=function(a){return this._selectedProvider.run(a)},d.prototype.getServerCapabilities=function(){return this._selectedProvider.getServerCapabilities()},d.prototype.isWhiteboardActive=function(){return this._selectedProvider.isWhiteboardActive()},d.prototype.getAcksActivated=function(){return this._selectedProvider.getAcksActivated()},c.Providers.WCS.WCSProvider=d}(AvayaClientServices),function(c){"use strict";function d(){this._collaborationProvider={}}d.prototype={getWCSProvider:function(a){if(c.Base.Utils.isDefined(a)&&a.enabled)return b.isEmptyObject(this._collaborationProvider)&&(a=this._createWCSv1_1Provider(),this._collaborationProvider=new c.Providers.WCS.WCSProvider,this._collaborationProvider.registerWCSProvider("1.1",a)),this._collaborationProvider},_createWCSv1_1Provider:function(){var b=new c.Base.RESTProvider,d=new c.Base.NetworkProvider(b,a,c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),e=new c.Providers.WCS.CometParser,f=new c.Providers.WCS.WCSCometProvider(e),g=new c.Providers.WCS.WCSTransactionalWebSocketProvider,h=new c.Base.NetworkProvider(g,f,c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),i=this._createEventsParser(),j=this._createBinaryParser(),k=new c.Providers.WCS.FrameBuilder,b=new c.Providers.WCS.WCSMessageBuilder,e=new c.Providers.WCS.WCSContentSharingHandler(k),g=new c.Providers.WCS.WCSShapeConverter,f=new c.Providers.WCS.WCSWhiteboardHandler(g),k=new c.Services.Analytics.CollaborationsAnalyticsService,g=new c.Providers.WCS.WCSSliderHandler;return new c.Providers.WCS.WCSv1_1Provider(d,i,j,b,e,f,g,h,k)},_createEventsParser:function(){var a=new c.Providers.WCS.WCSEventsParser;return a.register(c.Providers.WCS.WCSEventTypes.ERROR,new c.Providers.WCS.ErrorParser),a.register(c.Providers.WCS.WCSEventTypes.LIVE_SESSION,new c.Providers.WCS.LiveSessionParser),a.register(c.Providers.WCS.WCSEventTypes.LIVE_VIEWER,new c.Providers.WCS.LiveViewerParser),a.register(c.Providers.WCS.WCSEventTypes.SEND_MESSAGE,new c.Providers.WCS.SendMessageParser),a.register(c.Providers.WCS.WCSEventTypes.DRAW_SHAPE,new c.Providers.WCS.DrawShapeParser),a.register(c.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,new c.Providers.WCS.DrawCircleParser),a.register(c.Providers.WCS.WCSEventTypes.MOVE_SELECTION,new c.Providers.WCS.MoveSelectionParser),a.register(c.Providers.WCS.WCSEventTypes.DELETE_SELECTION,new c.Providers.WCS.DeleteSelectionParser),a.register(c.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,new c.Providers.WCS.ClearDrawingParser),a.register(c.Providers.WCS.WCSEventTypes.DRAW_TEXT,new c.Providers.WCS.DrawTextParser),a.register(c.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,new c.Providers.WCS.StartDrawShapeParser),a.register(c.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,new c.Providers.WCS.EndDrawShapeParser),a.register(c.Providers.WCS.WCSEventTypes.START_WHITEBOARD,new c.Providers.WCS.StartWhiteboardParser),a.register(c.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,new c.Providers.WCS.AddWhiteboardParser),a.register(c.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,new c.Providers.WCS.DeleteWhiteboardParser),a.register(c.Providers.WCS.WCSEventTypes.END_WHITEBOARD,new c.Providers.WCS.EndWhiteboardParser),a.register(c.Providers.WCS.WCSEventTypes.START_MEETING,new c.Providers.WCS.StartMeetingParser),a.register(c.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,new c.Providers.WCS.StartScreenSharingParser),a.register(c.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,new c.Providers.WCS.StartVideoSharingParser),a.register(c.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,new c.Providers.WCS.PauseScreenSharingParser),a.register(c.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,new c.Providers.WCS.EndScreenSharingParser),a.register(c.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,new c.Providers.WCS.EndVideoSharingParser),a.register(c.Providers.WCS.WCSEventTypes.GRANT_CONTROL,new c.Providers.WCS.GrantControlParser),a.register(c.Providers.WCS.WCSEventTypes.ADD_NOTE,new c.Providers.WCS.AddNoteParser),a.register(c.Providers.WCS.WCSEventTypes.DELETE_NOTE,new c.Providers.WCS.DeleteNoteParser),a.register(c.Providers.WCS.WCSEventTypes.SET_NOTE,new c.Providers.WCS.SetNoteParser),a.register(c.Providers.WCS.WCSEventTypes.DENY_CONTROL,new c.Providers.WCS.DenyControlParser),a.register(c.Providers.WCS.WCSEventTypes.END_CONTROL,new c.Providers.WCS.EndControlParser),a.register(c.Providers.WCS.WCSEventTypes.END_MEETING,new c.Providers.WCS.EndMeetingParser),a.register(c.Providers.WCS.WCSEventTypes.SEND_DOCUMENT,new c.Providers.WCS.SendDocumentParser),a.register(c.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING,new c.Providers.WCS.AllowPresentingParser),a.register(c.Providers.WCS.WCSEventTypes.DENY_PRESENTING,new c.Providers.WCS.DenyPresentingParser),a.register(c.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT,new c.Providers.WCS.EjectParticipantParser),a.register(c.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,new c.Providers.WCS.LiveAttendeesParser),a.register(c.Providers.WCS.WCSEventTypes.FRAME_REPORT,new c.Providers.WCS.FrameReportParser),a.register(c.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,new c.Providers.WCS.LiveCapabilitiesParser),a.register(c.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES,new c.Providers.WCS.ServerCapabilitiesParser),a.register(c.Providers.WCS.WCSEventTypes.SLIDER_SLIDE,new c.Providers.WCS.SliderSlideParser),a.register(c.Providers.WCS.WCSEventTypes.SLIDER_EMPTY,new c.Providers.WCS.SliderEmptyParser),a},_createBinaryParser:function(){var a=new c.Providers.WCS.WCSBinaryParser;return a.registerParser(c.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,c.Providers.WCS.WCSScreenSharingTagTypes.START_TAG,new c.Providers.WCS.StartTagBinaryParser),a.registerParser(c.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,c.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG,new c.Providers.WCS.BlockTagBinaryParser),a.registerParser(c.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,c.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG,new c.Providers.WCS.CursorTagBinaryParser),a.registerParser(c.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,c.Providers.WCS.WCSScreenSharingTagTypes.END_TAG,new c.Providers.WCS.EndTagBinaryParser),a.registerParser(c.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,c.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG,new c.Providers.WCS.AcknowledgementTagBinaryParser),a}},c.Providers.WCS.WCSProviderFactory=d}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={convertShape:function(b,c){var d=this._determineColor(b.data),e=b.liveEventCommonData.fromname,f=b.data.filled,g=b.liveEventCommonData.senderId===c,h=b.data.alpha,c=b.data.width,i=new a.Services.Collaboration.Shape(e,f,g,d,h,c);if(i.setId(b.liveEventCommonData.eventId),a.Base.Utils.isDefined(b.data.m))for(var j=0;j<b.data.m.length;j++)i.addMovePoint(new a.Services.Collaboration.Point(b.data.m[j].x,b.data.m[j].y));if(a.Base.Utils.isDefined(b.data.l))for(var k=0;k<b.data.l.length;k++)i.addLinePoint(new a.Services.Collaboration.Point(b.data.l[k].x,b.data.l[k].y));return i},convertLiveShape:function(b,c){var d=b.liveEventCommonData.fromname,e=b.liveEventCommonData.senderId===c,f=this._convertColor(b.data.color),g=b.data.alpha,c=b.data.width,c=new a.Services.Collaboration.Shape(d,(!1),e,f,g,c);return c.setId(b.liveEventCommonData.eventId),c},convertText:function(b,c){var d=b.data.text,e=b.liveEventCommonData.fromname,f=b.data.filled,g=b.liveEventCommonData.senderId===c,h=this._convertColor(b.data.fillColor),c=b.data.fontSize,h=new a.Services.Collaboration.WhiteboardText(d,c,e,f,g,h,(void 0));return h.setId(b.liveEventCommonData.eventId),h.setPosition(new a.Services.Collaboration.Point(b.data.x,b.data.y)),h},convertCircle:function(b,c){var d=this._determineColor(b.data),e=b.liveEventCommonData.fromname,f=b.data.filled,g=b.liveEventCommonData.senderId===c,h=b.data.width,i=b.data.alpha,c=this._calculatePoints(b.data),h=new a.Services.Collaboration.Circle(c.topLeft,c.bottomRight,e,f,g,d,i,h);return h.setId(b.liveEventCommonData.eventId),h},_determineColor:function(a){return a.filled&&a.fillColor?this._convertColor(a.fillColor):a.contour&&a.color?this._convertColor(a.color):void 0},_convertColor:function(a){return 0===a.indexOf("#")?parseInt(a.slice(1),16):parseInt(a,16)},_calculatePoints:function(b){var c,b=b.x0<b.x1&&b.y0<b.y1?(c=new a.Services.Collaboration.Point(b.x0,b.y0),new a.Services.Collaboration.Point(b.x1,b.y1)):b.x0>=b.x1&&b.y0>=b.y1?(c=new a.Services.Collaboration.Point(b.x1,b.y1),new a.Services.Collaboration.Point(b.x0,b.y0)):b.x0<b.x1&&b.y0>=b.y1?(c=new a.Services.Collaboration.Point(b.x0,b.y1),new a.Services.Collaboration.Point(b.x1,b.y0)):(c=new a.Services.Collaboration.Point(b.x1,b.y0),new a.Services.Collaboration.Point(b.x0,b.y1));return{topLeft:c,bottomRight:b}}},a.Providers.WCS.WCSShapeConverter=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={handleSliderSlide:function(b,c){a.Base.Logger.debug(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderSlide");var d=b.getSlider(),e=b._config.wcsConfiguration.networkProviderConfiguration.restConfig,f=d.getSlides().length+1,g=e.getUrl(!1)+c.data.slideURL,e=e.getUrl(!1)+c.data.thumbUrl,c=new Date(c.liveEventCommonData.time),c=new a.Services.Collaboration.SliderSlide(f,g,e,c);d._addSlides(c),d._onSlidesAddedCallbacks.fire(c),b._recalculateSliderCapability()},handleSliderEmpty:function(b,c){a.Base.Logger.debug(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderEmpty");var d=b.getSlider(),e=d.getSlides();d._removeSlides(),d._onSlidesRemovedCallbacks.fire(e),b._recalculateSliderCapability()}},a.Providers.WCS.WCSSliderHandler=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSTransmissionTypes={SCREEN_SHARING:0,SLIDE_SHARING:2}}(),function(b){"use strict";function c(a){this._shapeConverter=a}c.prototype={addWhiteboard:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"addWhiteboard");var d,e,f=a.getWhiteboard(),g=f.getSurfaceById(c.liveEventCommonData.eventId);b.Base.Utils.isDefined(g)?this.startWhiteboard(a,c):(d=this._createNewSurface(f,c.liveEventCommonData.eventId),e=f.getActiveSurface(),g=this._getParticipant(a,c),b.Base.Utils.isDefined(e)&&(e._active=!1),d._active=!0,f._activeSurface=d,f._onWhiteboardSurfaceAddedCallbacks.fire(c,d,g),f._onWhiteboardSurfaceSetActiveCallbacks.fire(f,d,g),f._recalculateRemoveWhiteboardCapability(a),f._recalculateAddWhiteboardCapability(a))},startWhiteboard:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startWhiteboard");var d,e=c.data&&c.data.id?c.data.id:c.liveEventCommonData.eventId,f=a.getWhiteboard(),g=f.getSurfaceById(e),h=f.getActiveSurface()||f._recentlyActiveSurface,e=this._getParticipant(a,c);b.Base.Utils.isDefined(h)&&(h._active=!1),b.Base.Utils.isDefined(g)?(g._active=!0,f._activeSurface=g,f._onWhiteboardSurfaceSetActiveCallbacks.fire(f,g,e)):((d=this._createNewSurface(f,c.liveEventCommonData.eventId))._active=!0,f._activeSurface=d,f._onWhiteboardSurfaceAddedCallbacks.fire(f,d,e),f._onWhiteboardSurfaceSetActiveCallbacks.fire(f,d,e)),f._onWhiteboardStartedCallbacks.fire(f,d,e),f._recalculateRemoveWhiteboardCapability(a),f._recalculateAddWhiteboardCapability(a)},endWhiteboard:function(c,d){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endWhiteboard");var e=c.getWhiteboard(),d=this._getParticipant(c,d);e._recentlyActiveSurface=e._activeSurface,e._activeSurface=a,e._onWhiteboardEndedCallbacks.fire(e,d),e._recalculateRemoveWhiteboardCapability(c),e._recalculateAddWhiteboardCapability(c)},deleteWhiteboard:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteWhiteboard");var d,e=a.getWhiteboard(),f=e.getSurfaceById(c.data.id),g=this._getParticipant(a,c);f&&((d=f).isActive()&&(e._activeSurface=this._chooseNewActiveSurface(e,c.data.id)),-1<(f=e.getSurfaces().indexOf(f))&&e.getSurfaces().splice(f,1),e._onWhiteboardSurfaceRemovedCallbacks.fire(e,d,g),e._onWhiteboardSurfaceSetActiveCallbacks.fire(e,e.getActiveSurface(),g)),e._recalculateRemoveWhiteboardCapability(a)},startDrawShape:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startDrawShape");var d=a.getWhiteboard(),e=d.getSurfaceById(c.data.groupId);e&&((a=this._shapeConverter.convertLiveShape(c,a._selfParticipant.getParticipantId()))._tempId=c.liveEventCommonData.eventId,e._appendShape(c.liveEventCommonData.eventId,a),d._currentLiveDrawingWhiteboardIds[c.liveEventCommonData.senderId]=c.data.groupId,d._currentLiveDrawingShapes[c.liveEventCommonData.senderId]=a,e._onShapeAddedCallbacks.fire(e,a))},drawShape:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawShape");var d=a.getWhiteboard(),e=d.getSurfaceById(c.data.groupId);if(b.Base.Utils.isDefined(d._currentLiveDrawingShapes[c.liveEventCommonData.senderId])){
var f=(e=d.getSurfaceById(d._currentLiveDrawingWhiteboardIds[c.liveEventCommonData.senderId]))._getShapeById(d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].getId()),g=c.liveEventCommonData.senderId===a._selfParticipant.getParticipantId();if(f&&!g){if(0<c.data.m.length&&d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].addMovePoint(new b.Services.Collaboration.Point(c.data.m[0].x,c.data.m[0].y)),0<c.data.l.length)for(var h=0;h<c.data.l.length;h++)d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].addLinePoint(new b.Services.Collaboration.Point(c.data.l[h].x,c.data.l[h].y));e._onShapeUpdatedCallbacks.fire(e,d._currentLiveDrawingShapes[c.liveEventCommonData.senderId])}}else b.Base.Utils.isDefined(e)&&(a=this._shapeConverter.convertShape(c,a._selfParticipant.getParticipantId()),e._appendShape(c.liveEventCommonData.eventId,a),e._onShapeAddedCallbacks.fire(e,a))},endDrawShape:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endDrawShape");var d=a.getWhiteboard(),e=d.getSurfaceById(c.data.groupId);e&&d._currentLiveDrawingShapes[c.liveEventCommonData.senderId]&&(a=e._getShapeById(d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].getId()),e._removeShapeById(d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].getId()),a.setId(c.liveEventCommonData.eventId),e._appendShape(c.liveEventCommonData.eventId,a),e._onShapeUpdatedCallbacks.fire(e,a),a._tempId=c.liveEventCommonData.eventId,delete d._currentLiveDrawingWhiteboardIds[c.liveEventCommonData.senderId],d._currentLiveDrawingShapes[c.liveEventCommonData.senderId].finishDrawing(),delete d._currentLiveDrawingShapes[c.liveEventCommonData.senderId])},drawCircle:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawCircle");var d=a.getWhiteboard().getSurfaceById(c.data.groupId);d&&(a=this._shapeConverter.convertCircle(c,a._selfParticipant.getParticipantId()),d._appendShape(c.liveEventCommonData.eventId,a),d._onShapeAddedCallbacks.fire(d,a))},drawText:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawText");var d=a.getWhiteboard().getSurfaceById(c.data.groupId);d&&(a=this._shapeConverter.convertText(c,a._selfParticipant.getParticipantId()),d._appendShape(c.liveEventCommonData.eventId,a),d._onShapeAddedCallbacks.fire(d,a))},clearDrawing:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"clearDrawing"),c=a.getWhiteboard().getSurfaceById(c.data.groupId),c&&(c._clearShapes(),c._onSurfaceClearedCallbacks.fire(c))},moveSelection:function(a,c){var d=a.getWhiteboard().getSurfaceById(c.data.groupId);d&&((a=d._getShapeById(c.data.shapeId)).setTranslation(new b.Services.Collaboration.Point(c.data.moveToX,c.data.moveToY)),d._onShapeUpdatedCallbacks.fire(d,a))},deleteSelection:function(a,c){b.Base.Logger.debug(b.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteSelection"),a=a.getWhiteboard().getSurfaceById(c.data.groupId),!a||(c=a._getShapeById(c.data.shapeId))&&(a._onShapeDeletedCallbacks.fire(a,c),a._removeShapeById(c.getId()))},_createNewSurface:function(a,c){var d=new b.Services.Collaboration.WhiteboardSurface(a,a._whiteboardService);return a.getSurfaces().push(d),d._surfaceId=c,d},_chooseNewActiveSurface:function(a,c){var d=a.getSurfaces(),c=a.getSurfaceById(c),c=d.indexOf(c);return b.Base.Utils.isDefined(a.getActiveSurface())&&(a.getActiveSurface()._active=!1),0===c?1<d.length?(d[1]._active=!0,d[1]):(d[0]._active=!0,d[0]):(d[c-1]._active=!0,d[c-1])},_getParticipant:function(a,c){var d=(c.liveEventCommonData||c).senderId,e=(c.liveEventCommonData||c).senderName,c=a._participants.filter(function(a){return a.getParticipantId()===d})[0];return c||(c=new b.Services.Collaboration.Participant(d,e),a._participants.push(c)),c}},b.Providers.WCS.WCSWhiteboardHandler=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Analytics.AnalyticsErrorCode={NOTIFICATION_ERROR:"Notification failed",UNAUTHORIZED:"Unauthorized status",NETWORK_ERROR:"Network Error",MESSAGE_SENDING_ERROR:"Message sending error",CONNECTION_BACKOFF_ALGORITHM_ERROR:"connection Backoff Algorithm error",GETTING_CONVERSATIONS_ERROR:"Getting conversations error",SEARCHING_CONVERSATIONS_ERROR:"Searching conversations error",STARTING_COLLABORATION_ERROR:"Starting Collaboration is error",HOLD_CALL_ERROR:"Hold call error",TRANSFER_CALL_ERROR:"Transfer call error",ATTENDED_TRANSFER_CALL_ERROR:"Attended transfer call error",JOIN_CALL_ERROR:"Join call error",STARTING_CALL_ERROR:"Starting call is error",STOPPING_CALL_ERROR:"Stopping call is error",GETTING_CALL_STATISTICS_ERROR:"Getting call statistics error",SETTING_VIDEO_MODE_ERROR:"Setting video mode error",DENY_SEND_VIDEO_ERROR:"Deny send video error",ACCEPT_SEND_VIDEO_ERROR:"Accept send video error",MUTE_AUDIO_ERROR:"Mute audio error",UNMUTE_AUDIO_ERROR:"Unmute audio error",MUTE_VIDEO_ERROR:"Mute video error",UNMUTE_VIDEO_ERROR:"Unmute video error",MUTE_SPEAKER_ERROR:"Mute speaker error",UNMUTE_SPEAKER_ERROR:"Unmute speaker error",ACCEPT_CALL_ERROR:"accept call error",MEDIA_PRESERVED_ERROR:"Media preserved error",SEND_DTMF_ERROR:"send dtmf error",WEBRTC_NOT_SUPPORTED:"WebRTC not supported",NO_CALL_WAS_CREATED_ERROR:"No call was created"}}(),function(){"use strict";AvayaClientServices.Services.Call.AlertType={AUTO_CALLBACK:"AUTO_CALLBACK",AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL",AUTOMATIC_CALL_DISTRIBUTION_INTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_INTERNAL",DIRECT_AGENT_CALL_EXTERNAL:"DIRECT_AGENT_CALL_EXTERNAL",DIRECT_AGENT_CALL_INTERNAL:"DIRECT_AGENT_CALL_INTERNAL",DIRECT_AGENT_CALL_PRIORITY:"DIRECT_AGENT_CALL_PRIORITY",EXTERNAL:"EXTERNAL",HOLD_RECALL:"HOLD_RECALL",INTERCOM:"INTERCOM",INTERNAL:"INTERNAL",NONE:"NONE",PRIORITY:"PRIORITY",TRANSFER_RECALL:"TRANSFER_RECALL",UNSPECIFIED:"UNSPECIFIED"}}(),function(b){"use strict";function c(){this._requestedDirection=a,this._negotiatedDirection=a}c.prototype={getRequestedDirection:function(){return this._requestedDirection},_getNegotiatedDirection:function(){return this._negotiatedDirection},_setRequestedDirection:function(a){this._requestedDirection=a},_setNegotiatedDirection:function(a){this._negotiatedDirection=a}},b.Services.Call.AudioChannel=c}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Services.Call.AudioDetails=function(a){this.bytesTransmitted=a.bytesTransmitted,this.bytesReceived=a.bytesReceived,this.rtcBytesReceived=a.transportBytesReceived,this.packetsTransmitted=a.packetsTransmitted,this.packetsReceived=a.packetsReceived,this.roundTripTimeMilliseconds=a.roundTripTimeMilliseconds,this.packetLossTotalTransmitted=a.packetLossTotalTransmitted,this.packetLossTotalReceived=a.packetLossTotalReceived,this.jitterMillisecondsReceived=a.jitterMillisecondsReceived,this.totalAudioEnergyTransmitted=a.totalAudioEnergyTransmitted,this.totalAudioEnergyReceived=a.totalAudioEnergyReceived,this.audioLevelTransmitted=a.audioLevelTransmitted,this.audioLevelReceived=a.audioLevelReceived,this.codec=a.codec,this.fractionLostLocal=a.fractionLostLocal}}(),function(){"use strict";AvayaClientServices.Services.Call.AudioMode={SEND_RECEIVE:"SEND_RECEIVE",DISABLE:"DISABLE",ENABLE:"ENABLE"}}(),function(b){"use strict";function c(c,d,e){this._remoteAddress=c,this._presentationModeOnly=!!b.Base.Utils.isDefined(d)&&!!d,this._subject=e,this._avayaLineId=a,this._avayaLineOwner=a,this._conferenceID=a,this._conferencePasscode=a,this._portalToken=a,this._meetMeUserName=a,this._serviceGatewayURL=a,this._uccpURL=a,this._callType=b.Services.Call.CallType.CallTypeDefaultRegisteredService,this._authorizationToken=a,this._contextId=a}c.prototype={getRemoteAddress:function(){return this._remoteAddress},isPresentationModeOnly:function(){return b.Base.Utils.isDefined(this._presentationModeOnly)&&!!this._presentationModeOnly},getSubject:function(){return this._subject},getConferenceID:function(){return this._conferenceID},setConferenceID:function(a){this._conferenceID=a},getPasscode:function(){return this._conferencePasscode},setPasscode:function(a){this._conferencePasscode=a},getContextId:function(){return this._contextId},setContextId:function(a){this._contextId=a},getPortalToken:function(){return this._portalToken},setPortalToken:function(a){this._portalToken=a},getMeetMeUserName:function(){return this._meetMeUserName},setMeetMeUserName:function(a){this._meetMeUserName=a},getCallType:function(){return this._callType},setCallType:function(a){this._callType=a},getServiceGatewayURL:function(){return this._serviceGatewayURL},setServiceGatewayURL:function(a){this._serviceGatewayURL=a},setUccpURL:function(a){this._uccpURL=a},getUccpURL:function(){return this._uccpURL},getAvayaLineId:function(){return this._avayaLineId},getAvayaLineOwner:function(){return this._avayaLineOwner},setAuthorizationToken:function(a){this._authorizationToken=a},getAuthorizationToken:function(){return this._authorizationToken}},b.Services.Call.CallCreationInfo=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallDenialReason={BUSY:"BUSY",FORBIDDEN:"FORBIDDEN",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallDetails=function(a,b,c,d,e,f){this.callId=a,this.callingParticipant=b,this.calledParticipant=c,this.participants=d,this.connectionId=e,this.status=f}}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this._reason=a,this._reasonProtocol=b,this._reasonCause=c,this._reasonText=d}b.prototype={getReason:function(){return this._reason},getReasonProtocol:function(){return this._reasonProtocol},getReasonCause:function(){return this._reasonCause},getReasonText:function(){return this._reasonText},_setReason:function(a){this._reason=a}},a.Services.Call.CallEndEvent=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallEndReason={CALL_DISCONNECTED:"CALL_DISCONNECTED",CALL_DISCONNECTED_UNKNOWN_REASON:"CALL_DISCONNECTED_UNKNOWN_REASON",CALL_ENDED_LOCALLY:"CALL_ENDED_LOCALLY",DISCONNECTED_BY_CONFERENCE_MODERATOR:"DISCONNECTED_BY_CONFERENCE_MODERATOR",CONFERENCE_TERMINATED:"CONFERENCE_TERMINATED",DTLS_FAILURE:"DTLS_FAILURE",ICE_FAILURE:"ICE_FAILURE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallError={AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTO_HOLD_FAILED:"AUTO_HOLD_FAILED",BUSY:"BUSY",CALL_STATE_MISMATCH:"CALL_STATE_MISMATCH",CALL_NOT_FOUND:"CALL_NOT_FOUND",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CODEC_MISMATCH:"CODEC_MISMATCH",DEVICES_NOT_FOUND:"DEVICES_NOT_FOUND",MICROPHONE_NOT_FOUND:"MICROPHONE_NOT_FOUND",MICROPHONE_PERMISSION_DENIED:"MICROPHONE_PERMISSION_DENIED",MICROPHONE_NOT_ACCESSIBLE:"MICROPHONE_NOT_ACCESSIBLE",SPEAKERS_NOT_FOUND:"SPEAKERS_NOT_FOUND",CAMERA_NOT_FOUND:"CAMERA_NOT_FOUND",CAMERA_PERMISSION_DENIED:"CAMERA_PERMISSION_DENIED",CAMERA_NOT_ACCESSIBLE:"CAMERA_NOT_ACCESSIBLE",FAILED:"FAILED",TCP_TLS_TURN_NOT_SUPPORTED:"TCP_TLS_TURN_NOT_SUPPORTED",ENDED:"ENDED",IN_PROGRESS:"IN_PROGRESS",INTERNAL_ERROR:"INTERNAL_ERROR",INVALID_PARAMETER:"INVALID_PARAMETER",LINE_RESERVATION_ERROR:"LINE_RESERVATION_ERROR",MEDIA_CREATION_FAILURE:"MEDIA_CREATION_FAILURE",MEDIA_START_FAILURE:"MEDIA_START_FAILURE",MULTIPLE_CALLS_NOT_SUPPORTED:"MULTIPLE_CALLS_NOT_SUPPORTED",MEDIA_PATH_FAILURE:"MEDIA_PATH_FAILURE",MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED:"MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED",MUTE_STATE_MISMATCH:"MUTE_STATE_MISMATCH",NO_AVAILABLE_CALL_APPEARANCE:"NO_AVAILABLE_CALL_APPEARANCE",NOT_AUTHORIZED:"NOT_AUTHORIZED",NOT_FOUND:"NOT_FOUND",NOT_LICENSED:"NOT_LICENSED",NOT_REGISTERED:"NOT_REGISTERED",OVERCONSTRAINED:"OVERCONSTRAINED",REDIRECTED:"REDIRECTED",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",REMOTE_CALL_NOT_ALERTING:"REMOTE_CALL_NOT_ALERTING",REMOTE_MEDIA_PROCESSING_FAILURE:"REMOTE_MEDIA_PROCESSING_FAILURE",SEND_ERROR:"SEND_ERROR",SERVER_ERROR:"SERVER_ERROR",SESSION_ID_NOT_FOUND:"SESSION_ID_NOT_FOUND",SESSION_ID_ALREADY_CONNECTED:"SESSION_ID_ALREADY_CONNECTED",SUCCESS:"SUCCESS",TIMEOUT:"TIMEOUT",TRANSPORT_ERROR:"TRANSPORT_ERROR",UNDEFINED:"UNDEFINED",UNHANDLED_VIDEO_DIRECTION:"UNHANDLED_VIDEO_DIRECTION",USER_NOT_FOUND:"USER_NOT_FOUND",USER_TEMPORARILY_UNAVAILABLE:"USER_TEMPORARILY_UNAVAILABLE",VIDEO_DENIED:"VIDEO_DENIED",VIDEO_DEESCALATION_NOT_SUPPORTED:"VIDEO_DEESCALATION_NOT_SUPPORTED",WEBRTC_NOT_SUPPORTED:"WEBRTC_NOT_SUPPORTED",STATISTICS_UNAVAILABLE:"STATISTICS_UNAVAILABLE",MEDIA_PRESERVED:"MEDIA_PRESERVED",SERVICE_TEMPORARILY_UNAVAILABLE:"SERVICE_TEMPORARILY_UNAVAILABLE",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",VIDEO_ONLY_CALL_NOT_SUPPORTED:"VIDEO_ONLY_CALL_NOT_SUPPORTED",VIDEO_REJECTION_NOT_SUPPORTED:"VIDEO_REJECTION_NOT_SUPPORTED",COLLABORATION_ONLY_CALL_NOT_SUPPORTED:"COLLABORATION_ONLY_CALL_NOT_SUPPORTED",NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE:"NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE",NETWORK_EVENTS_SUBSCRIPTION_FAILED:"NETWORK_EVENTS_SUBSCRIPTION_FAILED",MEDIA_SERVICE_UNAVAILABLE:"MEDIA_SERVICE_UNAVAILABLE",INVALID_ACCEPTED_EVENTS:"INVALID_ACCEPTED_EVENTS"}}(),function(){"use strict";function a(a,b,c,d){this._error=a,this._protocolType=b,this._protocolErrorCode=c,this._protocolErrorReason=d}a.prototype={getError:function(){return this._error},getProtocolType:function(){return this._protocolType},getProtocolErrorCode:function(){return this._protocolErrorCode},getProtocolErrorReason:function(){return this._protocolErrorReason}},AvayaClientServices.Services.Call.CallException=a}(AvayaClientServices),function(b){"use strict";function c(c,d,e,f,g){this._providerFactory=c,this._mediaServiceFactory=d,this._callService={},this._callManager=new b.Services.Call.CallManager,this.calls=a,this._callProvider={},this._participantService=a,this._conferenceService=a,this._contactsIntegrationService=e,this._callsAnalyticsService=f,this._callPerformanceManager=g}c.prototype={init:function(a){this._callProvider=this._providerFactory.getCallProviders(a,this._mediaServiceFactory,this._callsAnalyticsService)[0],this._callService=new b.Services.Call.CallService(a,this._callProvider,this._callManager,this._mediaServiceFactory,this._contactsIntegrationService,this._callsAnalyticsService,this._providerFactory.getRemoteLoggerProvider()),this._callPerformanceManager.setCallService(this._callService),this.calls=new b.Services.Call.Calls(this._callManager,this._callService)},getCalls:function(){return this.calls},getCallService:function(){return this._callService},getCallManager:function(){return this._callManager}},b.Services.Call.CallFactory=c}(AvayaClientServices),function(b){"use strict";function c(){this._callsObject=a,this._calls=[],this._lastMissedCall=a}c.prototype={setCalls:function(a){this._callsObject=a},createCall:function(a){var c=new b.Services.Call.Call(a);return c._setServiceAvailability(a.isServiceAvailable()),a._config.sgConfiguration&&a._config.sgConfiguration.credentialProvider&&c._setIsGuestUser(a._config.sgConfiguration.credentialProvider.isGuest),this._calls.push(c),this._callsObject._callCreatedCallbacks.fire(c),c},createRemoteOrIncomingCall:function(c,d,e,f,g,h,i,j,k,l,m,n){var o=new b.Services.Call.Call(c);return o._setServiceAvailability(c.isServiceAvailable()),o._setCallId(d),o._setRemoteAddress(e),o._setRemoteDisplayName(f),o._isPrivateCallerID=!!b.Base.Utils.isDefined(h)&&h,o._isAuraAsserted=!!b.Base.Utils.isDefined(g)&&g,o._alertType=j,o._subject=k,i&&(o._incomingVideoOffered=b.Services.Call.VideoNetworkSignalingType.SUPPORTED),o._setRemote(!!b.Base.Utils.isDefined(m)&&m),o._setState(l),o._incoming=!!b.Base.Utils.isDefined(n)&&n,o.isRemote()&&this._lastMissedCall&&(this._lastMissedCall.getRemoteAddress()===e&&o._setIsMissed(!0),this._lastMissedCall=a),b.Base.Utils.isDefined(c._config.wcsConfiguration)&&b.Base.Utils.isDefined(c._config.wcsConfiguration.enabled)&&(o._webCollaboration=c._config.wcsConfiguration.enabled),this._calls.push(o),this._callsObject._callCreatedCallbacks.fire(o),o},createMakeCall:function(a,c,d,e,f,g){var h=new b.Services.Call.Call(a);return h._setServiceAvailability(a.isServiceAvailable()),h._setCallId(c),h._setRemoteAddress(d),b.Base.Utils.isDefined(e)&&h._setUserToUserInfo(new b.Services.Call.UserToUserInfo(e,f,g)),this._calls.push(h),this._callsObject._callCreatedCallbacks.fire(h),h},deleteCall:function(a){var b=this._calls.indexOf(a);-1<b&&(this._calls.splice(b,1),this._callsObject._callRemovedCallbacks.fire(a))},getCallCount:function(){return this._calls.length},_getLiveCallCount:function(){for(var a=0,c=0;c<this._calls.length;c++){var d=this._calls[c];d.getState()!==b.Services.Call.CallStates.ENDED&&d.getState()!==b.Services.Call.CallStates.ENDING&&a++}return a},setLastMissedCall:function(a){this._lastMissedCall=a},getLastMissedCall:function(){return this._lastMissedCall},getAllCalls:function(){return this._calls},getActiveCall:function(){for(var c=0;c<this._calls.length;c++){var d=this._calls[c];if(d.getState()===b.Services.Call.CallStates.ESTABLISHED&&!d.isRemote()||d.getState()===b.Services.Call.CallStates.RENEGOTIATING||d.getState()===b.Services.Call.CallStates.FAR_END_RENEGOTIATING)return d}return a},getIgnoredCalls:function(){return this._calls.filter(function(a){return a.getState()===b.Services.Call.CallStates.IGNORED})},getCallById:function(b){for(var c=0;c<this._calls.length;c++)if(this._calls[c].getCallId()===b)return this._calls[c];return a},getEndingCall:function(){if(this._calls&&this._calls.length)for(var a=this._calls.length-1;0<=a;a--){var c=this._calls[a];if(c.getState()===b.Services.Call.CallStates.ENDING)return c}},hasHeldCall:function(){for(var a=0;a<this._calls.length;a++)if(this._calls[a].getState()===b.Services.Call.CallStates.HELD)return!0;return!1},hasInitiatingCall:function(){for(var a=0;a<this._calls.length;a++){var c=this._calls[a];if(c.getState()===b.Services.Call.CallStates.INITIATING||c.getState()===b.Services.Call.CallStates.REMOTE_ALERTING||c.getState()===b.Services.Call.CallStates.IDLE)return!0}return!1},setCallMode:function(a,b){a=this._calls.indexOf(a),this._calls[a]._modes.push(b)},getCallModes:function(a){return a=this._calls.indexOf(a),a<0?[]:this._calls[a]._modes}},b.Services.Call.CallManager=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallModes={CONFERENCE_CALL:"conferenceCall",AV_COLLABORATION_CALL:"avCollaborationCall"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallProtocolType={APPLICATION:"APPLICATION",HTTP:"HTTP"}}(),function(c){"use strict";function d(b,d,e,f,g,h,i){c.Base.Observable.call(this),this._config=b,this._callProvider=d,this._callManager=e,this._mediaServiceFactory=f,this._remoteLoggerProvider=i,this._isServiceAvailable=!1,this._mediaServices=f.getMediaServices(),this._scopiaConferenceProviderFactory=new c.Providers.Scopia.ScopiaConferenceProviderFactory,this._contactsIntegrationService=g,this._onContactListChanged=a,this._videoLicenseEnabled=!0,this.videoResolution={},this._videoCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._calls=a,this._callsAnalyticsService=h,this._uploadLoggerProvider=a,this._isUploadedOnServiceUnavailable=!1,this._isRegistrationTerminated=!1,this._uploadIntervalTimer=a}(d.prototype=Object.create(c.Base.Observable.prototype)).setCollaborations=function(a){this._collaborations=a},d.prototype.startCall=function(b){if(c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"Call Service is starting..."),!this._isMakeCallAllowed(b))return this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),void this._notifyCallFailure(b,c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED);if(b.getState()!==c.Services.Call.CallStates.IDLE){var d=this._config._mediaServiceConfiguration?c.Services.Call.CallError.MULTIPLE_CALLS_NOT_SUPPORTED:c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("start",d),void this._notifyCallFailure(b,d)}if(b._setState(c.Services.Call.CallStates.INITIATING),b._callCreationInfo&&b._callCreationInfo.getAuthorizationToken()&&this._registerCallbacks(),b.addOnCallEndedCallback(function(a){this._stopCollaboration(a)}.bind(this)),b._isDataOnly()){c.Base.Utils.isUndefined(b.getAudioChannel())&&(b._audioChannel=this._callProvider.createAudioChannel_AudioMode(c.Services.Call.AudioMode.DISABLE));for(var e=this._callManager.getCallModes(b),f=0;f<e.length;f++){var g=e[f];if(g.id===c.Services.Call.CallModes.CONFERENCE_CALL)return void g.startCall(b)}}else{var h=b.getRemoteAddress();null!==h.match(/sips?:.*/)||-1!==(p=h.search(/,/))&&(b._setDtmfString(h.substring(p).split("")),b._setRemoteAddress(h.substring(0,p)))}var i=this._getMicrophoneAvailability(),j=this._getSpeakersAvailability(),k=this._getCameraAvailability(b),l=0<b.getVideoChannels().length;this._setupVideoResolution(b),this._setupDevicesListeners(b),this._setupAnalyticsListeners(b),this._setupStatisticsLogger(b);var m,n,o=c.Services.Call.MediaDirection.RECV_ONLY,d=c.Services.Call.MediaDirection.SEND_RECV,h=c.Services.Call.MediaDirection.SEND_RECV,p=b.getAudioChannel()&&b.getAudioChannel().getRequestedDirection()===c.Services.Call.MediaDirection.DISABLE;i||p?j||p?(this.isVideoEnabled()?l?(h=o=l=(p=b.getVideoChannels())[0]._getInternalRequestedDirection(),k||(l===c.Services.Call.MediaDirection.SEND_RECV?(p[0]._setRequestedDirection(c.Services.Call.MediaDirection.RECV_ONLY),c.Base.Logger.warn(c.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_RECV video direction to RECV_ONLY"),h=c.Services.Call.MediaDirection.RECV_ONLY):l===c.Services.Call.MediaDirection.SEND_ONLY&&(p[0]._setRequestedDirection(c.Services.Call.MediaDirection.INACTIVE),h=c.Services.Call.MediaDirection.INACTIVE,c.Base.Logger.warn(c.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_ONLY video direction to INACTIVE")))):this._isCollabCall(b)||this._setupNailedUpVideoConnection(b,c.Services.Call.VideoMode.RECEIVE_ONLY)&&(o=c.Services.Call.MediaDirection.RECV_ONLY,h=c.Services.Call.MediaDirection.INACTIVE):(o=c.Services.Call.MediaDirection.INACTIVE,d=c.Services.Call.MediaDirection.INACTIVE,h=c.Services.Call.MediaDirection.INACTIVE),!this._callProvider.isNailedUpVideoConnectionRequired()||b._isDataOnly()||this._isCollabCall(b)||(m=new c.Providers.Call.NailedUpVideoConnectionInfo(h,o,d)),c.Base.Utils.isUndefined(b.getAudioChannel())&&(b._audioChannel=this._callProvider.createAudioChannel_AudioMode(c.Services.Call.AudioMode.SEND_RECEIVE)),n=function(){return this._callProvider.startCall(b,this.isVideoEnabled(),this.isWebCollaborationEnabled(b),this.isUccpEnabled(),this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice(),this.videoResolution,m).fail(function(a){c.Base.Logger.warn("Failed to start call.",a),this.uploadLogs(),this._notifyCallFailure(b,c.Services.Call.CallError.FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Call.CallError.FAILED)}.bind(this))}.bind(this),(d=this._callManager.getActiveCall())!==a?(this._callProvider.setActiveCallVideoTrack(d.getCallId()),d.hold().then(function(){n()}.bind(this),function(a){c.Base.Logger.warn("Auto hold failed when starting call.",a),this.uploadLogs(),this._notifyCallFailure(b,c.Services.Call.CallError.AUTO_HOLD_FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Call.CallError.AUTO_HOLD_FAILED)}.bind(this))):n()):(c.Base.Logger.warn("Speaker is not available"),this.uploadLogs(),this._notifyCallFailure(b,c.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Call.CallError.SPEAKERS_NOT_FOUND)):(c.Base.Logger.warn("Microphone is not available"),this.uploadLogs(),this._notifyCallFailure(b,c.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Call.CallError.MICROPHONE_NOT_FOUND))},d.prototype._setupNailedUpVideoConnection=function(a,b){if(a._isDataOnly()||!this._callProvider.isNailedUpVideoConnectionRequired())return!1;var d=this._callProvider._createVideoChannel_VideoMode(c.Services.Call.VideoMode.DISABLE);return d._setInternalRequestedDirection(c.Providers.Call.Utils.getVideoDirection(b)),d._setChannelId("NailedUp_"+d.getChannelId()),a._videoChannels.push(d),!0},d.prototype._getMicrophoneAvailability=function(){var a=this._mediaServices.getAudioInterface().getInputInterface();return!a.getSelectDeviceCapability().isAllowed||a.hasAvailableDevices()},d.prototype._getSpeakersAvailability=function(){var a=this._mediaServices.getAudioInterface().getOutputInterface(),b=a.getSelectDeviceCapability().isAllowed,d=c.Base.Utils.getBrowserType(),a=d===c.Base.BrowserType.FIREFOX||d===c.Base.BrowserType.SAFARI||a.hasAvailableDevices();return!b||a},d.prototype._getCameraAvailability=function(a){var b=!1;0<a.getVideoChannels().length&&(b=a.getVideoChannels().reduce(function(a,b){return a&&b._getInternalRequestedDirection()===c.Services.Call.MediaDirection.RECV_ONLY},!0));var d=this._mediaServices.getVideoInterface(),a=d.getSelectDeviceCapability().isAllowed,d=d.hasAvailableDevices();return b||!a||d},d.prototype._setupDevicesListeners=function(a){var b=this._handleOnSelectedDeviceChanged(a).bind(this);this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceChangedCallback(b),this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(b);var c=this._handleOnSelectedDeviceRemoved;this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceRemovedCallback(c),this._mediaServices.getAudioInterface().getOutputInterface().addOnSelectedDeviceRemovedCallback(c),this._mediaServices.getVideoInterface().addOnSelectedDeviceRemovedCallback(c),a.addOnCallEndedCallback(function(){this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceChangedCallback(b),this._mediaServices.getVideoInterface().removeOnSelectedDeviceChangedCallback(b),this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceRemovedCallback(c),this._mediaServices.getAudioInterface().getOutputInterface().removeOnSelectedDeviceRemovedCallback(c),this._mediaServices.getVideoInterface().removeOnSelectedDeviceRemovedCallback(c)}.bind(this))},d.prototype._setupAnalyticsListeners=function(a){var b;a.addOnCallEstablishedCallback(function(){b=this._callsAnalyticsService.startTimingMetric(),this._callsAnalyticsService.setCallMediaTypes(Boolean(a._videoChannels.length))}.bind(this)),a.addOnCallVideoChannelsUpdatedCallback(function(){this._callsAnalyticsService.setCallMediaTypes(!0)}.bind(this)),a.addOnCallEndedCallback(function(){this._callsAnalyticsService.callTimeEnd(b),this._callsAnalyticsService.sendCallMediaTypes()}.bind(this))},d.prototype._setupStatisticsLogger=function(a){a.addOnCallEstablishedCallback(function(){a._isDataOnly()||a.startLoggingStatistics()}.bind(this)),a.addOnCallEndedCallback(function(){a._isDataOnly()||a.stopLoggingStatistics()}.bind(this))},d.prototype._setupVideoResolution=function(a){a.addOnCallEstablishedCallback(function(){var b=c.Base.Storage,d=b.get(b.TYPES.LOCAL,b.KEYS.VIDEO_RESOLUTIONS),e=new c.Base.VideoResolutionDetails,b=this.getVideoResolution(a),f=e.convertToConfigVideoResolution(b),g=(g=d?d.find(function(a){return a.negotiate===f}):g)&&g.limited||[f],g=this._getAverageLimitedResolution(g);this.setVideoSendResolution(a,g),this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,[])}.bind(this))},d.prototype._initAnalyticsMetrics=function(){var a,b;this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(d){a=this._callsAnalyticsService.startTimingMetric(),d=d&&d.getState()===c.Services.Call.CallStates.ESTABLISHED,b=this._callsAnalyticsService.callPreservationTimeStart(d)}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){this._callsAnalyticsService.serviceUnavailableTimeEnd(a);var c=this._callsAnalyticsService.callPreservationTimeEnd(b);this._callsAnalyticsService.sendPreservationEvent(!0,c)}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,function(){var a=this._callsAnalyticsService.callPreservationTimeEnd(b);this._callsAnalyticsService.sendPreservationEvent(!1,a)}.bind(this))},d.prototype._handleOnSelectedDeviceRemoved=function(a){var b=a.getAvailableDevices();a.getSelectDeviceCapability().isAllowed&&b.length&&a.setSelectedDevice(b[0])},d.prototype._handleOnSelectedDeviceChanged=function(a){return function(b,d){a.isRemote()||a.getState()!==c.Services.Call.CallStates.ESTABLISHED&&a.getState()!==c.Services.Call.CallStates.HELD&&a.getState()!==c.Services.Call.CallStates.RENEGOTIATING&&a.getState()!==c.Services.Call.CallStates.FAR_END_RENEGOTIATING||(a.getState()===c.Services.Call.CallStates.ESTABLISHED&&a._setState(c.Services.Call.CallStates.RENEGOTIATING),this._callProvider.updateDevices(a,d).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",c.Services.Call.CallError.FAILED)}.bind(this)).always(function(){a.getState()===c.Services.Call.CallStates.RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED)}))}.bind(this)},d.prototype._updateVideoResolution=function(a,d){if(a.isRemote()||a.getState()!==c.Services.Call.CallStates.ESTABLISHED&&a.getState()!==c.Services.Call.CallStates.HELD&&a.getState()!==c.Services.Call.CallStates.RENEGOTIATING&&a.getState()!==c.Services.Call.CallStates.FAR_END_RENEGOTIATING){var e=b.Deferred();return e.reject(),e.promise()}return this._callProvider.updateVideoResolution(a,d).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("updateVideoResolution",c.Services.Call.CallError.FAILED)}.bind(this))},d.prototype.endCall=function(a,b){if(a){if(a._isDataOnly())for(var d=this._callManager.getCallModes(a),e=0;e<d.length;e++){var f=d[e];if(f.id===c.Services.Call.CallModes.CONFERENCE_CALL)return void f.endCall(a)}return this._callProvider._cpCalls[a.getCallId()]&&a.isConference()&&this._disconnectCallFromConference(a),this._limitedVideoResolutionStoring(a),this._callProvider.stopCall(a,b).then(function(){this._triggerCallbacksAsync(a._remoteVideoRemovedCallbacks,a)}.bind(this),function(b){b.getError()===c.Services.Call.CallError.CALL_NOT_FOUND&&(b._error=c.Services.Call.CallError.ENDED,a._setState(c.Services.Call.CallStates.ENDED),this._callManager.deleteCall(a),this._callProvider.stopExternalGatewayProvider(a)),this._triggerCallbacksAsync(a._callFailedCallbacks,a,b),this._callsAnalyticsService.sendOperationFailureEvent("end",c.Services.Call.CallError.FAILED)}.bind(this))}},d.prototype.mute=function(a){return a.getMuteCapability().isAllowed?this._callProvider.muteAudio(a).then(function(){a._isAudioMuted=!0,this._triggerCallbacksAsync(a._onCallAudioMuteStatusChangedCallbacks,a,!0)}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("mute",c.Services.Analytics.AnalyticsErrorCode.MUTE_AUDIO_ERROR),b.Deferred().reject(a).promise()}.bind(this)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not mute call: "+a.getCallId()+": "+a.getMuteCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("mute",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.unmute=function(a){return a.getUnmuteCapability().isAllowed?this._callProvider.unmuteAudio(a).then(function(){a._isAudioMuted=!1,this._triggerCallbacksAsync(a._onCallAudioMuteStatusChangedCallbacks,a,!1)}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("unmute",c.Services.Analytics.AnalyticsErrorCode.UNMUTE_AUDIO_ERROR),b.Deferred().reject(a).promise()}.bind(this)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not un-mute call: "+a.getCallId()+": "+a.getUnmuteCapability().denialReason),
this._callsAnalyticsService.sendOperationFailureEvent("unmute",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.muteVideo=function(a){return a.getMuteVideoCapability().isAllowed?this._callProvider.muteVideo(a).then(function(){this._triggerCallbacksAsync(a._onCallVideoMuteStatusChangedCallbacks,a,!0)}.bind(this)).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("muteVideo",c.Services.Analytics.AnalyticsErrorCode.MUTE_VIDEO_ERROR)}.bind(this)):(c.Base.Logger.warn(c.Base.LoggerTags.CALL_SERVICE,"Incorrect mute video capability: "+a.getCallId()+": "+a.getMuteVideoCapability().denialReason),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.unmuteVideo=function(a){return a.getUnmuteVideoCapability().isAllowed?this._callProvider.unmuteVideo(a).then(function(){this._triggerCallbacksAsync(a._onCallVideoMuteStatusChangedCallbacks,a,!1)}.bind(this)).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("unmuteVideo",c.Services.Analytics.AnalyticsErrorCode.UNMUTE_VIDEO_ERROR)}.bind(this)):(c.Base.Logger.warn(c.Base.LoggerTags.CALL_SERVICE,"Incorrect unmute video: "+a.getCallId()+": "+a.getUnmuteVideoCapability().denialReason),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.muteSpeaker=function(a){if(a.getMuteSpeakerCapability().isAllowed)return this._callProvider.muteSpeaker(a).then(function(){a._isSpeakerMuted=!0,this._triggerCallbacksAsync(a._onCallSpeakerMuteStatusChangedCallbacks,a,!0)}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",c.Services.Analytics.AnalyticsErrorCode.MUTE_SPEAKER_ERROR),b.Deferred().reject(a).promise()}.bind(this));c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not mute speakers for call: "+a.getCallId()+": "+a.getMuteSpeakerCapability().denialReason);var d=c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",d),b.Deferred().reject(new c.Services.Call.CallException(d)).promise()},d.prototype.unmuteSpeaker=function(a){return a.getUnmuteSpeakerCapability().isAllowed?this._callProvider.unmuteSpeaker(a).then(function(){a._isSpeakerMuted=!1,this._triggerCallbacksAsync(a._onCallSpeakerMuteStatusChangedCallbacks,a,!1)}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",c.Services.Analytics.AnalyticsErrorCode.UNMUTE_SPEAKER_ERROR),b.Deferred().reject(a).promise()}.bind(this)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not un-mute speakers for call: "+a.getCallId()+": "+a.getUnmuteSpeakerCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.hold=function(a){if(a.getHoldCapability().isAllowed){a._setState(c.Services.Call.CallStates.HOLDING);var d=this._callProvider.hold(a);return d.then(function(){a._heldTime=new Date,a._setState(c.Services.Call.CallStates.HELD),this._triggerCallbacksAsync(a._onCallHeldCallbacks,a)}.bind(this),function(d){return a.getState()===c.Services.Call.CallStates.HOLDING&&a._setState(c.Services.Call.CallStates.ESTABLISHED),this._callsAnalyticsService.sendOperationFailureEvent("hold",c.Services.Analytics.AnalyticsErrorCode.HOLD_CALL_ERROR),b.Deferred().reject(d).promise()}.bind(this)),d}return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not hold call: "+a.getCallId()+": "+a.getHoldCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("hold",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.unhold=function(d){var e=this._callManager.getActiveCall(),f=function(){d._setState(c.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(d._onCallUnheldCallbacks,d)}.bind(this),g=function(a){return d.getState()===c.Services.Call.CallStates.UNHOLDING&&d._setState(c.Services.Call.CallStates.HELD),this._callsAnalyticsService.sendOperationFailureEvent("unhold",c.Services.Call.CallError.FAILED),b.Deferred().reject(a).promise()}.bind(this);return d.getUnholdCapability().isAllowed?e!==a?(d._setState(c.Services.Call.CallStates.UNHOLDING),e.hold().then(function(){return this._callProvider.unhold(d).then(f,g)}.bind(this),function(){var a=b.Deferred();return this._callsAnalyticsService.sendOperationFailureEvent("unhold",c.Services.Call.CallError.AUTO_HOLD_FAILED),a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.AUTO_HOLD_FAILED)),a.promise()}.bind(this))):this._callProvider.unhold(d).then(f,g):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not un-hold call: "+d.getCallId()+": "+d.getUnholdCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unhold",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.ignore=function(a){var d=b.Deferred();return a.getState()===c.Services.Call.CallStates.ALERTING?(a._setState(c.Services.Call.CallStates.IGNORED),this._triggerCallbacksAsync(a._onCallIgnoredCallbacks,a),d.resolve()):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not ignore call: "+a.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("ignore",c.Services.Call.CallError.CALL_STATE_MISMATCH),d.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_STATE_MISMATCH))),d.promise()},d.prototype._triggerCallbacksAsync=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();b&&setTimeout(function(){b.fire.apply(null,a)},0)},d.prototype._notifyCallFailure=function(a,b,d,e,f){a._setState(c.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(a._callFailedCallbacks,a,new c.Services.Call.CallException(b,d,e,f))},d.prototype._stopCollaboration=function(a){var b;this._collaborations&&(this._collaborations._isCollaborationForCall(a.getCallId())?(b=this._collaborations.getCollaborationForCall(a.getCallId())).stop().always(function(){this._collaborations._deleteCollaboration(b._collaborationId)}.bind(this)):this._collaborations._isCollaborationForCall("standalone")&&(b=this._collaborations.getCollaborationForCall("standalone")).stop().always(function(){this._collaborations._deleteCollaboration(b._collaborationId)}.bind(this)))},d.prototype.accept=function(d){d._setIsMissed(!1),d.getServiceQualityScoreCapability()._recalculate(),d.addOnCallEndedCallback(function(a){this._stopCollaboration(a)}.bind(this));var e=this._getMicrophoneAvailability(),f=this._getSpeakersAvailability();return this._setupVideoResolution(d),this._setupDevicesListeners(d),this._setupAnalyticsListeners(d),this._setupStatisticsLogger(d),e?f?d.getState()!==c.Services.Call.CallStates.ALERTING&&d.getState()!==c.Services.Call.CallStates.IGNORED?(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+d.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Call.CallError.CALL_STATE_MISMATCH),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_STATE_MISMATCH)).promise()):(0<d.getVideoChannels().length&&(this._getCameraAvailability(d)||d.getVideoChannels()[0]._setRequestedDirection(c.Services.Call.MediaDirection.RECV_ONLY)),f=this._callManager.getActiveCall(),f!==a?f.hold().then(function(){return this._callProvider.accept(d,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))}.bind(this),function(a){return a&&a.getError()===c.Services.Call.CallError.ENDED?this._callProvider.accept(d,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this)):(a=b.Deferred(),this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Call.CallError.AUTO_HOLD_FAILED),a.reject(new c.Services.Call.CallException(c.Services.Call.CallError.AUTO_HOLD_FAILED)),a.promise())}.bind(this)):this._callProvider.accept(d,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+d.getCallId()+": Speakers not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Call.CallError.SPEAKERS_NOT_FOUND),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.SPEAKERS_NOT_FOUND))):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+d.getCallId()+": Microphone not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",c.Services.Call.CallError.MICROPHONE_NOT_FOUND),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.MICROPHONE_NOT_FOUND)))},d.prototype.acceptSendVideo=function(a,d){function e(){a.getState()===c.Services.Call.CallStates.FAR_END_RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED)}if(a.getState()!==c.Services.Call.CallStates.FAR_END_RENEGOTIATING&&a.getState()!==c.Services.Call.CallStates.ESTABLISHED)return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not acceptSendVideo for call: "+a.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",c.Services.Call.CallError.AUTO_HOLD_FAILED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(function(b,d){this._callProvider.updateDevices(a,d).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",c.Services.Call.CallError.FAILED)}.bind(this))}.bind(this)),this._getCameraAvailability(a)||(d=c.Services.Call.VideoMode.RECEIVE_ONLY);var f=function(a){return e(),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",c.Services.Analytics.AnalyticsErrorCode.ACCEPT_SEND_VIDEO_ERROR),b.Deferred().reject(a).promise()}.bind(this);return this._callProvider.acceptSendVideo(a,this._mediaServices.getVideoInterface().getSelectedDevice(),d).then(e,f)},d.prototype.denySendVideo=function(a){function d(){a.getState()===c.Services.Call.CallStates.FAR_END_RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED)}if(a.getState()!==c.Services.Call.CallStates.FAR_END_RENEGOTIATING&&a.getState()!==c.Services.Call.CallStates.ESTABLISHED)return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not denySendVideo for call: "+a.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",c.Services.Call.CallError.CALL_STATE_MISMATCH),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();var e=function(a){return d(),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",c.Services.Analytics.AnalyticsErrorCode.DENY_SEND_VIDEO_ERROR),b.Deferred().reject(a).promise()}.bind(this);return this._callProvider.denySendVideo(a).then(d,e)},d.prototype.transfer=function(a,d){if(a.getTransferCapability().isAllowed){var e=a.getState();return a._setState(c.Services.Call.CallStates.TRANSFERRING),this._callProvider.transfer(a,d).then(function(){a._setState(c.Services.Call.CallStates.ESTABLISHED)},function(d){return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Unattended transfer failed: "+d),a._setState(e),this._callsAnalyticsService.sendOperationFailureEvent("transfer",c.Services.Analytics.AnalyticsErrorCode.TRANSFER_CALL_ERROR),b.Deferred().reject(d).promise()}.bind(this))}return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not transfer call: "+a.getCallId()+": "+a.getTransferCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("transfer",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.attendedTransfer=function(a,d){if(a.getTransferCapability().isAllowed&&d.getTransferToCapability().isAllowed){var e=a.getState();return a._setState(c.Services.Call.CallStates.TRANSFERRING),this._callProvider.attendedTransfer(a,d).then(function(){a._setState(c.Services.Call.CallStates.ESTABLISHED)},function(d){return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Attended transfer failed: "+d),a._setState(e),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",c.Services.Analytics.AnalyticsErrorCode.ATTENDED_TRANSFER_CALL_ERROR),b.Deferred().reject(d).promise()}.bind(this))}return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not attended transfer call: "+a.getCallId()+": "+a.getTransferCapability().denialReason+" "+d.getTransferToCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.join=function(d){if(!d.getJoinCapability().isAllowed)return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not join call: "+d.getCallId()+": "+d.getJoinCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var e=this._getMicrophoneAvailability(),f=this._getSpeakersAvailability();if(this._setupDevicesListeners(d),this._setupAnalyticsListeners(d),this._setupStatisticsLogger(d),e){if(f)return d.getServiceQualityScoreCapability()._recalculate(),f=this._callManager.getActiveCall(),f!==a&&f.getCallId()!==d.getCallId()?f.hold().then(function(){return this._callProvider.join(d,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this))}.bind(this),function(){return this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Call.CallError.AUTO_HOLD_FAILED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.AUTO_HOLD_FAILED))}.bind(this)):this._callProvider.join(d,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this));this._notifyCallFailure(d,c.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Call.CallError.SPEAKERS_NOT_FOUND)}else this._notifyCallFailure(d,c.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",c.Services.Call.CallError.MICROPHONE_NOT_FOUND)},d.prototype.start=function(a){return this._startDfd=b.Deferred(),this._calls=a,this._config.mediaConfiguration&&this._config.mediaConfiguration.voipConfigurationVideo&&this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork&&(this.videoResolution=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork,c.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution])||c.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution]),this._recalculateVideoCapability(),this._registerCallbacks(),this._callProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(c.Base.Utils.isUndefined(a._isAvailable)||a._isAvailable)&&(a._isAvailable=!1,this._triggerCallbacksAsync(a._callsServiceUnavailableCallbacks,a))}.bind(this)),this._callProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,this._triggerCallbacksAsync(a._callsServiceAvailableCallbacks,a))}.bind(this)),this._initAnalyticsMetrics(),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,this._triggerCallbacksAsync(a._callsServiceAvailableCallbacks,a),this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest&&a._triggerRegistrationStatus(!0)),a._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNSUPPORTED,function(){this._isServiceAvailable=!1,a._isAvailable=!1,a._isAvailable=!0,this._triggerCallbacksAsync(a._callsServiceUnavailableCallbacks,a),this.trigger(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[])}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(){!c.Base.Utils.isUndefined(a._isAvailable)&&!a._isAvailable&&this._isServiceAvailable||(a._isAvailable=!1,this._triggerCallbacksAsync(a._callsServiceUnavailableCallbacks,a)),a._voipCallingCapability._recalculate(),this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.reject()}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,function(){a._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,function(){a._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,function(a,b,d){var e=c.Base.Utils.parseUrl(a);e&&(c.Base.Logger.info("Initializing remote logger provider"),e=new c.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path),this._uploadLoggerProvider=this._remoteLoggerProvider.getProvider(c.Providers.RemoteLogger.Names.MPAAS),this._uploadLoggerProvider.start(e,a,b,this._config._mediaServiceConfiguration.sessionId,d,this._config.sgConfiguration.credentialProvider).then(function(){this.uploadLogs()}.bind(this)))}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,function(a,b){this._triggerCallbacksAsync(a._onAudioStreamUpdatedCallback,a,b)}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,function(b){a._triggerRegistrationStatus(!0)}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,function(b,c){a._triggerRegistrationStatus(!1),"REGISTRATION_TERMINATED"===c&&(this._isRegistrationTerminated=!0,a._voipCallingCapability._recalculate(),this._callProvider.stop().always(function(){this._isServiceAvailable=!1,a._isAvailable=!1,this._triggerCallbacksAsync(a._callsServiceUnavailableCallbacks,a)}.bind(this)))}.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,function(a){a.getEstablishedTime()&&a.getState()===c.Services.Call.CallStates.ESTABLISHED&&a._setState(c.Services.Call.CallStates.RENEGOTIATING)}),this._callProvider.start(this._config,this.videoResolution).then(function(b){return this._onContactListChanged=function(){this._callManager.getAllCalls().forEach(this._updateMatchedContactsForCall,this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.resolve(),!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,this._triggerCallbacksAsync(a._callsServiceAvailableCallbacks,a)),b}.bind(this),function(a){this._callsAnalyticsService.sendOperationFailureEvent("start",c.Services.Analytics.AnalyticsErrorCode.STARTING_CALL_ERROR),this._startDfd.reject(a)}.bind(this)),this._startDfd.promise()},d.prototype.stop=function(){return this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer),this._limitedVideoResolutionStoring(),this._callProvider.stop().then(function(b){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=a,this._calls=a,b}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("stop",c.Services.Analytics.AnalyticsErrorCode.STOPPING_CALL_ERROR),b.Deferred().reject(a).promise()}.bind(this))},d.prototype.stopImmediately=function(){return this._limitedVideoResolutionStoring(),this._callProvider.stopImmediately().fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("stopImmediately",c.Services.Call.CallError.FAILED)}.bind(this))},d.prototype.sendDTMF=function(a,d){return a.getSendDTMFCapability().isAllowed?this._callProvider.sendDTMF(a,d).fail(function(a){this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",c.Services.Analytics.AnalyticsErrorCode.SEND_DTMF_ERROR)}.bind(this)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not send DTMF for call: "+a.getCallId()+": "+a.getSendDTMFCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},d.prototype.isVideoEnabled=function(){var a=c.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");return this._videoLicenseEnabled&&(!!a||c.Base.Utils.isUndefined(a))},d.prototype.isWebCollaborationEnabled=function(a){return a._webCollaboration},d.prototype.isUccpEnabled=function(){return!(!c.Base.Utils.isDefined(this._config.uccpConfiguration)||!c.Base.Utils.isDefined(this._config.uccpConfiguration.enabled))&&this._config.uccpConfiguration.enabled},d.prototype.setVideoChannels=function(a,b){return 0===b.length?this.setVideoMode(a,c.Services.Call.VideoMode.DISABLE):this.setVideoMode(a,this._getVideoMode(b[0].direction))},d.prototype._getVideoMode=function(a){switch(a){case c.Services.Call.MediaDirection.SEND_RECV:return c.Services.Call.VideoMode.SEND_RECEIVE;case c.Services.Call.MediaDirection.SEND_ONLY:return c.Services.Call.VideoMode.SEND_ONLY;case c.Services.Call.MediaDirection.RECV_ONLY:return c.Services.Call.VideoMode.RECEIVE_ONLY;case c.Services.Call.MediaDirection.DISABLE:return c.Services.Call.VideoMode.DISABLE;default:return c.Services.Call.VideoMode.INACTIVE}},d.prototype.setVideoMode=function(a,d,e){if(a.getState()===c.Services.Call.CallStates.IDLE||a.getState()===c.Services.Call.CallStates.ALERTING||a.getState()===c.Services.Call.CallStates.IGNORED||a.getUpdateVideoChannelsCapability().isAllowed){if(!this._isSetVideoModeCapabilityAllowed(a,d))return b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));a.getState()===c.Services.Call.CallStates.ESTABLISHED&&a._setState(c.Services.Call.CallStates.RENEGOTIATING);var f=function(){a.getState()===c.Services.Call.CallStates.RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED)},g=function(a){return f(),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",c.Services.Analytics.AnalyticsErrorCode.SETTING_VIDEO_MODE_ERROR),b.Deferred().reject(a).promise()}.bind(this),d=this._callProvider.setVideoMode(a,d,this._mediaServices.getVideoInterface().getSelectedDevice(),e);return d.then(function(){var b;f(),this._collaborations&&this._collaborations._isCollaborationForCall(a.getCallId())&&(b=this._collaborations.getCollaborationForCall(a.getCallId())).getContentSharing()._recalculateShareContentVideoCapability(b)}.bind(this),g),this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,[e]),d}return c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not setVideoMode for call: "+a.getCallId()+": "+a.getUpdateVideoChannelsCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.setVideoSendResolution=function(a,d){var e,f=a.getVideoChannels();return 0<f.length?(f=f[0].getNegotiatedDirection(),f===c.Services.Call.MediaDirection.SEND_ONLY||f===c.Services.Call.MediaDirection.SEND_RECV?this._callProvider.setVideoSendResolution(a,d):(e="The call does not have an active send video channel",b.Deferred().reject(e).promise())):(e="The call does not have a video channel",b.Deferred().reject(e).promise())},d.prototype.getVideoSendBandwidth=function(a){return this._callProvider.getVideoSendBandwidth(a)},d.prototype.getVideoBandwidth=function(a){return this._callProvider.getVideoBandwidth(a)},d.prototype.getVideoResolution=function(a){return this._callProvider.getVideoResolution(a)},d.prototype.getNegotiatedVideoResolutionByCallId=function(a){return a=this._callManager.getCallById(a),a?this._callProvider.getVideoResolution(a):this.getDefaultVideoResolution()},d.prototype.getVideoSendResolution=function(a){return this._callProvider.getVideoSendResolution(a)},d.prototype.hasVideoTracks=function(a){return this._callProvider.hasVideoTracks(a)},d.prototype._isSetVideoModeCapabilityAllowed=function(a,b){switch(b){case c.Services.Call.VideoMode.SEND_RECEIVE:return a.getState()===c.Services.Call.CallStates.IDLE||a.getUpdateVideoModeSendReceiveCapability().isAllowed;case c.Services.Call.VideoMode.SEND_ONLY:return a.getState()===c.Services.Call.CallStates.IDLE||a.getUpdateVideoModeSendOnlyCapability().isAllowed;case c.Services.Call.VideoMode.RECEIVE_ONLY:return a.getState()===c.Services.Call.CallStates.IDLE||a.getUpdateVideoModeReceiveOnlyCapability().isAllowed;case c.Services.Call.VideoMode.INACTIVE:return a.getState()===c.Services.Call.CallStates.IDLE||a.getUpdateVideoModeInactiveCapability().isAllowed;case c.Services.Call.VideoMode.DISABLE:return a.getUpdateVideoModeDisableCapability().isAllowed;default:return!1}},d.prototype.setAudioMode=function(a,d){return a.getUpdateAudioModeCapability().isAllowed||d===c.Services.Call.AudioMode.DISABLE?this._callProvider.setAudioMode(a,d):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not setAudioMode for call: "+a.getUpdateAudioModeCapability().denialReason),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},d.prototype.setWebCollaboration=function(a,d){return a.getUpdateWebCollaborationCapability().isAllowed||this._isCollabCallCapable(a)?(a._webCollaboration=d,this._callProvider.setWebCollaboration(a,d)):(c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Could not setWebCollaboration for call: "+a.getUpdateWebCollaborationCapability().denialReason),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},d.prototype.isServiceAvailable=function(){return this._isServiceAvailable},d.prototype.getVideoCapability=function(){return this._videoCapability},d.prototype.getDefaultVideoResolution=function(){return this._config.mediaConfiguration.voipConfigurationVideo.videoResolution},d.prototype._recalculateVideoCapability=function(){var a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this.isServiceAvailable()&&this.isVideoEnabled()&&this._config.mediaConfiguration.mediaEngineEnabled||(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._videoCapability._updateIfChanged(a,b)},d.prototype.startRinging=function(a){return this._callProvider.startRinging(a)},d.prototype.acceptAnswerCallRequest=function(a){return this._callProvider.acceptAnswerCallRequest(a)},d.prototype.acceptTerminateCallRequest=function(a){return this._callProvider.acceptTerminateCallRequest(a)},d.prototype.acceptUpdateCallRequest=function(a,b){return this._callProvider.acceptUpdateCallRequest(a,b)},d.prototype.acceptMakeCallRequest=function(a){return this._callProvider.acceptMakeCallRequest(a)},d.prototype.rejectAnswerCallRequest=function(a){return this._callProvider.rejectAnswerCallRequest(a)},d.prototype.rejectTerminateCallRequest=function(a){return this._callProvider.rejectTerminateCallRequest(a)},d.prototype.rejectUpdateCallRequest=function(a,b){return this._callProvider.rejectUpdateCallRequest(a,b)},d.prototype.rejectMakeCallRequest=function(a){return this._callProvider.rejectMakeCallRequest(a)},d.prototype.isAudioOrDataOnly=function(a){if(a){var b=this._callManager.getCallById(a);if(b)return a=b.getVideoChannels(),b._sessionId&&(b._isDataOnly()||0===a.length||a[0].isDisabled())}return!1},d.prototype.isMPaasCall=function(a){return!!a&&(a=this._callManager.getCallById(a),a&&a._sessionId)},d.prototype.startContentVideoSharing=function(a,d){return this.isMPaasCall(a)&&!this.isAudioOrDataOnly(a)?this._callProvider.startContentVideoSharing(a,d):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype.stopContentVideoSharing=function(a){var b=this._callManager.getCallById(a);return b&&b.muteVideo(),this._callProvider.stopContentVideoSharing(a)},d.prototype.updateAudioSourceForVideoSharing=function(a,b){return this._callProvider.updateAudioSourceForVideoSharing(a,b)},d.prototype._registerCallbacks=function(){this._callProvider._removeListeners(),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,this._conferenceEscalationHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,this._callStartedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,this._callRingingHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,this._callEstablishingHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,this._iceConnectionUpdateHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,this._incomingCallHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,this._incomingAddVideoRequestHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,this._incomingAddVideoAcceptedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,this._incomingAddVideoDeniedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,this._incomingAddVideoTimedOutHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,this._incomingHoldHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,this._incomingUnholdHandler.bind(this)),
this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,this._videoChannelUpdateHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,this._callEndedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,this._callFailureHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,this._callServiceUnavailableHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,this._callServiceAvailableHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,this._remoteAddressChangedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,this._remoteCallCreatedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,this._performanceManagerProfileChangedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,this._performanceMonitorAlertHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,this._answerCallRequestedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,this._terminateCallRequestedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,this._updateCallRequestedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,this._makeCallRequestedHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,this._allowedNailedUpVideoModesHandler.bind(this)),this._callProvider.on(c.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,this._callMediaFailedHandler.bind(this))},d.prototype._conferenceEscalationHandler=function(b,d,e,f){var g,h,i,j;e=b._webCollaboration&&c.Base.Utils.isNotEmptyString(e)?e:a,f?(b.isConference()?c.Base.Utils.isDefined(d)&&null!==d&&(this._config.uccpConfiguration.enabled?b._conference._isStarted?b._conference.stop().then(function(){g=this._parseUccpUrl(d),b._conference._setConfiguration(g)}.bind(this)):(g=this._parseUccpUrl(d),b._conference._setConfiguration(g),!c.Base.Utils.isUndefined(e)&&0!==e.length||this.watchForWebCollaborationURIChanges(b)):d=a,b._conference._collaborationURI=e,c.Base.Utils.isDefined(e)&&0<e.length&&this.createCollaborationForConference(b,e)):c.Base.Utils.isDefined(d)&&null!==d?(this._config.uccpConfiguration.enabled?(g=this._parseUccpUrl(d),j=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(g),h=new c.Services.Conference.Chat(this.createChatService(j)),i=this.createParticipantService(j),j=new c.Services.Conference.ConferenceService(c.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,j,this._contactsIntegrationService),b._setConference(new c.Services.Conference.Conference(j,i,h)),b._conference._isUccpConference=!0,b._conference._setConfiguration(g),!c.Base.Utils.isUndefined(e)&&0!==e.length||this.watchForWebCollaborationURIChanges(b)):(d=a,j=new c.Services.Conference.ConferenceService(c.Services.Conference.ConferenceType.SCOPIA_CONFERENCE),b._setConference(new c.Services.Conference.Conference(j)),b._conference._isUccpConference=!1),b._conference._collaborationURI=e,c.Base.Utils.isDefined(e)&&0<e.length&&this.createCollaborationForConference(b,e)):c.Base.Utils.isDefined(e)&&0<e.length?(f=!1,this.createCollaborationForCall(b,e)):b._createCMConference(),this._triggerCallbacksAsync(b._onCallConferenceStatusChangedCallbacks,b,f,d,e)):c.Base.Utils.isDefined(e)&&0<e.length&&(this.createCollaborationForCall(b,e),this._triggerCallbacksAsync(b._onCallConferenceStatusChangedCallbacks,b,f,d,e))},d.prototype.getScopiaConferenceProvider=function(a){return a=c.Base.Utils.isDefined(a)?a:this._config.uccpConfiguration,this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(a)},d.prototype.createChatService=function(a){return new c.Services.Conference.ChatService(a)},d.prototype.createParticipantService=function(a){return new c.Services.Conference.ParticipantService(a)},d.prototype.createCollaborationForConference=function(a,b){this._collaborations&&(a.getCallId()?a._conference._setCollaboration(this._collaborations.getCollaborationForCall(a.getCallId())):a._conference._setCollaboration(this._collaborations.getCollaborationForCall("standalone")),c.Base.Utils.isDefined(b)&&0<b.length&&(b=this._parseWebCollabUrl(b),this._config.wcsConfiguration=b,a._conference._collaboration._setConfiguration(this._config,b.meetingId)),this.watchForWebCollaborationURIChanges(a))},d.prototype.watchForWebCollaborationURIChanges=function(a){this._collaborations&&a._conference.addOnConferenceCollaborationURIChangedCallback(function(b,d){var e;c.Base.Utils.isDefined(d)&&0<d.length&&(e=this._parseWebCollabUrl(d),c.Base.Utils.isUndefined(b._collaboration)&&(a.getCallId()?b._setCollaboration(this._collaborations.getCollaborationForCall(a.getCallId())):b._setCollaboration(this._collaborations.getCollaborationForCall("standalone"))),b._collaborationURI===d&&!c.Base.Utils.isUndefined(b._collaboration._config)||(b._collaboration._isStarted?b._collaboration.stop().then(function(){this._config.wcsConfiguration=e,b._collaboration._setConfiguration(this._config,e.meetingId),b._collaboration.start()}.bind(this)):(this._config.wcsConfiguration=e,b._collaboration._setConfiguration(this._config,e.meetingId))))}.bind(this))},d.prototype.createCollaborationForCall=function(a,b){a.getCallId()&&(a=this._collaborations.getCollaborationForCall(a.getCallId()),c.Base.Utils.isDefined(b)&&0<b.length&&(b=this._parseWebCollabUrl(b),this._config.wcsConfiguration=b,a._setConfiguration(this._config,b.meetingId)))},d.prototype._parseUccpUrl=function(b){return b=c.Base.Utils.parseUrl(b),c.Base.Utils.isDefined(b)?{enabled:!0,networkProviderConfiguration:{webSocketConfig:new c.Config.ServerInfo(b.hostname,b.port,b.isSecure,b.path,b.credentials,b.query)}}:a},d.prototype._parseWebCollabUrl=function(b){var d,e,f,g,h;return c.Base.Utils.isDefined(b)&&0<b.length&&(d=(g=c.Base.Utils.parseUrl(b)).path.indexOf("/viewer.php"),f=g.path.substring(0,d),e="https:"===document.location.protocol||"chrome-extension:"===document.location.protocol,h=new c.Config.ServerInfo(g.hostname,g.port,e,f),(b=g.query.split("&").map(function(a){return a=a.split("="),{key:a[0],value:a[1]}})).getValue=function(a){var b=this.filter(function(b){return b.key===a});return 0!==b.length?b[0].value:null},d=b.getValue("token"),e=b.getValue("meeting_id"),f=b.getValue("mode"),g=b.getValue("login"),b=b.getValue("participantId"),h={enabled:!0,meetingId:e,credentialProvider:new c.Config.WCSCredentialTokenProvider(d,g,b,a,f),networkProviderConfiguration:{restConfig:h}}),h},d.prototype._callStartedHandler=function(a){this._triggerCallbacksAsync(a._onCallStartedCallbacks,a)},d.prototype._callRingingHandler=function(a,b){a.getState()===c.Services.Call.CallStates.ESTABLISHED?a._setState(c.Services.Call.CallStates.BEING_TRANSFERRED):a.getState()!==c.Services.Call.CallStates.HELD&&a._setState(c.Services.Call.CallStates.REMOTE_ALERTING),a._isEarlyMedia=b,a._sendDTMFCapability._recalculate(b),this._triggerCallbacksAsync(a._onCallRemoteAlertingCallbacks,a,b),c.Base.Utils.isDefined(a._dtmfString)&&b&&this._handleDTMFString(a)},d.prototype._callEstablishedHandler=function(b,d,e,f,g,h){b._heldRemotely=!1,b._establishedTime=new Date,b.getState()!==c.Services.Call.CallStates.HELD&&b._setState(c.Services.Call.CallStates.ESTABLISHED),c.Base.Utils.isDefined(f)&&b._setUserToUserInfo(new c.Services.Call.UserToUserInfo(f,g,h)),this.uploadLogs(),this._triggerCallbacksAsync(b._onCallEstablishedCallbacks,b),h=b.getAudioChannel(),b.getState()!==c.Services.Call.CallStates.HELD&&h&&h._getNegotiatedDirection()===c.Services.Call.MediaDirection.RECV_ONLY&&this._incomingHoldHandler(b),b.isRemote()&&!1===e&&(this._callManager.setLastMissedCall(a),b._setRemote(!1),b._setIsMissed(!1),this._triggerCallbacksAsync(b._onCallJoinedCallbacks,b)),c.Base.Utils.isDefined(b._dtmfString)&&!b._isEarlyMedia&&this._handleDTMFString(b),this._callsAnalyticsService.sendCallInfo(b._incoming,b._videoChannels.length),this._callsAnalyticsService.sendCallType(d)},d.prototype._callEstablishingHandler=function(a){var b=a.getUserToUserInfo();b&&c.Base.Utils.isDefined(b.getUCID())&&this._triggerCallbacksAsync(a._onCallEstablishingCallbacks,a)},d.prototype._remoteCallCreatedHandler=function(a,b,d,e,f,g,h,i){i=this._callManager.createRemoteOrIncomingCall(this,a,b,d,e,f,g,h,i,c.Services.Call.CallStates.ESTABLISHED,!0,!1),this._callProvider.registerIncomingOrRemoteCall(i)},d.prototype._performanceManagerProfileChangedHandler=function(a){this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[a])},d.prototype._performanceMonitorAlertHandler=function(a,b){this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,[a,b])},d.prototype._incomingCallHandler=function(b,d,e,f,g,h,i,j,k,l,m){var n;this._isWebRTCSupportedBrowser()&&((n=this._callManager.getActiveCall())!==a&&this._callProvider.setActiveCallVideoTrack(n.getCallId()),j=this._callManager.createRemoteOrIncomingCall(this,b,d,e,f,g,h,i,j,c.Services.Call.CallStates.ALERTING,!1,!0),c.Base.Utils.isDefined(k)&&j._setUserToUserInfo(new c.Services.Call.UserToUserInfo(k,l,m)),this._callProvider.registerIncomingOrRemoteCall(j),this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.INCOMING_CALL,[j]),(c.Base.Utils.isUndefined(this._config.callUserConfiguration.startRingingOnIncomingCall)||this._config.callUserConfiguration.startRingingOnIncomingCall)&&this.startRinging(j))},d.prototype._incomingAddVideoRequestHandler=function(a,b){a._setState(c.Services.Call.CallStates.FAR_END_RENEGOTIATING),this._triggerCallbacksAsync(a._onCallIncomingVideoAddRequestReceivedCallbacks,a,b)},d.prototype._incomingAddVideoAcceptedHandler=function(a){this._triggerCallbacksAsync(a._onCallIncomingVideoAddRequestAcceptedCallbacks,a)},d.prototype._incomingAddVideoDeniedHandler=function(a){this._triggerCallbacksAsync(a._onCallIncomingVideoAddRequestDeniedCallbacks,a)},d.prototype._incomingAddVideoTimedOutHandler=function(a){a.getState()===c.Services.Call.CallStates.FAR_END_RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(a._onCallIncomingVideoAddRequestTimedOutCallbacks,a)},d.prototype._incomingHoldHandler=function(a){a._heldTime=new Date,a._heldRemotely=!0,this._triggerCallbacksAsync(a._onCallHeldRemotelyCallbacks,a)},d.prototype._incomingUnholdHandler=function(a){a._heldRemotely=!1,this._triggerCallbacksAsync(a._onCallUnheldRemotelyCallbacks,a)},d.prototype._videoChannelUpdateHandler=function(a){a.getState()===c.Services.Call.CallStates.ESTABLISHED&&a._recalculateVideoModeCapabilities(),this._triggerCallbacksAsync(a._onCallVideoChannelsUpdatedCallback,a,a._videoChannels)},d.prototype._callEndedHandler=function(a,b,d){a.isConference()&&this._stopConferenceCall(a),a.getState()!==c.Services.Call.CallStates.ALERTING&&a.getState()!==c.Services.Call.CallStates.IGNORED||(a._setIsMissed(!0),this._callManager.setLastMissedCall(a)),a.getState()!==c.Services.Call.CallStates.ENDING||d&&d.getCause()||(b=!1),d=this._createEndCallEvent(b,d),a._setState(c.Services.Call.CallStates.ENDED),this._triggerCallbacksAsync(a._onCallEndedCallbacks,a,d),this._callManager.deleteCall(a),this._callProvider.stopExternalGatewayProvider(a).always(function(){this.uploadLogs()}.bind(this))},d.prototype._callFailureHandler=function(a,b,d,e,f){var g=b;b!==c.Services.Call.CallError.NOT_FOUND||a.getState()!==c.Services.Call.CallStates.ENDING&&a.getState()!==c.Services.Call.CallStates.ENDED||(g=c.Services.Call.CallError.ENDED),b!==c.Services.Call.CallError.SESSION_ID_NOT_FOUND&&b!==c.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED||c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Received MPaaS session failure:",b),this.uploadLogs(),this._notifyCallFailure(a,g,d,e,f),this._callsAnalyticsService.sendDroppedCallEvent(g)},d.prototype._callServiceUnavailableHandler=function(a){this._isServiceAvailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),this._isUploadedOnServiceUnavailable||(this._isUploadedOnServiceUnavailable=!0,this.uploadLogs()),c.Base.Utils.isDefined(a)&&(a._setServiceAvailability(!1),this._triggerCallbacksAsync(a._callServiceUnavailableCallbacks,a))},d.prototype._callServiceAvailableHandler=function(a){this._isServiceAvailable=!0,this._isUploadedOnServiceUnavailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),c.Base.Utils.isDefined(a)&&(a._setServiceAvailability(!0),this._triggerCallbacksAsync(a._callServiceAvailableCallbacks,a))},d.prototype._maxNetworkRecoveryAttemptedHandler=function(a){this._callManager.getAllCalls().forEach(function(b){var d;this._callProvider.isExternalGatewayCall(b,a)&&((d=b.getState())!==c.Services.Call.CallStates.INITIATING&&d!==c.Services.Call.CallStates.REMOTE_ALERTING||(this.uploadLogs(),this._notifyCallFailure(b,c.Services.Call.CallError.SERVICE_UNAVAILABLE)))}.bind(this))},d.prototype._remoteAddressChangedHandler=function(a,b,d,e,f,g){c.Base.Utils.isDefined(a)&&(c.Base.Utils.isDefined(b)&&a._setRemoteAddress(b),c.Base.Utils.isDefined(d)&&a._setRemoteDisplayName(d),c.Base.Utils.isDefined(e)&&a._setUserToUserInfo(new c.Services.Call.UserToUserInfo(e,f,g)),this._triggerCallbacksAsync(a._onCallRemoteAddressChangedCallbacks,a))},d.prototype._videoLicenseUpdatedHandler=function(a){this._videoLicenseEnabled!==a&&(this._videoLicenseEnabled=a,this._recalculateVideoCapability())},d.prototype._allowedNailedUpVideoModesHandler=function(a,b){a._setAllowedNailedUpVideoModes(b)},d.prototype._iceConnectionUpdateHandler=function(a,b){b?(c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"Media path connected"),a.getEstablishedTime()&&a.getState()===c.Services.Call.CallStates.RENEGOTIATING&&a._setState(c.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(a._mediaConnectedCallbacks,a)):(c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"Media path disconnected"),this._triggerCallbacksAsync(a._mediaDisconnectedCallbacks,a))},d.prototype._buildUccpConfig=function(a){var b=this._config.uccpConfiguration,a=c.Base.Utils.parseUrl(a);return b.networkProviderConfiguration.webSocketConfig.hostName=a.hostname,b.networkProviderConfiguration.webSocketConfig.port=a.port,b.networkProviderConfiguration.webSocketConfig.isSecure=a.isSecure,b.networkProviderConfiguration.webSocketConfig.path=a.path,b},d.prototype._updateMatchedContactsForCall=function(a){a&&this._contactsIntegrationService.updateMatchedContactsForParticipant(a.getRemoteParticipant())},d.prototype._handleDTMFString=function(a){var b,d=function(){var c;0===a._dtmfString.length?clearTimeout(b):(c=a._dtmfString.shift(),b=","!==c?(this.sendDTMF(a,this._convertToDtmf(c)),setTimeout(d.bind(this),200)):setTimeout(d.bind(this),2e3))};setTimeout(function(){c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"Handle DTMF string passed as part of dial string"),b=setTimeout(d.bind(this),200)}.bind(this),2e3)},d.prototype._convertToDtmf=function(a){var b;switch(a){case"1":b=c.Services.Call.DTMFTone.ONE;break;case"2":b=c.Services.Call.DTMFTone.TWO;break;case"3":b=c.Services.Call.DTMFTone.THREE;break;case"4":b=c.Services.Call.DTMFTone.FOUR;break;case"5":b=c.Services.Call.DTMFTone.FIVE;break;case"6":b=c.Services.Call.DTMFTone.SIX;break;case"7":b=c.Services.Call.DTMFTone.SEVEN;break;case"8":b=c.Services.Call.DTMFTone.EIGHT;break;case"9":b=c.Services.Call.DTMFTone.NINE;break;case"0":b=c.Services.Call.DTMFTone.ZERO;break;case"A":b=c.Services.Call.DTMFTone.A;break;case"B":b=c.Services.Call.DTMFTone.B;break;case"C":b=c.Services.Call.DTMFTone.C;break;case"D":b=c.Services.Call.DTMFTone.D;break;case"*":b=c.Services.Call.DTMFTone.STAR;break;case"#":b=c.Services.Call.DTMFTone.POUND;break;default:c.Base.Logger.warn(c.Base.LoggerTags.CALL_SERVICE,"{0} is not a DTMF symbol",a)}return b},d.prototype.createCMConference=function(a){return a=new c.Providers.CM.CMConferenceProvider(this._callProvider,a.getCallId()),a=new c.Services.Conference.ConferenceService(c.Services.Conference.ConferenceType.CM_CONFERENCE,a,this._contactsIntegrationService),new c.Services.Conference.Conference(a)},d.prototype._disconnectCallFromConference=function(a){a.isConference()&&a.getConference()._disconnect()},d.prototype._stopConferenceCall=function(b){b.isConference()&&(b.getConference()._removeOnConferenceAllowVideoDirectionChangedCallback(b._recalculateVideoModeCapabilities.bind(b)),b.getConference()._disconnect(),b.getConference()._isAvailable&&(this._triggerCallbacksAsync(b.getConference()._onConferenceConnectionEndedCallbacks,b.getConference()),b.getConference().stop()),b.getConference()._setCollaboration(a),b._setConference(a))},d.prototype.getAudioDetails=function(a){return this._getCallStatistics(a).then(function(a){return a.audioStatistics})},d.prototype.getVideoDetails=function(a){return this._getCallStatistics(a).then(function(a){return a.videoStatistics})},d.prototype._getCallStatistics=function(a){return this._callProvider.getCallStatistics(a).then(function(a){return{audioStatistics:new c.Services.Call.AudioDetails(a.audioStatistics),videoStatistics:new c.Services.Call.VideoDetails(a.videoStatistics)}}.bind(this),function(a){return this._callsAnalyticsService.sendOperationFailureEvent("_getCallStatistics",c.Services.Analytics.AnalyticsErrorCode.GETTING_CALL_STATISTICS_ERROR),c.Base.Logger.debug(c.Base.LoggerTags.CALL_SERVICE,"Call statistics download fail: ",a.getError()),b.Deferred().reject(a).promise()}.bind(this))},d.prototype.getActiveCall=function(){return this._callManager.getActiveCall()},d.prototype._parseChromeStatistics=function(b){var d,e,f,g,h,i,j;return b.result().forEach(function(a){var b=a.stat("mediaType");"ssrc"===a.type&&-1<a.id.indexOf("send")&&"audio"===b&&(d=a),"ssrc"===a.type&&-1<a.id.indexOf("send")&&"video"===b&&(f=a),"ssrc"===a.type&&-1<a.id.indexOf("recv")&&"audio"===b&&(e=a),"ssrc"===a.type&&-1<a.id.indexOf("recv")&&"video"===b&&(g=a)}),(e||d)&&(h={bytesReceived:parseInt(e?e.stat("bytesReceived"):0),rtcBytesReceived:parseInt(e?e.stat("transportBytesReceived"):0),packetsReceived:parseInt(e?e.stat("packetsReceived"):0),packetsLost:parseInt(e?e.stat("packetsLost"):0),googJitterReceived:parseInt(e?e.stat("googJitterReceived"):0)},i={bytesSent:parseInt(d?d.stat("bytesSent"):0),packetsSent:parseInt(d?d.stat("packetsSent"):0),googRtt:parseInt(d?d.stat("googRtt"):0),packetsLost:parseInt(d?d.stat("packetsLost"):0)},d&&""===d.stat("packetsLost")&&(i.packetsLost=0),d&&""===d.stat("googRtt")&&(i.googRtt=0),i=new c.Services.Call.AudioDetails(h.bytesReceived,i.bytesSent,h.packetsReceived,i.packetsSent,i.googRtt,i.packetsLost,h.packetsLost,h.googJitterReceived)),(g||f)&&(j={bytesReceived:parseInt(g?g.stat("bytesReceived"):0),actualBitRateReceived:a,packetsReceived:parseInt(g?g.stat("packetsReceived"):0),packetsLost:parseInt(g?g.stat("packetsLost"):0),googFrameRateReceived:parseInt(g?g.stat("googFrameRateReceived"):0)},c.Base.Utils.isUndefined(j.packetsLost)&&(j.packetsLost=0),c.Base.Utils.isUndefined(j.packetsReceived)&&(j.packetsReceived=0),0===j.packetsReceived?j.packetsLossFractionReceived=0:j.packetsLossFractionReceived=g.stat("packetsLost")/g.stat("packetsReceived"),h={bytesSent:parseInt(f?f.stat("bytesSent"):0),actualBitRateTransmitted:a,packetsSent:parseInt(f?f.stat("packetsSent"):0),packetsLost:parseInt(f?f.stat("packetsLost"):0),googFrameRateSent:parseInt(f?f.stat("googFrameRateSent"):0)},c.Base.Utils.isUndefined(h.packetsLost)&&(h.packetsLost=0),c.Base.Utils.isUndefined(h.packetsSent)&&(h.packetsSent=0),0===h.packetsSent?h.packetsLossFractionTransmitted=0:h.packetsLossFractionTransmitted=f.stat("packetsLost")/f.stat("packetsSent"),j=new c.Services.Call.VideoDetails(h.bytesSent,j.bytesReceived,h.actualBitRateTransmitted,j.actualBitRateReceived,h.packetsSent,j.packetsReceived,h.packetsLost,j.packetsLost,h.packetsLossFractionTransmitted,j.packetsLossFractionReceived,h.googFrameRateSent,j.googFrameRateReceived)),{audioStatistics:i,videoStatistics:j}},d.prototype._parseFirefoxStatistics=function(a){var b={},d={},e={},f={};return a.forEach(function(a){"audio"===a.mediaType?a.id.includes("inbound_rtp_audio")?(b.bytesReceived=a.bytesReceived,b.packetsReceived=a.packetsReceived,b.packetsLost=a.packetsLost,b.jitterReceived=a.jitter):a.id.includes("outbound_rtp_audio")?(d.bytesSent=a.bytesSent,d.packetsSent=a.packetsSent):a.id.includes("outbound_rtcp_audio")&&(d.mozRtt=a.mozRtt,d.packetsLost=a.packetsLost):"video"===a.mediaType&&(a.id.includes("inbound_rtp_video")?(e.bytesReceived=a.bytesReceived,e.actualBitRateReceived=a.bitrateMean,e.packetsReceived=a.packetsReceived,e.packetsLost=a.packetsLost,e.frameRateReceived=a.framerateMean):a.id.includes("outbound_rtcp_video")?f.packetsLost=a.packetsLost:a.id.includes("outbound_rtp_video")&&(f.bytesSent=a.bytesSent,f.actualBitRateTransmitted=a.bitrateMean,f.packetsSent=a.packetsSent,f.frameRateSent=a.framerateMean))}),c.Base.Utils.isUndefined(d.packetsLost)&&(d.packetsLost=0),c.Base.Utils.isUndefined(d.mozRtt)&&(d.mozRtt=0),a=new c.Services.Call.AudioDetails(b.bytesReceived,d.bytesSent,b.packetsReceived,d.packetsSent,d.mozRtt,d.packetsLost,b.packetsLost,b.jitterReceived),c.Base.Utils.isUndefined(e.packetsLost)&&(e.packetsLost=0),c.Base.Utils.isUndefined(e.packetsReceived)&&(e.packetsReceived=0),0===e.packetsReceived?e.packetsLossFractionReceived=0:e.packetsLossFractionReceived=e.packetsLost/e.packetsReceived,c.Base.Utils.isUndefined(f.packetsLost)&&(f.packetsLost=0),c.Base.Utils.isUndefined(f.packetsSent)&&(f.packetsSent=0),0===f.packetsSent?f.packetsLossFractionTransmitted=0:f.packetsLossFractionTransmitted=f.packetsLost/f.packetsSent,{audioStatistics:a,videoStatistics:new c.Services.Call.VideoDetails(f.bytesSent,e.bytesReceived,f.actualBitRateTransmitted,e.actualBitRateReceived,f.packetsSent,e.packetsReceived,f.packetsLost,e.packetsLost,f.packetsLossFractionTransmitted,e.packetsLossFractionReceived,f.frameRateSent,e.frameRateReceived)}},d.prototype._parseEdgeStatistics=function(b){var d={},e={},f={},g={};return c.Base.Utils.isDefined(b.rtp_audio)&&(d.bytesReceived=a,d.packetsReceived=b.rtp_audio.packetsReceived,d.packetsLost=b.rtp_audio.packetsLost,d.jitterReceived=b.rtp_audio.jitter),c.Base.Utils.isDefined(b.rtp_audio)&&(e.bytesSent=a,e.packetsSent=b.rtp_audio.packetsSent,e.packetsLost=b.rtp_audio.packetsLost),d=new c.Services.Call.AudioDetails(d.bytesReceived,e.bytesSent,d.packetsReceived,e.packetsSent,e.mozRtt,e.packetsLost,d.packetsLost,d.jitterReceived),c.Base.Utils.isDefined(b.rtp_video)&&(f.bytesReceived=a,f.packetsReceived=b.rtp_video.packetsReceived,f.packetsLost=b.rtp_video.packetsLost,f.frameRateReceived=b.rtp_video.frameRateReceived),f.packetsLossFractionReceived=b.rtp_video.fractionLost,c.Base.Utils.isDefined(b.rtp_video)&&(g.packetsLost=b.rtp_video.packetsLost,g.bytesSent=a,g.packetsSent=b.rtp_video.packetsSent,g.frameRateSent=b.rtp_video.frameRateSent),g.packetsLossFractionTransmitted=a,{audioStatistics:d,videoStatistics:new c.Services.Call.VideoDetails(g.bytesSent,f.bytesReceived,g.actualBitRateTransmitted,f.actualBitRateReceived,g.packetsSent,f.packetsReceived,g.packetsLost,f.packetsLost,g.packetsLossFractionTransmitted,f.packetsLossFractionReceived,g.frameRateSent,f.frameRateReceived)}},d.prototype._ringbackToneURLsChangedHandler=function(a){this._calls&&this._triggerCallbacksAsync(this._calls._onRingbackToneURLsChangedCallback,a)},d.prototype._answerCallRequestedHandler=function(a){this._triggerCallbacksAsync(a._answerCallRequestedCallbacks,a)},d.prototype._terminateCallRequestedHandler=function(a){this._triggerCallbacksAsync(a._terminateCallRequestedCallbacks,a)},d.prototype._updateCallRequestedHandler=function(a,b){this._triggerCallbacksAsync(a._updateCallRequestedCallbacks,a,b)},d.prototype._makeCallRequestedHandler=function(a,b,d,e,f){f=this._callManager.createMakeCall(this,a,b,d,e,f),this._callProvider.registerIncomingOrRemoteCall(f),this.trigger(c.Providers.Interfaces.CallServiceCallbackIds.MAKE_CALL_REQUESTED,[f])},d.prototype._callMediaFailedHandler=function(a){a._setState(c.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(a._mediaFailedCallbacks,a)},d.prototype._isMakeCallAllowed=function(a){return!!(a._isDataOnly()||this._isCollabCall(a)||this._isWebRTCSupportedBrowser()&&this._config.mediaConfiguration.mediaEngineEnabled)},d.prototype._isCollabCallCapable=function(a){var b=a.getVideoChannels(),a=a.getAudioChannel(),a=!!a&&a.getRequestedDirection()===c.Services.Call.MediaDirection.DISABLE,b=!b||0===b.length||b[0].getRequestedDirection()===c.Services.Call.MediaDirection.DISABLE;return a&&b},d.prototype._isCollabCall=function(a){return this.isWebCollaborationEnabled(a)&&this._isCollabCallCapable(a)},d.prototype._isWebRTCSupportedBrowser=function(){var a=c.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),a=c.Base.Utils.isWebRTC_SupportedBrowser(a);return this._callProvider.isNailedUpVideoConnectionRequired()?a&&this._callProvider.isServerSupportsNailedUpVideoConnection():a},d.prototype._createEndCallEvent=function(a,b){var d;if(a)if(b&&b.getCause()){if(d=new c.Services.Call.CallEndEvent(c.Services.Call.CallEndReason.CALL_DISCONNECTED_UNKNOWN_REASON,b.getProtocol(),b.getCause(),b.getText()),"avaya-action"===b.getProtocol())switch(b.getCause()){case 200:d._setReason(c.Services.Call.CallEndReason.DISCONNECTED_BY_CONFERENCE_MODERATOR);break;case 201:d._setReason(c.Services.Call.CallEndReason.CONFERENCE_TERMINATED);break;case 202:d._setReason(c.Services.Call.CallEndReason.CALL_DISCONNECTED);break;case 450:d._setReason(c.Services.Call.CallEndReason.DTLS_FAILURE);break;case 451:d._setReason(c.Services.Call.CallEndReason.ICE_FAILURE)}}else d=new c.Services.Call.CallEndEvent(c.Services.Call.CallEndReason.CALL_DISCONNECTED);else d=new c.Services.Call.CallEndEvent(c.Services.Call.CallEndReason.CALL_ENDED_LOCALLY);return d},d.prototype.uploadLogs=function(){if(this._config.mediaServiceContext){if(this._uploadLoggerProvider){this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer);var a=function(){return this._remoteLoggerProvider.uploadLogs(c.Providers.RemoteLogger.Names.MPAAS).fail(function(a){c.Base.Logger.error("Failed to upload logs",a)})}.bind(this);return this._uploadIntervalTimer=setInterval(function(){a()},72e5),a()}return c.Base.Logger.error("Uninitialized remote logger provider"),b.Deferred().reject("Uninitialized remote logger provider").promise()}},d.prototype.isRegistrationTerminated=function(){return this._isRegistrationTerminated},d.prototype.setOnNetworkEvents=function(a,b){return this._callProvider.setOnNetworkEvents(a,b)},d.prototype.isNetworkEventsUrlDefined=function(){return this._callProvider.isNetworkEventsUrlDefined()},d.prototype.removeOnNetworkEvents=function(){return this._callProvider.removeOnNetworkEvents()},d.prototype.isMediaConnected=function(a){return this._callProvider.isMediaConnected(a)},d.prototype.updatePreferredResolution=function(a,d){return!1===this._isSupportedResolution(d)?b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.FAILED)).promise():!1===a._call._preferredResolutionCapability.isAllowed?b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise():this._callProvider.updatePreferredResolution(a,d)},d.prototype.setPreferredReceiveResolution=function(d,e,f){return d._preferredReceiveResolutionCapability.isAllowed?0<b.map(c.Base.VideoResolution,function(b,c){return c===f?b:a}).length?this._callProvider.setPreferredReceiveResolution(d,e,f):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.NOT_FOUND)).promise():b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},d.prototype._isSupportedResolution=function(a){return a in c.Base.VideoResolution},d.prototype._limitedVideoResolutionStoring=function(a){if(!a){if(!this._calls||!this._calls.getCalls().length||!this._callManager.getActiveCall()&&!this._callManager.getEndingCall())return;a=this._callManager.getActiveCall()||this._callManager.getEndingCall()}var b=new c.Base.VideoResolutionDetails,d=this.getVideoResolution(a)&&b.convertToConfigVideoResolution(this.getVideoResolution(a)),e=this.getVideoSendResolution(a)&&b.convertToConfigVideoResolution(this.getVideoSendResolution(a)),b=c.Base.Utils;this.isEnoughCallMinutesPassed(a,10)&&e&&b.toNumber(b.cutNumberFromString(e))<=b.toNumber(b.cutNumberFromString(d))&&this._setVideoResolutionToLocalStorage(d,e)},d.prototype.isEnoughCallMinutesPassed=function(a,b){return a=a.getEstablishedTime(),a=new Date-a,b<=Math.round(a%864e5%36e5/6e4)},d.prototype._setVideoResolutionToLocalStorage=function(a,b){var d=c.Base.Storage,e=d.get(d.TYPES.LOCAL,d.KEYS.VIDEO_RESOLUTIONS),f=(e=Array.isArray(e)?e:[]).find(function(b){return b.negotiate===a});f&&Array.isArray(f.limited)||(f={negotiate:a,limited:[]}),Array.isArray(f.limited)&&5<=f.limited.length&&f.limited.shift(),f.limited.push(b),b=e.findIndex(function(b){return b.negotiate===a}),-1<b?e[b]=f:e.push(f),d.set(d.TYPES.LOCAL,d.KEYS.VIDEO_RESOLUTIONS,e)},d.prototype._getAverageLimitedResolution=function(a){var b=c.Base.Utils.getAverageValueFromArray(a),a=Object.keys(c.Base.VideoResolution).reduce(function(a,d){return"number"!=typeof a&&(a=c.Base.Utils.toNumber(c.Base.Utils.cutNumberFromString(a))),"number"!=typeof d&&(d=c.Base.Utils.toNumber(c.Base.Utils.cutNumberFromString(d))),Math.abs(d-b)!==Math.abs(a-b)&&Math.abs(d-b)<Math.abs(a-b)?d:a});return c.Base.VideoResolution["resolution"+a+"p"]},d.prototype.setNoiseReduction=function(a,d){var e=b.Deferred();return a.getSetNoiseReductionCapability().isAllowed?(a._noiseReductionSetting=d,e.resolve()):e.reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),e.promise()},c.Services.Call.CallService=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallStates={FAR_END_RENEGOTIATING:"far_end_renegotiating",IDLE:"idle",IGNORED:"ignored",INITIATING:"initiating",REMOTE_ALERTING:"remote_alerting",RENEGOTIATING:"renegotiating",FAILED:"failed",ALERTING:"alerting",HELD:"held",ENDED:"ended",ENDING:"ending",HOLDING:"holding",UNHOLDING:"unholding",ESTABLISHED:"established",BEING_TRANSFERRED:"being_transferred",TRANSFERRING:"transferring"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallType={CallTypeDefaultRegisteredService:"DefaultRegisteredService",CallTypeHttpMeetMe:"HttpMeetMe"}}(),function(a){"use strict";function b(b,c,d,e,f,g){-1===c.indexOf(b.getState())?a.Base.Capability.call(this,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):a.Base.Capability.call(this,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._call=b,this._validCallStates=c,this._mediaPreservedAllowed=d,this._validForRemote=e,this._validForLocal=f,this._validForBrowsers=g,b._addOnCallStateChangedCallback(this._recalculate.bind(this)),b.addOnCallServiceAvailableCallback(this._recalculate.bind(this)),
b.addOnCallServiceUnavailableCallback(this._recalculate.bind(this)),b.addOnCallJoinedCallback(this._recalculate.bind(this))}(b.prototype=Object.create(a.Base.Capability.prototype))._recalculateDenialReason=function(){var b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return-1===this._validCallStates.indexOf(this._call.getState())||!this._mediaPreservedAllowed&&!this._call.isServiceAvailable()?b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE:this._call.isRemote()&&!this._validForRemote?b=a.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_REMOTE:this._call.isRemote()||this._validForLocal?this._isSupportedBrowser()?this._call._isDataOnly()&&(b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED:b=a.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_NOT_REMOTE,b},b.prototype._recalculate=function(){var b=this._recalculateDenialReason(),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._updateIfChanged(c,b)},b.prototype._isSupportedBrowser=function(){var b=a.Base.Utils.getBrowserType();return!this._validForBrowsers||-1!==this._validForBrowsers.indexOf(b)},a.Services.Call.Capabilities.AbstractCallStateCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.Capability.call(this,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._callService=b}(b.prototype=Object.create(a.Base.Capability.prototype))._recalculate=function(){var b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,c=!0,d=this._callService.isServiceAvailable(),e=this._callService.isNetworkEventsUrlDefined();d&&e||(c=!1,b=a.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.AbstractNetworkEventsCapability=b}(AvayaClientServices),function(b){"use strict";function c(a,c,d,e,f,g,h){this._videoCapability=c,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),a.addOnCallHeldRemotelyCallback(this._recalculate.bind(this)),a.addOnCallUnheldRemotelyCallback(this._recalculate.bind(this)),a.addOnCallEstablishedCallback(this._recalculate.bind(this)),b.Services.Call.Capabilities.AbstractCallStateCapability.call(this,a,d,e,f,g,h)}(c.prototype=Object.create(b.Services.Call.Capabilities.AbstractCallStateCapability.prototype)).isAllowedNailedUpVideoMode=function(a){var b=this._call._getAllowedNailedUpVideoModes();return!(0<b.length)||b.includes(a)},c.prototype._recalculate=function(){var c=b.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),d=c===b.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e=this._call._conference,e=e?e._allowVideoDirection:a;d&&this._call._getIsContentVideoSharingStarted()&&(d=!1,c=b.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),d&&b.Base.Utils.isDefined(e)&&b.Base.Utils.isDefined(this._allowVideoDirections)&&(c=-1<this._allowVideoDirections.indexOf(e)?(d=!0,b.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(d=!1,b.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)),e=this._isDirectionAllowed(),!d||!this._call.isHeldRemotely()&&this._videoCapability.isAllowed&&e||(d=!1,c=this._videoCapability.isAllowed?b.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason),e=!b.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==b.Services.Call.MediaDirection.DISABLE,d&&!e&&(d=!1,c=b.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(d,c)},b.Services.Call.Capabilities.AbstractUpdateVideoModeCapability=c}(AvayaClientServices),function(a){"use strict";function b(b,c){var d=[a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];this._videoCapability=c,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),b.addOnCallEstablishedCallback(this._recalculate.bind(this)),a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,d,!0,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._denyDataOnlyConference=function(b,c){b&&this._call._isDataOnly()&&(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},b.prototype._recalculateDenialReason=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return this._denyDataOnlyConference(c,b),this._updateIfChanged(c,b),b},a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.ESTABLISHED],d=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0,d)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,e=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;!c||d||e||(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.HoldCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!0,!1)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,e=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;!c||d||e||(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.JoinCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,b,c)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&this._call._videoMuteState===a.Services.Call.MediaMuteStates.MUTED&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.MuteVideoCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,b)}b.prototype=Object.create(a.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),a.Services.Call.Capabilities.RemoveOnNetworkEventsCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING],d=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!0,!1,!0,d)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(b){var c=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),d=c===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,f=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;!d&&b&&this._call.getState()===a.Services.Call.CallStates.REMOTE_ALERTING&&(d=!0,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),!d||e||f||(d=!1,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(d,c)},a.Services.Call.Capabilities.SendDTMFCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.Capability.call(this,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._call=b}(b.prototype=Object.create(a.Base.Capability.prototype))._recalculate=function(){var b=!1,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED;this._isSupportedByBrowser()&&this._isSupportedByCallType()&&(b=!0,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateIfChanged(b,c)},b.prototype._isSupportedByBrowser=function(){var b=a.Base.Utils.getBrowserType();return b!==a.Base.BrowserType.IE&&b!==a.Base.BrowserType.EDGE},b.prototype._isSupportedByCallType=function(){return!1===this._call._isDataOnly()},a.Services.Call.Capabilities.ServiceQualityScoreCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.IDLE],d=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!0,!1,!0,d)}b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype),a.Services.Call.Capabilities.SetNoiseReductionCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,b)}b.prototype=Object.create(a.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),a.Services.Call.Capabilities.SetOnNetworkEventsCapability=b}(AvayaClientServices),function(b){"use strict";function c(a){var c=[b.Services.Call.CallStates.ESTABLISHED,b.Services.Call.CallStates.HELD];a.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),b.Services.Call.Capabilities.AbstractCallStateCapability.call(this,a,c,!1,!1,!0)}(c.prototype=Object.create(b.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var a=b.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=a===b.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&(this._call.isConference()||b.Base.Utils.isDefined(this._call._sessionId))&&(c=!1,a=b.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===c&&!1===this._isAllowedByProvider()&&(c=!1,a=b.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,a)},c.prototype._isAllowedByProvider=function(){if(this._call._callCreationInfo===a||typeof this._call._callCreationInfo.getServiceGatewayURL!=typeof Function.prototype)return!0;var c=this._call._callCreationInfo.getServiceGatewayURL();return c===a||(c=b.Base.Utils.parseUrl(c),c=b.Base.Utils.getHost(c),c=this._call._callService._callProvider._csgwProviderFactory.getCSGCallsProvider(c),null===c||c.isAllowedToTransfer(this._call.getCallId()))},b.Services.Call.Capabilities.TransferCapability=c}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD];b.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&(this._call.isConference()||a.Base.Utils.isDefined(this._call._sessionId))&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===c&&!1===this._isAllowedByProvider()&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},b.prototype._isAllowedByProvider=a.Services.Call.Capabilities.TransferCapability.prototype._isAllowedByProvider,a.Services.Call.Capabilities.TransferToCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.HELD],d=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0,d)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,e=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;!c||d||e||(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UnholdCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,b,c)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&this._call._videoMuteState!==a.Services.Call.MediaMuteStates.MUTED&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UnmuteVideoCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=a.Base.Utils.isDefined(this._call._callCreationInfo)&&a.Base.Utils.isDefined(this._call._callCreationInfo.getUccpURL());!c||a.Base.Utils.isDefined(this._call._sessionId)||d||(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UpdateAudioModeCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){var d=[a.Services.Call.CallStates.ESTABLISHED],e=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI];this._videoCapability=c,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),b.addOnCallEstablishedCallback(this._recalculate.bind(this)),a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,d,!1,!1,!0,e)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var b,c=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),d=c===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return d&&(this._videoCapability.isAllowed?0<(b=this._call.getVideoChannels()).length&&(b[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.SEND_RECV||b[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.RECV_ONLY)||(d=!1,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):(d=!1,c=this._videoCapability.denialReason)),this._updateIfChanged(d,c),c},a.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.call(this,b,c)}(b.prototype=Object.create(a.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.prototype))._save=function(a,b){return this._updateIfChanged(a,b),b},b.prototype._recalculateDenialReason=function(){if(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this)!==a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)return this._save(!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);if(!0!==this._videoCapability.isAllowed)return this._save(!1,this._videoCapability.denialReason);var b=this._call.getVideoChannels();return 0<b.length&&~[a.Services.Call.MediaDirection.RECV_ONLY,a.Services.Call.MediaDirection.SEND_RECV,a.Services.Call.MediaDirection.SEND_ONLY].indexOf(b[0].getNegotiatedDirection())?this._save(!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._save(!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},a.Services.Call.Capabilities.UpdatePreferredResolutionCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){this._videoCapability=c,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),c=[a.Services.Call.CallStates.ESTABLISHED],a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,e=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;!c||!this._call._isDataOnly()&&this._videoCapability.isAllowed&&(d||e)||(c=!1,b=this._call._isDataOnly()?a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UpdateVideoChannelsCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){var d=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED],e=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI,a.Base.BrowserType.IE];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,b,c,d,!1,!1,!0,e)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var b=this._call.getVideoChannels(),c=0<b.length&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.INACTIVE&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE,b=a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI;return c&&!(b&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.DISABLE)},a.Services.Call.Capabilities.UpdateVideoModeDisableCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.SEND_ONLY,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY,a.Services.Conference.AllowVideoDirection.INACTIVE];var d=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,b,c,d,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var b=this._call.getVideoChannels();return 0<b.length&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.INACTIVE&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.INACTIVE)},a.Services.Call.Capabilities.UpdateVideoModeInactiveCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY];var d=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,b,c,d,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var b=this._call.getVideoChannels();return(0===b.length&&this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED||0<b.length&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.RECV_ONLY)&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.RECEIVE_ONLY)},a.Services.Call.Capabilities.UpdateVideoModeReceiveOnlyCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.SEND_ONLY];var d=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED],e=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,b,c,d,!1,!1,!0,e)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var b=this._call.getVideoChannels(),c=0===b.length&&this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED||0<b.length&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.SEND_ONLY&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.RECV_ONLY,b=a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI;return c&&!(b&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.SEND_ONLY)},a.Services.Call.Capabilities.UpdateVideoModeSendOnlyCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE];var d=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,b,c,d,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var b=this._call.getVideoChannels(),c=-1!==[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI].indexOf(a.Base.Utils.getBrowserType()),d=0===b.length&&(c||this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED)||0<b.length&&b[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.SEND_RECV,c=!1;return a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI&&0!==b.length&&(c=b[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.SEND_ONLY&&this._call.getEstablishedTime()),d&&!c&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.SEND_RECEIVE)},a.Services.Call.Capabilities.UpdateVideoModeSendReceiveCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!1,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=this._call._callService._config&&this._call._callService._config.wcsConfiguration&&this._call._callService._config.wcsConfiguration.enabled;c&&!d&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UpdateWebCollaborationCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Base.Capability.call(this,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._calls=b}(b.prototype=Object.create(a.Base.Capability.prototype))._recalculate=function(){var b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,c=!0,d=this._calls._isWebRTCSupportedBrowser(),e=this._calls._isRegistrationTerminated();this._calls._isAvailable&&d&&!e||(c=!1,b=e?a.Services.Call.CallError.REGISTRATION_TERMINATED:d?a.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE:a.Services.Call.CallError.WEBRTC_NOT_SUPPORTED),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.VoipCallingCapability=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){this._token=b,this._isOTT=!!a.Base.Utils.isDefined(c)&&c,this._meetingId=a.Base.Utils.isDefined(d)?d:null,this._passcode=a.Base.Utils.isDefined(e)?e:null}b.prototype={getToken:function(){return this._token},setToken:function(a){this._token=a},isOTT:function(){return this._isOTT},enableOTT:function(a){this._isOTT=a,this._isWebRTCAbleConf=this._isOTT},getMeetingId:function(){return this._meetingId},setMeetingId:function(a){this._meetingId=a},getPasscode:function(){return this._passcode},setPasscode:function(a){this._passcode=a}},a.Services.Call.ConferenceEntryOptions=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.DTMFTone={A:"A",B:"B",C:"C",D:"D",STAR:"*",POUND:"#",ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,ZERO:0}}(),function(a){"use strict";var b={RECV_ONLY:"recvonly",SEND_ONLY:"sendonly",SEND_RECV:"sendrecv",INACTIVE:"inactive",DISABLE:"disable",UNDEFINED:"undefined",_isDisabled:function(b){return b===a.Services.Call.MediaDirection.DISABLE||b===a.Services.Call.MediaDirection.UNDEFINED}};a.Services.Call.MediaDirection=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.MediaMuteStates={UNDEFINED:0,MUTED:1,UNMUTED:2}}(),function(a){"use strict";function b(a,b){this.call=a,this.id=b}b.prototype.startCall=function(a){},b.prototype.endCall=function(a){},a.Services.Call.Modes.AbstractCallMode=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Services.Call.Modes.AbstractCallMode.call(this,b,c),this._contactsIntegrationService=d}(b.prototype=Object.create(a.Services.Call.Modes.AbstractCallMode.prototype)).startCall=function(b){if(this._createDataOnlyConference(b),a.Base.Utils.isDefined(b._callCreationInfo)&&a.Base.Utils.isDefined(b._callCreationInfo.getUccpURL())){var c=b._callCreationInfo.getUccpURL(),d=b._callService._parseUccpUrl(c);if(!a.Base.Utils.isDefined(d))return a.Base.Logger.error(a.Base.LoggerTags.CALL_SERVICE,"Failed to parse UCCP url: "+c),void b._callService._notifyCallFailure(b,a.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE);b._onCallStartedCallbacks.fire(b),b._onCallEstablishedCallbacks.fire(b),b._conference._setConfiguration(d)}b._callService.createCollaborationForConference(b),b._onCallConferenceStatusChangedCallbacks.fire(b,!0,c)},b.prototype.endCall=function(b){b.getConference()._conferenceService.sendDisconnectEvent(),b.getConference().stop(),b._setState(a.Services.Call.CallStates.ENDED);var c=new a.Services.Call.CallEndEvent(a.Services.Call.CallEndReason.CALL_DISCONNECTED);b._onCallEndedCallbacks.fire(b,c),b._callService._callManager.deleteCall(b)},b.prototype._createDataOnlyConference=function(b){var c=b._callService.getScopiaConferenceProvider(),d=b._callService.createChatService(c),e=b._callService.createParticipantService(c),d=new a.Services.Conference.Chat(d),c=new a.Services.Conference.ConferenceService(a.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,c,this._contactsIntegrationService);b._setConference(new a.Services.Conference.Conference(c,e,d)),b._conference._isUccpConference=!0,d=b._callCreationInfo.getPasscode(),b._conference._setPreEnteredPasscode(d)},a.Services.Call.Modes.ConferenceCallMode=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.NoiseReductionSetting={ENABLED:"ENABLED",DISABLE_CLIENT:"DISABLE_CLIENT",PREFER_CLIENT:"PREFER_CLIENT",DISABLE_ALL:"DISABLE_ALL"}}(),function(b){"use strict";function c(){this.ringback=a,this.intercept=a,this.reorder=a,this.fastBusy=a}c.prototype._setRingbackToneUrl=function(a){this.ringback=a},c.prototype.getRingbackToneUrl=function(){return this.ringback},c.prototype._setInterceptToneUrl=function(a){this.intercept=a},c.prototype.getInterceptToneUrl=function(){return this.intercept},c.prototype._setReorderToneUrl=function(a){this.reorder=a},c.prototype.getReorderToneUrl=function(){return this.reorder},c.prototype._setFastBusyToneUrl=function(a){this.fastBusy=a},c.prototype.getFastBusyToneUrl=function(){return this.fastBusy},b.Services.Call.RingbackToneURLs=c}(AvayaClientServices),function(c){"use strict";function d(d){this._call=d,this._bound=!1,this._score=a,this._onScoreChangedCallbacks=b.Callbacks(),this._updateScoreInterval=a,this._previousAudioReport=a,this._previousVideoReport=a,this._previousTimestamp=a,this._allowedStates=[c.Services.Call.CallStates.ESTABLISHED,c.Services.Call.CallStates.RENEGOTIATING,c.Services.Call.CallStates.FAR_END_RENEGOTIATING],this._allowedIncomingVideoModes=[c.Services.Call.MediaDirection.SEND_RECV,c.Services.Call.MediaDirection.RECV_ONLY],this._allowedOutgoingVideoModes=[c.Services.Call.MediaDirection.SEND_RECV,c.Services.Call.MediaDirection.SEND_ONLY]}var e=[{score:c.Base.AbsoluteCategoryRating.EXCELLENT,max:3},{score:c.Base.AbsoluteCategoryRating.GOOD,max:7},{score:c.Base.AbsoluteCategoryRating.FAIR,max:10},{score:c.Base.AbsoluteCategoryRating.POOR,max:15},{score:c.Base.AbsoluteCategoryRating.BAD}],f=[{score:c.Base.AbsoluteCategoryRating.EXCELLENT,max:1},{score:c.Base.AbsoluteCategoryRating.GOOD,max:3},{score:c.Base.AbsoluteCategoryRating.FAIR,max:5},{score:c.Base.AbsoluteCategoryRating.POOR,max:10},{score:c.Base.AbsoluteCategoryRating.BAD}],g=[{score:c.Base.AbsoluteCategoryRating.EXCELLENT,min:95},{score:c.Base.AbsoluteCategoryRating.GOOD,min:75},{score:c.Base.AbsoluteCategoryRating.FAIR,min:50},{score:c.Base.AbsoluteCategoryRating.POOR,min:25},{score:c.Base.AbsoluteCategoryRating.BAD}];d.prototype.watch=function(){return this._canBeBound()&&(this._call.addOnCallStartedCallback(this._start.bind(this)),this._call.addOnCallEstablishedCallback(this._start.bind(this)),this._call.addOnCallHeldCallback(this._stop.bind(this)),this._call.addOnCallUnheldCallback(this._start.bind(this)),this._call.addOnCallEndedCallback(this._stop.bind(this)),this._bound=!0),this._bound},d.prototype.getScore=function(){return this._score},d.prototype.addOnScoreChangedCallback=function(a){this._onScoreChangedCallbacks.add(a)},d.prototype.removeOnScoreChangedCallback=function(a){this._onScoreChangedCallbacks.remove(a)},d.prototype._canBeBound=function(){return!0===this._call.getServiceQualityScoreCapability().isAllowed&&!1===this._bound},d.prototype._start=function(){var a=b.Deferred();a.then(function(){c.Base.Utils.isUndefined(this._updateScoreInterval)&&(this._updateScoreInterval=setInterval(this._updateScore.bind(this),5e3))}.bind(this)),this._updateScore(a)},d.prototype._stop=function(){
clearInterval(this._updateScoreInterval),this._updateScoreInterval=a,this._previousAudioReport=a,this._previousVideoReport=a,this._previousTimestamp=a,this._setScore(a)},d.prototype._updateScore=function(b){this._call._callService._getCallStatistics(this._call).then(function(a){var b=Date.now(),c=this._getScoreForAudio(a.audioStatistics,b),a=this._getScoreForVideo(a.videoStatistics,b);this._previousTimestamp=b,this._setScore(this._getTotalScore(c,a))}.bind(this)).always(function(){b!==a&&b.resolve()})},d.prototype._getScoreForAudio=function(a){var b=this._getPacketLossScore(a,this._previousAudioReport,e);return this._previousAudioReport=a,b},d.prototype._getScoreForVideo=function(a,b){var c=this._getPacketLossScore(a,this._previousVideoReport,f),b=this._getBitrateScore(a,this._previousVideoReport,g,b),b=this._getTotalScore(c,b);return this._previousVideoReport=a,b},d.prototype._getPacketLossScore=function(b,c,d){var e=this._getIncomingLosses(b,c),c=this._getOutgoingLosses(b,c);return e===a&&c===a?a:e===a?this._packetLossToScore(c,d):c===a?this._packetLossToScore(e,d):this._packetLossToScore(Math.max(e,c),d)},d.prototype._getBitrateScore=function(b,c,d,e){var f=this._getIncomingBitrate(b,c,e),e=this._getOutgoingBitrate(b,c,e);return f===a&&e===a?a:f===a?this._bitrateRatioToScore(e,d):e===a?this._bitrateRatioToScore(f,d):this._bitrateRatioToScore(Math.min(f,e),d)},d.prototype._getIncomingLosses=function(b,c){var d,e;return c!==a&&(d=c.packetsReceived,e=c.packetLossTotalReceived),this._getLosses(b.packetsReceived,b.packetLossTotalReceived,d,e)},d.prototype._getOutgoingLosses=function(b,c){var d,e;return c!==a&&(d=c.packetsTransmitted,e=c.packetLossTotalTransmitted),this._getLosses(b.packetsTransmitted,b.packetLossTotalTransmitted,d,e)},d.prototype._getLosses=function(b,c,d,e){return c===a||0===c?c:c===e?0:("number"==typeof d&&"number"==typeof e&&(b-=d,c-=e),c/b*100)},d.prototype._packetLossToScore=function(b,c){for(var d=0;d<c.length;++d)if(c[d].max===a||b<=c[d].max)return c[d].score;return a},d.prototype._getOutgoingBitrate=function(b,c,d){var e;return this._isOutgoingVideoActive()?(d=b.availableTransmitBitrate!==a?(e=this._getAvailableOutgoingBitrate(b),this._getExpectedVideoBitrate()):(e=this._getBitrateTrasmitted(b,c,d),this._getExpectedVideoSendBitrate()),e===a||d===a?a:this._getBitrateRatio(e,d)):a},d.prototype._getIncomingBitrate=function(b,c,d){if(!this._isIncomingVideoActive())return a;if(!this._call.isMediaConnected())return 0;var e=this._getExpectedVideoBitrate();return(d=b.availableReceiveBitrate!==a?this._getAvailableIncomingBitrate(b):this._getBitrateReceived(b,c,d))===a||e===a||0<(e=this._getBitrateRatio(d,e))&&e<=10?a:e},d.prototype._getAvailableOutgoingBitrate=function(a){return a.availableTransmitBitrate},d.prototype._getAvailableIncomingBitrate=function(a){return a.availableReceiveBitrate},d.prototype._getBitrateTrasmitted=function(a,b,c){var d;return b&&(d=b.bytesTransmitted),this._getBitrate(a.bytesTransmitted,d,c)},d.prototype._getBitrateReceived=function(a,b,c){var d;return b&&(d=b.bytesReceived),this._getBitrate(a.bytesReceived,d,c)},d.prototype._getBitrate=function(b,c,d){return b===a||c===a?a:b===c?0:(b-c)/((d-this._previousTimestamp)/1e3)*8},d.prototype._getBitrateRatio=function(b,c){return b===a||c===a?a:b/c*100},d.prototype._bitrateRatioToScore=function(b,c){for(var d=0;d<c.length;++d)if(c[d].min===a||b>=c[d].min)return c[d].score;return a},d.prototype._getExpectedVideoBitrate=function(){var b=this._call._callService.getVideoBandwidth(this._call);return b!==a?1e3*b:a},d.prototype._isVideoActive=function(a,b){var c=this._call.getVideoChannels();return 0<c.length&&(c=c[0].getNegotiatedDirection(),-1!==a.indexOf(this._call.getState())&&-1!==b.indexOf(c))},d.prototype._isIncomingVideoActive=function(){return this._isVideoActive(this._allowedStates,this._allowedIncomingVideoModes)},d.prototype._isOutgoingVideoActive=function(){return this._call._videoMuteState!==c.Services.Call.MediaMuteStates.MUTED&&this._isVideoActive(this._allowedStates,this._allowedOutgoingVideoModes)},d.prototype._getExpectedVideoSendBitrate=function(){var b=this._call._callService.getVideoSendBandwidth(this._call);return b!==a?1e3*b:a},d.prototype._getTotalScore=function(b,c){return b===a&&c===a?a:b===a?c:c===a?b:Math.min(b,c)},d.prototype._setScore=function(a){this._score!==a&&(this._score=a,this._onScoreChangedCallbacks.fire(a))},c.Services.Call.ServiceQuality=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.TransferProgressCode={ACCEPTED:"ACCEPTED",NONE:"NONE",REMOTE_CALL_ESTABLISHED:"REMOTE_CALL_ESTABLISHED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",REMOTE_CALL_STARTED:"REMOTE_CALL_STARTED",STARTED:"STARTED"}}(),function(){"use strict";function a(a,b,c){this._ucid=a,this._parentUcid=b,this._contextId=c}a.prototype={getUCID:function(){return this._ucid},getParentUCID:function(){return this._parentUcid},getContextId:function(){return this._contextId},setContextId:function(a){this._contextId=a},_setUCID:function(a){this._ucid=a},_setParentUCID:function(a){this._parentUcid=a}},AvayaClientServices.Services.Call.UserToUserInfo=a}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.VideoChannelDisabledReason={NONE:"none",DISABLED_BY_LOCAL_USER:"disabledByLocalUser",DISABLED_BY_REMOTE_USER:"disabledByRemoteUser",DISABLED_DUE_TO_CPU_OVERLOAD:"disabledDueToCpuOverload",DISABLED_DUE_TO_INSUFFICIENT_BANDWIDTH:"disabledDueToInsufficientBandwidth",DISABLED_DUE_TO_LOCAL_PLATFORM_LIMITATIONS:"disabledDueToLocalPlatformLimitations",DISABLED_DUE_TO_LOCAL_LAYOUT_SELECTION:"disabledDueToLocalLayoutSelection",DISABLED_DUE_TO_MISSING_H264_PLUGIN:"disabledDueToMissingH264Plugin"}}(),function(){"use strict";(AvayaClientServices||{}).Services.Call.VideoDetails=function(a){this.bytesTransmitted=a.bytesTransmitted,this.bytesReceived=a.bytesReceived,this.actualBitRateTransmitted=a.actualBitRateTransmitted,this.actualBitRateReceived=a.actualBitRateReceived,this.packetsTransmitted=a.packetsTransmitted,this.packetsReceived=a.packetsReceived,this.packetLossTotalTransmitted=a.packetLossTotalTransmitted,this.packetLossTotalReceived=a.packetLossTotalReceived,this.packetsLossFractionTransmitted=a.packetsLossFractionTransmitted,this.packetsLossFractionReceived=a.packetsLossFractionReceived,this.actualFrameRateTransmitted=a.actualFrameRateTransmitted,this.actualFrameRateReceived=a.actualFrameRateReceived,this.codec=a.codec,this.roundTripTimeMillis=a.roundTripTimeMillis,this.heightTransmitted=a.heightTransmitted,this.heightReceived=a.heightReceived,this.widthTransmitted=a.widthTransmitted,this.widthReceived=a.widthReceived,this.firCountTransmitted=a.firCountTransmitted,this.firCountReceived=a.firCountReceived,this.pliCountTransmitted=a.pliCountTransmitted,this.pliCountReceived=a.pliCountReceived,this.framesTransmitted=a.framesTransmitted,this.framesReceived=a.framesReceived,this.nackCountTransmitted=a.nackCountTransmitted,this.nackCountReceived=a.nackCountReceived,this.availableTransmitBitrate=a.availableTransmitBitrate,this.availableReceiveBitrate=a.availableReceiveBitrate,this.jitterMillisecondsReceived=a.jitterMillisecondsReceived,this.framesEncoded=a.framesEncoded,this.framesDecoded=a.framesDecoded,this.totalEncodeTime=a.totalEncodeTime,this.totalDecodeTime=a.totalDecodeTime}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoMode={SEND_RECEIVE:"SEND_RECEIVE",RECEIVE_ONLY:"RECEIVE_ONLY",SEND_ONLY:"SEND_ONLY",INACTIVE:"INACTIVE",DISABLE:"DISABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoNetworkSignalingType={INDEFINITE:"indefinite",OFF:"off",SUPPORTED:"supported"}}(),function(a){"use strict";function b(b,c){a.Base.BaseError.call(this,b,c),this.name="CollaborationError"}b.prototype=Object.create(a.Base.BaseError.prototype),a.Services.Collaboration.CollaborationError=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.CollaborationErrorReason={COLLABORATION_START_FAILURE:"Failed to start collaboration.",COLLABORATION_STOP_FAILURE:"Failed to stop collaboration.",COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",BROWSER_NOT_SUPPORTED:"Browser is not supported",WHITEBOARD_REMOVE_LAST_SURFACE:"Failed to remove surface. You cannot remove last surface.",WHITEBOARD_REMOVE_SURFACE_FAILED:"Failed to remove surface.",WHITEBOARD_REMOVE_SHAPE_NOT_MINE:"Failed to remove shape. You can only remove shapes that you drew.",WHITEBOARD_ALREADY_ACTIVE:"Failed to start whiteboard surface. Surface is already started.",WHITEBOARD_INACTIVE:"Whiteboard is not started.",SHARING_INACTIVE:"Sharing is not started",INTERNAL_ERROR:"An internal error occurred."}}(),function(b){"use strict";function c(a,b,c,d,e){this._userConfig=a,this._providerFactory=b,this._callPerformanceManager=d,this._colaborationsAnalyticsService=c,this._callService=e}c.prototype={create:function(a,c,d,e){e=e||this._userConfig;var f=this._providerFactory.createCollaborationProviders(e)[0],g=this._createCollaborationService(f),h=this._createWhiteboard(f),e=this._createContentSharing(f,e,a,d),a=new b.Services.Collaboration.Slider,d=new b.Services.Collaboration.Collaboration(g,h,e,a,c,d,this._callService);return h._setCollaboration(d),e._setCollaboration(d),d},_createCollaborationService:function(c){return this._identity=a,this._collaborationProviderInitialized=!1,new b.Services.Collaboration.CollaborationService(c,this._colaborationsAnalyticsService)},_createWhiteboard:function(a){return a=new b.Services.Collaboration.WhiteboardService(a,this._colaborationsAnalyticsService),new b.Services.Collaboration.Whiteboard(a)},_createContentSharing:function(a,c,d,e){return e=this._createContentSharingService(a,c.collaborationConfiguration,e),this._callPerformanceManager.setContentSharingService(e),new b.Services.Collaboration.ContentSharing(e,d)},_createContentSharingService:function(a,c,d){(b.Base.Utils.isUndefined(c)||b.Base.Utils.isUndefined(c.contentSharingWorkerPath))&&b.Base.Logger.warn(b.Base.LoggerTags.COLLABORATION_SERVICE,"Web worker path is undefined. Content sharing will not be enabled.");var e=new b.Providers.ContentSharing.ScreenSharingProviderFactory(a,this._callPerformanceManager);return new b.Services.Collaboration.ContentSharingService(a,e.getScreenSharingProvider(c),this._colaborationsAnalyticsService,this._callService,d)}},b.Services.Collaboration.CollaborationFactory=c}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d,e,f){this._x=a,this._y=b,this._width=c,this._height=d,this._bitmapData=f,this._imageType=e}b.prototype={getXOffset:function(){return this._x},getYOffset:function(){return this._y},getRawBitmapData:function(){return this._bitmapData},getBlobData:function(){var a=new Blob([this._bitmapData],{type:"image/"+(0===this._imageType?"jpeg":"png")});return window.URL.createObjectURL(a)},getBase64BitmapData:function(){return"data:image/"+(0===this._imageType?"jpeg":"png")+";base64,"+this._toBase64(this._bitmapData)},getWidth:function(){return this._width},getHeight:function(){return this._height},_toBase64:function(a){for(var b,c="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Uint8Array(a),f=e.byteLength,a=f%3,g=f-a,h=0;h<g;h+=3)c+=d[(16515072&(b=e[h]<<16|e[h+1]<<8|e[h+2]))>>18]+d[(258048&b)>>12]+d[(4032&b)>>6]+d[63&b];return 1==a?c+=d[(252&(b=e[g]))>>2]+d[(3&b)<<4]+"==":2==a&&(c+=d[(64512&(b=e[g]<<8|e[1+g]))>>10]+d[(1008&b)>>4]+d[(15&b)<<2]+"="),c}},a.Services.Collaboration.Bitmap=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.FeaturesAvailable={LIBRARY:"LIBRARY",POLLING:"POLLING",MINUTES:"MINUTES",WHITEBOARD:"WHITEBOARD",MESSAGES:"MESSAGES",REPORTS:"REPORTS",SCREEN_SHARING:"SCREEN_SHARING",SLIDER:"SLIDER",REMOTE_CONTROL:"REMOTE_CONTROL",VIDEO_SHARING_CONTROL_MESSAGING:"VIDEO_SHARING_CONTROL_MESSAGING"}}(),function(a){"use strict";function b(a,b,c,d){this._keyFrame=d,this._height=b,this._width=a,this._bitmaps=c}b.prototype={getBitmaps:function(){return this._bitmaps},getWidth:function(){return this._width},getHeight:function(){return this._height},isKeyFrame:function(){return this._keyFrame}},a.Services.Collaboration.Frame=b}(AvayaClientServices),function(a){"use strict";function b(a,b){this._x=a,this._y=b}b.prototype={getX:function(){return this._x},getY:function(){return this._y},setX:function(a){this._x=a},setY:function(a){this._y=a}},a.Services.Collaboration.Point=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.SelectionStatus={PENDING:"PENDING",CONFIRMED:"CONFIRMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardLineWidths={SMALL:4,MEDIUM:8,LARGE:12}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTextSizes={SMALL:19,MEDIUM:23,LARGE:27}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolModes={STROKE:"STROKE",FILLED:"FILLED"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolTypes={SELECTION:"SELECTION",RECTANGLE:"RECTANGLE",CIRCLE:"CIRCLE",MARKER:"MARKER",PEN:"PEN",LINE:"LINE",STAMP:"STAMP",TEXT:"TEXT",DELETE:"DELETE",CLEAR:"CLEAR"}}(),function(c){"use strict";function d(b,d,e,f,g){this._collaborationProvider=b,this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._sharingState=c.Services.Collaboration.ContentSharingState.NOT_SHARING,this._screenSharingProvider=d,this._isScreenScraperActive=!1,this._collaborationsAnalyticsService=e,this.onPerformanceMonitorAlert=function(){},this._callService=f,this._callId=g,this._videoSharingStream=a,this._endVideoSharingStreamTimer=a}d.prototype={start:function(a){this._screenSharingProvider.start(),this._initSharingEventHandler(a),this.getShareAnyTypeCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(a)}.bind(this)),this.getStartSharingUsingVideoCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(a)}.bind(this))},stop:function(a){this._screenSharingProvider.stop(),this._removeSharingEventHandler(a)},setExtensionAvailable:function(a){this._screenSharingProvider.setExtensionAvailable(a)},isDisplayMediaAvailable:function(){return this._screenSharingProvider.isDisplayMediaAvailable()},startScreenSharingFullScreen:function(d,e,f){if(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start full screen sharing..."),d.getShareFullScreenCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){d._collaborationEnd=!1,this._contentSharingType=c.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING;var g=d._getCollaborations();return this._screenSharingProvider.startFullScreen(e,f).then(function(a){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,d)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,g._activeContentSharing=d,g._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),a}.bind(this),function(d){return g._activeContentSharing=a,g._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),b.Deferred().reject(d).promise()}.bind(this))}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},isSharingFullScreen:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?a:this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===c.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING},startSharingApplicationWindow:function(d,e,f){if(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start appl window sharing..."),d.getShareApplicationWindowCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){d._collaborationEnd=!1,this._contentSharingType=c.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING;var g=d._getCollaborations();return this._screenSharingProvider.startApplicationWindow(e,f).then(function(a){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,d)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,g._activeContentSharing=d,g._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),a}.bind(this),function(d){return g._activeContentSharing=a,g._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),b.Deferred().reject(d).promise()}.bind(this))}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingAnyType:function(d,e){if(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing any type..."),d.getStartScreenSharingCapability().isAllowed){if(this.getShareAnyTypeCapability().isAllowed){this._screenSharingProvider.clearOutgoingScreenSharingStream(),d._collaborationEnd=!1,this._contentSharingType=c.Services.Collaboration.ContentSharingType.ANY_TYPE;var f=d._getCollaborations();return this._screenSharingProvider.startSharingAnyType(e).then(function(a){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,d)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,f._activeContentSharing=d,f._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),a}.bind(this),function(d){return this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,f._activeContentSharing=a,f._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),b.Deferred().reject(d).promise()}.bind(this))}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingUsingVideo:function(d,e,f){if(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing USING VIDEO any type..."),d.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()){if(this.getStartSharingUsingVideoCapability().isAllowed){this._screenSharingProvider.clearOutgoingVideoSharingStream(),d._collaborationEnd=!1,this._contentSharingType=c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var g=d._getCollaborations();return this._screenSharingProvider.startSharingWithVideo(this,e,f).then(function(a){return 0<a.getVideoTracks().length&&(a.getVideoTracks()[0].onended=function(){c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.stopScreenSharingUsingVideo(d)}.bind(this)),0<a.getAudioTracks().length&&d._onAudioAddedToScreenSharingUsingVideoCallback.fire(d,a.getAudioTracks()[0]),this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,g._activeContentSharing=d,g._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),a}.bind(this),function(d){return this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,g._activeContentSharing=a,g._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),b.Deferred().reject(d).promise()}.bind(this))}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},restartScreenSharingUsingVideo:function(a,b){c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Restarting screen sharing USING VIDEO any type..."),a.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()&&this.getStartSharingUsingVideoCapability().isAllowed&&this._screenSharingProvider._collaborationProvider.startVideoSharing().then(function(){a._collaborationEnd=!1,this._contentSharingType=c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var b=a._getCollaborations();this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,b._activeContentSharing=a,b._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.COLLABORATION_SERVICE,"Failed to send StartVideoSharing event to WCS: ",a)})},stopScreenSharingUsingVideo:function(d,e){var f=d._collaboration;return(!f||f._selfParticipant&&f._selfParticipant._presenter)&&this.isScreenSharingUsingVideoInProgress()?(this._stopAllVideoSharingStreams(),this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING?(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Video content Sharing Service: Stop sharing..."),this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&(this._sharingState=c.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,(f=d._getCollaborations())._activeContentSharing=a,f._onActiveContentSharingChangedCallback.fire()),this._recalculateAllContentSharingCapabilities(d),c.Base.Utils.isUndefined(e)&&(e=!0),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,e)):(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: sharing is inactive"),e=b.Deferred(),e.resolve(),e.promise())):(c.Base.Logger.warn(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: presenter parameter is false."),b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise())},setVideoSharingStream:function(a){this._videoSharingStream=a},sendContentVideoSharingStream:function(a){return this._callService.startContentVideoSharing(this._callId,a)},isScreenSharingUsingVideoWithAudio:function(){return!!this._videoSharingStream&&0<this._videoSharingStream.getAudioTracks().length},isScreenSharingUsingVideoInProgress:function(){return!!this._videoSharingStream},getNegotiatedVideoResolution:function(){return this._callService.getNegotiatedVideoResolutionByCallId(this._callId)},updateAudioSourceForVideoSharing:function(a){return this._callService.updateAudioSourceForVideoSharing(this._callId,a)},isSharingApplicationWindow:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?a:this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===c.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING},isScreenSharingUsingVideo:function(){return this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE},_isSharingAnyType:function(){return this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===c.Services.Collaboration.ContentSharingType.ANY_TYPE},end:function(d,e){var f=e._collaboration;return!f||f._selfParticipant&&f._selfParticipant._presenter?this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING?(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing..."),this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?this.stopScreenSharingUsingVideo(e):(this._sharingState=c.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,!0===d&&(e._isPaused=!1,e._onContentSharingEndedCallbacks.fire(e,f._selfParticipant)),this._recalculateAllContentSharingCapabilities(e),e=e._getCollaborations(),e._activeContentSharing=a,e._onActiveContentSharingChangedCallback.fire(),this._isScreenScraperActive=!1,this._screenSharingProvider.stopScreenSharing(d))):(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: sharing is inactive"),d=b.Deferred(),d.resolve(),d.promise()):(c.Base.Logger.warn(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: presenter parameter is false."),b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise())},isPresenting:function(){return this._contentSharingType!==c.Services.Collaboration.ContentSharingType.NONE},isContentSharingActive:function(){return this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING},isContentSharingPaused:function(){return this._sharingState===c.Services.Collaboration.ContentSharingState.PAUSED},pause:function(){return this._sharingState===c.Services.Collaboration.ContentSharingState.SHARING?this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise():(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Pause sharing..."),this._sharingState=c.Services.Collaboration.ContentSharingState.PAUSED,this._screenSharingProvider.pause()):b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},resume:function(){return this._sharingState===c.Services.Collaboration.ContentSharingState.PAUSED?(c.Base.Logger.info(c.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Resume sharing..."),this._sharingState=c.Services.Collaboration.ContentSharingState.SHARING,this._screenSharingProvider.resume()):b.Deferred().reject(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},getShareApplicationWindowCapability:function(){return this._screenSharingProvider.getShareApplicationWindowCapability()},getReceivingBitrate:function(){return this._collaborationProvider.getReceivingBitrate()},getOutgoingScreenSharingStream:function(){return this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?this._screenSharingProvider.getOutgoingVideoSharingStream():this._screenSharingProvider.getOutgoingScreenSharingStream()},getShareFullScreenCapability:function(){return this._screenSharingProvider.getShareFullScreenCapability()},getShareAnyTypeCapability:function(){return this._screenSharingProvider.getShareAnyTypeCapability()},getStartSharingUsingVideoCapability:function(){return this._screenSharingProvider.getStartSharingUsingVideoCapability()},isOpened:function(){return this._screenSharingProvider.isOpened()},isFeatureAvailable:function(a){return this._collaborationProvider.isFeatureAvailable(a)},setImageQuality:function(a){this._screenSharingProvider.setImageQuality(a)},getImageQuality:function(a){return this._screenSharingProvider.getImageQuality()},setMaxUploadSpeed:function(a){this._screenSharingProvider.setMaxUploadSpeed(a)},getMaxUploadSpeed:function(a){return this._screenSharingProvider.getMaxUploadSpeed()},notifyPerformanceMonitorAlert:function(a,b){this.onPerformanceMonitorAlert(a,b)},isScreenSharingUsingVideoAllowed:function(){return this._callService.isMPaasCall(this._callId)&&!this._callService.isAudioOrDataOnly(this._callId)},_initSharingEventHandler:function(a){this._startScreenSharingEventHandler=this._startScreenSharingHandler(),this._endScreenSharingEventHandler=this._endScreenSharingHandler(),this._startVideoSharingEventHandler=this._startVideoSharingHandler(),this._endVideoSharingEventHandler=this._endVideoSharingHandler(),a.addOnContentSharingStartedCallback(this._startScreenSharingEventHandler),a.addOnContentSharingEndedCallback(this._endScreenSharingEventHandler),a.addOnScreenSharingUsingVideoStartedCallback(this._startVideoSharingEventHandler),a.addOnScreenSharingUsingVideoEndedCallback(this._endVideoSharingEventHandler)},_removeSharingEventHandler:function(a){this._startScreenSharingEventHandler&&this._endScreenSharingEventHandler&&(a.removeOnContentSharingStartedCallback(this._startScreenSharingEventHandler),a.removeOnContentSharingEndedCallback(this._endScreenSharingEventHandler)),this._startVideoSharingEventHandler&&this._endVideoSharingEventHandler&&(a.removeOnContentSharingStartedCallback(this._startVideoSharingEventHandler),a.removeOnContentSharingEndedCallback(this._endVideoSharingEventHandler))},_startScreenSharingHandler:function(){return function(a){}.bind(this)},_endScreenSharingHandler:function(){return function(a){var b=this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;if(b||(this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE),this._isScreenScraperActive)return this._isScreenScraperActive=!1,this._screenSharingProvider.stopScreenSharing(!0,b)}.bind(this)},_pauseScreenSharingHandler:function(a){return function(b){a._onContentSharingPausedCallbacks.fire(b)}},_startVideoSharingHandler:function(){return function(a,b){b.isLocalUser()&&clearTimeout(this._endVideoSharingStreamTimer)}.bind(this)},_endVideoSharingHandler:function(){return function(a,b,d){var e=function(){if(this._contentSharingType===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&this.isScreenSharingUsingVideoInProgress())return this._contentSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._stopAllVideoSharingStreams(),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,!1)}.bind(this);d?this._endVideoSharingStreamTimer=setTimeout(e,500):e()}.bind(this)},_endActiveScreenSharing:function(a,b){this._sharingState!==c.Services.Collaboration.ContentSharingState.NOT_SHARING&&(a._isPaused=!1,this._sharingState=c.Services.Collaboration.ContentSharingState.NOT_SHARING,a._onContentSharingEndedCallbacks.fire(a,b))},_stopAllVideoSharingStreams:function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(a){a.stop()}),this._videoSharingStream=a),this._screenSharingProvider.clearOutgoingVideoSharingStream()},_recalculateAllContentSharingCapabilities:function(a){a._recalculateShareApplicationWindowCapability(a._collaboration),a._recalculateShareFullScreenCapability(a._collaboration),a._recalculateShareAnyTypeCapability(a._collaboration),a._recalculateShareContentVideoCapability(a._collaboration)}},c.Services.Collaboration.ContentSharingService=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingState={NOT_SHARING:"not sharing",SHARING:"sharing",PAUSED:"paused"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingType={NONE:"none",FULL_SCREEN_SHARING:"full screen",APP_WINDOW_SHARING:"application window",ANY_TYPE:"any type",VIDEO_ANY_TYPE:"video any type"}}(),function(a){"use strict";function c(){this._slides=[],this._onSlidesAddedCallbacks=b.Callbacks(),this._onSlidesRemovedCallbacks=b.Callbacks()}c.prototype={getSlides:function(){var b=[];return this._slides.forEach(function(c){b.push(new a.Services.Collaboration.SliderSlide(c.getNumber(),c.getSlideURL(),c.getThumbnailURL(),c.getCreateTime()))}),b},_addSlides:function(b){this._slides.push(new a.Services.Collaboration.SliderSlide(b.getNumber(),b.getSlideURL(),b.getThumbnailURL(),b.getCreateTime()))},_removeSlides:function(){this._slides=[]}},a.Services.Collaboration.Slider=c}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Collaboration.Slider.prototype,{addOnSlidesAddedCallback:function(a){this._onSlidesAddedCallbacks.add(a);
},removeOnSlidesAddedCallback:function(a){this._onSlidesAddedCallbacks.remove(a)},addOnSlidesRemovedCallback:function(a){this._onSlidesRemovedCallbacks.add(a)},removeOnSlidesRemovedCallback:function(a){this._onSlidesRemovedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";function b(a,b,c,d){this._number=a,this._slideURL=b,this._thumbnailURL=c,this._createTime=d}b.prototype={getSlideURL:function(){return this._slideURL},getThumbnailURL:function(){return this._thumbnailURL},getNumber:function(){return this._number},getCreateTime:function(){return this._createTime}},a.Services.Collaboration.SliderSlide=b}(AvayaClientServices),function(c){"use strict";function d(b,c){this._collaborationProvider=b,this._checkOnNewPoints=a,this._throttlingInterval=100,this._collaborationsAnalyticsService=c}d.prototype={start:function(a,d){var e=b.Deferred();if(a._collaboration.getWhiteboardCapability().isAllowed){var f=function(){this._collaborationsAnalyticsService.sendStartupEvent(!0)}.bind(this),g=function(){this._collaborationsAnalyticsService.sendStartupEvent(!1)}.bind(this);return c.Base.Utils.isDefined(d)?d.isActive()?(e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_ALREADY_ACTIVE)),e.promise()):(a.getSurfaces().forEach(function(a){a._active=!1}),this._collaborationProvider.startWhiteboard(d.getSurfaceId()).then(f,g)):(d=a.getSurfaces(),0===d.length?this._collaborationProvider.startWhiteboard().then(f,g):(a=d.filter(function(a){return a.isActive()})[0],(a?this._collaborationProvider.startWhiteboard(a.getSurfaceId()):this._collaborationProvider.startWhiteboard(d[0].getSurfaceId())).then(f,g)))}return e.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)),e},end:function(a){var d=b.Deferred();if(a.getActiveSurface()){if(a._collaboration.getWhiteboardCapability().isAllowed)return this._collaborationProvider.endWhiteboard(a);d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED))}else d.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE));return d},stop:function(d){var e=b.Deferred();return d._currentLiveDrawingWhiteboardIds=[],d._currentLiveDrawingShapes=[],d._activeSurface=a,d._recentlyActiveSurface=a,d._surfaces.length=0,d._onWhiteboardStartedCallbacks.empty(),d._onWhiteboardEndedCallbacks.empty(),d._onWhiteboardSurfaceAddedCallbacks.empty(),d._onWhiteboardSurfaceRemovedCallbacks.empty(),d._onWhiteboardSurfaceSetActiveCallbacks.empty(),d._removeWhiteboardCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),e.resolve(),e.promise()},requestNewSurface:function(a){var d=b.Deferred();return a.getActiveSurface()?a.getAddWhiteboardCapability().isAllowed?this._collaborationProvider.addWhiteboardSurface().then(function(a){d.resolve(a)},function(a){d.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,a))}):d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):d.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),d.promise()},removeSurface:function(a,d){var e=b.Deferred();return a.getActiveSurface()?1<a.getSurfaces().length?a.getRemoveWhiteboardCapability().isAllowed?this._collaborationProvider.removeWhiteboardSurface(d.getSurfaceId()).then(function(a){e.resolve(a)},function(a){e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,a))}):e.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_LAST_SURFACE)):e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),e.promise()},addCircle:function(a,b){return this._collaborationProvider.addCircle(b,a.getSurfaceId()).done(function(c){var d=b.getId();return c?(b.setId(c),delete a.getShapes()[d],a.getShapes()[c]=b):a.getShapes()[d]=b,c})},addShape:function(a,b){return b.isFinished()?this._collaborationProvider.addShape(b,a.getSurfaceId()).done(function(c){var d=b.getId();return c?(b.setId(c),delete a.getShapes()[d],a.getShapes()[c]=b):a.getShapes()[d]=b,c}):(b._readyToSendCallbacks.add(this._throttleLiveDrawing.bind(this,b,a)),this._collaborationProvider.startDrawShape(b,a.getSurfaceId()).done(function(c){var d=b.getId();return c?(b.setId(c),delete a.getShapes()[d],a.getShapes()[c]=b):a.getShapes()[d]=b,c}))},addText:function(a,b){return this._collaborationProvider.addText(b,a.getSurfaceId()).done(function(c){var d=b.getId();return c?(b.setId(c),delete a.getShapes()[d],a.getShapes()[c]=b):a.getShapes()[d]=b,c})},moveSelection:function(a,b){return b instanceof c.Services.Collaboration.Shape?this._collaborationProvider.moveSelection(b,a.getSurfaceId(),b.getPoints()[0].point):b instanceof c.Services.Collaboration.Circle?this._collaborationProvider.moveSelection(b,a.getSurfaceId(),b.getTopLeft()):b instanceof c.Services.Collaboration.WhiteboardText?this._collaborationProvider.moveSelection(b,a.getSurfaceId(),b.getPosition()):this._collaborationProvider.moveSelection(b,a.getSurfaceId())},removeShape:function(a,d){if(d.isMine())return d instanceof c.Services.Collaboration.Shape?e=d.getPoints()[0].point:d instanceof c.Services.Collaboration.Circle?e=d.getTopLeft():d instanceof c.Services.Collaboration.WhiteboardText&&(e=d.getPosition()),this._collaborationProvider.removeShape(d,a.getSurfaceId(),e);var e=b.Deferred();return e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SHAPE_NOT_MINE)),e.promise()},clearContent:function(a){return this._collaborationProvider.clearContent(a.getSurfaceId())},endDrawShape:function(a,b){return b._hasPointsToSend()&&this._collaborationProvider.liveDrawShape(b,a.getSurfaceId()),this._collaborationProvider.endDrawShape(b,a.getSurfaceId())},_throttleLiveDrawing:function(a,b){if(a._hasPointsToSend())return this._collaborationProvider.liveDrawShape(a,b.getSurfaceId())}},c.Services.Collaboration.WhiteboardService=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTools=function(){this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION]={name:"Selection",type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN,name:"Pen",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER,name:"Marker",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE,name:"Line",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardLineWidths,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE,name:"Rect",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE,name:"Circle",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP,name:"Stamp",drag:!1,live:!1,drawFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT,name:"Text",drag:!1,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardTextSizes},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE,name:"Delete"},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR,name:"Clear All"}}}(),function(b){"use strict";function c(b,d,e,f){this._messageContent=b,this._sender=d,this._recipient=e,this._isPrivate=f,this._time=new Date,c._idCounter===Number.MAX_SAFE_INTEGER&&(c._idCounter=1e5),this._id=""+ ++c._idCounter,this.status=a}Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=Math.pow(2,53)-1),c._idCounter=1e5,c.prototype={setStatus:function(a){var c,d=!1;for(c in b.Services.Conference.ChatMessageStatus)if(b.Services.Conference.ChatMessageStatus.hasOwnProperty(c)&&a===b.Services.Conference.ChatMessageStatus[c]){b.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.status=a,d=!0;break}return d},getSender:function(){return this._sender},getMessageContent:function(){return this._messageContent},isPrivate:function(){return this._isPrivate},getRecipient:function(){return this._recipient},getTime:function(){return this._time},getId:function(){return this._id}},b.Services.Conference.ChatMessage=c}(AvayaClientServices),function(c){"use strict";function d(a){this._conferenceProvider=a,this._enableSendingMessages=!0}d.prototype={sendMessage:function(d,e,f){if(this._enableSendingMessages){var g=f?f._participantId:a,h=!!f,i=new c.Services.Conference.ChatMessage(e,d._selfParticipant,f,h);return i.getRecipient().addOnParticipantNameChangedCallback(function(a){i._recipient=a}),i.setStatus(c.Services.Conference.ChatMessageStatus.PENDING),this.addMessage(d,i),this._conferenceProvider.sendChatMessage(e,g).then(function(){i.setStatus(c.Services.Conference.ChatMessageStatus.CONFIRMED)}.bind(this),function(a){return i.setStatus(c.Services.Conference.ChatMessageStatus.ERROR),b.Deferred().reject(a).promise()}.bind(this))}return g="Sending messages is disabled while conference is in WAITING_ROOM state",c.Base.Logger.error(c.Base.LoggerTags.CHAT_SERVICE,g),g=new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,g),b.Deferred().reject(g).promise()},addMessage:function(a,b){(b.isPrivate()?a._privateMessages:a._publicMessages).push(b),a._allMessages.push(b),a._onChatMessageReceivedCallbacks.fire(a,b)},_setEnableSendingMessages:function(a){this._enableSendingMessages=a}},c.Services.Conference.ChatService=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceException=function(a,b){this.name=a,this.message=b}}(),function(c){"use strict";function d(b,c,d){this._conferenceType=b,this._conferenceProvider=c,this._contactsIntegrationService=d,this._onContactListChanged=a,this._isDisconnecting=!1}d.prototype={start:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?(c.Base.Logger.info(c.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is starting..."),a._isStarting=!0,this._conferenceProvider.start(a,d).then(function(){this._conferenceProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(c.Base.Utils.isUndefined(a._isAvailable)||a._isAvailable)&&(a._isAvailable=!1,a._onConferenceServiceUnavailableCallbacks.fire(a))}.bind(this)),this._conferenceProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,a._onConferenceServiceAvailableCallbacks.fire(a))}.bind(this)),this._onContactListChanged=function(){this._updateMatchedContactsForConference(a)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,a._onConferenceServiceAvailableCallbacks.fire(a)),a._setConferenceStarted(!0),a._recalculateAllAddParticipantFromCallCapability(),a.addOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses)}.bind(this),function(c){return a._isStarting=!1,a._setConferenceStarted(!1),b.Deferred().reject(c).promise()})):(d=b.Deferred(),c.Base.Logger.info(c.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is not enabled"),d.reject({name:c.Services.Conference.ConferenceStartStatus.CONFERENCE_SERVICE_NOT_ENABLED,message:"Conference Service is not enabled"}),d.promise())},stop:function(d){return d._isAvailable&&(d._isAvailable=!1,d._recalculateInConferenceChatCapability(),d._onConferenceServiceUnavailableCallbacks.fire(d)),d._isStarting=!1,d._setConferenceStarted(!1),c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stop().then(function(b){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=a,d.removeOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses),d._selfParticipantId="",d._activeTalkerId="",d._lecturerId="",d._presenterId="",d._conferenceOwnerAddress="",d._mediaStatus="",d._activeParticipants=[],d._droppedParticipants=[],d._pendingParticipants=[],d._isLectureModeActive=!1,d._isHandRaised=!1,d._recordingStatus=c.Services.Conference.RecordingStatus.OFF,d._isVideoAllowed=!1,d._isWebCollaborationActive=!1,d._isLocked=!1,d._isPasscodeRequiredToBecomeModerator=!1,d._isVideoParticipantNameDisplayActive=!1,d._isVideoPersonalLayoutActive=a,d._isVideoSelfSeeActive=!1,d._isVideoSelfSeeChangeAllowed=!1,d._isVideoPinAllowed=!1,d._isVideoParticipantNameDisplayChangeAllowed=!1,d._currentVideoLayout="",d._supportedVideoLayouts=[],d._subject="",d._sipURI="",d._isApplicationSharingActive=!1,d._brandName="",d._collaborationURI="",d._joinMeetingURI="",d._streamingURI="",d._dialInInformation="",d._dialInInformationHtml="",d._admissionPermissionNeeded=!1,d._admissionPasscodeNeeded=!1,b}.bind(this)):b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.PROVIDER_UNAVAILABLE,"ConferenceProvider")).promise()},stopImmediately:function(a){return a._isAvailable&&(a._isAvailable=!1,a._onConferenceServiceUnavailableCallbacks.fire(a)),a._isStarting=!1,a._setConferenceStarted(!1),b.Deferred().resolve().promise()},terminateConference:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.terminateConference():b.Deferred().reject().promise()},getType:function(){return this._conferenceType},removeLastParticipant:function(){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.removeLastParticipant():b.Deferred().reject().promise()},sendAdmissionRequest:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendAdmissionRequest(a,d):b.Deferred().reject().promise()},requestToBecomeModerator:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.requestToBecomeModerator(d):b.Deferred().reject().promise()},signIn:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.signIn(d):b.Deferred().reject().promise()},videoPin:function(a,d,e,f,g){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.videoPin(a,d,e,f,g):b.Deferred().reject().promise()},extendMeeting:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.extendMeeting(a):b.Deferred().reject().promise()},addParticipant:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipant(a,d):b.Deferred().reject().promise()},addParticipantFromCall:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipantFromCall(a):b.Deferred().reject().promise()},cancelDialoutParticipant:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.cancelDialoutParticipant(a,d._participantId):b.Deferred().reject().promise()},setAsLecturer:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setAsLecturer(a._participantId):b.Deferred().reject().promise()},setLocked:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setLocked(d):b.Deferred().reject().promise()},startRecording:function(a,d,e){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.startRecording(a,d,e):b.Deferred().reject().promise()},stopRecording:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stopRecording(a):b.Deferred().reject().promise()},pauseRecording:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.pauseRecording(a):b.Deferred().reject().promise()},resumeRecording:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.resumeRecording(a):b.Deferred().reject().promise()},setVideoLayout:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?(a=a.getUpdateVideoLayoutCapability(),!1!==a.isAllowed?this._conferenceProvider.setVideoLayout(d):(a=a.denialReason,b.Deferred().reject(a).promise())):b.Deferred().reject().promise()},setVideoLayoutSelfSee:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?(a=a.getUpdateVideoSelfSeeCapability(),!1!==a.isAllowed?this._conferenceProvider.setVideoLayoutSelfSee(d):(a=a.denialReason,b.Deferred().reject(a).promise())):b.Deferred().reject().promise()},setVideoLayoutTextOverlay:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?(a=a.getUpdateDisplayVideoParticipantNameCapability(),!1!==a.isAllowed?this._conferenceProvider.setVideoLayoutTextOverlay(d):(a=a.denialReason,b.Deferred().reject(a).promise())):b.Deferred().reject().promise()},getCurrentVideoLayout:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.getCurrentVideoLayout():b.Deferred().reject().promise()},muteAllParticipants:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!0):b.Deferred().reject().promise()},unmuteAllParticipants:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!1):b.Deferred().reject().promise()},raiseLowerHand:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?a?this._conferenceProvider.raiseLowerHand(c.Services.Conference.ParticipantHandState.RAISE):this._conferenceProvider.raiseLowerHand(c.Services.Conference.ParticipantHandState.LOWER):b.Deferred().reject().promise()},disconnectParticipant:function(a){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.disconnectParticipant(a):b.Deferred().reject().promise()},sendDisconnectEvent:function(){return c.Base.Utils.isDefined(this._conferenceProvider)?this._isDisconnecting?b.Deferred().resolve():(this._isDisconnecting=!0,c.Base.Logger.info(c.Base.LoggerTags.CONFERENCE_SERVICE,"Conference sent disconnect event"),this._conferenceProvider.sendDisconnectEvent(c.Services.Conference.DisconnectReason.CALL_DISCONNECTED)):b.Deferred().reject().promise()},sendLocalMuteEvent:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendLocalMuteEvent(a,d):b.Deferred().reject().promise()},changeParticipantName:function(a,d){return c.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.changeParticipantName(a._participantId,d):b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError,"Conference provider is not defined")).promise()},_recalculateAllCapabilities:function(a){a._recalculateSetLockCapability(),a._recalculateDisplayVideoParticipantNameCapability(),a._recalculateVideoSelfSeeCapability(),a._recalculateSetVideoLayoutCapability(),a._recalculateStartStopRecordingCapability(),a._recalculatePauseResumeRecordingCapability(),a._recalculateMuteUnmuteAllCapability(),a._recalculateRaiseHandSupportCapability(),a._recalculateLowerHandSupportCapability(),a._recalculateRequestToBecomeModeratorCapability(),a._recalculateVideoPinCapability(),a._recalculateRemoveSelectParticipantCapability(),a._recalculateAddParticipantViaDialoutCapability(),a._recalculateSignInCapability(),a._recalculateModerateConferenceCapability(),a._recalculateActiveTalkerCapability(),a._recalculateMuteSelfAudioCapability(),a._recalculateUnmuteSelfAudioCapability(),a._recalculateSendFeccCapability(),a._recalculateTerminateConferenceCapability(),a._recalculateAcceptPendingParticipantCapability(),a._recalculateDenyPendingParticipantCapability(),a._recalculateExtendMeetingCapability(),a._recalculateRetrieveParticipantListCapability(),a._recalculateInConferenceChatCapability()},_updateMatchedContactsForParticipant:function(a){this._contactsIntegrationService.updateMatchedContactsForParticipant(a,!0)},_updateMatchedContactsForConference:function(a){var b;this._contactsIntegrationService.isStarted()&&a&&(b=[],a.getActiveParticipants().forEach(function(a){b.push(a)}),a.getPendingParticipants().forEach(function(a){b.push(a)}),a.getDroppedParticipants().forEach(function(a){b.push(a)}),b.forEach(function(a){this._updateMatchedContactsForParticipant(a)},this))},_recalculateAddParticipantFromCallCapability:function(a,b){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapability(a,b)},_recalculateAddParticipantFromCallCapabilityByCallId:function(a,b){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapabilityByCallId(a,b)},_recalculateConferenceRecordingStatuses:function(a){a._recalculateStartStopRecordingCapability(),a._recalculatePauseResumeRecordingCapability()}},c.Services.Conference.ConferenceService=d}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceType={CM_CONFERENCE:"CM",SCOPIA_CONFERENCE:"Scopia"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AdmissionResponseCode={SUCCESS:"success",INCORRECT_PASSCODE_TRY_AGAIN:"incorrectPasscodeTryAgain",INCORRECT_PASSCODE_DISCONNECTING:"incorrectPasscodeDisconnecting",PENDING_APPROVAL:"pendingApproval",REJECTED:"rejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AllowVideoDirection={SEND_RECEIVE:"biDirectional",RECEIVE_ONLY:"serverToClient",SEND_ONLY:"clientToServer",INACTIVE:"none"}}(),function(){"use strict";AvayaClientServices.Services.Conference.CameraControl={CAMERA_CONTROL_UP:"up",CAMERA_CONTROL_DOWN:"down",CAMERA_CONTROL_RIGHT:"right",CAMERA_CONTROL_LEFT:"left",CAMERA_CONTROL_ZOOM_IN:"in",CAMERA_CONTROL_ZOOM_OUT:"out"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatMessageStatus={PENDING:"pending",CONFIRMED:"confirmed",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatType={PRIVATE:"private",PUBLIC:"public"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceError={CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",INVALID_ARGUMENT:"INVALID_ARGUMENT",NETWORK_UNAVAILABLE:"NETWORK_UNAVAILABLE",CONFERENCE_CONNECTION_FAILED_TO_RECOVER:"CONFERENCE_CONNECTION_FAILED_TO_RECOVER",PROVIDER_UNAVAILABLE:"PROVIDER_UNAVAILABLE",NOT_SUPPORTED:"NOT_SUPPORTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceStartStatus={ADMISSION_NEEDED:"admissionNeeded",CONFERENCE_SERVICE_NOT_ENABLED:"conferenceServiceNotEnabled",CONFERENCE_CONFIG_NOT_ENABLED:"conferenceConfigIsNotEnabled",HANDSHAKE_REJECTED:"handshakeRejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ContentFromParticipantStatus={ACTIVE:"active",ALLOWED:"allowed",NOT_ALLOWED:"notAllowed"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DialoutStatus={DIALING:"dialing",UNAUTHORIZED:"unauthorized",FAIL:"fail",NOT_ADMITTED:"notAdmitted",NOT_ALLOWED:"notAllowed",CONNECT:"connect",BUSY:"busy",NO_ANSWER:"noAnswer",CANCELED:"canceled"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DisconnectReason={CALL_DISCONNECTED:"callDisconnected",CONFERENCE_TERMINATED:"conferenceTerminated",DISCONNECTED_BY_MODERATOR_OR_ADMIN:"disconnectedByModeratorOrAdmin",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaFromParticipantStatus={ACTIVE:"active",NA:"na",SELF_MUTED:"selfMuted",MODERATOR_MUTED:"moderatorMuted",BOTH_MUTED:"bothMuted"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaStatus={WAITING_ROOM:"waitingRoom",ACTIVE:"active",MUTE_ALL_AUDIO:"muteAllAudio"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaToParticipantStatus={AVAILABLE:"available",NA:"na"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaType={AUDIO:"audio",VIDEO:"video"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MeetingEncryptionStatus={YES:"yes",NO:"no",PARTIAL:"partial"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ModeratorAdmissionActions={ADMIT:"admit",REJECT:"reject"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantAuthorizationStatus={ACTIVE:"active",AUTHORIZING:"authorizing"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantConnectionStatus={CONNECTION_STATUS_UNKNOWN:"CONNECTION_STATUS_UNKNOWN",CONNECTION_STATUS_CONNECTING:"CONNECTION_STATUS_CONNECTING",CONNECTION_STATUS_CONNECTED:"CONNECTION_STATUS_CONNECTED",CONNECTION_STATUS_DISCONNECTING:"CONNECTION_STATUS_DISCONNECTING",CONNECTION_STATUS_DISCONNECTED:"CONNECTION_STATUS_DISCONNECTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantDisconnectionReason={DISCONNECT_REASON_UNKNOWN:"DISCONNECT_REASON_UNKNOWN",DISCONNECT_REASON_DEPARTED:"DISCONNECT_REASON_DEPARTED",DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR:"DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantHandState={RAISE:"raise",LOWER:"lower"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantMediaState={MEDIA_STATUS_NO_MEDIA:"MEDIA_STATUS_NO_MEDIA",MEDIA_STATUS_INACTIVE:"MEDIA_STATUS_INACTIVE",MEDIA_STATUS_RECEIVE_ONLY:"MEDIA_STATUS_RECEIVE_ONLY",MEDIA_STATUS_SEND_ONLY:"MEDIA_STATUS_SEND_ONLY",MEDIA_STATUS_SEND_RECEIVE:"MEDIA_STATUS_SEND_RECEIVE"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantRole={MODERATOR:"moderator",PARTICIPANT:"participant",GUEST:"guest",OPERATOR:"operator",RESTRICTED_PARTICIPANT:"restrictedParticipant"}}(),function(){"use strict";AvayaClientServices.Services.Conference.PermissionStatus={ALLOWED:"allowed",NOT_ALLOWED:"notAllowed",NEED_SIGNIN:"needSignin",NEED_MODERATOR:"needModerator",NEED_SIGNIN_OR_MODERATOR:"needSigninOrModerator"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecorderStatus={NONE:"none",START_STOP:"start/stop",WITH_PAUSE:"withPause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingOperation={START:"start",STOP:"stop",PAUSE:"pause",RESUME:"resume"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingStatus={ON:"on",OFF:"off",PAUSE:"pause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.VideoLayout={LAYOUT_AUTOMATIC:"1",LAYOUT_SINGLE_SCREEN:"10",LAYOUT_DOUBLE_SCREEN_HORIZONTAL:"21",LAYOUT_DOUBLE_SCREEN_VERTICAL:"22",LAYOUT_DOUBLE_SCREEN_4_TO_1:"27",LAYOUT_1_HOST_1_PIP:"28",LAYOUT_PYRAMID_3:"32",LAYOUT_LANDSCAPE_PLUS_2_ASYM:"33",LAYOUT_1_HOST_2_PIP:"34",LAYOUT_3x1:"35",LAYOUT_2x2:"40",LAYOUT_4_PYRAMID:"41",LAYOUT_3_PLUS_1:"42",LAYOUT_1_HOST_3_PIP:"43",LAYOUT_5_PYRAMID:"51",LAYOUT_1_HOST_4_PIP:"52",LAYOUT_5_PLUS_1:"60",LAYOUT_3x2:"61",LAYOUT_6_PLUS_1_1:"75",LAYOUT_7_PLUS_1_NEW:"81",LAYOUT_4x2:"82",LAYOUT_3x3:"90",LAYOUT_9_PYRAMID:"91",LAYOUT_8_PLUS_2_1_2:"101",LAYOUT_4x3:"120",LAYOUT_12_PLUS_1_1:"131",LAYOUT_12_PLUS_1_5:"135",LAYOUT_4x4:"160",LAYOUT_20_PLUS_1:"210",LAYOUT_20_PLUS_1_LEFT:"211",LAYOUT_1_PLUS_27:"280"}}(),function(a){"use strict";function c(a){this._conferenceProvider=a}c.prototype={setAsLecturer:function(a){return this._conferenceProvider.setAsLecturer(a.getParticipantId())},unsetAsLecturer:function(){return this._conferenceProvider.unsetAsLecturer()},controlRemoteCamera:function(a,b){return this._conferenceProvider.controlRemoteCamera(a.getParticipantId(),b)},mute:function(b){return this._conferenceProvider.muteUnmute(b.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!0)},unmute:function(b){return this._conferenceProvider.muteUnmute(b.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!1)},accept:function(b){return this._conferenceProvider.moderatorAdmission(b,a.Services.Conference.ModeratorAdmissionActions.ADMIT)},deny:function(b){return this._conferenceProvider.moderatorAdmission(b,a.Services.Conference.ModeratorAdmissionActions.REJECT)},blockVideo:function(b){return this._conferenceProvider.muteUnmute(b.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!0)},unblockVideo:function(b){return this._conferenceProvider.muteUnmute(b.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!1)},lowerHand:function(a,b){return this._conferenceProvider.moderatorLowerHand(a.getParticipantId(),b)},changeParticipantName:function(c,d){var e=c._conference.getSelfParticipant();return e.getChangeParticipantNameCapability().isAllowed?this._conferenceProvider.changeParticipantName(c._participantId,d):(e="Cannot change participant name. Reason: "+e.getChangeParticipantNameCapability().denialReason,a.Base.Logger.error(a.Base.LoggerTags.PARTICIPANT_SERVICE,e),b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,e)).promise())},recalculateAllCapabilities:function(a){a._recalculateBlockUnblockVideoCapability(),a._recalculateMuteUnmuteCapability(),a._recalculateLowerHandCapability(),a._recalculateSetAsLecturerCapability(),a._recalculateRemoteCameraControlCapability(),a._recalculateChangeParticipantNameCapability()}},a.Services.Conference.ParticipantService=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.RecentTalkersConfiguration={SIZE:4}}(),function(a){"use strict";function b(){this._writeCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}b.prototype={getWriteCapability:function(){return this._writeCapability},_setWriteCapability:function(a){this._writeCapability=a}},a.Services.Contacts.ContactField=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactField.call(this),this._values=[]}(b.prototype=Object.create(a.Services.Contacts.ContactField.prototype)).getValues=function(){return this._values},b.prototype.isEmpty=function(){return!this._values||0===this._values.length},b.prototype.getSize=function(){return this._values?this._values.length:0},a.Services.Contacts.ContactFieldList=b}(AvayaClientServices),function(b){"use strict";function c(){b.Services.Contacts.ContactField.call(this),this._address=a,this._imAddressType=b.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER,this._default=!1,this._avayaAdministered=!1}(c.prototype=Object.create(b.Services.Contacts.ContactField.prototype)).getAddress=function(){return this._address},c.prototype.getIMAddressType=function(){return this._imAddressType},c.prototype.isDefault=function(){return this._default},c.prototype.setAvayaAdministered=function(a){this._avayaAdministered=a},c.prototype.isAvayaAdministered=function(){return this._avayaAdministered},b.Services.Contacts.ContactIMAddressField=c;
}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactField.call(this),this._value=0}(b.prototype=Object.create(a.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},a.Services.Contacts.ContactNumberField=b}(AvayaClientServices),function(b){"use strict";function c(){b.Services.Contacts.ContactField.call(this),this._phoneNumber=a,this._label1=a,this._label2=a,this._phoneNumberType=b.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK,this._speedDialEnabled=!1,this._default=!1,this._avayaAdministered=!1}(c.prototype=Object.create(b.Services.Contacts.ContactField.prototype)).getPhoneNumber=function(){return this._phoneNumber},c.prototype.getLabel1=function(){return this._label1},c.prototype.getLabel2=function(){return this._label2},c.prototype.getPhoneNumberType=function(){return this._phoneNumberType},c.prototype.isSpeedDialEnabled=function(){return this._speedDialEnabled},c.prototype.isDefault=function(){return this._default},c.prototype.setAvayaAdministered=function(a){this._avayaAdministered=a},c.prototype.isAvayaAdministered=function(){return this._avayaAdministered},b.Services.Contacts.ContactPhoneField=c}(AvayaClientServices),function(b){"use strict";function c(){b.Services.Contacts.ContactField.call(this),this._value=a}(c.prototype=Object.create(b.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},b.Services.Contacts.ContactStringField=c}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactIMAddressField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactIMAddressField.prototype)).setAddress=function(a){this._address=a},b.prototype.setIMAddressType=function(b){var c,d=!1;for(c in a.Services.Contacts.ContactIMAddressType)if(a.Services.Contacts.ContactIMAddressType.hasOwnProperty(c)&&b===a.Services.Contacts.ContactIMAddressType[c]){this._imAddressType=b,this._default=this._imAddressType===a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK,d=!0;break}return d},a.Services.Contacts.EditableContactIMAddressField=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactNumberField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactNumberField.prototype)).setValue=function(a){this._value=a},a.Services.Contacts.EditableContactNumberField=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactPhoneField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactPhoneField.prototype)).setPhoneNumber=function(a){this._phoneNumber=a},b.prototype.setLabel1=function(a){this._label1=a},b.prototype.setLabel2=function(a){this._label2=a},b.prototype.setPhoneNumberType=function(b){var c,d=!1;for(c in a.Services.Contacts.ContactPhoneNumberType)if(a.Services.Contacts.ContactPhoneNumberType.hasOwnProperty(c)&&b===a.Services.Contacts.ContactPhoneNumberType[c]){this._phoneNumberType=b,d=!0;break}return d},b.prototype.setSpeedDialEnabled=function(a){this._speedDialEnabled=a},b.prototype.setDefault=function(a){this._default=a},a.Services.Contacts.EditableContactPhoneField=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactStringField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactStringField.prototype)).setValue=function(a){this._value=a},a.Services.Contacts.EditableContactStringField=b}(AvayaClientServices),function(b){"use strict";function c(){this._cacheKeys=[b.Services.Contacts.ContactCacheKeys.FIRST_NAME,b.Services.Contacts.ContactCacheKeys.LAST_NAME,b.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,b.Services.Contacts.ContactCacheKeys.ALIAS,b.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,b.Services.Contacts.ContactCacheKeys.HANDLE,b.Services.Contacts.ContactCacheKeys.LOGIN_ID,b.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,b.Services.Contacts.ContactCacheKeys.CITY,b.Services.Contacts.ContactCacheKeys.DEPARTMENT,b.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING,b.Services.Contacts.ContactCacheKeys.TERMINAL_NAME],this._imdb=new b.Base.SimpleIMDB(this._cacheKeys)}c.prototype={addContact:function(a){var c=this._buildKeys(a);try{this._imdb.addElement(c,a)}catch(a){b.Base.Logger.warn(b.Base.LoggerTags.CONTACTS_SERVICE,"Failed to add contact to cache ("+a.message+")")}},updateContact:function(a){var c=this._buildKeysWithMatchingAddressOnly(a),d=this._buildKeys(a);try{this._imdb.updateElement(c,d,a)}catch(a){b.Base.Logger.warn(b.Base.LoggerTags.CONTACTS_SERVICE,"Failed to update contact in cache ("+a.message+")")}},deleteContact:function(a){var c=this._buildKeysWithMatchingAddressOnly(a);try{this._imdb.deleteElements(c)}catch(a){b.Base.Logger.warn(b.Base.LoggerTags.CONTACTS_SERVICE,"Failed to delete contact from cache ("+a.message+")")}},searchContacts:function(a,c,d){if(a=a.trim(),c===b.Services.Contacts.SearchFieldType.NAME)return this.searchByName(a,d);if(c===b.Services.Contacts.SearchFieldType.HANDLE)return this.searchByHandle(a,d);if(c===b.Services.Contacts.SearchFieldType.LOGIN_ID)return this.searchByLoginId(a,d);if(c===b.Services.Contacts.SearchFieldType.TERMINAL)return this.searchByTerminal(a,d);if(c===b.Services.Contacts.SearchFieldType.ALL)return this.searchAll(a,d);throw new b.Services.Contacts.ContactsError(b.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+c)},resolveContacts:function(a,c,d){if(a=a.trim(),c===b.Services.Contacts.ResolveContactsFieldType.HANDLE)return this.searchByHandle(a,d);if(c===b.Services.Contacts.ResolveContactsFieldType.PHONE_NUMBER)return this.resolveContactsByPhone(a,d);throw new b.Services.Contacts.ContactsError(b.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+c)},searchAll:function(c,d){var e=b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(c).split(/[,]+/);2<(e=1===(e=e.filter(function(a){return""!==a.trim()})).length?e.toString().split(/[\s]+/):e).length&&(e[2]=e.slice(2).toString().trim());var f=new Array(e.length);if(f[0]=this._imdb.searchByAllKeys(e[0].trim(),b.Base.IMDBSearchOptions.BEGINS_WITH),f[0]===a)return a;for(var g=1;g<e.length&&g<3;g++)if(f[g]=this._imdb.searchByAllKeys(e[g].trim(),b.Base.IMDBSearchOptions.BEGINS_WITH),f[g]===a)return a;return c=b.Base.Utils.removeDuplicatesFromArray(f[0]).filter(function(a){for(g=1;g<f.length;g++){for(var b=f[g],c=!1,d=0;d<b.length;d++)a===b[d]&&(c=!0);if(!c)return!1}return!0}),d?(d=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<c.length&&(d._exactType1Contacts=c,d._allContacts=c,d._empty=!1),d):c},searchByName:function(c,d){var e=b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(c).split(/[,]+/);2<(e=1===(e=e.filter(function(a){return""!==a.trim()})).length?e.toString().split(/[\s]+/):e).length&&(e[2]=e.slice(2).toString().trim());for(var f=new Array(e.length),g=[b.Services.Contacts.ContactCacheKeys.FIRST_NAME,b.Services.Contacts.ContactCacheKeys.LAST_NAME,b.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,b.Services.Contacts.ContactCacheKeys.ALIAS],h=0;h<e.length&&h<3;h++){f[h]=[];for(var i=0;i<g.length;i++){var j=this._imdb.searchBySingleKey(g[i],e[h].trim(),b.Base.IMDBSearchOptions.BEGINS_WITH);f[h]=f[h].concat(j)}if(0===f[h].length)return a}return c=b.Base.Utils.removeDuplicatesFromArray(f[0]).filter(function(a){function b(b){return a===b}for(h=1;h<f.length;h++)if(!f[h].some(b))return!1;return!0}),d?(d=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<c.length&&(d._exactType1Contacts=c,d._allContacts=c,d._empty=!1),d):c},searchByHandle:function(a,c){var d=b.Services.Contacts.ContactsUtils.normalizeHandle(a),a=this._imdb.searchBySingleKey(b.Services.Contacts.ContactCacheKeys.HANDLE,d),d=this._imdb.searchBySingleKey(b.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,d),d=a.concat(d),d=b.Base.Utils.removeDuplicatesFromArray(d);return c?(c=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<d.length&&(c._exactType1Contacts=d,c._allContacts=d,c._empty=!1),c):d},searchByLoginId:function(a,c){return a=this._imdb.searchBySingleKey(b.Services.Contacts.ContactCacheKeys.LOGIN_ID,a),a=b.Base.Utils.removeDuplicatesFromArray(a),c?(c=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<a.length&&(c._exactType1Contacts=a,c._allContacts=a,c._empty=!1),c):a},searchByTerminal:function(a,c){return a=b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(a),a=this._imdb.searchBySingleKey(b.Services.Contacts.ContactCacheKeys.TERMINAL_NAME,a,b.Base.IMDBSearchOptions.CONTAINS),a=b.Base.Utils.removeDuplicatesFromArray(a),c?(c=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<a.length&&(c._exactType1Contacts=a,c._allContacts=a,c._empty=!1),c):a},searchByPhone:function(a,c){for(var d=this._imdb.getAllElements(),e=new b.Services.Contacts.MatchedContactsWithMatchLevel,f=!1,g=function(a,c,d){c=b.Services.Contacts.ContactsUtils.comparePhoneStrings(a,c),c===b.Services.Contacts.ContactMatchTypes.EXACT_TYPE1?(e._exactType1Contacts.push(d),f=!0):c===b.Services.Contacts.ContactMatchTypes.EXACT_TYPE2?e._exactType2Contacts.push(d):c===b.Services.Contacts.ContactMatchTypes.PARTIAL_TYPE1&&e._partialType1Contacts.push(d)}.bind(this),h=0;h<d.length&&!f;h++){for(var i=d[h],j=i.getPhoneNumbers().getValues(),k=0;k<j.length&&!f;k++)g(a,j[k].getPhoneNumber(),i);for(var l=i.getEmailAddresses().getValues(),k=0;k<l.length&&!f;k++)g(a,l[k].getAddress(),i);var m=i.getEmailAddresses().getValues();for(k=0;k<m.length&&!f;k++)g(a,m[k].getAddress(),i);g(a,i.getFirstName().getValue(),i),g(a,i.getLastName().getValue(),i),g(a,i.getDisplayName().getValue(),i),g(a,i.getASCIIFirstName().getValue(),i),g(a,i.getASCIILastName().getValue(),i),g(a,i.getASCIIDisplayName().getValue(),i),g(a,i.getAlias().getValue(),i),g(a,i.getManager().getValue(),i),g(a,i.getCompany().getValue(),i),g(a,i.getDepartment().getValue(),i),g(a,i.getNotes().getValue(),i),g(a,i.getLocation().getValue(),i),g(a,i.getStreetAddress().getValue(),i),g(a,i.getCity().getValue(),i),g(a,i.getState().getValue(),i),g(a,i.getCountry().getValue(),i),g(a,i.getPostalCode().getValue(),i),g(a,i.getWorkRoomNumber().getValue(),i);var n=i.getCustom1().getValues();for(k=0;k<n.length&&!f;k++)g(a,n[h].getValue(),i);var o=i.getCustom2().getValues();for(k=0;k<o.length&&!f;k++)g(a,o[h].getValue(),i);var p=i.getCustom3().getValues();for(k=0;k<p.length&&!f;k++)g(a,p[h].getValue(),i)}return e._allContacts=e._exactType1Contacts.concat(e._exactType2Contacts).concat(e._partialType1Contacts),e._allContacts=b.Base.Utils.removeDuplicatesFromArray(e._allContacts),c?(0<e._allContacts.length&&(e._empty=!1),e):e._allContacts},resolveContactsByPhone:function(a,c){return a=this._imdb.searchBySingleKey(b.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,a,b.Base.IMDBSearchOptions.EXACT_MATCH),a=b.Base.Utils.removeDuplicatesFromArray(a),c?(c=new b.Services.Contacts.MatchedContactsWithMatchLevel,0<a.length&&(c._exactType1Contacts=a,c._allContacts=a,c._empty=!1),c):a},empty:function(){this._imdb=new b.Base.SimpleIMDB(this._cacheKeys)},_buildKeys:function(c){var d=c.getUniqueAddressForMatching();if(!this.hasUniqueAddressForMatching(d))return a;var e=[],f=c.getFirstName().getValue(),g=c.getASCIIFirstName().getValue();f!==a&&""!==f&&e.push(b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(f)),g!==a&&""!==g&&g!==f&&e.push(g);var h=[],i=c.getLastName().getValue(),f=c.getASCIILastName().getValue();i!==a&&""!==i&&h.push(b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(i)),f!==a&&""!==f&&f!==i&&h.push(f),g=[],i=c.getDisplayName().getValue(),f=c.getASCIIDisplayName().getValue(),i!==a&&""!==i&&g.push(b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(i)),f!==a&&""!==f&&f!==i&&g.push(f);for(var j=[],k=c.getPhoneNumbers().getValues(),l=0;l<k.length;l++){var m=k[l].getPhoneNumber();m!==a&&""!==m&&-1===j.indexOf(m)&&j.push(m)}for(var n=[],o=c.getEmailAddresses().getValues(),l=0;l<o.length;l++){var p=o[l].getAddress();p!==a&&""!==p&&-1===n.indexOf(p)&&n.push(p)}var q=[],r=c.getIMAddresses().getValues();for(l=0;l<r.length;l++){var s=r[l].getAddress();s!==a&&""!==s&&-1===q.indexOf(s)&&q.push(s)}return f={},f[b.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[d],d=c.getAlias().getValue(),d!==a&&""!==d&&(f[b.Services.Contacts.ContactCacheKeys.ALIAS]=[b.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(d)]),d=c.getCity().getValue(),d!==a&&""!==d&&(f[b.Services.Contacts.ContactCacheKeys.CITY]=[d]),d=c.getAlias().getValue(),d!==a&&""!==d&&(f[b.Services.Contacts.ContactCacheKeys.DEPARTMENT]=[d]),!b.Base.Utils.isDefined(c.getTerminal())||(d=c.getTerminal().getTerminalName())!==a&&""!==d&&(f[b.Services.Contacts.ContactCacheKeys.TERMINAL_NAME]=[d]),0<e.length&&(f[b.Services.Contacts.ContactCacheKeys.FIRST_NAME]=e),0<h.length&&(f[b.Services.Contacts.ContactCacheKeys.LAST_NAME]=h),0<g.length&&(f[b.Services.Contacts.ContactCacheKeys.DISPLAY_NAME]=g),0<j.length&&(f[b.Services.Contacts.ContactCacheKeys.PHONE_NUMBER]=j),0<n.length&&(f[b.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS]=n),0<q.length&&(f[b.Services.Contacts.ContactCacheKeys.HANDLE]=q),c=c.getScopiaLoginId().getValue(),c!==a&&""!==c&&(f[b.Services.Contacts.ContactCacheKeys.LOGIN_ID]=[c]),f},_buildKeysWithMatchingAddressOnly:function(c){var d=c.getUniqueAddressForMatching();return this.hasUniqueAddressForMatching(d)?(c={},c[b.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[d],c):a},hasUniqueAddressForMatching:function(a){return!(!b.Base.Utils.isDefined(a)||""===a)||(b.Base.Logger.warn(b.Base.LoggerTags.CONTACTS_SERVICE,"Failed to build keys for contact without unique address"),!1)},isContactInCache:function(a){if(!this.hasUniqueAddressForMatching(a))return!1;var c=b.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING;return 0<this._imdb.searchBySingleKey(c,a).length}},b.Services.Contacts.ContactsCache=c}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g){this._uniqueSearchId=a.Base.Utils.makeId(16),this._searchString=b,this._searchField=c,this._searchSource=d,this._maxResults=e,this._maxChunkSize=f,this._searchNetworkSource=g}b.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_generateNewUniqueSearchId:function(){this._uniqueSearchId=a.Base.Utils.makeId(16)},getSearchString:function(){return this._searchString},_setSearchString:function(a){this._searchString=a},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource},getSearchNetworkSource:function(){return this._searchNetworkSource},getMaxResults:function(){return this._maxResults},getMaxChunkSize:function(){return this._maxChunkSize}},a.Services.Contacts.ContactSearchRequest=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Base.BaseError.call(this),this._reason=b,this.name="ContactError",this.message=c}(b.prototype=Object.create(a.Base.BaseError.prototype)).getReason=function(){return this._reason},a.Services.Contacts.ContactsError=b}(AvayaClientServices),function(c){"use strict";function d(){this._contactsService=a,this._contacts=a,this._started=!1,this._onContactsChangedCallback=a,this._externalContactListChangesCallbacks=b.Callbacks()}d.prototype={start:function(a,b){!this._started&&a&&b&&(this._started=!0,this._contactsService=a,this._contacts=b,this._registerCallbacks())},stop:function(){this._started&&(this._started=!1,this._unregisterCallbacks())},isStarted:function(){return this._started},addOnContactListChangedCallback:function(a){a&&this._externalContactListChangesCallbacks.add(a)},removeOnContactListChangedCallback:function(a){a&&this._externalContactListChangesCallbacks.remove(a)},updateMatchedContactsForParticipant:function(a,b){var d,e=c.Services.Contacts.SearchFieldType.HANDLE,f=c.Services.Contacts.SearchFieldType.ALL;this._started&&a&&(d=a.getAddress())&&(e=this._contactsService.findLocalMatchingContacts(d,e),b&&e.isEmpty()&&(d=c.Services.Contacts.ContactsUtils.parseSipUri(d).userpart,c.Base.Utils.isDefined(d)&&(e=this._contactsService.findLocalMatchingContacts(d,f))),a.setMatchedContacts(e))},_registerCallbacks:function(){this._onContactsChangedCallback=function(){this._externalContactListChangesCallbacks.fire()}.bind(this),this._contactsService.getDataSet().addOnDataSetChangedCallback(this._onContactsChangedCallback)},_unregisterCallbacks:function(){this._contactsService.getDataSet().removeOnDataSetChangedCallback(this._onContactsChangedCallback)}},c.Services.Contacts.ContactsIntegrationService=d}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f,g,h){this._presenceService=f,this._contactsService=g,this._directorySearchProvider=d,this._contactsCache=e,this._searchRequest=b,this._dataSet=new c.Base.DataSet,this._dataRetrieval=new c.Base.DataRetrieval(this._dataSet),this._dataRetrieval._onCancel=this._cancel.bind(this),this._resultsCounter=0,this._maxResults=a,this._currentUniqueSearchId=a,this._searchCompletionDate=a,this._contactsAnalyticsService=h}d.prototype={start:function(){var b=this._searchRequest.getSearchSource(),d=this._searchRequest.getUniqueSearchId();this._maxResults=0<this._searchRequest.getMaxResults()?Math.min(this._searchRequest.getMaxResults(),this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal()):this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal(),this._currentUniqueSearchId=d,this._searchCompletionDate=a,this._resultsCounter=0;var e=function(b,c,e){this._isResultValid(d)&&(!0===c?this._dataRetrieval._dataRetrievalDone.fire(c,e):this._dataRetrieval._dataRetrievalDone.fire(c,a),this._searchCompletionDate=new Date)}.bind(this),f=function(a){this._isResultValid(d)&&(this._dataRetrieval._dataRetrievalFailed.fire(a),this._searchCompletionDate=new Date)}.bind(this),g=function(a,b,c,e){this._isResultValid(d)&&this._handleResults(a,b,c,e)}.bind(this);(b===c.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():b===c.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(e,f,g)},updateRequest:function(a){this._searchRequest._setSearchString(a),this._searchRequest._generateNewUniqueSearchId(),this._dataSet.onDataSetChanged(this._dataSet.splice(0,this._dataSet.length),c.Base.DataSetChangeTypes.REMOVED),this._searchFinished=!1,this.start()},getDataRetrieval:function(){return this._dataRetrieval},getSearchCompletionDate:function(){return this._searchCompletionDate},_isResultValid:function(a){return!this._searchCompletionDate&&this._currentUniqueSearchId===a},_handleResults:function(b,d,e,f){for(var g=!1,h=function(a){try{return this._findInArray(this._dataSet,function(b){return b.getUniqueAddressForMatching()===a.getUniqueAddressForMatching()})}catch(b){return null}}.bind(this),i=0;i<b.length&&!this._searchFinished;i++){g=!0,b[i]._setPresenceService(this._presenceService),b[i]._setContactsService(this._contactsService);var j=!1;(j=f?h(b[i]):j)?this._mergeContacts(j,b[i]):this._dataSet.push(b[i]),this._searchFinished=this._maxResults!==a&&0!==this._maxResults&&++this._resultsCounter>=this._maxResults}void 0===d&&(d=!1),g&&(this._dataSet.onDataSetChanged(b.slice(0,i),c.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,d,e))},_mergeContacts:function(a,b){this._updateContactField(a.getFirstName(),b.getFirstName()),this._updateContactField(a.getLastName(),b.getLastName()),this._updateContactField(a.getDisplayName(),b.getDisplayName()),this._updateContactField(a.getASCIIFirstName(),b.getASCIIFirstName()),this._updateContactField(a.getASCIILastName(),b.getASCIILastName()),this._updateContactField(a.getASCIIDisplayName(),b.getASCIIDisplayName()),this._updateContactField(a.getAlias(),b.getAlias()),this._updateContactField(a.getLocation(),b.getLocation()),this._updateContactField(a.getWorkRoomNumber(),b.getWorkRoomNumber()),this._updateContactField(a.getStreetAddress(),b.getStreetAddress()),this._updateContactField(a.getCity(),b.getCity()),this._updateContactField(a.getState(),b.getState()),this._updateContactField(a.getCountry(),b.getCountry()),this._updateContactField(a.getPostalCode(),b.getPostalCode()),this._updateContactField(a.getCompany(),b.getCompany()),this._updateContactField(a.getManager(),b.getManager()),this._updateContactField(a.getDepartment(),b.getDepartment()),this._updateContactField(a.getLanguage(),b.getLanguage()),this._updateContactField(a.getNotes(),b.getNotes()),this._updateContactField(a.getScopiaUserId(),b.getScopiaUserId()),this._updateContactField(a.getScopiaLoginId(),b.getScopiaLoginId()),this._updateContactField(a.getRank(),b.getRank()),this._updateContactField(a.isBuddy(),b.isBuddy()),this._updateContactField(a.isFavorite(),b.isFavorite()),this._updateContactField(a.isVideoCapable(),b.isVideoCapable());var c=function(a,b){return this._findInArray(b,function(b){return b.getPhoneNumber()===a.getPhoneNumber()})}.bind(this);this._mergeContactArrayField(a.getPhoneNumbers().getValues(),b.getPhoneNumbers().getValues(),c),c=function(a,b){return this._findInArray(b,function(b){return b.getAddress()===a.getAddress()})}.bind(this),this._mergeContactArrayField(a.getEmailAddresses().getValues(),b.getEmailAddresses().getValues(),c),this._mergeContactArrayField(a.getIMAddresses().getValues(),b.getIMAddresses().getValues(),c),c=function(a,b){return this._findInArray(b,function(b){return b.getValue()===a.getValue()})}.bind(this),this._mergeContactArrayField(a.getCustom1().getValues(),b.getCustom1().getValues(),c),this._mergeContactArrayField(a.getCustom2().getValues(),b.getCustom2().getValues(),c),this._mergeContactArrayField(a.getCustom3().getValues(),b.getCustom3().getValues(),c)},_updateContactField:function(a,b){c.Base.Utils.isDefined(b._value)&&a._value!==b._value&&(a._value=b._value)},_mergeContactArrayField:function(a,b,c){for(var d=0;d<b.length;d++)c(b[d],a)||a.push(b[d])},_findInArray:function(a,b){if(!a||"function"!=typeof b)return null;for(var c=0;c<a.length;){var d=a[c];if(b(d))return d;c++}return null},_cancel:function(){this._searchCompletionDate=new Date,this._dataRetrieval._dataRetrievalFailed.fire(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_CANCELED)),this._searchRequest.getSearchSource()!==c.Services.Contacts.SearchSourceType.LOCAL&&this._directorySearchProvider.stopDirectorySearch(this._searchRequest.getUniqueSearchId())},_limitExceeded:function(b){return this._maxResults!==a&&0!==this._maxResults&&b>this._maxResults},_resolveSearch:function(a,b,c){this._limitExceeded(b)?a.resolve(b,!1):a.resolve(b,c,b)},_searchNetworkContacts:function(){var a=this._contactsAnalyticsService.startTimingMetric(),b=this._directorySearchProvider.startDirectorySearch(this._searchRequest);return b.then(function(b,c,d){this._contactsAnalyticsService.sendNumDirectorySearches(this._searchRequest.getSearchField()),this._contactsAnalyticsService.directorySearchTimeEnd(a)}.bind(this)),b},_searchLocalContacts:function(){var a=b.Deferred(),c=this._contactsAnalyticsService.startTimingMetric(),d=this._contactsCache.searchContacts(this._searchRequest.getSearchString(),this._searchRequest.getSearchField(),!1);return this._contactsAnalyticsService.cachedContactsSearchTimeEnd(c),this._contactsAnalyticsService.sendNumCachedContactSearches(this._searchRequest.getSearchField()),setTimeout(function(){d?a.notify(d,!0,0):d=[],this._resolveSearch(a,d.length,!0)}.bind(this),0),a.promise()},_searchAllContacts:function(){function a(a,b,c){b?d=f.length+a.length:a.forEach(function(a){f.push(a.getUniqueAddressForMatching())});var g=!(!c&&0!==c);e.notify(a,g,c,b)}var d,e=b.Deferred(),f=[],g=function(b,c,f,g,h){return this._searchLocalContacts().then(function(){g?e.reject(h):this._resolveSearch(e,d,c)}.bind(this),function(a){e.reject(a)},function(b){a(b,!0,f)})}.bind(this);return this._searchNetworkContacts().then(g,function(a){c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts search failed",a),g(0,!1,0,!0,a)},a),e.promise()}},c.Services.Contacts.ContactsSearch=d}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f,g){this._started=!1,this._starting=!1,this._contactsModule=a,this._contactsIntegrationService=e,this._presenceService=f,this._contactsProvider=b,this._directorySearchProvider=d,this._contactsCache=new c.Services.Contacts.ContactsCache,this._contactsDataSet=new c.Base.DataSet,this._contactsRetrieval=new c.Base.DataRetrieval(this._contactsDataSet),this._retrievalFinished=!1,this._selfContact=a,this._activeSearches={},this._activeResolveContactsRequests={},this._searchAuditIntervalId=a,this._deniedCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._addContactCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._updateContactCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._deleteContactCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchContactCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchTerminalCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._resolveContactsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._conferenceSearchCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._contactsAnalyticsService=g,this._selfContactBackoffPromise=a,this._selfContactBackoffTimeout=a}d.prototype={start:function(a,d){c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Starting the service");var e,f=this._contactsAnalyticsService.startTimingMetric();a.addOnContactsServiceUnavailableCallback(function(){e=this._contactsAnalyticsService.startTimingMetric()}.bind(this)),a.addOnContactsServiceAvailableCallback(function(){this._contactsAnalyticsService.durationContactProviderOutagesEnd(e)}.bind(this)),this._contactsModule=a,this._starting=!0,this._selfContactBackoffPromise=b.Deferred();var g=function(){return this._contactsProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){a._fireContactsUnavailableCallback(a)}.bind(this)),this._directorySearchProvider.start(d,a)}.bind(this),h=function(){return this._directorySearchProvider.getSelfContact().then(function(b){b._setContactsService(this),b._setPresenceService(this._presenceService),b._setSelfContact(!0),this._selfContact=b,this._starting=!1,this._started=!0,a._fireContactsAvailableCallback(a),c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Service started successfully")}.bind(this),function(a){return c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Self contact cannot be found",a),b.Deferred().reject(a).promise()}.bind(this))}.bind(this),i=function(a){var b=this._selfContactBackoffPromise;return this._selfContactBackoffTimeout=setTimeout(function(){a().then(function(){b.resolve()},function(d){d&&d.getReason&&d.getReason()===c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT?i(a):b.reject(d)})}.bind(this),3e4),b}.bind(this),j=function(){return g().then(function(){this._registerContactChangesCallbacks(),this._recalculateCapabilities(),this._contactsIntegrationService.start(this,a)}.bind(this)).then(h).fail(function(b){a._fireContactsUnavailableCallback(a),this._starting=!1,this._started=!1,c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",b),b&&b.getReason&&b.getReason()===c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT&&(c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Starting backoff algorithm for populateSelfContact."),i(h))}.bind(this)).then(function(){this._contactsAnalyticsService.contactsLoadTimeEnd(f)}.bind(this))}.bind(this);return function(){return this._contactsProvider.on(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.isStarted()||this.isStarting()||j()}.bind(this)),this._contactsProvider.on(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout)}.bind(this)),this._contactsProvider.start(d,a)}.bind(this)().then(j,function(a){this._starting=!1,c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",a)}.bind(this))},stop:function(d){c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var e=b.Deferred();this._started||e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),d._fireContactsUnavailableCallback(d),this._started=!1,this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_CANCELED)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout);var f=function(a){this._started=!0,c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Failed to stop service",a),e.reject(a)}.bind(this),g=function(){return this._contactsProvider.stop().fail(f)}.bind(this),d=function(){return this._cleanupResources(),this._directorySearchProvider.stop().fail(f)}.bind(this);return g().then(d).then(function(){this._contactsIntegrationService.stop(),this._selfContact=a,c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),e.resolve()}.bind(this),f.bind(this)),e.promise()},stopImmediately:function(a){c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var d=b.Deferred();return this._started||d.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),a._fireContactsUnavailableCallback(a),this._started=!1,c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),d.resolve(),d.promise()},isStarted:function(){return this._started},isStarting:function(){return this._starting},createEditableContact:function(){var a=this._contactsProvider.createContactForAdd();return a._setContactsService(this),a},createEditableContactFromContact:function(a){if(a.getTerminal()&&""!==a.getTerminal().getTerminalId())throw new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.EDIT_TERMINAL_NOT_SUPPORTED);var b=new c.Services.Contacts.EditableContact,d=this._contactsProvider.createContactForAdd();b._setContactsService(this),b._setInContactList(a._isInContactList()),b._isInContactList()&&b._setUniqueAddressForMatching(a._getUniqueAddressWithoutChanges()),b.getFirstName().setValue(a.getFirstName().getValue()),b.getLastName().setValue(a.getLastName().getValue()),b.getDisplayName().setValue(a.getDisplayName().getValue()),b.getASCIIFirstName().setValue(a.getASCIIFirstName().getValue()),b.getASCIILastName().setValue(a.getASCIILastName().getValue()),b.getASCIIDisplayName().setValue(a.getASCIIDisplayName().getValue()),b.getAlias().setValue(a.getAlias().getValue()),b.getLocation().setValue(a.getLocation().getValue()),b.getWorkRoomNumber().setValue(a.getWorkRoomNumber().getValue()),b.getStreetAddress().setValue(a.getStreetAddress().getValue()),b.getCity().setValue(a.getCity().getValue()),b.getState().setValue(a.getState().getValue()),b.getCountry().setValue(a.getCountry().getValue()),b.getPostalCode().setValue(a.getPostalCode().getValue()),b.getCompany().setValue(a.getCompany().getValue()),b.getManager().setValue(a.getManager().getValue()),b.getDepartment().setValue(a.getDepartment().getValue()),b.getLanguage().setValue(a.getLanguage().getValue()),b.getNotes().setValue(a.getNotes().getValue()),b.getScopiaUserId().setValue(a.getScopiaUserId().getValue()),b.getScopiaLoginId().setValue(a.getScopiaLoginId().getValue()),b.getRank().setValue(a.getRank().getValue()),b.isBuddy().setValue(a.isBuddy().getValue()),b.isFavorite().setValue(a.isFavorite().getValue()),b.isVideoCapable().setValue(a.isVideoCapable().getValue()),b.getFirstName()._setWriteCapability(a.getFirstName().getWriteCapability()),
b.getLastName()._setWriteCapability(a.getLastName().getWriteCapability()),b.getDisplayName()._setWriteCapability(a.getDisplayName().getWriteCapability()),b.getASCIIFirstName()._setWriteCapability(a.getASCIIFirstName().getWriteCapability()),b.getASCIILastName()._setWriteCapability(a.getASCIILastName().getWriteCapability()),b.getASCIIDisplayName()._setWriteCapability(a.getASCIIDisplayName().getWriteCapability()),b.getAlias()._setWriteCapability(a.getAlias().getWriteCapability()),b.getLocation()._setWriteCapability(a.getLocation().getWriteCapability()),b.getWorkRoomNumber()._setWriteCapability(a.getWorkRoomNumber().getWriteCapability()),b.getStreetAddress()._setWriteCapability(a.getStreetAddress().getWriteCapability()),b.getCity()._setWriteCapability(a.getCity().getWriteCapability()),b.getState()._setWriteCapability(a.getState().getWriteCapability()),b.getCountry()._setWriteCapability(a.getCountry().getWriteCapability()),b.getPostalCode()._setWriteCapability(a.getPostalCode().getWriteCapability()),b.getCompany()._setWriteCapability(a.getCompany().getWriteCapability()),b.getManager()._setWriteCapability(a.getManager().getWriteCapability()),b.getDepartment()._setWriteCapability(a.getDepartment().getWriteCapability()),b.getLanguage()._setWriteCapability(a.getLanguage().getWriteCapability()),b.getNotes()._setWriteCapability(a.getNotes().getWriteCapability()),b.getScopiaUserId()._setWriteCapability(a.getScopiaUserId().getWriteCapability()),b.getScopiaLoginId()._setWriteCapability(a.getScopiaLoginId().getWriteCapability()),b.getRank()._setWriteCapability(a.getRank().getWriteCapability()),b.isBuddy()._setWriteCapability(a.isBuddy().getWriteCapability()),b.isFavorite()._setWriteCapability(a.isFavorite().getWriteCapability()),b.isVideoCapable()._setWriteCapability(a.isVideoCapable().getWriteCapability());for(var e=a.getPhoneNumbers().getValues(),f=b.getPhoneNumbers().getValues(),g=0;g<e.length;g++){var h=new c.Services.Contacts.EditableContactPhoneField;h.setPhoneNumber(e[g].getPhoneNumber()),h.setPhoneNumberType(e[g].getPhoneNumberType()),h.setSpeedDialEnabled(e[g].isSpeedDialEnabled()),h.setLabel1(e[g].getLabel1()),h.setLabel2(e[g].getLabel2()),h.setDefault(e[g].isDefault()),h._setWriteCapability(e[g].getWriteCapability()),f.push(h)}for(var i=a.getEmailAddresses().getValues(),j=b.getEmailAddresses().getValues(),g=0;g<i.length;g++){var k=new c.Services.Contacts.EditableContactEmailAddressField;k.setAddress(i[g].getAddress()),k.setEmailAddressType(i[g].getEmailAddressType()),k._setWriteCapability(i[g].getWriteCapability()),j.push(k)}var l=a.getIMAddresses().getValues(),m=b.getIMAddresses().getValues();for(g=0;g<l.length;g++){var n=new c.Services.Contacts.EditableContactIMAddressField;n.setAddress(l[g].getAddress()),n.setIMAddressType(l[g].getIMAddressType()),n._setWriteCapability(l[g].getWriteCapability()),m.push(n)}var o=a.getCustom1().getValues(),p=b.getCustom1().getValues();for(g=0;g<o.length;g++){var q=new c.Services.Contacts.EditableContactStringField;q.setValue(o[g].getValue()),q._setWriteCapability(o[g].getWriteCapability()),p.push(q)}var r=a.getCustom2().getValues(),s=b.getCustom2().getValues();for(g=0;g<r.length;g++){var t=new c.Services.Contacts.EditableContactStringField;t.setValue(r[g].getValue()),t._setWriteCapability(r[g].getWriteCapability()),s.push(t)}var u=a.getCustom3().getValues(),v=b.getCustom3().getValues();for(g=0;g<u.length;g++){var w=new c.Services.Contacts.EditableContactStringField;w.setValue(u[g].getValue()),w._setWriteCapability(u[g].getWriteCapability()),v.push(w)}return a.getPhoneNumbers()._setWriteCapability(d.getPhoneNumbers().getWriteCapability()),a.getEmailAddresses()._setWriteCapability(d.getEmailAddresses().getWriteCapability()),a.getIMAddresses()._setWriteCapability(d.getIMAddresses().getWriteCapability()),a.getCustom1()._setWriteCapability(d.getCustom1().getWriteCapability()),a.getCustom2()._setWriteCapability(d.getCustom2().getWriteCapability()),a.getCustom3()._setWriteCapability(d.getCustom3().getWriteCapability()),b},addContact:function(a){return this._contactsProvider.addContact(a)},updateContact:function(a){return this._contactsProvider.updateContact(a)},deleteContact:function(a){return this._contactsProvider.deleteContact(a)},getContacts:function(){var a,b,c;return this._retrievalFinished?setTimeout(function(){this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this)):(a=function(){this._retrievalFinished=!0,this._contactsAnalyticsService.sendNumContactsLoaded(this._contactsDataSet.length),this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this),b=function(a){this._contactsRetrieval._dataRetrievalFailed.fire(a)}.bind(this),c=function(a){this._contactsRetrieval._dataRetrievalProgress.fire(this._contactsDataSet.length,!0,a.length)}.bind(this),this._contactsProvider.retrieveAllContacts().then(a,b,c)),this._contactsRetrieval},searchContacts:function(a){var b=a.getUniqueSearchId();return this._activeSearches[b]?(c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"Contact search with provided requestId is already in progress - returning associated DataRetrieval"),this._activeSearches[b].getDataRetrieval()):(a=new c.Services.Contacts.ContactsSearch(a,this._directorySearchProvider,this._contactsCache,this._presenceService,this,this._contactsAnalyticsService),(this._activeSearches[b]=a).start(),a.getDataRetrieval())},resolveContacts:function(a){var b=a.getUniqueSearchId();return this._activeResolveContactsRequests[b]?(c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution with provided requestId is already in progress - returning associated DataRetrieval"),this._activeResolveContactsRequests[b].getDataRetrieval()):(a=new c.Services.Contacts.ResolveContacts(a,this._directorySearchProvider,this._contactsCache,this._contactsAnalyticsService),(this._activeResolveContactsRequests[b]=a).start(),a.getDataRetrieval())},changeSearchContactsRequest:function(a,b){var d,e;for(e in this._activeSearches)if(this._activeSearches.hasOwnProperty(e)&&this._activeSearches[e].getDataRetrieval()===a){d=this._activeSearches[e];break}if(!d)throw new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.SEARCH_REQUEST_NOT_FOUND);d.updateRequest(b)},_startSearchRequestsAudit:function(){this._searchAuditIntervalId=setInterval(function(){var a,b,c=new Date;for(a in this._activeSearches)!this._activeSearches.hasOwnProperty(a)||(b=this._activeSearches[a].getSearchCompletionDate())&&12e4<c-b&&delete this._activeSearches[a]}.bind(this),12e4)},_stopSearchRequestsAudit:function(){clearInterval(this._searchAuditIntervalId),this._searchAuditIntervalId=a},findLocalMatchingContacts:function(a,b){return this._contactsCache.searchContacts(a,b,!0)},getAddContactCapability:function(){return this._addContactCapability},getUpdateContactCapability:function(a){return a&&a._isInContactList()?this._updateContactCapability:this._deniedCapability},getDeleteContactCapability:function(a){return a&&a._isInContactList()?this._deleteContactCapability:this._deniedCapability},getNetworkSearchContactCapability:function(){return this._searchContactCapability},getNetworkResolveContactsCapability:function(){return this._resolveContactsCapability},getNetworkSearchTerminalCapability:function(){return this._searchTerminalCapability},getExtendedContactDetailsCapability:function(){return this._extendedDetailsCapability},getConferenceSearchCapability:function(){return this._conferenceSearchCapability},_recalculateCapabilities:function(){var a=!1,b=this._contactsProvider.getAddContactCapability();this._addContactCapability!==b&&(this._addContactCapability=b,a=!0),b=this._contactsProvider.getUpdateContactCapability(),this._updateContactCapability!==b&&(this._updateContactCapability=b,a=!0),b=this._contactsProvider.getDeleteContactCapability(),this._deleteContactCapability!==b&&(this._deleteContactCapability=b,a=!0),b=this._directorySearchProvider.getNetworkSearchContactCapability(),this._searchContactCapability!==b&&(this._searchContactCapability=b,a=!0),b=this._directorySearchProvider.getNetworkResolveContactsCapability(),this._resolveContactsCapability!==b&&(this._resolveContactsCapability=b,a=!0),b=this._directorySearchProvider.getNetworkSearchTerminalCapability(),this._searchTerminalCapability!==b&&(this._searchTerminalCapability=b,a=!0),b=this._directorySearchProvider.getConferenceSearchCapability(),this._conferenceSearchCapability!==b&&(this._conferenceSearchCapability=b,a=!0),b=this._contactsProvider.getExtendedContactDetailsCapability(),this._extendedDetailsCapability!==b&&(this._extendedDetailsCapability=b,a=!0),a&&this._contactsModule._onCapabilitiesChangedCallbacks.fire(this)},_registerContactChangesCallbacks:function(){var a=c.Providers.Interfaces.ContactsProviderCallbackIds;this._contactsProvider.on(a.CONTACT_ADDED,function(a){for(var b=0;b<a.length;b++)a[b]._setInContactList(!0),a[b]._setPresenceService(this._presenceService),a[b]._setContactsService(this),this._contactsDataSet.push(a[b]),this._contactsCache.addContact(a[b]);this._contactsDataSet.onDataSetChanged(a,c.Base.DataSetChangeTypes.ADDED)}.bind(this));var b=function(a){for(var b=0;b<this._contactsDataSet.length;b++)if(a.getUniqueAddressForMatching()===this._contactsDataSet[b].getUniqueAddressForMatching())return b}.bind(this);this._contactsProvider.on(a.CONTACT_UPDATED,function(a){var d=b(a);c.Base.Utils.isDefined(d)?(this._contactsDataSet[d]=a,this._contactsDataSet.onDataSetChanged([a],c.Base.DataSetChangeTypes.UPDATED)):(c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"Updated contact was not found in DataSet",a),this._contactsDataSet.push(a),this._contactsDataSet.onDataSetChanged([a],c.Base.DataSetChangeTypes.ADDED)),a._setInContactList(!0),a._setPresenceService(this._presenceService),a._setContactsService(this),this._contactsCache.updateContact(a)}.bind(this)),this._contactsProvider.on(a.CONTACT_DELETED,function(a){for(var d=0;d<a.length;d++){var e=b(a[d]);this._contactsDataSet.splice(e,1),a[d]._setInContactList(!1),a[d]._setPresenceService(this._presenceService),a[d]._setContactsService(this),this._contactsCache.deleteContact(a[d])}this._contactsDataSet.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED)}.bind(this)),this._contactsProvider.on(a.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this)),this._directorySearchProvider.on(a.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this))},getContactsModule:function(){return this._contactsModule},isContactInCache:function(a){return this._contactsCache.isContactInCache(a.getUniqueAddressForMatching())},getSelfContact:function(){return this._selfContact},getDataSet:function(){return this._contactsDataSet},_cleanupResources:function(){this._contactsCache.empty();var a=this._contactsDataSet.splice(0,this._contactsDataSet.length);0<a.length&&this._contactsDataSet.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED),this._contactsDataSet.dataSetChangeCallbacks.empty(),this._contactsDataSet.dataSetInvalidatedCallbacks.empty(),this._contactsRetrieval._dataRetrievalProgress.empty(),this._contactsRetrieval._dataRetrievalDone.empty(),this._contactsRetrieval._dataRetrievalFailed.empty(),this._activeSearches={},this._activeResolveContactsRequests={}}},c.Services.Contacts.ContactsService=d}(AvayaClientServices),function(a){"use strict";var b="\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*",c="(\\*|#|\\d)\\d{0,3}",d=new RegExp("^"+b+"$","i"),e=new RegExp("^"+c+"$","i"),f=new RegExp("^((\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*)|((\\*|#|\\d)\\d{0,3}))[#\\*,;]{1}[#\\*,;0-9]*$","i"),g=new RegExp("^(([^:/?#]+):)?(([^/?@#]*)@)?([^/?;#\\s]*)?","i"),h=new RegExp("^\\++[1-9]\\d{1,14}$","i"),i=new RegExp("^.+\\@.+$","i"),j=new RegExp("^\\+?[0-9a-z]+[0-9a-z\\(\\)\\.\\-]*$","i"),k={getPhoneStringType:function(b){return b&&""!==b.trim()?k.isPhoneNumber(b)?a.Services.Contacts.PhoneStringTypes.PHONE_NUMBER:k.isDialString(b)?a.Services.Contacts.PhoneStringTypes.DIALSTRING:k.isFeatureAccessCode(b)?a.Services.Contacts.PhoneStringTypes.FEATURE_ACCESS_CODE:k.isSipUri(b)?a.Services.Contacts.PhoneStringTypes.SIP_URI:a.Services.Contacts.PhoneStringTypes.UNKNOWN:a.Services.Contacts.PhoneStringTypes.UNKNOWN},isSipUri:function(a){return!!a&&!!k.parseSipUri(a).userpart},isPhoneNumber:function(a){return d.test(a)},isFeatureAccessCode:function(a){return e.test(a)},isDialString:function(a){return f.test(a)},isPhoneWithDomain:function(a){return i.test(a)},isE164Userpart:function(a){return h.test(k.parseSipUri(a).userpart)},isAlphanumericUserpart:function(a){return j.test(k.parseSipUri(a).userpart)},isNumericUserpart:function(a){return k.isPhoneNumber(k.parseSipUri(a).userpart)},normalizePhoneString:function(a){return a=a.replace(/^(\+)+|([\s\-\(\)\.])+/g,""),k.mapAlphabeticalToITU(a)},normalizeHandle:function(a){return a.replace(/^([a-z]+[a-z0-9+.-]*\:)/g,"")},normalizeAndSimplifyNameString:function(a){return a.toLowerCase().replace(/\u1E9E/g,"sz").replace(/\u00DF/g,"sz").replace(/\u00F8/g,"o").normalize("NFD").replace(/[\u0080-\u036F]/g,"").replace("ss","sz").replace("ue","u").replace("ae","a").replace("oe","o")},mapAlphabeticalToITU:function(a){return a.replace(/[ABC]{1}/i,"2").replace(/[DEF]{1}/i,"3").replace(/[GHI]{1}/i,"4").replace(/[JKL]{1}/i,"5").replace(/[MNO]{1}/i,"6").replace(/[PQRS]{1}/i,"7").replace(/[TUV]{1}/i,"8").replace(/[WXYZ]{1}/i,"9")},parseSipUri:function(a){return a=a.match(g),{scheme:a[2],userpart:a[4],host:a[5]}},comparePhoneStrings:function(b,c){var d,e,f=a.Services.Contacts.PhoneStringTypes,g=a.Services.Contacts.ContactMatchTypes,h=k.getPhoneStringType(b),i=k.getPhoneStringType(c);return h===f.UNKNOWN||i===f.UNKNOWN?g.NO_MATCH:(b=h===f.SIP_URI?(d=k.parseSipUri(b),k.normalizePhoneString(d.userpart)):k.normalizePhoneString(b),c=i===f.SIP_URI?(e=k.parseSipUri(c),k.normalizePhoneString(e.userpart)):k.normalizePhoneString(c),h!==f.SIP_URI||i!==f.SIP_URI||d.scheme===e.scheme&&d.host===e.host?b===c?h===f.SIP_URI&&i!==f.SIP_URI||h!==f.SIP_URI&&i===f.SIP_URI?g.EXACT_TYPE2:g.EXACT_TYPE1:k._trimPhoneString(b)===k._trimPhoneString(c)?g.PARTIAL_TYPE1:g.NO_MATCH:g.NO_MATCH)},_trimPhoneString:function(a){return a.substr(a.length-10)},getPhoneAndVideoChannelPresenceAddress:function(b){var c=b.getPhoneNumbers().getValues().filter(function(b){return b.isAvayaAdministered()&&b.getPhoneNumberType()===a.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}),d=c.filter(function(a){return k.isPhoneWithDomain(a.getPhoneNumber())}),b=d.filter(function(a){return k.isE164Userpart(a.getPhoneNumber())});return b[0]?(a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Using first E.164 phone number as Phone/Video channel presence address"),b[0]):(b=d.filter(function(a){return k.isNumericUserpart(a.getPhoneNumber())}),b[0]?(a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Using first numeric phone number as Phone/Video channel presence address"),b[0]):(b=d.filter(function(a){return k.isAlphanumericUserpart(a.getPhoneNumber())}),b[0]?(a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Using first alphanumeric phone number as Phone/Video channel presence address"),b[0]):d[0]?(a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Using first phone number with domain as Phone/Video channel presence address"),d[0]):c[0]?(a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Using first Avaya administered phone number as Phone/Video channel presence address"),c[0]):void a.Base.Logger.warn(a.Base.LoggerTags.CONTACTS_SERVICE,"No suitable Phone/Video channel presence address found in self contact. Channel presence publications might not work as expected.")))}};a.Services.Contacts.ContactsUtils=k}(AvayaClientServices),function(b){"use strict";function c(){this._uniqueAddressForMatching=a,this._firstName=new b.Services.Contacts.EditableContactStringField,this._lastName=new b.Services.Contacts.EditableContactStringField,this._displayName=new b.Services.Contacts.EditableContactStringField,this._asciiFirstName=new b.Services.Contacts.EditableContactStringField,this._asciiLastName=new b.Services.Contacts.EditableContactStringField,this._asciiDisplayName=new b.Services.Contacts.EditableContactStringField,this._alias=new b.Services.Contacts.EditableContactStringField,this._company=new b.Services.Contacts.EditableContactStringField,this._location=new b.Services.Contacts.EditableContactStringField,this._workRoomNumber=new b.Services.Contacts.EditableContactStringField,this._streetAddress=new b.Services.Contacts.EditableContactStringField,this._city=new b.Services.Contacts.EditableContactStringField,this._state=new b.Services.Contacts.EditableContactStringField,this._country=new b.Services.Contacts.EditableContactStringField,this._postalCode=new b.Services.Contacts.EditableContactStringField,this._manager=new b.Services.Contacts.EditableContactStringField,this._department=new b.Services.Contacts.EditableContactStringField,this._language=new b.Services.Contacts.EditableContactStringField,this._emailAddresses=new b.Services.Contacts.ContactFieldList,this._phoneNumbers=new b.Services.Contacts.ContactFieldList,this._imAddresses=new b.Services.Contacts.ContactFieldList,this._buddy=new b.Services.Contacts.EditableContactBooleanField,this._favorite=new b.Services.Contacts.EditableContactBooleanField,this._videoCapable=new b.Services.Contacts.EditableContactBooleanField,this._rank=new b.Services.Contacts.EditableContactNumberField,this._notes=new b.Services.Contacts.EditableContactStringField,this._custom1=new b.Services.Contacts.ContactFieldList,this._custom2=new b.Services.Contacts.ContactFieldList,this._scopiaUserId=new b.Services.Contacts.EditableContactStringField,this._scopiaLoginId=new b.Services.Contacts.EditableContactStringField,this._custom3=new b.Services.Contacts.ContactFieldList,this._inContactList=!1,this._contactsService=a}c.prototype={getUniqueAddressForMatching:function(){var a,b=this._uniqueAddressForMatching;return b=-1<b.indexOf("/")?(a=b.split("/"))[a.length-1]:b},_getUniqueAddressWithoutChanges:function(){return this._uniqueAddressForMatching},_setUniqueAddressForMatching:function(a){this._uniqueAddressForMatching=a},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getDisplayName:function(){return this._displayName},getASCIIFirstName:function(){return this._asciiFirstName},getASCIILastName:function(){return this._asciiLastName},getASCIIDisplayName:function(){return this._asciiDisplayName},getAlias:function(){return this._alias},getLocation:function(){return this._location},getWorkRoomNumber:function(){return this._workRoomNumber},getStreetAddress:function(){return this._streetAddress},getCity:function(){return this._city},getState:function(){return this._state},getCountry:function(){return this._country},getPostalCode:function(){return this._postalCode},getCompany:function(){return this._company},getManager:function(){return this._manager},getDepartment:function(){return this._department},getLanguage:function(){return this._language},getEmailAddresses:function(){return this._emailAddresses},getPhoneNumbers:function(){return this._phoneNumbers},getIMAddresses:function(){return this._imAddresses},isBuddy:function(){return this._buddy},isFavorite:function(){return this._favorite},isVideoCapable:function(){return this._videoCapable},getNotes:function(){return this._notes},getRank:function(){return this._rank},getCustom1:function(){return this._custom1},getCustom2:function(){return this._custom2},getCustom3:function(){return this._custom3},getScopiaUserId:function(){return this._scopiaUserId},getScopiaLoginId:function(){return this._scopiaLoginId},_isInContactList:function(){return this._inContactList},_setInContactList:function(a){this._inContactList=a},_setContactsService:function(a){this._contactsService=a}},b.Services.Contacts.EditableContact=c}(AvayaClientServices),function(a){"use strict";var c={getUpdateContactCapability:function(){return this._contactsService.getUpdateContactCapability(this)},getDeleteContactCapability:function(){return this._contactsService.getDeleteContactCapability(this)},getContactSavableCapability:function(){var b=this.getLastName()&&this.getLastName().getValue()&&""!==this.getLastName().getValue().trim(),c=this.getFirstName()&&this.getFirstName().getValue()&&""!==this.getFirstName().getValue().trim(),d=this.getPhoneNumbers().getValues()[0]&&this.getPhoneNumbers().getValues()[0].getPhoneNumber()&&""!==this.getPhoneNumbers().getValues()[0].getPhoneNumber().trim(),e=this.getEmailAddresses().getValues()[0]&&this.getEmailAddresses().getValues()[0].getAddress()&&""!==this.getEmailAddresses().getValues()[0].getAddress().trim(),e=c&&b&&(d||e)?a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED;return new a.Base.Capability(e)}};b.extend(a.Services.Contacts.EditableContact.prototype,c)}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ContactCacheKeys={ADDRESS_FOR_MATCHING:"ADDRESS_FOR_MATCHING",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",ALIAS:"ALIAS",CITY:"CITY",DEPARTMENT:"DEPARTMENT",PHONE_NUMBER:"PHONE_NUMBER",EMAIL_ADDRESS:"EMAIL_ADDRESS",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL_NAME:"TERMINAL_NAME"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactEmailAddressType={EMAIL_ADDRESS_WORK:"EMAIL_ADDRESS_WORK",EMAIL_ADDRESS_OTHER:"EMAIL_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactIMAddressType={IM_ADDRESS_WORK:"IM_ADDRESS_WORK",IM_ADDRESS_OTHER:"IM_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactMatchTypes={EXACT_TYPE1:"EXACT_TYPE1",EXACT_TYPE2:"EXACT_TYPE2",PARTIAL_TYPE1:"PARTIAL_TYPE1",NO_MATCH:"NO_MATCH"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPhoneNumberType={PHONE_NUMBER_WORK:"PHONE_NUMBER_WORK",PHONE_NUMBER_HANDLE:"PHONE_NUMBER_HANDLE",PHONE_NUMBER_MOBILE:"PHONE_NUMBER_MOBILE",PHONE_NUMBER_HOME:"PHONE_NUMBER_HOME",PHONE_NUMBER_FAX:"PHONE_NUMBER_FAX",PHONE_NUMBER_PAGER:"PHONE_NUMBER_PAGER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPictureSize={XSMALL:"XSMALL",SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",XLARGE:"XLARGE",XXLARGE:"XXLARGE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactsErrorReason={UNKNOWN_REASON:"UNKNOWN_REASON",INTERNAL_ERROR:"INTERNAL_ERROR",RETRY:"RETRY",SERVER_UNAVAILABLE:"SERVER_UNAVAILABLE",INVALID_SERVER_RESPONSE:"INVALID_SERVER_RESPONSE",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED",AUTHENTICATION_CANCELLED:"AUTHENTICATION_CANCELLED",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",REQUEST_CANCELED:"REQUEST_CANCELED",DUPLICATE_CONTACT:"DUPLICATE_CONTACT",INVALID_CONTACT:"INVALID_CONTACT",REQUIRED_DATA_MISSING:"REQUIRED_DATA_MISSING",DELETE_CONTACT_NOT_AVAILABLE:"DELETE_CONTACT_NOT_AVAILABLE",ADD_CONTACT_NOT_AVAILABLE:"ADD_CONTACT_NOT_AVAILABLE",UPDATE_CONTACT_NOT_AVAILABLE:"UPDATE_CONTACT_NOT_AVAILABLE",SEARCH_CONTACTS_NOT_AVAILABLE:"SEARCH_CONTACTS_NOT_AVAILABLE",SEARCH_TERMINALS_NOT_AVAILABLE:"SEARCH_TERMINALS_NOT_AVAILABLE",GET_CONTACTS_NOT_AVAILABLE:"GET_CONTACTS_NOT_AVAILABLE",CONTACT_NOT_FOUND:"CONTACT_NOT_FOUND",INVALID_SEARCH_REQUEST:"INVALID_SEARCH_REQUEST",INVALID_SEARCH_STRING:"INVALID_SEARCH_STRING",INVALID_SEARCH_STRINGS:"INVALID_SEARCH_STRINGS",INVALID_SEARCH_SOURCE:"INVALID_SEARCH_SOURCE",INVALID_SEARCH_FIELD:"INVALID_SEARCH_FIELD",SEARCH_REQUEST_NOT_FOUND:"SEARCH_REQUEST_NOT_FOUND",SEARCH_STRINGS_TOO_LARGE:"SEARCH_STRINGS_TOO_LARGE",EDIT_TERMINAL_NOT_SUPPORTED:"EDIT_TERMINAL_NOT_SUPPORTED",CONTACTS_NOTIFICATIONS_CHANNEL_FAILED:"CONTACTS_NOTIFICATIONS_CHANNEL_FAILED",INCOMPATIBLE_SERVER_VERSION:"INCOMPATIBLE_SERVER_VERSION"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.PhoneStringTypes={PHONE_NUMBER:"PHONE_NUMBER",DIALSTRING:"DIALSTRING",FEATURE_ACCESS_CODE:"FEATURE_ACCESS_CODE",SIP_URI:"SIP_URI",UNKNOWN:"UNKNOWN"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactsFieldType={HANDLE:"HANDLE",PHONE_NUMBER:"PHONE_NUMBER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchFieldType={NAME:"NAME",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL:"TERMINAL",ALL:"ALL"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchNetworkSource={CONFERENCE_ONLY:"CONFERENCE_ONLY",ANYWHERE:"ANYWHERE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchSourceType={LOCAL:"LOCAL",NETWORK:"NETWORK",ALL:"ALL"}}(),function(a){"use strict";function b(){this._exactType1Contacts=[],this._exactType2Contacts=[],this._partialType1Contacts=[],this._allContacts=[],this._empty=!0}b.prototype={getExactType1Contacts:function(){return this._exactType1Contacts},getExactType2Contacts:function(){return this._exactType2Contacts},getPartialType1Contacts:function(){return this._partialType1Contacts},getAllContacts:function(){return this._allContacts},isEmpty:function(){return this._empty},_setExactType1Contacts:function(a){this._exactType1Contacts=a},_setExactType2Contacts:function(a){this._exactType2Contacts=a},_setPartialType1Contacts:function(a){this._partialType1Contacts=a},_setAllContacts:function(a){this._allContacts=a},_setEmpty:function(a){this._empty=a},_equals:function(a){return a&&this.empty===a.empty&&this._areArraysEqual(this._exactType1Contacts,a._exactType1Contacts)&&this._areArraysEqual(this._exactType2Contacts,a._exactType2Contacts)&&this._areArraysEqual(this._partialType1Contacts,a._partialType1Contacts)},_areArraysEqual:function(a,b){return a.length===b.length&&a.every(function(a,c){return a===b[c]})}},a.Services.Contacts.MatchedContactsWithMatchLevel=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactResult=function(a,b,c){this.searchString=a,this.searchScope=b,this.contacts=c}}(),function(a){"use strict";function c(b,c,d,e){this._directorySearchProvider=c,this._contactsCache=d,this._resolveContactsRequest=b,this._dataSet=new a.Base.DataSet,this._dataRetrieval=new a.Base.DataRetrieval(this._dataSet),this._uniqueSearchStrings=a.Base.Utils.removeDuplicatesFromArray(b.getSearchStrings()),this._contactsAnalyticsService=e}c.prototype={start:function(){var b=this._resolveContactsRequest.getSearchSource(),c=function(){this._dataRetrieval._dataRetrievalDone.fire()}.bind(this),d=function(a){this._dataRetrieval._dataRetrievalFailed.fire(a)}.bind(this),e=function(a){this._handleResults(a)}.bind(this);(b===a.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():b===a.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(c,d,e)},getDataRetrieval:function(){return this._dataRetrieval},_handleResults:function(b){var c=!1;b.forEach(function(a){a.contacts.length&&(c=!0,this._dataSet.push(a))}.bind(this)),c&&(this._dataSet.onDataSetChanged(b.slice(),a.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,!1))},_searchNetworkContacts:function(a){var a=a||this._uniqueSearchStrings,b=this._contactsAnalyticsService.startTimingMetric(),c=this._resolveContactsRequest.getSearchField(),a=this._directorySearchProvider.startResolvingContacts(a,c);return a.then(function(){this._contactsAnalyticsService.sendNumResolveContacts(c),this._contactsAnalyticsService.resolveContactsTimeEnd(b)}.bind(this)),a},_searchLocalContacts:function(){var c=b.Deferred(),d=this._resolveContactsRequest.getSearchField(),e=this._uniqueSearchStrings.reduce(function(b,c){var e=this._contactsCache.resolveContacts(c,d,!1);return b.push(new a.Services.Contacts.ResolveContactResult(c,d,e)),b}.bind(this),[]);return setTimeout(function(){e&&c.notify(e),c.resolve()},0),c.promise()},_searchAllContacts:function(){function c(a){a.forEach(function(a){a.contacts.length&&e.push(a.searchString)}),d.notify(a)}var d=b.Deferred(),e=[],f=function(){var b=this._uniqueSearchStrings.filter(function(a){return-1===e.indexOf(a)});return b.length?this._searchNetworkContacts(b).then(function(){d.resolve()},function(b){a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts quick search failed",b),d.reject(b)},function(a){c(a)}):void d.resolve()}.bind(this);return this._searchLocalContacts().then(f,function(b){a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Local contacts quick search failed",b),f()},c),d.promise()}},a.Services.Contacts.ResolveContacts=c}(AvayaClientServices),function(a){"use strict";function b(b,c,d){this._uniqueSearchId=a.Base.Utils.makeId(16),this._searchStrings=b,this._searchField=c,this._searchSource=d}b.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_setSearchStrings:function(a){this._searchStrings=a},_setSearchField:function(a){this._searchField=a},_setSearchSource:function(a){this._searchSource=a},getSearchStrings:function(){return this._searchStrings},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource}},a.Services.Contacts.ResolveContactsRequest=b}(AvayaClientServices),function(a){"use strict";function b(){this._terminalId="",this._terminalName=""}b.prototype={getTerminalId:function(){return this._terminalId},getTerminalName:function(){return this._terminalName}},a.Services.Contacts.Terminal=b}(AvayaClientServices),function(a){"use strict";function b(a){this._attachmentBuilder=a}b.prototype={_resizeImage:function(a,b){var c,d=document.createElement("canvas"),b=b.scale?(c=a.width*b.scale,a.height*b.scale):b.width&&!b.height?(c=b.width,parseInt(b.width*a.height/a.width)):b.height&&!b.width?(c=parseInt(b.height*a.width/a.height),b.height):(c=a.width,a.height);return d.height=b,d.width=c,d.getContext("2d").drawImage(a,0,0,c,b),d.toDataURL("image/jpeg")},create:function(){}},a.Services.Messaging.AbstractThumbnailCreator=b}(AvayaClientServices),function(b){"use strict";function c(a){this._thumbnailCreator=a}c.prototype={build:function(a,c){var d=new b.Services.Messaging.Attachment(this._thumbnailCreator);return a=a||{},d.disposition=a.disposition,d.duration=a.duration,d.mimeType=a.mimeType,d.id=a.partId,d.location=a.location||a.media,d.size=a.size,d.name=d.getName(),d.file=c,d.status=a.status||b.Services.Messaging.ResourceStatus.PUBLISHED,this._recalculateCapabilities(d),d},update:function(c,d){d.thumbnail&&(c.thumbnail.location=d.thumbnail.location),c.id=d.partId,c.location=d.location||d.media,c.duration!==d.duration&&(c.duration=d.duration,c._onDurationChangedCallbacks.fire(c,d.duration)),c.status!==b.Services.Messaging.ResourceStatus.PUBLISHED&&(c.status=b.Services.Messaging.ResourceStatus.PUBLISHED,c._onStatusChangedCallbacks.fire(c,b.Services.Messaging.ResourceStatus.PUBLISHED)),c.file&&(c.file=a)},_recalculateCapabilities:function(a){a._recalculateUpdateNameCapability(),a._recalculateUpdateMimeTypeCapability(),a._recalculateUpdateDurationCapability(),a._recalculateUpdateIsSelfGeneratedCapability(),a._recalculateCreateThumbnailCapability(),a._recalculateRemoveThumbnailCapability(),a._recalculateRemoveCapability()}},b.Services.Messaging.AttachmentBuilder=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentStatus={READY_TO_DOWNLOAD:"READY_TO_DOWNLOAD",DOWNLOADING:"DOWNLOADING",READY_TO_CONSUME:"READY_TO_CONSUME",CONSUMED:"CONSUMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentType={MAIN:"MAIN",THUMBNAIL:"THUMBNAIL"}}(),function(b){"use strict";function c(b,c){this.action=b&&b.action||"typing",this.participant=c,this.state=b&&b.state||"paused",this.timestamp=b?b.timestamp:a}c.prototype={getAction:function(){return this.action},getParticipant:function(){return this.participant},getState:function(){return this.state},getTimestamp:function(){return this.timestamp}},b.Services.Messaging.ChatStateEvent=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ConversationType={THREAD:"THREAD"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageImportance={
HIGH:"HIGH",LOW:"LOW",NORMAL:"NORMAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageType={MESSAGE:"MESSAGE",JOINED:"JOINED",LEFT:"LEFT",SESSION:"SESSION",SUBJECT_CHANGE:"SUBJECT_CHANGE",CLOSED:"CLOSED",START:"START"}}(),function(a){"use strict";function b(b,c){a.Base.BaseError.call(this,b,c),this.name="MessagingError",this.message=b}b.prototype=Object.create(a.Base.BaseError.prototype),a.Services.Messaging.MessagingError=b}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.MessagingErrorReason={MESSAGING_NOTIFICATIONS_DISABLED:"Notification channel is disabled.",MESSAGING_CLOSE_FAILED:"Server failed to be closed.",MESSAGING_SEND_ATTACHMENT_FAILED:"Failed to send attachment.",MESSAGING_FEATURE_NOT_AVAILABLE:"Feature is not available in determined server version.",MESSAGING_SERVER_ERROR:"Action failed due to server error.",MESSAGING_NOTIFICATION_FAILED:"Notification failed.",MESSAGING_PARTICIPANT_ADDRESS_INVALID:"Failed to add Participant to Conversation.",MESSAGING_LEAVE_CONVERSATION_FAILED:"Failed to leave one or more conversations.",MESSAGING_NOT_STARTED:"Failed to perform selected action. Messaging is not started.",MESSAGING_CREATE_ATTACHMENT_FAILED:"Failed to create attachment. Internal browser error.",MESSAGING_BODY_LENGTH_EXCEEDED:"Failed to send message. Maximum message body length exceeded.",MESSAGING_SUBJECT_LENGTH_EXCEEDED:"Failed to send message. Maximum message subject length exceeded.",MESSAGING_INVALID_STATE:"Invalid state.",MESSAGING_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",MESSAGING_INTERNAL_ERROR:"An internal error occurred.",MESSAGING_TIMEOUT:"An operation has timed out"}}(),function(b){"use strict";function c(){this._searchBody=!1,this._searchParticipants=!1,this._searchSubject=!1,this._resultsPerConversation=0,this._query="",this._after=a}c.prototype={isSearchParticipants:function(){return this._searchParticipants},isSearchSubject:function(){return this._searchSubject},isSearchBody:function(){return this._searchBody},getQueryAfter:function(){return this._after},getQuery:function(){return this._query},getNumberResultsPerConversation:function(){return this._resultsPerConversation},searchParticipants:function(a){this._searchParticipants=a},searchSubject:function(a){this._searchSubject=a},searchBody:function(a){this._searchBody=a},setQueryAfter:function(a){this._after=a},setQuery:function(a){this._query=a.toLowerCase()},setNumberResultsPerConversation:function(a){this._resultsPerConversation=a}},b.Services.Messaging.MessagingQuery=c}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ResourceStatus={DRAFT_UNSENT:"DRAFT_UNSENT",DRAFT_SENDING:"DRAFT_SENDING",DRAFT_REMOVING:"DRAFT_REMOVING",DRAFT_ERROR:"DRAFT_ERROR",PUBLISHED:"PUBLISHED",PUBLISHED_LEAVING:"PUBLISHED_LEAVING",PUBLISHED_LEFT:"PUBLISHED_LEFT"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SensitivityLevel={NORMAL:"NORMAL",PERSONAL:"PERSONAL",PRIVATE:"PRIVATE",CONFIDENTIAL:"CONFIDENTIAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SessionType={AUDIO:"AUDIO",VIDEO:"VIDEO"}}(),function(a){"use strict";function b(a){this._href=a&&a.href||"",this._id=a&&a.id||"",this._lastAccessedTime=a&&a.lastAccessedTime||"",this._lastUpdated=a&&a.lastUpdated||""}b.prototype={getHref:function(){return this._href},getId:function(){return this._id},getLastAccessedTime:function(){return this._lastAccessedTime},getLastUpdatedTime:function(){return this._lastUpdated}},a.Services.Messaging.ConversationId=b}(AvayaClientServices),function(c){"use strict";function d(b,c,d,e,f,g,h){this._provider=b,this._messageService=c,this._participantsService=d,this._escalationService=e,this._messageBuilder=f,this._messagingService=a,this._conversationBuilder=g,this._messagingAnalyticsService=h}d.prototype={getParticipants:function(a,b,c){return a.participants},createMessage:function(a){var b={subject:a.subject,threadId:a.id,to:a.participants,event:{type:c.Services.Messaging.MessageType.MESSAGE},resourceStatus:c.Services.Messaging.ResourceStatus.DRAFT_UNSENT,flags:{sensitivity:a.getSensitivity()}},d=this._messageBuilder.build(b,this._participantsService.getSelfParticipant(),this._messageService,a);return this._provider.on(c.Providers.AMM.ProviderStates.AVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(d)}.bind(this)),this._provider.on(c.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(d)}.bind(this)),a._getLastMessage()&&(d.coalesced=this._messageBuilder.isMessageCoalesced(d,a._getLastMessage())),d.addOnStatusChangedCallback(function(b,e){var f;e===c.Services.Messaging.ResourceStatus.PUBLISHED?(f=a._draftMessages.indexOf(b),a._draftMessages.splice(f,1),a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.id=b.threadId,a.getParticipants(),a._setStatus(c.Services.Messaging.ResourceStatus.PUBLISHED))):e===c.Services.Messaging.ResourceStatus.DRAFT_ERROR?(a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_SENDING&&a._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_ERROR),a.messages.onDataSetChanged([d],c.Base.DataSetChangeTypes.UPDATED)):e===c.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&a._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_SENDING),a._onMessagesAddedCallbacks.fire(a,[d]),a.messages.onDataSetChanged([d],c.Base.DataSetChangeTypes.UPDATED)),this._messageService._recalculateAllMessageCapabilities(d)}.bind(this)),a._draftMessages.push(d),a.messages.unshift(d),d},getMessageById:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c]},createNewClientMessage:function(a,b){return this._messageBuilder.build(a,this._participantsService.getOrCreateParticipant(a.from),this._messageService,b)},leave:function(a){var d=b.Deferred();return c.Base.Utils.isDefined(a.id)?this._provider.leaveConversation(a.id).then(function(){var b=this._messagingService.conversations.indexOf(a);0<=b&&(this._messagingService.conversations.splice(b,1),this._messagingService.conversations.onDataSetChanged([a],c.Base.DataSetChangeTypes.REMOVED)),d.resolve(!0)}.bind(this),function(a){d.reject(a)}):d.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED)),d.promise()},changeSubject:function(a,b){for(var c={threadId:a.id,body:"",event:{type:"SUBJECT_CHANGE"},subject:b,to:[]},d=a.getParticipants(),e=0;e<d.length;e++)c.to.push({address:d[e].getAddress(),type:d[e].getType()});return this._provider.changeSubject(c)},getOtherMessages:function(a,b,d,e){var f,g=new c.Base.DataRetrieval,h=g.getDataSet(),i=this._provider.getMaxMessageCount();return d&&i<d?this._getMoreOtherMessages(a,b,d,e,i,g):(f={cancel:function(){}},this._provider.getMessages(f,e.getId(),d,a,b).done(function(a){0<e.getMessages().length&&(a=this._conversationBuilder.update(e,a,this),h.push(a),h.onDataSetChanged(a,c.Base.DataSetChangeTypes.ADDED),g._dataRetrievalProgress.fire(a.length,!0,a.length),g.isCompleted=!0,g._dataRetrievalDone.fire())}.bind(this)).fail(function(a){g._dataRetrievalFailed.fire(a)}),g._onCancel=function(){f.cancel()}),g},_getMoreOtherMessages:function(b,d,e,f,g,h){var i=[],j={},k=h.getDataSet(),l=0,m=Math.floor(e/g),n=e%g;n&&(m+=1);for(var o=function(a,b,d,e){var f,o;h.isCancelled||h.isCompleted||(o={cancel:function(){}},this._provider.getMessages(o,e.id,d,a,b).done(function(o){0===l?j=o:j.messages=j.messages.concat(o.messages),a?a=o.messages[o.messages.length-1]:b=o.messages[o.messages.length-1],(l+=1)<m&&o.messages.length===g?(l===m-1&&n?i[l](a,b,n,e):i[l](a,b,d,e),f=this._conversationBuilder.updateMessages(e,j,this),k.push(f),k.onDataSetChanged(f,c.Base.DataSetChangeTypes.ADDED),h._dataRetrievalProgress.fire(o.messages.length,!1)):(f=this._conversationBuilder.updateMessages(e,j,this),k.push(f),k.onDataSetChanged(f,c.Base.DataSetChangeTypes.ADDED),h._dataRetrievalProgress.fire(o.messages.length,!1),h.isCompleted=!0,h._dataRetrievalDone.fire())}.bind(this)).fail(function(a){h._dataRetrievalFailed.fire(a)}),h._onCancel=function(){o.cancel()})}.bind(this),p=0;p<m;p++)i.push(o);i[0](b,d,a,f)},markAllAsRead:function(a){return this._provider.markAllAsRead(a.id)},markMultipleAsRead:function(a,b,c){return this._provider.markAllAsRead(a.id,b,c)},removeMessage:function(a,d,e){var f,g=b.Deferred();return e?e.getRemoveCapability().isAllowed?(0<=(f=a.indexOf(e))&&(a.splice(f,1),a.onDataSetChanged([e],c.Base.DataSetChangeTypes.REMOVED)),0<=(f=d.indexOf(e))&&d.splice(f,1),g.resolve()):g.reject(e.getRemoveCapability().denialReason):g.reject(),g.promise()},createEscalation:function(a){var b={type:c.Services.Messaging.MessageType.SESSION,extensions:{},conversation:a},d=new c.Services.Messaging.Escalation(b,this._escalationService);return this._provider.on(c.Providers.AMM.ProviderStates.AVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(d)}.bind(this)),this._provider.on(c.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(d)}.bind(this)),d.addParticipants(this.getParticipants(a)),d._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_UNSENT),d.addOnStatusChangedCallback(function(b,e){e===c.Services.Messaging.ResourceStatus.PUBLISHED?(b=a._draftEscalations.indexOf(b),a._draftEscalations.splice(b,1)):e===c.Services.Messaging.ResourceStatus.DRAFT_ERROR&&a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_SENDING?a._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_ERROR):e===c.Services.Messaging.ResourceStatus.DRAFT_SENDING&&a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&a._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._escalationService._recalculateAllEscalationCapabilities(d)}.bind(this)),d},removeEscalation:function(a,c){var d,e=b.Deferred();return a?a.getRemoveCapability().isAllowed?(0<=(d=c.indexOf(a))&&c.splice(d,1),e.resolve()):e.reject(a.getRemoveCapability().denialReason):e.reject(),e.promise()},addParticipantAddresses:function(a,d){var e=b.Deferred();c.Base.Utils.clean(d,"");var f=b.map(a.getActiveParticipants(),function(a,b){return a.getAddress()}),g=d.filter(function(a){return-1===f.indexOf(a)}),h=d.filter(function(a){return-1!==f.indexOf(a)}),i=function(b){var d=[];if(a.getStatus()===c.Services.Messaging.ResourceStatus.PUBLISHED){for(var f={participants:[]},g=0;g<b.length;g++)f.participants.push({address:b[g]._address,type:"CONTACT"}),d.push(b[g]._address);this._provider.addParticipantsToConversation(a.getId(),f).then(function(b){this._updateParticipantsList(a,b.participants),e.resolve(d)}.bind(this),function(a){e.reject(a)})}else if(a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var h=0;h<b.length;h++)d.push(b[h]._address);this._updateParticipantsList(a,b),e.resolve(d)}}.bind(this),d=function(b,d){if(d&&0<d.length){for(var f=[],g={participants:[]},i=0;i<d.length;i++)g.participants.push({address:d[i]._address,type:d[i].type}),f.push(d[i]._address);a.getStatus()===c.Services.Messaging.ResourceStatus.PUBLISHED?this._provider.addParticipantsToConversation(a.getId(),g).then(function(b){this._updateParticipantsList(a,b.participants),e.resolve(f)}.bind(this),function(a){e.reject(a)}):a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(this._updateParticipantsList(a,d),e.resolve(f))}else b._data=b.getData().concat(h),e.reject(b)}.bind(this);return this.validateUsers(g).then(i,d.bind(this)),e.promise()},validateUsers:function(a){for(var d,e,f,g=b.Deferred(),h=this._provider.getRoutableDomains(),i=[],j=[],k=0;k<a.length;k++){if(d=l=!1,e=a[k],/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e))for(var l=!0,m=0;m<h.length;m++)if(null!==a[k].match(h[m])){i.push(a[k]),d=!0;break}l&&d||(j.push(a[k]),c.Base.Logger.debug(c.Base.LoggerTags.MESSAGING_SERVICE,"Invalid address email:",a[k]))}return 0<i.length?(f=this._messagingAnalyticsService.startTimingMetric(),this._provider.validateUsers(i).then(function(a){this._messagingAnalyticsService.trackTimeRequestsValidateAddressesEnd(f);for(var b=[],d=0;d<a.validatedAddresses.length;d++)0<a.validatedAddresses[d].addresses.length?b.push(a.validatedAddresses[d].addresses[0]):j.push(a.validatedAddresses[d].query);0<j.length?g.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,j),b):g.resolve(b)}.bind(this),function(a){var b=c.Services.Messaging.MessagingErrorReason.MESSAGING_SERVER_ERROR;this._messagingAnalyticsService.trackErrorsResponseValidateAddresses(b),g.reject(new c.Services.Messaging.MessagingError(b,a))}.bind(this))):g.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,j)),g.promise()},addParticipants:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].address);return this.addParticipantAddresses(a,c)},_updateParticipantsList:function(a,b){for(var d=[],e=[],f=0;f<b.length;f++){for(var g,h=!0,i=0;i<a.participants.length;i++)if(b[f]._address===a.participants[i]._address){h=!1;break}h&&(g=this._participantsService.getOrCreateParticipant(b[f]),d.push(g),a.participants.push(g),e.push(g))}return 0<e.length&&(a.participants.onDataSetChanged(e,c.Base.DataSetChangeTypes.ADDED),a._onParticipantsAddedCallbacks.fire(a,e)),a.participants},getParticipantsFromMessage:function(a){for(var b=new c.Base.DataSet,d=0;d<a.to.length;d++){var e=this._participantsService.getOrCreateParticipant(a.to[d]);b.push(e)}if(c.Base.Utils.isDefined(a.event)&&a.event.type===c.Services.Messaging.MessageType.LEFT)for(var f=0;f<a.event.participants.length;f++){var g=this._participantsService.getOrCreateParticipant(a.event.participants[f]),g=b.indexOf(g);b.splice(g,1)}return b},removeParticipantAddresses:function(a,d){var e=b.Deferred(),f=!1,g=[];if(c.Base.Utils.clean(d,""),a.getStatus()===c.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var h=0;h<d.length;h++)for(var i=a.participants.length-1;0<=i;i--)if(a.participants[i]._address===d[h]){g.push(a.participants.splice(i,1)[0]),f=!0;break}f&&(a.participants.onDataSetChanged(g,c.Base.DataSetChangeTypes.REMOVED),a._onParticipantsRemovedCallbacks.fire(a,g)),e.resolve()}else e.reject("Could not remove participants");return e.promise()},removeParticipants:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].address);return this.removeParticipantAddresses(a,c)},close:function(a){return this._provider.close(a.id).then(function(b){return a.closed=!0,a._onClosedStatusChangedCallbacks.fire(a,a.closed),b}.bind(this))},setLastAccessTime:function(a){this._provider.setLastAccessTime(a.id,{}).then(function(){a._onLastAccessTimeChangedCallbacks.fire(a,a.lastAccessTime)})},subscribeForTypingEvents:function(a,b){var d=function(d){var e;b&&(e=new c.Services.Messaging.ChatStateEvent(d,this._participantsService._getParticipant(d.address)),b(e)),"composing"===d.state?this.addComposingParticipantToConversation(a,this._participantsService._getParticipant(d.address)):"paused"===d.state&&this.removeComposingParticipantFromConversation(a,this._participantsService._getParticipant(d.address))}.bind(this);return this._provider.subscribeForTypingEventsInConversation(a.getId(),d).then(function(b){return a._isSubscribed=!0,this._recalculateAllConversationCapabilities(a),b}.bind(this))},unsubscribeForTypingEvents:function(a){return this._provider.unsubscribeForTypingEventsInConversation(a.getId()).then(function(b){return a._isSubscribed=!1,this._recalculateAllConversationCapabilities(a),b}.bind(this))},reportTyping:function(a,b){var d=this._participantsService.getSelfParticipant();b?this._provider.reportTyping(a.threadId,b).then(function(){this.addComposingParticipantToConversation(a.conversation,d)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.MESSAGING_SERVICE,"Error on report typing: ",a)}.bind(this)):this._provider.reportTyping(a.conversation.id,b).then(function(){this.removeComposingParticipantFromConversation(a.conversation,d)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.MESSAGING_SERVICE,"Error on report paused typing: ",a)}.bind(this))},reportCustomChatNotification:function(a,d,e){var f=this._participantsService.getSelfParticipant();return e?this._provider.reportCustomChatNotification(a.getId(),d,e).then(function(b){return this.addComposingParticipantToConversation(a,f),b}.bind(this),function(a){return c.Base.Logger.error(c.Base.LoggerTags.MESSAGING_SERVICE,"Error on report custom chat notification: ",a),b.Deferred().reject(a).promise()}.bind(this)):this._provider.reportCustomChatNotification(a.getId(),d,e).then(function(b){return this.removeComposingParticipantFromConversation(a,f),b}.bind(this),function(a){return c.Base.Logger.error(c.Base.LoggerTags.MESSAGING_SERVICE,"Error on report pause custom chat notification: ",a),b.Deferred().reject(a).promise()}.bind(this))},addComposingParticipantToConversation:function(a,b){a.getComposingParticipants().indexOf(b)<0&&(a.composingParticipants.push(b),a._onIsComposingStatusChangedCallbacks.fire(a,!0))},removeComposingParticipantFromConversation:function(a,b){b=a.composingParticipants.indexOf(b),0<=b&&(a.composingParticipants.splice(b,1),a._onIsComposingStatusChangedCallbacks.fire(a,!0))},isOpened:function(){return this._provider.isOpened()},isServiceAvailable:function(){return this._provider.isAvailable()},getMaxMessageCount:function(){return this._provider.getMaxMessageCount()},_recalculateAllConversationCapabilities:function(a){a._recalculateUpdateSubjectCapability(),a._recalculateUpdateLastAccessTimeCapability(),a._recalculateUpdateSensitivityCapability(),a._recalculateOlderContentCapability(),a._recalculateAddParticipantsCapability(),a._recalculateRemoveParticipantsCapability(),a._recalculateCreateMessageCapability(),a._recalculateCreateEscalationCapability(),a._recalculateMarkAllContentAsReadCapability(),a._recalculateLeaveCapability(),a._recalculateRemoveCapability(),a._recalculateStartCapability(),a._recalculateIsTypingCapability()},isUpdateSubjectSupported:function(){return this._provider.isUpdateSubjectSupported()},isMarkAllContentAsReadSupported:function(){return this._provider.isMarkAllContentAsReadSupported()},getNumberOfMessagesWithUnreadContentSinceLastAccess:function(a){var b=a.getMessages();return(a.getLastAccessTime().getTime()?b.filter(function(b){return!b.isRead()&&b.getReceivedDate()>a.getLastAccessTime()}):b).length}},c.Services.Messaging.ConversationService=d}(AvayaClientServices),function(a){"use strict";function c(a){this._provider=a}c.prototype={start:function(b){for(var c={extensions:b.extensions,sessionType:b.sessionType||a.Services.Messaging.SessionType.AUDIO,type:b.type,participants:[]},d=0;d<b.participants.length;d++)c.participants.push({address:b.participants[d]._address});return b._setStatus(a.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._provider.callEscalationEvent(c,b.conversation.id).then(function(c){return b._setStatus(a.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllEscalationCapabilities(b),b._onStartSuccessCallbacks.fire(b),c}.bind(this),function(a){this._recalculateAllEscalationCapabilities(b),b._onStartFailedCallbacks.fire(b,a)}.bind(this))},addParticipantAddresses:function(c,d){var e=b.Deferred(),f=this._provider.getRoutableDomains();if(c.getAddParticipantsCapability().isAllowed){for(var g=[],h=0;h<d.length;h++)for(var i,j=0;j<f.length;j++)null!==d[h].match(f[j])&&(i={_address:d[h]},c.participants.push(i),g.push(i));0<g.length&&c.participants.onDataSetChanged(g,a.Base.DataSetChangeTypes.ADDED),e.resolve(c)}else e.reject(c.getAddParticipantsCapability().denialReason);return e.promise()},addParticipants:function(c,d){var e=b.Deferred();if(c.getAddParticipantsCapability().isAllowed){for(var f=!1,g=0;g<d.length;g++)c.participants.push(d[g]),f=!0;f&&c.participants.onDataSetChanged(d,a.Base.DataSetChangeTypes.ADDED),e.resolve(c)}else e.reject(c.getAddParticipantsCapability().denialReason);return e.promise()},removeParticipantAddresses:function(c,d){var e=b.Deferred();if(c.getRemoveParticipantsCapability().isAllowed){for(var f=[],g=c.participants.length-1;0<=g;g--)for(var h=d.length-1;0<=h;h--)if(c.participants[g]._address===d[h]){f.push(c.participants[g]),c.participants.splice(g,1),d.splice(h,1);break}0<f.length&&c.participants.onDataSetChanged(f,a.Base.DataSetChangeTypes.REMOVED),e.resolve(c)}else e.reject(c.getRemoveParticipantsCapability().denialReason);return e.promise()},removeParticipants:function(c,d){var e=b.Deferred(),f=[];if(c.getRemoveParticipantsCapability().isAllowed){for(var g=c.participants.length-1;0<=g;g--)for(var h=d.length-1;0<=h;h--)if(c.participants[g]._address===d[h]._address){f.push(c.participants[g]),c.participants.splice(g,1),d.splice(h,1);break}0<f.length&&c.participants.onDataSetChanged(f,a.Base.DataSetChangeTypes.REMOVED),e.resolve(c)}else e.reject(c.getRemoveParticipantsCapability().denialReason);return e.promise()},setSessionType:function(b,c){if(!a.Base.Utils.isDefined(a.Services.Messaging.SessionType[c]))throw b._onSessionTypeChangedFailedCallbacks.fire(this,c),new Error("Unknown Session type");b.sessionType=c,b._onSessionTypeChangedSuccessCallbacks.fire(this,c)},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllEscalationCapabilities:function(a){a._recalculateStartCapability(),a._recalculateAddParticipantsCapability(),a._recalculateRemoveParticipantsCapability(),a._recalculateUpdateSessionTypeCapability(),a._recalculateRemoveCapability()}},a.Services.Messaging.EscalationService=c}(AvayaClientServices),function(a){"use strict";function c(b){a.Services.Messaging.AbstractThumbnailCreator.call(this,b)}(c.prototype=Object.create(a.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(a,c){var d=b.Deferred(),e={disposition:a.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:a.status},f=new FileReader;return f.onloadend=function(){var b=new Image;b.src=f.result,b.onload=function(){var f=new Blob([this._resizeImage(b,c)],{type:"image/jpeg"});e.size=f.size,a.thumbnail=this._attachmentBuilder.build(e,f),d.resolve(a.thumbnail)}.bind(this)}.bind(this),f.onerror=function(a){d.reject(a)}.bind(this),f.readAsDataURL(a.file),d.promise()},a.Services.Messaging.ImageThumbnailCreator=c}(AvayaClientServices),function(b){"use strict";function c(a,b){this._attachmentBuilder=a,this._participantService=b}c.prototype={build:function(a,c,d,e){var f,g=new b.Services.Messaging.Message(d,e);return g.resourceStatus=a.resourceStatus||b.Services.Messaging.ResourceStatus.PUBLISHED,g.body=a.body,b.Base.Utils.isDefined(a.htmlBody)&&(g.htmlBody=a.htmlBody),a.event&&(g.type=a.event.type,g.eventRelatedParticipants=a.event.participants,g._sessionType=a.event.sessionType),a.flags&&(g.sensitivity=a.flags.sensitivity,g.importance=a.flags.importance,g.read=a.flags.read,g.doNotForward=a.flags.doNotForward),g.from=c,g.inReplyTo=a.inReplyTo,g.href=a.href,g.id=a.id,g.lastModifiedDate=a.lastModifiedDate?new Date(a.lastModifiedDate):new Date,g.receivedDate=new Date(a.receivedDate),g.subject=a.subject,g.threadId=a.threadId,g.to=[],a.to&&a.to.forEach&&(a.to.forEach(function(a){g.to.push(this._participantService.getOrCreateParticipant(a))}.bind(this)),e._updateParticipantsList(g.to)),a.parts&&(f=[],a.parts.forEach(function(a){f.push(this._attachmentBuilder.build(a))}.bind(this)),g.parts=this.pairThumbnailsAndAttachments(f)),d._recalculateAllMessageCapabilities(g),g},update:function(a,b){a.body!==b.body&&(a.body=b.body,a._onBodyChangedCallbacks.fire(a,a.body)),a.type!==b.event.type&&(a.type=b.event.type,a._onTypeChangedCallbacks.fire(a,a.type)),a.doNotForward!==b.flags.doNotForward&&(a.doNotForward=b.flags.doNotForward,a._onDoNotForwardStatusChangedCallbacks.fire(a,a.doNotForward)),a.importance!==b.flags.importance&&(a.importance=b.flags.importance,a._onImportanceChangedCallbacks.fire(a,a.importance)),a.sensitivity!==b.flags.sensitivity&&(a.sensitivity=b.flags.sensitivity,a._onSensitivityChangedCallbacks.fire(a,a.sensitivity)),a.read!==b.flags.read&&(a.read=b.flags.read,a._onIsReadStatusChangedCallbacks.fire(a,a.read)),a.href!==b.href&&(a.href=b.href);var c=new Date(b.lastModifiedDate);a.lastModifiedDate&&a.lastModifiedDate.toISOString()===c.toISOString()||(a.lastModifiedDate=c,a._onLastModifiedDateChangedCallbacks.fire(a,c)),c=new Date(b.receivedDate),a.receivedDate&&"Invalid Date"!==a.receivedDate.toString()&&a.receivedDate.toISOString()===c.toISOString()||(a.receivedDate=c),a.subject!==b.subject&&(a.subject=b.subject),a.id!==b.id&&(a.id=b.id),a.threadId!==b.threadId&&(a.threadId=b.threadId),a.getInReplyTo()!==b.inReplyTo&&(a.inReplyTo=b.inReplyTo,a._onInReplyToChangedCallbacks(a,a.getInReplyTo()));var d=[];b.parts.forEach(function(a){d.push(this._attachmentBuilder.build(a))}.bind(this)),this.pairThumbnailsAndAttachments(d).forEach(function(b){var c=a.parts.filter(function(a){return a.disposition===b.disposition})[0];c&&this._attachmentBuilder.update(c,b)}.bind(this)),0<a._attachments.length&&a._attachments.splice(0,a._attachments.length)},isMessageCoalesced:function(c,d){return null!==c&&c!==a&&(null!==d&&d!==a&&(c.getStatus()!==b.Services.Messaging.ResourceStatus.DRAFT_ERROR&&(d.getStatus()!==b.Services.Messaging.ResourceStatus.DRAFT_ERROR&&((c.getFromParticipant()===a||c.getFromParticipant().getAddress()===d.getFromParticipant().getAddress())&&(!c.hasAttachment()&&(c.getType()!==b.Services.Messaging.MessageType.JOINED&&c.getType()!==b.Services.Messaging.MessageType.LEFT&&c.getType()!==b.Services.Messaging.MessageType.CLOSED&&c.getType()!==b.Services.Messaging.MessageType.START&&(d.getType()!==b.Services.Messaging.MessageType.JOINED&&d.getType()!==b.Services.Messaging.MessageType.LEFT&&d.getType()!==b.Services.Messaging.MessageType.CLOSED&&d.getType()!==b.Services.Messaging.MessageType.START&&(c.getSensitivity()===d.getSensitivity()&&(!d.hasAttachment()&&(!(c.getReceivedDate()<d.getReceivedDate())&&(d=c.getReceivedDate()-d.getReceivedDate(),!(isNaN(d)||6e4<d))))))))))))},pairThumbnailsAndAttachments:function(a){for(var b,c={},d=[],e=0;e<a.length;e++)c[a[e].getName()]=a.filter(function(a){return function(b){return b.getName()===a}}(a[e].getName()));for(b in c)if(c.hasOwnProperty(b))if(2===c[b].length){var f=c[b][0]._isThumbnail()?c[b][0]:c[b][1],g=c[b][0]._isThumbnail()?c[b][1]:c[b][0];g.thumbnail=f,d.push(g)}else for(e=0;e<c[b].length;e++)d.push(c[b][e]);return d}},b.Services.Messaging.MessageBuilder=c}(AvayaClientServices),function(a){"use strict";function c(a,b,c,d){this._provider=a,this._attachmentBuilder=c,this._messageBuilder=b,this._messagesToRead=[],this._promises=[],this._messagingAnalyticsService=d}c.prototype={_prepareMessage:function(b){var c={body:b.getBody(),subject:b.subject,threadId:b.threadId,flags:{sensitivity:b.getSensitivity(),importance:b.getImportance()},to:[]};a.Base.Utils.isUndefined(b.inReplyTo)||(c.inReplyTo=b.inReplyTo);for(var d=b.conversation.getParticipants(),e=0;e<d.length;e++)c.to.push({address:d[e].getAddress(),type:d[e].type});return c},send:function(c){function d(b){this._messagingAnalyticsService.trackTimeRequestsSendMessageEnd(g),this._messageBuilder.update(c,b),c.lastModifiedDate=new Date,c._setStatus(a.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllMessageCapabilities(c);var d=c.getAttachments().length;return 0<d&&c.getAttachments().forEach(function(b){b._setStatus(a.Services.Messaging.ResourceStatus.PUBLISHED),this._messagingAnalyticsService.trackMessageAttachmentSize(b.size,b.mimeType)}.bind(this)),b=c.getBody().length,this._messagingAnalyticsService.trackNumMessagesSent(b,d),c}function e(d){return this._messagingAnalyticsService.trackErrorsResponseSendMessage(a.Services.Analytics.AnalyticsErrorCode.MESSAGE_SENDING_ERROR),c._setStatus(a.Services.Messaging.ResourceStatus.DRAFT_ERROR),this._recalculateAllMessageCapabilities(c),0<c.getAttachments().length&&c.getAttachments().forEach(function(b){b._setStatus(a.Services.Messaging.ResourceStatus.DRAFT_ERROR)}.bind(this)),b.Deferred().reject(d).promise()}var f=b.Deferred();if(c.subject.length>this._provider.getMaxSubjectLength())return f.reject(new a.Services.Messaging.MessagingError(a.Services.Messaging.MessagingErrorReason.MESSAGING_SUBJECT_LENGTH_EXCEEDED)),f.promise();if(c.getBody().length>this._provider.getMaxTextLength())return f.reject(new a.Services.Messaging.MessagingError(a.Services.Messaging.MessagingErrorReason.MESSAGING_BODY_LENGTH_EXCEEDED)),f.promise();var g=this._messagingAnalyticsService.startTimingMetric();c.conversation.getStatus()===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(c.subject=c.conversation.getSubject());var h=this._prepareMessage(c),f=0<c.getAttachments().length?(c.getAttachments().forEach(function(b){b._setStatus(a.Services.Messaging.ResourceStatus.DRAFT_SENDING)}.bind(this)),this._provider.sendMessageWithAttachments(h,c.getAttachments()).then(d.bind(this),e.bind(this))):this._provider.sendMessage(h).then(d.bind(this),e.bind(this));return c._setStatus(a.Services.Messaging.ResourceStatus.DRAFT_SENDING),f},getPartById:function(a,b){return a.filter(function(a){return a.id===b})[0]},markAsRead:function(a){var c=b.Deferred();return 0===this._messagesToRead.length&&setTimeout(function(){var a=[];this._messagesToRead.forEach(function(b){a.push(b.id)}),this._provider.markAsReadBatch(a).then(function(a){this._messagesToRead.forEach(function(a){a._recalculateMarkAsReadCapability()}),this._promises.forEach(function(b){b.resolve(a)}),this._messagesToRead=[],this._promises=[]}.bind(this),function(a){this._messagesToRead.forEach(function(a){a._recalculateMarkAsReadCapability()}),this._promises.forEach(function(b){b.reject(a)}),this._messagesToRead=[],this._promises=[]}.bind(this))}.bind(this),2e3),this._messagesToRead.push(a),this._promises.push(c),c.promise()},removeDraftAttachment:function(b,c){var d=b.parts.indexOf(c);-1!==d&&(b.parts.splice(d,1),b.parts.onDataSetChanged([c],a.Base.DataSetChangeTypes.REMOVED)),-1!==(d=b._attachments.indexOf(c))&&b._attachments.splice(b._attachments.indexOf(c),1)},removeAllDraftAttachments:function(b){var c=[];b._attachments.forEach(function(a){var d=b.parts.indexOf(a);-1!==d&&(b.parts.splice(d,1),c.push(a))}.bind(b)),0<c.length&&b.parts.onDataSetChanged(c,a.Base.DataSetChangeTypes.REMOVED),b._attachments.splice(0,b._attachments.length)},createAttachment:function(b,c){if(this._validateAttachmentSize(c)){var d={disposition:'attachment; filename="'+c.name+'"',mimeType:""!==c.type?c.type:"application/octet-stream",size:c.size,status:a.Services.Messaging.ResourceStatus.DRAFT_UNSENT},e=this._attachmentBuilder.build(d,c);return b._attachments.push(e),b.parts.push(e),b.parts.onDataSetChanged([e],a.Base.DataSetChangeTypes.ADDED),e.addOnStatusChangedCallback(function(){this._recalculateAllAttachmentCapabilities(e)}.bind(this)),e}throw new Error("Size not valid.")},stop:function(){this._messagesToRead=[],this._promises=[]},setBodyAndReportTyping:function(c,d,e){var f=b.Deferred();return c.getUpdateBodyCapability().isAllowed?(c.body=e,c._onBodyChangedCallbacks.fire(c,e),d.getStatus()===a.Services.Messaging.ResourceStatus.PUBLISHED&&d.getIsTypingCapability().isAllowed&&d._conversationService.reportTyping(c,!0),f.resolve(this._provider.getMaxTextLength()-c.body.length)):f.reject(new a.Services.Messaging.MessagingError(a.Services.Messaging.MessagingErrorReason.MESSAGING_INVALID_STATE)),f.promise()},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllMessageCapabilities:function(a){a._recalculateUpdateBodyCapability(),a._recalculateUpdateSensitivityCapability(),a._recalculateUpdateInReplyToCapability(),a._recalculateUpdateDoNotForwardCapability(),a._recalculateUpdateImportanceCapability(),a._recalculateCreateAttachmentCapability(),a._recalculateSendCapability(),a._recalculateMarkAsReadCapability(),a._recalculateRemoveCapability();
},_recalculateAllAttachmentCapabilities:function(a){a._recalculateUpdateNameCapability(),a._recalculateUpdateMimeTypeCapability(),a._recalculateUpdateDurationCapability(),a._recalculateUpdateIsSelfGeneratedCapability(),a._recalculateCreateThumbnailCapability(),a._recalculateRemoveThumbnailCapability(),a._recalculateRemoveCapability()},_validateAttachmentSize:function(a){return!(a.type&&(-1!==a.type.indexOf("image")&&this._provider.getMaxImageSize()&&a.size>this._provider.getMaxImageSize()||-1!==a.type.indexOf("video")&&this._provider.getMaxVideoSize()&&a.size>this._provider.getMaxVideoSize()||-1!==a.type.indexOf("audio")&&this._provider.getMaxAudioSize()&&a.size>this._provider.getMaxAudioSize()||-1===a.type.indexOf("image")&&-1===a.type.indexOf("video")&&-1===a.type.indexOf("audio")&&this._provider.getMaxGenericAttachmentSize()&&a.size>this._provider.getMaxGenericAttachmentSize()))}},a.Services.Messaging.MessageService=c}(AvayaClientServices),function(a){"use strict";function b(b,c,d){this._contactsIntegrationService=d,d=new a.Services.Messaging.ThumbnailCreator,b=c.getMessagingProviders(b)[0],this._messagingService=this._createMessagingService(b,d)}b.prototype={create:function(){var b=new a.Services.Messaging.Messaging(this._messagingService);return this._messagingService._recalculateAllMessagingCapabilities(b),b},_createMessagingService:function(b,c){var d=new a.Services.Messaging.ParticipantService,e=new a.Services.Messaging.AttachmentBuilder(c);c.registerCreator("image/*",new a.Services.Messaging.ImageThumbnailCreator(e)),c.registerCreator("video/*",new a.Services.Messaging.VideoThumbnailCreator(e));var f=new a.Services.Messaging.MessageBuilder(e,d),g=new a.Services.Analytics.MessagingAnalyticsService,h=new a.Services.Messaging.MessageService(b,f,e,g),c=new a.Services.Messaging.EscalationService(b),e=new a.Services.Messaging.ConversationBuilder(f),f=new a.Services.Messaging.ConversationService(b,h,d,c,f,e,g),g=new a.Services.Messaging.MessagingService(b,f,h,d,e,this._contactsIntegrationService,g);return f._messagingService=g}},a.Services.Messaging.MessagingFactory=b}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f,g,h,i){this._hasStarted=!1,this._conversationsSubscribed=!1,this._provider=b,this._messageService=e,this._conversationService=d,this.conversations=new c.Base.DataSet,this._draftConversations=[],this._identity={},this._participantsService=f,this._conversationBuilder=g,this._updateByIdDataSetFnc=a,this._contactsIntegrationService=h,this._onContactListChanged=a,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=a,this._unreadConversationsCounter=a,this._messagingAnalyticsService=i}d.prototype={getActiveConversations:function(a){var b=new c.Base.DataRetrieval(this.conversations),d=this._messagingAnalyticsService.startTimingMetric(),e=function(e){this._messagingAnalyticsService.trackTimeRequestsGetConversationsEnd(d),this._updateConversationsContainer(e,this.conversations,a),0===this.conversations.length&&this.conversations.onDataSetChanged(this.conversations,c.Base.DataSetChangeTypes.ADDED),this._subscribeForConversationsUpdates(a),b.isCompleted=!0,b._dataRetrievalProgress.fire(this.conversations.length,!1),b._dataRetrievalDone.fire()}.bind(this),f=function(a){this._messagingAnalyticsService.trackErrorsResponseGetConversations(c.Services.Analytics.AnalyticsErrorCode.GETTING_CONVERSATIONS_ERROR),b._dataRetrievalFailed.fire(a)}.bind(this),g={cancel:function(){}},h=this._provider.getConversations(g);return b._onCancel=function(){g.cancel()},h.then(e,f,function(a){b._dataRetrievalProgress.fire(a,!1)}),b},getDraftConversations:function(){return this._draftConversations},leaveAllConversations:function(){return this.leaveConversations(this.conversations)},leaveConversations:function(a){for(var d=this._messagingAnalyticsService.startTimingMetric(),e=[],f=b.Deferred(),g=a.length,h=0;h<g;h++)e.push(a[h].leave());return b.when.apply(this,e).then(function(){this._messagingAnalyticsService.trackTimeRequestsLeaveConversationsEnd(d),f.resolve(!0)}.bind(this),function(){var a=c.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED;this._messagingAnalyticsService.trackErrorsResponseLeaveConversations(a),f.reject(new c.Services.Messaging.MessagingError(a))}.bind(this)),f.promise()},createConversation:function(a){var b=this._conversationBuilder.build({resourceStatus:c.Services.Messaging.ResourceStatus.DRAFT_UNSENT},this._conversationService);return b.participants.push(this._participantsService.getSelfParticipant()),this.conversations.push(b),this.conversations.onDataSetChanged([b],c.Base.DataSetChangeTypes.ADDED),this._draftConversations.push(b),this._provider.on(c.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(b)}.bind(this)),this._provider.on(c.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(b)}.bind(this)),b.addOnStatusChangedCallback(function(a,b){b===c.Services.Messaging.ResourceStatus.PUBLISHED&&(b=this._draftConversations.indexOf(a),this._draftConversations.splice(b,1)),this._conversationService._recalculateAllConversationCapabilities(a)}.bind(this)),b.addOnActiveStatusChangedCallback(function(a){this._conversationService._recalculateAllConversationCapabilities(a)}.bind(this)),b.addOnClosedStatusChangedCallback(function(a,b){var d=this.conversations.indexOf(a);-1<d&&(this.conversations.splice(d,1),this.conversations.onDataSetChanged([a],c.Base.DataSetChangeTypes.REMOVED)),this._conversationService._recalculateAllConversationCapabilities(a)}.bind(this)),b.lastUpdated=new Date,b},start:function(a,d){return c.Base.Logger.debug(c.Base.LoggerTags.MESSAGING_SERVICE,"Messaging Service is starting..."),this._serviceUnavailableAnalyticsInit(a),this._hasStarted=!0,this._provider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){a._fireMessagingUnavailableCallback(c.Services.Analytics.AnalyticsErrorCode.UNAUTHORIZED)}.bind(this)),this._provider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){a._fireMessagingAvailableCallback()}.bind(this)),this._provider.start(d.ammConfiguration,a).then(function(){return this.validateUsers([this._provider.getSelfAddress()])}.bind(this)).then(function(b){b=this._participantsService.getOrCreateParticipant(b[0]),this._identity.participant=b,this._participantsService.setSelfParticipant(b),this._recalculateAllMessagingCapabilities(a),this._onContactListChanged=function(){this.conversations.forEach(function(a){this._updateMatchedContactsForConversation(a)},this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),a.addOnMessagingServiceAvailableCallback(function(){this._recalculateAllMessagingCapabilities(a)}.bind(this)),a.addOnMessagingServiceUnavailableCallback(function(){this._recalculateAllMessagingCapabilities(a)}.bind(this))}.bind(this),function(c){return this._hasStarted=!1,this._recalculateAllMessagingCapabilities(a),b.Deferred().reject(c).promise()}.bind(this))},_serviceUnavailableAnalyticsInit:function(a){var b;a.addOnMessagingServiceUnavailableCallback(function(a){a._messagingUnavailableReason&&(b=this._messagingAnalyticsService.startTimingMetric(),this._messagingAnalyticsService.trackServiceUnavailable(a._messagingUnavailableReason))}.bind(this)),a.addOnMessagingServiceAvailableCallback(function(){this._messagingAnalyticsService.trackDurationServiceUnavailableEnd(b)}.bind(this))},stop:function(d){d._isAvailable&&(d._isAvailable=a,d._onMessagingServiceUnavailableCallbacks.fire(d));var e=function(){if(this._hasStarted)return this._provider.stop().then(function(b){this._messageService.stop(),this._participantsService.stop(),this._draftConversations=[];for(var e=this.conversations.length,f=0;f<e;f++){for(var g=this.conversations[f].messages.length,h=0;h<g;h++){for(var i=this.conversations[f].messages[h].parts.length,j=0;j<i;j++)delete this.conversations[f].messages[h].parts[j];delete this.conversations[f].messages[h]}for(var k=this.conversations[f]._draftEscalations.length,l=0;l<k;l++)delete this.conversations[f]._draftEscalations[l];delete this.conversations[f]}return this.conversations=new c.Base.DataSet,this._hasStarted=!1,d._onMessagingLimitsChangedCallbacks.empty(),d._onNumberOfConversationsWithUnreadContentChangedCallbacks.empty(),d._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.empty(),d._onRoutableDomainsChangedCallbacks.empty(),this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=a,this._unreadConversationsCounter=a,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=a,this._recalculateAllMessagingCapabilities(d),b}.bind(this));var e=b.Deferred(),f=new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED);return e.reject(f),e.promise()}.bind(this);return this.logout().then(e,e)},_stopImmediately:function(a){return c.Base.Logger.debug(c.Base.LoggerTags.MESSAGING_SERVICE,"Stopping the Service"),a._isAvailable&&a._onMessagingServiceUnavailableCallbacks.fire(a),a=b.Deferred(),this._hasStarted?(c.Base.Logger.debug(c.Base.LoggerTags.MESSAGING_SERVICE,"Service stopped successfully"),a.resolve()):(c.Base.Logger.debug(c.Base.LoggerTags.MESSAGING_SERVICE,"Service failed to stop"),a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED))),a.promise()},logout:function(){return this._provider.logout()},getNumberOfConversationsWithUnreadContent:function(){return this.conversations.filter(function(a){return 0<a.getUnreadMessageCount()||0<a.getUnreadAttachmentCount()}).length},getNumberOfConversationsWithUnreadContentSinceLastAccess:function(){return this.conversations.filter(function(a){return a.hasUnreadMessagesSinceLastAccess()}).length},validateUsers:function(a){return this._conversationService.validateUsers(a)},searchConversations:function(a,b){var d=this._messagingAnalyticsService.startTimingMetric(),e=new c.Base.DataRetrieval,f=e.getDataSet(),g={cancel:function(){}},h={q:a.getQuery(),subject:a.isSearchSubject(),participants:a.isSearchParticipants(),body:a.isSearchBody()};a.getQueryAfter()&&(h.after=a.getQueryAfter().toISOString());var i=function(a){this._messagingAnalyticsService.trackTimeRequestsSearchConversationsEnd(d),this._updateConversationsContainer(a,f,b),e.isCompleted=!0,e._dataRetrievalProgress.fire(f.length,!1),e._dataRetrievalDone.fire(),this._messagingAnalyticsService.trackNumConversationSearchRequests(h.body,h.subject,h.participants)}.bind(this),j=function(a){this._messagingAnalyticsService.trackErrorsResponseSearchConversations(c.Services.Analytics.AnalyticsErrorCode.SEARCHING_CONVERSATIONS_ERROR),e._dataRetrievalFailed.fire(a)}.bind(this),k=function(a){e._dataRetrievalProgress.fire(a,!1)}.bind(this);return this._provider.getConversationsByQuery(h,null,g).then(i,j,k),e._onCancel=function(){g.cancel()},this._searchLocalConversations(this.conversations,a).forEach(function(a){f.push(a)}),setTimeout(function(){f.onDataSetChanged(f,c.Base.DataSetChangeTypes.ADDED),k(f,!1)},0),e},_createNewConversation:function(a,b){var d=this._conversationBuilder.build(a,this._conversationService);return this._provider.on(c.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(d)}.bind(this)),this._provider.on(c.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(d)}.bind(this)),this._conversationBuilder.update(d,a,this._conversationService),d.addOnClosedStatusChangedCallback(function(a,b){var d=this.conversations.indexOf(a);-1<d&&(this.conversations.splice(d,1),this.conversations.onDataSetChanged([a],c.Base.DataSetChangeTypes.ADDED))}.bind(this)),d},_getById:function(a,b){return a.filter(function(a){return a.id===b})[0]},_updateConversationsContainer:function(a,b,d){if(a&&a.conversations&&0<a.conversations.length){for(var e=[],f=[],g=0;g<a.conversations.length;g++){var h=a.conversations[g],i=this._getById(b,h.id);i?(this._conversationBuilder.update(i,h,this._conversationService),e.push(i),this._updateMatchedContactsForConversation(i)):h.flags.active&&((i=this._createNewConversation(h,d)).participants=this._conversationService.getParticipantsFromMessage(h.messages[0]),b.unshift(i),f.push(i),this._updateMatchedContactsForConversation(i))}0<f.length&&b.onDataSetChanged(f,c.Base.DataSetChangeTypes.ADDED),0<e.length&&b.onDataSetChanged(e,c.Base.DataSetChangeTypes.UPDATED),this._updateNumberOfConversationsWithUnreadContent(d),this._updateNumberOfConversationsWithUnreadContentSinceLastAccessTime(d)}},_searchLocalConversations:function(a,d){var e=[];return a.forEach(function(a){var f=!1;d.isSearchSubject()&&-1!==a.getSubject().toLowerCase().indexOf(d.getQuery())&&(f=!0),d.isSearchParticipants()&&a.getParticipants().forEach(function(a){-1===a.givenName.toLowerCase().indexOf(d.getQuery())&&-1===a.surname.toLowerCase().indexOf(d.getQuery())||(f=!0)});var g=a.getMessages();d.isSearchBody()&&(g=a.getMessages().filter(function(a){if(d.isSearchBody()&&a.body&&-1!==a.body.toLowerCase().indexOf(d.getQuery()))return f=!0}));var h,i=d.getQueryAfter();(f=i&&f?a.getLastUpdatedTime()>=i:f)&&((h=b.extend(new c.Services.Messaging.Conversation,a)).messages=new c.Base.DataSet,g.forEach(function(a){h.messages.push(b.extend(new c.Services.Messaging.Message(this._messageService,h),a))}.bind(this)),this._conversationBuilder._updatePreviewText(h),e.push(h))}.bind(this)),e},_subscribeForConversationsUpdates:function(a){this._conversationsSubscribed||this._provider.observeConversations().then(function(){this._provider.on(c.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,function(b){this._updateConversationsContainer(b,this.conversations,a)}.bind(this)),this._conversationsSubscribed=!0}.bind(this))},_updateConversationsByIdDataSet:function(a,b,c){var d={conversations:[]};a.forEach(function(a){var c=b.filter(function(b){return b.id===a.id})[0];c&&d.conversations.push(c)}.bind(this)),0<d.conversations.length&&this._updateConversationsContainer(d,a,c)},removeConversation:function(a){var d,e=b.Deferred();return a.getRemoveCapability().isAllowed?(0<=(d=this.conversations.indexOf(a))&&(this.conversations.splice(d,1),this.conversations.onDataSetChanged([a],c.Base.DataSetChangeTypes.REMOVED)),0<=(d=this._draftConversations.indexOf(a))&&this._draftConversations.splice(d,1),e.resolve()):e.reject(new c.Base.BaseError(a.getRemoveCapability().denialReason)),e.promise()},removeAllDraftConversations:function(){for(var a=this._draftConversations.length-1;0<=a;a--)this.removeConversation(this._draftConversations[a])},serviceIsAvailable:function(){return!!this._provider.isAvailable()&&this._hasStarted},_recalculateAllMessagingCapabilities:function(a){a._recalculateRetrieveConversationsCapability(),a._recalculateStartServiceCapability(),a._recalculateCreateConversationCapability(),a._recalculateSearchConversationsCapability(),a._recalculateValidateParticipantAddressCapability(),a._recalculateMarkContentAsReadCapability()},getRoutableDomains:function(){return this._provider.getRoutableDomains()},getSelfAddress:function(){return this._provider.getSelfAddress()},getConversationResource:function(){return this._provider.getSelfAddress()},getValidateAddressResource:function(){return this._provider.getValidateAddressResource()},getMarkAsReadResource:function(){return this._provider.getMarkAsReadResource()},_updateMatchedContactsForConversation:function(a){this._contactsIntegrationService.isStarted()&&a.getParticipants().forEach(function(a){this._updateMatchedContactsForParticipant(a)},this)},_updateMatchedContactsForParticipant:function(a){this._contactsIntegrationService.updateMatchedContactsForParticipant(a)},_updateNumberOfConversationsWithUnreadContent:function(a){var b=this.getNumberOfConversationsWithUnreadContent(),d=c.Base.Utils.isDefined(this._unreadConversationsCounter);this._unreadConversationsCounter!==b&&(this._unreadConversationsCounter=b,d&&a._onNumberOfConversationsWithUnreadContentChangedCallbacks.fire(a,b))},_updateNumberOfConversationsWithUnreadContentSinceLastAccessTime:function(a){var b=this.getNumberOfConversationsWithUnreadContentSinceLastAccess(),d=c.Base.Utils.isDefined(this._numberOfConversationsWithUnreadContentSinceLastAccessTime);this._numberOfConversationsWithUnreadContentSinceLastAccessTime!==b&&(this._numberOfConversationsWithUnreadContentSinceLastAccessTime=b,d&&a._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.fire(a,b))}},c.Services.Messaging.MessagingService=d}(AvayaClientServices),function(b){"use strict";function c(){this._participants=[],this._selfParticipant=a}c.prototype={getOrCreateParticipant:function(a){var c=a._address||a.address||a.from._address||a.from.address,d=this._getParticipant(c);return d||(c=!!this._selfParticipant&&this._selfParticipant.getAddress()===c,d=new b.Services.Messaging.Participant(a,c),this._participants.push(d)),d},_getParticipant:function(a){return this._participants.filter(function(b){return b.getAddress()===a})[0]},setSelfParticipant:function(a){this._selfParticipant=a,this._selfParticipant.self=!0},getSelfParticipant:function(){return this._selfParticipant},stop:function(){this._selfParticipant=a,this._participants=[]}},b.Services.Messaging.ParticipantService=c}(AvayaClientServices),function(b){"use strict";function c(a){this._config=a||{width:128},this._creators={}}c.prototype={getConfig:function(){return this._config},setConfig:function(a){this._config=a},registerCreator:function(a,b){this._creators[a]=b},unregisterCreator:function(b){this._creators[b]=a},create:function(a,b){if(b=b||this._config,a.getCreateThumbnailCapability().isAllowed){var c=this._creators[a.getMimeType()]?a.getMimeType():a.getMimeType().slice(0,a.getMimeType().indexOf("/")+1)+"*";return this._creators[c].create(a,b)}}},b.Services.Messaging.ThumbnailCreator=c}(AvayaClientServices),function(a){"use strict";function c(b){a.Services.Messaging.AbstractThumbnailCreator.call(this,b)}(c.prototype=Object.create(a.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(a,c){var d=b.Deferred(),e={disposition:a.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:a.status},f=new FileReader;return f.onloadend=function(){this._getFirstFrameFromVideo(f.result,function(b){var f=new Image;f.src=b,f=new Blob([this._resizeImage(f,c)],{type:"image/jpeg"}),e.size=f.size,a.thumbnail=this._attachmentBuilder.build(e,f),d.resolve(a.thumbnail)}.bind(this))}.bind(this),f.readAsDataURL(a.file),d.promise()},c.prototype._getFirstFrameFromVideo=function(a,c){var d,e,f=document.createElement("canvas"),g=document.createElement("video"),h=document.createElement("source");h.src=a,h.type="video/mp4",g.appendChild(h),b(g).on("loadedmetadata",function(){f.height=e=g.videoHeight,f.width=d=g.videoWidth}),b(g).on("loadeddata",function(){f.getContext("2d").drawImage(g,0,0,d,e),c(f.toDataURL("image/jpeg"))}),b(g).on("error",function(){throw new Error}),g.load()},a.Services.Messaging.VideoThumbnailCreator=c}(AvayaClientServices),function(c){"use strict";function d(){this._address="",this._participantId=a,this._displayName="",this._localUser=!1,this._joinTime=Date.now(),this._matchedContacts=new c.Services.Contacts.MatchedContactsWithMatchLevel,this._onParticipantMatchedContactsChangedCallbacks=b.Callbacks()}d.prototype={getAddress:function(){return this._address},setAddress:function(a){this._address=a},getDisplayName:function(){return this._displayName},setDisplayName:function(a){this._displayName=a},getParticipantId:function(){return this._participantId},isLocalUser:function(){return this._localUser},getBestContactMatch:function(){if(this._matchedContacts&&!this._matchedContacts.empty)return 0<this._matchedContacts._exactType1Contacts.length?this._matchedContacts._exactType1Contacts[0]:0<this._matchedContacts._exactType2Contacts.length?this._matchedContacts._exactType2Contacts[0]:0<this._matchedContacts._partialType1Contacts.length?this._matchedContacts._partialType1Contacts[0]:void 0},getAllPossibleContactMatches:function(){return this._matchedContacts},setMatchedContacts:function(a){(a&&!a._equals(this._matchedContacts)||!a&&this._matchedContacts)&&(this._matchedContacts=a,this._onParticipantMatchedContactsChangedCallbacks.fire(this))}},c.Services.Participant=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Participant.prototype,{addOnParticipantMatchedContactsChangedCallback:function(a){this._onParticipantMatchedContactsChangedCallbacks.add(a)},removeOnParticipantMatchedContactsChangedCallback:function(a){this._onParticipantMatchedContactsChangedCallbacks.remove(a)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Presence.PresenceErrorReason={UNKNOWN:"UNKNOWN",UNSUPPORTED:"UNSUPPORTED",CANCELED:"CANCELED",INVALID_REQUEST:"INVALID_REQUEST",INVALID_STATE:"INVALID_STATE",INTERNAL_ERROR:"INTERNAL_ERROR",SEND_ERROR:"SEND_ERROR",TIMEOUT:"TIMEOUT",RETRY_LIMIT_EXCEEDED:"RETRY_LIMIT_EXCEEDED",INVALID_RESPONSE:"INVALID_RESPONSE",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",SERVER_ERROR:"SERVER_ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Presence.PresenceLocationMode={PRESENCE_LOCATION_MODE_UNSPECIFIED:"PRESENCE_LOCATION_MODE_UNSPECIFIED",PRESENCE_LOCATION_MODE_OFFICE:"PRESENCE_LOCATION_MODE_OFFICE",PRESENCE_LOCATION_MODE_HOME:"PRESENCE_LOCATION_MODE_HOME",PRESENCE_LOCATION_MODE_MOBILE:"PRESENCE_LOCATION_MODE_MOBILE",PRESENCE_LOCATION_MODE_TRAVELING:"PRESENCE_LOCATION_MODE_TRAVELING"}}(),function(a){"use strict";var b={PRESENCE_STATE_UNKNOWN:"PRESENCE_STATE_UNKNOWN",PRESENCE_STATE_UNSPECIFIED:"PRESENCE_STATE_UNSPECIFIED",PRESENCE_STATE_AVAILABLE:"PRESENCE_STATE_AVAILABLE",PRESENCE_STATE_ON_A_CALL:"PRESENCE_STATE_ON_A_CALL",PRESENCE_STATE_BUSY:"PRESENCE_STATE_BUSY",PRESENCE_STATE_AWAY:"PRESENCE_STATE_AWAY",PRESENCE_STATE_DO_NOT_DISTURB:"PRESENCE_STATE_DO_NOT_DISTURB",PRESENCE_STATE_OUT_OF_OFFICE:"PRESENCE_STATE_OUT_OF_OFFICE",PRESENCE_STATE_OFFLINE:"PRESENCE_STATE_OFFLINE"},c={PRESENCE_STATE_UNKNOWN:(a.Services.Presence.PresenceState=b).PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:b.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:b.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_BUSY:b.PRESENCE_STATE_BUSY,PRESENCE_STATE_AWAY:b.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:b.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:b.PRESENCE_STATE_OFFLINE};a.Services.Presence.ManualPresenceState=c,c={PRESENCE_STATE_UNKNOWN:b.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:b.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:b.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:b.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:b.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:b.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:b.PRESENCE_STATE_OFFLINE},a.Services.Presence.PhonePresenceState=c,c={PRESENCE_STATE_UNKNOWN:b.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:b.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:b.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:b.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:b.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:b.PRESENCE_STATE_OFFLINE},a.Services.Presence.VideoPresenceState=c,c={PRESENCE_STATE_UNKNOWN:b.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:b.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:b.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:b.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:b.PRESENCE_STATE_OFFLINE},a.Services.Presence.IMPresenceState=c,b={PRESENCE_STATE_UNKNOWN:b.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:b.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:b.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:b.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:b.PRESENCE_STATE_OFFLINE},a.Services.Presence.CalendarPresenceState=b}(AvayaClientServices),function(b){"use strict";function c(b){this._presentity=b,this._locationMode=a,this._note=a,this._calendarStartTime=a,this._calendarEndTime=a,this._calendarState=a,this._manualState=a,this._overallState=a,this._enterpriseIMState=a,this._phoneState=a,this._videoState=a,this._enterpriseIMContact=a,this._phoneContact=a,this._videoContact=a}c.prototype={getPresentity:function(){return this._presentity},getOverallState:function(){return this._overallState},_setOverallState:function(a){this._overallState=a},getManualState:function(){return this._manualState},_setManualState:function(a){this._manualState=a},getPhoneState:function(){return this._phoneState},_setPhoneState:function(a){this._phoneState=a},getPhoneContact:function(){return this._phoneContact},_setPhoneContact:function(a){this._phoneContact=a},getVideoState:function(){return this._videoState},_setVideoState:function(a){this._videoState=a},getVideoContact:function(){return this._videoContact},_setVideoContact:function(a){this._videoContact=a},getEnterpriseIMState:function(){return this._enterpriseIMState},_setEnterpriseIMState:function(a){this._enterpriseIMState=a},getEnterpriseIMContact:function(){return this._enterpriseIMContact},_setEnterpriseIMContact:function(a){this._enterpriseIMContact=a},getCalendarState:function(){return this._calendarState},_setCalendarState:function(a){this._calendarState=a},getCalendarStartTime:function(){return this._calendarStartTime},_setCalendarStartTime:function(a){this._calendarStartTime=a},getCalendarEndTime:function(){return this._calendarEndTime},_setCalendarEndTime:function(a){this._calendarEndTime=a},getLocationMode:function(){return this._locationMode},_setLocationMode:function(a){this._locationMode=a},getNote:function(){return this._note},_setNote:function(a){this._note=a}},b.Services.Presence.Presence=c}(AvayaClientServices),function(a){"use strict";function b(a){Error.call(this),this._reason=a}(b.prototype=Object.create(Error.prototype)).getReason=function(){return this._reason},a.Services.Presence.PresenceError=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Services.Presence.Presence.prototype)).setPhoneState=function(b){var c,d=!1;for(c in a.Services.Presence.PhonePresenceState)if(a.Services.Presence.PhonePresenceState.hasOwnProperty(c)&&b===a.Services.Presence.PhonePresenceState[c]){this._setPhoneState(b),d=!0;break}return d},b.prototype.setVideoState=function(b){var c,d=!1;for(c in a.Services.Presence.VideoPresenceState)if(a.Services.Presence.VideoPresenceState.hasOwnProperty(c)&&b===a.Services.Presence.VideoPresenceState[c]){this._setVideoState(b),d=!0;break}return d},b.prototype.setEnterpriseIMState=function(b){var c,d=!1;for(c in a.Services.Presence.IMPresenceState)if(a.Services.Presence.IMPresenceState.hasOwnProperty(c)&&b===a.Services.Presence.IMPresenceState[c]){this._setEnterpriseIMState(b),d=!0;break}return d},a.Services.Presence.SelfPresence=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={getCallLogId:function(){},getParticipantList:function(){},getStartTime:function(){},getCallDuration:function(){},isCallerIdPrivate:function(){},getSubject:function(){},getRemoteAddress:function(){},getLocalAddress:function(){},getCallType:function(){},getWebConferenceAddress:function(){},getChannelTypeList:function(){},isBridged:function(){},isIncoming:function(){},isMissed:function(){},isDeclined:function(){},isFailed:function(){},isRead:function(){},getCorrelatedCallLogIdList:function(){}},a.Services.SessionLogs.CallLogItem=b}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={getUnreadCount:function(){}},a.Services.SessionLogs.CallLogsDataSet=b}(AvayaClientServices),function(a){"use strict";a.Services.SessionLogs.create=function(){return new a.Services.SessionLogs.SessionLogs}}(AvayaClientServices),function(a){"use strict";function b(){}b.prototype={getCurrentCallLogItemList:function(){},markAsRead:function(a,b){},deleteCallLogItemList:function(a,b){}},a.Services.SessionLogs.SessionLogs=b}(AvayaClientServices),function(c){"use strict";function d(){this._vmProvider=a,this._available=a,this._starting=!1,this._started=!1,this._vmNumber=a,this._vmStatus=new c.Services.VoiceMessaging.VoiceMessagingStatusParameters((!1)),this._onVoicemailNumberChange=a,this._onMWIStatusChange=a,this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._onVoicemailNumberChangedCallbacks=b.Callbacks(),this._onVoiceMessagingStatusChangedCallbacks=b.Callbacks(),this._onVoiceMessagingServiceAvailableCallbacks=b.Callbacks(),this._onVoiceMessagingServiceUnavailableCallbacks=b.Callbacks(),this._serviceAvailableCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)}d.prototype={getVoicemailNumber:function(){return this._vmNumber},getVoiceMessagingStatus:function(){return this._vmStatus},start:function(d,e){return e&&(this._vmProvider=e),d.sgConfiguration.credentialProvider.isGuest?(c.Base.Logger.warn(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Cannot start service for guest"),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.USER_NOT_FOUND)).promise()):(this.startDfd=b.Deferred(),c.Base.Utils.isWebRTC_SupportedBrowser(d.sgConfiguration._disableWebRTCForTheseBrowsers)?(c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Starting the service"),this._subscribeForProvidersNotifications(),this._starting=!0,this._vmProvider.start(a,d.sgConfiguration).fail(function(a){this._starting=!1,this._available=!1,c.Base.Logger.error(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service",a),this.startDfd.state()===c.Base.DeferredStates.PENDING&&this.startDfd.reject(a)}.bind(this)),c.Base.Utils.isDefined(this._vmProvider.isServiceAvailable)&&this._vmProvider.isServiceAvailable()&&this._onServiceAvailable(),this.startDfd.promise()):(this._available=!1,this._started=!0,this._onVoiceMessagingServiceUnavailableCallbacks.fire(this),this._serviceAvailableCapability._updateIfChanged(!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)).promise()))},stop:function(){c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._unsubscribeFromProvidersNotifications(),this._onServiceUnavailable();var a=function(){this._started=!1,this._onVoicemailNumberChangedCallbacks.empty(),this._onVoiceMessagingStatusChangedCallbacks.empty(),this._onVoiceMessagingServiceAvailableCallbacks.empty(),this._onVoiceMessagingServiceUnavailableCallbacks.empty()}.bind(this);return this._vmProvider.stop().then(function(){a(),c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully")}.bind(this),function(d){return a(),c.Base.Logger.error(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to stop service",d),b.Deferred().reject(d).promise()}.bind(this))},_stopImmediately:function(){return c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._started=!1,this._onServiceUnavailable(),c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully"),b.Deferred().resolve().promise()},_onServiceAvailable:function(){var a;this._available||(this._started||(this._starting=!1,this._started=!0,c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service started successfully"),this.startDfd.state()===c.Base.DeferredStates.PENDING&&this.startDfd.resolve()),this._serviceAvailableCapability._updateIfChanged(!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._available=!0,c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is available"),this._onVoiceMessagingServiceAvailableCallbacks.fire(this),a=this._vmProvider.getVoicemailMWI(),this._vmStatus.isMessageWaiting()!==a&&(this._vmStatus._setMessageWaiting(a),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus),c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New MWI is "+a)),
a=this._vmProvider.getVoicemailNumber(),this._vmNumber!==a&&(this._vmNumber=a,this._onVoicemailNumberChangedCallbacks.fire(a),c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New voicemail number is "+a)))},_onServiceUnavailable:function(){(this._available||this._starting)&&(this._starting&&(this._starting=!1,c.Base.Logger.error(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service"),this.startDfd.state()===c.Base.DeferredStates.PENDING&&this.startDfd.reject()),this._serviceAvailableCapability._updateIfChanged(!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._available=!1,c.Base.Logger.info(c.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is unavailable"),this._onVoiceMessagingServiceUnavailableCallbacks.fire(this))},_subscribeForProvidersNotifications:function(){this._started||this._starting||(this._onVoicemailNumberChange=function(a){this._vmNumber!==a&&(this._vmNumber=a,this._onVoicemailNumberChangedCallbacks.fire(a))}.bind(this),this._onMWIStatusChange=function(a){this._vmStatus.isMessageWaiting()!==a&&(this._vmStatus._setMessageWaiting(a),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus))}.bind(this),this._onNetworkAvailable=this._onServiceAvailable.bind(this),this._onNetworkUnavailable=this._onServiceUnavailable.bind(this),this._vmProvider.on(c.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.on(c.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._vmProvider.on(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._onNetworkAvailable),this._vmProvider.on(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._onNetworkUnavailable))},_unsubscribeFromProvidersNotifications:function(){this._started&&(this._vmProvider.off(c.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.off(c.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.off(c.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.off(c.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.off(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.off(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._onVoicemailNumberChange=a,this._onMWIStatusChange=a)}},c.Services.VoiceMessaging.VoiceMessaging=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.VoiceMessaging.VoiceMessaging.prototype,{addOnVoiceMessagingServiceUnavailableCallback:function(a){this._onVoiceMessagingServiceUnavailableCallbacks.add(a)},removeOnVoiceMessagingServiceUnavailableCallback:function(a){this._onVoiceMessagingServiceUnavailableCallbacks.remove(a)},addOnVoiceMessagingServiceAvailableCallback:function(a){this._onVoiceMessagingServiceAvailableCallbacks.add(a)},removeOnVoiceMessagingServiceAvailableCallback:function(a){this._onVoiceMessagingServiceAvailableCallbacks.remove(a)},addOnVoicemailNumberChangedCallback:function(a){this._onVoicemailNumberChangedCallbacks.add(a)},removeOnVoicemailNumberChangedCallback:function(a){this._onVoicemailNumberChangedCallbacks.remove(a)},addOnVoiceMessagingStatusChangedCallback:function(a){this._onVoiceMessagingStatusChangedCallbacks.add(a)},removeVoiceMessagingStatusChangedCallback:function(a){this._onVoiceMessagingStatusChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.VoiceMessaging.VoiceMessaging.prototype,{getSubscribeForVoicemailNumberChangesCapability:function(){return this._serviceAvailableCapability},getSubscribeForVoiceMessagingStatusChangesCapability:function(){return this._serviceAvailableCapability}})}(AvayaClientServices),function(a){"use strict";function b(a){this._messageWaiting=a}b.prototype={isMessageWaiting:function(){return this._messageWaiting},_setMessageWaiting:function(a){this._messageWaiting=a}},a.Services.VoiceMessaging.VoiceMessagingStatusParameters=b}(AvayaClientServices),function(a){"use strict";var c={createLogAPICallAdvice:function(b){return new a.Base.AOPAdvice(a.Base.AOPPointcutType.BEFORE,function(c,d,e,f){a.Base.Logger.info(b,"API called: "+d+"."+e)})},createWrapCaughtErrorInPromiseAdvice:function(d,e){return new a.Base.AOPAdvice(a.Base.AOPPointcutType.AROUND,function(f,g,h,i,j,k){try{var l=j.apply(i,k);return l&&"function"==typeof l.fail&&l.fail(function(b){c._isSupportedExceptionClass(b)&&(a.Base.Logger.warn(d,"Caught error inside promise handler",b),a.Base.AOPTools.triggerExceptionCallback(b))}),l}catch(f){return a.Base.Logger.warn(d,"Caught error in execution of function returning promise",f),a.Base.AOPTools.triggerExceptionCallback(f),b.Deferred().reject(e).promise()}})},_isSupportedExceptionClass:function(b){return b instanceof Error||b instanceof a.Base.BaseError||b instanceof a.Services.Conference.ConferenceException||b instanceof a.Services.Collaboration.CollaborationError||b instanceof a.Services.Call.CallException||b instanceof a.Services.Contacts.ContactsError||b instanceof a.Services.Presence.PresenceError},createWrapCaughtErrorInAdvice:function(b){return new a.Base.AOPAdvice(a.Base.AOPPointcutType.AROUND,function(c,d,e,f,g,h){try{return g.apply(f,h)}catch(c){throw a.Base.Logger.warn(b,"Caught error in execution of function",c),a.Base.AOPTools.triggerExceptionCallback(c),c}})}};c.LOG_CALL_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.CALL_SERVICE),c.LOG_PRESENCE_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.PRESENCE_SERVICE),c.LOG_CONTACTS_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.CONTACTS_SERVICE),c.LOG_MESSAGING_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.MESSAGING_SERVICE),c.LOG_COLLABORATION_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.COLLABORATION_SERVICE),c.LOG_CONFERENCE_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.CONFERENCE_SERVICE),c.LOG_USER_API_CALLS=c.createLogAPICallAdvice(a.Base.LoggerTags.USER_SERVICE),c.WRAP_CAUGHT_CALL_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.CALL_SERVICE,new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR)),c.WRAP_CAUGHT_CALL_EXCEPTION=c.createWrapCaughtErrorInAdvice(a.Base.LoggerTags.CALL_SERVICE,new a.Services.Call.CallException(a.Services.Call.CallError.INTERNAL_ERROR)),c.WRAP_CAUGHT_PRESENCE_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.PRESENCE_SERVICE,new a.Services.Presence.PresenceError(a.Services.Presence.PresenceErrorReason.INTERNAL_ERROR)),c.WRAP_CAUGHT_CONTACTS_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.CONTACTS_SERVICE,new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),c.WRAP_CAUGHT_MESSAGING_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.MESSAGING_SERVICE,new a.Services.Messaging.MessagingError(a.Services.Messaging.MessagingErrorReason.MESSAGING_INTERNAL_ERROR)),c.WRAP_CAUGHT_COLLABORATION_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.COLLABORATION_SERVICE,new a.Services.Collaboration.CollaborationError(a.Services.Collaboration.CollaborationErrorReason.INTERNAL_ERROR)),c.WRAP_CAUGHT_CONFERENCE_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.CONFERENCE_SERVICE,new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"An internal error occurred.")),c.WRAP_CAUGHT_USER_ERROR=c.createWrapCaughtErrorInPromiseAdvice(a.Base.LoggerTags.USER_SERVICE,new a.Base.BaseError(a.Base.ErrorReasons.INTERNAL_ERROR)),a.Base.AOPCommonAdvices=c}(AvayaClientServices),function(c){"use strict";function d(b){c.Base.Observable.call(this),this._elements={},this._appliedElementIds=[],this._elementsIds=[],this._elementAdditionDates=[],this._options=b||new c.Base.CacheOptions,this.auditIntervald=a,this._startAudit()}(d.prototype=Object.create(c.Base.Observable.prototype)).getElement=function(a){return a=this._cutIdFromUrl(a),this._elements[a]},d.prototype.getAllElements=function(){var a,b=[];for(a in this._elements)this._elements.hasOwnProperty(a)&&b.push(this._elements[a]);return c.Base.Utils.removeDuplicatesFromArray(b)},d.prototype.addElement=function(a,b){return!!this._addElement(a,b)&&(this.trigger(c.Base.ElementCacheEvents.ELEMENT_ADDED,[[b]]),!0)},d.prototype.addElements=function(a){var b=this._makeRoomForNewElements(a);if(b.length)for(var d=0;d<b.length;d++)this.addElement(b[d].elementId,b[d].element)||c.Base.Logger.error(c.Base.LoggerTags.CACHE,"The element was not added",b[d]);return b},d.prototype.updateElement=function(a,b){if(a&&b){a=this._cutIdFromUrl(a);var d=this.getElement(a);if(d&&!this._areElementsEqual(d,b))return d=this._getIndexOfElementId(a),-1<d&&(this._elements[a]=b,this._elementAdditionDates.splice(d,1),this._elementsIds.splice(d,1),this._elementAdditionDates.push(new Date),this._elementsIds.push(a)),this.trigger(c.Base.ElementCacheEvents.ELEMENT_UPDATED,[b]),!0}return!1},d.prototype.deleteElement=function(a){return a=this._deleteElement(a),!!a&&(this.trigger(c.Base.ElementCacheEvents.ELEMENT_DELETED,[[a]]),!0)},d.prototype.empty=function(){var a,b,d=[];for(a in this._elements)!this._elements.hasOwnProperty(a)||(b=this._deleteElement(a))&&d.push(b);this.trigger(c.Base.ElementCacheEvents.ELEMENT_DELETED,[d])},d.prototype.applyElements=function(a,d){for(var e,f,g,h=a.length,i=[],j=[],k=0;k<h;k++)e=a[k].elementId,f=a[k].element,e&&f&&(this._addElement(e,f)?(this._appliedElementIds.push(e),i.push(f)):this.updateElement(e,f)||this.getElement(e)?this._appliedElementIds.push(e):c.Base.Logger.warn(c.Base.LoggerTags.CACHE,"Failed to add or update cache element",f));if(0<i.length&&this.trigger(c.Base.ElementCacheEvents.ELEMENT_ADDED,[i]),!d){for(e in this._elements)-1!==b.inArray(e,this._appliedElementIds)||(g=this._deleteElement(e))&&j.push(g);this._appliedElementIds=[]}0<j.length&&this.trigger(c.Base.ElementCacheEvents.ELEMENT_DELETED,[j])},d.prototype.getCacheSize=function(){return this._elementsIds.length},d.prototype.getCacheMaxSize=function(){return this._options.maxElements},d.prototype._addElement=function(a,b){return!(!a||!b||this.getElement(a)||(b=this._makeRoomForNewElements([{elementId:a,element:b}]),!b.length))&&(this._elements[b[0].elementId]=b[0].element,this._elementsIds.push(b[0].elementId),this._elementAdditionDates.push(new Date),this._startAudit(),!0)},d.prototype._deleteElement=function(b){var c=this.getElement(b);if(c){var d=this._getIndexOfElementId(b);return-1<d&&(b=this._cutIdFromUrl(b),delete this._elements[b],this._elementAdditionDates.splice(d,1),this._elementsIds.splice(d,1)),this.getCacheSize()||this._stopAudit(),c}return a},d.prototype._deleteElements=function(a){for(var b=!0,d=a.length,e=0;e<d;e++)this._deleteElement(a[e])||(b=!1,c.Base.Logger.error(c.Base.LoggerTags.CACHE,"The element was not deleted",a[e]));return b},d.prototype._areElementsEqual=function(a,b){return a===b||"function"==typeof a.equals&&a.equals(b)},d.prototype._makeRoomForNewElements=function(b){var d=this.getCacheSize(),e=this.getCacheMaxSize(),f=void 0!==e?e-d:a,g=b.length,d=void 0!==f?g-f:a,f=b.slice();return e&&e<g?(this.empty(),f=b.slice(-e),c.Base.Logger.warn(c.Base.LoggerTags.CACHE,"Some elements can not be added, because the size of adding data more then max cache size",b.slice(0,-e))):d&&0<d&&this._deleteElements(this._elementsIds.slice(0,d)),f},d.prototype._startAudit=function(){this._options.auditInterval?this.auditIntervald||(this.auditIntervald=setInterval(function(){this._audit()}.bind(this),this._options.auditInterval)):this._stopAudit()},d.prototype._audit=function(){if(this._options.timeToLive)for(var a,b=new Date,c=this._elementAdditionDates.length,d=0;d<c;d++)b-this._elementAdditionDates[d]>this._options.timeToLive&&(a=this._elementsIds[d],this._deleteElement(a))},d.prototype._stopAudit=function(){this.auditIntervald&&(clearInterval(this.auditIntervald),this.auditIntervald=a)},d.prototype._getIndexOfElementId=function(a){a=this._cutIdFromUrl(a);var b=this._elementsIds.indexOf(a);return-1===b&&c.Base.Logger.warn(c.Base.LoggerTags.CACHE,"Can not find index of element",a),b},d.prototype._cutIdFromUrl=function(a){var b;return a=a&&"string"==typeof a&&-1<a.indexOf("/")?(b=a.split("/"))[b.length-1]:a},c.Base.ElementCache=d}(AvayaClientServices),function(a){"use strict";function b(b){this._audioInputInterfaceService=b,a.Base.MediaInterface.call(this,b)}(b.prototype=Object.create(a.Base.MediaInterface.prototype)).setVolume=function(b){a.Base.Logger.warn(a.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: setVolume.")},b.prototype.getVolume=function(){a.Base.Logger.warn(a.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: getVolume.")},b.prototype._canPickDevices=function(){return!0},b.prototype.toString=function(){return"Mic"},a.Base.AudioInputInterface=b}(AvayaClientServices),function(b){"use strict";function c(){b.Base.MediaInterfaceService.call(this),this._deviceIdentifier=b.Base.MediaTypes.AUDIO_INPUT,this._audioInputVolumeController=a,this._localStreamMap={}}(c.prototype=Object.create(b.Base.MediaInterfaceService.prototype)).start=function(a){return!1===this._isStarted&&(this._audioInputVolumeController=new b.Base.AudioInputVolumeController),b.Base.MediaInterfaceService.prototype.start.call(this,a)},c.prototype.stop=function(c){return this._audioInputVolumeController&&(this._audioInputVolumeController.stop(),this._audioInputVolumeController=a),this._localStreamMap={},b.Base.MediaInterfaceService.prototype.stop.call(this,c)},c.prototype._buildDevice=function(a){return new b.Base.AudioDevice(a.deviceId,a.groupId,a.label,b.Base.MediaTypes.AUDIO_INPUT)},c.prototype.localMediaStreamCreated=function(a,b){a&&b&&0<b.getAudioTracks().length&&(this._localStreamMap[a]=b)},c.prototype.setVolume=function(a){this._audioInputVolumeController.setVolume(a)},c.prototype.getVolume=function(){return this._audioInputVolumeController.getVolume()},c.prototype.getAudioInputVolumeController=function(){return this._audioInputVolumeController},c.prototype.replaceLocalMediaStream=function(a,b){this._localStreamMap[a]=b},c.prototype.removeLocalMediaStream=function(a){delete this._localStreamMap[a]},c.prototype.getLocalMediaStream=function(a){return this._localStreamMap[a]},b.Base.AudioInputInterfaceService=c}(AvayaClientServices),function(a){"use strict";function c(a,b){this._inputInterface=a,this._outputInterface=b,this._localStreamMap={}}(c.prototype=Object.create(a.Base.MediaInterface.prototype)).getInputInterface=function(){return this._inputInterface},c.prototype.start=function(){return b.when(this._inputInterface.start(),this._outputInterface.start())},c.prototype.stop=function(){return b.when(this._inputInterface.stop(),this._outputInterface.stop())},c.prototype.getOutputInterface=function(){return this._outputInterface},c.prototype.getLocalMediaStream=function(a){if(this._inputInterface.getMediaAccessCapability().isAllowed)return this._inputInterface._audioInputInterfaceService.getLocalMediaStream(a);throw new Error("AudioInterface.getLocalMediaStream(): Capability not allowed")},c.prototype.getRemoteMediaStream=function(a){if(this._outputInterface.getMediaAccessCapability().isAllowed)return this._outputInterface._audioOutputInterfaceService.getRemoteMediaStream(a);throw new Error("AudioInterface.getRemoteMediaStream(): Capability not allowed")},a.Base.AudioInterface=c}(AvayaClientServices),function(a){"use strict";function b(b){this._audioOutputInterfaceService=b,a.Base.MediaInterface.call(this,b),this.addOnSelectedDeviceChangedCallback(b.onSelectedDeviceChanged.bind(b))}(b.prototype=Object.create(a.Base.MediaInterface.prototype)).mute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.mute: Capability not allowed");this._audioOutputInterfaceService.mute()},b.prototype.unmute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.unmute: Capability not allowed");this._audioOutputInterfaceService.unmute()},b.prototype.isMuted=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.isMuted();throw new Error("AudioOutputInterface.isMuted(): Capability not allowed")},b.prototype.setVolume=function(a){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.setVolume(): Capability not allowed");this._audioOutputInterfaceService.setVolume(a)},b.prototype.getVolume=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.getVolume();throw new Error("AudioOutputInterface.getVolume(): Capability not allowed")},b.prototype.addOnGestureRequiredCallback=function(a){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().addOnGestureRequiredCallback(a)},b.prototype.removeOnGestureRequiredCallback=function(a){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().removeOnGestureRequiredCallback(a)},b.prototype._canPickDevices=function(){var b=a.Base.Utils.getBrowserType(),c=[a.Base.BrowserType.CHROME];return!0===a.Base.Utils.includes(b,c)&&!0===a.Base.Utils.hasProperty("audio","setSinkId")},b.prototype.toString=function(){return"Speaker"},a.Base.AudioOutputInterface=b}(AvayaClientServices),function(b){"use strict";function c(){b.Base.MediaInterfaceService.call(this),this._deviceIdentifier=b.Base.MediaTypes.AUDIO_OUTPUT,this._audioOutput=a,this._remoteStreamMap={}}(c.prototype=Object.create(b.Base.MediaInterfaceService.prototype)).start=function(a){return!1===this._isStarted&&(b.Base.Utils.getBrowserType()===b.Base.BrowserType.SAFARI?this._audioOutput=new b.Base.SafariAudioOutput:this._audioOutput=new b.Base.AudioOutput),b.Base.MediaInterfaceService.prototype.start.call(this,a)},c.prototype.stop=function(c){return this._audioOutput&&(this._audioOutput.stop(),this._audioOutput=a),this._remoteStreamMap={},b.Base.MediaInterfaceService.prototype.stop.call(this,c)},c.prototype._buildDevice=function(a){return new b.Base.AudioDevice(a.deviceId,a.groupId,a.label,b.Base.MediaTypes.AUDIO_OUTPUT)},c.prototype.mute=function(){this._audioOutput.mute()},c.prototype.unmute=function(){this._audioOutput.unmute()},c.prototype.isMuted=function(){return this._audioOutput.isMuted()},c.prototype.setVolume=function(a){this._audioOutput.setVolume(a)},c.prototype.getVolume=function(){return this._audioOutput.getVolume()},c.prototype.onSelectedDeviceChanged=function(a,b){this._audioOutput.onSelectedDeviceChanged(b)},c.prototype.getAudioOutput=function(){return this._audioOutput},c.prototype.getRemoteMediaStream=function(a){return this._remoteStreamMap[a]},c.prototype.setRemoteMediaStream=function(a,b){this._remoteStreamMap[a]=b},c.prototype.removeRemoteMediaStream=function(a){delete this._remoteStreamMap[a]},b.Base.AudioOutputInterfaceService=c}(AvayaClientServices),function(c){"use strict";function d(){c.Base.Observable.call(this),this._config=a,this._credentialProvider=a,this._csrfSupport=!1,this._protocolTypes={secure:"",nonSecure:""}}(d.prototype=Object.create(c.Base.Observable.prototype)).start=function(a,c,d,e,f,g){var h=b.Deferred();return this._config=a,this._credentialProvider=c,this.onOpen(),h.resolve(),h.promise()},d.prototype.send=function(a,b,c){},d.prototype.getBufferedAmount=function(){return 0},d.prototype._onCredentialsRequired=function(a){},d.prototype.onInvalidCredentialsProvided=function(a,b){},d.prototype._getServerURL=function(a){var b="";return a&&c.Base.Utils.isDefined(a.url)?b=a.url:this._config&&(b+=(this._config.isSecure?this._protocolTypes.secure:this._protocolTypes.nonSecure)+"://",this._config.credentials&&(b+=this._config.credentials+"@"),b+=this._config.hostName,this._config.port&&(b+=":"+this._config.port)),a&&a.urlSuffix?b+=a.urlSuffix:this._config&&this._config.path&&(b+=this._config.path),a&&a.query?b+="?"+a.query:this._config&&this._config.query&&(b+="?"+this._config.query),b},d.prototype.run=function(a){},d.prototype.close=function(){this.onClose()},d.prototype.onOpen=function(){},d.prototype.onClose=function(){},d.prototype.onMessage=function(a){},d.prototype.onError=function(a){},d.prototype.onConnectionUnavailable=function(){},d.prototype.setCSRFSupport=function(a){this._csrfSupport=!!a},d.prototype._addCSRFSupport=function(a){return c.Base.Utils.isDefined(a)&&(c.Base.Utils.isDefined(a.headers)||(a.headers={}),a.headers["X-Avaya-Requested-With"]="XMLHttpRequest"),a},d.prototype.setTriggerUnauthorizedError=function(){},c.Base.AbstractNetworkProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d,e){function f(a,b){a.onOpen=function(a){b.onOpen(a)},a.onMessage=function(a,d){var e={};e.receivedTime=(new Date).getTime(),b.wsConnectionId&&(e.wsConnectionId=b.wsConnectionId),setTimeout(function(){try{var f=a.data||a,g=!!this._failoverPingData&&"wsIsPingMessage"in this._failoverPingData&&this._failoverPingData.wsIsPingMessage(f);a.type===c.Base.ProvidersEventTypes.PING||(c.Base.Utils.isDefined(this._failoverPingData)&&this._failoverPingData.wsKeepAliveEnabled&&(this._failoverPingData.wsIsPongMessage(f)||g)?g?b._log(c.Base.Logger.debug,"Received ping request."):b._log(c.Base.Logger.debug,"Received pong response."):b._networkLogger.logRecvMessage(a,d,e))}catch(f){b._log(c.Base.Logger.error,"Error caught while logging. ",f)}b.onMessage(a,d)}.bind(this))},a.onClose=function(a){b.onClose(a)},a.onError=function(a){b.onError(a)},a.on(c.Base.NetworkErrorCodes.HTTP_REDIRECTION,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_MOVED_PERMANENTLY,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_FOUND,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_SEE_OTHER,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_NOT_MODIFIED,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_USE_PROXY,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_TEMPORARY_REDIRECT,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_PERMANENT_REDIRECT,b._handleRedirect.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_BAD_REQUEST,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_UNAUTHORIZED,b._handleUnauthorized.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_PAYMENT_REQUIRED,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_FORBIDDEN,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_NOT_FOUND,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_METHOD_NOT_ALLOWED,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_NOT_ACCEPTABLE,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_PROXY_AUTHENTICATION_REQUIRED,b._handleUnauthorized.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_REQUEST_TIMEOUT,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_CONFLICT,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_GONE,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_LENGTH_REQUIRED,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_PRECONDITION_FAILED,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_PAYLOAD_TO_LARGE,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_URI_TOO_LONG,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_UNSUPPORTED_MEDIA_TYPE,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR,b._handleNetworkError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_INTERNAL_SERVER_ERROR,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_NOT_IMPLEMENTED,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_BAD_GATEWAY,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_SERVICE_UNAVAILABLE,b._retry.bind(b)),a.on(c.Base.NetworkErrorCodes.HTTP_GATEWAY_TIMEOUT,b._handleError.bind(b)),a.on(c.Base.NetworkErrorCodes.WEBSOCKET_UNAUTHORIZED,b._handleUnauthorized.bind(b))}c.Base.AbstractNetworkProvider.apply(this),this._parentLoggerTag=e,this._networkLogger=new c.Base.NetworkLogger(e),this._communicationAdapter={},this._mainProvider=b,this._fallbackProvider=d,this._config=a,this._credentialProvider=a,this._failoverCallback=a,this._reconnectionMainProvider=!1,this._unauthorizedCount=0,this._closing=!1,this._failoverPromise=a,this._onCredentialsRequired=function(){},this.onConnectionUnavailable=function(){!this._closing&&this._failoverCallback&&this._fallbackProvider&&!this._failoverPromise?(this._log(c.Base.Logger.debug,"onConnectionUnavailable Callback - Reconnection process start with fallback provider","Reconnection main provider: "+this._reconnectionMainProvider),this._reconnectionMainProvider?this._fallbackProvider&&(this._reconnectionMainProvider=!1,this._communicationAdapter=this._fallbackProvider,this._executeFailoverCallback()):(this._reconnectionMainProvider=!0,this._communicationAdapter=this._mainProvider,this._executeFailoverCallback().then(function(){this._reconnectionMainProvider=!1}.bind(this)))):this._closing||!this._failoverCallback||this._failoverPromise||(this._log(c.Base.Logger.debug,"onConnectionUnavailable Callback - Reconnection process start without fallback provider"),this._executeFailoverCallback())}.bind(this),f(this._mainProvider,this),this._mainProvider.onConnectionUnavailable=this.onConnectionUnavailable,this._fallbackProvider&&(f(this._fallbackProvider,this),this._fallbackProvider.onConnectionUnavailable=this.onConnectionUnavailable),this._communicationAdapter=this._mainProvider}(d.prototype=Object.create(c.Base.AbstractNetworkProvider.prototype)).start=function(d,e,f,g,h,i){return this._failoverCallback=h,this._config=d,this._credentialProvider=e,this._closing=!1,this._failoverPromise&&"pending"!==this._failoverPromise.state()&&(this._failoverPromise=a),d={message:a,options:f||{}},this._credentialProvider&&this._onCredentialsRequired(d),g=g||new c.Base.NetworkRequestRetryHelper(function(){return this._closing?b.Deferred().reject().promise():this.start(this._config,e,f,g,h,i)}.bind(this)),this._communicationAdapter.start(this._config,this._credentialProvider,d.options,g,i)},d.prototype.send=function(a,b,d,e){return e||this._networkLogger.logSendMessage(a,b,this._communicationAdapter),e={message:a,options:b},this._credentialProvider&&this._onCredentialsRequired(e,this._credentialProvider),d=d||new c.Base.NetworkRequestRetryHelper(function(){return this.send(a,b,d)}.bind(this)),this._communicationAdapter.send(e.message,e.options,d)},d.prototype.close=function(a){return this._closing=!0,a=a||new c.Base.NetworkRequestRetryHelper(function(){return this.close()}.bind(this)),this._communicationAdapter.close(a)},d.prototype._handleUnauthorized=function(b){var d=b.getDeferred(),e=new c.Config.InvalidCredentialsEvent(this._unauthorizedCount,function(e){e!==a&&(this._credentialProvider=e),b.getRequestRetryHelper().getRetryCallback()().then(function(a){this._unauthorizedCount=0,d.resolve(a),this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this),function(a){d.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_UNAUTHORIZED,a))})}.bind(this),function(){d.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED))}.bind(this));this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[e]),this._unauthorizedCount++,this._credentialProvider?(this._log(c.Base.Logger.warn," invalid credentials event"),this._credentialProvider._onInvalidCredentialsProvidedCallbacks.fire(e)):d.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_UNAUTHORIZED))},d.prototype._handleRedirect=function(a){c.Base.Utils.isDefined(a.getRetryAfter())?(this._log(c.Base.Logger.warn,"Request failed. Retrying after "+a.getRetryAfter()),this._retry(a)):this._handleError(a)},d.prototype._handleError=function(a){var b=new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR,a);this._log(c.Base.Logger.error,"Network error occurred. Status: "+a.getStatus()),a.getDeferred().reject(b),this.onError(b)},d.prototype._handleNetworkError=function(a){var b=new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR,a);this._log(c.Base.Logger.error,"Network error occurred. Status: "+a.getStatus()),a.getDeferred().reject(b),this.onError(b)},d.prototype.registerBlackList=function(a){this._networkLogger.registerBlackList(a),this._mainProvider&&"function"==typeof this._mainProvider.registerBlackList&&this._mainProvider.registerBlackList(a),this._fallbackProvider&&"function"==typeof this._fallbackProvider.registerBlackList&&this._fallbackProvider.registerBlackList(a)},d.prototype._retry=function(a){a.getRequestRetryHelper().incrementCounter();var b=a.getDeferred(),d=a.getRetryAfter(),e=a.getRequestRetryHelper().getRetryCounter();d&&e<this._config.maxConnectionErrorCount?(setTimeout(function(){a.getRequestRetryHelper().getRetryCallback()().then(b.resolve,b.reject)},d),b.notify(c.Base.NetworkProviderEvents.RETRYING)):this._handleError(a)},d.prototype.isOpened=function(){return this._communicationAdapter.isOpened()},d.prototype.getBufferedAmount=function(){return this._communicationAdapter.getBufferedAmount()},d.prototype.run=function(a){return this._communicationAdapter.run(a)},d.prototype.stopMonitorFallback=function(){this._fallbackProvider&&(this._fallbackProvider.close(),this._fallbackProvider=a),this._failoverCallback=a},d.prototype._executeFailoverCallback=function(){return this._closing||this._failoverPromise||"function"!=typeof this._failoverCallback||(this._failoverPromise=this._failoverCallback().always(function(){this._failoverPromise=a}.bind(this))),this._failoverPromise},d.prototype._log=function(b){var d=Array.prototype.slice.call(arguments,1);d.unshift(this._parentLoggerTag),b.call(a,c.Base.LoggerTags.NETWORK_PROVIDER,d)},d.prototype.disableNetworkLogging=function(){this._networkLogger.logSendMessage=function(){},this._networkLogger.logRecvMessage=function(){}},d.prototype.disableOptionsLogging=function(a){this._networkLogger.disableOptionsLogging(a)},d.prototype.setCSRFSupport=function(a){this._mainProvider.setCSRFSupport(a),this._fallbackProvider&&this._fallbackProvider.setCSRFSupport(a)},d.prototype.setHandleWebSocketUnauthorized=function(a){this._mainProvider.setTriggerUnauthorizedError(!!a),this._fallbackProvider&&this._fallbackProvider.setTriggerUnauthorizedError(!!a)},c.Base.NetworkProvider=d}(AvayaClientServices),function(a){"use strict";function c(){var c;this.startPolling=function(b,d,e,f){c=setInterval(function(){a.Base.Logger.info(a.Base.LoggerTags.REST_NETWORK_PROVIDER,"polling "+b),this._poll(b,e,f,function(a){this.onMessage({data:a})}.bind(this),function(a){this.onError(a)}.bind(this))}.bind(this),d)},this.stopPolling=function(){clearInterval(c)},this._poll=function(c,d,e,f,g){var h,c={type:"GET",url:c,dataType:"text",data:b.param(d),headers:{}};return this._csrfSupport&&(c=this._addCSRFSupport(c)),a.Base.Utils.isDefined(e)&&(e.crossDomain&&!0===e.crossDomain&&(c.xhrFields={withCredentials:!0},c.crossDomain=!0),d=[a.Config.Authentication.Scheme.BASIC,a.Config.Authentication.Scheme.BEARER],e.authentication&&a.Base.Utils.includes(e.authentication.type,d)&&(h=e.authentication.type===a.Config.Authentication.Scheme.BASIC?a.Config.Authentication.Header.basic(e.authentication.username,e.authentication.password):(d=e.authentication.bearer||a.Config.Authentication.TokenType.BEARER,
a.Config.Authentication.Header.bearer(d,e.authentication.token)),c.beforeSend=function(a){a.setRequestHeader("Authorization",h)})),b.ajax(c).then(f,g)}}a.Providers=a.Providers||{},c.prototype=Object.create(a.Base.AbstractNetworkProvider.prototype),a.Base.PollingRESTProvider=c}(AvayaClientServices),function(c){"use strict";function d(){c.Base.AbstractNetworkProvider.call(this),this.type=c.Base.ProviderTypes.REST_PROVIDER,this._xhrPool=[],this._protocolTypes={secure:"https",nonSecure:"http"}}(d.prototype=Object.create(c.Base.AbstractNetworkProvider.prototype)).defaultOptions={url:a,sendType:"POST",timeout:3e4,urlSuffix:"",dataType:"text",processData:!0},d.prototype.start=function(a,b,d,e){return c.Base.AbstractNetworkProvider.prototype.start.call(this,a.restConfig,b,d,e)},d.prototype.send=function(a,d,e){var f,g=b.extend({},this.defaultOptions,d),h={url:this._getServerURL(g),type:g.sendType,timeout:g.timeout,dataType:g.dataType,jsonp:!1,headers:g.headers,processData:g.processData,beforeSend:function(a){a.withCredentials=!0,this._xhrPool.push(a),f=a}.bind(this)};g.binaryProgressCallback&&(h.binaryProgressCallback=g.binaryProgressCallback),c.Base.Utils.isDefined(d.requestId)&&(h.requestId=d.requestId),g.keepAliveCallback&&(h.keepAliveCallback=g.keepAliveCallback),g.responseType&&(h.responseType=g.responseType),a&&(h.data=a),g.crossDomain&&!0===g.crossDomain&&(h.crossDomain=!0),c.Base.Utils.isDefined(g.async)&&!0!==g.async||(h.xhrFields={withCredentials:!0}),c.Base.Utils.isDefined(g.contentType)&&(h.contentType=g.contentType),this._csrfSupport&&(h=this._addCSRFSupport(h));var i,a=[c.Config.Authentication.Scheme.BASIC,c.Config.Authentication.Scheme.BEARER];return g.authentication&&c.Base.Utils.includes(g.authentication.type,a)&&(i=g.authentication.type===c.Config.Authentication.Scheme.BASIC?c.Config.Authentication.Header.basic(g.authentication.username,g.authentication.password):(a=g.authentication.bearer||c.Config.Authentication.TokenType.BEARER,c.Config.Authentication.Header.bearer(a,g.authentication.token)),h.beforeSend=function(a){a.withCredentials=!0,a.setRequestHeader("Authorization",i),this._xhrPool.push(a),f=a}.bind(this)),g.cancel&&(h.cancel=function(){f.abort(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_CANCELED))}),c.Base.Utils.isDefined(g.async)&&!1===g.async?(h.async=!1,this._sendSync(h)):this._sendAsync(h,e)},d.prototype._sendAsync=function(a,d){var e=b.Deferred();return b.ajax(a).then(function(b,c,d){this._ajaxOnSuccess(b,c,d,e,a)}.bind(this),function(a,b,f){0===a.status&&(a.status=c.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR),this._ajaxOnError(a,b,f,e,d)}.bind(this)),e.promise()},d.prototype._sendSync=function(a){var d=b.Deferred();return a.success=function(a,b,c){this._ajaxOnSuccess(a,b,c,d)}.bind(this),a.error=function(a,b,e){0===a.status&&(a.status=c.Base.NetworkErrorCodes.HTTP_NETWORK_ERROR),this._ajaxOnError(a,b,e,d)}.bind(this),b.ajax(a),d.promise()},d.prototype._ajaxOnSuccess=function(a,b,c,d){return this._removeXhrFromPool(c),this.onMessage(a,c),d.resolve(a,c),a},d.prototype._ajaxOnError=function(b,d,e,f,g){return g=new c.Base.NetworkErrorEvent(g,f,b.status,b.responseText,b.getResponseHeader("Retry-After")),this.hasListeners(b.status)?this.trigger(b.status,[g]):(this.onError(d),d=new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR,new c.Base.NetworkErrorEvent(a,a,b.status,b.responseText)),f.reject(d,b)),this._removeXhrFromPool(b),b},d.prototype.close=function(){return this._xhrPool.forEach(function(a){a.abort()}),this._xhrPool=[],this.onClose(),b.Deferred().resolve().promise()},d.prototype.abort=function(){this._xhrPool.forEach(function(a){a.abort()}),this._xhrPool=[]},d.prototype._removeXhrFromPool=function(a){-1<this._xhrPool.indexOf(a)&&this._xhrPool.splice(this._xhrPool.indexOf(a),1)},c.Base.RESTProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d){function e(a,b){for(var d in a.onOpen=function(a){b.onOpen(a)},a.onMessage=function(a,d){a&&a.type===c.Base.ProvidersEventTypes.PING&&b._keepAlive(),b.onMessage(a,d)},a.onClose=function(a){b.onClose(a)},a.onError=function(a){b.onError(a)},a.onConnectionUnavailable=function(a){b.onConnectionUnavailable(a)},c.Base.NetworkErrorCodes)c.Base.NetworkErrorCodes.hasOwnProperty(d)&&a.on(c.Base.NetworkErrorCodes[d],b._triggerErrors.bind(b))}c.Base.AbstractNetworkProvider.apply(this),this.type=c.Base.ProviderTypes.SSE_PROVIDER,this._restProvider=b,this._sseProvider=d,this._onCredentialsRequired=function(){},e(this._restProvider,this),e(this._sseProvider,this),this._config={},this._credentialProvider={},this._keepAliveTimeout=a,this._failoverPingData=a}(d.prototype=Object.create(c.Base.AbstractNetworkProvider.prototype)).onConnectionUnavailable=function(){},d.prototype.start=function(c,d,e,f,g){return this._config=c,this._credentialProvider=d,this._failoverPingData=g,g={message:a,options:e},this._credentialProvider&&this._onCredentialsRequired(g),e=this._sseProvider.start(this._config,this._credentialProvider,g.options,f),f=this._restProvider.start(this._config,this._credentialProvider,g.options,f),b.when(e,f).done(function(){this._keepAlive()}.bind(this)).fail(function(){this.close(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this))},d.prototype.send=function(a,b,c){return b={message:a,options:b},this._credentialProvider&&this._onCredentialsRequired(b),this._restProvider.send(b.message,b.options,c)},d.prototype.close=function(){return b.when(this._restProvider.close(),this._sseProvider.close())},d.prototype.isOpened=function(){return this._sseProvider.isOpened()},d.prototype._triggerErrors=function(a){this.trigger(a._status,[a])},d.prototype._keepAlive=function(){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._failoverPingData&&this._failoverPingData.ssePingInterval&&(this._keepAliveTimeout=setTimeout(function(){this.close(),clearTimeout(this._keepAliveTimeout),this.onConnectionUnavailable()}.bind(this),this._failoverPingData.ssePingInterval))},c.Base.SSEIntegrationProvider=d}(AvayaClientServices),function(c){"use strict";function d(b){c.Base.AbstractNetworkProvider.apply(this),this._stream=a,this._isOpened=!1,this._isShutdown=!1,this._eventTypes=b||[],this._protocolTypes={secure:"https",nonSecure:"http"}}(d.prototype=Object.create(c.Base.AbstractNetworkProvider.prototype)).start=function(a,c,d){var e=b.Deferred();return this._isOpened?(this.onOpen(),e.resolve()):(this._maxConnectionErrorCount=a.maxConnectionErrorCount,this._config=a.sseConfig,this._isShutdown=!1,this._credentialProvider=c,this._createStream(d,e)),e.promise()},d.prototype.close=function(){this._isShutdown=!0,this._stream&&(this._stream.close(),this._stream=a),this._isOpened?this._isOpened=!1:this.onClose()},d.prototype.isOpened=function(){return this._isOpened&&1===this._stream.readyState},d.prototype._createStream=function(b,d){this._isOpening=!0,this._stream=new EventSource(this._getServerURL(b),{withCredentials:!0}),this._stream.onopen=function(){this._isOpening=!1,this._isShutdown?(this._stream.close(),d.reject()):(this._isOpened=!0,this.onOpen(),d.resolve())}.bind(this),this._stream.onerror=function(b){(c.Base.Utils.isUndefined(b.readyState)||b.readyState===EventSource.CLOSED&&!this._isOpening)&&(this._isOpened=!1,this._stream.close(),this._stream=a,this.onClose()),this.onError(b),d.reject()}.bind(this);for(var e=0;e<this._eventTypes.length;e++)this._stream.addEventListener(this._eventTypes[e],function(a){this.onMessage(a)}.bind(this))},c.Base.SSEProvider=d}(AvayaClientServices),function(c){"use strict";function d(){c.Base.AbstractNetworkProvider.apply(this),this.type=c.Base.ProviderTypes.WEB_SOCKET_PROVIDER,this._socket=a,this._isOpened=!1,this._isShutdown=!1,this._isOnConnectionUnavailableShutdown=!1,this._triggerUnauthorizedError=!0,this._protocolTypes={secure:"wss",nonSecure:"ws"},this._failoverPingData=a,this._keepAliveTimeout=a,this._keepAliveAnswerWaitingTimeout=a}(d.prototype=Object.create(c.Base.AbstractNetworkProvider.prototype)).onConnectionUnavailable=function(){},d.prototype.start=function(c,d,e,f,g,h){var i=b.Deferred();return this._failoverPingData=g,this._isOpened?(i.resolve(),this.onOpen()):(this._config=c.webSocketConfig,this._maxConnectionErrorCount=c.maxConnectionErrorCount,this._isShutdown=!1,this._isOnConnectionUnavailableShutdown=!1,this._credentialProvider=d,window.WebSocket===a?(i.reject(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))):this._createSocket(e,f,h,i)),i.promise()},d.prototype.send=function(a,c,d){var e=b.Deferred();return this.isOpened()?(this._socket.send(a),e.resolve()):e.reject("Socket is not opened!"),e.promise()},d.prototype.close=function(){this._isShutdown=!0,this._isOpened&&(this._stopKeepAlive(),this._socket.onmessage=a,this._socket.onclose=a,this._socket.onerror=a,c.Base.Logger.debug(c.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Closing WebSocket by local request"),this._socket.close(),this._isOpened=!1),this.onClose(),this._socket=a},d.prototype.isOpened=function(){return this._isOpened&&1===this._socket.readyState},d.prototype.getBufferedAmount=function(){return this._socket?this._socket.bufferedAmount:0},d.prototype._createSocket=function(b,d,e,f){this._isOpening=!0;var g=b?b.wsSecureProtocolData:a;this._socket=new WebSocket(this._getServerURL(b),g),this._socket.binaryType="arraybuffer",this._socket.onmessage=e||function(a){this.checkForPong(a.data),this.onMessage(a)}.bind(this),this._socket.onopen=function(){this._isOpening=!1,this._isShutdown?this._socket&&this._socket.close():(this._isOpened=!0,f.resolve(),c.Base.Utils.isDefined(this._failoverPingData)&&this._failoverPingData.wsKeepAliveEnabled&&this._keepAlive(),this.onOpen())}.bind(this),this._socket.onclose=function(b){this._stopKeepAlive();var e,g=!1;b.code!==c.Base.NetworkErrorCodes.WEBSOCKET_UNAUTHORIZED||this._isOnConnectionUnavailableShutdown||!this._isOpened&&this._triggerUnauthorizedError?b.code!==c.Base.NetworkErrorCodes.WEBSOCKET_CLOSE_NORMAL&&!this._isOnConnectionUnavailableShutdown&&this.hasListeners(b.code)&&(e=new c.Base.NetworkErrorEvent(d,f,b.code),this.trigger(b.code,[e])):(g=!0,setTimeout(function(){this.onConnectionUnavailable()}.bind(this),0)),this._isOpening||(f.reject(),this._isOpened=!1,this._socket=a,this.onClose()),this._isOpened||this._isShutdown||(f.reject(),g||setTimeout(function(){this.onConnectionUnavailable()}.bind(this)))}.bind(this),this._socket.onerror=function(a){f.reject(),this.onError(a),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this)},d.prototype.checkForPong=function(b){var d=!1;return c.Base.Utils.isDefined(this._failoverPingData)&&((d=!(!this._failoverPingData.wsKeepAliveEnabled||!this._failoverPingData.wsIsPongMessage(b))||d)||this._failoverPingData.allowAnyPong)&&c.Base.Utils.isDefined(this._keepAliveAnswerWaitingTimeout)&&(clearTimeout(this._keepAliveAnswerWaitingTimeout),this._keepAliveAnswerWaitingTimeout=a,this._keepAlive()),d},d.prototype._keepAlive=function(){c.Base.Utils.isDefined(this._failoverPingData)&&c.Base.Utils.isDefined(this._failoverPingData.wsPingInterval)&&(this._keepAliveTimeout=setTimeout(function(){var a=this._failoverPingData.wsGeneratePingMessage(),b=this.getBufferedAmount();this.send(a),b=b<1024?function(){this._isOnConnectionUnavailableShutdown=!0,c.Base.Logger.debug(c.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Closing WebSocket due to failed ping"),this.close(),setTimeout(function(){this.onConnectionUnavailable()}.bind(this))}.bind(this):(c.Base.Logger.debug(c.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,"Disabling ping timeout due to the WebSocket already having a buffer of data to send.  Prior buffer: "+b),function(){}),this._keepAliveAnswerWaitingTimeout=setTimeout(b,this._failoverPingData.keepAliveAnswerWaitingTime)}.bind(this),this._failoverPingData.wsPingInterval))},d.prototype._stopKeepAlive=function(){c.Base.Utils.isDefined(this._keepAliveTimeout)&&(clearTimeout(this._keepAliveTimeout),this._keepAliveTimeout=a),c.Base.Utils.isDefined(this._keepAliveAnswerWaitingTimeout)&&(clearTimeout(this._keepAliveAnswerWaitingTimeout),this._keepAliveAnswerWaitingTimeout=a)},d.prototype.setTriggerUnauthorizedError=function(a){this._triggerUnauthorizedError=!!a},c.Base.WebSocketProvider=d}(AvayaClientServices),function(a){"use strict";function b(){this.defaultMessage="One or more elements in provided array are not compatible with required type."}(b.prototype=Object.create(a.Base.Validators.BaseValidator.prototype)).validate=function(a,b,c){var d=a.filter(function(a){return typeof a===b.expected||"object"==typeof a&&a instanceof b.expected}).length===a.length;return this._processCondition(d,a,b,c)},a.Base.Validators.ArrayElementTypeValidator=b}(AvayaClientServices),!function(a){"use strict";var b={resolution1080p:new a.Base.VideoResolutionDetails(1920,1080,1792,9999),resolution720p:new a.Base.VideoResolutionDetails(1280,720,1024,1792),resolution480p:new a.Base.VideoResolutionDetails(848,480,640,1024),resolution360p:new a.Base.VideoResolutionDetails(640,360,384,640),resolution240p:new a.Base.VideoResolutionDetails(416,240,256,384),resolution180p:new a.Base.VideoResolutionDetails(320,180,128,256)};a.Base.VideoResolution=b}(AvayaClientServices),function(a){"use strict";function c(b,c,d){a.Providers.Interfaces.AbstractProvider.call(this),this._acsNetworkProvider=b,this._contactsConverter=c,this._requestBuilder=d,this._state=a.Providers.ACS.ACSProviderStates.STOPPED,this._allowedCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._deniedCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._contactsCapability=this._deniedCapability,this._resolveContactsCapability=this._deniedCapability,this._terminalCapability=this._deniedCapability,this._conferenceSearchCapability=this._deniedCapability,this._blackListedWords=["userEmail","contactIdentifier","contactUrl","surName","givenName","displayName","asciiGivenName","asciiSurName","asciiDisplayName","isBuddy","favourite","notes","instantConnection","videoCapable","phoneNumberList","emailAddresses","preferredLanguage","type","rank","updatedTimestamp","alias","imaddresses","company","location","streetAddress","city","state","country","postalCode","manager","department","workRoomNo","value","Authorization","editable","isPrimary","searchCriteria","maxResults","data","contacts","username","self"]}(c.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).getProviderType=function(){return"ACS"},c.prototype.start=function(c,d){var e=b.Deferred();return this._changeState(a.Providers.ACS.ACSProviderStates.STARTING).then(function(){this._acsNetworkProvider.registerBlackList(this._blackListedWords),this._acsNetworkProvider.on(a.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(a.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._acsNetworkProvider.on(a.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(a.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._acsNetworkProvider.on(a.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.trigger(a.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this)),this._acsNetworkProvider.on(a.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this.trigger(a.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this)),d.addOnContactsServiceAvailableCallback(function(){this.recalculateCapabilities()}.bind(this)),d.addOnContactsServiceUnavailableCallback(function(){this.recalculateCapabilities()}.bind(this)),this._acsNetworkProvider.start(c.acsConfiguration,d).then(function(){this._changeState(a.Providers.ACS.ACSProviderStates.STARTED).then(function(){this.recalculateCapabilities(),this._acsNetworkProvider.on("acs_availability_changed",this.recalculateCapabilities.bind(this)),e.resolve()}.bind(this),function(a){e.reject(a)})}.bind(this),function(b){a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to start ACSNetworkProvider",b),e.reject(b)})}.bind(this),function(a){e.reject(a)}),e.promise()},c.prototype.stop=function(){var c=b.Deferred();return this._changeState(a.Providers.ACS.ACSProviderStates.STOPPING).always(function(){this._acsNetworkProvider.stopIfNoSubscriptions().then(function(){this._changeState(a.Providers.ACS.ACSProviderStates.STOPPED),c.resolve()}.bind(this),function(b){a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"acsNetworkProvider stop if no subscriptions was failed",b),c.reject(b)})}.bind(this)),c.promise().always(function(){this.recalculateCapabilities(),this._removeListeners()}.bind(this))},c.prototype._changeState=function(c){return c!==this._state?(this._state=c,this._handleStateChange(c).fail(function(b){a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to change state to "+c,b)})):b.Deferred().resolve().promise()},c.prototype._handleStateChange=function(a){return b.Deferred().resolve().promise()},c.prototype.recalculateCapabilities=function(){var b=this._deniedCapability,c=this._deniedCapability,d=this._deniedCapability,e=this._deniedCapability,f=this._acsNetworkProvider.getResources();this._acsNetworkProvider.isAcsAvailable()&&(f.capabilities&&0<=f.capabilities.indexOf("contacts")&&(b=this._allowedCapability,!0===f.v2MediaType&&(c=this._allowedCapability)),f.contactSearchCapabilities&&0<=f.contactSearchCapabilities.indexOf("terminal")&&(d=this._allowedCapability),f.resources&&f.resources.contacts&&f.resources.contacts.GET&&f.resources.contacts.GET.searchIViewContacts&&f.resources.contacts.GET.searchIViewContacts.href&&(e=this._allowedCapability)),this._contactsCapability===b&&this._resolveContactsCapability===c&&this._terminalCapability===d&&this._conferenceSearchCapability===e||(this._contactsCapability=b,this._resolveContactsCapability=c,this._terminalCapability=d,this._conferenceSearchCapability=e,this.trigger(a.Providers.Interfaces.ContactsProviderCallbackIds.CAPABILITIES_CHANGED))},c.prototype.getMaxSearchResultsTotal=function(){return this._acsNetworkProvider.getMaxSearchResultsTotal()},a.Providers.ACS.ACSBaseProviderV1=c}(AvayaClientServices),function(c){"use strict";function d(){c.Providers.Interfaces.ContactsProvider.call(this),this._providers={},this._selectedProvider=a,this._userConfig={}}(d.prototype=b.extend({},c.Providers.Interfaces.ContactsProvider.prototype)).registerACSContactsProvider=function(a,b){b.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),b.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),b.on(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.trigger(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this)),b.on(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this.trigger(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this)),this._providers[a]=b},d.prototype.start=function(a,c){b.isEmptyObject(a)||this._userConfig===a||(this._userConfig=a);var d=this._determineServerVersion();return this._selectedProvider=this._providers[d],this._selectedProvider.start(a,c)},d.prototype._determineServerVersion=function(){return 1},d.prototype.getProviderType=function(){return this._selectedProvider.getProviderType()},d.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():b.Deferred().resolve().promise()},d.prototype.createContactForAdd=function(){return this._selectedProvider.createContactForAdd()},d.prototype.addContact=function(a){return this._selectedProvider.addContact(a)},d.prototype.updateContact=function(a){return this._selectedProvider.updateContact(a)},d.prototype.deleteContact=function(a){return this._selectedProvider.deleteContact(a)},d.prototype.retrieveAllContacts=function(){return this._selectedProvider.retrieveAllContacts()},d.prototype.getContactsChanges=function(){return this._selectedProvider.getContactsChanges()},d.prototype.getAddContactCapability=function(){return this._selectedProvider.getAddContactCapability()},d.prototype.getUpdateContactCapability=function(){return this._selectedProvider.getUpdateContactCapability()},d.prototype.getDeleteContactCapability=function(){return this._selectedProvider.getDeleteContactCapability()},d.prototype.getExtendedContactDetailsCapability=function(){return this._selectedProvider.getExtendedContactDetailsCapability()},d.prototype.addOnContactAddedCallback=function(a){return this._selectedProvider.addOnContactAddedCallback(a)},d.prototype.removeOnContactAddedCallback=function(a){return this._selectedProvider.removeOnContactAddedCallback(a)},d.prototype.addOnContactUpdatedCallback=function(a){return this._selectedProvider.addOnContactUpdatedCallback(a)},d.prototype.removeOnContactUpdatedCallback=function(a){return this._selectedProvider.removeOnContactUpdatedCallback(a)},d.prototype.addOnContactDeletedCallback=function(a){return this._selectedProvider.addOnContactDeletedCallback(a)},d.prototype.removeOnContactDeletedCallback=function(a){return this._selectedProvider.removeOnContactDeletedCallback(a)},d.prototype.on=function(a,b){return this._selectedProvider?this._selectedProvider.on(a,b):c.Providers.Interfaces.ContactsProvider.prototype.on.call(this,a,b)},d.prototype.off=function(a,b){return this._selectedProvider.off(a,b)},c.Providers.ACS.ACSContactsProvider=d}(AvayaClientServices),function(a){"use strict";function c(b,c,d){a.Providers.Interfaces.ContactsProvider.call(this),a.Providers.ACS.ACSBaseProviderV1.call(this,b,c,d),this._subscribedForNotifications=!1,this._contactsCache=new a.Base.ElementCache,this._contactsCache.on(a.Base.ElementCacheEvents.ELEMENT_ADDED,function(b){b=b.map(function(a){return this._contactsConverter.convertACSContactV1toContact(a)}.bind(this)),this.trigger(a.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_ADDED,[b,this])}.bind(this)),this._contactsCache.on(a.Base.ElementCacheEvents.ELEMENT_UPDATED,function(b){this.trigger(a.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_UPDATED,[this._contactsConverter.convertACSContactV1toContact(b),this])}.bind(this)),this._contactsCache.on(a.Base.ElementCacheEvents.ELEMENT_DELETED,function(b){b=b.map(function(a){return this._contactsConverter.convertACSContactV1toContact(a)}.bind(this)),this.trigger(a.Providers.Interfaces.ContactsProviderCallbackIds.CONTACT_DELETED,[b,this])}.bind(this))}(c.prototype=b.extend({},a.Providers.Interfaces.ContactsProvider.prototype,a.Providers.ACS.ACSBaseProviderV1.prototype)).createContactForAdd=function(){var b=new a.Services.Contacts.EditableContact,c=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);return b.getCustom1()._setWriteCapability(c),b.getCustom2()._setWriteCapability(c),b.getCustom3()._setWriteCapability(c),b.getScopiaUserId()._setWriteCapability(c),b.getScopiaLoginId()._setWriteCapability(c),b},c.prototype.addContact=function(c){var d=this._contactsConverter.convertContactToACSContactV1(c),c=this._requestBuilder.buildAddUpdateContactData(d),d=this._requestBuilder.buildAddContactOptions();return a.Base.Utils.isUndefined(d)?b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.ADD_CONTACT_NOT_AVAILABLE)):this._acsNetworkProvider.send(c,d).then(this._onContactAdded.bind(this))},c.prototype._onContactAdded=function(a){(a=this._contactsConverter.extendAcsContact(a)).id&&a.id.value&&this._contactsCache.addElement(a.id.value,a)},c.prototype.updateContact=function(c){var d=this._contactsCache.getElement(c._uniqueAddressForMatching);return d?(c=this._contactsConverter.mergeContactWithACSContactV1(c,d),d=this._requestBuilder.buildAddUpdateContactData(c),c=this._requestBuilder.buildUpdateContactOptions(),a.Base.Utils.isUndefined(c)?b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.UPDATE_CONTACT_NOT_AVAILABLE)):this._acsNetworkProvider.send(d,c).then(this._onContactUpdated.bind(this))):(a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Can not update contact because its old version is not found in cache"),b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)))},c.prototype._onContactUpdated=function(a){(a=this._contactsConverter.extendAcsContact(a)).id&&a.id.value&&this._contactsCache.updateElement(a.id.value,a)},c.prototype.deleteContact=function(a){var b=this._requestBuilder.buildDeleteContactOptions(a._uniqueAddressForMatching);return this._acsNetworkProvider.send(null,b).then(function(){this._onContactDeleted(a.getUniqueAddressForMatching())}.bind(this))},c.prototype._onContactDeleted=function(a){a&&this._contactsCache.deleteElement(a)},c.prototype.retrieveAllContacts=function(){return this._getContacts().then(function(){this._subscribeForContactChangesNotifications()}.bind(this),function(a){return b.Deferred().reject(a).promise()},function(a){return this._applyContactsToCache(a.contacts,!0),this._contactsConverter.convertACSContactArraytoContactArray(a.contacts)}.bind(this))},c.prototype._subscribeForContactChangesNotifications=function(){var b;this._subscribedForNotifications||(this._subscribedForNotifications=!0,b=this._requestBuilder.buildSubscribeForACSNotifications(a.Providers.ACS.ACSConstants.SVC_GET_CONTACTS),this._acsNetworkProvider.subscribeForNotifications(b,this._onContactChangeNotification.bind(this)).fail(function(b){this._subscribedForNotifications=!1,a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for contact changes notifications",b)}.bind(this)))},c.prototype._unsubscribeFromContactChangesNotifications=function(){var c;return this._subscribedForNotifications?(this._subscribedForNotifications=!1,c=this._requestBuilder.buildUnsubscribeFromACSNotifications(a.Providers.ACS.ACSConstants.SVC_GET_CONTACTS),this._acsNetworkProvider.unsubscribeFromNotifications(c).fail(function(b){this._subscribedForNotifications=!0,a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to unsubscribe from contact changes notifications: "+JSON.stringify(b))}.bind(this))):b.Deferred().resolve().promise()},c.prototype._onContactChangeNotification=function(b){if(this._isContactChangeNotificationValid(b))if(b.action===a.Providers.ACS.ACSContentsActions.DELETE)this._onContactDeleted(b.url);else if(b.action===a.Providers.ACS.ACSContentsActions.REFRESH)this.retrieveAllContacts();else{var c;if(b.action===a.Providers.ACS.ACSContentsActions.ADD)c=this._onContactAdded;else if(b.action===a.Providers.ACS.ACSContentsActions.UPDATE){if(!this._contactsCache.getElement(b.url))return void a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification for unknown contact");c=this._onContactUpdated}b=this._requestBuilder.buildGetContactOptions(b.url),this._acsNetworkProvider.send(null,b).then(c.bind(this),function(b){a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to download contact list updates: "+JSON.stringify(b))})}},c.prototype._isContactChangeNotificationValid=function(b){return b&&b.action&&b.url?""===b.url?(a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification with empty URL"),!1):!!function(){for(var c in a.Providers.ACS.ACSContentsActions)if(a.Providers.ACS.ACSContentsActions.hasOwnProperty(c)&&b.action===a.Providers.ACS.ACSContentsActions[c])return!0;return!1}()||(a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification with unknown or empty type: "+b.action),!1):(a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received notification in unexpected format: "+JSON.stringify(b)),!1)},c.prototype._applyContactsToCache=function(b,c){for(var d=b.length,e=[],f=0;f<d;f++)b[f].id&&b[f].id.value?e.push({elementId:b[f].id.value,element:this._contactsConverter.extendAcsContact(b[f])}):a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received contact does not have id set, ignoring it",b[f]);this._contactsCache.applyElements(e,c)},c.prototype._getContacts=function(){function c(b){a.Base.Logger.error(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to retrieve contacts",b),d.reject(b)}var d=b.Deferred(),e=this._requestBuilder.buildGetContactsOptions();if(a.Base.Utils.isUndefined(e))return d.reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.GET_CONTACTS_NOT_AVAILABLE));var f=function(b){if(!b)return d.resolve();if(d.notify(b),b.hasMoreResults){var g=b.contacts.length-1,h=b.contacts[g].id.value;if(!h)return a.Base.Logger.warn(a.Base.LoggerTags.ACS_CONTACTS_PROVIDER,'Last contact of the partial response to retrieve contacts request does not have "id" property set (required for consequent requests)',b.contacts[g]),d.reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));e=this._requestBuilder.buildGetContactsOptions(h),this._acsNetworkProvider.send(null,e).then(f.bind(this),c)}else d.resolve()};return this._acsNetworkProvider.send(null,e).then(f.bind(this),c),d.promise()},c.prototype.getContactsChanges=function(){},c.prototype.getAddContactCapability=function(){return this._contactsCapability},c.prototype.getUpdateContactCapability=function(){return this._contactsCapability},c.prototype.getDeleteContactCapability=function(){return this._contactsCapability},c.prototype.getExtendedContactDetailsCapability=function(){return this._contactsCapability},c.prototype._handleStateChange=function(c){var d;switch(c){case a.Providers.ACS.ACSProviderStates.STOPPING:d=this._unsubscribeFromContactChangesNotifications();break;case a.Providers.ACS.ACSProviderStates.STOPPED:this._contactsCache.empty(),d=b.Deferred().resolve().promise();break;default:d=b.Deferred().resolve().promise()}return d},a.Providers.ACS.ACSContactsProviderV1=c}(AvayaClientServices),function(c){"use strict";function d(){c.Providers.Interfaces.DirectorySearchProvider.call(this),this._providers={},this._selectedProvider=a,this._userConfig={}}(d.prototype=b.extend({},c.Providers.Interfaces.DirectorySearchProvider.prototype)).registerACSDirectorySearchProvider=function(a,b){this._providers[a]=b},d.prototype.start=function(a,c){b.isEmptyObject(a)||this._userConfig===a||(this._userConfig=a);var d=this._determineServerVersion();return this._selectedProvider=this._providers[d],this._selectedProvider.start(a,c)},d.prototype._determineServerVersion=function(){return 1},d.prototype.getProviderType=function(){return this._selectedProvider.getProviderType()},d.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():b.Deferred().resolve().promise()},d.prototype.startDirectorySearch=function(a){return this._selectedProvider.startDirectorySearch(a)},d.prototype.stopDirectorySearch=function(a){return this._selectedProvider.stopDirectorySearch(a)},d.prototype.startResolvingContacts=function(a,b){return this._selectedProvider.startResolvingContacts(a,b)},d.prototype.getNetworkSearchContactCapability=function(){return this._selectedProvider.getNetworkSearchContactCapability()},d.prototype.getNetworkResolveContactsCapability=function(){return this._selectedProvider.getNetworkResolveContactsCapability()},d.prototype.getNetworkSearchTerminalCapability=function(){return this._selectedProvider.getNetworkSearchTerminalCapability()},d.prototype.getConferenceSearchCapability=function(){return this._selectedProvider.getConferenceSearchCapability()},d.prototype.on=function(a,b){return this._selectedProvider.on(a,b)},d.prototype.off=function(a,b){return this._selectedProvider.off(a,b)},d.prototype.getSelfContact=function(){return this._selectedProvider.getSelfContact()},c.Providers.ACS.ACSDirectorySearchProvider=d}(AvayaClientServices),function(c){"use strict";function d(a,b,d,e,f){c.Providers.Interfaces.DirectorySearchProvider.call(this),c.Providers.ACS.ACSBaseProviderV1.call(this,a,b,d),this._activeSearches={},
this._searchResultsQueue=new c.Base.ElementCache({maxElements:50}),this._acsContactsCache=f,this._contactsAnalyticsService=e}(d.prototype=b.extend({},c.Providers.Interfaces.DirectorySearchProvider.prototype,c.Providers.ACS.ACSBaseProviderV1.prototype)).startDirectorySearch=function(d){var e=b.Deferred(),f={},g="{}";if(d.getSearchNetworkSource()===c.Services.Contacts.SearchNetworkSource.CONFERENCE_ONLY){if(f=this._requestBuilder.buildSearchContactsIViewOnlyOptions(),g=this._requestBuilder.buildSearchContactsIViewOnlyData(d),!(this._acsNetworkProvider._acsConfig&&this._acsNetworkProvider._acsConfig.credentialProvider&&this._acsNetworkProvider._acsConfig.credentialProvider&&this._acsNetworkProvider._acsConfig.credentialProvider.token))return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Can't make conference only search - authorization token is not provided",new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.AUTHORIZATION_FAILED)),e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.AUTHORIZATION_FAILED))}else f=this._requestBuilder.buildSearchContactsOptions(),g=this._requestBuilder.buildSearchContactsData(d);return f.url?(this._acsNetworkProvider.send(g,f).then(function(b){if(d.getSearchNetworkSource()===c.Services.Contacts.SearchNetworkSource.CONFERENCE_ONLY){if(!b||!b.results)return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to search contacts request",b),this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));for(var f=0;f<b.results.length;f++)e.notify(this._contactsConverter.convertACSContactArraytoContactArray([b.results[f]]),a,b.totalresults);e.resolve(b.results.length,!0,b.totalresults)}else{if(!b||!b.searchId)return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to search contacts request",b),this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE));this._activeSearches[b.searchId]={searchRequestId:d.getUniqueSearchId(),deferred:e,retrievedCount:0,searchRequest:d},this.startSearchTimer(b.searchId),this._processQueuedNotifications(b.searchId)}}.bind(this),function(a){return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Search contacts request failed",a),e.reject(a)}.bind(this)),e.promise()):(c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Search contacts request failed",new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE)),e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE)))},d.prototype.startResolvingContacts=function(a,d){for(var e=[],f=this._requestBuilder.buildQuickSearchContactsOptions(),g=[],h=[],i=b.Deferred(),j=0;j<a.length;j++){var k=this._acsContactsCache.getQuickSearchResultsFromCache(a[j],d);if(0<k.length)for(var l=0;l<k.length;l++)h.push(k[l]);else g.push(a[j])}h.length&&i.notify(h),i.resolve(),e.push(i.promise());var m=this._splitQuickSearchCriteriaStrings(g,50);for(j=0;j<m.length;j++){var n=this._sendQuickSearchRequest(m[j],d,f);e.push(n)}return c.Base.Utils.waitForAllPromisesCompletion(e)},d.prototype._sendQuickSearchRequest=function(d,e,f){var g=b.Deferred(),h=this._requestBuilder.buildQuickSearchContactsData(d,e);return this._acsNetworkProvider.send(h,f).then(function(b){var d;try{d=JSON.parse(b).searchId}catch(f){d="string"==typeof b?b:null}return d?this._activeSearches[d]?(c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned duplicate searchId",d),g.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE))):(this._activeSearches[d]={deferred:g,quickSearch:!0,searchStrings:f,searchScope:e,retrievedCount:0,searchRequest:a},this.startSearchTimer(d),void this._processQueuedNotifications(d)):(c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Server returned invalid response to quick search contacts request",d),g.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE)))}.bind(this),function(a){return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Quick search contacts request failed",a),g.reject(a)}),g.promise()},d.prototype._splitQuickSearchCriteriaStrings=function(a,b){for(var c=[],d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c},d.prototype.startSearchTimer=function(a){setTimeout(function(){var b;this._activeSearches.hasOwnProperty(a)&&(c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Result for search with ID "+a+" wasn't received in time."),b=this._activeSearches[a].deferred,delete this._activeSearches[a],b.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT)))}.bind(this),3e4)},d.prototype.stopDirectorySearch=function(a){var b,d,e;for(e in this._activeSearches)if(this._activeSearches.hasOwnProperty(e)&&this._activeSearches[e].searchRequestId===a){d=e,b=this._activeSearches[e];break}b?delete this._activeSearches[d]:c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Unable to cancel contact search. Search is already cancelled, completed or doesn't exist.")},d.prototype.getNetworkSearchContactCapability=function(){return this._contactsCapability},d.prototype.getNetworkResolveContactsCapability=function(){return this._resolveContactsCapability},d.prototype.getNetworkSearchTerminalCapability=function(){return this._terminalCapability},d.prototype.getConferenceSearchCapability=function(){return this._conferenceSearchCapability},d.prototype._subscribeForNotifications=function(){var a=this._requestBuilder.buildSubscribeForACSNotifications(c.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS);return this._acsNetworkProvider.subscribeForNotifications(a,this._onSearchNotification.bind(this)).fail(function(a){c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for notifications",a)})},d.prototype._unsubscribeFromNotifications=function(){var a=this._requestBuilder.buildUnsubscribeFromACSNotifications(c.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS);return this._acsNetworkProvider.unsubscribeFromNotifications(a).fail(function(a){c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to unsubscribe from notifications",a)})},d.prototype._onSearchNotification=function(a){this._isSearchNotificationValid(a)&&(this._activeSearches[a.searchId]?this._processSearchNotification(a):(c.Base.Logger.debug(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received search notification with unknown ID "+a.searchId+", caching it"),this._searchResultsQueue.getElement(a.searchId)||this._searchResultsQueue.addElement(a.searchId,[]),this._searchResultsQueue.getElement(a.searchId).push(a)))},d.prototype._processSearchNotification=function(a){var b,d=this._activeSearches[a.searchId],e=d.deferred;try{b=JSON.parse(a.data)}catch(a){return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to parse search results",a),this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE),void e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INVALID_SERVER_RESPONSE))}d.quickSearch?(f=this._contactsConverter.convertQuickSearchResults(b,d.searchStrings,d.searchScope),e.notify(f),this._acsContactsCache.addQuickSearchResultsToCache(f)):e.notify(this._contactsConverter.convertACSContactArraytoContactArray(b)),b&&0<b.length&&this._activeSearches[a.searchId].retrievedCount++;var f=this.getMaxSearchResultsTotal();d.searchRequest&&(f=0<d.searchRequest.getMaxResults()?Math.min(d.searchRequest.getMaxResults(),this.getMaxSearchResultsTotal()):this.getMaxSearchResultsTotal()),"false"===a.hasMoreResults?(e.resolve(this._activeSearches[a.searchId].retrievedCount,!0,this._activeSearches[a.searchId].retrievedCount),delete this._activeSearches[a.searchId]):this._activeSearches[a.searchId].retrievedCount===f&&(e.resolve(this._activeSearches[a.searchId].retrievedCount,!1),delete this._activeSearches[a.searchId])},d.prototype._processQueuedNotifications=function(a){var b=this._searchResultsQueue.getElement(a);if(b){for(var c=0;c<b.length;c++)this._processSearchNotification(b[c]);this._searchResultsQueue.deleteElement(a)}},d.prototype._isSearchNotificationValid=function(a){return!!(a&&a.searchId&&a.data&&a.hasMoreResults)||(c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Received invalid search results",a),!1)},d.prototype._handleStateChange=function(a){var d;switch(a){case c.Providers.ACS.ACSProviderStates.STARTED:d=this._subscribeForNotifications();break;case c.Providers.ACS.ACSProviderStates.STOPPING:this._activeSearches={},this._searchResultsQueue.empty(),d=this._unsubscribeFromNotifications();break;default:d=b.Deferred().resolve().promise()}return d},d.prototype.getSelfContact=function(){var a=b.Deferred(),d=new c.Services.Contacts.ContactSearchRequest(this._acsNetworkProvider.getResources().self,c.Services.Contacts.SearchFieldType.ALL,c.Services.Contacts.SearchSourceType.NETWORK,1,0,c.Services.Contacts.SearchNetworkSource.ANYWHERE);return this.startDirectorySearch(d).then(function(){}.bind(this),function(b){return a.reject(b)},function(b){return b&&b[0]?void a.resolve(b[0]):a.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR))}),a.promise()},c.Providers.ACS.ACSDirectorySearchProviderV1=d}(AvayaClientServices),function(a){"use strict";var b=a.Providers.Call;b.StartCallEvent=function c(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,c.stringValue,b)},b.StartCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.StartCallEvent.stringValue="START_CALL",b.StartCallResponseEvent=function d(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,d.stringValue,b)},b.StartCallResponseEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.StartCallResponseEvent.stringValue="START_CALL_RESPONSE",b.DeviceRetrievalFailedEvent=function e(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,e.stringValue,b)},b.DeviceRetrievalFailedEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.DeviceRetrievalFailedEvent.stringValue="DEVICE_RETRIEVAL_FAILED",b.GetOfferSDPEvent=function f(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,f.stringValue,b)},b.GetOfferSDPEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.GetOfferSDPEvent.stringValue="GET_OFFER_SDP",b.OfferSDPEvent=function g(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,g.stringValue,b)},b.OfferSDPEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.OfferSDPEvent.stringValue="OFFER_SDP",b.RejectOfferSDPEvent=function h(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,h.stringValue,b)},b.RejectOfferSDPEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.RejectOfferSDPEvent.stringValue="REJECT_OFFER_SDP",b.OfferSDPFirefoxMidcallEvent=function i(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,i.stringValue,b)},b.OfferSDPFirefoxMidcallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.OfferSDPFirefoxMidcallEvent.stringValue="OFFER_SDP_FIREFOX",b.CallRingingEvent=function j(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,j.stringValue,b)},b.CallRingingEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.CallRingingEvent.stringValue="CALL_RINGING",b.AnswerSDPEvent=function k(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,k.stringValue,b)},b.AnswerSDPEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AnswerSDPEvent.stringValue="ANSWER_SDP",b.CallEstablishedEvent=function l(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,l.stringValue,b)},b.CallEstablishedEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.CallEstablishedEvent.stringValue="CALL_ESTABLISHED",b.EndCallEvent=function m(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,m.stringValue,b)},b.EndCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EndCallEvent.stringValue="END_CALL",b.EndCallResponseEvent=function n(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,n.stringValue,b)},b.EndCallResponseEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EndCallResponseEvent.stringValue="END_CALL_RESPONSE",b.OnAddStreamEvent=function o(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,o.stringValue,b)},b.OnAddStreamEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.OnAddStreamEvent.stringValue="ON_ADD_STREAM",b.IncomingCallEvent=function p(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,p.stringValue,b)},b.IncomingCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.IncomingCallEvent.stringValue="INCOMING_CALL",b.AcceptCallEvent=function q(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,q.stringValue,b)},b.AcceptCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AcceptCallEvent.stringValue="ACCEPT_CALL",b.AcceptSendVideoEvent=function r(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,r.stringValue,b)},b.AcceptSendVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AcceptSendVideoEvent.stringValue="ACCEPT_SEND_VIDEO",b.MuteAudioEvent=function s(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,s.stringValue,b)},b.MuteAudioEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.MuteAudioEvent.stringValue="MUTE_AUDIO",b.UnmuteAudioEvent=function t(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,t.stringValue,b)},b.UnmuteAudioEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UnmuteAudioEvent.stringValue="UNMUTE_AUDIO",b.MuteVideoEvent=function u(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,u.stringValue,b)},b.MuteVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.MuteVideoEvent.stringValue="MUTE_VIDEO",b.UnmuteVideoEvent=function v(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,v.stringValue,b)},b.UnmuteVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UnmuteVideoEvent.stringValue="UNMUTE_VIDEO",b.MuteSpeakerEvent=function w(){a.Base.SimpleFsm.SimpleFsmEvent.call(this,w.stringValue,{})},b.MuteSpeakerEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.MuteSpeakerEvent.stringValue="MUTE_SPEAKER",b.UnmuteSpeakerEvent=function x(){a.Base.SimpleFsm.SimpleFsmEvent.call(this,x.stringValue,{})},b.UnmuteSpeakerEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UnmuteSpeakerEvent.stringValue="UNMUTE_SPEAKER",b.BlockCameraEvent=function y(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,y.stringValue,b)},b.BlockCameraEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.BlockCameraEvent.stringValue="BLOCK_CAMERA",b.UnBlockCameraEvent=function z(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,z.stringValue,b)},b.UnBlockCameraEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UnBlockCameraEvent.stringValue="UNBLOCK_CAMERA",b.HoldEvent=function A(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,A.stringValue,b)},b.HoldEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.HoldEvent.stringValue="HOLD",b.UnHoldEvent=function B(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,B.stringValue,b)},b.UnHoldEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UnHoldEvent.stringValue="UNHOLD",b.EscalateVideoEvent=function C(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,C.stringValue,b)},b.EscalateVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateVideoEvent.stringValue="ESCALATE_VIDEO",b.EscalateNailedUpVideoEvent=function D(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,D.stringValue,b)},b.EscalateNailedUpVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateNailedUpVideoEvent.stringValue="ESCALATE_NAILED_UP_VIDEO",b.EscalateVideoAnswerEvent=function E(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,E.stringValue,b)},b.EscalateVideoAnswerEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateVideoAnswerEvent.stringValue="ESCALATE_VIDEO_GETOFFER",b.EscalateVideoGetOfferEvent=function F(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,F.stringValue,b)},b.EscalateVideoGetOfferEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateVideoGetOfferEvent.stringValue="ESCALATE_VIDEO_ANSWER",b.EscalateVideoOfferEvent=function G(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,G.stringValue,b)},b.EscalateVideoOfferEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateVideoOfferEvent.stringValue="ESCALATE_VIDEO_OFFER",b.EscalateVideoRejectedEvent=function H(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,H.stringValue,b)},b.EscalateVideoRejectedEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.EscalateVideoRejectedEvent.stringValue="ESCALATE_VIDEO_REJECTED",b.DeEscalateVideoEvent=function I(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,I.stringValue,b)},b.DeEscalateVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.DeEscalateVideoEvent.stringValue="DEESCALATE_VIDEO",b.AnswerSdpAckEvent=function J(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,J.stringValue,b)},b.AnswerSdpAckEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AnswerSdpAckEvent.stringValue="ANSWER_SDP_ACK",b.DenySendVideoEvent=function K(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,K.stringValue,b)},b.DenySendVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.DenySendVideoEvent.stringValue="DENY_SEND_VIDEO",b.AcceptVideoTimedOutEvent=function L(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,L.stringValue,b)},b.AcceptVideoTimedOutEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AcceptVideoTimedOutEvent.stringValue="ACCEPT_VIDEO_TIMED_OUT",b.SendDTMFEvent=function M(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,M.stringValue,b)},b.SendDTMFEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.SendDTMFEvent.stringValue="SEND_DTMF",b.IncomingAddVideoEvent=function N(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,N.stringValue,b)},b.IncomingAddVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.IncomingAddVideoEvent.stringValue="INCOMING_ADD_VIDEO",b.IncomingAddVideoTimedoutEvent=function O(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,O.stringValue,b)},b.IncomingAddVideoTimedoutEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.IncomingAddVideoTimedoutEvent.stringValue="INCOMING_ADD_VIDEO_TIMEDOUT",b.IncomingRemoveVideoEvent=function P(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,P.stringValue,b)},b.IncomingRemoveVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.IncomingRemoveVideoEvent.stringValue="INCOMING_REMOVE_VIDEO",b.IncomingGenericOfferSDPEvent=function Q(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,Q.stringValue,b)},b.IncomingGenericOfferSDPEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.IncomingGenericOfferSDPEvent.stringValue="INCOMING_GENERIC_OFFER",b.RevertStateEvent=function R(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,R.stringValue,b)},b.RevertStateEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.RevertStateEvent.stringValue="REVERT_STATE",b.OnAddRemoteTrackEvent=function S(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,S.stringValue,b)},b.OnAddRemoteTrackEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.OnAddRemoteTrackEvent.stringValue="ON_ADD_REMOTE_TRACK",b.OnRemoveRemoteTrackEvent=function T(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,T.stringValue,b)},b.OnRemoveRemoteTrackEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.OnRemoveRemoteTrackEvent.stringValue="ON_REMOVE_REMOTE_TRACK",b.UpdateRemoteVideoEvent=function U(b){a.Base.SimpleFsm.SimpleFsmEvent.call(this,U.stringValue,b)},b.UpdateRemoteVideoEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UpdateRemoteVideoEvent.stringValue="UPDATE_REMOTE_VIDEO",b.UpdateLocalStreamEvent=function V(b){a.Providers.Call.CallFsmEvent.call(this,V.stringValue,b)},b.UpdateLocalStreamEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UpdateLocalStreamEvent.stringValue="UPDATE_LOCAL_STREAM",b.StartContentVideoSharingEvent=function W(b){a.Providers.Call.CallFsmEvent.call(this,W.stringValue,b)},b.StartContentVideoSharingEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.StartContentVideoSharingEvent.stringValue="START_VIDEO_SHARING",b.StopContentVideoSharingEvent=function X(b){a.Providers.Call.CallFsmEvent.call(this,X.stringValue,b)},b.StopContentVideoSharingEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.StopContentVideoSharingEvent.stringValue="STOP_VIDEO_SHARING",b.UpdateContentVideoSharingAudioEvent=function Y(b){a.Providers.Call.CallFsmEvent.call(this,Y.stringValue,b)},b.UpdateContentVideoSharingAudioEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UpdateContentVideoSharingAudioEvent.stringValue="UPDATE_VIDEO_SHARING_AUDIO",b.TransferEvent=function Z(b){a.Providers.Call.CallFsmEvent.call(this,Z.stringValue,b)},b.TransferEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.TransferEvent.stringValue="TRANSFER",b.AttendedTransferEvent=function $(b){a.Providers.Call.CallFsmEvent.call(this,$.stringValue,b)},b.AttendedTransferEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AttendedTransferEvent.stringValue="ATTENDED_TRANSFER",b.AddParticipantFromExistingCallEvent=function _(b){a.Providers.Call.CallFsmEvent.call(this,_.stringValue,b)},b.AddParticipantFromExistingCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AddParticipantFromExistingCallEvent.stringValue="ADD_PARTICIPANT_FROM_EXISTING_CALL",b.JoinRemoteCallEvent=function aa(b){a.Providers.Call.CallFsmEvent.call(this,aa.stringValue,b)},b.JoinRemoteCallEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.JoinRemoteCallEvent.stringValue="JOIN_REMOTE_CALL",b.CallStateFailureEvent=function ba(b){a.Providers.Call.CallFsmEvent.call(this,ba.stringValue,b)},b.CallStateFailureEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.CallStateFailureEvent.stringValue="CALL_STATE_FAILURE",b.CallFailureEvent=function ca(b){a.Providers.Call.CallFsmEvent.call(this,ca.stringValue,b)},b.CallFailureEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.CallFailureEvent.stringValue="CALL_FAILURE",b.StartRingingEvent=function da(b){a.Providers.Call.CallFsmEvent.call(this,da.stringValue,b)},b.StartRingingEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.StartRingingEvent.stringValue="START_RINGING",b.AcceptCallRequestEvent=function ea(b){a.Providers.Call.CallFsmEvent.call(this,ea.stringValue,b)},b.AcceptCallRequestEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AcceptCallRequestEvent.stringValue="ACCEPT_CALL_REQUEST",b.RejectCallRequestEvent=function fa(b){a.Providers.Call.CallFsmEvent.call(this,fa.stringValue,b)},b.RejectCallRequestEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.RejectCallRequestEvent.stringValue="REJECT_CALL_REQUEST",b.UpdateIceRestartMediaEvent=function ga(b){a.Providers.Call.CallFsmEvent.call(this,ga.stringValue,b)},b.UpdateIceRestartMediaEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UpdateIceRestartMediaEvent.stringValue="UPDATE_ICE_RESTART_MEDIA_REQUEST",b.ServiceAvailableEvent=function ha(b){a.Providers.Call.CallFsmEvent.call(this,ha.stringValue,b)},b.ServiceAvailableEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.ServiceAvailableEvent.stringValue="SERVICE_AVAILABLE",b.UpdatePreferredReceiveResolutionEvent=function ia(b){a.Providers.Call.CallFsmEvent.call(this,ia.stringValue,b)},b.UpdatePreferredReceiveResolutionEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.UpdatePreferredReceiveResolutionEvent.stringValue="PREFERRED_RESOLUTION",b.AudioEndedEvent=function ja(b){a.Providers.Call.CallFsmEvent.call(this,ja.stringValue,b)},b.AudioEndedEvent.prototype=Object.create(a.Base.SimpleFsm.SimpleFsmEvent.prototype),b.AudioEndedEvent.stringValue="AUDIO_ENDED"}(AvayaClientServices),function(c){"use strict";function d(b,d,e){c.Base.Observable.call(this),this._csgProvider=b,this._callProvider=a,this._messageBuilder=d,this._host=e,this._startPromise=a,this._stopPromise=a,this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._networkProviderUnavailableCounter=0,this._started=!1,this._isNetworkAvailable=!1,this._isServiceAvailable=a,this._isExternalGateway=!1,this._parsers=[],this._registerParsers(),this._ringbackToneURLs=a,this._voicemailMWI=!1,this._voicemailNumber=a,this._eventsSubscription=a,this._onNetworkEventCallback=a,this._isServerSupportsNailedUpVideoConnection=!1,this._isSupportUpdateCallProperties=!1,this._notificationQueue=[]}var e=c.Providers.CallServiceGateway.Constants,f="0",g="1",h="2",i="3",j="4";(d.prototype=Object.create(c.Base.Observable.prototype)).getCallProvider=function(){return this._callProvider},d.prototype.isServiceAvailable=function(){return this._isServiceAvailable},d.prototype.start=function(d,f,g,h,i,j){if(this._startPromise)return this._startPromise;this._callProvider=d;var k=b.Deferred();return this._started=!0,this._networkProviderUnavailableCounter=0,c.Base.Utils.isDefined(j)&&(this._isExternalGateway=j),this._onNetworkAvailable&&this._onNetworkUnavailable||(this._onNetworkAvailable=function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is available. Subscribing for notifications"),this._isNetworkAvailable=!0,this._networkProviderUnavailableCounter=0,this._csgProvider.restProviderOnErrorHandler(function(a){c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"REST provider error: "+a)}.bind(this)),this._subscribeForNotifications().then(function(){var a=h?h.getMinBandwidth():null,a=new c.Providers.CallServiceGateway.ServiceActivationParameters(g,a,i);return!i||this._isServerSupportsNailedUpVideoConnection||d.supportsMPaaSCollabCall()?this._csgProvider.activateService(e.CALLS,a):(c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Skipped service activation because a nailed up video connection is required and the server doesn't support it",e.CALLS),b.Deferred().resolve().promise())}.bind(this)).then(function(){this._isServiceAvailable=!0,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,[this._host]),this._setRingbackToneList(),c.Base.Utils.isDefined(k)&&(k.state()===c.Base.DeferredStates.PENDING?k.resolve(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.iViewToken]):k.state()===c.Base.DeferredStates.RESOLVED&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,[this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.iViewToken]])),this._sendPendingNotifications()}.bind(this),function(a){return a instanceof c.Base.NetworkError&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,a.name,a.message]),k.state()===c.Base.DeferredStates.PENDING&&k.reject(a),b.Deferred().reject(a).promise()}.bind(this)),c.Base.Utils.isDefined(this._onNetworkEventCallback)&&this._csgProvider.setOnNetworkEvents(this._eventsSubscription)}.bind(this),this._onNetworkUnavailable=function(a,b){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is unavailable: "+a),this._isNetworkAvailable=!1,this._isServiceAvailable=!1,this._isExternalGateway&&(("Notification"!==a||b.target&&b.target.url&&b.target.url.includes("http"))&&this._networkProviderUnavailableCounter++,0<=f.maxCallStartReconnectionAttempts&&f.maxCallStartReconnectionAttempts<this._networkProviderUnavailableCounter&&(c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Maximum network recovery attempted: "+this._networkProviderUnavailableCounter),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.MAX_NETWORK_RECONNECTION_ATTEMPTED,[this._host]))),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,a,b])}.bind(this),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,function(a){this.trigger(c.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,[a])}.bind(this)),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,function(a){a&&a.includes("mediaChannelGuidelines")&&(this._isServerSupportsNailedUpVideoConnection=!0),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[a])}.bind(this)),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,function(a,b,d){this.trigger(c.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,[a,b,d])}.bind(this)),this._csgProvider.on(c.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,function(a,b,d,e,f){this.trigger(c.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[a,b,d,e,f])}.bind(this)),this._csgProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._stopPromise=a),this._startPromise=b.when(k,this._csgProvider.start(f)),this._startPromise},d.prototype.stop=function(){if(!this._started)return b.Deferred().resolve().promise();if(c.Base.Utils.isDefined(this._stopPromise))return this._stopPromise;var d=function(){this._started=!1,this._removeListeners(),this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._networkProviderUnavailableCounter=0,this._startPromise=a,this._isExternalGateway=!1,this._onNetworkEventCallback=a,this._eventsSubscription=a}.bind(this);this._stopPromise=b.Deferred();var f=function(){this._csgProvider.stop().always(d).then(function(){c.Base.Utils.isDefined(this._stopPromise)&&(this._stopPromise.resolve(),this._stopPromise=a)}.bind(this),function(b){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"stop error.",b),c.Base.Utils.isDefined(this._stopPromise)&&(this._stopPromise.reject(b),this._stopPromise=a)}.bind(this))}.bind(this);return this._isNetworkAvailable?this._unsubscribeFromNotifications().always(function(){this._csgProvider.deactivateService(e.CALLS).always(f)}.bind(this)):f(),this._isNetworkAvailable=!1,this._isServiceAvailable=!1,this._stopPromise.promise()},d.prototype.stopImmediately=function(){return this._started?this._stopPromise||(this._stopPromise=b.Deferred(),this._csgProvider.stopImmediately().then(function(){this._stopPromise.resolve()}.bind(this),function(a){this._stopPromise.reject(a)}.bind(this)),this._stopPromise.promise()):b.Deferred().resolve().promise()},d.prototype._subscribeForNotifications=function(){var a=this._messageBuilder.buildSubscribeRequest(c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls]),d=this._parsers[i],d=d.parse.bind(d),d=this._csgProvider.subscribeForNotifications(a,d).then(function(){
c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed for calls notifications")},function(a){return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for calls notifications: "+JSON.stringify(a)),b.Deferred().reject(a).promise()}.bind(this));return c.Base.Utils.rejectIfPromiseNotResolvedInTime(d,3e4,new c.Services.Call.CallException(c.Services.Call.CallError.TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Calls subscription confirmation was not received in time"),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,[this._host,"Notification","Unavailable"])}.bind(this))},d.prototype._unsubscribeFromNotifications=function(){var a=this._messageBuilder.buildUnsubscribeRequest(c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls]);return this._csgProvider.unsubscribeFromNotifications(a).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unsubscribed from calls notifications")},function(a){return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from calls notifications: "+JSON.stringify(a)),b.Deferred().reject(a).promise()}.bind(this))},d.prototype.getCalls=function(){var d=b.Deferred(),e=this._messageBuilder.buildGetCallsOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls]);return this._csgProvider.send(a,e).then(function(a){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get calls response"),a=this._parsers[g].parse(a),d.resolve(a)}.bind(this),function(a){this._handleError("getCalls() network provider failed - "+a.statusText),d.reject(a)}.bind(this)),d.promise()},d.prototype.getCall=function(a){var d=b.Deferred(),a=this._messageBuilder.buildGetCallOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a);return this._csgProvider.send(null,a).then(function(a){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get call response"),a=this._parsers[f].parse(a),d.resolve(a)}.bind(this),function(a){this._handleError("getCall() network provider failed - "+a.statusText),d.reject(a)}.bind(this)),d.promise()},d.prototype.getClients=function(){var a=b.Deferred(),d=this._messageBuilder.buildGetClientsOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Clients]);return this._csgProvider.send(null,d).then(function(b){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get clients response"),b=this._parsers[h].parse(b),a.resolve(b)}.bind(this),function(b){this._handleError("getClients() network provider failed - "+b.statusText),a.reject(b)}.bind(this)),a.promise()},d.prototype.getClient=function(a){var d=b.Deferred(),a=this._messageBuilder.buildGetClientOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Clients],a);return this._csgProvider.send(null,a).then(function(a){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get client response"),a=this._parsers[h].parseClient(a),d.resolve(a)}.bind(this),function(a){this._handleError("getClient() network provider failed - "+a.statusText),d.reject(a)}.bind(this)),d.promise()},d.prototype.startCall=function(d,e,g,h,i,j,k,l,m,n,o,p,q){var r=b.Deferred(),s=this._messageBuilder.buildStartCallOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls]),t="",i={subject:"",priority:null,privacy:null,participants:[{participantId:null,remoteDisplayName:t=this._csgProvider.getCredentials().isGuest?this._csgProvider.getCredentials().displayName:t,remoteAddress:d}],conferenceData:{userAgentCalling:null,video:h,webCollaboration:i}};return c.Base.Utils.isDefined(e)&&0<e.length&&(i.subject=e),c.Base.Utils.isDefined(n)?(i.callId=n,i.conferenceData=null):(m=!!c.Base.Utils.isDefined(m)&&m,i.conferenceData.uccp=m,g&&(i.conferenceData.ott=g.getCallType()===c.Services.Call.CallType.CallTypeHttpMeetMe,i.conferenceData.meetingToken=g.getPortalToken()||null,i.conferenceData.meetingId=g.getConferenceID()||null,i.conferenceData.meetingPasscode=g.getPasscode()||null)),c.Base.Utils.isDefined(o)&&(i.sessionId=o),g&&c.Base.Utils.isDefined(g.getContextId)&&(i.userToUserData={contextId:g.getContextId()}),p&&(i.videoChannelGuidelines=c.Providers.CallServiceGateway.Utils.convertToVideoChannelGuidelines(p)),q=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(j,a,q),l=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(k,p,l),i=b.extend({},i,{audioChannel:q},{videoChannels:l}),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending StartCall"),this._csgProvider.send(JSON.stringify(i),s).then(function(a){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received make call response"),a=this._parsers[f].parse(a),this._updateGatewayCapabilities(a.capabilities),r.resolve(a)}.bind(this),function(a){this._handleError("startCall() network provider failed - "+a.statusText),a=this._handleCsgProviderSendError(a),r.reject({errorCode:a.errorCode,protocolType:a.protocolType,protocolErrorCode:a.protocolErrorCode,errorMsg:a.errorMsg})}.bind(this)),r.promise()},d.prototype.offerSDPResponse=function(a,d,e,f,g){var h=b.Deferred(),i=this._messageBuilder.buildNotificationsOptions(),f=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(f),g=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(g),j=this._messageBuilder.buildProcessMediaOfferResponseNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,e,d.type,d.sdp,f,g);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending offer notification");try{this._csgProvider.sendNotification(JSON.stringify(j),i),h.resolve()}catch(a){h.reject(a)}return h.promise()},d.prototype.rejectOfferSDPResponse=function(a,d){var e=b.Deferred(),f=this._messageBuilder.buildNotificationsOptions(),g=this._messageBuilder.buildRejectOfferResponseNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d.errorCode,d.errorMsg,d.displayMsg);try{this._csgProvider.sendNotification(JSON.stringify(g),f),e.resolve()}catch(a){e.reject(a)}return e.promise()},d.prototype.answerSDPResponse=function(a,d,e){var f=b.Deferred(),g=this._messageBuilder.buildNotificationsOptions(),d=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(d),e=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(e),h=this._messageBuilder.buildProcessMediaAnswerResponseNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d,e);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending answer notification");try{this._csgProvider.sendNotification(JSON.stringify(h),g),f.resolve()}catch(a){f.reject(a)}return f.promise()},d.prototype.getOfferSDPResponse=function(d,e,f,g,h){var i=b.Deferred(),j=this._messageBuilder.buildNotificationsOptions(),f=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(f),h=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(g,a,h),k=this._messageBuilder.buildCreateMediaResponseNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],d,e.type,e.sdp,f,h);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sending getOffer notification:\n"+e.sdp),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,JSON.stringify(k));try{this._csgProvider.sendNotification(JSON.stringify(k),j),i.resolve()}catch(d){i.reject(d)}return i.promise()},d.prototype.blockUnBlockCamera=function(a,b,d){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.UPDATE_VIDEO,b,d)},d.prototype.updateVideo=function(a,b,d,e){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.UPDATE_VIDEO,b,d,e)},d.prototype.escalateVideo=function(a,b,d){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.ADD_VIDEO,b,d)},d.prototype.deEscalateVideo=function(a,b,d){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.REMOVE_VIDEO,b,d)},d.prototype.updateMediaRequest=function(a,d,e,f,g){var h=b.Deferred(),i=this._messageBuilder.buildNotificationsOptions(),e=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(e),f=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(f),j=this._messageBuilder.buildUpdateMediaRequestNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d,e,f,g);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Update media request: "+d);try{this._csgProvider.sendNotification(JSON.stringify(j),i),h.resolve()}catch(a){h.reject(a)}return h.promise()},d.prototype.updateCallProperties=function(a,d,e,f){if(this._isSupportUpdateCallProperties){var g=b.Deferred(),h=this._messageBuilder.buildNotificationsOptions(),e=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(e),i=this._messageBuilder.buildUpdateCallPropertiesNotification(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d,e,f);return c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Update local video call properties: ",f),this._csgProvider.sendNotification(JSON.stringify(i),h).done(function(){g.resolve()}).fail(function(a){this._notificationQueue.push({data:JSON.stringify(i),options:h}),g.reject(a)}.bind(this)),g.promise()}return b.Deferred().reject("Gateway does not support UpdateCallProperties").promise()},d.prototype.endCall=function(a,b){var d={actionDetails:{targetCallId:null,subject:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:null,videoChannels:[]}};return c.Base.Utils.isDefined(b)&&(d.actionDetails.denyCallReason=b),this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.END,d)},d.prototype.transfer=function(a,d,e,f){return!1===this.isAllowedToTransfer(a)?b.Deferred().reject().promise():(e=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(e),f=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(f),f={actionDetails:{targetRemoteAddress:d,targetCallId:null,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:e,videoChannels:c.Base.Utils.isDefined(f)?f:[]}},this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.TRANSFER,f))},d.prototype.isAllowedToTransfer=function(b){return this._callProvider._cpCalls[b].call!==a&&(b=this._csgProvider.getCredentials(),!(b!==a&&b.bearer!==a&&b.bearer===c.Config.Authentication.TokenType.ESGTOKEN))},d.prototype.attendedTransfer=function(a,d,e,f){return!1===this.isAllowedToTransfer(a)?b.Deferred().reject().promise():(e=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(e),f=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(f),f={actionDetails:{targetRemoteAddress:null,targetCallId:d,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:e,videoChannels:c.Base.Utils.isDefined(f)?f:[]}},this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.TRANSFER,f))},d.prototype.addParticipantFromCall=function(a,b,d,e){return d=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(d),e=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(e),e={actionDetails:{targetRemoteAddress:null,targetCallId:b,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:d,videoChannels:c.Base.Utils.isDefined(e)?e:[]}},this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.ADD_PARTICIPANT,e)},d.prototype.joinRemoteCall=function(a,b,d,e){return b=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(b),d=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(d,e),d={actionDetails:{targetRemoteAddress:null,targetCallId:null,subject:null,cmLineID:null,participants:null,conferenceData:null,sdpType:null,sdp:null,audioChannel:b,videoChannels:c.Base.Utils.isDefined(d)?d:[]}},e&&(d.actionDetails.videoChannelGuidelines=c.Providers.CallServiceGateway.Utils.convertToVideoChannelGuidelines(e)),this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.JOIN,d)},d.prototype.acceptCall=function(a,b,d,e,f){return e=c.Providers.CallServiceGateway.Utils.convertToAudioChannel(e),f=c.Providers.CallServiceGateway.Utils.convertToVideoChannels(f),f={actionDetails:{targetCallId:null,subject:null,participants:null,conferenceData:null,sdpType:b.toUpperCase(),sdp:d,audioChannel:e,videoChannels:c.Base.Utils.isDefined(f)?f:[]}},this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.ANSWER,f)},d.prototype.holdCall=function(a,b,d){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.HOLD,b,d)},d.prototype.unholdCall=function(a,b,d){return this.updateMediaRequest(a,c.Providers.CallServiceGateway.CallActionType.UNHOLD,b,d)},d.prototype.muteVideo=function(a,b,c){return this.updateCallProperties(a,b,c,{localVideoMute:!0})},d.prototype.unmuteVideo=function(a,b,c){return this.updateCallProperties(a,b,c,{localVideoMute:!1})},d.prototype.startVideoSharing=function(a,b,c){return this.updateCallProperties(a,b,c,{screenSharing:!0,localVideoMute:!1})},d.prototype.stopVideoSharing=function(a,b,c){return this.updateCallProperties(a,b,c,{screenSharing:!1,localVideoMute:!0})},d.prototype.updatePreferredReceiveResolution=function(a,b,c,d){return this.updateCallProperties(a,b,c,{preferredReceiveResolution:d})},d.prototype.startRinging=function(a){return this._updateCall(a,c.Providers.CallServiceGateway.CallActionType.RINGING)},d.prototype.acceptCallRequest=function(a,d,e){var f=b.Deferred(),g=this._messageBuilder.buildNotificationsOptions(),h=this._messageBuilder.buildAcceptCallResponse(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSGCallProvider: Sending accept call request");try{this._csgProvider.sendNotification(JSON.stringify(h),g).done(function(){f.resolve()}).fail(function(a){f.reject(a)})}catch(a){f.reject(a)}return f.promise()},d.prototype.rejectAnswerCallRequest=function(a,b){return this._rejectCallRequest(a,b)},d.prototype.rejectTerminateCallRequest=function(a,b){return this._rejectCallRequest(a,b)},d.prototype.rejectUpdateCallRequest=function(a,b,c){return this._rejectCallRequest(a,b)},d.prototype.rejectMakeCallRequest=function(a,b){return this._rejectCallRequest(a,b)},d.prototype._rejectCallRequest=function(a,d){var e=b.Deferred(),f=this._messageBuilder.buildNotificationsOptions(),g=this._messageBuilder.buildRejectCallResponse(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a,d);c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSGCallProvider: Sending reject call request");try{this._csgProvider.sendNotification(JSON.stringify(g),f).done(function(){e.resolve()}).fail(function(a){e.reject(a)})}catch(a){e.reject(a)}return e.promise()},d.prototype._handleError=function(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error detected: "+a)},d.prototype._handleCsgProviderSendError=function(a){var b={};if(200<=a.status&&a.status<300)return b;b.errorCode=c.Services.Call.CallError.TRANSPORT_ERROR,b.protocolType=c.Services.Call.CallProtocolType.HTTP,b.protocolErrorCode=a.getData().getStatus(),b.errorMsg=a.message;var d=c.Base.Utils.queryJSONObject(a,"_data._responseText");if(d){b.protocolType=c.Services.Call.CallProtocolType.APPLICATION;try{var e=JSON.parse(d);e&&(b.errorCode=c.Providers.CallServiceGateway.Utils.convertErrorCode(e.error[0].errorCode),b.errorMsg=e.error[0].errorMsg)}catch(a){}}return b},d.prototype._updateCall=function(a,d,e){var f=this._messageBuilder.buildUpdateCallOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Calls],a);if(c.Base.Utils.isUndefined(f))return b.Deferred().reject().promise();var g=b.Deferred(),a={action:d};return e&&(a=b.extend(a,e)),this._csgProvider.send(JSON.stringify(a),f).then(function(a){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sent call action: "+d),g.resolve()}.bind(this),function(a){a=this._handleCsgProviderSendError(a),c.Base.Utils.queryJSONObject(a,"errorCode")?(404===a.protocolErrorCode&&a.errorCode===c.Services.Call.CallError.NOT_FOUND?a.errorCode=c.Services.Call.CallError.CALL_NOT_FOUND:this._handleError(d+" call action network provider failed - "+a.errorMsg),g.reject({errorCode:a.errorCode,protocolType:a.protocolType,protocolErrorCode:a.protocolErrorCode,errorMsg:a.errorMsg})):(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Sent call action: "+d),g.resolve())}.bind(this)),g.promise()},d.prototype.getConfiguration=function(){var a=b.Deferred(),d=this._messageBuilder.buildGetConfigurationOptions(this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.Configuration]);return this._csgProvider.send(null,d).then(function(b){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received get configuration response"),b=this._parsers[j].parse(b),a.resolve(b)}.bind(this),function(b){this._handleError("getConfiguration() network provider failed - "+b.statusText),a.reject(b)}.bind(this)),a.promise()},d.prototype.getVoicemailNumber=function(){return this._voicemailNumber},d.prototype.setVoicemailNumber=function(a){this._voicemailNumber=a},d.prototype.setVoicemailMWI=function(a){this._voicemailMWI=a===c.Providers.CallServiceGateway.Constants.MWI_ON,this.trigger(c.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,[a===c.Providers.CallServiceGateway.Constants.MWI_ON])},d.prototype.getVoicemailMWI=function(){return this._voicemailMWI},d.prototype.activateService=function(a,b,d){a.toUpperCase()===e.CALLS&&(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Calls activated status: "+b),b===e.ACTIVATED?this.trigger(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,[this._host]):d===e.DEACTIVATED_BY_CLIENT?c.Base.Utils.isUndefined(this._stopPromise)?(c.Base.Logger.error("Unexpected deactivation notification when service is not stopping: "+d),this._cancelOrRestartDiscovery(d),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,[this._host,d])):c.Base.Logger.info("Unexpected deactivation notification when service is stopping: "+d):(this._cancelOrRestartDiscovery(d),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,[this._host,d])))},d.prototype._cancelOrRestartDiscovery=function(a){switch(a){case e.REGISTRATION_TERMINATED:this._csgProvider.cancelDiscovery();break;case e.USER_DOES_NOT_MATCH:c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Invalidates client session due to mismatch username"),this._csgProvider.invalidateClient(),this._csgProvider.forceNetworkRecovery();break;default:this._csgProvider.forceNetworkRecovery()}},d.prototype._registerParsers=function(){this._parsers[f]=new c.Providers.CallServiceGateway.CallInfoParser,this._parsers[i]=new c.Providers.CallServiceGateway.NotificationParser(this),this._parsers[g]=new c.Providers.CallServiceGateway.ClientCallsParser(this._parsers[f]),this._parsers[h]=new c.Providers.CallServiceGateway.UserClientsParser,this._parsers[j]=new c.Providers.CallServiceGateway.ConfigurationParser},d.prototype._setRingbackToneList=function(){var a=c.Providers.CallServiceGateway.CSGToneType,d=this._csgProvider.getRestResources(),e={};d.ringbackTones&&b.each(a,function(a,b){var c=d.ringbackTones[b];c&&c.href&&(e[b]=c.href)});var f=new c.Services.Call.RingbackToneURLs;f._setRingbackToneUrl(e[a.RINGBACK]),f._setInterceptToneUrl(e[a.INTERCEPT]),f._setReorderToneUrl(e[a.REORDER]),f._setFastBusyToneUrl(e[a.FASTBUSY]),this._ringbackToneURLs&&JSON.stringify(this._ringbackToneURLs)===JSON.stringify(f)||(this._ringbackToneURLs=f,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.RINGBACK_TONE_URLS_CHANGED,[f]))},d.prototype.setOnNetworkEvents=function(c,d){return this._netWorkEventsPromise=b.Deferred(),this._eventsSubscription=c,this._onNetworkEventCallback?this._csgProvider.updateOnNetworkEvents(c).then(function(a){this._validateEventsInResponse(a,c),this._netWorkEventsPromise.resolve(a)}.bind(this),function(a){a=this._buildNetworkEventsErrorMessage(a),this._netWorkEventsPromise.reject(a)}.bind(this)):this._csgProvider.setOnNetworkEvents(c).then(function(a){this._validateEventsInResponse(a,c),this._netWorkEventsPromise.resolve(a)}.bind(this),function(b){this._onNetworkEventCallback=a,b=this._buildNetworkEventsErrorMessage(b),this._netWorkEventsPromise.reject(b)}.bind(this)),this._onNetworkEventCallback=d,this._netWorkEventsPromise},d.prototype._buildNetworkEventsErrorMessage=function(a){var b=a._data._status===e.HTTP_BAD_REQUEST?c.Services.Call.CallError.INVALID_ACCEPTED_EVENTS:c.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_FAILED;return new c.Services.Call.CallException(b,e.HTTP,a._data._status,a._data._responseText)},d.prototype._validateEventsInResponse=function(a,b){a.subscribedEvents.events||(a.subscribedEvents.events=[]);var d=b.acceptedEvents.events.filter(function(a){return b.acceptedEvents.excludedEvents.indexOf(a)<0});0<(d=d.filter(function(b){return a.subscribedEvents.events.indexOf(b)<0})).length&&"*"!==d[0]&&c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Some events couldn't be subscribed: "+JSON.stringify(d))},d.prototype.isNetworkEventsUrlDefined=function(){return this._csgProvider.isNetworkEventsUrlDefined()},d.prototype.removeOnNetworkEvents=function(c){return this._removeNetWorkEventsPromise=b.Deferred(),this._csgProvider.removeOnNetworkEvents(c).then(function(b){this._onNetworkEventCallback=a,this._removeNetWorkEventsPromise.resolve(b)}.bind(this),function(a){this._removeNetWorkEventsPromise.reject(a)}.bind(this)),this._removeNetWorkEventsPromise.promise()},d.prototype.networkEventNotification=function(a){this._onNetworkEventCallback(a)},d.prototype._sendPendingNotifications=function(){var a=this._notificationQueue.shift();a&&this._csgProvider.sendNotification(a.data,a.options).then(function(){this._sendPendingNotifications()}.bind(this),function(b){this._notificationQueue.unshift(a)})},d.prototype._updateGatewayCapabilities=function(a){a&&a.updatecallpropertiesCapability&&(this._isSupportUpdateCallProperties=a.updatecallpropertiesCapability.allowed)},c.Providers.CallServiceGateway.CSGCallsProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d){c.Base.Observable.call(this),this._csgProvider=b,this._messageBuilder=d,this._started=!1,this._subscriptionStatusUnknown=!1,this._presenceContainer=a,this._presenceContainerExpirationDate=a,this._presenceContainerRefreshTimeoutId=a,this._subscribePresenceTimeoutId=a,this._addressSubscriptionTimeoutId=a,this._userSubscriptions=[],this._subscriptionsDeferredMap={},this._unsubscriptionsDeferredMap={},this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._subscribedForPresence=!1,this._deletePresenceContainerPromise=a,this._createOrExtendPresenceContainerPromise=a,this._timeoutForSubscribe=1e3,this._timeoutForUnsubscribe=7e3,this._resuscribeFnRetryInterval=1e3,this._presenceStateAlreadyChanged=!1}var e=c.Providers.CallServiceGateway.ObservableEvents,f=c.Providers.CallServiceGateway.Constants;(d.prototype=Object.create(c.Providers.Interfaces.PresenceProvider.prototype)).start=function(a){if(this._started)return b.Deferred().resolve();var d=b.Deferred();return this._onNetworkAvailable&&this._onNetworkUnavailable||(this._onNetworkAvailable=function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network is available. Subscribing for notifications"),this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]?this._subscribeForNotifications().then(function(){var a=new c.Providers.CallServiceGateway.ServiceActivationParameters((!0));return this._csgProvider.activateService(f.PRESENCE,a).then(function(a){try{var b=JSON.parse(a);b.presenceData&&b.presenceData.presenceHandle?this.trigger(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,[b.presenceData.presenceHandle]):c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error parsing presence activation response")}catch(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error parsing presence activation response")}}.bind(this))}.bind(this)).then(function(){0<this._userSubscriptions.length?this.subscribeForPresence(this._userSubscriptions).always(function(){d.resolve()}):d.resolve(),this._started=!0,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this),function(a){d.reject(a)}):(c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription URL is not found. Cannot subscribe for presence notifications."),d.reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.UNSUPPORTED))),d.state()!==c.Base.DeferredStates.PENDING&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)}.bind(this),this._onNetworkUnavailable=function(){c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"CSG presence provider is unavailable"),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this),this._csgProvider.on(e.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._csgProvider.on(e.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._csgProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._csgProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this))),a=this._csgProvider.start(a.sgConfiguration).then(function(){if(!this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions])return this._started=!1,c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence is not supported for this user"),b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.UNSUPPORTED))}.bind(this)),b.when(a,d).then(function(){this._started=!0}.bind(this))},d.prototype.stop=function(){if(!this._started)return b.Deferred().resolve().promise();var d=b.Deferred(),e=function(){this._started=!1,this._presenceContainer=a,this._onNetworkAvailable=a,this._onNetworkUnavailable=a}.bind(this),g=function(){return this._csgProvider.stop().always(function(){e(),this._removeListeners()}.bind(this)).then(function(){d.resolve()},function(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to stop CSGPresenceProvider",a),d.reject(a)})}.bind(this),h=function(){return clearTimeout(this._presenceContainerRefreshTimeoutId),clearTimeout(this._subscribePresenceTimeoutId),clearTimeout(this._addressSubscriptionTimeoutId),this._csgProvider.deactivateService(f.PRESENCE)}.bind(this);return this._csgProvider.isNetworkAvailable()?this._unsubscribeFromNotifications().always(function(){this.unsubscribeFromAllAddressesPresence().always(function(){h().always(function(){g()}.bind(this))}.bind(this))}.bind(this)):g(),d.promise()},d.prototype._subscribeForNotifications=function(){var a=this._messageBuilder.buildSubscribeRequest(c.Providers.CallServiceGateway.Constants.SVC_PRESENCE,this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]),a=this._csgProvider.subscribeForNotifications(a,this._onNotification.bind(this)).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed for presence notifications")},function(a){return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for presence notifications",a),b.Deferred().reject(a).promise()}.bind(this));return c.Base.Utils.rejectIfPromiseNotResolvedInTime(a,3e4,new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription confirmation was not received in time"),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE)}.bind(this))},d.prototype._unsubscribeFromNotifications=function(){var a=this._messageBuilder.buildUnsubscribeRequest(c.Providers.CallServiceGateway.Constants.SVC_PRESENCE,this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PresenceSubscriptions]);return this._csgProvider.unsubscribeFromNotifications(a).then(function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unsubscribed from presence notifications")},function(a){return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from presence notifications: "+JSON.stringify(a)),b.Deferred().reject(a).promise()}.bind(this))},d.prototype._onNotification=function(a){if(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received notification",a),a&&a.rlPresenceUpdatedEvent){var b;try{b=JSON.parse(a.rlPresenceUpdatedEvent)}catch(a){return void c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to parse notification",a)}this._onPresenceUpdatedEvent(b)}},d.prototype._onPresenceUpdatedEvent=function(a){a.serviceContainerEvent&&a.serviceContainerEvent.terminatedResources?this._handleTerminatedResources(a.serviceContainerEvent.terminatedResources):a.presentities&&0!==a.presentities.length?a.presenceDocuments?a.presenceDocuments.forEach(this._processPresenceDocument.bind(this)):a.presentities&&a.presentities.forEach(this._processPresentities.bind(this)):c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received empty presence updated notification")},d.prototype._handleTerminatedResources=function(a){c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Handling terminated resources  error"),a.container?(c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to resource error",a.container.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*a.container.retryAfter)):a.presenceSubscription?(c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to subscription resource error",a.presenceSubscription.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*a.presenceSubscription.retryAfter)):a.presencePublication&&(c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restarting container due to publication resource error",a.presencePublication.terminationReason),setTimeout(this._recreatePresenceContainer.bind(this),1e3*a.presencePublication.retryAfter))},d.prototype._processPresenceDocument=function(a){var b=c.Base.Utils,d=c.Providers.CallServiceGateway.Utils,e=b.queryJSONObject(a,"presenceDoc.userIdentity.userId").replace("pres:","");c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Processing presence document for User ID",e);var f=this._subscriptionsDeferredMap[e];if(f)f.resolve(),delete this._subscriptionsDeferredMap[e],-1===this._userSubscriptions.indexOf(e)&&this._userSubscriptions.push(e);else if(-1===this._userSubscriptions.indexOf(e))return void c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscription list does not include address "+e+", the presence information for this user will be ignored.");var g=new c.Services.Presence.Presence(e),f=b.queryJSONObject(a,"presenceSummary.stateEnum");
g._setOverallState(d.convertCSGPresenceStateToPresenceState(f)),f=b.queryJSONObject(a,"manualState.stateEnum"),g._setManualState(d.convertCSGPresenceStateToPresenceState(f)),f=b.queryJSONObject(a,"mode.modeEnum"),g._setLocationMode(d.convertCSGPresenceModeToPresenceMode(f)),g._setNote(b.queryJSONObject(a,"note.content")),f=a.channelPresence[0],a=b.queryJSONObject(f,"video.stateEnum"),g._setVideoState(d.convertCSGPresenceStateToPresenceState(a)),g._setVideoContact(b.queryJSONObject(f,"video.contact")),a=b.queryJSONObject(f,"phone.stateEnum"),g._setPhoneState(d.convertCSGPresenceStateToPresenceState(a)),g._setPhoneContact(b.queryJSONObject(f,"phone.contact")),a=b.queryJSONObject(f,"im.stateEnum"),g._setEnterpriseIMState(d.convertCSGPresenceStateToPresenceState(a)),g._setEnterpriseIMContact(b.queryJSONObject(f,"im.contact")),a=b.queryJSONObject(f,"calendar.stateEnum"),g._setCalendarState(d.convertCSGPresenceStateToPresenceState(a)),a=b.queryJSONObject(f,"calendar.compoundFrom"),a&&g._setCalendarStartTime(new Date(a)),f=b.queryJSONObject(f,"calendar.compoundUntil"),f&&g._setCalendarEndTime(new Date(f)),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received presence status of "+e),setTimeout(function(){this.trigger(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,[g])}.bind(this),0)},d.prototype._processPresentities=function(a){var b=c.Base.Utils,d=b.queryJSONObject(a,"userIdentity.userId");"terminated"!==b.queryJSONObject(a,"status")||(a=this._subscriptionsDeferredMap[d])&&(c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription terminated. Provided address might be invalid.",d),a.reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.INVALID_REQUEST)),delete this._subscriptionsDeferredMap[d])},d.prototype.subscribeForSingleAddressPresence=function(a){var c=this._subscriptionsDeferredMap[a];return c||(c=b.Deferred(),this._subscriptionsDeferredMap[a]=c,this._sendSubscribeRequest()),c.promise()},d.prototype.subscribeForPresence=function(a){return a.forEach(function(a){this._subscriptionsDeferredMap[a]||(this._subscriptionsDeferredMap[a]=b.Deferred())}.bind(this)),this._sendSubscribeRequest()},d.prototype._sendSubscribeRequest=function(){return Object.keys(this._subscriptionsDeferredMap).forEach(function(a){this._unsubscriptionsDeferredMap[a]&&(this._unsubscriptionsDeferredMap[a].reject(),delete this._unsubscriptionsDeferredMap[a])}.bind(this)),this._dfdPresenceSubscription||(this._dfdPresenceSubscription=b.Deferred(),this._subscribePresenceTimeoutId=setTimeout(function(){var b=this._dfdPresenceSubscription;this._dfdPresenceSubscription=a;var d=Object.keys(this._subscriptionsDeferredMap);d.length&&this._updatePresenceSubscription(f.SUBSCRIPTION_ADD,d).done(function(){this._subscribedForPresence=!0,this._userSubscriptions=this._userSubscriptions.concat(d),b.resolve()}.bind(this)).fail(function(a){d.forEach(function(b){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to subscribe for "+b+" presence",a),this._subscriptionsDeferredMap[b].reject(a),delete this._subscriptionsDeferredMap[b]}.bind(this)),b.reject(a)}.bind(this))}.bind(this),this._timeoutForSubscribe)),this._dfdPresenceSubscription.promise()},d.prototype.unsubscribeFromSingleAddressPresence=function(a){var c=this._unsubscriptionsDeferredMap[a];return c||(c=b.Deferred(),this._unsubscriptionsDeferredMap[a]=c,this._sendUnsubscribeRequest()),c.promise()},d.prototype.unsubscribeFromPresence=function(a){return a.forEach(function(a){this._unsubscriptionsDeferredMap[a]||(this._unsubscriptionsDeferredMap[a]=b.Deferred())}.bind(this)),this._sendUnsubscribeRequest()},d.prototype._sendUnsubscribeRequest=function(){return Object.keys(this._unsubscriptionsDeferredMap).forEach(function(a){this._subscriptionsDeferredMap[a]&&(this._subscriptionsDeferredMap[a].reject(),delete this._subscriptionsDeferredMap[a])}.bind(this)),this._dfdPresenceUnsubscription||(this._dfdPresenceUnsubscription=b.Deferred(),setTimeout(function(){var b=this._dfdPresenceUnsubscription;this._dfdPresenceUnsubscription=a;var d=Object.keys(this._unsubscriptionsDeferredMap);d.length&&this._updatePresenceSubscription(f.SUBSCRIPTION_REMOVE,d).then(function(){this._userSubscriptions=this._userSubscriptions.filter(function(a){return-1===d.indexOf(a)}),0===this._userSubscriptions.length&&(this._subscribedForPresence=!1),d.forEach(function(a){this._unsubscriptionsDeferredMap[a].resolve(),delete this._unsubscriptionsDeferredMap[a]}.bind(this)),b.resolve()}.bind(this),function(a){d.forEach(function(b){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to unsubscribe from "+b+" presence",a),this._unsubscriptionsDeferredMap[b].reject(a),delete this._unsubscriptionsDeferredMap[b]}.bind(this)),b.reject(a)}.bind(this))}.bind(this),this._timeoutForUnsubscribe)),this._dfdPresenceUnsubscription.promise()},d.prototype.unsubscribeFromAllAddressesPresence=function(){return 0===this._userSubscriptions.length?b.Deferred().resolve():this._updatePresenceSubscription(f.SUBSCRIPTION_REMOVE,this._userSubscriptions).then(function(){this._userSubscriptions=[],this._subscribedForPresence=!1}.bind(this))},d.prototype._updatePresenceSubscription=function(a,d){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Updating presence subscriptions list",[a,d]);var e=b.Deferred(),f=function(a){this._onSubscriptionSucceeded(),e.resolve(a)}.bind(this),g=function(a){c.Base.Utils.queryJSONObject(a,"_data._status")===c.Base.NetworkErrorCodes.HTTP_SERVICE_UNAVAILABLE?setTimeout(function(){this._onSubscriptionFailed(),i()}.bind(this),0):e.reject(a)}.bind(this),h=function(a){a===c.Base.NetworkProviderEvents.RETRYING&&this._onSubscriptionFailed()}.bind(this),i=function(){this._getContainerAndSend(function(b){var c=this._messageBuilder.buildPresenceSubscriptionData(a,d),b=this._messageBuilder.buildPresenceSubscriptionOptions(b.additionalResources.presenceSubscriptions[0].replace.href);return this._csgProvider.send(c,b)}.bind(this)).done(f).fail(g).progress(h)}.bind(this);return i(),e.promise()},d.prototype._onSubscriptionFailed=function(){this._subscriptionStatusUnknown||(this._subscriptionStatusUnknown=!0,this._userSubscriptions.forEach(function(a){a=this._buildUnknownPresence(a),this.trigger(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,[a])}.bind(this)))},d.prototype._onSubscriptionSucceeded=function(){var b,d;this._subscriptionStatusUnknown&&(this._subscriptionStatusUnknown=!1,0<this._userSubscriptions.length&&(b=this._userSubscriptions.slice(0),d=function(){return this.unsubscribeFromAllAddressesPresence().then(function(){this.subscribeForPresence(b)}.bind(this))}.bind(this),c.Base.Utils.connectionBackoffAlgorithm(d,a,this._resuscribeFnRetryInterval)))},d.prototype.publishAutomaticPresence=function(a){return this._getContainerAndSend(function(b){var c=b.additionalResources.presencePublication.replace.href,b=this._messageBuilder.buildPublishPresenceOptions(c),c=this._messageBuilder.buildPublishAutoPresenceData(a);return this._csgProvider.send(c,b)}.bind(this))},d.prototype.publishManualState=function(a){var b,d,e;return this._presenceStateAlreadyChanged||(this.publishOfflineManualState(),this._presenceStateAlreadyChanged=!0),a&&a!==c.Services.Presence.PresenceState.PRESENCE_STATE_UNSPECIFIED?(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PublishPresenceState],b=this._messageBuilder.buildPublishPresenceOptions(e),d=this._messageBuilder.buildPublishManualPresenceData(f.MANUAL_STATE,a)):(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.DeletePresenceState],b=this._messageBuilder.buildDeleteManualPresenceOptions(e)),this._getContainerAndSend(function(){return this._csgProvider.send(d,b)}.bind(this))},d.prototype.publishOfflineManualState=function(){var a=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PublishPresenceState],b=this._messageBuilder.buildPublishPresenceOptions(a),d=this._messageBuilder.buildPublishManualPresenceData(f.MANUAL_STATE,c.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE);return this._getContainerAndSend(function(){return this._csgProvider.send(d,b)}.bind(this))},d.prototype.publishLocationMode=function(a){var b,d,e;return a&&a!==c.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_UNSPECIFIED?(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PublishPresenceMode],b=this._messageBuilder.buildPublishPresenceOptions(e),d=this._messageBuilder.buildPublishManualPresenceData(f.MODE,a)):(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.DeletePresenceMode],b=this._messageBuilder.buildDeleteManualPresenceOptions(e)),this._getContainerAndSend(function(){return this._csgProvider.send(d,b)}.bind(this))},d.prototype.publishNote=function(a){var b,d,e;return a&&""!==a?(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.PublishPresenceNote],b=this._messageBuilder.buildPublishPresenceOptions(e),d=this._messageBuilder.buildPublishManualPresenceData(f.NOTE,a)):(e=this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.DeletePresenceNote],b=this._messageBuilder.buildDeleteManualPresenceOptions(e)),this._getContainerAndSend(function(){return this._csgProvider.send(d,b)}.bind(this))},d.prototype._getContainerAndSend=function(a){var c=b.Deferred(),d=function(){this._started?this._getPresenceContainer().then(a).then(function(a){c.resolve(a)},function(a){this._onErrorGetPresenceContainer(a).then(function(){setTimeout(d,0)}.bind(this),function(a){c.reject(a)}.bind(this))}.bind(this),function(a){c.notify(a)}):c.reject("Presence service has NOT started")}.bind(this);return d(),c.promise()},d.prototype._onErrorGetPresenceContainer=function(d){var e=b.Deferred();this._createOrExtendPresenceContainerPromise=a;var f=c.Base.Utils.queryJSONObject(d,"_data._status");if(f===c.Base.NetworkErrorCodes.HTTP_NOT_FOUND||f===c.Base.NetworkErrorCodes.HTTP_BAD_REQUEST||f===c.Base.NetworkErrorCodes.HTTP_UNPROCESSABLE_ENTITY)switch(this._parseErrorCode(d.getData().getResponseText())){case 404001:case 4000004:return c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence container expired/invalidated"),this._recreatePresenceContainer();case 4040012:return c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence subscription is unknown"),c.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presenceSubscriptions[0]")&&(this._presenceContainer.additionalResources.presenceSubscriptions[0]=a),e.resolve().promise();case 4040011:case 4220085:return c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence session is invalid"),this._createContainerAndSubscribe()}return e.reject(d).promise()},d.prototype._recreatePresenceContainer=function(){return this._deletePresenceContainer().then(this._createContainerAndSubscribe.bind(this))},d.prototype._createContainerAndSubscribe=function(){return this._presenceContainer=a,this._createOrExtendPresenceContainer(!0,!0).then(function(){this.subscribeForPresence(this._userSubscriptions)}.bind(this))},d.prototype._parseErrorCode=function(a){var b,d,e;try{0<a.length&&("object"==(e=typeof(d=JSON.parse(a)))?b=c.Base.Utils.queryJSONObject(d,"error[0].errorCode"):"string"==e&&(d=JSON.parse(d),b=c.Base.Utils.queryJSONObject(d,"error[0].serviceErrorCode")))}catch(a){c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to parse error response",a)}return b},d.prototype._getPresenceContainer=function(){var a=!1,d=!1;if(this._presenceContainer){if(Date.now()<this._presenceContainerExpirationDate.getTime()&&(a=!c.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presenceSubscriptions[0]"),d=!c.Base.Utils.queryJSONObject(this._presenceContainer,"additionalResources.presencePublication"),!a&&!d))return c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Current presence subscription container should be valid, using it"),b.Deferred().resolve(this._presenceContainer)}else a=d=!0;return this._createOrExtendPresenceContainer(d,a)},d.prototype._createOrExtendPresenceContainer=function(d,e){var f,g;return this._createOrExtendPresenceContainerPromise||(f=b.Deferred(),g=c.Base.Utils.queryJSONObject(this._presenceContainer,"containerResources.container.updateOrExtend.href")||this._csgProvider.getResourceHrefs()[c.Providers.CallServiceGateway.ResourceType.CreatePresenceContainer],c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Creating/updating presence container. Container exists: "+!!this._presenceContainer+", Publication resource needed: "+d+", Subscription resource needed: "+e),this._createOrExtendPresenceContainerPromise=f.promise(),g=this._messageBuilder.buildCreatePubSubContainerOptions(g),e=this._messageBuilder.buildCreateOrExtendPubSubContainerData(!!this._presenceContainer,d,e),this._csgProvider.send(e,g).then(function(d){return this._presenceContainer=this._parsePresenceContainerResponse(d)||this._presenceContainer,this._presenceContainer?(this._presenceContainerRefreshTimeoutId=setTimeout(this._createOrExtendPresenceContainer.bind(this),.8*this._presenceContainer.expires*1e3),this._createOrExtendPresenceContainerPromise=a,f.resolve(this._presenceContainer),void 0):b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.INVALID_RESPONSE,"Received invalid response from server to create presence container request"))}.bind(this),function(b){this._createOrExtendPresenceContainerPromise=a,f.reject(b)}.bind(this))),this._createOrExtendPresenceContainerPromise},d.prototype._deletePresenceContainer=function(){var d,e,f;return this._deletePresenceContainerPromise||(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Deleting presence container"),d=b.Deferred(),f=c.Base.Utils.queryJSONObject(this._presenceContainer,"containerResources.container.delete.href"),this._deletePresenceContainerPromise=d.promise(),e=function(){this._presenceContainer=a,this._deletePresenceContainerPromise=a,d.resolve(),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Deleted presence container")}.bind(this),f?(f=this._messageBuilder.buildDeletePubSubContainerOptions(f),this._csgProvider.send(a,f).then(e,e)):e()),this._deletePresenceContainerPromise},d.prototype._parsePresenceContainerResponse=function(a){var d;try{d=JSON.parse(a)}catch(a){}if(d&&d.pubSubContainer){var e=b.extend(new c.Providers.CallServiceGateway.CSGPresenceContainer,d.pubSubContainer);if(e.expires&&e.containerResources.container.updateOrExtend.href&&e.additionalResources.presencePublication.replace.href&&e.additionalResources.presenceSubscriptions[0].replace.href)return this._presenceContainerExpirationDate=new Date(Date.now()+1e3*e.expires),e}},d.prototype._buildUnknownPresence=function(b){return b=new c.Services.Presence.Presence(b),b._setOverallState(c.Services.Presence.PresenceState.PRESENCE_STATE_UNKNOWN),b._setManualState(c.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNKNOWN),b._setVideoState(c.Services.Presence.VideoPresenceState.PRESENCE_STATE_UNKNOWN),b._setVideoContact(a),b._setPhoneState(c.Services.Presence.PhonePresenceState.PRESENCE_STATE_UNKNOWN),b._setPhoneContact(a),b._setEnterpriseIMState(c.Services.Presence.IMPresenceState.PRESENCE_STATE_UNKNOWN),b._setEnterpriseIMContact(a),b._setCalendarState(c.Services.Presence.CalendarPresenceState.PRESENCE_STATE_UNKNOWN),b._setCalendarStartTime(a),b._setCalendarEndTime(a),b},d.prototype.activateService=function(a,b){a.toUpperCase()===f.PRESENCE&&c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Presence activation status: "+b)},c.Providers.CallServiceGateway.CSGPresenceProvider=d}(AvayaClientServices),function(a){"use strict";function c(b,c){a.Providers.Interfaces.AbstractProvider.call(this),this._callProvider=b,this._ownerCallId=c,this._isVideoAllowed=!1,c=this._callProvider.lookupCall(this._ownerCallId),c&&(c=c._callService.getVideoCapability(),this._isVideoAllowed=c.isAllowed,c.addOnChangedCallback(this._monitorVideoCapability.bind(this)))}(c.prototype=Object.create(a.Providers.Interfaces.AbstractProvider.prototype)).start=function(c,d){return c._isVideoAllowed=this._isVideoAllowed,c._recalculateInConferenceChatCapability(),a.Base.Logger.info(a.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"started..."),b.Deferred().resolve()},c.prototype.stop=function(){var c=this._callProvider.lookupCall(this._ownerCallId);return c&&c._callService.getVideoCapability().removeOnChangedCallback(this._monitorVideoCapability.bind(this)),a.Base.Logger.info(a.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"stopped..."),b.Deferred().resolve()},c.prototype._monitorVideoCapability=function(a){this._isVideoAllowed=a.isAllowed},c.prototype.observeConference=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"observeConference method is not implemented"))},c.prototype.disconnectParticipant=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"disconnectParticipant method is not implemented"))},c.prototype.setAsLecturer=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setAsLecturer method is not implemented"))},c.prototype.setLocked=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setLocked method is not implemented"))},c.prototype.setVideoLayoutTextOverlay=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayoutTextOverlay method is not implemented"))},c.prototype.setVideoLayoutSelfSee=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayoutSelfSee method is not implemented"))},c.prototype.setVideoLayout=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"setVideoLayout method is not implemented"))},c.prototype.terminateConference=function(){return a.Base.Logger.info(a.Base.LoggerTags.CM_CONFERENCE_PROVIDER,"terminated..."),b.Deferred().resolve()},c.prototype.removeLastParticipant=function(){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"removeLastParticipant method is not implemented"))},c.prototype.requestToBecomeModerator=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"requestToBecomeModerator method is not implemented"))},c.prototype.signIn=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"signIn method is not implemented"))},c.prototype.changeParticipantName=function(c,d){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"changeParticipantName method is not implemented"))},c.prototype.videoPin=function(c,d,e,f,g){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"videoPin method is not implemented"))},c.prototype.extendMeeting=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"extendMeeting method is not implemented"))},c.prototype.addParticipant=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"addParticipant method is not implemented"))},c.prototype.addParticipantFromCall=function(a){return this._callProvider.addParticipantFromCall(this._ownerCallId,a)},c.prototype.cancelDialoutParticipant=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"cancelDialoutParticipant method is not implemented"))},c.prototype.startRecording=function(c,d,e){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"startRecording method is not implemented"))},c.prototype.stopRecording=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"stopRecording method is not implemented"))},c.prototype.pauseRecording=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"pauseRecording method is not implemented"))},c.prototype.resumeRecording=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"resumeRecording method is not implemented"))},c.prototype.unsetAsLecturer=function(){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"unsetAsLecturer method is not implemented"))},c.prototype.controlRemoteCamera=function(c,d){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"controlRemoteCamera method is not implemented"))},c.prototype.muteUnmute=function(c,d,e){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"muteUnmute method is not implemented"))},c.prototype.sendChatMessage=function(c,d){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"sendChatMessage method is not implemented"))},c.prototype.muteUnmuteAll=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"muteUnmuteAll method is not implemented"))},c.prototype.raiseLowerHand=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"raiseLowerHand method is not implemented"))},c.prototype.moderatorLowerHand=function(c,d){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"moderatorLowerHand method is not implemented"))},c.prototype.getDialInInfo=function(){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"getDialInInfo method is not implemented"))},c.prototype.sendDisconnectEvent=function(c){return b.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"sendDisconnectEvent method is not implemented"))},c.prototype.recalculateAddParticipantFromCallCapability=function(b,c){var d,e=this._callProvider.lookupCall(this._ownerCallId),e=!e||e.getState()!==a.Services.Call.CallStates.ESTABLISHED||c.isConference()&&e.getConference()._isAvailable&&e.getConference()._getType()===c.getConference()._getType()?(d=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(d=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);b._addParticipantFromCallCapabilities[c.getCallId()]._updateIfChanged(d,e)},c.prototype.recalculateAddParticipantFromCallCapabilityByCallId=function(a,b){b=this._callProvider.lookupCall(b),b&&this.recalculateAddParticipantFromCallCapability(a,b)},c.prototype.sendLocalMuteEvent=function(a,c){return b.Deferred().resolve().promise()},a.Providers.CM.CMConferenceProvider=c}(AvayaClientServices),function(c){"use strict";function d(b,d,f,g,h,i){c.Providers.Interfaces.AbstractProvider.call(this),this._collaborationProvider=b,this._screenCapturer=d,this._shareApplicationWindowCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareFullScreenCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareAnyTypeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareContentVideoCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingTagBuilder=f,this._bandwidthManager=g,this._screenSharingTagEncoder=h,this._startDeferred=a,this._isAcksActivated=!0,this._isFirstSendFrameCall=!0,this._browser=c.Base.Utils.getBrowserType(),this._config=i,this._outgoingScreenSharingStream=a,this._outgoingVideoSharingStream=a,this._maxUploadSpeed=a,this._screenCapturerEndedCallback=a,this._config&&c.Base.Utils.isDefined(this._config.imageQuality)?this.setImageQuality(this._config.imageQuality):this.setImageQuality(1),this._contentSharingTagBuilder&&this._contentSharingTagBuilder.setJpegImageQuality&&this._contentSharingTagBuilder.setJpegImageQuality(e[this._imageQuality].jpegQuality)}var e={1:{colorLimit:32,jpegQuality:.35},2:{colorLimit:32,jpegQuality:.4},3:{colorLimit:32,jpegQuality:.5},4:{colorLimit:64,jpegQuality:.5},5:{colorLimit:64,jpegQuality:.6},6:{colorLimit:64,jpegQuality:.7},7:{colorLimit:128,jpegQuality:.7},8:{colorLimit:128,jpegQuality:.8},9:{colorLimit:256,jpegQuality:.9},10:{colorLimit:256,jpegQuality:1}};(d.prototype=Object.create(c.Providers.Interfaces.AbstractProvider.prototype)).start=function(){this._updateToFeatureSuportedCapabilities()},d.prototype._updateToFeatureSuportedCapabilities=function(){this._turnCapabilities(c.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable(),c.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable(),c.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable(),c.Providers.ContentSharing.FeatureSupported.isSharingContentVideoAvailable())},d.prototype.stop=function(){this._turnCapabilities(!1,!1,!1,!1)},d.prototype._turnCapabilities=function(a,b,c,d){this._turnCapability(this._shareApplicationWindowCapability,a),this._turnCapability(this._shareFullScreenCapability,b),this._turnCapability(this._shareAnyTypeCapability,c),this._turnCapability(this._shareContentVideoCapability,d)},d.prototype._turnCapability=function(a,b){var d=b?c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED;a._updateIfChanged(b,d)},d.prototype.setExtensionAvailable=function(a){c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+" doesn't support third-party extensions for screen sharing")},d.prototype.isDisplayMediaAvailable=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},d.prototype.startScreenSharing=function(){return this._screenCapturer.on(c.Providers.ContentSharing.ScreenCapturerEvents.BLOCKS_CHANGED,function(a,b,c){this.sendFrame(a,b,c)}.bind(this)),this._screenCapturer.on(c.Providers.ContentSharing.ScreenCapturerEvents.WINDOW_CLOSED,function(){this._screenCapturerEndedCallback&&this._screenCapturerEndedCallback(this)}.bind(this)),this._updateServerCapabilities=function(a){this._screenCapturer.setServerCapabilities(a)}.bind(this),this._collaborationProvider.on(c.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities),this._startScreenSharing()},d.prototype.setScreenCapturerEndedHandler=function(a){this._screenCapturerEndedCallback=a},d.prototype.sendFrame=function(a,b,d){this._isFirstSendFrameCall&&(this._isAcksActivated=this._collaborationProvider.getAcksActivated(),this._bandwidthManager.setAcksActivated(this._isAcksActivated),this._isFirstSendFrameCall=!1);var e=(new Date).getTime(),f=new c.Providers.ContentSharing.FrameBlocks(b),b=this._contentSharingTagBuilder.createStartTag(b,b?this._screenCapturer.getWidth():0,b?this._screenCapturer.getHeight():0,this._isAcksActivated),b=this._screenSharingTagEncoder.encodeTag(b);f.addBlock(b),a.forEach(function(a){a=this._contentSharingTagBuilder.createBlockTag(a,this._isAcksActivated),a=this._screenSharingTagEncoder.encodeTag(a),f.addBlock(a)}.bind(this)),f.addBlock(this._screenSharingTagEncoder.encodeTag(this._contentSharingTagBuilder.createEndTag(this._isAcksActivated))),a=(new Date).getTime(),f.processingTime=d,this._bandwidthManager.addToEncodingTimes(a-e),this._bandwidthManager.addToQueue(f)},d.prototype.startFullScreen=function(a){throw c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"MUST override AbstractScreenSharingProvider.startFullScreen(mediaSourceId)"),new Error("Cannot start fullscreen sharing. Unknown provider.")},d.prototype.startApplicationWindow=function(a){throw c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"MUST override AbstractScreenSharingProvider.startApplicationWindow(mediaSourceId)"),new Error("Cannot start window sharing. Unknown provider.")},d.prototype.startSharingAnyType=function(a){return this._startDeferred=b.Deferred(),!0===this._shareAnyTypeCapability.isAllowed?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Start sharing..."),a?this._onRetrievingStreamSucceeded(a):this._getDisplayMedia(),this._startDeferred.promise()):(c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": An attempt to start sharing any type - failed"),this._startDeferred.reject(c.Base.Utils.getBrowserName()+' doesn\'t support this method. Use "startApplicationWindow or "startFullScreen" instead').promise())},d.prototype.startSharingWithVideo=function(a,d,e){var f;return this._startDeferred=b.Deferred(),!0===this._shareContentVideoCapability.isAllowed?(d?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Start video content sharing through electron app. Share audio = "+e),d={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:30}}},f={},f=e?c.Base.Utils.deepMerge({audio:{mandatory:{echoCancellation:!0,chromeMediaSource:"desktop"}}},d):c.Base.Utils.deepMerge({audio:!1},d),this._getUserMediaForSharingUsingVideo(f,a)):(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Start video content sharing..."),f=a.getNegotiatedVideoResolution(),f={video:{frameRate:{max:30},height:{max:Math.min(720,f.getHeight())},width:{max:Math.min(1280,f.getWidth())}},audio:{echoCancellation:!0,autoGainControl:!1}},this._getDisplayMediaFromBrowser(f).then(this._onRetrievingContentVideoStreamSuccess.bind(this,a))["catch"](function(a){var b="Failed to retrieve stream: ";return a&&a.message&&(b+=a.message),c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": getDisplayMedia failed with Error: "+b),this._startDeferred.reject(a)}.bind(this))),this._startDeferred.promise()):(c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": An attempt to start sharing any type - failed"),this._startDeferred.reject(c.Base.Utils.getBrowserName()+' doesn\'t support this method. Use "startApplicationWindow or "startFullScreen" instead').promise())},d.prototype.updateAudioSourceForVideoSharing=function(a,b){return a.updateAudioSourceForVideoSharing(b);
},d.prototype._onRetrievingContentVideoStreamSuccess=function(a,b){a.setVideoSharingStream(b),this._outgoingVideoSharingStream=new MediaStream,b.getVideoTracks().forEach(function(a){this._outgoingVideoSharingStream.addTrack(a)}.bind(this)),c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Start content video ... callId ="+a._callId);var d=function(a){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,a),b.getTracks().forEach(function(a){a.stop()}),this._startDeferred.reject(a)}.bind(this);this._collaborationProvider.startVideoSharing().then(function(){a.sendContentVideoSharingStream(b).then(function(){this._startDeferred.resolve(b),c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Start content video success.")}.bind(this),function(a){d(a)}.bind(this))}.bind(this),function(a){d(a)})},d.prototype.stopSharingWithVideo=function(d,e,f){c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Stop content video ... callId ="+e),this.clearOutgoingVideoSharingStream();var g=b.Deferred(),h=function(b){d.stopContentVideoSharing(b).then(function(){c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Stop content video success."),g.resolve()}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,a),g.reject(a)}.bind(this)).always(function(){if(this._updateServerCapabilities){try{this._collaborationProvider.off(c.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities)}catch(b){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,b)}this._updateServerCapabilities=a}}.bind(this))}.bind(this);return!0===f?this._collaborationProvider.stopVideoSharing().then(function(){h(e)}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,a),g.reject(a)}):h(e),g.promise()},d.prototype.stopScreenSharing=function(b){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,c.Base.Utils.getBrowserName()+": Stop sharing..."),this.clearOutgoingScreenSharingStream(),this.stopScreenCapturer().then(function(){return this._bandwidthManager.stop()}.bind(this)).then(function(){if(!b)return this._stopScreenSharing()}.bind(this)).always(function(){if(this._updateServerCapabilities){try{this._collaborationProvider.off(c.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,this._updateServerCapabilities)}catch(b){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,b)}this._updateServerCapabilities=a}}.bind(this))},d.prototype.stopScreenCapturer=function(){return this._screenCapturer.stop()},d.prototype.pause=function(){return this._bandwidthManager.pause(),c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Pause sharing..."),this._bandwidthManager.pause(),this._outgoingScreenSharingStream&&this._outgoingScreenSharingStream.getTracks().forEach(function(a){a.enabled=!1}),this._screenCapturer.pause().then(function(a){return a||this._pauseScreenSharing()}.bind(this))},d.prototype.resume=function(){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Resume sharing..."),this._bandwidthManager.resume(),this._outgoingScreenSharingStream&&this._outgoingScreenSharingStream.getTracks().forEach(function(a){a.enabled=!0}),this._screenCapturer.resume().then(function(a){return a&&this._startScreenSharing()}.bind(this))},d.prototype.getShareApplicationWindowCapability=function(){return this._shareApplicationWindowCapability},d.prototype.getShareFullScreenCapability=function(){return this._shareFullScreenCapability},d.prototype.getShareAnyTypeCapability=function(){return this._shareAnyTypeCapability},d.prototype.getStartSharingUsingVideoCapability=function(){return this._shareContentVideoCapability},d.prototype.getOutgoingScreenSharingStream=function(){return this._outgoingScreenSharingStream},d.prototype.getOutgoingVideoSharingStream=function(){return this._outgoingVideoSharingStream},d.prototype.isOpened=function(){return this._collaborationProvider.isOpened()},d.prototype.setImageQuality=function(a){a<1||10<a?(c.Base.Logger.warn("Failed to set unsupported image quality:"+a),this._imageQuality||this.setImageQuality(1)):(this._imageQuality=a,c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Selected image quality ["+e[this._imageQuality].colorLimit+", "+e[this._imageQuality].jpegQuality+"]"),this._contentSharingTagBuilder&&this._contentSharingTagBuilder.setJpegImageQuality&&this._contentSharingTagBuilder.setJpegImageQuality(e[this._imageQuality].jpegQuality))},d.prototype.getImageQuality=function(){return this._imageQuality},d.prototype._startScreenSharing=function(){return this._collaborationProvider.startScreenSharing()},d.prototype._startVideoSharing=function(){return this._collaborationProvider.startVideoSharing()},d.prototype._stopScreenSharing=function(){return this._collaborationProvider.stopScreenSharing()},d.prototype._pauseScreenSharing=function(){return this._collaborationProvider.pauseScreenSharing()},d.prototype.clearOutgoingScreenSharingStream=function(){this._outgoingScreenSharingStream&&(this._outgoingScreenSharingStream.getTracks().forEach(function(a){a.stop()}),this._outgoingScreenSharingStream=a)},d.prototype.clearOutgoingVideoSharingStream=function(){this._outgoingVideoSharingStream&&(this._outgoingVideoSharingStream.getTracks().forEach(function(a){a.stop()}),this._outgoingVideoSharingStream=a)},d.prototype._getDisplayMedia=function(a){var b=c.Base.Utils.deepMerge({},a),d=this._shareApplicationWindowCapability.isAllowed,e=this._shareFullScreenCapability.isAllowed,f=this._shareAnyTypeCapability.isAllowed,a=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),this._getDisplayMediaFromBrowser(b).then(this._onRetrievingStreamSucceeded.bind(this),this._onRetrievingStreamFailed.bind(this))["finally"](this._turnCapabilities.bind(this,d,e,f,a))},d.prototype._getDisplayMediaFromBrowser=function(a){return navigator.mediaDevices.getDisplayMedia(a)},d.prototype._getUserMediaForSharingUsingVideo=function(a,b){var c=this._shareApplicationWindowCapability.isAllowed,d=this._shareFullScreenCapability.isAllowed,e=this._shareAnyTypeCapability.isAllowed,f=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),navigator.mediaDevices.getUserMedia(a).then(this._onRetrievingContentVideoStreamSuccess.bind(this,b),this._onRetrievingStreamFailed.bind(this))["finally"](this._turnCapabilities.bind(this,c,d,e,f))},d.prototype._getUserMedia=function(a){var b=this._shareApplicationWindowCapability.isAllowed,c=this._shareFullScreenCapability.isAllowed,d=this._shareAnyTypeCapability.isAllowed,e=this._shareContentVideoCapability.isAllowed;this._turnCapabilities(!1,!1,!1,!1),navigator.mediaDevices.getUserMedia(a).then(this._onRetrievingStreamSucceeded.bind(this),this._onRetrievingStreamFailed.bind(this))["finally"](this._turnCapabilities.bind(this,b,c,d,e))},d.prototype._onRetrievingStreamSucceeded=function(a){var d;!1===this._collaborationProvider._selectedProvider._isShutdown?(this._outgoingScreenSharingStream=a.clone(),(d=b.extend(new c.Providers.ContentSharing.ScreenCapturerConfig,this._config,this._collaborationProvider.getServerCapabilities())).losslessColorLimit=e[this._imageQuality].colorLimit,this._maxUploadSpeed&&(d.maxBytesPerSecond=this._maxUploadSpeed/8*1e3),this._screenCapturer.isFrameNeeded=this._isFrameNeededCallback.bind(this),this._screenCapturer.start(a,d,this._browser).then(function(){return this._bandwidthManager.start(this._screenCapturer._config),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.startScreenSharing.call(this)}.bind(this)).then(function(){"pending"===this._startDeferred.state()&&this._startDeferred.resolve()}.bind(this),function(a){"pending"===this._startDeferred.state()&&this._startDeferred.reject(a)}.bind(this))):(a.getTracks().forEach(function(a){a.stop()}),this._startDeferred.reject(new Error("Couldn't start screencapture on a shutdowned component")))},d.prototype._onRetrievingStreamFailed=function(a){var b="Failed to retrieve stream: ";a&&a.message&&(b+=a.message),c.Base.Logger.warn(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,b),"pending"===this._startDeferred.state()&&this._startDeferred.reject(a)},d.prototype._isFrameNeededCallback=function(a){return this._bandwidthManager.isFrameNeeded(a)},d.prototype.setMaxUploadSpeed=function(a){this._bandwidthManager.setMaxUploadSpeed(a),this._maxUploadSpeed=a},d.prototype.getMaxUploadSpeed=function(){return this._maxUploadSpeed},c.Providers.ContentSharing.AbstractScreenSharingProvider=d}(AvayaClientServices),function(c,d){"use strict";function e(b,d,e,f,g,h,i,j){c.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,b,d,e,f,g,h),this._networkProvider=i,this._networkProvider.addOnCapabilityChange(this._capabilityUpdate()),this._extensionRequestBuilder=j,this._mediaSourceId=a}(e.prototype=Object.create(c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).start=function(){this._networkProvider&&this._networkProvider.start(),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.start.call(this)},e.prototype.stop=function(){this._networkProvider&&this._networkProvider.stop(),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.stop.call(this)},e.prototype.setExtensionAvailable=function(a){this._networkProvider.setExtensionAvailable(a)},e.prototype.startFullScreen=function(a,d){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Start full screen sharing..."),this._startDeferred=b.Deferred(),d?this._onRetrievingStreamSucceeded(d):"string"==typeof a?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Using third-party source for screen sharing..."),this._handleMediaAvailableEvent({data:{mediaSourceId:a}})):(this._startEventListener(),this._networkProvider.send(this._extensionRequestBuilder.createStartSharingRequest("screen"))),this._startDeferred.promise()},e.prototype.startApplicationWindow=function(a,d){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Start appl window sharing..."),this._startDeferred=b.Deferred(),d?this._onRetrievingStreamSucceeded(d):"string"==typeof a?(c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Using third-party source for appl window sharing..."),this._handleMediaAvailableEvent({data:{mediaSourceId:a}})):(this._startEventListener(),this._networkProvider.send(this._extensionRequestBuilder.createStartSharingRequest("window"))),this._startDeferred.promise()},e.prototype.stopScreenSharing=function(b){return c.Base.Logger.info(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Chrome: Stop sharing..."),c.Providers.ContentSharing.AbstractScreenSharingProvider.prototype.stopScreenSharing.call(this,b).then(function(){this._networkProvider.send(this._extensionRequestBuilder.createStopSharingRequest(this._mediaSourceId)),this._mediaSourceId=a,this._removeEventListener()}.bind(this))},e.prototype.stopScreenCapturer=function(){return this._removeEventListener(),this._screenCapturer.stop()},e.prototype.isDisplayMediaAvailable=function(){return c.Base.Utils.getBrowserSubType()!==c.Base.BrowserSubType.ELECTRON&&!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},e.prototype._startEventListener=function(){this._networkProvider.addOnMediaAvailableCallback(this._handleMediaAvailableEvent.bind(this)),this._networkProvider.addOnMediaCancelledCallback(this._handleMediaCanceledEvent.bind(this))},e.prototype._removeEventListener=function(){this._networkProvider._onMediaAvailableCallbacks.empty(),this._networkProvider._onMediaCancelledCallbacks.empty()},e.prototype._handleMediaAvailableEvent=function(a){c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"User enabled screen sharing"),this._mediaSourceId=a.data.mediaSourceId,a={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this._mediaSourceId,maxWidth:d.screen.width,maxHeight:d.screen.height,maxFrameRate:3}}},this._getUserMedia(a),this._removeEventListener()},e.prototype._handleMediaCanceledEvent=function(a){c.Base.Logger.error(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,a),this._removeEventListener(),"pending"===this._startDeferred.state()&&this._startDeferred.reject(a)},e.prototype._capabilityUpdate=function(){return function(a,b){if(c.Base.Logger.debug(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Extension: "+a+" is installed? "+b),!1===this._isWorkerConfigValid()){var d="Content sharing worker path is missing";return this._shareApplicationWindowCapability._updateIfChanged(!1,d),void this._shareFullScreenCapability._updateIfChanged(!1,d)}a=a+" extension was "+(b?"installed or enabled":"uninstalled or disabled"),this._shareApplicationWindowCapability._updateIfChanged(b,a),this._shareFullScreenCapability._updateIfChanged(b,a)}.bind(this)},e.prototype._isWorkerConfigValid=function(){return this._config!==a&&"string"==typeof this._config.contentSharingWorkerPath&&0<this._config.contentSharingWorkerPath.length},c.Providers.ContentSharing.ChromeScreenSharingProvider=e}(AvayaClientServices,window),function(a){"use strict";function c(b,c,d,e,f,g){a.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,b,c,d,e,f,g)}(c.prototype=Object.create(a.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).startApplicationWindow=function(){return a.Base.Logger.error(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Edge: An attempt to start application window sharing - failed"),this._startDeferred=b.Deferred(),this._startDeferred.reject('Edge does not support this method. Use "startScreenSharing" instead').promise()},c.prototype.startFullScreen=function(){return a.Base.Logger.error(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Edge: An attempt to start fullscreen sharing - failed"),this._startDeferred=b.Deferred(),this._startDeferred.reject('Edge does not support this method. Use "startScreenSharing" instead').promise()},c.prototype._getDisplayMediaFromBrowser=function(a){return navigator.getDisplayMedia(a)},c.prototype.isDisplayMediaAvailable=function(){return!!navigator.getDisplayMedia},a.Providers.ContentSharing.EdgeScreenSharingProvider=c}(AvayaClientServices),function(a){"use strict";function c(b,c,d,e,f,g){a.Providers.ContentSharing.AbstractScreenSharingProvider.call(this,b,c,d,e,f,g)}var d="screen",e="window";(c.prototype=Object.create(a.Providers.ContentSharing.AbstractScreenSharingProvider.prototype)).startFullScreen=function(c,e){return a.Base.Logger.info(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Firefox: Start full screen sharing..."),this._startDeferred=b.Deferred(),e?this._onRetrievingStreamSucceeded(e):this._getScreenStream(d),this._startDeferred.promise()},c.prototype.startApplicationWindow=function(c,d){return a.Base.Logger.info(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Firefox: Start application window sharing..."),this._startDeferred=b.Deferred(),d?this._onRetrievingStreamSucceeded(d):this._getScreenStream(e),this._startDeferred.promise()},c.prototype._getScreenStream=function(b){a.Base.Logger.debug(a.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"User enabled screen sharing: "+b),b={audio:!1,video:{mediaSource:b,width:{max:window.screen.width},height:{max:window.screen.height},frameRate:{max:3}}},this._getUserMedia(b)},a.Providers.ContentSharing.FirefoxScreenSharingProvider=c}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.UCCP.UCCPMessage.call(this,"activeTalkerChangedEvent"),this.participantId=b}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPActiveTalkerChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPAdmissionResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT),this.textOverlay=b,this.noSelfSee=c,this.videoPin=d,this.geometries=e,this.LPPOn=f}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPAvailableLayoutsChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPChangeLayoutGeometryResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.UCCP.UCCPMessage.call(this,"chatEvent"),this.participantId=b,this.type=c,this.text=e,this.time=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPChatEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CHAT_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPChatResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT),this.textOverlay=b,this.noSelfSee=c,this.geometry=d,this.LPPOn=e}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPCurrentLayoutChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_RESPONSE),this.transId=b,this.responseCode=c,this.textOverlay=d,this.noSelfSee=e,this.geometry=f,this.LPPOn=g}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPCurrentLayoutResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_RESPONSE),this.transId=b,this.responseCode=c,this.webLink=d,this.streamingLink=e,this.dialInInformation=f,this.dialInInformationHtml=g}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDialInInfoResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDialoutCancelResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"dialoutCompletedEvent"),this.participantId=b,this.result=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDialoutCompletedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.DIALOUT_RESPONSE),this.transId=b,this.responseCode=c,this.participantId=d}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDialoutResponse=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT),this.reason=b}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDisconnectEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"disconnectParticipantResponse"),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPDisconnectParticipantResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPExtendMeetingResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.FECC_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPFeccResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k,l){a.Providers.UCCP.UCCPMessage.call(this,"handshakeResponse"),this.transId=b,this.responseCode=c,this.version=d,this.participantId=e,this.externalAdmissionNeeded=f,this.admissionPasscodeNeeded=g,this.admissionPermissionNeeded=h,this.commands=i,this.currentTime=j,this.longPollEmptyResponseTimeout=k,this.knockDoorTimeout=l}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPHandshakeResponse=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST),this.transId=b}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPKeepAliveRequestEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPLectureModeStartResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_RESPONSE),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPLectureModeStopResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"lockMeetingResponse"),this.transId=b,this.responseCode=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPLockMeetingResponse=b}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k,l,m){a.Providers.UCCP.UCCPMessage.call(this,"meetingInfoChangedEvent"),this.media=b,this.locked=c,this.mediaStatus=d,this.lecturerId=e,this.lecturerName=f,this.presenterId=g,this.presenterName=h,this.recording=i,this.streaming=j,this.encrypted=k,this.slidesAvailable=l,this.terminationTime=m}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPMeetingInfoChangedEvent=b}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Providers.UCCP.UCCPMessage.call(this,"meetingTerminationInProgressEvent"),this.reason=b,this.userName=c}b.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPMeetingTerminationInProgressEvent=b}(AvayaClientServices),function(c){"use strict";function d(a){c.Base.RESTProvider.apply(this),this.type=c.Base.ProviderTypes.UCCP_LONG_POLLING_PROVIDER,this._isOpened=!1,this._polling=!1,this._parser=a,this._responsesData={},this._transactionIDLocation="",this._longPollEmptyResponseTimeout=6e4}(d.prototype=Object.create(c.Base.RESTProvider.prototype)).onConnectionUnavailable=function(){},d.prototype.close=function(){this._isOpened?(c.Base.RESTProvider.prototype.close.call(this),this._polling=!1,this._isOpened=!1,this._responsesData={}):this.onClose()},d.prototype.run=function(a){this._isOpened&&this._poll(a)},d.prototype.start=function(a,d,e){return e&&e.transactionIDLocation&&(this._transactionIDLocation=e.transactionIDLocation),this._isOpened?(this.onOpen(),b.Deferred().resolve().promise()):(this._isOpened=!0,this._maxConnectionErrorCount=a.maxConnectionErrorCount||5,c.Base.RESTProvider.prototype.start.call(this,a,d,e))},d.prototype.send=function(a,d,e){var f={},f=d&&d.sendType&&"GET"===d.sendType?this._buildGetRequestOptions():this._buildPostRequestOptions();return e=e||new c.Base.NetworkRequestRetryHelper(function(){return this.send(a,f,e)}.bind(this)),c.Base.RESTProvider.prototype.send.call(this,a,f,e).then(function(a){this._polling||(this._polling=!0,this.run(f))}.bind(this),function(a){return a&&(this._isOpened=!1,this._polling=!1,this.onConnectionUnavailable()),b.Deferred().reject(a).promise()}.bind(this))},d.prototype.abort=function(){this._isOpened=!1,this._polling=!1,this._responsesData={},c.Base.RESTProvider.prototype.abort.call(this)},d.prototype._buildGetRequestOptions=function(){return{sendType:"GET",urlSuffix:"/uwd/rest",timeout:this._longPollEmptyResponseTimeout}},d.prototype._buildPostRequestOptions=function(){return{sendType:"POST",urlSuffix:"/uwd/rest",headers:{"Content-Type":"application/json"}}},d.prototype.isOpened=function(){return this._isOpened},d.prototype._ajaxOnSuccess=function(a,b,c,d){return this._removeXhrFromPool(c),200===c.status&&a&&this._resolveGetResponse(a,c),d.resolve(a,c),a},d.prototype._resolveGetResponse=function(a,b){for(var d=c.Base.Utils.makeId(10),e="}"+d+"{",f=a.replace(/}\\n\\n{/g,e).split(d),g=0;g<f.length;g++){var h=JSON.parse(f[g]),i=c.Base.Utils.queryJSONObject(h,this._transactionIDLocation);h.name===c.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_RESPONSE&&(l=c.Base.Utils.queryJSONObject(h,"params.longPollEmptyResponseTimeout"),this._longPollEmptyResponseTimeout=c.Base.Utils.isDefined(l)?1e3*parseInt(l)+1e4:13e4);var j=this._responsesData[i];if(i&&j){var k,l=j.dfd,j=j.successIndicator;delete this._responsesData[i];try{k=this._parser.parse(h)}catch(a){return void l.reject(a)}k&&k.responseCode&&(j.indexOf?-1<j.indexOf(k.responseCode):k.responseCode===j)?l.resolve(k):(j=400,h&&h.params&&h.params.responseCode&&(j=h.params.responseCode),l.reject({name:"UCCPServerError",code:j,message:"UCCP server responded with "+j}))}else this.onMessage(f[g],b)}},d.prototype._poll=function(b){this._polling&&(b.sendType="GET",this.send(a,b).done(function(){this._poll(b)}.bind(this)))},c.Providers.UCCP.UCCPLongPollingProvider=d}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return b.note&&(c.type=a.Base.Utils.queryJSONObject(b,"note[0]._attr.type._value"),c.text=a.Base.Utils.queryJSONObject(b,"note[0]._text")),c.meetingOwner="Y"===a.Base.Utils.queryJSONObject(b,"_attr.meeting_owner._value"),b._attr.target_id?(c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c.personal=!0):c.personal=!1,c=new a.Providers.WCS.AddNoteEventData(c.type,c.text,c.meetingOwner,c.personal,c.targetId),new a.Providers.WCS.AddNoteEvent(this.stripCommonData(b),c)},a.Providers.WCS.AddNoteParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.AddWhiteboardEvent(this.stripCommonData(b))},a.Providers.WCS.AddWhiteboardParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c=new a.Providers.WCS.AllowPresentingEventData(c.targetId),new a.Providers.WCS.AllowPresentingEvent(this.stripCommonData(b),c)},a.Providers.WCS.AllowPresentingParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.selection[0]._attr&&b.each(c.selection[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.ClearDrawingEventData(d.groupId,d.layerType);return new a.Providers.WCS.ClearDrawingEvent(this.stripCommonData(c),e)},a.Providers.WCS.ClearDrawingParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return b.note&&(c.event_id=a.Base.Utils.queryJSONObject(b,"note[0]._attr.event_id._value")),c=new a.Providers.WCS.DeleteNoteEventData(c.event_id),new a.Providers.WCS.DeleteNoteEvent(this.stripCommonData(b),c)},a.Providers.WCS.DeleteNoteParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.selection[0]._attr&&b.each(c.selection[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.DeleteSelectionEventData(d.groupId,d.layerType,d.id,d.selectionX,d.selectionY);return new a.Providers.WCS.DeleteSelectionEvent(this.stripCommonData(c),e)},a.Providers.WCS.DeleteSelectionParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c=a.Base.Utils.queryJSONObject(b,"whiteboard[0]._attr.index._value"),c=new a.Providers.WCS.DeleteWhiteboardEventData(c);return new a.Providers.WCS.DeleteWhiteboardEvent(this.stripCommonData(b),c)},a.Providers.WCS.DeleteWhiteboardParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.DenyControlEvent(this.stripCommonData(b))},a.Providers.WCS.DenyControlParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c.targetName=a.Base.Utils.queryJSONObject(b,"_attr.target_name._value"),c=new a.Providers.WCS.DenyPresentingEventData(c.targetId,c.targetName),new a.Providers.WCS.DenyPresentingEvent(this.stripCommonData(b),c)},a.Providers.WCS.DenyPresentingParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.circle[0]._attr&&b.each(c.circle[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),a.Base.Utils.isDefined(d.fillColor)&&(d.fillColor=a.Base.Utils.colorIntToHex(d.fillColor),d.filled=!0),a.Base.Utils.isDefined(d.color)&&(d.color=a.Base.Utils.colorIntToHex(d.color),d.contour=!0),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.DrawCircleEventData(d.alpha,d.fillColor,d.color,d.groupId,d.layerType,d.width,d.x0,d.x1,d.y0,d.y1,d.filled,d.contour);return new a.Providers.WCS.DrawCircleEvent(this.stripCommonData(c),e)},a.Providers.WCS.DrawCircleParser=c}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){
var d={},e=[],f=[];c.m?f.push({x:a.Base.Utils.queryJSONObject(c,"m[0]._attr.x._value"),y:a.Base.Utils.queryJSONObject(c,"m[0]._attr.y._value")}):(c.lines&&c.lines[0]._attr&&b.each(c.lines[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),a.Base.Utils.isDefined(d.fillColor)&&(d.fillColor=a.Base.Utils.colorIntToHex(d.fillColor),d.filled=!0),a.Base.Utils.isDefined(d.color)&&(d.color=a.Base.Utils.colorIntToHex(d.color),d.contour=!0),d.group&&(g=this.convertGroup(d.group),d.layerType=g.layerType,d.groupId=g.groupId,delete d.group),c.lines&&c.lines[0].l&&b.each(c.lines[0].l,function(a,b){e.push({x:b._attr.x._value,y:b._attr.y._value})}.bind(this)),c.lines&&c.lines[0].m&&b.each(c.lines[0].m,function(a,b){f.push({x:b._attr.x._value,y:b._attr.y._value})}.bind(this)));var g=new a.Providers.WCS.DrawShapeEventData(d.alpha,d.fillColor,d.color,d.groupId,d.layerType,d.width,e,f,d.filled,d.contour);return new a.Providers.WCS.DrawShapeEvent(this.stripCommonData(c),g)},a.Providers.WCS.DrawShapeParser=c}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.drawText[0]._attr&&b.each(c.drawText[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),a.Base.Utils.isDefined(d.fillColor)&&(d.fillColor=a.Base.Utils.colorIntToHex(d.fillColor)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.DrawTextEventData(d.fillColor,d.fontSize,d.groupId,d.layerType,d.text,d.x,d.y);return new a.Providers.WCS.DrawTextEvent(this.stripCommonData(c),e)},a.Providers.WCS.DrawTextParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c={};return c.targetId=a.Base.Utils.queryJSONObject(b,"_attr.target_id._value"),c.targetName=a.Base.Utils.queryJSONObject(b,"_attr.target_name._value"),c.targetParticipantId=a.Base.Utils.queryJSONObject(b,"_attr.targetParticipantId._value"),c.time=a.Base.Utils.queryJSONObject(b,"_attr.time._value"),c=new a.Providers.WCS.EjectParticipantEventData(c.targetId,c.targetName,c.targetParticipantId,c.time),new a.Providers.WCS.EjectParticipantEvent(this.stripCommonData(b),c)},a.Providers.WCS.EjectParticipantParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.EndControlEvent(this.stripCommonData(b))},a.Providers.WCS.EndControlParser=b}(AvayaClientServices),function(a){"use strict";function c(){}(c.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(c){var d={};c.lines[0]._attr&&b.each(c.lines[0]._attr,function(a,b){d[this.stringToCamel(a)]=b._value}.bind(this)),d.group&&(e=this.convertGroup(d.group),d.layerType=e.layerType,d.groupId=e.groupId,delete d.group);var e=new a.Providers.WCS.EndDrawShapeEventData(d.groupId,d.layerType);return new a.Providers.WCS.EndDrawShapeEvent(this.stripCommonData(c),e)},a.Providers.WCS.EndDrawShapeParser=c}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.EndMeetingEvent(this.stripCommonData(b))},a.Providers.WCS.EndMeetingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.EndScreenSharingEvent(this.stripCommonData(b))},a.Providers.WCS.EndScreenSharingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.EndVideoSharingEvent(this.stripCommonData(b))},a.Providers.WCS.EndVideoSharingParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){return new a.Providers.WCS.EndWhiteboardEvent(this.stripCommonData(b))},a.Providers.WCS.EndWhiteboardParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.AbstractParser.prototype)).parse=function(b){return b={code:a.Base.Utils.queryJSONObject(b,"code[0]._text"),message:a.Base.Utils.queryJSONObject(b,"message[0]._text"),request_id:a.Base.Utils.queryJSONObject(b,"request_id[0]._text"),ws_connection_id:a.Base.Utils.queryJSONObject(b,"ws_connection_id[0]._text")},b=new a.Providers.WCS.ErrorEventData(b.code,b.message,b.request_id,b.ws_connection_id),new a.Providers.WCS.ErrorEvent(b)},a.Providers.WCS.ErrorParser=b}(AvayaClientServices),function(a){"use strict";function b(){}(b.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(b){var c=a.Base.Utils.queryJSONObject(b,"os_type[0]._text"),c=new a.Providers.WCS.GrantControlEventData(c);return new a.Providers.WCS.GrantControlEvent(this.stripCommonData(b),c)},a.Providers.WCS.GrantControlParser=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.WCS.WCSSharingTag.call(this,a.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG)}b.prototype=Object.create(a.Providers.WCS.WCSSharingTag.prototype),a.Providers.WCS.ScreenSharingAcknowledgementTag=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.WCS.WCSSharingTag.call(this,a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG),this.width=0,this.height=0,this.x=0,this.y=0,this.imageType=0,this.length=0,this.data=[]}b.prototype=Object.create(a.Providers.WCS.WCSSharingTag.prototype),a.Providers.WCS.ScreenSharingBlockTag=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.WCS.WCSSharingTag.call(this,a.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG),this.x=0,this.y=0,this.creationTime=0}b.prototype=Object.create(a.Providers.WCS.WCSSharingTag.prototype),a.Providers.WCS.ScreenSharingCursorTag=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.WCS.WCSSharingTag.call(this,a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG)}b.prototype=Object.create(a.Providers.WCS.WCSSharingTag.prototype),a.Providers.WCS.ScreenSharingEndTag=b}(AvayaClientServices),function(a){"use strict";function b(){a.Providers.WCS.WCSSharingTag.call(this,a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG),this.isKeyFrame=!1,this.width=0,this.height=0,this.creationTime=0}b.prototype=Object.create(a.Providers.WCS.WCSSharingTag.prototype),a.Providers.WCS.ScreenSharingStartTag=b}(AvayaClientServices),function(c,d){"use strict";function e(b){c.Base.RESTProvider.apply(this),this.type=c.Base.ProviderTypes.WCS_COMET_PROVIDER,this._connectionId=a,this._isOpened=!1,this._polling=!1,this._options={},this._parser=b,this._keepAliveTimeout=a,this._keepAliveTimer=3e4,this._messagePoolingIndex=1,this._deferreds={},this._eventsStack={},this._resolveEventsRetries=0}(e.prototype=Object.create(c.Base.RESTProvider.prototype)).onConnectionUnavailable=function(){},e.prototype.close=function(){this._messagePoolingIndex=1,this._resolveEventsRetries=0,this._isOpened?(c.Base.RESTProvider.prototype.close.call(this),this._polling=!1,this._isOpened=!1,this._parser.removeOnMessageParsedCallback(this.onMessage)):this.onClose()},e.prototype.run=function(a){var b=function(a){if(!c.Base.Utils.isUndefined(a)&&!c.Base.Utils.isUndefined(a.data)){if("string"!=typeof a.data)return this.onMessage(a);var d=this._getXmlParameter("<request_id>","</request_id>",a.data),e=this._getXmlParameter("<event_id>","</event_id>",a.data);d&&e?(this._handleIncomingEvent(d,parseInt(e)),this.onMessage(a)):(d=a.data.match(/id="([^&]+?)"/i),e=a.data.match(/type="([^&]+?)"/i),this._isAsyncEvent(e)&&!this._isEventResolved(d)&&this._resolveEventsRetries<=5?(this._resolveEventsRetries++,setTimeout(function(){b(a)}.bind(a))):(this.onMessage(a),this._resolveEventsRetries=0))}}.bind(this);this._options=a,this._isOpened&&(this._polling=!0,this._poll(),this._parser.addOnMessageParsedCallback(b))},e.prototype.start=function(a,d){return this._messagePoolingIndex=1,this._resolveEventsRetries=0,this._isOpened?(this.onOpen(),b.Deferred().resolve().promise()):(this._isOpened=!0,this._maxConnectionErrorCount=a.maxConnectionErrorCount,c.Base.RESTProvider.prototype.start.call(this,a,d))},e.prototype.send=function(b,e,f){var g;return c.Base.Utils.isDefined(this._connectionId)&&(e.query="connection_id="+this._connectionId,e.sendType&&"POST"!==e.sendType||(g=/[?&]request_id=([^&]+).*$/,(g="string"==typeof b&&b.match(g)[1]?b.match(g)[1]:"")&&(e.requestId=g),b=this._addWCSHeader(b),e.processData=!1,e.dataType="binary",e.contentType="octet-stream",this._options.cometSequencing&&(e.contentType="application/vnd.avaya.wcs.comet.data.v2+"+e.contentType))),f=f||new c.Base.NetworkRequestRetryHelper(function(){return this.send(b,e,f)}.bind(this)),this._keepAlive(),e.keepAliveCallback=this._keepAlive.bind(this),c.Base.RESTProvider.prototype.send.call(this,b,e,f).then(function(a){return a&&!this._isXmlString(a)?(this._eventsStack[a]=!0,a):this._isXmlString(a)?(a=d.parseString(a),c.Base.Utils.isUndefined(this._connectionId)&&(this._connectionId=c.Base.Utils.queryJSONObject(a,"response[0].live_session[0].ws_connection_id[0]._text")),a):void 0}.bind(this),function(b){b&&(this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._connectionId=a,this._isOpened=!1,this._polling=!1,setTimeout(function(){this.onConnectionUnavailable()}.bind(this)))}.bind(this))},e.prototype._isXmlString=function(a){return"string"==typeof a&&"xml"===a.substring(2,5)},e.prototype.isOpened=function(){return this._isOpened},e.prototype._handleIncomingEvent=function(a,b){var d;c.Base.Utils.isDefined(a)&&c.Base.Utils.isDefined(this._deferreds[a])&&(d=this._deferreds[a],delete this._deferreds[a],this._eventsStack[b]=!1,d.resolve(b,this._eventsStack))},e.prototype._isEventResolved=function(a){return!c.Base.Utils.isUndefined(a)&&(a=a[1],!c.Base.Utils.isDefined(this._eventsStack[a])||!0===this._eventsStack[a])},e.prototype._isAsyncEvent=function(a){return!(!a||!c.Base.Utils.isDefined(a)||a[1]!==c.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE&&a[1]!==c.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE&&a[1]!==c.Providers.WCS.WCSEventTypes.DRAW_SHAPE&&a[1]!==c.Providers.WCS.WCSEventTypes.DRAW_CIRCLE&&a[1]!==c.Providers.WCS.WCSEventTypes.MOVE_SELECTION&&a[1]!==c.Providers.WCS.WCSEventTypes.DRAW_TEXT)},e.prototype._getXmlParameter=function(a,b,c){if(b=new RegExp(a+"([^&]+)"+b,"i"),b=c.match(b))return b[1]},e.prototype._ajaxOnSuccess=function(a,b,d,e,f){return c.Base.Utils.isDefined(f.requestId)?void(this._deferreds[f.requestId]=e):(this._removeXhrFromPool(d),e.resolve(a),a)},e.prototype._poll=function(){this._polling&&(this._options.sendType="GET",this._options.dataType="binary",this._options.responseType="arraybuffer",this._options.binaryProgressCallback=this._parser.parse.bind(this._parser),this.send(a,this._options).done(function(){this._poll()}.bind(this)))},e.prototype._addWCSHeader=function(a){var b=a,d=c.Base.Utils.stringToArrayBuffer(this._parser.msgHeaderDetails.msgTxt),e=new ArrayBuffer(this._parser.msgHeaderDetails.flagSize);"string"==typeof a&&(new DataView(e).setUint8(0,this._parser.msgHeaderDetails.textFlagValue),b=c.Base.Utils.stringToArrayBuffer(b));var f=this._createInt32ArrayBuffer(this._parser.msgHeaderDetails.lengthIndicatorSize,b.byteLength);return(2147483647<this._messagePoolingIndex||this._messagePoolingIndex<=0)&&(this._messagePoolingIndex=1),a=this._createInt32ArrayBuffer(4,this._messagePoolingIndex),e=c.Base.Utils.concatArrayBuffers(d,e),f=c.Base.Utils.concatArrayBuffers(e,f),a=c.Base.Utils.concatArrayBuffers(f,a),b=this._options.cometSequencing?c.Base.Utils.concatArrayBuffers(a,b):c.Base.Utils.concatArrayBuffers(f,b),this._messagePoolingIndex++,b},e.prototype._createInt32ArrayBuffer=function(a,b){return a=new ArrayBuffer(a),new DataView(a).setUint32(0,b),a},e.prototype._keepAlive=function(b){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),4!==b&&(this._keepAliveTimeout=setTimeout(function(){this._connectionId=a,this.close(),this.onConnectionUnavailable()}.bind(this),this._keepAliveTimer))},c.Providers.WCS.WCSCometProvider=e}(AvayaClientServices,xmlToJSON),function(c){"use strict";function d(d){this._callService=d,this._conference=a,this._remoteAddress="",this._remoteDisplayName="",this._callId=a,this._incoming=!1,this._subject="",this._dataOnly=!1,this._establishedTime=a,this._heldTime=a,this._remoteParticipant=new c.Services.Participant,this._activeParticipants=[],this._callState=c.Services.Call.CallStates.IDLE,this._confEntryOptions=a,this._callCreationInfo=a,this._sessionId=a,this._videoChannels=[],this._audioChannel=a,this._incomingVideoOffered=c.Services.Call.VideoNetworkSignalingType.INDEFINITE,this._isServiceAvailable=!1,this._isPrivateCallerID=!1,this._isAuraAsserted=!1,this._alertType=c.Services.Call.AlertType.UNSPECIFIED,this._heldRemotely=!1,this._remote=!1,this._isMissed=!1,this._modes=[],this._dtmfString=a,this._isEarlyMedia=!1,this._webCollaboration=!1,this._isGuestUser=!1,this._allowedNailedUpVideoModes=[],this._endCallWatchdogTimer=a,this._serviceQuality=new c.Services.Call.ServiceQuality(this),this._participantDroppedCallbacks=b.Callbacks(),this._onCallStartedCallbacks=b.Callbacks(),this._onCallRemoteAlertingCallbacks=b.Callbacks(),this._onCallRedirectedCallbacks=b.Callbacks(),this._onCallQueuedCallbacks=b.Callbacks(),this._onCallIgnoredCallbacks=b.Callbacks(),this._onCallEstablishedCallbacks=b.Callbacks(),this._onCallEstablishingCallbacks=b.Callbacks(),this._onCallRemoteAddressChangedCallbacks=b.Callbacks(),this._onCallHeldCallbacks=b.Callbacks(),this._onCallUnheldCallbacks=b.Callbacks(),this._onCallHeldRemotelyCallbacks=b.Callbacks(),this._onCallUnheldRemotelyCallbacks=b.Callbacks(),this._onCallJoinedCallbacks=b.Callbacks(),this._onCallEndedCallbacks=b.Callbacks(),this._onCallAudioMuteStatusChangedCallbacks=b.Callbacks(),this._onCallSpeakerMuteStatusChangedCallbacks=b.Callbacks(),this._onCallVideoMuteStatusChangedCallbacks=b.Callbacks(),this._onCallIncomingVideoAddRequestReceivedCallbacks=b.Callbacks(),this._onCallIncomingVideoAddRequestAcceptedCallbacks=b.Callbacks(),this._onCallIncomingVideoAddRequestDeniedCallbacks=b.Callbacks(),this._onCallIncomingVideoAddRequestTimedOutCallbacks=b.Callbacks(),this._onCallVideoChannelsUpdatedCallback=b.Callbacks(),this._onCallConferenceStatusChangedCallbacks=b.Callbacks(),this._onAudioStreamUpdatedCallback=b.Callbacks(),this._remoteVideoAddedCallbacks=b.Callbacks(),this._remoteVideoRemovedCallbacks=b.Callbacks(),this._callFailedCallbacks=b.Callbacks(),this._callServiceAvailableCallbacks=b.Callbacks(),this._callServiceUnavailableCallbacks=b.Callbacks(),this._callVideoChannelsUpdatedCallbacks=b.Callbacks(),this._callStateChangedCallBacks=b.Callbacks(),this._answerCallRequestedCallbacks=b.Callbacks(),this._terminateCallRequestedCallbacks=b.Callbacks(),this._updateCallRequestedCallbacks=b.Callbacks(),this._mediaConnectedCallbacks=b.Callbacks(),this._mediaDisconnectedCallbacks=b.Callbacks(),this._mediaFailedCallbacks=b.Callbacks(),this._isAudioMuted=!1,this._isSpeakerMuted=!1,this._audioMuteState=c.Services.Call.MediaMuteStates.UNDEFINED,this._speakerMuteState=c.Services.Call.MediaMuteStates.UNDEFINED,this._videoMuteState=c.Services.Call.MediaMuteStates.UNDEFINED,this._muteCapability=new c.Services.Call.Capabilities.MuteCapability(this),this._unmuteCapability=new c.Services.Call.Capabilities.UnmuteCapability(this),this._muteVideoCapability=new c.Services.Call.Capabilities.MuteVideoCapability(this,d.getVideoCapability()),this._unmuteVideoCapability=new c.Services.Call.Capabilities.UnmuteVideoCapability(this,d.getVideoCapability()),this._ucid=a,this._noiseReductionSetting=a,this._isContentVideoSharingStarted=!1,this._muteSpeakerCapability=new c.Services.Call.Capabilities.MuteSpeakerCapability(this),this._unmuteSpeakerCapability=new c.Services.Call.Capabilities.UnmuteSpeakerCapability(this),this._videoChannelsCapability=new c.Services.Call.Capabilities.UpdateVideoChannelsCapability(this,d.getVideoCapability()),this._sendDTMFCapability=new c.Services.Call.Capabilities.SendDTMFCapability(this),this._holdCapability=new c.Services.Call.Capabilities.HoldCapability(this),this._unholdCapability=new c.Services.Call.Capabilities.UnholdCapability(this),this._joinCapability=new c.Services.Call.Capabilities.JoinCapability(this),this._transferCapability=new c.Services.Call.Capabilities.TransferCapability(this),this._transferToCapability=new c.Services.Call.Capabilities.TransferToCapability(this),this._updateVideoModeSendReceiveCapability=new c.Services.Call.Capabilities.UpdateVideoModeSendReceiveCapability(this,d.getVideoCapability()),this._updateVideoModeSendOnlyCapability=new c.Services.Call.Capabilities.UpdateVideoModeSendOnlyCapability(this,d.getVideoCapability()),this._updateVideoModeReceiveOnlyCapability=new c.Services.Call.Capabilities.UpdateVideoModeReceiveOnlyCapability(this,d.getVideoCapability()),this._updateVideoModeInactiveCapability=new c.Services.Call.Capabilities.UpdateVideoModeInactiveCapability(this,d.getVideoCapability()),this._updateVideoModeDisableCapability=new c.Services.Call.Capabilities.UpdateVideoModeDisableCapability(this,d.getVideoCapability()),this._updateWebCollaborationCapability=new c.Services.Call.Capabilities.UpdateWebCollaborationCapability(this),this._updateAudioModeCapability=new c.Services.Call.Capabilities.UpdateAudioModeCapability(this),this._serviceQualityScoreCapability=new c.Services.Call.Capabilities.ServiceQualityScoreCapability(this),this._preferredResolutionCapability=new c.Services.Call.Capabilities.UpdatePreferredResolutionCapability(this,d.getVideoCapability()),this._preferredReceiveResolutionCapability=new c.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability(this,d.getVideoCapability()),this._setNoiseReductionCapability=new c.Services.Call.Capabilities.SetNoiseReductionCapability(this),this._serviceQualityScoreCapability.addOnChangedCallback(function(){this._serviceQuality.watch()}.bind(this)),this._callStatisticsLogger=new c.Base.CallStatisticsLogger(this)}d.prototype={_setRemoteAddress:function(a){this._remoteAddress=a,this._remoteParticipant.setAddress(a),this._callService._updateMatchedContactsForCall(this)},getRemoteAddress:function(){return this._remoteAddress},_setDtmfString:function(a){this._dtmfString=a},getRemoteDisplayName:function(){return this._remoteDisplayName},isIncoming:function(){return this._incoming},getEstablishedTime:function(){return this._establishedTime},getHeldTime:function(){return this._heldTime},_setRemoteDisplayName:function(a){this._remoteDisplayName=a,this._remoteParticipant.setDisplayName(a)},getRemoteParticipant:function(){return this._remoteParticipant},start:function(){this._callService.isServiceAvailable()||this._isDataOnly()?this._callService.startCall(this):(this._callService._notifyCallFailure(this,c.Services.Call.CallError.SERVICE_UNAVAILABLE),this._endCallWatchdogTimer&&clearTimeout(this._endCallWatchdogTimer),this._endCallWatchdogTimer=setTimeout(function(){this.end()}.bind(this),5e3))},end:function(){this._endCallWatchdogTimer&&(clearTimeout(this._endCallWatchdogTimer),this._endCallWatchdogTimer=a),this.getState()!==c.Services.Call.CallStates.ENDING&&this.getState()!==c.Services.Call.CallStates.ENDED&&(this._setState(c.Services.Call.CallStates.ENDING),this._callService.endCall(this))},getConference:function(){return c.Base.Utils.isUndefined(this._conference)&&(c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"getConference(): Creating new CM Conference"),this._createCMConference()),this._conference},hold:function(){return this._callService.hold(this)},unhold:function(){return this._callService.unhold(this)},ignore:function(){return this._callService.ignore(this)},accept:function(){return this._callService.accept(this)},deny:function(){return this._setState(c.Services.Call.CallStates.ENDING),this._callService.endCall(this,c.Services.Call.CallDenialReason.BUSY)},denyWithReason:function(a){this._setState(c.Services.Call.CallStates.ENDING);var b,d=c.Services.Call.CallDenialReason.TEMPORARILY_UNAVAILABLE;for(b in c.Services.Call.CallDenialReason)if(c.Services.Call.CallDenialReason[b]===a){d=a;break}return this._callService.endCall(this,d)},sendDTMF:function(a){return this._callService.sendDTMF(this,a)},getState:function(){return this._callState},getRemoteNumber:function(){return this._remoteAddress},isConference:function(){return void 0!==this._conference},isIgnored:function(){return this.getState()===c.Services.Call.CallStates.IGNORED},isRemote:function(){return this._remote},_setRemote:function(a){this._remote=a},isHeldRemotely:function(){return this._heldRemotely},isMissed:function(){return this._isMissed},_setIsMissed:function(a){this._isMissed=a},isCallerIdentityPrivate:function(){return this._isPrivateCallerID},isServiceAvailable:function(){return this._isServiceAvailable},getAlertType:function(){return this._alertType},getSubject:function(){return this._subject},join:function(){return this._callService.join(this)},acceptSendVideo:function(a){return this._callService.acceptSendVideo(this,a)},denySendVideo:function(){return this._callService.denySendVideo(this)},getVideoChannels:function(){return this._videoChannels},getAudioChannel:function(){return this._audioChannel},setVideoChannels:function(a){return this._callService.setVideoChannels(this,a)},removeAllVideoChannels:function(){return this._callService.setVideoMode(this,c.Services.Call.VideoMode.DISABLE)},setVideoMode:function(a,b){return this._callService.setVideoMode(this,a,b)},setAudioMode:function(a){return this._callService.setAudioMode(this,a)},setWebCollaboration:function(a){return this._callService.setWebCollaboration(this,a)},getIncomingVideoOffered:function(){return this._incomingVideoOffered},getCallId:function(){return this._callId},_setCallId:function(a){this._callId=a},isAudioMuted:function(){return this._isAudioMuted},muteAudio:function(){return this._audioMuteState=c.Services.Call.MediaMuteStates.MUTED,this._callService.mute(this).then(function(){this._isAudioMuted=!0,this._muteCapability._recalculate(),this._unmuteCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot mute audio ",a)})},unmuteAudio:function(){return this._audioMuteState=c.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmute(this).then(function(){this._isAudioMuted=!1,this._muteCapability._recalculate(),this._unmuteCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot unmute audio ",a)})},muteVideo:function(){return this._videoMuteState=c.Services.Call.MediaMuteStates.MUTED,this._callService.muteVideo(this).then(function(){this._muteVideoCapability._recalculate(),this._unmuteVideoCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot mute video ",a)})},unmuteVideo:function(){return this._videoMuteState=c.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmuteVideo(this).then(function(){this._muteVideoCapability._recalculate(),this._unmuteVideoCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot unmute video ",a)})},isSpeakerMuted:function(){return this._isSpeakerMuted},muteSpeaker:function(){return this._speakerMuteState=c.Services.Call.MediaMuteStates.MUTED,this._callService.muteSpeaker(this).then(function(){this._isSpeakerMuted=!0,this._muteSpeakerCapability._recalculate(),this._unmuteSpeakerCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot mute speaker ",a)})},unmuteSpeaker:function(){return this._speakerMuteState=c.Services.Call.MediaMuteStates.UNMUTED,this._callService.unmuteSpeaker(this).then(function(){this._isSpeakerMuted=!1,this._muteSpeakerCapability._recalculate(),this._unmuteSpeakerCapability._recalculate()}.bind(this))["catch"](function(a){c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Cannot unmute speaker ",a)})},transfer:function(a){return this._callService.transfer(this,a)},attendedTransfer:function(a){return this._callService.attendedTransfer(this,a)},setConferenceEntryOptions:function(a){this._confEntryOptions=a,c.Base.Utils.isDefined(this._callCreationInfo)||(this._callCreationInfo=new c.Services.Call.CallCreationInfo),this._callCreationInfo.setConferenceID(a.getMeetingId()),this._callCreationInfo.setPortalToken(a.getToken()),this._callCreationInfo.setPasscode(a.getPasscode()),a.isOTT()?this._callCreationInfo.setCallType(c.Services.Call.CallType.CallTypeHttpMeetMe):this._callCreationInfo.setCallType(c.Services.Call.CallType.CallTypeDefaultRegisteredService)},getConferenceEntryOptions:function(){return this._confEntryOptions},getAudioDetails:function(){return this._callService.getAudioDetails(this)},getVideoDetails:function(){return this._callService.getVideoDetails(this)},getServiceQualityScore:function(){return this._serviceQuality.getScore()},_setState:function(a){var b=a!==this._callState;this._callState=a,b&&this._callStateChangedCallBacks.fire()},_setServiceAvailability:function(a){this._isServiceAvailable=a},_isDataOnly:function(){return this._dataOnly},_hasCallMode:function(a){return 0<this._modes.filter(function(b){return b.id===a}).length},_removeCallMode:function(a){this.modes=this._modes.filter(function(b){return b.id!==a})},_createCMConference:function(){this._conference=this._callService.createCMConference(this),this._updateVideoModeCapabilities()},_setConference:function(a){this._conference=a,this.isAudioMuted()&&c.Base.Utils.isDefined(a)&&a._sendLocalMuteEvent(!0),this._updateVideoModeCapabilities()},_updateVideoModeCapabilities:function(){c.Base.Utils.isDefined(this._conference)&&(this._recalculateVideoModeCapabilities(),this._conference._addOnConferenceAllowVideoDirectionChangedCallback(this._recalculateVideoModeCapabilities.bind(this)))},_recalculateVideoModeCapabilities:function(){this._updateVideoModeSendReceiveCapability._recalculate(),this._updateVideoModeSendOnlyCapability._recalculate(),this._updateVideoModeReceiveOnlyCapability._recalculate(),this._updateVideoModeInactiveCapability._recalculate(),this._updateVideoModeDisableCapability._recalculate()},_setUserToUserInfo:function(a){this._userToUserInfo=a},_setAllowedNailedUpVideoModes:function(a){this._allowedNailedUpVideoModes=a},_getAllowedNailedUpVideoModes:function(){return this._allowedNailedUpVideoModes},getUserToUserInfo:function(){return this._userToUserInfo},startRinging:function(){return this._callService.startRinging(this)},acceptAnswerCallRequest:function(){return this._callService.acceptAnswerCallRequest(this)},acceptTerminateCallRequest:function(){return this._callService.acceptTerminateCallRequest(this)},acceptUpdateCallRequest:function(a){return this._callService.acceptUpdateCallRequest(this,a)},acceptMakeCallRequest:function(){return this._callService.acceptMakeCallRequest(this)},rejectAnswerCallRequest:function(){return this._callService.rejectAnswerCallRequest(this)},rejectTerminateCallRequest:function(){return this._callService.rejectTerminateCallRequest(this)},rejectUpdateCallRequest:function(a){return this._callService.rejectUpdateCallRequest(this,a)},rejectMakeCallRequest:function(){return this._callService.rejectMakeCallRequest(this)},isMediaConnected:function(){return this._callService.isMediaConnected(this)},_setIsGuestUser:function(a){this._isGuestUser=a},startLoggingStatistics:function(){this._callStatisticsLogger.start()},stopLoggingStatistics:function(){this._callStatisticsLogger.stop()},setNoiseReduction:function(a){return this._callService.setNoiseReduction(this,a)},getNoiseReductionSetting:function(){return this._noiseReductionSetting},_setIsContentVideoSharingStarted:function(a){this._isContentVideoSharingStarted=a,this._recalculateVideoModeCapabilities()},_getIsContentVideoSharingStarted:function(){return this._isContentVideoSharingStarted}},c.Base.AOPTools.addAdvices(d,"Call",["getConference","setVideoMode","setConferenceEntryOptions"],[c.Base.AOPCommonAdvices.LOG_CALL_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Call",["start","end"],[c.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_EXCEPTION]),c.Base.AOPTools.addAdvices(d,"Call",["hold","unhold","ignore","accept","deny","denyWithReason","sendDTMF","join","acceptSendVideo","denySendVideo","setVideoChannels","removeAllVideoChannels","muteAudio","unmuteAudio","muteSpeaker","unmuteSpeaker","transfer","attendedTransfer","startRinging","acceptAnswerCallRequest","acceptTerminateCallRequest","acceptUpdateCallRequest","acceptMakeCallRequest","rejectAnswerCallRequest","rejectTerminateCallRequest","rejectUpdateCallRequest","rejectMakeCallRequest","muteVideo","unmuteVideo","setNoiseReduction"],[c.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_ERROR]),c.Services.Call.Call=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Call.Call.prototype,{addOnRemoteVideoAddedCallback:function(a){this._remoteVideoAddedCallbacks.add(a)},removeOnRemoteVideoAddedCallback:function(a){this._remoteVideoAddedCallbacks.remove(a)},addOnRemoteVideoRemovedCallback:function(a){this._remoteVideoRemovedCallbacks.add(a)},removeOnRemoteVideoRemovedCallback:function(a){this._remoteVideoRemovedCallbacks.remove(a)},addOnCallVideoChannelsUpdatedCallback:function(a){this._onCallVideoChannelsUpdatedCallback.add(a)},removeOnCallVideoChannelsUpdatedCallback:function(a){this._onCallVideoChannelsUpdatedCallback.remove(a)},addOnAudioStreamUpdatedCallback:function(a){this._onAudioStreamUpdatedCallback.add(a)},removeOnAudioStreamUpdatedCallback:function(a){this._onAudioStreamUpdatedCallback.remove(a)},addOnCallStartedCallback:function(a){this._onCallStartedCallbacks.add(a)},removeOnCallStartedCallback:function(a){this._onCallStartedCallbacks.remove(a)},addOnCallRemoteAlertingCallback:function(a){this._onCallRemoteAlertingCallbacks.add(a)},removeOnCallRemoteAlertingCallback:function(a){this._onCallRemoteAlertingCallbacks.remove(a)},addOnCallRedirectedCallback:function(a){this._onCallRedirectedCallbacks.add(a)},removeOnCallRedirectedCallback:function(a){this._onCallRedirectedCallbacks.remove(a)},addOnCallQueuedCallback:function(a){this._onCallQueuedCallbacks.add(a)},removeOnCallQueuedCallback:function(a){this._onCallQueuedCallbacks.remove(a)},addOnCallIgnoredCallback:function(a){this._onCallIgnoredCallbacks.add(a)},removeOnCallIgnoredCallback:function(a){this._onCallIgnoredCallbacks.remove(a)},addOnCallEstablishedCallback:function(a){this._onCallEstablishedCallbacks.add(a)},removeOnCallEstablishedCallback:function(a){this._onCallEstablishedCallbacks.remove(a)},addOnCallEstablishingCallback:function(a){this._onCallEstablishingCallbacks.add(a)},removeOnCallEstablishingCallback:function(a){this._onCallEstablishingCallbacks.remove(a)},addOnCallRemoteAddressChangedCallback:function(a){this._onCallRemoteAddressChangedCallbacks.add(a)},removeOnCallRemoteAddressChangedCallback:function(a){this._onCallRemoteAddressChangedCallbacks.remove(a)},addOnCallHeldCallback:function(a){this._onCallHeldCallbacks.add(a)},removeOnCallHeldCallback:function(a){this._onCallHeldCallbacks.remove(a)},addOnCallUnheldCallback:function(a){this._onCallUnheldCallbacks.add(a)},removeOnCallUnheldCallback:function(a){this._onCallUnheldCallbacks.remove(a)},addOnCallHeldRemotelyCallback:function(a){this._onCallHeldRemotelyCallbacks.add(a)},removeOnCallHeldRemotelyCallback:function(a){this._onCallHeldRemotelyCallbacks.remove(a)},addOnCallUnheldRemotelyCallback:function(a){this._onCallUnheldRemotelyCallbacks.add(a)},removeOnCallUnheldRemotelyCallback:function(a){this._onCallUnheldRemotelyCallbacks.remove(a)},addOnCallJoinedCallback:function(a){this._onCallJoinedCallbacks.add(a);
},removeOnCallJoinedCallback:function(a){this._onCallJoinedCallbacks.remove(a)},addOnCallEndedCallback:function(a){this._onCallEndedCallbacks.add(a)},removeOnCallEndedCallback:function(a){this._onCallEndedCallbacks.remove(a)},addOnCallAudioMuteStatusChangedCallback:function(a){this._onCallAudioMuteStatusChangedCallbacks.add(a)},removeOnCallAudioMuteStatusChangedCallback:function(a){this._onCallAudioMuteStatusChangedCallbacks.remove(a)},addOnCallSpeakerMuteStatusChangedCallback:function(a){this._onCallSpeakerMuteStatusChangedCallbacks.add(a)},removeOnCallSpeakerMuteStatusChangedCallback:function(a){this._onCallSpeakerMuteStatusChangedCallbacks.remove(a)},addOnCallVideoMuteStatusChangedCallback:function(a){this._onCallVideoMuteStatusChangedCallbacks.add(a)},removeOnCallVideoMuteStatusChangedCallback:function(a){this._onCallVideoMuteStatusChangedCallbacks.remove(a)},addOnCallIncomingVideoAddRequestReceivedCallback:function(a){this._onCallIncomingVideoAddRequestReceivedCallbacks.add(a)},removeOnCallIncomingVideoAddRequestReceivedCallback:function(a){this._onCallIncomingVideoAddRequestReceivedCallbacks.remove(a)},addOnCallIncomingVideoAddRequestAcceptedCallback:function(a){this._onCallIncomingVideoAddRequestAcceptedCallbacks.add(a)},removeOnCallIncomingVideoAddRequestAcceptedCallback:function(a){this._onCallIncomingVideoAddRequestAcceptedCallbacks.remove(a)},addOnCallIncomingVideoAddRequestDeniedCallback:function(a){this._onCallIncomingVideoAddRequestDeniedCallbacks.add(a)},removeOnCallIncomingVideoAddRequestDeniedCallback:function(a){this._onCallIncomingVideoAddRequestDeniedCallbacks.remove(a)},addOnCallIncomingVideoAddRequestTimedOutCallback:function(a){this._onCallIncomingVideoAddRequestTimedOutCallbacks.add(a)},removeOnCallIncomingVideoAddRequestTimedOutCallback:function(a){this._onCallIncomingVideoAddRequestTimedOutCallbacks.remove(a)},addOnCallVideoRemovedRemotelyCallback:function(a){},removeOnCallVideoRemovedRemotelyCallback:function(a){},addOnCallConferenceStatusChangedCallback:function(a){this._onCallConferenceStatusChangedCallbacks.add(a)},removeOnCallConferenceStatusChangedCallback:function(a){this._onCallConferenceStatusChangedCallbacks.remove(a)},addOnParticipantDroppedCallback:function(a){this._participantDroppedCallbacks.add(a)},removeOnParticipantDroppedCallback:function(a){this._participantDroppedCallbacks.remove(a)},addOnCallFailedCallback:function(a){this._callFailedCallbacks.add(a)},removeOnCallFailedCallback:function(a){this._callFailedCallbacks.remove(a)},addOnCallServiceAvailableCallback:function(a){this._callServiceAvailableCallbacks.add(a)},removeOnCallServiceAvailableCallback:function(a){this._callServiceAvailableCallbacks.remove(a)},addOnCallServiceUnavailableCallback:function(a){this._callServiceUnavailableCallbacks.add(a)},removeOnCallServiceUnavailableCallback:function(a){this._callServiceUnavailableCallbacks.remove(a)},addOnAnswerCallRequestedCallback:function(a){this._answerCallRequestedCallbacks.add(a)},removeOnAnswerCallRequestedCallback:function(a){this._answerCallRequestedCallbacks.remove(a)},addOnUpdateCallRequestedCallback:function(a){this._updateCallRequestedCallbacks.add(a)},removeOnUpdateCallRequestedCallback:function(a){this._updateCallRequestedCallbacks.remove(a)},addOnTerminateCallRequestedCallback:function(a){this._terminateCallRequestedCallbacks.add(a)},removeOnTerminateCallRequestedCallback:function(a){this._terminateCallRequestedCallbacks.remove(a)},addOnServiceQualityScoreChangedCallback:function(a){this._serviceQuality.addOnScoreChangedCallback(a)},removeOnServiceQualityScoreChangedCallback:function(a){this._serviceQuality.removeOnScoreChangedCallback(a)},addOnMediaConnectedCallback:function(a){this._mediaConnectedCallbacks.add(a)},removeOnMediaConnectedCallback:function(a){this._mediaConnectedCallbacks.remove(a)},addOnMediaDisconnectedCallback:function(a){this._mediaDisconnectedCallbacks.add(a)},removeOnMediaDisconnectedCallback:function(a){this._mediaDisconnectedCallbacks.remove(a)},addOnMediaFailedCallback:function(a){this._mediaFailedCallbacks.add(a)},removeOnMediaFailedCallback:function(a){this._mediaFailedCallbacks.remove(a)},_addOnCallStateChangedCallback:function(a){this._callStateChangedCallBacks.add(a)},_removeOnCallStateChangedCallback:function(a){this._callStateChangedCallBacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Call.Call.prototype,{getHoldCapability:function(){return this._holdCapability},getUnholdCapability:function(){return this._unholdCapability},getJoinCapability:function(){return this._joinCapability},getMuteCapability:function(){return this._muteCapability},getUnmuteCapability:function(){return this._unmuteCapability},getMuteVideoCapability:function(){return this._muteVideoCapability},getUnmuteVideoCapability:function(){return this._unmuteVideoCapability},getMuteSpeakerCapability:function(){return this._muteSpeakerCapability},getUnmuteSpeakerCapability:function(){return this._unmuteSpeakerCapability},getSendDTMFCapability:function(){return this._sendDTMFCapability},getTransferCapability:function(){return this._transferCapability},getTransferToCapability:function(){return this._transferToCapability},getUpdateVideoChannelsCapability:function(){return this._videoChannelsCapability},getUpdateVideoModeSendReceiveCapability:function(){return this._updateVideoModeSendReceiveCapability},getUpdateVideoModeSendOnlyCapability:function(){return this._updateVideoModeSendOnlyCapability},getUpdateVideoModeReceiveOnlyCapability:function(){return this._updateVideoModeReceiveOnlyCapability},getUpdateVideoModeInactiveCapability:function(){return this._updateVideoModeInactiveCapability},getUpdateVideoModeDisableCapability:function(){return this._updateVideoModeDisableCapability},getUpdateWebCollaborationCapability:function(){return this._updateWebCollaborationCapability},getUpdateAudioModeCapability:function(){return this._updateAudioModeCapability},getServiceQualityScoreCapability:function(){return this._serviceQualityScoreCapability},getSetNoiseReductionCapability:function(){return this._setNoiseReductionCapability}})}(AvayaClientServices),function(c){"use strict";function d(d,e){this._callManager=d,this._isAvailable=a,this._callService=e,this._callCreatedCallbacks=b.Callbacks(),this._callRemovedCallbacks=b.Callbacks(),this._incomingCallCallbacks=b.Callbacks(),this._undeliveredCallCallbacks=b.Callbacks(),this._callsServiceAvailableCallbacks=b.Callbacks(),this._callsServiceUnavailableCallbacks=b.Callbacks(),this._makeCallRequestedCallbacks=b.Callbacks(),this._voipCallingCapability=new c.Services.Call.Capabilities.VoipCallingCapability(this),this._setOnNetworkEventsCapability=new c.Services.Call.Capabilities.SetOnNetworkEventsCapability(e),this._removeOnNetworkEventsCapability=new c.Services.Call.Capabilities.RemoveOnNetworkEventsCapability(e),this._callService.on(c.Providers.Interfaces.CallServiceCallbackIds.INCOMING_CALL,function(a){this._incomingCallCallbacks.fire(a)}.bind(this)),this._callService.on(c.Providers.Interfaces.CallServiceCallbackIds.MAKE_CALL_REQUESTED,function(a){this._makeCallRequestedCallbacks.fire(a)}.bind(this)),this._voipCallingCapability._recalculate(),this._callManager.setCalls(this),this._hasCallsServiceRegistrationTriggered=!1,this._onCallsServiceRegistration=a,this._onRingbackToneURLsChangedCallback=b.Callbacks()}d.prototype={createCall:function(b){if(!b.isPresentationModeOnly()&&!this.getVoipCallingCapability().isAllowed)throw new c.Services.Call.CallException(this.getVoipCallingCapability().denialReason);if(b.getServiceGatewayURL()!==a&&b.getPortalToken()===a&&b.getAuthorizationToken()===a)throw c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Failed to create a call - token is invalid"),new c.Services.Call.CallException(c.Services.Call.CallError.INVALID_PARAMETER);var d=this._callManager.createCall(this._callService);return d._remoteAddress=b.getRemoteAddress(),d._subject=b.getSubject(),d._dataOnly=b.isPresentationModeOnly(),d._callCreationInfo=b,d.getUpdateWebCollaborationCapability()._recalculate(),d.getUpdateAudioModeCapability()._recalculate(),d.getServiceQualityScoreCapability()._recalculate(),d._dataOnly&&(b=new c.Services.Call.Modes.ConferenceCallMode(d,c.Services.Call.CallModes.CONFERENCE_CALL,this._callService._contactsIntegrationService),this._callManager.setCallMode(d,b)),c.Base.Utils.isDefined(this._callService._config.wcsConfiguration)&&c.Base.Utils.isDefined(this._callService._config.wcsConfiguration.enabled)&&(d._webCollaboration=this._callService._config.wcsConfiguration.enabled),d},createDefaultCall:function(){if(!this._callService._config._mediaServiceConfiguration)throw c.Base.Logger.error(c.Base.LoggerTags.CALL_SERVICE,"Failed to create call - media service context is invalid"),new c.Services.Call.CallException(c.Services.Call.CallError.INVALID_PARAMETER);if(0<this._callManager._getLiveCallCount())throw new c.Services.Call.CallException(c.Services.Call.CallError.MULTIPLE_CALLS_NOT_SUPPORTED);var a,b=new c.Services.Call.CallCreationInfo("",(!1),"");return(a=this._callManager.createCall(this._callService))._sessionId=this._callService._config._mediaServiceConfiguration.sessionId,a._callCreationInfo=b,a.getUpdateWebCollaborationCapability()._recalculate(),a.getUpdateAudioModeCapability()._recalculate(),a.getSetNoiseReductionCapability()._recalculate(),c.Base.Logger.info(c.Base.LoggerTags.CALL_SERVICE,"session id: "+a._sessionId),a},getCalls:function(){return this._callManager.getAllCalls()},getCallCount:function(){return this._callManager.getCallCount()},getActiveCall:function(){return this._callManager.getActiveCall()},getIgnoredCalls:function(){return this._callManager.getIgnoredCalls()},getVideoCapability:function(){return this._callService.getVideoCapability()},hasHeldCall:function(){return this._callManager.hasHeldCall()},hasInitiatingCall:function(){return this._callManager.hasInitiatingCall()},getVoipCallingCapability:function(){return this._voipCallingCapability},getSetOnNetworkEventsCapability:function(){return this._setOnNetworkEventsCapability},getRemoveOnNetworkEventsCapability:function(){return this._removeOnNetworkEventsCapability},setOnNetworkEvents:function(a,b){return this._callService.setOnNetworkEvents(a,b)},removeOnNetworkEvents:function(){return this._callService.removeOnNetworkEvents()},isAvailable:function(){return this._isAvailable},_triggerRegistrationStatus:function(a){!this._hasCallsServiceRegistrationTriggered&&this._onCallsServiceRegistration&&(this._hasCallsServiceRegistrationTriggered=!0,this._onCallsServiceRegistration(a))},_start:function(){return this._callService.start(this)},_stop:function(){return this._callService.stop().always(function(){this._cleanupAndTriggerServiceUnavailable()}.bind(this))},_stopImmediately:function(){return this._callService.stopImmediately().always(function(){for(var a=0;a<this._callManager._calls.length;a++)this._callManager._calls[a].isConference()&&this._callManager._calls[a]._conference.stopImmediately();this._cleanupAndTriggerServiceUnavailable()}.bind(this))},_cleanupAndTriggerServiceUnavailable:function(){this._callsServiceUnavailableCallbacks.fire(this),this._isAvailable=a,this._callManager._calls=[],this._resetCallbacks()},_resetCallbacks:function(){this._callRemovedCallbacks.empty(),this._incomingCallCallbacks.empty(),this._undeliveredCallCallbacks.empty(),this._callsServiceAvailableCallbacks.empty(),this._callsServiceUnavailableCallbacks.empty(),this._callCreatedCallbacks.empty()},_isWebRTCSupportedBrowser:function(){return this._callService._isWebRTCSupportedBrowser()},_uploadLogs:function(){return this._callService.uploadLogs()},_isRegistrationTerminated:function(){return this._callService.isRegistrationTerminated()}},c.Base.AOPTools.addAdvices(d,"Calls",["createCall","createDefaultCall"],[c.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_EXCEPTION]),c.Services.Call.Calls=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Call.Calls.prototype,{addOnCallsServiceAvailableCallback:function(a){this._callsServiceAvailableCallbacks.add(a)},removeOnCallsServiceAvailableCallback:function(a){this._callsServiceAvailableCallbacks.remove(a)},addOnCallsServiceUnavailableCallback:function(a){this._callsServiceUnavailableCallbacks.add(a)},removeOnCallsServiceUnavailableCallback:function(a){this._callsServiceUnavailableCallbacks.remove(a)},addOnCallCreatedCallback:function(a){this._callCreatedCallbacks.add(a)},removeOnCallCreatedCallback:function(a){this._callCreatedCallbacks.remove(a)},addOnCallRemovedCallback:function(a){this._callRemovedCallbacks.add(a)},removeOnCallRemovedCallback:function(a){this._callRemovedCallbacks.remove(a)},addOnIncomingCallCallback:function(a){this._incomingCallCallbacks.add(a)},removeOnIncomingCallCallback:function(a){this._incomingCallCallbacks.remove(a)},addOnUndeliveredCallCallback:function(a){this._undeliveredCallCallbacks.add(a)},removeOnUndeliveredCallCallback:function(a){this._undeliveredCallCallbacks.remove(a)},addOnRingbackToneURLsChangedCallback:function(a){this._onRingbackToneURLsChangedCallback.add(a)},removeOnRingbackToneURLsChangedCallback:function(a){this._onRingbackToneURLsChangedCallback.remove(a)},addOnMakeCallRequestedCallback:function(a){this._makeCallRequestedCallbacks.add(a)},removeOnMakeCallRequestedCallback:function(a){this._makeCallRequestedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";function b(b){var c=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,b,c,!0,!1,!0)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var b=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,d=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;return b=c&&!d?a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:b},a.Services.Call.Capabilities.AbstractCallMuteCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,b)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&this._call.isAudioMuted()&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.MuteCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,b)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&this._call.isSpeakerMuted()&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.MuteSpeakerCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,b)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&!this._call.isAudioMuted()&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UnmuteCapability=b}(AvayaClientServices),function(a){"use strict";function b(b){a.Services.Call.Capabilities.AbstractCallMuteCapability.call(this,b)}(b.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype))._recalculate=function(){var b=a.Services.Call.Capabilities.AbstractCallMuteCapability.prototype._recalculateDenialReason.call(this),c=b===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;c&&!this._call.isSpeakerMuted()&&(c=!1,b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(c,b)},a.Services.Call.Capabilities.UnmuteSpeakerCapability=b}(AvayaClientServices),function(b){"use strict";function c(c){this._channelId=a,this._requestedDirection=a,this._internalRequestedDirection=a,this._negotiatedDirection=a,this._disabledReason=b.Services.Call.VideoChannelDisabledReason.NONE,this._isCameraAccessDenied=!1,this._call=c,this._preferredResolution=null,this._preferredReceiveResolution=a,this._cameraDenialReason=a}c.prototype={getChannelId:function(){return this._channelId},getNegotiatedDirection:function(){return this._negotiatedDirection},getRequestedDirection:function(){return this._requestedDirection},getNegotiatedResolution:function(){return this.isDisabled()?a:this._call._callService.getVideoResolution(this._call)},getVideoDisabledReason:function(){return this._disabledReason},getCameraDenialReason:function(){return this._cameraDenialReason},isDisabled:function(){return this._disabledReason!==b.Services.Call.VideoChannelDisabledReason.NONE},isCameraAccessDenied:function(){return this._isCameraAccessDenied},setPreferredResolution:function(a){return this._call._callService.updatePreferredResolution(this,a)},setPreferredReceiveResolution:function(a){return null===this._preferredResolution?this._call._callService.setPreferredReceiveResolution(this._call,this._channelId,a):(a=b.Base.Utils.getLowerResolution(a,this._preferredResolution),this._call._callService.setPreferredReceiveResolution(this._call,this._channelId,a))},getUpdatePreferredReceiveResolutionCapability:function(){return this._call._preferredReceiveResolutionCapability},getPreferredResolution:function(){return this._preferredResolution},getPreferredReceiveResolution:function(){return this._preferredReceiveResolution},_setRequestedDirection:function(a){this._requestedDirection=a,(this._internalRequestedDirection=a)===b.Services.Call.MediaDirection.DISABLE&&(this._disabledReason=b.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)},_setNegotiatedDirection:function(a){(this._negotiatedDirection=a)!==b.Services.Call.MediaDirection.INACTIVE&&a!==b.Services.Call.MediaDirection.DISABLE&&(this._disabledReason=b.Services.Call.VideoChannelDisabledReason.NONE)},_setInternalRequestedDirection:function(a){this._internalRequestedDirection=a},_getInternalRequestedDirection:function(){return this._internalRequestedDirection},_setChannelId:function(a){this._channelId=a},_setVideoDisabledReason:function(a){this._disabledReason=a},_setCameraConstraint:function(a){this._isCameraAccessDenied=a.error===b.Services.Call.CallError.CAMERA_PERMISSION_DENIED,this._cameraDenialReason=a.reason}},b.Base.AOPTools.addAdvices(c,"VideoChannel",["setPreferredResolution","setPreferredReceiveResolution"],[b.Base.AOPCommonAdvices.LOG_CALL_API_CALLS,b.Base.AOPCommonAdvices.WRAP_CAUGHT_CALL_ERROR]),b.Services.Call.VideoChannel=c}(AvayaClientServices),function(c){"use strict";function d(d,e,f,g,h,i,j){this._collaborationService=d,this._whiteboard=e,this._contentSharing=f,this._slider=g,this._collaborationId=h,this._callId=i,this._callService=j,this._isAvailable=a,this._participants=new c.Base.DataSet,this._selfParticipant=a,this._supportedFeatures=[c.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING,c.Services.Collaboration.FeaturesAvailable.WHITEBOARD,c.Services.Collaboration.FeaturesAvailable.SLIDER,c.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING],this._onCollaborationStartedCallbacks=b.Callbacks(),this._onCollaborationEndedCallbacks=b.Callbacks("unique"),this._onCollaborationServiceAvailableCallbacks=b.Callbacks("unique"),this._onCollaborationServiceUnavailableCallbacks=b.Callbacks("unique"),this._onCollaborationNearEndByEjectCallbacks=b.Callbacks("unique"),this._onCollaborationPresenterPrivilegeChangedCallbacks=b.Callbacks("unique"),this._onCollaborationModeratorPrivilegeChangedCallbacks=b.Callbacks("unique"),this._onCollaborationInitializedCallbacks=b.Callbacks("unique"),this._isPaused=!1,this._chatCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._meetingMinutesCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._networkLibraryCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._librarySharingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._whiteboardCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveParticipantListCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sliderCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._isStarted=!1,this._isStopped=!0,this._config=a,this._meetingId=a,this._isReceivingSharingPaused=!1}d.prototype={start:function(a,d){return c.Base.Utils.isDefined(a)&&c.Base.Utils.isDefined(d)&&(this._config=a,this._meetingId=d),c.Base.Utils.isDefined(this._config)&&c.Base.Utils.isDefined(this._meetingId)?this._collaborationService.start(this,this._config,this._meetingId).then(function(){this._contentSharing._start()}.bind(this)):(c.Base.Logger.error(c.Base.LoggerTags.COLLABORATION_SERVICE,"Configuration or meeting Id is missing"),d=c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,b.Deferred().reject(new c.Services.Collaboration.CollaborationError(d)).promise())},stop:function(){return this._contentSharing._collaborationEnd=!0,this._contentSharing.end().always(function(){this._contentSharing._stop()}.bind(this)),this._whiteboard.stop(),this._collaborationService.stop(this)},getContentSharing:function(){return this._contentSharing},getWhiteboard:function(){return this._whiteboard},getParticipants:function(){return this._collaborationService.getParticipants(this)},getCallId:function(){return this._callId},getCollaborationId:function(){return this._collaborationId},hasPresenterPrivilege:function(){},isEjected:function(){},hasModeratorPrivilege:function(){},pause:function(){return this._isReceivingSharingPaused=!0,this._collaborationService.pause(this)},resume:function(){return this._isReceivingSharingPaused=!1,this._collaborationService.resume(this)},_setConfiguration:function(a,b){this._config=a,this._meetingId=b},getSlider:function(){return this._slider},isReceivingSharingPaused:function(){return this._isReceivingSharingPaused},_setSelfParticipant:function(a){this._selfParticipant=a,this._selfParticipant&&this._selfParticipant instanceof c.Services.Participant&&(this._selfParticipant._localUser=!0),this._participants.push(this._selfParticipant),this._participants.onDataSetChanged([this._selfParticipant],c.Base.DataSetChangeTypes.ADDED)}},c.Base.AOPTools.addAdvices(d,"Collaboration",["getParticipants"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Collaboration",["start","stop","pause","resume"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.Collaboration=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Collaboration.Collaboration.prototype,{addOnCollaborationStartedCallback:function(a){this._onCollaborationStartedCallbacks.add(a)},removeOnCollaborationStartedCallback:function(a){this._onCollaborationStartedCallbacks.remove(a)},addOnCollaborationEndedCallback:function(a){this._onCollaborationEndedCallbacks.add(a)},removeOnCollaborationEndedCallback:function(a){this._onCollaborationEndedCallbacks.remove(a)},addOnCollaborationServiceAvailableCallback:function(a){this._onCollaborationServiceAvailableCallbacks.add(a)},removeOnCollaborationServiceAvailableCallback:function(a){this._onCollaborationServiceAvailableCallbacks.remove(a)},addOnCollaborationServiceUnavailableCallback:function(a){this._onCollaborationServiceUnavailableCallbacks.add(a)},removeOnCollaborationServiceUnavailableCallback:function(a){this._onCollaborationServiceUnavailableCallbacks.remove(a)},addOnCollaborationNearEndByEjectCallback:function(a){this._onCollaborationNearEndByEjectCallbacks.add(a)},removeOnCollaborationNearEndByEjectCallback:function(a){this._onCollaborationNearEndByEjectCallbacks.remove(a)},addOnCollaborationPresenterPrivilegeChangedCallback:function(a){this._onCollaborationPresenterPrivilegeChangedCallbacks.add(a)},removeOnCollaborationPresenterPrivilegeChangedCallback:function(a){this._onCollaborationPresenterPrivilegeChangedCallbacks.remove(a)},addOnCollaborationModeratorPrivilegeChangedCallback:function(a){this._onCollaborationModeratorPrivilegeChangedCallbacks.add(a)},removeOnCollaborationModeratorPrivilegeChangedCallback:function(a){this._onCollaborationModeratorPrivilegeChangedCallbacks.remove(a)},addOnCollaborationInitializedCallback:function(a){this._onCollaborationInitializedCallbacks.add(a)},removeOnCollaborationInitializedCallback:function(a){this._onCollaborationInitializedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getChatCapability:function(){return this._chatCapability},_recalculateChatCapability:function(){var b,c=this._isAvailable,d=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.MESSAGES),d=c&&d&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._chatCapability._updateIfChanged(b,d)},getMeetingMinutesCapability:function(){return this._meetingMinutesCapability},_recalculateMeetingMinutesCapability:function(){var b,c=this._isAvailable,d=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.MINUTES),d=c&&d&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._meetingMinutesCapability._updateIfChanged(b,d)},getContentSharingCapability:function(){return this._contentSharingCapability},_recalculateContentSharingCapability:function(b){var c,d=this._isAvailable,e=this._contentSharing.getShareApplicationWindowCapability(),f=this._contentSharing.getShareApplicationWindowCapability().isAllowed||this._contentSharing.getShareFullScreenCapability().isAllowed||this._contentSharing.getStartScreenSharingCapability().isAllowed||this._contentSharing.getStartSharingUsingVideoCapability().isAllowed,g=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),h=!b||!!b._selfParticipant&&b._selfParticipant._presenter,b=a.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable()||a.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable()||a.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable()||a.Providers.ContentSharing.FeatureSupported.isSharingContentVideoAvailable(),e=d&&b&&f&&g&&h?(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):b?b&&!f&&e.denialReason===a.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._contentSharingCapability._updateIfChanged(c,e)},getNetworkLibraryCapability:function(){return this._networkLibraryCapability},_recalculateNetworkLibraryCapability:function(){var b,c=this._isAvailable,d=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.LIBRARY),d=c&&d&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._networkLibraryCapability._updateIfChanged(b,d)},getLibrarySharingCapability:function(){return this._librarySharingCapability},_recalculateLibrarySharingCapability:function(){var b,c=this._isAvailable,d=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.LIBRARY),d=c&&d&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._librarySharingCapability._updateIfChanged(b,d)},getWhiteboardCapability:function(){return this._whiteboardCapability},_recalculateWhiteboardCapability:function(b){var c,d=this._isAvailable,e=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.WHITEBOARD),b=!b||!!b._selfParticipant&&b._selfParticipant._presenter,b=d&&e&&this._isBrowserAllowed()&&b?(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._whiteboardCapability._updateIfChanged(c,b)},getRetrieveParticipantListCapability:function(){return this._retrieveParticipantListCapability},_recalculateRetrieveParticipantListCapability:function(){var b,c=this._isAvailable&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._retrieveParticipantListCapability._updateIfChanged(b,c)},_isBrowserAllowed:function(){return!0},getSliderCapability:function(){return this._sliderCapability},_recalculateSliderCapability:function(){var b,c=this._isAvailable,d=this._collaborationService.isFeatureSupported(this,a.Services.Collaboration.FeaturesAvailable.SLIDER),d=c&&d&&this._isBrowserAllowed()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._sliderCapability._updateIfChanged(b,d)}};b.extend(a.Services.Collaboration.Collaboration.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(c,d){this._factory=c,this._callService=d,this._collaborationsStore={},this._onActiveContentSharingChangedCallback=b.Callbacks(),this._activeContentSharing=a}d.prototype={getCollaborationForCall:function(a){for(var b in c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._collaborationsStore)if(this._collaborationsStore.hasOwnProperty(b)&&this._collaborationsStore[b].getCallId()===a)return this._collaborationsStore[b];return this._createAndSaveCollaboration(a)},getCollaborationById:function(a){return this._collaborationsStore.hasOwnProperty(a)?this._collaborationsStore[a]:this._createAndSaveCollaboration(a)},_generateUniqueIdForCollaboration:function(){var a=c.Base.Utils.makeId();return this._collaborationsStore.hasOwnProperty(a)?this._generateUniqueIdForCollaboration():a},_createAndSaveCollaboration:function(a){return a=this._factory.create(this,this._generateUniqueIdForCollaboration(),a),this._collaborationsStore[a.getCollaborationId()]=a},_isCollaborationForCall:function(a){var b,d=!1;if(c.Base.Utils.isUndefined(a))return d;for(b in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(b)&&this._collaborationsStore[b].getCallId()===a&&(d=!0);return d},_deleteCollaboration:function(a){this._collaborationsStore[a]&&delete this._collaborationsStore[a]},_stopAndDeleteAllCollaborations:function(){for(var a in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(a)&&(this._collaborationsStore[a].stop(),
this._deleteCollaboration(a));return this._collaborationsStore={},b.Deferred().resolve().promise()},_stopImmediately:function(){for(var d in this._collaborationsStore)this._collaborationsStore.hasOwnProperty(d)&&(this._collaborationsStore[d]._isStarted=!1,this._collaborationsStore[d]._isAvailable&&(this._collaborationsStore[d]._isAvailable=a,this._collaborationsStore[d]._onCollaborationServiceUnavailableCallbacks.fire(this._collaborationsStore[d])),this._collaborationsStore[d]._isStopped=!0,c.Base.Logger.debug(c.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service stop",d),delete this._collaborationsStore[d]);return b.Deferred().resolve().promise()}},c.Base.AOPTools.addAdvices(d,"Collaborations",["getCollaborationById","getCollaborationForCall"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),c.Services.Collaboration.Collaborations=d}(AvayaClientServices),function(c){"use strict";function d(d,e){this._contentSharingService=d,this._collaborations=e,this._collaborations._onActiveContentSharingChangedCallback.add(this._onActiveContentSharingChanged.bind(this)),this._collaborationEnd=!1,this._collaboration=a,this._isPaused=!1,this._onContentSharingStartedCallbacks=b.Callbacks(),this._onContentSharingEndedCallbacks=b.Callbacks(),this._onContentSharingPausedCallbacks=b.Callbacks(),this._onContentSharingResumedCallbacks=b.Callbacks(),this._onCursorReceivedCallbacks=b.Callbacks(),this._onFrameStartReceivedCallbacks=b.Callbacks(),this._onFrameEndReceivedCallbacks=b.Callbacks(),this._onFrameReceivedCallbacks=b.Callbacks(),this._onFrameChangedCallbacks=b.Callbacks(),this._onBlockReceivedCallbacks=b.Callbacks(),this._onFrameReportReceivedCallbacks=b.Callbacks(),this._onScreenSharingUsingVideoStartedCallbacks=b.Callbacks(),this._onScreenSharingUsingVideoEndedCallbacks=b.Callbacks(),this._onAudioAddedToScreenSharingUsingVideoCallback=b.Callbacks(),this._shareApplicationWindowCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareFullScreenCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareAnyTypeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._shareContentVideoCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._contentSharingService.getShareFullScreenCapability()._onChangedCallbacks.add(function(){this._recalculateShareFullScreenCapability(this._collaboration)}.bind(this)),this._contentSharingService.getShareApplicationWindowCapability()._onChangedCallbacks.add(function(){this._recalculateShareApplicationWindowCapability(this._collaboration)}.bind(this)),this._contentSharingService.getShareAnyTypeCapability()._onChangedCallbacks.add(function(){this._recalculateShareAnyTypeCapability(this._collaboration)}.bind(this)),this._contentSharingService.getStartSharingUsingVideoCapability()._onChangedCallbacks.add(function(){this._recalculateShareContentVideoCapability(this._collaboration)}.bind(this))}d.prototype={_start:function(){this._contentSharingService.start(this)},_stop:function(){this._contentSharingService.stop(this)},_setCollaboration:function(a){this._collaboration=a},_setMaxUploadSpeed:function(a){this._contentSharingService.setMaxUploadSpeed(a)},setExtensionAvailable:function(a){this._contentSharingService.setExtensionAvailable(a)},startScreenSharingFullScreen:function(a){var b;return this._contentSharingService.isDisplayMediaAvailable()&&(b=c.Base.ErrorReasons.DEPRECATED+" Please use ContentSharing.startScreenSharing instead of ContentSharing.startScreenSharingFullscreen",c.Base.Logger.warn(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,b)),this._contentSharingService.startScreenSharingFullScreen(this,a)},startScreenSharing:function(){return this._contentSharingService.startScreenSharingAnyType(this)},startScreenSharingUsingVideo:function(a,b){return this._contentSharingService.startScreenSharingUsingVideo(this,a,b)},isSharingFullScreen:function(){return this._contentSharingService.isSharingFullScreen()},isScreenSharingUsingVideo:function(){return this._contentSharingService.isScreenSharingUsingVideo()},isScreenSharingUsingVideoWithAudio:function(){return this._contentSharingService.isScreenSharingUsingVideoWithAudio()},getReceivingBitrate:function(){return this._contentSharingService.getReceivingBitrate()},getOutgoingScreenSharingStream:function(){return this._contentSharingService.getOutgoingScreenSharingStream()},startSharingApplicationWindow:function(a){var b;return this._contentSharingService.isDisplayMediaAvailable()&&(b=c.Base.ErrorReasons.DEPRECATED+" Please use ContentSharing.startScreenSharing instead of ContentSharing.startSharingApplicationWindow",c.Base.Logger.warn(c.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,b)),this._contentSharingService.startSharingApplicationWindow(this,a)},isSharingApplicationWindow:function(){return this._contentSharingService.isSharingApplicationWindow()},end:function(){var a=this._collaborationEnd&&!(this.isSharingFullScreen()||this.isSharingApplicationWindow());return this._collaborationEnd=!1,this._clearActiveContentSharing(),this._contentSharingService.end(a,this)},isPresenting:function(){return this._contentSharingService.isPresenting()},isContentSharingActive:function(){return this._contentSharingService.isContentSharingActive()},isContentSharingPaused:function(){return this._contentSharingService.isContentSharingPaused()},pause:function(){return this._contentSharingService.pause()},resume:function(){return this._contentSharingService.resume()},_onActiveContentSharingChanged:function(){this._contentSharingService._recalculateAllContentSharingCapabilities(this)},_getCollaborations:function(){return this._collaborations},_clearActiveContentSharing:function(){var b=this._collaborations._activeContentSharing;b&&b===this&&(this._collaborations._activeContentSharing=a)},_endActiveScreenSharing:function(a){this._contentSharingService._endActiveScreenSharing(this,a)},_setImageQuality:function(a){this._contentSharingService.setImageQuality(a)},_notifyPerformanceMonitorAlert:function(a,b){this._contentSharingService.notifyPerformanceMonitorAlert(a,b)}},c.Base.AOPTools.addAdvices(d,"ContentSharing",["startScreenSharing","startScreenSharingUsingVideo","startScreenSharingFullScreen","startSharingApplicationWindow","startScreenSharingUsingVideo","end","pause","resume"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.ContentSharing=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Collaboration.ContentSharing.prototype,{addOnContentSharingStartedCallback:function(a){this._onContentSharingStartedCallbacks.add(a)},removeOnContentSharingStartedCallback:function(a){this._onContentSharingStartedCallbacks.remove(a)},addOnContentSharingEndedCallback:function(a){this._onContentSharingEndedCallbacks.add(a)},removeOnContentSharingEndedCallback:function(a){this._onContentSharingEndedCallbacks.remove(a)},addOnContentSharingPausedCallback:function(a){this._onContentSharingPausedCallbacks.add(a)},removeOnContentSharingPausedCallback:function(a){this._onContentSharingPausedCallbacks.remove(a)},addOnContentSharingResumedCallback:function(a){this._onContentSharingResumedCallbacks.add(a)},removeOnContentSharingResumedCallback:function(a){this._onContentSharingResumedCallbacks.remove(a)},addOnScreenSharingUsingVideoStartedCallback:function(a){this._onScreenSharingUsingVideoStartedCallbacks.add(a)},removeOnScreenSharingUsingVideoStartedCallback:function(a){this._onScreenSharingUsingVideoStartedCallbacks.remove(a)},addOnScreenSharingUsingVideoEndedCallback:function(a){this._onScreenSharingUsingVideoEndedCallbacks.add(a)},removeOnScreenSharingUsingVideoEndedCallback:function(a){this._onScreenSharingUsingVideoEndedCallbacks.remove(a)},addOnAudioAddedToScreenSharingUsingVideoCallback:function(a){this._onAudioAddedToScreenSharingUsingVideoCallback.add(a)},removeOnAudioAddedToScreenSharingUsingVideoCallback:function(a){this._onAudioAddedToScreenSharingUsingVideoCallback.remove(a)},addOnCursorReceivedCallback:function(a){this._onCursorReceivedCallbacks.add(a)},removeOnCursorReceivedCallback:function(a){this._onCursorReceivedCallbacks.remove(a)},addOnFrameChangedCallback:function(a){this._onFrameChangedCallbacks.add(a)},removeOnFrameChangedCallback:function(a){this._onFrameChangedCallbacks.remove(a)},addOnFrameReceivedCallback:function(a){this._onFrameReceivedCallbacks.add(a)},removeOnFrameReceivedCallback:function(a){this._onFrameReceivedCallbacks.remove(a)},addOnFrameReportReceivedCallbacks:function(a){this._onFrameReportReceivedCallbacks.add(a)},removeOnFrameReportReceivedCallbacks:function(a){this._onFrameReportReceivedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getShareApplicationWindowCapability:function(){return this._shareApplicationWindowCapability},_recalculateShareApplicationWindowCapability:function(b){var c,d=this._contentSharingService.getShareApplicationWindowCapability(),e=this._contentSharingService.isOpened(),f=this._contentSharingService.isFeatureAvailable(a.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),g=a.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,h=a.Providers.ContentSharing.FeatureSupported.isSharingApplicationWindowAvailable(),b=!b||!!b._selfParticipant&&b._selfParticipant._presenter,d=h&&d.isAllowed&&e&&f&&b?g?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):h?h&&!d.isAllowed?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareApplicationWindowCapability._updateIfChanged(c,d)},getShareFullScreenCapability:function(){return this._shareFullScreenCapability},_recalculateShareFullScreenCapability:function(b){var c,d=this._contentSharingService.getShareFullScreenCapability(),e=this._contentSharingService.isOpened(),f=this._contentSharingService.isFeatureAvailable(a.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),g=a.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,h=a.Providers.ContentSharing.FeatureSupported.isSharingFullScreenAvailable(),b=!b||!!b._selfParticipant&&b._selfParticipant._presenter,d=h&&d.isAllowed&&e&&f&&b?g?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):h?h&&!d.isAllowed?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareFullScreenCapability._updateIfChanged(c,d)},getStartScreenSharingCapability:function(){return this._shareAnyTypeCapability},_recalculateShareAnyTypeCapability:function(b){var c,d=this._contentSharingService.getShareAnyTypeCapability(),e=this._contentSharingService.isOpened(),f=this._contentSharingService.isFeatureAvailable(a.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING),g=a.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,h=a.Providers.ContentSharing.FeatureSupported.isSharingAnyTypeAvailable(),b=!b||!!b._selfParticipant&&b._selfParticipant._presenter,d=h&&d.isAllowed&&e&&f&&b?g?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):h?h&&!d.isAllowed?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._shareAnyTypeCapability._updateIfChanged(c,d)},getStartSharingUsingVideoCapability:function(){return this._shareContentVideoCapability},_recalculateShareContentVideoCapability:function(b){var c,d=this._contentSharingService.getStartSharingUsingVideoCapability(),e=this._contentSharingService.isFeatureAvailable(a.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING),f=a.Base.Utils.isDefined(this._collaborations._activeContentSharing)&&this._getCollaborations()._activeContentSharing!==this,b=!b||!!b._selfParticipant&&b._selfParticipant._presenter,b=this._contentSharingService.isScreenSharingUsingVideoAllowed()?d.isAllowed&&b&&e?f?(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(c=!1,b?a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED:a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);this._shareContentVideoCapability._updateIfChanged(c,b)},getSupportRemoteControlCapability:function(){return new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)},getRequestRemoteControlCapability:function(){return new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)}};b.extend(a.Services.Collaboration.ContentSharing.prototype,c)}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Participant.call(this),this._participantId=b,this._displayName=c,this._presenter=!1}(b.prototype=Object.create(a.Services.Participant.prototype)).isPresenter=function(){return this._presenter},a.Services.Collaboration.Participant=b}(AvayaClientServices),function(c){"use strict";function d(d){this._collaboration=a,this._whiteboardService=d,this._activeSurface=a,this._currentLiveDrawingWhiteboardIds=[],this._currentLiveDrawingShapes=[],this._onWhiteboardStartedCallbacks=b.Callbacks(),this._onWhiteboardEndedCallbacks=b.Callbacks(),this._onWhiteboardSurfaceAddedCallbacks=b.Callbacks(),this._onWhiteboardSurfaceRemovedCallbacks=b.Callbacks(),this._onWhiteboardSurfaceSetActiveCallbacks=b.Callbacks(),this._recentlyActiveSurface=a,this._surfaces=new c.Base.DataSet,this._removeWhiteboardCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._drawingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addWhiteboardCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}d.prototype={start:function(){return this._whiteboardService.start(this)},end:function(){return this._whiteboardService.end(this)},stop:function(){return this._whiteboardService.stop(this)},requestNewSurface:function(){return this._whiteboardService.requestNewSurface(this)},removeSurface:function(a){return this._whiteboardService.removeSurface(this,a)},getSurfaces:function(){return this._surfaces},getSurfaceById:function(a){return this._surfaces.filter(function(b){return b.getSurfaceId()===a})[0]},getActiveSurface:function(){return this._activeSurface},_setCollaboration:function(a){this._collaboration=a}},c.Base.AOPTools.addAdvices(d,"Whiteboard",["start","stop","end","requestNewSurface","removeSurface"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.Whiteboard=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Collaboration.Whiteboard.prototype,{addOnWhiteboardStartedCallback:function(a){this._onWhiteboardStartedCallbacks.add(a)},removeOnWhiteboardStartedCallback:function(a){this._onWhiteboardStartedCallbacks.remove(a)},addOnWhiteboardEndedCallback:function(a){this._onWhiteboardEndedCallbacks.add(a)},removeOnWhiteboardEndedCallback:function(a){this._onWhiteboardEndedCallbacks.remove(a)},addOnWhiteboardSurfaceAddedCallback:function(a){this._onWhiteboardSurfaceAddedCallbacks.add(a)},removeOnWhiteboardSurfaceAddedCallback:function(a){this._onWhiteboardSurfaceAddedCallbacks.remove(a)},addOnWhiteboardSurfaceRemovedCallback:function(a){this._onWhiteboardSurfaceRemovedCallbacks.add(a)},removeOnWhiteboardSurfaceRemovedCallback:function(a){this._onWhiteboardSurfaceRemovedCallbacks.remove(a)},addOnWhiteboardSurfaceSetActiveCallback:function(a){this._onWhiteboardSurfaceSetActiveCallbacks.add(a)},removeOnWhiteboardSurfaceSetActiveCallback:function(a){this._onWhiteboardSurfaceSetActiveCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getAddWhiteboardCapability:function(){return this._addWhiteboardCapability},_recalculateAddWhiteboardCapability:function(b){var c,b=!!b&&!!b._selfParticipant&&b._selfParticipant._presenter,b=this.getActiveSurface()&&b?(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addWhiteboardCapability._updateIfChanged(c,b)},getRemoveWhiteboardCapability:function(){return this._removeWhiteboardCapability},_recalculateRemoveWhiteboardCapability:function(b){var c,b=!!b&&!!b._selfParticipant&&b._selfParticipant._presenter,b=this.getActiveSurface()&&1<this._surfaces.length&&b?(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeWhiteboardCapability._updateIfChanged(c,b)},getDrawingCapability:function(){return this._drawingCapability},_recalculateDrawingCapability:function(b){var c,d=b._isAvailable,e=b._collaborationService.isFeatureSupported(b,a.Services.Collaboration.FeaturesAvailable.WHITEBOARD),b=d&&e&&b._isBrowserAllowed()?(c=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(c=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED);this._drawingCapability._updateIfChanged(c,b)}};b.extend(a.Services.Collaboration.Whiteboard.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(){this.possibleColors=["#cd2029","#f58521","#f3e913","#652d90","#3659a7","#2a8b45","#211e1e","#ffffff","#959595"],this._whiteboard=a,this._collaboration=a,this._ended=!1,this._callbacks={},this._onShowShapeAnnotationCallbacks=b.Callbacks()}d.prototype={init:function(b,d){(this._whiteboard=b).addOnWhiteboardStartedCallback(function(a,b){this._ended=!1,c.Base.Utils.isDefined(b)&&this.start(d)}.bind(this)),b.addOnWhiteboardEndedCallback(function(a){this._ended=!0,this.end(d)}.bind(this)),b.addOnWhiteboardSurfaceAddedCallback(function(a,b){var c=[{name:"OnShapeAddedCallback",callback:function(a,b){a.isActive()&&this.drawShape(b)}.bind(this)},{name:"OnShapeDeletedCallback",callback:function(a,b){this.removeShape(b)}.bind(this)},{name:"OnShapeUpdatedCallback",callback:function(a,b){this.updateShape(b)}.bind(this)},{name:"OnSurfaceClearedCallback",callback:function(a){this.clearContent()}.bind(this)}];c.forEach(function(a){b["add"+a.name](a.callback)}),this._callbacks[b.getSurfaceId()]=c}.bind(this)),b.addOnWhiteboardSurfaceRemovedCallback(function(b,c){this._callbacks[c.getSurfaceId()].forEach(function(a){c["remove"+a.name](a.callback)}),this._callbacks[c.getSurfaceId()]=a}.bind(this)),b.addOnWhiteboardSurfaceSetActiveCallback(function(a,b){if(this._ended&&this.start(d),this.clearContent(),b)for(var c in b.getShapes())b.getShapes().hasOwnProperty(c)&&this.drawShape(b.getShapes()[c])}.bind(this))},start:function(){},end:function(){},drawShape:function(a){},removeShape:function(a){},updateShape:function(a){},clearContent:function(){},addOnShowShapeAnnotationCallback:function(a){this._onShowShapeAnnotationCallbacks.add(a)},removeOnShowShapeAnnotationCallback:function(a){this._onShowShapeAnnotationCallbacks.remove(a)}},c.Base.AOPTools.addAdvices(d,"WhiteboardRenderer",["init"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),c.Services.Collaboration.WhiteboardRenderer=d}(AvayaClientServices),function(c){"use strict";function d(c,d){this._whiteboard=c,this._whiteboardService=d,this._shapes={},this._surfaceId=a,this._isDrawing=!1,this._active=!1,this._onShapeAddedCallbacks=b.Callbacks(),this._onShapeDeletedCallbacks=b.Callbacks(),this._onShapeUpdatedCallbacks=b.Callbacks(),this._onSurfaceClearedCallbacks=b.Callbacks()}d.prototype={getSurfaceId:function(){return this._surfaceId},setAsActive:function(){return this._whiteboardService.start(this._whiteboard,this)},addCircle:function(a){return this._appendShape(a._id,a),this._whiteboardService.addCircle(this,a)},addShape:function(a){return this._appendShape(a._id,a),a._onShapeFinished=function(){return this._whiteboardService.endDrawShape(this,a)}.bind(this),this._whiteboardService.addShape(this,a)},addText:function(a){return this._appendShape(a._id,a),this._whiteboardService.addText(this,a)},getShapes:function(){return this._shapes},isActive:function(){return this._active},clearContent:function(){return this._whiteboardService.clearContent(this)},updateShape:function(a){return this._whiteboardService.moveSelection(this,a)},removeShape:function(a){return this._whiteboardService.removeShape(this,a)},finishShape:function(a){return a.finishDrawing()},_appendShape:function(a,b){this._shapes[a]||(this._shapes[a]=b)},_getShapeById:function(a){if(c.Base.Utils.isDefined(this._shapes[a]))return this._shapes[a]},_removeShapeById:function(a){delete this._shapes[a]},_clearShapes:function(){this._shapes={}}},c.Base.AOPTools.addAdvices(d,"WhiteboardSurface",["finishShape","removeShape","updateShape","clearContent","addText","addShape","addCircle","setAsActive"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.WhiteboardSurface=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Collaboration.WhiteboardSurface.prototype,{addOnShapeAddedCallback:function(a){this._onShapeAddedCallbacks.add(a)},removeOnShapeAddedCallback:function(a){this._onShapeAddedCallbacks.remove(a)},addOnShapeUpdatedCallback:function(a){this._onShapeUpdatedCallbacks.add(a)},removeOnShapeUpdatedCallback:function(a){this._onShapeUpdatedCallbacks.remove(a)},addOnShapeDeletedCallback:function(a){this._onShapeDeletedCallbacks.add(a)},removeOnShapeDeletedCallback:function(a){this._onShapeDeletedCallbacks.remove(a)},addOnSurfaceClearedCallback:function(a){this._onSurfaceClearedCallbacks.add(a)},removeOnSurfaceClearedCallback:function(a){this._onSurfaceClearedCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";function d(d){this._chatService=d,this._selfParticipant=a,this._privateMessages=new c.Base.DataSet,this._publicMessages=new c.Base.DataSet,this._allMessages=new c.Base.DataSet,this._onChatMessageReceivedCallbacks=b.Callbacks(),this._onChatServiceAvailableCallbacks=b.Callbacks(),this._onChatServiceUnavailableCallbacks=b.Callbacks()}d.prototype={sendPrivateMessage:function(a,b){return c.Base.Utils.validate(b,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Conference.Participant}]}),this._chatService.sendMessage(this,b,a)},sendPublicMessage:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._chatService.sendMessage(this,a)},getAllPrivateMessages:function(){return this._privateMessages},getAllPublicMessages:function(){return this._publicMessages},getAllMessages:function(){return this._allMessages},_setSelfParticipant:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Conference.Participant}]}),this._selfParticipant=a},_addMessage:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Conference.ChatMessage}]}),this._chatService.addMessage(this,a)}},c.Base.AOPTools.addAdvices(d,"Chat",["sendPrivateMessage","sendPublicMessage"],[c.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),c.Services.Conference.Chat=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Conference.Chat.prototype,{addOnChatMessageReceivedCallback:function(a){this._onChatMessageReceivedCallbacks.add(a)},removeOnChatMessageReceivedCallback:function(a){this._onChatMessageReceivedCallbacks.remove(a)},addOnChatServiceAvailableCallback:function(a){this._onChatServiceAvailableCallbacks.add(a)},removeOnChatServiceAvailableCallback:function(a){this._onChatServiceAvailableCallbacks.remove(a)},addOnChatServiceUnavailableCallback:function(a){this._onChatServiceUnavailableCallbacks.add(a)},removeOnChatServiceUnavailableCallback:function(a){this._onChatServiceUnavailableCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";function d(d,e,f){this._id=c.Base.Utils.generateUUID(),this._eventConference=!1,this._conferenceService=d,this._participantService=e,this._chat=f,this._selfParticipantId="",this._selfParticipant=a,this._activeTalkerId="",this._recentTalkersList=new c.Base.DataSet,this._dialoutPermissions=a,this._recordingPermissions=a,this._lockPermissions=a,this._unmuteSelfPermissions=a,this._unmuteAllPermissions=a,this._sendFeccPermissions=a,this._allowVideoDirection=a,this._lecturerId="",this._conferenceOwnerAddress="",this._presenterId="",this._mediaStatus="",this._activeParticipants=new c.Base.DataSet,this._droppedParticipants=[],this._pendingParticipants=[],this._isLectureModeActive=!1,this._isUccpConference=!1,this._isHandRaised=!1,this._recorderStatus=c.Services.Conference.RecorderStatus.NONE,this._recordingStatus=c.Services.Conference.RecordingStatus.OFF,this._isVideoAllowed=!1,this._encryptionStatus=c.Services.Conference.MeetingEncryptionStatus.NO,this._isWebCollaborationActive=!1,this._isLocked=!1,this._isPasscodeRequiredToBecomeModerator=!1,this._isVideoParticipantNameDisplayActive=!1,this._isVideoPersonalLayoutActive=a,this._isVideoSelfSeeActive=!1,this._currentVideoLayout=a,this._supportedVideoLayouts=[],this._isVideoSelfSeeChangeAllowed=!1,this._isVideoPinAllowed=!1,this._isVideoParticipantNameDisplayChangeAllowed=!1,this._isStreamingActive=!1,this._terminationTime=a,this._subject="",this._webURI="",this._sipURI="",this._isApplicationSharingActive=!1,this._brandName="",this._collaborationURI="",this._admissionPermissionNeeded=!1,this._admissionPasscodeNeeded=!1,this._streamingURI="",this._joinMeetingURI="",this._dialInInformation="",this._dialInInformationHtml="",this._isAvailable=a,this._collaboration=a,this._uccpConfig=a,this._isStarting=!1,this._isStarted=!1,this._preEnteredPasscode="",this._knockDoorTimeout=a,this._onEventConferenceStatusChangedCallbacks=b.Callbacks(),this._onConferenceLockStatusChangedCallbacks=b.Callbacks(),this._onConferenceDisplayVideoParticipantNameChangedCallbacks=b.Callbacks(),this._onConferenceVideoSelfSeeChangedCallbacks=b.Callbacks(),this._onConferenceVideoLayoutChangedCallbacks=b.Callbacks(),this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks=b.Callbacks(),this._onConferenceVideoSelfSeeAllowedCallbacks=b.Callbacks(),this._onConferenceVideoPinAllowedCallbacks=b.Callbacks(),this._onConferenceAvailableVideoLayoutsChangedCallbacks=b.Callbacks(),this._onConferenceSubjectChangedCallbacks=b.Callbacks(),this._onConferenceKnockDoorTimeoutChangedCallbacks=b.Callbacks(),this._onConferenceOwnerAddressChangedCallbacks=b.Callbacks(),this._onConferenceDialInInfoUpdatedCallbacks=b.Callbacks(),this._onConferenceJoinMeetingURIUpdatedCallbacks=b.Callbacks(),this._onConferenceStreamingURIUpdatedCallbacks=b.Callbacks(),this._onConferenceContinuationStatusChangedCallbacks=b.Callbacks(),this._onConferenceRecordingStatusChangedCallbacks=b.Callbacks(),this._onConferenceRecordingFailedCallbacks=b.Callbacks(),this._onConferenceVideoStatusChangedCallbacks=b.Callbacks(),this._onConferenceLectureModeStatusChangedCallbacks=b.Callbacks(),this._onConferenceEntryExitToneChangedCallbacks=b.Callbacks(),this._onConferencePresentationModeStatusChangedCallbacks=b.Callbacks(),this._onConferenceActiveTalkersChangedCallbacks=b.Callbacks(),this._onConferenceActiveVideoParticipantsChangedCallbacks=b.Callbacks(),this._onConferenceParticipantRoleChangedCallbacks=b.Callbacks(),this._onConferenceParticipantAudioMuteStatusChangedCallbacks=b.Callbacks(),this._onConferenceParticipantVideoBlockStatusChangedCallbacks=b.Callbacks(),this._onConferenceAllParticipantsMutedCallbacks=b.Callbacks(),this._onConferenceAllParticipantsUnmutedCallbacks=b.Callbacks(),this._onConferenceEncryptionStatusChangedCallbacks=b.Callbacks(),this._onConferenceStreamingStatusChangedCallbacks=b.Callbacks(),this._onConferenceParticipantRaiseHandStatusChangedCallbacks=b.Callbacks(),this._onConferencePendingParticipantCallbacks=b.Callbacks(),this._onConferencePendingParticipantRemovedCallbacks=b.Callbacks(),this._onConferenceDroppedParticipantAddedCallbacks=b.Callbacks(),this._onConferenceDroppedParticipantRemovedCallbacks=b.Callbacks(),this._onConferenceServiceAvailableCallbacks=b.Callbacks(),this._onConferenceServiceUnavailableCallbacks=b.Callbacks(),this._onConferenceParticipantsAddedCallbacks=b.Callbacks(),this._onConferenceParticipantsRemovedCallbacks=b.Callbacks(),this._onConferenceMeetingTerminationTimeChangedCallbacks=b.Callbacks(),this._onConferenceMeetingTerminationInProgressCallbacks=b.Callbacks(),this._onConferenceCollaborationURIChangedCallbacks=b.Callbacks(),this._onConferenceConnectionEndedCallbacks=b.Callbacks(),this._onConferenceStartingCallbacks=b.Callbacks(),this._onConferenceWaitingToStartCallbacks=b.Callbacks(),this._onConferenceAllowVideoDirectionChangedCallbacks=b.Callbacks(),this._setLectureModeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteParticipantCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._blockUnblockParticipantVideoCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setLockCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeLastParticipantCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._denyPendingParticipantCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._acceptPendingParticipantCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._terminateConferenceCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteSelfAudioCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteSelfAudioCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendFeccCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._activeTalkerCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._supportMeetingMinutesCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._moderateConferenceCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startRecordingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._stopRecordingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._pauseRecordingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._resumeRecordingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteAllCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._raiseHandSupportCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._lowerHandSupportCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setDisplayVideoParticipantNameCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoSelfSeeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoLayoutCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),
this._setRequestToBecomeModeratorCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoPinCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeSelectParticipantCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantViaDialoutCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._signInCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._extendMeetingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveParticipantListCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._inConferenceChatCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateChatService(this._inConferenceChatCapability),this._inConferenceChatCapability.addOnChangedCallback(this._updateChatService.bind(this)),this._addParticipantFromCallCapabilities={}}d.prototype={start:function(a){return c.Base.Utils.isDefined(a)&&(this._uccpConfig=a),this._conferenceService.start(this,this._uccpConfig)},stop:function(){return this._addParticipantFromCallCapabilities={},this._conferenceService.stop(this)},_stopImmediately:function(){return this._conferenceService.stopImmediately(this)},isEventConference:function(){return this._eventConference},getInConferenceChat:function(){return this._chat},getRecentTalkers:function(){return this._recentTalkersList},getMeetingMinutes:function(){throw new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.NOT_SUPPORTED)},getCollaborationURI:function(){return this._collaborationURI},getConferenceOwnerAddress:function(){return this._conferenceOwnerAddress},isLocked:function(){return this._isLocked},setLocked:function(a){return this._conferenceService.setLocked(this,a)},isConferenceWaitingToStart:function(){return this._mediaStatus===c.Services.Conference.MediaStatus.WAITING_ROOM},isVideoSelfSeeActive:function(){return this._isVideoSelfSeeActive},isMuteAllParticipantsActive:function(){return this._mediaStatus===c.Services.Conference.MediaStatus.MUTE_ALL_AUDIO},setVideoSelfSee:function(a){return this._conferenceService.setVideoLayoutSelfSee(this,a)},isVideoParticipantNameDisplayActive:function(){return this._isVideoParticipantNameDisplayActive},setDisplayVideoParticipantName:function(a){return this._conferenceService.setVideoLayoutTextOverlay(this,a)},_setPreEnteredPasscode:function(a){this._preEnteredPasscode=a},getSupportedVideoLayoutList:function(){return this._supportedVideoLayouts},isLectureModeActive:function(){return this._isLectureModeActive},startRecording:function(a,b){return this._conferenceService.startRecording(this,a,b)},stopRecording:function(){return this._conferenceService.stopRecording(this)},pauseRecording:function(){return this._conferenceService.pauseRecording(this)},resumeRecording:function(){return this._conferenceService.resumeRecording(this)},isVideoAllowed:function(){return this._isVideoAllowed},getCurrentVideoLayout:function(){return this._currentVideoLayout},setVideoLayout:function(a){for(var d in c.Services.Conference.VideoLayout)if(c.Services.Conference.VideoLayout.hasOwnProperty(d)&&a===c.Services.Conference.VideoLayout[d])return this._conferenceService.setVideoLayout(this,a);return b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.INVALID_ARGUMENT))},getActiveParticipants:function(){return this._activeParticipants},getDroppedParticipants:function(){return this._droppedParticipants},getPendingParticipants:function(){return this._pendingParticipants},muteAllParticipants:function(){return this._conferenceService.muteAllParticipants(this)},unmuteAllParticipants:function(){return this._conferenceService.unmuteAllParticipants(this)},addParticipant:function(a){return this._conferenceService.addParticipant(this,c.Base.Utils.normalizeAddress(a))},addParticipantFromCall:function(a){return this.getAddParticipantFromCallCapability(a).isAllowed?this._conferenceService.addParticipantFromCall(a):b.Deferred().reject(new c.Services.Call.CallException(c.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))},removeParticipant:function(a){return a.getParticipantConnectionStatus()===c.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTING?this._conferenceService.cancelDialoutParticipant(this,a):a.isActiveParticipant()?this._conferenceService.disconnectParticipant(a):b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.INVALID_ARGUMENT,"Invalid participant state for this method"))},removeLastParticipant:function(){return this._conferenceService.removeLastParticipant()},terminateConference:function(){return this._conferenceService.terminateConference(this)},sendPasscode:function(a){return this._conferenceService.sendAdmissionRequest(this,a)},sendRequestToEnterLockedConference:function(){return this._conferenceService.sendAdmissionRequest(this)},isPasscodeRequiredToBecomeModerator:function(){return this._isPasscodeRequiredToBecomeModerator},requestToBecomeModerator:function(a){return this._conferenceService.requestToBecomeModerator(this,a)},signIn:function(a){return this._conferenceService.signIn(this,a)},pinVideoByParticipant:function(a,b,c){return this._conferenceService.videoPin(a,0,0,b,c)},pinVideoByCoordinates:function(a,b,c,d){return this._conferenceService.videoPin(void 0,a,b,c,d)},extendMeeting:function(a){return this._conferenceService.extendMeeting(a)},raiseHand:function(){return this.getSupportRaiseHandCapability().isAllowed?this._conferenceService.raiseLowerHand(!0):b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"an attepmt to raise hand was failed"))},lowerHand:function(){return this.getSupportLowerHandCapability().isAllowed?this._conferenceService.raiseLowerHand(!1):b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"an attepmt to lower hand was failed"))},_recalculateAllCapabilities:function(){this._conferenceService?this._conferenceService._recalculateAllCapabilities?this._conferenceService._recalculateAllCapabilities(this):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"conferenceService has no method _recalculateAllCapabilities"):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"conference service not initialized")},_recalculate:function(){this._conferenceService._recalculateAllCapabilities(this),this._activeParticipants.forEach(function(a){a._recalculateAllCapabilities()})},getSelfParticipant:function(){return this._selfParticipant},isRecordingActive:function(){return this._recordingStatus===c.Services.Conference.RecordingStatus.ON||this._recordingStatus===c.Services.Conference.RecordingStatus.PAUSE},isRecordingPaused:function(){return this._recordingStatus===c.Services.Conference.RecordingStatus.PAUSE},getEncryptionStatus:function(){return this._encryptionStatus},getSubject:function(){return this._subject},getMeetingEndTime:function(){return this._terminationTime},isStreamingActive:function(){return this._isStreamingActive},isApplicationSharingActive:function(){return this._isApplicationSharingActive},getStreamingURI:function(){return this._streamingURI},getJoinMeetingURI:function(){return this._joinMeetingURI},getDialInInformation:function(){return this._dialInInformation},getDialInInformationHtml:function(){return this._dialInInformationHtml},toString:function(){return this._id},_getPreEnteredPasscode:function(){return this._preEnteredPasscode},_disconnect:function(){return this._conferenceService.sendDisconnectEvent()},_getType:function(){return this._conferenceService.getType()},_sendLocalMuteEvent:function(a){var b=function(){c.Base.Logger.debug(c.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent onFailure service now available sending mute "+a),this._conferenceService.sendLocalMuteEvent(this._selfParticipantId,a),this.removeOnConferenceServiceAvailableCallback(b)}.bind(this),d=function(){c.Base.Logger.debug(c.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent onFailure mute "+a),this.addOnConferenceServiceAvailableCallback(b)}.bind(this);return this._selfParticipantId?(c.Base.Logger.debug(c.Base.LoggerTags.CONFERENCE_SERVICE,"_sendLocalMuteEvent sending mute "+a),this._conferenceService.sendLocalMuteEvent(this._selfParticipantId,a).fail(d)):void d()},_setConfiguration:function(a){this._uccpConfig=a},_setCollaboration:function(a){this._collaboration=a},_setConferenceStarted:function(a){this._isStarted=a,this._isStarted&&(this._isStarting=!1),c.Base.Logger.debug(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setConferenceStarted: "+a)},_isConferenceStarted:function(){return this._isStarted},_updateChatService:function(a){this._chat&&this._chat._chatService&&this._chat._chatService._setEnableSendingMessages(a.isAllowed)},getKnockDoorTimeout:function(){return this._knockDoorTimeout},isPasscodeRequiredToEnterConference:function(){return!c.Base.Utils.isDefined(this._admissionPasscodeNeeded)||this._admissionPasscodeNeeded},isPermissionRequiredToEnterLockedConference:function(){return!c.Base.Utils.isDefined(this._admissionPermissionNeeded)||this._admissionPermissionNeeded}},c.Base.AOPTools.addAdvices(d,"Conference",["_setConferenceStarted"],[c.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Conference",["start","stop","setLocked","setVideoSelfSee","setDisplayVideoParticipantName","startRecording","stopRecording","pauseRecording","resumeRecording","setVideoLayout","muteAllParticipants","unmuteAllParticipants","addParticipant","addParticipantFromCall","removeParticipant","removeLastParticipant","terminateConference","sendPasscode","sendRequestToEnterLockedConference","requestToBecomeModerator","signIn","pinVideoByParticipant","pinVideoByCoordinates","extendMeeting","raiseHand","lowerHand"],[c.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),c.Services.Conference.Conference=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Conference.Conference.prototype,{addOnEventConferenceStatusChangedCallback:function(a){this._onEventConferenceStatusChangedCallbacks.add(a)},removeOnEventConferenceStatusChangedCallback:function(a){this._onEventConferenceStatusChangedCallbacks.remove(a)},addOnConferenceLockStatusChangedCallback:function(a){this._onConferenceLockStatusChangedCallbacks.add(a)},removeOnConferenceLockStatusChangedCallback:function(a){this._onConferenceLockStatusChangedCallbacks.remove(a)},addOnConferenceDisplayVideoParticipantNameChangedCallback:function(a){this._onConferenceDisplayVideoParticipantNameChangedCallbacks.add(a)},removeOnConferenceDisplayVideoParticipantNameChangedCallback:function(a){this._onConferenceDisplayVideoParticipantNameChangedCallbacks.remove(a)},addOnConferenceVideoSelfSeeChangedCallback:function(a){this._onConferenceVideoSelfSeeChangedCallbacks.add(a)},removeOnConferenceVideoSelfSeeChangedCallback:function(a){this._onConferenceVideoSelfSeeChangedCallbacks.remove(a)},addOnConferenceVideoLayoutChangedCallback:function(a){this._onConferenceVideoLayoutChangedCallbacks.add(a)},removeOnConferenceVideoLayoutChangedCallback:function(a){this._onConferenceVideoLayoutChangedCallbacks.remove(a)},addOnConferenceDisplayParticipantNameOnVideoAllowedCallback:function(a){this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.add(a)},removeOnConferenceDisplayParticipantNameOnVideoAllowedCallback:function(a){this._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.remove(a)},addOnConferenceVideoSelfSeeAllowedCallback:function(a){this._onConferenceVideoSelfSeeAllowedCallbacks.add(a)},removeOnConferenceVideoSelfSeeAllowedCallback:function(a){this._onConferenceVideoSelfSeeAllowedCallbacks.remove(a)},addOnConferenceVideoPinAllowedCallback:function(a){this._onConferenceVideoPinAllowedCallbacks.add(a)},removeOnConferenceVideoPinAllowedCallback:function(a){this._onConferenceVideoPinAllowedCallbacks.remove(a)},addOnConferenceAvailableVideoLayoutsChangedCallback:function(a){this._onConferenceAvailableVideoLayoutsChangedCallbacks.add(a)},removeOnConferenceAvailableVideoLayoutsChangedCallback:function(a){this._onConferenceAvailableVideoLayoutsChangedCallbacks.remove(a)},addOnConferenceContinuationStatusChangedCallback:function(a){this._onConferenceContinuationStatusChangedCallbacks.add(a)},removeOnConferenceContinuationStatusChangedCallback:function(a){this._onConferenceContinuationStatusChangedCallbacks.remove(a)},addOnConferenceRecordingStatusChangedCallback:function(a){this._onConferenceRecordingStatusChangedCallbacks.add(a)},removeOnConferenceRecordingStatusChangedCallback:function(a){this._onConferenceRecordingStatusChangedCallbacks.remove(a)},addOnConferenceRecordingFailedCallbacks:function(a){this._onConferenceRecordingFailedCallbacks.add(a)},removeOnConferenceRecordingFailedCallbacks:function(a){this._onConferenceRecordingFailedCallbacks.remove(a)},addOnConferenceVideoStatusChangedCallback:function(a){this._onConferenceVideoStatusChangedCallbacks.add(a)},removeOnConferenceVideoStatusChangedCallback:function(a){this._onConferenceVideoStatusChangedCallbacks.remove(a)},addOnConferenceLectureModeStatusChangedCallback:function(a){this._onConferenceLectureModeStatusChangedCallbacks.add(a)},removeOnConferenceLectureModeStatusChangedCallback:function(a){this._onConferenceLectureModeStatusChangedCallbacks.remove(a)},addOnConferenceStreamingStatusChangedCallback:function(a){this._onConferenceStreamingStatusChangedCallbacks.add(a)},removeOnConferenceStreamingStatusChangedCallback:function(a){this._onConferenceStreamingStatusChangedCallbacks.remove(a)},addOnConferenceEncryptionStatusChangedCallback:function(a){this._onConferenceEncryptionStatusChangedCallbacks.add(a)},removeOnConferenceEncryptionStatusChangedCallback:function(a){this._onConferenceEncryptionStatusChangedCallbacks.remove(a)},addOnConferenceMeetingTerminationTimeChangedCallback:function(a){this._onConferenceMeetingTerminationTimeChangedCallbacks.add(a)},removeOnConferenceMeetingTerminationTimeChangedCallback:function(a){this._onConferenceMeetingTerminationTimeChangedCallbacks.remove(a)},addOnConferenceMeetingTerminationInProgressCallbacks:function(a){this._onConferenceMeetingTerminationInProgressCallbacks.add(a)},removeOnConferenceMeetingTerminationInProgressCallbacks:function(a){this._onConferenceMeetingTerminationInProgressCallbacks.remove(a)},addOnConferenceEntryExitToneChangedCallback:function(a){this._onConferenceEntryExitToneChangedCallbacks.add(a)},removeOnConferenceEntryExitToneChangedCallback:function(a){this._onConferenceEntryExitToneChangedCallbacks.remove(a)},addOnConferencePresentationModeStatusChangedCallback:function(a){this._onConferencePresentationModeStatusChangedCallbacks.add(a)},removeOnConferencePresentationModeStatusChangedCallback:function(a){this._onConferencePresentationModeStatusChangedCallbacks.remove(a)},addOnConferenceActiveTalkersChangedCallback:function(a){this._onConferenceActiveTalkersChangedCallbacks.add(a)},removeOnConferenceActiveTalkersChangedCallback:function(a){this._onConferenceActiveTalkersChangedCallbacks.remove(a)},addOnConferenceActiveVideoParticipantsChangedCallback:function(a){this._onConferenceActiveVideoParticipantsChangedCallbacks.add(a)},removeOnConferenceActiveVideoParticipantsChangedCallback:function(a){this._onConferenceActiveVideoParticipantsChangedCallbacks.remove(a)},addOnConferenceAllParticipantsMutedCallback:function(a){this._onConferenceAllParticipantsMutedCallbacks.add(a)},removeOnConferenceAllParticipantsMutedCallback:function(a){this._onConferenceAllParticipantsMutedCallbacks.remove(a)},addOnConferenceAllParticipantsUnmutedCallback:function(a){this._onConferenceAllParticipantsUnmutedCallbacks.add(a)},removeOnConferenceAllParticipantsUnmutedCallback:function(a){this._onConferenceAllParticipantsUnmutedCallbacks.remove(a)},addOnConferencePendingParticipantCallback:function(a){this._onConferencePendingParticipantCallbacks.add(a)},removeOnConferencePendingParticipantCallback:function(a){this._onConferencePendingParticipantCallbacks.remove(a)},addOnConferencePendingParticipantRemovedCallback:function(a){this._onConferencePendingParticipantRemovedCallbacks.add(a)},removeOnConferencePendingParticipantRemovedCallback:function(a){this._onConferencePendingParticipantRemovedCallbacks.remove(a)},addOnConferenceDroppedParticipantAddedCallback:function(a){this._onConferenceDroppedParticipantAddedCallbacks.add(a)},removeOnConferenceDroppedParticipantAddedCallback:function(a){this._onConferenceDroppedParticipantAddedCallbacks.remove(a)},addOnConferenceDroppedParticipantRemovedCallback:function(a){this._onConferenceDroppedParticipantRemovedCallbacks.add(a)},removeOnConferenceDroppedParticipantRemovedCallback:function(a){this._onConferenceDroppedParticipantRemovedCallbacks.remove(a)},addOnConferenceServiceAvailableCallback:function(a){this._onConferenceServiceAvailableCallbacks.add(a)},removeOnConferenceServiceAvailableCallback:function(a){this._onConferenceServiceAvailableCallbacks.remove(a)},addOnConferenceServiceUnavailableCallback:function(a){this._onConferenceServiceUnavailableCallbacks.add(a)},removeOnConferenceServiceUnavailableCallback:function(a){this._onConferenceServiceUnavailableCallbacks.remove(a)},addOnConferenceParticipantsAddedCallback:function(a){this._onConferenceParticipantsAddedCallbacks.add(a)},removeOnConferenceParticipantsAddedCallback:function(a){this._onConferenceParticipantsAddedCallbacks.remove(a)},addOnConferenceParticipantsRemovedCallback:function(a){this._onConferenceParticipantsRemovedCallbacks.add(a)},removeOnConferenceParticipantsRemovedCallback:function(a){this._onConferenceParticipantsRemovedCallbacks.remove(a)},addOnConferenceSubjectCallback:function(a){this._onConferenceSubjectChangedCallbacks.add(a)},removeOnConferenceSubjectCallback:function(a){this._onConferenceSubjectChangedCallbacks.remove(a)},addOnConferenceKnockDoorTimeoutChangedCallback:function(a){this._onConferenceKnockDoorTimeoutChangedCallbacks.add(a)},removeOnConferenceKnockDoorTimeoutChangedCallback:function(a){this._onConferenceKnockDoorTimeoutChangedCallbacks.remove(a)},addOnConferenceOwnerAddressChangedCallback:function(a){this._onConferenceOwnerAddressChangedCallbacks.add(a)},removeOnConferenceOwnerAddressChangedCallback:function(a){this._onConferenceOwnerAddressChangedCallbacks.remove(a)},addOnConferenceCollaborationURIChangedCallback:function(a){this._onConferenceCollaborationURIChangedCallbacks.add(a)},removeOnConferenceCollaborationURIChangedCallback:function(a){this._onConferenceCollaborationURIChangedCallbacks.remove(a)},addOnConferenceStartingCallback:function(a){this._onConferenceStartingCallbacks.add(a)},removeOnConferenceStartingCallback:function(a){this._onConferenceStartingCallbacks.remove(a)},addOnConferenceWaitingToStartCallback:function(a){this._onConferenceWaitingToStartCallbacks.add(a)},removeOnConferenceWaitingToStartCallback:function(a){this._onConferenceWaitingToStartCallbacks.remove(a)},addOnConferenceConnectionEndedCallbacks:function(a){this._onConferenceConnectionEndedCallbacks.add(a)},removeOnConferenceConnectionEndedCallbacks:function(a){this._onConferenceConnectionEndedCallbacks.remove(a)},_addOnConferenceAllowVideoDirectionChangedCallback:function(a){this._onConferenceAllowVideoDirectionChangedCallbacks.add(a)},_removeOnConferenceAllowVideoDirectionChangedCallback:function(a){this._onConferenceAllowVideoDirectionChangedCallbacks.remove(a)},addOnConferenceStreamingURIUpdatedCallback:function(a){this._onConferenceStreamingURIUpdatedCallbacks.add(a)},removeOnConferenceStreamingURIUpdatedCallback:function(a){this._onConferenceStreamingURIUpdatedCallbacks.remove(a)},addOnConferenceJoinMeetingURIUpdatedCallback:function(a){this._onConferenceJoinMeetingURIUpdatedCallbacks.add(a)},removeOnConferenceJoinMeetingURIUpdatedCallback:function(a){this._onConferenceJoinMeetingURIUpdatedCallbacks.remove(a)},addOnConferenceDialInInfoUpdatedCallback:function(a){this._onConferenceDialInInfoUpdatedCallbacks.add(a)},removeOnConferenceDialInInfoUpdatedCallback:function(a){this._onConferenceDialInInfoUpdatedCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";var d={getInConferenceChatCapability:function(){return this._inConferenceChatCapability},_recalculateInConferenceChatCapability:function(){var a,b=!0;this._inConferenceChatCapability&&this._inConferenceChatCapability instanceof c.Base.Capability?(a=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,!this._isInWaitingRoomState()&&!this._isCmConference()&&this._isAvailable||(b=!1,a=c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._inConferenceChatCapability._updateIfChanged(b,a)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_inConferenceChatCapability property is not defined")},_isInWaitingRoomState:function(){return this._mediaStatus===c.Services.Conference.MediaStatus.WAITING_ROOM},_isCmConference:function(){return this._conferenceProvider!==a&&this._conferenceProvider._conferenceType!==a&&this._conferenceProvider._conferenceType===c.Services.Conference.ConferenceType.CM},getSupportMeetingMinutesCapability:function(){return this._supportMeetingMinutesCapability},getModerateConferenceCapability:function(){return this._moderateConferenceCapability},_recalculateModerateConferenceCapability:function(){var a,b;this._moderateConferenceCapability&&this._moderateConferenceCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._moderateConferenceCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_moderateConferenceCapability property is not defined")},getActiveTalkerCapability:function(){return this._activeTalkerCapability},_recalculateActiveTalkerCapability:function(){var a,b;this._activeTalkerCapability&&this._activeTalkerCapability instanceof c.Base.Capability?(b=this._isUccpConference?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._activeTalkerCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_activeTalkerCapability property is not defined")},getMuteSelfAudioCapability:function(){return this._muteSelfAudioCapability},_recalculateMuteSelfAudioCapability:function(){var a,b;this._muteSelfAudioCapability&&this._muteSelfAudioCapability instanceof c.Base.Capability?(this._isUccpConference&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._unmuteSelfPermissions)?this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteSelfAudioCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_muteSelfAudioCapability property is not defined")},getUnmuteSelfAudioCapability:function(){return this._unmuteSelfAudioCapability},_recalculateUnmuteSelfAudioCapability:function(){var a,b;this._unmuteSelfAudioCapability&&this._unmuteSelfAudioCapability instanceof c.Base.Capability?(this._isUccpConference&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._unmuteSelfPermissions)?this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteSelfPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteSelfAudioCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_unmuteSelfAudioCapability property is not defined")},getSendFeccCapability:function(){return this._sendFeccCapability},_recalculateSendFeccCapability:function(){var a,b;this._sendFeccCapability&&this._sendFeccCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._sendFeccPermissions)?this._sendFeccPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._sendFeccPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._sendFeccPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._sendFeccPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendFeccCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_sendFeccCapability property is not defined")},getTerminateConferenceCapability:function(){return this._terminateConferenceCapability},_recalculateTerminateConferenceCapability:function(){var a,b;this._terminateConferenceCapability&&this._terminateConferenceCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._terminateConferenceCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_terminateConferenceCapability property is not defined")},getUpdateLockStatusCapability:function(){return this._setLockCapability},_recalculateSetLockCapability:function(){var a,b;this._setLockCapability&&this._setLockCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._lockPermissions)?this._lockPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._lockPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._lockPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._lockPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setLockCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setLockCapability property is not defined")},getStartRecordingCapability:function(){return this._startRecordingCapability},getStopRecordingCapability:function(){return this._stopRecordingCapability},getPauseRecordingCapability:function(){return this._pauseRecordingCapability},getResumeRecordingCapability:function(){return this._resumeRecordingCapability},_recalculateStartStopRecordingCapability:function(){var a,b,d;this._startRecordingCapability&&this._startRecordingCapability instanceof c.Base.Capability?this._stopRecordingCapability&&this._stopRecordingCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._recorderStatus)&&c.Base.Utils.isDefined(this._recordingPermissions)?this._recordingPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED||this._recorderStatus===c.Services.Conference.RecorderStatus.NONE?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN_OR_MODERATOR?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN_OR_MODERATOR):(d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,b=this.isRecordingActive()?!(a=!1):!(a=!0)):(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startRecordingCapability._updateIfChanged(a,d),this._stopRecordingCapability._updateIfChanged(b,d)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_stopRecordingCapability property is not defined"):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_startRecordingCapability property is not defined")},_recalculatePauseResumeRecordingCapability:function(){var a,b,d;this._pauseRecordingCapability&&this._pauseRecordingCapability instanceof c.Base.Capability?this._resumeRecordingCapability&&this._resumeRecordingCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._recorderStatus)&&c.Base.Utils.isDefined(this._recordingPermissions)?this._recordingPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED||this._recorderStatus!==c.Services.Conference.RecorderStatus.WITH_PAUSE?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):this._recordingPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN_OR_MODERATOR?(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN_OR_MODERATOR):(d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,b=this.isRecordingActive()?this.isRecordingPaused()?!(a=!1):!(a=!0):a=!1):(b=a=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._pauseRecordingCapability._updateIfChanged(a,d),this._resumeRecordingCapability._updateIfChanged(b,d)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_resumeRecordingCapability property is not defined"):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_pauseRecordingCapability property is not defined")},getSupportRaiseHandCapability:function(){return this._raiseHandSupportCapability},_recalculateRaiseHandSupportCapability:function(){var a,b;this._raiseHandSupportCapability&&this._raiseHandSupportCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant._audioFromParticipant!==c.Services.Conference.MediaFromParticipantStatus.NA?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._raiseHandSupportCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_raiseHandSupportCapability property is not defined")},getSupportLowerHandCapability:function(){
return this._lowerHandSupportCapability},_recalculateLowerHandSupportCapability:function(){var a,b;this._lowerHandSupportCapability&&this._lowerHandSupportCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant._audioFromParticipant!==c.Services.Conference.MediaFromParticipantStatus.NA?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._lowerHandSupportCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_lowerHandSupportCapability property is not defined")},getRetrieveParticipantListCapability:function(){return this._retrieveParticipantListCapability},_recalculateRetrieveParticipantListCapability:function(){var a,b;this._retrieveParticipantListCapability&&this._retrieveParticipantListCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._retrieveParticipantListCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_retrieveParticipantListCapability property is not defined")},getMuteAllParticipantsCapability:function(){return this._muteUnmuteAllCapability},getUnmuteAllParticipantsCapability:function(){return this._muteUnmuteAllCapability},_recalculateMuteUnmuteAllCapability:function(){var a,b;this._muteUnmuteAllCapability&&this._muteUnmuteAllCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._unmuteAllPermissions)?this._unmuteAllPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._unmuteAllPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this._unmuteAllPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._unmuteAllPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteUnmuteAllCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_muteUnmuteAllCapability property is not defined")},getChangeParticipantRoleCapability:function(){},getUpdateDisplayVideoParticipantNameCapability:function(){return this._setDisplayVideoParticipantNameCapability},_recalculateDisplayVideoParticipantNameCapability:function(){var a,b;this._setDisplayVideoParticipantNameCapability&&this._setDisplayVideoParticipantNameCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._isVideoParticipantNameDisplayChangeAllowed)?this._isVideoParticipantNameDisplayChangeAllowed?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setDisplayVideoParticipantNameCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setDisplayVideoParticipantNameCapability property is not defined")},getUpdateVideoSelfSeeCapability:function(){return this._setVideoSelfSeeCapability},_recalculateVideoSelfSeeCapability:function(){var a,b;this._setVideoSelfSeeCapability&&this._setVideoSelfSeeCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._isVideoSelfSeeChangeAllowed)?this._isVideoSelfSeeChangeAllowed?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoSelfSeeCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoSelfSeeCapability property is not defined")},getUpdateVideoLayoutCapability:function(){return this._setVideoLayoutCapability},_recalculateSetVideoLayoutCapability:function(){if(this._setVideoLayoutCapability&&this._setVideoLayoutCapability instanceof c.Base.Capability){var a=void 0===this._isVideoPersonalLayoutActive||this._isVideoPersonalLayoutActive;if(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._currentVideoLayout)&&c.Base.Utils.isDefined(this._supportedVideoLayouts)&&a){for(var b=!1,d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED,e=0;e<this._supportedVideoLayouts.length;++e)if(this._supportedVideoLayouts[e].geometry===this._currentVideoLayout){b=!0,d=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;break}}else d=a?(b=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);this._setVideoLayoutCapability._updateIfChanged(b,d)}else c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoLayoutCapability property is not defined")},getRequestToBecomeModeratorCapability:function(){return this._setRequestToBecomeModeratorCapability},_recalculateRequestToBecomeModeratorCapability:function(){var a,b;this._setRequestToBecomeModeratorCapability&&this._setRequestToBecomeModeratorCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)?this.isEventConference()&&this._selfParticipant.isRestrictedParticipant()?(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._selfParticipant.isModerator()?(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setRequestToBecomeModeratorCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setRequestToBecomeModeratorCapability property is not defined")},getVideoPinCapability:function(){return this._setVideoPinCapability},_recalculateVideoPinCapability:function(){var a,b;this._setVideoPinCapability&&this._setVideoPinCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._isVideoPinAllowed)?this._isVideoPinAllowed?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._setVideoPinCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_setVideoPinCapability property is not defined")},getAddParticipantViaDialoutCapability:function(){return this._addParticipantViaDialoutCapability},_recalculateAddParticipantViaDialoutCapability:function(){var a,b;this._addParticipantViaDialoutCapability&&this._addParticipantViaDialoutCapability instanceof c.Base.Capability?(this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&c.Base.Utils.isDefined(this._dialoutPermissions)?this._dialoutPermissions===c.Services.Conference.PermissionStatus.ALLOWED?(a=!0,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):this._dialoutPermissions===c.Services.Conference.PermissionStatus.NOT_ALLOWED?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._dialoutPermissions===c.Services.Conference.PermissionStatus.NEED_MODERATOR?(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_MODERATOR):this._dialoutPermissions===c.Services.Conference.PermissionStatus.NEED_SIGNIN&&(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_NEED_SIGNIN):(a=!1,b=c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantViaDialoutCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_addParticipantViaDialoutCapability property is not defined")},getRemoveSelectParticipantCapability:function(){return this._removeSelectParticipantCapability},_recalculateRemoveSelectParticipantCapability:function(){var a,b;this._removeSelectParticipantCapability&&this._removeSelectParticipantCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeSelectParticipantCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_removeSelectParticipantCapability property is not defined")},getSignInCapability:function(){return this._signInCapability},_recalculateSignInCapability:function(){var a,b;this._signInCapability&&this._signInCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._signInCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_signInCapability property is not defined")},getRemoveLastParticipantCapability:function(){return this._removeLastParticipantCapability},getAcceptPendingParticipantCapability:function(){return this._acceptPendingParticipantCapability},_recalculateAcceptPendingParticipantCapability:function(){var a,b;this._acceptPendingParticipantCapability&&this._acceptPendingParticipantCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._acceptPendingParticipantCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_acceptPendingParticipantCapability property is not defined")},getDenyPendingParticipantCapability:function(){return this._denyPendingParticipantCapability},_recalculateDenyPendingParticipantCapability:function(){var a,b;this._denyPendingParticipantCapability&&this._denyPendingParticipantCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._denyPendingParticipantCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_denyPendingParticipantCapability property is not defined")},getExtendMeetingCapability:function(){return this._extendMeetingCapability},_recalculateExtendMeetingCapability:function(){var a,b;this._extendMeetingCapability&&this._extendMeetingCapability instanceof c.Base.Capability?(b=this._isAvailable&&c.Base.Utils.isDefined(this._selfParticipant)&&this._selfParticipant.isModerator()?(a=!0,c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(a=!1,c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._extendMeetingCapability._updateIfChanged(a,b)):c.Base.Logger.error(c.Base.LoggerTags.CONFERENCE_SERVICE,"_extendMeetingCapability property is not defined")},getAddParticipantFromCallCapability:function(a){var b=a.getCallId();return this._addParticipantFromCallCapabilities.hasOwnProperty(b)||(a.addOnCallConferenceStatusChangedCallback(function(){this._recalculateAddParticipantFromCallCapability(a)}.bind(this)),this._addParticipantFromCallCapabilities[b]=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._recalculateAddParticipantFromCallCapability(a)),this._addParticipantFromCallCapabilities[b]},_recalculateAddParticipantFromCallCapability:function(a){this._conferenceService._recalculateAddParticipantFromCallCapability(this,a)},_recalculateAllAddParticipantFromCallCapability:function(){for(var a in this._addParticipantFromCallCapabilities)this._addParticipantFromCallCapabilities.hasOwnProperty(a)&&this._conferenceService._recalculateAddParticipantFromCallCapabilityByCallId(this,a)}};b.extend(c.Services.Conference.Conference.prototype,d)}(AvayaClientServices),function(a){"use strict";function c(c,d){a.Services.Participant.call(this),this._participantService=c,this._conference=d,this._onParticipantStatusChangedCallbacks=b.Callbacks(),this._setUnsetAsLecturerCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._muteAudioCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unmuteAudioCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._blockVideoCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._unblockVideoCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._remoteCameraControlCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._lowerHandCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._changeParticipantNameCapability=new a.Base.Capability(a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}(c.prototype=Object.create(a.Services.Participant.prototype)).getParticipantAuthorizationStatus=function(){return this._status},c.prototype.isPendingParticipant=function(){return this._status===a.Services.Conference.ParticipantAuthorizationStatus.AUTHORIZING},c.prototype.isActiveParticipant=function(){return this._status===a.Services.Conference.ParticipantAuthorizationStatus.ACTIVE},c.prototype._recalculateAllCapabilities=function(){this._participantService.recalculateAllCapabilities(this)},a.Services.Conference.Participant=c}(AvayaClientServices),function(a){"use strict";var c={getMuteParticipantAudioCapability:function(){return this._muteAudioCapability},getUnmuteParticipantAudioCapability:function(){return this._unmuteAudioCapability},_recalculateMuteUnmuteCapability:function(){function b(a,b){j=a,l=b}function c(a,b){k=a,m=b}var d=a.Services.Conference.MediaFromParticipantStatus,e=a.Base.CapabilityDenialReason,f=e.CAPABILITY_INVALID_STATE,g=e.CAPABILITY_CALL_HAS_NO_AUDIO,h=e.CAPABILITY_NOT_ALLOWED,i=e.CAPABILITY_NOT_DENIED,j=!1,k=!1,l=h,m=h,n=this._conference._selfParticipant&&this._conference._selfParticipant.isModerator(),o=this._conference.isLectureModeActive();if(this._conference._isAvailable)switch(this._audioFromParticipant){case d.NA:b(!1,g),c(!1,g);break;case d.ACTIVE:case d.SELF_MUTED:n&&b(!0,i);break;case d.MODERATOR_MUTED:case d.BOTH_MUTED:(n||this._isSelfParticipant&&!o)&&c(!0,i)}else b(!1,f),c(!1,f);this._muteAudioCapability._updateIfChanged(j,l),this._unmuteAudioCapability._updateIfChanged(k,m)},getBlockParticipantVideoCapability:function(){return this._blockVideoCapability},getUnblockParticipantVideoCapability:function(){return this._unblockVideoCapability},_recalculateBlockUnblockVideoCapability:function(){function b(a,b){j=a,l=b}function c(a,b){k=a,m=b}var d=a.Services.Conference.MediaFromParticipantStatus,e=a.Base.CapabilityDenialReason,f=e.CAPABILITY_INVALID_STATE,g=e.CAPABILITY_CALL_HAS_NO_VIDEO,h=e.CAPABILITY_NOT_ALLOWED,i=e.CAPABILITY_NOT_DENIED,j=!1,k=!1,l=h,m=h,n=this._conference._selfParticipant&&this._conference._selfParticipant.isModerator(),o=this._conference.isLectureModeActive();if(this._conference._isAvailable)switch(this._videoFromParticipant){case d.NA:b(!1,g),c(!1,g);break;case d.ACTIVE:n&&b(!0,i);break;case d.MODERATOR_MUTED:(n||this._isSelfParticipant&&!o)&&c(!0,i)}else b(!1,f),c(!1,f);this._blockVideoCapability._updateIfChanged(j,l),this._unblockVideoCapability._updateIfChanged(k,m)},getChangeRoleCapability:function(){},getAssignParticipantAsLecturerCapability:function(){return this._setUnsetAsLecturerCapability},_recalculateSetAsLecturerCapability:function(){var b,c=a.Base.Utils.isUndefined(this._canLecture)&&this._audioFromParticipant===a.Services.Conference.MediaFromParticipantStatus.NA?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_CALL_HAS_NO_AUDIO):!1===this._canLecture?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):this._conference._isAvailable&&a.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._setUnsetAsLecturerCapability._updateIfChanged(b,c)},getLowerParticipantHandCapability:function(){return this._lowerHandCapability},_recalculateLowerHandCapability:function(){var b,c=this._conference._isAvailable&&a.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._lowerHandCapability._updateIfChanged(b,c)},getRemoteCameraControlCapability:function(){return this._remoteCameraControlCapability},_recalculateRemoteCameraControlCapability:function(){var b,c=this._conference._isAvailable&&a.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._remoteCameraControlCapability._updateIfChanged(b,c)},getChangeParticipantNameCapability:function(){return this._changeParticipantNameCapability},_recalculateChangeParticipantNameCapability:function(){var b,c=this._conference._selfParticipant.isConferenceOwner()?this._conference._isAvailable&&a.Base.Utils.isDefined(this._conference._selfParticipant)&&this._conference._selfParticipant.isModerator()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_CONFERENCE_OWNER);this._changeParticipantNameCapability._updateIfChanged(b,c)}};b.extend(a.Services.Conference.Participant.prototype,c)}(AvayaClientServices),function(a){"use strict";function c(c,d){a.Services.Conference.Participant.call(this,c,d),this._onPendingParticipantAcceptedCallbacks=b.Callbacks(),this._onPendingParticipantCancelledCallbacks=b.Callbacks(),this._onPendingParticipantDeniedCallbacks=b.Callbacks()}(c.prototype=Object.create(a.Services.Conference.Participant.prototype)).accept=function(){return this._participantService.accept(this)},c.prototype.deny=function(){return this._participantService.deny(this)},a.Base.AOPTools.addAdvices(c,"PendingParticipant",["accept","deny"],[a.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),a.Services.Conference.PendingParticipant=c}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Conference.PendingParticipant.prototype,{addOnPendingParticipantAcceptedCallback:function(a){this._onPendingParticipantAcceptedCallbacks.add(a)},removeOnPendingParticipantAcceptedCallback:function(a){this._onPendingParticipantAcceptedCallbacks.remove(a)},addOnPendingParticipantCancelledCallback:function(a){this._onPendingParticipantCancelledCallbacks.add(a)},removeOnPendingParticipantCancelledCallback:function(a){this._onPendingParticipantCancelledCallbacks.remove(a)},addOnPendingParticipantDeniedCallback:function(a){this._onPendingParticipantDeniedCallbacks.add(a)},removeOnPendingParticipantDeniedCallback:function(a){this._onPendingParticipantDeniedCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";function d(){this._uniqueAddressForMatching=a,this._firstName=new c.Services.Contacts.ContactStringField,this._lastName=new c.Services.Contacts.ContactStringField,this._displayName=new c.Services.Contacts.ContactStringField,this._asciiFirstName=new c.Services.Contacts.ContactStringField,this._asciiLastName=new c.Services.Contacts.ContactStringField,this._asciiDisplayName=new c.Services.Contacts.ContactStringField,this._alias=new c.Services.Contacts.ContactStringField,this._company=new c.Services.Contacts.ContactStringField,this._location=new c.Services.Contacts.ContactStringField,this._workRoomNumber=new c.Services.Contacts.ContactStringField,this._streetAddress=new c.Services.Contacts.ContactStringField,this._city=new c.Services.Contacts.ContactStringField,this._state=new c.Services.Contacts.ContactStringField,this._country=new c.Services.Contacts.ContactStringField,this._postalCode=new c.Services.Contacts.ContactStringField,this._manager=new c.Services.Contacts.ContactStringField,this._department=new c.Services.Contacts.ContactStringField,this._language=new c.Services.Contacts.ContactStringField,this._emailAddresses=new c.Services.Contacts.ContactFieldList,this._phoneNumbers=new c.Services.Contacts.ContactFieldList,this._imAddresses=new c.Services.Contacts.ContactFieldList,this._buddy=new c.Services.Contacts.ContactBooleanField,this._favorite=new c.Services.Contacts.ContactBooleanField,this._videoCapable=new c.Services.Contacts.ContactBooleanField,this._rank=new c.Services.Contacts.ContactNumberField,this._notes=new c.Services.Contacts.ContactStringField,this._custom1=new c.Services.Contacts.ContactFieldList,this._custom2=new c.Services.Contacts.ContactFieldList,this._custom3=new c.Services.Contacts.ContactFieldList,this._terminal=new c.Services.Contacts.Terminal,this._scopiaUserId=new c.Services.Contacts.ContactStringField,this._scopiaLoginId=new c.Services.Contacts.ContactStringField,this._inContactList=!1,this._pictureUrlMap={},this._selfContact=!1,this._presenceService=a,this._contactsService=a,this._presence=a,this._presenceAddress=a,this._presenceAddressCandidates=a,this._onPresenceReceived=a,this._getPresenceCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._onPresenceChangedCallbacks=b.Callbacks(),this._onContactChangedCallbacks=b.Callbacks()}d.prototype={getUniqueAddressForMatching:function(){var a,b=this._uniqueAddressForMatching;return b=-1<b.indexOf("/")?(a=b.split("/"))[a.length-1]:b},_getUniqueAddressWithoutChanges:function(){return this._uniqueAddressForMatching},_setUniqueAddressForMatching:function(a){this._uniqueAddressForMatching=a},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getDisplayName:function(){return this._displayName},getASCIIFirstName:function(){return this._asciiFirstName},getASCIILastName:function(){return this._asciiLastName},getASCIIDisplayName:function(){return this._asciiDisplayName},getAlias:function(){return this._alias},getLocation:function(){return this._location},getWorkRoomNumber:function(){return this._workRoomNumber},getStreetAddress:function(){return this._streetAddress},getCity:function(){return this._city},getState:function(){return this._state},getCountry:function(){return this._country},getPostalCode:function(){return this._postalCode},getCompany:function(){return this._company},getManager:function(){return this._manager},getDepartment:function(){return this._department},getPictureUrl:function(a){return a&&c.Services.Contacts.ContactPictureSize[a]||(a=c.Services.Contacts.ContactPictureSize.MEDIUM),this._pictureUrlMap[a]},addPictureUrl:function(a,b){a&&c.Services.Contacts.ContactPictureSize[a]&&b&&(this._pictureUrlMap[a]=b)},getLanguage:function(){return this._language},getEmailAddresses:function(){return this._emailAddresses},getPhoneNumbers:function(){return this._phoneNumbers},getIMAddresses:function(){return this._imAddresses},isBuddy:function(){return this._buddy},isFavorite:function(){return this._favorite},isVideoCapable:function(){return this._videoCapable},getNotes:function(){return this._notes},getRank:function(){return this._rank},getCustom1:function(){return this._custom1},getCustom2:function(){return this._custom2},getCustom3:function(){return this._custom3},getScopiaUserId:function(){return this._scopiaUserId},getScopiaLoginId:function(){return this._scopiaLoginId},getTerminal:function(){return this._terminal},_isInContactList:function(){return this._inContactList},_setInContactList:function(a){this._inContactList=a},getPresence:function(){return this._presence},startPresence:function(){if(!this._getPresenceCapability.isAllowed)return b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.UNSUPPORTED)).promise();this._onPresenceReceived=function(a){var d;a.getPresentity()===this._presenceAddress&&(this._selfContact&&(a=b.extend(new c.Services.Presence.SelfPresence,a),d=c.Services.Contacts.ContactsUtils.getPhoneAndVideoChannelPresenceAddress(this),this._presenceService._setSelfPresence(a,this._presenceAddress,d.getPhoneNumber())),this._presence=a,this._onPresenceChangedCallbacks.fire(this,a))}.bind(this);var a=this._presenceService.getPresenceListSubscription();a._addOnInternalPresenceReceivedCallback(this._onPresenceReceived);var d=b.Deferred(),e=function(){var f=this._getPresenceAddress()||this._getNextPresenceAddressCandidate();return f?(c.Base.Logger.debug(c.Base.LoggerTags.CONTACTS_SERVICE,"Attempting to subscribe for contact's presence using IM address",f),void a._addInternalAddress(f).done(function(){this._presenceAddress=f,d.resolve()}.bind(this)).fail(function(b){b instanceof c.Services.Presence.PresenceError&&b.getReason()===c.Services.Presence.PresenceErrorReason.TIMEOUT?(c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"Unable to subscribe for contact's presence using "+f+" IM address. Trying next one."),setTimeout(e,0)):(c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Failed to subscribe for contact's presence",b),a._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),d.reject(b))}.bind(this))):(c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"No IM addresses available for contact's presence subscription"),a._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.UNSUPPORTED)).promise())}.bind(this);return e(),d.promise()},stopPresence:function(){if(!this._getPresenceCapability.isAllowed)return b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.UNSUPPORTED));if(!this.getPresence())return c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"Cannot stop monitoring presence of this contact as it was not started"),b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.INVALID_STATE));var d=this._presenceService.getPresenceListSubscription();return d._removeInternalAddress(this._getPresenceAddress()).then(function(){d._removeOnInternalPresenceReceivedCallback(this._onPresenceReceived),this._presence=a}.bind(this))},_setPresenceService:function(a){this._presenceService=a,this._presenceService&&(this._presenceService.addOnPresenceServiceAvailableCallback(this._recalculateCapabilities.bind(this)),this._presenceService.addOnPresenceServiceUnavailableCallback(this._recalculateCapabilities.bind(this))),this._recalculateCapabilities()},_setContactsService:function(a){this._contactsService=a},_getPresenceAddress:function(){return this._presenceAddress},_getNextPresenceAddressCandidate:function(){this._presenceAddressCandidates||((a=(a=this._imAddresses.getValues()).slice(0,a.length)).sort(function(a,b){return a.isAvayaAdministered()&&!b.isAvayaAdministered()||a.getIMAddressType()===c.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK&&b.getIMAddressType()!==c.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK?-1:!a.isAvayaAdministered()&&b.isAvayaAdministered()||a.getIMAddressType()!==c.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK&&b.getIMAddressType()===c.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK?1:0}),this._presenceAddressCandidates=a);var a=this._presenceAddressCandidates.shift();if(a)return a.getAddress()},_recalculateCapabilities:function(){var a=this._presenceService&&0<this._imAddresses.getValues().length&&this._presenceService._available?c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:c.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED;this._getPresenceCapability._updateIfChanged(a===c.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,a)},_setSelfContact:function(a){this._selfContact=a}},c.Base.AOPTools.addAdvices(d,"Contact",["startPresence","stopPresence"],[c.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CONTACTS_ERROR]),c.Services.Contacts.Contact=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Contacts.Contact.prototype,{addOnPresenceChangedCallback:function(a){this._onPresenceChangedCallbacks.add(a)},removeOnPresenceChangedCallback:function(a){this._onPresenceChangedCallbacks.remove(a)},addOnContactChangedCallback:function(a){this._onContactChangedCallbacks.add(a)},removeOnContactChangedCallback:function(a){this._onContactChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Contacts.Contact.prototype,{getUpdateContactCapability:function(){return this._contactsService.getUpdateContactCapability(this)},getDeleteContactCapability:function(){return this._contactsService.getDeleteContactCapability(this)},getPresenceCapability:function(){return this._getPresenceCapability}})}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactField.call(this),this._value=!1}(b.prototype=Object.create(a.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},a.Services.Contacts.ContactBooleanField=b}(AvayaClientServices),function(b){"use strict";function c(){b.Services.Contacts.ContactField.call(this),this._address=a,this._emailAddressType=b.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER,this._default=!1}(c.prototype=Object.create(b.Services.Contacts.ContactField.prototype)).getAddress=function(){return this._address},c.prototype.getEmailAddressType=function(){return this._emailAddressType},c.prototype.isDefault=function(){return this._default},b.Services.Contacts.ContactEmailAddressField=c}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactBooleanField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactBooleanField.prototype)).setValue=function(a){this._value=a},a.Services.Contacts.EditableContactBooleanField=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Contacts.ContactEmailAddressField.call(this)}(b.prototype=Object.create(a.Services.Contacts.ContactEmailAddressField.prototype)).setAddress=function(a){this._address=a},b.prototype.setEmailAddressType=function(b){this._emailAddressType=b,this._default=this._emailAddressType===a.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK},a.Services.Contacts.EditableContactEmailAddressField=b}(AvayaClientServices),function(a){"use strict";function c(a){this._contactsService=a,this._isAvailable=!1,this._onCapabilitiesChangedCallbacks=b.Callbacks(),this._onContactsServiceUnavailableCallbacks=b.Callbacks(),this._onContactsServiceAvailableCallbacks=b.Callbacks()}c.prototype={createEditableContact:function(){return this._contactsService.createEditableContact()},createEditableContactFromContact:function(a){return this._contactsService.createEditableContactFromContact(a)},addContact:function(c){return a.Base.Utils.isUndefined(c)||!c.getContactSavableCapability().isAllowed?b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.REQUIRED_DATA_MISSING)):this._contactsService.getAddContactCapability(c).isAllowed?this._contactsService.addContact(c):b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.ADD_CONTACT_NOT_AVAILABLE))},updateContact:function(c){return a.Base.Utils.isUndefined(c)||!c.getContactSavableCapability().isAllowed?b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.REQUIRED_DATA_MISSING)):this._contactsService.isContactInCache(c)?this._contactsService.getUpdateContactCapability(c).isAllowed?this._contactsService.updateContact(c):b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.UPDATE_CONTACT_NOT_AVAILABLE)):b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND));
},deleteContact:function(c){return a.Base.Utils.isUndefined(c)||!this._contactsService.isContactInCache(c)?b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND)):this._contactsService.getDeleteContactCapability(c).isAllowed?this._contactsService.deleteContact(c):b.Deferred().reject(new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.DELETE_CONTACT_NOT_AVAILABLE))},getContacts:function(){return this._contactsService.getContacts()},searchContacts:function(b){if(!b)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search request"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_REQUEST);var c=b.getSearchField();if(c){if(!a.Services.Contacts.SearchFieldType.hasOwnProperty(c))throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search field"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD)}else b._searchField=a.Services.Contacts.SearchFieldType.ALL;if(!this._contactsService.getNetworkSearchContactCapability().isAllowed&&b.getSearchField()!==a.Services.Contacts.SearchFieldType.TERMINAL)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Search contacts is not available"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.SEARCH_CONTACTS_NOT_AVAILABLE);if(!this._contactsService.getNetworkSearchTerminalCapability().isAllowed&&b.getSearchField()===a.Services.Contacts.SearchFieldType.TERMINAL)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Search terminals is not available"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.SEARCH_TERMINALS_NOT_AVAILABLE);if(c=b.getSearchString(),!c||""===c)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search string"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_STRING);if(c=b.getSearchSource()){if(!a.Services.Contacts.SearchSourceType.hasOwnProperty(c))throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search source"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_SOURCE)}else b._searchSource=a.Services.Contacts.SearchSourceType.NETWORK;return c=b.getMaxResults(),(!c||c<0)&&(b._maxResults=0),c=b.getMaxChunkSize(),(!c||c<0)&&(b._maxChunkSize=0),this._contactsService.searchContacts(b)},resolveContacts:function(b){if(!b)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search request"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_REQUEST);var c=b.getSearchStrings();if(!c||!c.length)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search strings"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_STRINGS);if(500<c.length)throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Count of search strings is too large"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.SEARCH_STRINGS_TOO_LARGE);if(c=b.getSearchField()){if(!a.Services.Contacts.ResolveContactsFieldType.hasOwnProperty(c))throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search field"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD)}else b._setSearchField(a.Services.Contacts.ResolveContactsFieldType.PHONE_NUMBER);var d=a.Services.Contacts.SearchSourceType,c=this._contactsService.getNetworkResolveContactsCapability(),e=b.getSearchSource();if(e||(e=d.NETWORK,b._setSearchSource(d.NETWORK)),!c.isAllowed)switch(e){case d.NETWORK:throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution over the network is currently unavailable"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.SEARCH_CONTACTS_NOT_AVAILABLE);case d.ALL:a.Base.Logger.warn(a.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution over the network is currently unavailable, searching in local cache"),e=d.LOCAL,b._setSearchSource(d.LOCAL)}if(!d.hasOwnProperty(e))throw a.Base.Logger.error(a.Base.LoggerTags.CONTACTS_SERVICE,"Invalid search source"),new a.Services.Contacts.ContactsError(a.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_SOURCE);return this._contactsService.resolveContacts(b)},changeSearchContactsRequest:function(a,b){this._contactsService.changeSearchContactsRequest(a,b)},findLocalMatchingContacts:function(b,c){for(var d in a.Services.Contacts.SearchFieldType)a.Services.Contacts.SearchFieldType.hasOwnProperty(d)&&c===a.Services.Contacts.SearchFieldType[d]&&this._contactsService.findLocalMatchingContacts(b,c)},start:function(a){return this._startDfd=b.Deferred(),this._contactsService.start(this,a),this._startDfd.promise()},stop:function(){var a=function(){this._onCapabilitiesChangedCallbacks.empty(),this._onContactsServiceAvailableCallbacks.empty(),this._onContactsServiceUnavailableCallbacks.empty()}.bind(this);return this._contactsService.stop(this).always(a)},_stopImmediately:function(){return this._contactsService.stopImmediately(this)},_fireContactsAvailableCallback:function(){!this._isAvailable&&this._contactsService.isStarted()&&(this._isAvailable=!0,a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Service is available"),this._startDfd.state()===a.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onContactsServiceAvailableCallbacks.fire(this))},_fireContactsUnavailableCallback:function(){(this._isAvailable||this._contactsService.isStarting())&&(this._isAvailable=!1,a.Base.Logger.info(a.Base.LoggerTags.CONTACTS_SERVICE,"Service is unavailable"),this._startDfd.state()===a.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onContactsServiceUnavailableCallbacks.fire(this))}},a.Base.AOPTools.addAdvices(c,"Contacts",["createEditableContact","createEditableContactFromContact","getContacts","searchContacts","resolveContacts","changeSearchContactsRequest","findLocalMatchingContacts"],[a.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS]),a.Base.AOPTools.addAdvices(c,"Contacts",["addContact","updateContact","deleteContact"],[a.Base.AOPCommonAdvices.LOG_CONTACTS_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CONTACTS_ERROR]),a.Services.Contacts.Contacts=c}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Contacts.Contacts.prototype,{addOnContactsServiceUnavailableCallback:function(a){this._onContactsServiceUnavailableCallbacks.add(a)},removeOnContactsServiceUnavailableCallback:function(a){this._onContactsServiceUnavailableCallbacks.remove(a)},addOnContactsServiceAvailableCallback:function(a){this._onContactsServiceAvailableCallbacks.add(a)},removeOnContactsServiceAvailableCallback:function(a){this._onContactsServiceAvailableCallbacks.remove(a)},addOnContactServicesCapabilitiesChangedCallback:function(a){this._onCapabilitiesChangedCallbacks.add(a)},removeOnContactServicesCapabilitiesChangedCallback:function(a){this._onCapabilitiesChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Contacts.Contacts.prototype,{getAddContactCapability:function(){return this._contactsService.getAddContactCapability()},getNetworkSearchContactCapability:function(){return this._contactsService.getNetworkSearchContactCapability()},getNetworkSearchTerminalCapability:function(){return this._contactsService.getNetworkSearchTerminalCapability()},getConferenceSearchCapability:function(){return this._contactsService.getConferenceSearchCapability()},getNetworkResolveContactsCapability:function(){return this._contactsService.getNetworkResolveContactsCapability()}})}(AvayaClientServices),function(c){"use strict";function d(d){this._thumbnailCreator=d,this.disposition="",this.duration=-1,this.mimeType="",this.id="",this.size=-1,this.file=a,this.status="",this.name="",this.location="",this.thumbnail=a,this._onNameChangedCallbacks=b.Callbacks(),this._onMimeTypeChangedCallbacks=b.Callbacks(),this._onDurationChangedCallbacks=b.Callbacks(),this._onSizeChangedCallbacks=b.Callbacks(),this._onStatusChangedCallbacks=b.Callbacks(),this._onConsumptionStatusChangedCallbacks=b.Callbacks(),this._onTypeChangedCallbacks=b.Callbacks(),this._onHasThumbnailChangedCallbacks=b.Callbacks(),this._onIsSelfGeneratedCallbacks=b.Callbacks(),this._updateNameCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateMimeTypeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateDurationCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSizeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateLocationCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIsSelfGeneratedCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createThumbnailCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeThumbnailCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}d.prototype={_getStatus:function(){return this.status},getName:function(){if(this.name)return this.name;if(this.disposition&&-1!==this.disposition.search("filename"))try{return this.name=new RegExp("filename=(?:[\"']?)([^\"';]+)","i").exec(this.disposition)[1],this.name}catch(b){c.Base.Logger.error(c.Base.LoggerTags.MESSAGING_SERVICE,"Could not retrieve attachment name: "+b)}return a},getMimeType:function(){return this.mimeType},getDuration:function(){return this.duration},getSize:function(){return this.size},_isThumbnail:function(){return-1!==this.disposition.indexOf("inline")},getThumbnail:function(){return this.thumbnail},setName:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.name=a},setMimeType:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.mimeType=a},setDuration:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"number"}]}),this.duration=a},getDownloadURL:function(){return this.location},createThumbnail:function(){return!!this.getCreateThumbnailCapability().isAllowed&&this._thumbnailCreator.create(this)},removeThumbnail:function(){this.thumbnail=a},_setStatus:function(a){this.status=a,this._onStatusChangedCallbacks.fire(a)}},c.Base.AOPTools.addAdvices(d,"Attachment",["createThumbnail"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),c.Services.Messaging.Attachment=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Messaging.Attachment.prototype,{addOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.add(a)},removeOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.remove(a)},addOnHasThumbnailChangedCallback:function(a){this._onHasThumbnailChangedCallbacks.add(a)},removeOnHasThumbnailChangedCallback:function(a){this._onHasThumbnailChangedCallbacks.remove(a)},addOnIsSelfGeneratedCallback:function(a){this._onIsSelfGeneratedCallbacks.add(a)},removeOnIsSelfGeneratedCallback:function(a){this._onIsSelfGeneratedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getUpdateNameCapability:function(){return this._updateNameCapability},_recalculateUpdateNameCapability:function(){var b,c=this.status!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateNameCapability._updateIfChanged(b,c)},getUpdateMimeTypeCapability:function(){return this._updateMimeTypeCapability},_recalculateUpdateMimeTypeCapability:function(){var b,c=this.status!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateMimeTypeCapability._updateIfChanged(b,c)},getUpdateDurationCapability:function(){return this._updateDurationCapability},_recalculateUpdateDurationCapability:function(){var b,c=this.status!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateDurationCapability._updateIfChanged(b,c)},getUpdateIsSelfGeneratedCapability:function(){return this._updateIsSelfGeneratedCapability},_recalculateUpdateIsSelfGeneratedCapability:function(){var b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._updateIsSelfGeneratedCapability._updateIfChanged(!0,b)},getCreateThumbnailCapability:function(){return this._createThumbnailCapability},_recalculateCreateThumbnailCapability:function(){var b,c,d,e=!1;for(c in this._thumbnailCreator._creators)this._thumbnailCreator._creators.hasOwnProperty(c)&&(-1!==(d=c).indexOf("/*")&&(d=c.slice(0,c.indexOf("/*"))),-1!==this.getMimeType().indexOf(d)&&(e=!0,b=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED));e||(b=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createThumbnailCapability._updateIfChanged(e,b)},getRemoveThumbnailCapability:function(){return this._removeThumbnailCapability},_recalculateRemoveThumbnailCapability:function(){var b,c=this.status!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._removeThumbnailCapability._updateIfChanged(b,c)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var b,c=this.status!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._removeCapability._updateIfChanged(b,c)}};b.extend(a.Services.Messaging.Attachment.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(d){this._conversationService=d,this.attachmentCount=0,this.totalMessageCount=0,this.active=!1,this.closed=!1,this.sensitivity=c.Services.Messaging.SensitivityLevel.NORMAL,this.href="",this.id="",this.lastAccessTime=a,this.lastUpdated=a,this.latestEntryTimestamp=a,this.subject="",this.totalCount=0,this.type=c.Services.Messaging.ConversationType.THREAD,this.unreadAttachmentCount=0,this.unreadCount=0,this.unreadContentSinceLastAccess=0,this.resourceStatus=c.Services.Messaging.ResourceStatus.PUBLISHED,this.messages=new c.Base.DataSet,this.previewText="",this.participants=[],this.composingParticipants=new c.Base.DataSet,this.multiparty=!1,this._draftMessages=[],this._draftEscalations=[],this._counts={eventCount:0,eventUnreadMessage:0,messageAttachment:0,messageCount:0,messageUnreadAttachment:0,messageUnreadMessage:0},this._isSubscribed=!1,this._onMessagesAddedCallbacks=b.Callbacks(),this._onSubjectChangedCallbacks=b.Callbacks(),this._onParticipantsAddedCallbacks=b.Callbacks(),this._onParticipantsRemovedCallbacks=b.Callbacks(),this._onActiveStatusChangedCallbacks=b.Callbacks(),this._onClosedStatusChangedCallbacks=b.Callbacks(),this._onMultiPartyStatusChangedCallbacks=b.Callbacks(),this._onIsComposingStatusChangedCallbacks=b.Callbacks(),this._onLastAccessTimeChangedCallbacks=b.Callbacks(),this._onLastUpdatedTimeChangedCallbacks=b.Callbacks(),this._onLatestEntryTimeChangedCallbacks=b.Callbacks(),this._onStatusChangedCallbacks=b.Callbacks(),this._onPreviewTextChangedCallbacks=b.Callbacks(),this._onTotalMessagesCountChangedCallbacks=b.Callbacks(),this._onTotalUnreadMessageCountChangedCallbacks=b.Callbacks(),this._onTotalAttachmentCountChangedCallbacks=b.Callbacks(),this._onTotalUnreadAttachmentCountChangedCallbacks=b.Callbacks(),this._onTotalEventCountChangedCallbacks=b.Callbacks(),this._onTotalUnreadEventCountChangedCallbacks=b.Callbacks(),this._onSensitivityChangedCallbacks=b.Callbacks(),this._onTypeChangedCallbacks=b.Callbacks(),this._onMessagesRemovedCallbacks=b.Callbacks(),this._onOtherMessagesAddedCallbacks=b.Callbacks(),this._updateSubjectCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateLastAccessTimeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSensitivityCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._retrieveMessagesCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeParticipantsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createMessageCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createEscalationCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markAllContentAsReadCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._leaveCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._isTypingCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}d.prototype={getSensitivity:function(){return this.sensitivity},isActive:function(){return this.active},isClosed:function(){return this.closed},isMultiParty:function(){return this.multiparty},isPrivate:function(){return this.sensitivity===c.Services.Messaging.SensitivityLevel.PRIVATE},hasUnreadMessagesSinceLastAccess:function(){return 0<this._conversationService.getNumberOfMessagesWithUnreadContentSinceLastAccess(this)},hasUnreadAttachments:function(){return 0<this._counts.messageUnreadAttachment},hasAttachments:function(){return 0<this._counts.messageAttachment},isParticipantActive:function(a){},getLastAccessTime:function(){return this.lastAccessTime},getLastUpdatedTime:function(){return this.lastUpdated},getLastEntryTime:function(){return this.latestEntryTimestamp},getComposingParticipants:function(){return this.composingParticipants},getParticipants:function(){return this.participants},getActiveParticipants:function(){return this.getParticipants()},getType:function(){return this.type},getTotalMessageCount:function(){return this._counts.messageCount},getAttachmentCount:function(){return this._counts.messageAttachment},getUnreadAttachmentCount:function(){return this._counts.messageUnreadAttachment},getUnreadMessageCount:function(){return this._counts.messageUnreadMessage},getPreviewText:function(){return this.previewText},getSubject:function(){return this.subject},getLastUpdatedByParticipant:function(){var b=this._getLastMessage();return void 0===b?a:this.participants.filter(function(a){return a.address===b.from.address})[0]},getStatus:function(){return this.resourceStatus},setSensitivity:function(a){var b,d=!1;for(b in c.Services.Messaging.SensitivityLevel)if(c.Services.Messaging.SensitivityLevel.hasOwnProperty(b)&&a===c.Services.Messaging.SensitivityLevel[b]){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.sensitivity!==a&&(this.sensitivity=a,this._onSensitivityChangedCallbacks.fire(this,a)),d=!0;break}return d},_setStatus:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.resourceStatus!==a&&(this.resourceStatus=a,this._onStatusChangedCallbacks.fire(this,a))},setLastAccessTime:function(){this._conversationService.setLastAccessTime(this)},setSubject:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.subject!==a&&(this.getStatus()===c.Services.Messaging.ResourceStatus.PUBLISHED&&this._conversationService.changeSubject(this,a),this.subject=a,this._onSubjectChangedCallbacks.fire(this,this.subject))},_getLastMessage:function(){return this.messages.filter(function(a){return a.getType()===c.Services.Messaging.MessageType.MESSAGE})[0]},createMessage:function(){return this._conversationService.createMessage(this)},createEscalation:function(){var a=this._conversationService.createEscalation(this);return this._draftEscalations.push(a),a},removeEscalation:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Escalation}]}),this._conversationService.removeEscalation(a,this._draftEscalations)},getMessages:function(){return this.messages},retrieveMessagesAfter:function(a,b){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Message}]}),c.Base.Utils.validate(b,{optional:!0,validators:[{type:"type",expected:"number"}]}),this._conversationService.getOtherMessages(null,a,b,this)},retrieveMessagesBefore:function(a,b){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Message}]}),c.Base.Utils.validate(b,{optional:!0,validators:[{type:"type",expected:"number"}]}),this._conversationService.getOtherMessages(a,null,b,this)},markAllContentAsRead:function(){return this._conversationService.markAllAsRead(this)},subscribeForTypingEvents:function(a){return this._conversationService.subscribeForTypingEvents(this,a)},unsubscribeForTypingEvents:function(){return this._conversationService.unsubscribeForTypingEvents(this)},addParticipantAddresses:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._conversationService.addParticipantAddresses(this,a)},removeParticipantAddresses:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._conversationService.removeParticipantAddresses(this,a)},removeMessage:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Message}]}),this._conversationService.removeMessage(this.messages,this._draftMessages,a)},start:function(){var a=b.Deferred();return setTimeout(function(){a.resolve()}),a.promise()},leave:function(){return this._conversationService.leave(this)},_updateParticipantsList:function(a){this._conversationService._updateParticipantsList(this,a)},getId:function(){return this.id}},c.Base.AOPTools.addAdvices(d,"Conversation",["setSubject","createMessage","createEscalation","retrieveMessagesAfter","retrieveMessagesBefore"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Conversation",["markAllContentAsRead","removeEscalation","subscribeForTypingEvents","unsubscribeForTypingEvents","addParticipantAddresses","removeParticipantAddresses","removeMessage","start","leave"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),c.Services.Messaging.Conversation=d}(AvayaClientServices),function(a){"use strict";function b(a){this._messageBuilder=a}b.prototype={build:function(b,c){var d=new a.Services.Messaging.Conversation(c);return d.attachmentCount=b.attachmentCount||0,b.counts&&(d.totalMessageCount=b.counts.messageCount||0),b.flags&&(d.active=b.flags.active,d.closed=b.flags.closed,d.sensitivity=b.flags.sensitivity),d.href=b.href,d.id=b.id,d.lastAccessTime=new Date(b.lastAccessedTime),d.participants=new a.Base.DataSet,d.lastUpdated=new Date(b.lastUpdated),d.latestEntryTimestamp=new Date(b.latestEntryTimestamp),d.subject=b.subject,d.totalCount=b.totalCount||0,d.type=b.type||a.Services.Messaging.ConversationType.THREAD,d.unreadAttachmentCount=b.unreadAttachmentCount||0,d.unreadCount=b.unreadCount||0,d.resourceStatus=b.resourceStatus||a.Services.Messaging.ResourceStatus.PUBLISHED,b.counts&&(d._counts.eventCount=b.counts.eventCount||0,d._counts.eventUnreadMessage=b.counts.eventUnreadMessage||0,d._counts.messageAttachment=b.counts.messageAttachment||0,d._counts.messageCount=b.counts.messageCount||0,d._counts.messageUnreadAttachment=b.counts.messageUnreadAttachment||0,d._counts.messageUnreadMessage=b.counts.messageUnreadMessage||0),b=d._getLastMessage(),d.previewText=b?b.from.givenName+": "+b.body:"",c._recalculateAllConversationCapabilities(d),d},update:function(a,b,c){a.attachmentCount!==b.attachmentCount&&(a.attachmentCount=b.attachmentCount,a._onTotalAttachmentCountChangedCallbacks.fire(a,a.attachmentCount)),b.counts&&a.totalMessageCount!==b.counts.messageCount&&(a.totalMessageCount=b.counts.messageCount,a._onTotalMessagesCountChangedCallbacks.fire(a,a.totalMessageCount)),b.flags&&(a.active!==b.flags.active&&(a.active=b.flags.active,a._onActiveStatusChangedCallbacks.fire(a,a.active)),a.closed!==b.flags.closed&&(a.closed=b.flags.closed,a._onClosedStatusChangedCallbacks.fire(a,a.closed)),a.sensitivity!==b.flags.sensitivity&&(a.sensitivity=b.flags.sensitivity,a._onSensitivityChangedCallbacks.fire(a,a.sensitivity))),a.multiparty!==b.isMultiparty&&(a.multiparty=b.isMultiparty,a._onMultiPartyStatusChangedCallbacks.fire(a,a.multiparty));var d=new Date(b.lastUpdated);return a.lastUpdated&&a.lastUpdated.getTime()===d.getTime()||(a.lastUpdated=d,a._onLastUpdatedTimeChangedCallbacks.fire(a,a.lastUpdated)),d=new Date(b.lastAccessedTime),a.lastAccessTime&&a.lastAccessTime.getTime()===d.getTime()||(a.lastAccessTime=d,a._onLastAccessTimeChangedCallbacks.fire(a,a.lastAccessTime)),d=new Date(b.latestEntryTimestamp),a.latestEntryTimestamp&&a.latestEntryTimestamp.getTime()===d.getTime()||(a.latestEntryTimestamp=d,a._onLatestEntryTimeChangedCallbacks.fire(a,a.latestEntryTimestamp)),a.subject!==b.subject&&(a.subject=b.subject,a._onSubjectChangedCallbacks.fire(a,a.subject)),a.type!==b.type&&(a.type=b.type,a._onTypeChangedCallbacks.fire(a,a.type)),a.unreadAttachmentCount!==b.unreadAttachmentCount&&(a.unreadAttachmentCount=b.unreadAttachmentCount,a._onTotalUnreadAttachmentCountChangedCallbacks.fire(a,a.unreadAttachmentCount)),a.unreadCount!==b.unreadCount&&(a.unreadCount=b.unreadCount,a._onTotalUnreadMessageCountChangedCallbacks.fire(a,a.unreadCount)),b.counts&&(a._counts.eventCount!==b.counts.eventCount&&(a._counts.eventCount=b.counts.eventCount,a._onTotalEventCountChangedCallbacks.fire(a,a._counts.eventCount)),a._counts.eventUnreadMessage!==b.counts.eventUnreadMessage&&(a._counts.eventUnreadMessage=b.counts.eventUnreadMessage,a._onTotalUnreadEventCountChangedCallbacks.fire(a,a._counts.eventUnreadMessage)),a._counts.messageAttachment!==b.counts.messageAttachment&&(a._counts.messageAttachment=b.counts.messageAttachment,a._onTotalAttachmentCountChangedCallbacks.fire(a,a._counts.messageAttachment)),a._counts.messageCount!==b.counts.messageCount&&(a._counts.messageCount=b.counts.messageCount,a._onTotalMessagesCountChangedCallbacks.fire(a,a._counts.messageCount)),a._counts.messageUnreadAttachment!==b.counts.messageUnreadAttachment&&(a._counts.messageUnreadAttachment=b.counts.messageUnreadAttachment,a._onTotalUnreadAttachmentCountChangedCallbacks.fire(a,a._counts.messageUnreadAttachment)),a._counts.messageUnreadMessage!==b.counts.messageUnreadMessage&&(a._counts.messageUnreadMessage=b.counts.messageUnreadMessage,a._onTotalUnreadMessageCountChangedCallbacks.fire(a,a._counts.messageUnreadMessage))),c._recalculateAllConversationCapabilities(a),this.updateMessages(a,b,c)},updateMessages:function(b,c,d){for(var e,f=[],g=[],h=c.messages.length-1;0<=h;h--){var i=c.messages[h],j=this._getMessageById(b.messages,i.id);void 0!==j?j.getLastModifiedDate().toISOString()!==new Date(i.lastModifiedDate).toISOString()&&(c.messages[h+1]&&(e=this._getMessageById(b.messages,c.messages[h+1].id)),this._updateExistingMessage(j,i,e),f.push(j)):(c.messages[h+1]&&(e=this._getMessageById(b.messages,c.messages[h+1].id)),e=this._addNewMessage(b,i,e,d),b._onMessagesAddedCallbacks.fire(b,[e]),g.push(e))}return 0<f.length&&b.messages.onDataSetChanged(f,a.Base.DataSetChangeTypes.UPDATED),0<g.length&&b.messages.onDataSetChanged(g,a.Base.DataSetChangeTypes.ADDED),(0<f.length||0<g.length)&&this._updatePreviewText(b),g},_getMessageById:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c]},_updatePreviewText:function(a){var b=a._getLastMessage(),b=b&&b.from?b.from.givenName+": "+b.getBody():"";b!==a.previewText&&(a.previewText=b,a._onPreviewTextChangedCallbacks.fire(a,b))},_removeParticipant:function(a,b){var c,d=a.participants.filter(function(a){return a.getAddress()===b.eventRelatedParticipants[0].address});0<d.length&&(c=a.participants.indexOf(d[0]),a.participants.splice(c,1),a._onParticipantsRemovedCallbacks.fire(a,d[0]))},_updateExistingMessage:function(a,b,c){return this._messageBuilder.update(a,b),c&&a._setIsCoalesced(this._messageBuilder.isMessageCoalesced(a,c)),a},_addNewMessage:function(b,c,d,e){return c=e.createNewClientMessage(c,b),d&&c._setIsCoalesced(this._messageBuilder.isMessageCoalesced(c,d)),b.messages.push(c),c.getType()===a.Services.Messaging.MessageType.LEFT&&this._removeParticipant(b,c),b.messages.sort(function(a,b){return a.lastModifiedDate.getTime()-b.lastModifiedDate.getTime()}),c}},a.Services.Messaging.ConversationBuilder=b}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Messaging.Conversation.prototype,{addOnTotalMessageCountChangedCallback:function(a){this._onTotalMessagesCountChangedCallbacks.add(a)},removeOnTotalMessageCountChangedCallback:function(a){this._onTotalMessagesCountChangedCallbacks.remove(a)},addOnSubjectChangedCallback:function(a){this._onSubjectChangedCallbacks.add(a)},removeOnSubjectChangedCallback:function(a){this._onSubjectChangedCallbacks.remove(a)},addOnActiveStatusChangedCallback:function(a){this._onActiveStatusChangedCallbacks.add(a)},removeOnActiveStatusChangedCallback:function(a){this._onActiveStatusChangedCallbacks.remove(a)},addOnClosedStatusChangedCallback:function(a){this._onClosedStatusChangedCallbacks.add(a)},removeOnClosedStatusChangedCallback:function(a){this._onClosedStatusChangedCallbacks.remove(a)},addOnMultiPartyStatusChangedCallback:function(a){this._onMultiPartyStatusChangedCallbacks.add(a)},removeOnMultiPartyStatusChangedCallback:function(a){this._onMultiPartyStatusChangedCallbacks.remove(a)},addOnLastAccessTimeChangedCallback:function(a){this._onLastAccessTimeChangedCallbacks.add(a)},removeOnLastAccessTimeChangedCallback:function(a){this._onLastAccessTimeChangedCallbacks.remove(a)},addOnLastUpdatedTimeChangedCallback:function(a){this._onLastUpdatedTimeChangedCallbacks.add(a)},removeOnLastUpdatedTimeChangedCallback:function(a){this._onLastUpdatedTimeChangedCallbacks.remove(a)},addOnLatestEntryTimeChangedCallback:function(a){this._onLatestEntryTimeChangedCallbacks.add(a)},removeOnLatestEntryTimeChangedCallback:function(a){this._onLatestEntryTimeChangedCallbacks.remove(a)},addOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.add(a)},removeOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.remove(a)},addOnPreviewTextChangedCallback:function(a){this._onPreviewTextChangedCallbacks.add(a)},removeOnPreviewTextChangedCallback:function(a){this._onPreviewTextChangedCallbacks.remove(a)},addOnTotalAttachmentCountChangedCallback:function(a){this._onTotalAttachmentCountChangedCallbacks.add(a)},removeOnTotalAttachmentCountChangedCallback:function(a){this._onTotalAttachmentCountChangedCallbacks.remove(a)},addOnTotalUnreadMessageCountChangedCallback:function(a){this._onTotalUnreadMessageCountChangedCallbacks.add(a)},removeOnTotalUnreadMessageCountChangedCallback:function(a){this._onTotalUnreadMessageCountChangedCallbacks.remove(a)},addOnTotalUnreadAttachmentCountChangedCallback:function(a){this._onTotalUnreadAttachmentCountChangedCallbacks.add(a);
},removeOnTotalUnreadAttachmentCountChangedCallback:function(a){this._onTotalUnreadAttachmentCountChangedCallbacks.remove(a)},addOnSensitivityChangedCallback:function(a){this._onSensitivityChangedCallbacks.add(a)},removeOnSensitivityChangedCallback:function(a){this._onSensitivityChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getUpdateSubjectCapability:function(){return this._updateSubjectCapability},_recalculateUpdateSubjectCapability:function(){var b,c;!this._conversationService.isServiceAvailable()||this.closed?(b=!1,c=a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):this.resourceStatus===a.Services.Messaging.ResourceStatus.PUBLISHED?c=this._conversationService.isUpdateSubjectSupported()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(b=!0,c=a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateSubjectCapability._updateIfChanged(b,c)},getUpdateLastAccessTimeCapability:function(){return this._updateLastAccessTimeCapability},_recalculateUpdateLastAccessTimeCapability:function(){var b,c=!this._conversationService.isServiceAvailable()||this.closed||this.resourceStatus!==a.Services.Messaging.ResourceStatus.PUBLISHED?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateLastAccessTimeCapability._updateIfChanged(b,c)},getUpdateSensitivityCapability:function(){return this._updateSensitivityCapability},_recalculateUpdateSensitivityCapability:function(){var b,c=!this._conversationService.isServiceAvailable()||this.closed||this.resourceStatus!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._updateSensitivityCapability._updateIfChanged(b,c)},getRetrieveMessagesCapability:function(){return this._retrieveMessagesCapability},_recalculateOlderContentCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.PUBLISHED&&this.totalCount!==this.messages.length?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._retrieveMessagesCapability._updateIfChanged(b,c)},getAddParticipantsCapability:function(){return this._addParticipantsCapability},_recalculateAddParticipantsCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&(this.isActive()||this.getStatus()===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT)?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addParticipantsCapability._updateIfChanged(b,c)},getRemoveParticipantsCapability:function(){return this._removeParticipantsCapability},_recalculateRemoveParticipantsCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&this.getStatus()===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeParticipantsCapability._updateIfChanged(b,c)},getCreateMessageCapability:function(){return this._createMessageCapability},_recalculateCreateMessageCapability:function(){var b,c=!this._conversationService.isServiceAvailable()||this.closed?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._createMessageCapability._updateIfChanged(b,c)},getCreateEscalationCapability:function(){return this._createEscalationCapability},_recalculateCreateEscalationCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&this.getStatus()!==a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createEscalationCapability._updateIfChanged(b,c)},getMarkAllContentAsReadCapability:function(){return this._markAllContentAsReadCapability},_recalculateMarkAllContentAsReadCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&0!==this._counts.messageUnreadMessage?this._conversationService.isMarkAllContentAsReadSupported()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._markAllContentAsReadCapability._updateIfChanged(b,c)},getLeaveCapability:function(){return this._leaveCapability},_recalculateLeaveCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&this.active&&!this.closed?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._leaveCapability._updateIfChanged(b,c)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&this.getStatus()===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(b,c)},getSendCapability:function(){return this._startCapability},_recalculateStartCapability:function(){var b,c=this._conversationService.isServiceAvailable()&&!this.closed&&this.active&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&0!==this.participants.filter(function(a){return!a.isLocalUser()}).length?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._startCapability._updateIfChanged(b,c)},getIsTypingCapability:function(){return this._isTypingCapability},_recalculateIsTypingCapability:function(){var b,c=this._conversationService.isOpened(),c=this._conversationService.isServiceAvailable()&&c&&this._isSubscribed?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._isTypingCapability._updateIfChanged(b,c)}};b.extend(a.Services.Messaging.Conversation.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(d,e){this._messageService=d,this.conversation=e,this.resourceStatus=c.Services.Messaging.ResourceStatus.PUBLISHED,this.body="",this.htmlBody="",this.type=c.Services.Messaging.MessageType.MESSAGE,this.sensitivity=c.Services.Messaging.SensitivityLevel.NORMAL,this.importance=c.Services.Messaging.MessageImportance.NORMAL,this.read=!1,this.doNotForward=!1,this.from=a,this.href="",this.id="",this.lastModifiedDate=a,this.receivedDate=a,this.subject="",this.threadId="",this.to=a,this.parts=new c.Base.DataSet,this._attachments=[],this.coalesced=!1,this.inReplyTo=a,this._sessionType=a,this._onTypeChangedCallbacks=b.Callbacks(),this._onBodyChangedCallbacks=b.Callbacks(),this._onInReplyToChangedCallbacks=b.Callbacks(),this._onLastModifiedDateChangedCallbacks=b.Callbacks(),this._onIsCoalescedStatusChangedCallbacks=b.Callbacks(),this._onHasAttachmentStatusChangedCallbacks=b.Callbacks(),this._onHasUnreadAttachmentStatusChangedCallbacks=b.Callbacks(),this._onIsPrivateStatusChangedCallbacks=b.Callbacks(),this._onDoNotForwardStatusChangedCallbacks=b.Callbacks(),this._onIsReadStatusChangedCallbacks=b.Callbacks(),this._onStatusChangedCallbacks=b.Callbacks(),this._onImportanceChangedCallbacks=b.Callbacks(),this._onSensitivityChangedCallbacks=b.Callbacks(),this._updateBodyCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSensitivityCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateInReplyToCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateDoNotForwardCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateImportanceCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createAttachmentCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._sendCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markAsReadCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE)}d.prototype={getType:function(){return this.type},getBody:function(){return this.body},getHtmlBody:function(){return this.htmlBody},getConversationId:function(){return this.conversation.getId()},getId:function(){return this.id},getInReplyTo:function(){return this.inReplyTo},getSessionType:function(){return this._sessionType},getLastModifiedDate:function(){return this.lastModifiedDate},getReceivedDate:function(){return this.receivedDate},isCoalesced:function(){return this.coalesced},hasHtmlBody:function(){return 0<this.htmlBody.length},hasAttachment:function(){return 0<this.parts.length},hasUnreadAttachment:function(){return this.parts.reduce(function(a,b){return a||!b.isRead()},!1)},isPrivate:function(){return this.sensitivity===c.Services.Messaging.SensitivityLevel.PRIVATE},isDoNotForward:function(){return this.doNotForward},isRead:function(){return this.read},getFromParticipant:function(){return this.from},getAttachments:function(){return this.parts},getStatus:function(){return this.resourceStatus},getImportance:function(){return this.importance},getSensitivity:function(){return this.sensitivity},setBodyAndReportTyping:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this._messageService.setBodyAndReportTyping(this,this.conversation,a)},reportTyping:function(a){this.conversation.getStatus()===c.Services.Messaging.ResourceStatus.PUBLISHED&&this.conversation.getIsTypingCapability().isAllowed&&this.conversation._conversationService.reportTyping(this,a)},setSensitivity:function(a){for(var b in c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),c.Services.Messaging.SensitivityLevel)c.Services.Messaging.SensitivityLevel.hasOwnProperty(b)&&a===c.Services.Messaging.SensitivityLevel[b]&&(c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.sensitivity!==a&&(this.sensitivity=a,this._onSensitivityChangedCallbacks.fire(this,a)))},_setIsCoalesced:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"boolean"}]}),this.coalesced!==a&&(this.coalesced=a,this._onIsCoalescedStatusChangedCallbacks.fire(this,a))},isFromMe:function(){return!!this.from&&this.from.isSelf()},setInReplyTo:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Message}]}),a instanceof c.Services.Messaging.Message&&void 0!==a.getId()&&this.inReplyTo!==a&&(this.inReplyTo=a.getId(),this._onInReplyToChangedCallbacks.fire(this,this.inReplyTo))},setDoNotForward:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"boolean"}]}),this.doNotForward!==a&&(this.doNotForward=a,this._onDoNotForwardStatusChangedCallbacks.fire(this,a))},_setStatus:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.resourceStatus!==a&&(this.resourceStatus=a,this._onStatusChangedCallbacks.fire(this,a))},setImportance:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]});var b,d=!1;for(b in c.Services.Messaging.MessageImportance)if(c.Services.Messaging.MessageImportance.hasOwnProperty(b)&&a===c.Services.Messaging.MessageImportance[b]){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.importance!==a&&(this.importance=a,this._onImportanceChangedCallbacks.fire(this,a)),d=!0;break}return d},markAsRead:function(){return this._messageService.markAsRead(this)},send:function(){return this._messageService.send(this)},createAttachment:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:File}]}),this._messageService.createAttachment(this,a)},removeDraftAttachment:function(a){c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Attachment}]}),this._messageService.removeDraftAttachment(this,a)}},c.Base.AOPTools.addAdvices(d,"Message",["removeDraftAttachment","createAttachment","reportTyping"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Message",["send","markAsRead","setBodyAndReportTyping"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),c.Services.Messaging.Message=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Messaging.Message.prototype,{addOnBodyChangedCallback:function(a){this._onBodyChangedCallbacks.add(a)},removeOnBodyChangedCallback:function(a){this._onBodyChangedCallbacks.remove(a)},addOnInReplyToChangedCallback:function(a){this._onInReplyToChangedCallbacks.add(a)},removeOnInReplyToChangedCallback:function(a){this._onInReplyToChangedCallbacks.remove(a)},addOnLastModifiedDateChangedCallback:function(a){this._onLastModifiedDateChangedCallbacks.add(a)},removeOnLastModifiedDateChangedCallback:function(a){this._onLastModifiedDateChangedCallbacks.remove(a)},addOnIsCoalescedStatusChangedCallback:function(a){this._onIsCoalescedStatusChangedCallbacks.add(a)},removeOnIsCoalescedStatusChangedCallback:function(a){this._onIsCoalescedStatusChangedCallbacks.remove(a)},addOnHasAttachmentStatusChangedCallback:function(a){this._onHasAttachmentStatusChangedCallbacks.add(a)},removeOnHasAttachmentStatusChangedCallback:function(a){this._onHasAttachmentStatusChangedCallbacks.remove(a)},addOnHasUnreadAttachmentStatusChangedCallback:function(a){this._onHasUnreadAttachmentStatusChangedCallbacks.add(a)},removeOnHasUnreadAttachmentStatusChangedCallback:function(a){this._onHasUnreadAttachmentStatusChangedCallbacks.remove(a)},addOnIsPrivateStatusChangedCallback:function(a){this._onIsPrivateStatusChangedCallbacks.add(a)},removeOnIsPrivateStatusChangedCallback:function(a){this._onIsPrivateStatusChangedCallbacks.remove(a)},addOnDoNotForwardStatusChangedCallback:function(a){this._onDoNotForwardStatusChangedCallbacks.add(a)},removeOnDoNotForwardStatusChangedCallback:function(a){this._onDoNotForwardStatusChangedCallbacks.remove(a)},addOnIsReadStatusChangedCallback:function(a){this._onIsReadStatusChangedCallbacks.add(a)},removeOnIsReadStatusChangedCallback:function(a){this._onIsReadStatusChangedCallbacks.remove(a)},addOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.add(a)},removeOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.remove(a)},addOnImportanceChangedCallback:function(a){this._onImportanceChangedCallbacks.add(a)},removeOnImportanceChangedCallback:function(a){this._onImportanceChangedCallbacks.remove(a)},addOnSensitivityChangedCallback:function(a){this._onSensitivityChangedCallbacks.add(a)},removeOnSensitivityChangedCallback:function(a){this._onSensitivityChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getUpdateBodyCapability:function(){return this._updateBodyCapability},_recalculateUpdateBodyCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateBodyCapability._updateIfChanged(b,c)},getUpdateSensitivityCapability:function(){return this._updateSensitivityCapability},_recalculateUpdateSensitivityCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.conversation.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateSensitivityCapability._updateIfChanged(b,c)},getUpdateInReplyToCapability:function(){return this._updateInReplyToCapability},_recalculateUpdateInReplyToCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateInReplyToCapability._updateIfChanged(b,c)},getUpdateDoNotForwardCapability:function(){return this._updateDoNotForwardCapability},_recalculateUpdateDoNotForwardCapability:function(){var b,c=this._messageService.isServiceAvailable()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateDoNotForwardCapability._updateIfChanged(b,c)},getUpdateImportanceCapability:function(){return this._updateImportanceCapability},_recalculateUpdateImportanceCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateImportanceCapability._updateIfChanged(b,c)},getCreateAttachmentCapability:function(a){return this._createAttachmentCapability},_recalculateCreateAttachmentCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createAttachmentCapability._updateIfChanged(b,c)},getSendCapability:function(){return this._sendCapability},_recalculateSendCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&this.conversation.active&&!this.conversation.closed?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._sendCapability._updateIfChanged(b,c)},getMarkAsReadCapability:function(){return this._markAsReadCapability},_recalculateMarkAsReadCapability:function(){var b,c=!this._messageService.isServiceAvailable()||this.read?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._markAsReadCapability._updateIfChanged(b,c)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var b,c=this._messageService.isServiceAvailable()&&this.resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(b,c)}};b.extend(a.Services.Messaging.Message.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(d){this._messagingService=d,this._isAvailable=a,this._onMessagingLimitsChangedCallbacks=b.Callbacks(),this._onRoutableDomainsChangedCallbacks=b.Callbacks(),this._onNumberOfConversationsWithUnreadContentChangedCallbacks=b.Callbacks(),this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks=b.Callbacks(),this._onMessagingServiceUnavailableCallbacks=b.Callbacks(),this._onMessagingServiceAvailableCallbacks=b.Callbacks(),this._retrieveConversationsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._startServiceCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._createConversationCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._searchConversationsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateRefreshIntervalCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._validateParticipantAddressesCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._markContentAsReadCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._clearLocalDataCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._messagingUnavailableReason=a}d.prototype={getRoutableDomains:function(){return this._messagingService.getRoutableDomains()},getSelfAddress:function(){return this._messagingService.getSelfAddress()},getNumberOfConversationsWithUnreadContentSinceLastAccess:function(){return this._messagingService.getNumberOfConversationsWithUnreadContentSinceLastAccess()},getNumberOfConversationsWithUnreadContent:function(){return this._messagingService.getNumberOfConversationsWithUnreadContent()},createConversation:function(){return this._messagingService.createConversation(this)},getActiveConversations:function(){return this._messagingService.getActiveConversations(this)},getDraftConversations:function(){return this._messagingService.getDraftConversations()},getConversationIds:function(){return this._messagingService.getConversationIds()},searchConversations:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.MessagingQuery}]}),this._messagingService.searchConversations(a,this)},getAllActiveConversationsForContact:function(a){},validateAddresses:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:"string"}]}),this._messagingService.validateUsers(a)},leaveConversations:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:Array},{type:"arrayElementType",expected:c.Services.Messaging.Conversation}]}),this._messagingService.leaveConversations(a)},leaveAllConversations:function(){return this._messagingService.leaveAllConversations()},start:function(a){return this._startDfd=b.Deferred(),this._messagingService.start(this,a),this._startDfd.promise()},stop:function(){return this._messagingService.stop(this)},_stopImmediately:function(){return this._messagingService._stopImmediately(this)},removeConversation:function(a){return c.Base.Utils.validate(a,{validators:[{type:"defined"},{type:"type",expected:c.Services.Messaging.Conversation}]}),this._messagingService.removeConversation(a)},_fireMessagingAvailableCallback:function(){!c.Base.Utils.isUndefined(this._isAvailable)&&this._isAvailable||(this._isAvailable=!0,this._messagingUnavailableReason=a,this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onMessagingServiceAvailableCallbacks.fire(this))},_fireMessagingUnavailableCallback:function(a){(c.Base.Utils.isUndefined(this._isAvailable)||this._isAvailable)&&(this._isAvailable=!1,this._messagingUnavailableReason=a,this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onMessagingServiceUnavailableCallbacks.fire(this))}},c.Base.AOPTools.addAdvices(d,"Messaging",["createConversation","getActiveConversations","searchConversations"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Messaging",["validateAddresses","leaveConversations","leaveAllConversations","removeConversation"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),c.Services.Messaging.Messaging=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Messaging.Messaging.prototype,{addOnMessagingLimitsChangedCallback:function(a){this._onMessagingLimitsChangedCallbacks.add(a)},removeOnMessagingLimitsChangedCallback:function(a){this._onMessagingLimitsChangedCallbacks.remove(a)},addOnRoutableDomainsChangedCallback:function(a){this._onRoutableDomainsChangedCallbacks.add(a)},removeOnRoutableDomainsChangedCallback:function(a){this._onRoutableDomainsChangedCallbacks.remove(a)},addOnNumberOfConversationsWithUnreadContentChangedCallback:function(a){this._onNumberOfConversationsWithUnreadContentChangedCallbacks.add(a)},removeOnNumberOfConversationsWithUnreadContentChangedCallback:function(a){this._onNumberOfConversationsWithUnreadContentChangedCallbacks.remove(a)},addOnNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallback:function(a){this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.add(a)},removeOnNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallback:function(a){this._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.remove(a)},addOnMessagingServiceUnavailableCallback:function(a){this._onMessagingServiceUnavailableCallbacks.add(a)},removeOnMessagingServiceUnavailableCallback:function(a){this._onMessagingServiceUnavailableCallbacks.remove(a)},addOnMessagingServiceAvailableCallback:function(a){this._onMessagingServiceAvailableCallbacks.add(a)},removeOnMessagingServiceAvailableCallback:function(a){this._onMessagingServiceAvailableCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getStartServiceCapability:function(){return this._startServiceCapability},_recalculateStartServiceCapability:function(){var b,c=this._isAvailable?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);this._startServiceCapability._updateIfChanged(b,c)},getCreateConversationCapability:function(){return this._createConversationCapability},_recalculateCreateConversationCapability:function(){var b,c=this._isAvailable?this._messagingService.getConversationResource()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._createConversationCapability._updateIfChanged(b,c)},getRetrieveConversationsCapability:function(){return this._retrieveConversationsCapability},_recalculateRetrieveConversationsCapability:function(){var b,c=this._isAvailable&&this._messagingService.getConversationResource()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._retrieveConversationsCapability._updateIfChanged(b,c)},getSearchConversationsCapability:function(){return this._searchConversationsCapability},_recalculateSearchConversationsCapability:function(){var b,c=this._isAvailable?this._messagingService.getConversationResource()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._searchConversationsCapability._updateIfChanged(b,c)},getValidateParticipantAddressesCapability:function(){return this._validateParticipantAddressesCapability},_recalculateValidateParticipantAddressCapability:function(){var b,c=this._isAvailable,c=c&&this._messagingService.getValidateAddressResource()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):c&&!this._messagingService.getValidateAddressResource()?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._validateParticipantAddressesCapability._updateIfChanged(b,c)},getMarkContentAsReadCapability:function(){return this._markContentAsReadCapability},_recalculateMarkContentAsReadCapability:function(){var b,c=this._isAvailable,c=c&&this._messagingService.getMarkAsReadResource()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):c&&!this._messagingService.getMarkAsReadResource()?(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._markContentAsReadCapability._updateIfChanged(b,c)}};b.extend(a.Services.Messaging.Messaging.prototype,c)}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Participant.call(this),this._address=b._address,this._localUser=c,this.type=b.type,this.givenName=b.givenName,this.language=b.language,this.modalities=b.modalities,this.nativeGivenName=b.nativeGivenName,this.nativeSurname=b.nativeSurname,this.surname=b.surname}(b.prototype=Object.create(a.Services.Participant.prototype)).getType=function(){return this.type},b.prototype.getAddress=function(){return this._address},b.prototype.getGivenName=function(){return this.givenName},b.prototype.getSurname=function(){return this.nativeSurname},b.prototype.getDisplayName=function(){var a=this._displayName&&""!==this._displayName?this._displayName:this.givenName||this.surname?this.surname?this.givenName?this.givenName+" "+this.surname:this.surname:this.givenName:this._address;return a},b.prototype.getSupportedModalities=function(){return this.modalities},b.prototype.isSelf=function(){return this.self},a.Services.Messaging.Participant=b}(AvayaClientServices),function(c){"use strict";function d(c){this._presenceProvider=c,this._userAddresses=[],this._internalAddresses=[],this._selfAddress=a,this._onPresenceNotification=a,this._onStartedCallbacks=b.Callbacks(),this._onStoppedCallbacks=b.Callbacks(),this._onPresenceReceivedCallbacks=b.Callbacks(),this._onInternalPresenceReceivedCallbacks=b.Callbacks(),this._onSelfPresenceReceivedCallbacks=b.Callbacks()}d.prototype={addAddress:function(a){return this._subscribe(a).then(function(){this._userAddresses.push(a)}.bind(this))},_addInternalAddress:function(a){return this._subscribe(a).then(function(){this._internalAddresses.push(a)}.bind(this))},_subscribe:function(a){return a&&""!==a.trim()?(c.Base.Logger.debug(c.Base.LoggerTags.PRESENCE_SERVICE,"Subscribing for presence",a),this._presenceProvider.subscribeForSingleAddressPresence(a)):(c.Base.Logger.error(c.Base.LoggerTags.PRESENCE_SERVICE,"Subscription was requested for empty/undefined address",a),b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.INVALID_REQUEST)).promise())},_setSelfAddress:function(a){this._selfAddress=a},removeAddress:function(a){return this._userAddresses=this._userAddresses.filter(function(b){return a!==b},this),this._presenceProvider.unsubscribeFromSingleAddressPresence(a)},_removeInternalAddress:function(a){return this._internalAddresses=this._internalAddresses.filter(function(b){return a!==b},this),this._presenceProvider.unsubscribeFromSingleAddressPresence(a)},_start:function(){return this._onPresenceNotification=function(a){var d=a.getPresentity();c.Base.Logger.debug(c.Base.LoggerTags.PRESENCE_SERVICE,"Received presence information",d),this._selfAddress===d&&(a=b.extend(new c.Services.Presence.SelfPresence,a),this._onSelfPresenceReceivedCallbacks.fire(a)),-1!==this._userAddresses.indexOf(d)&&this._onPresenceReceivedCallbacks.fire(this,a),-1!==this._internalAddresses.indexOf(d)&&this._onInternalPresenceReceivedCallbacks.fire(a)}.bind(this),this._presenceProvider.on(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_NOTIFICATION,this._onPresenceNotification),this._presenceProvider.subscribeForPresence([this._selfAddress]).then(function(){this._onStartedCallbacks.fire()}.bind(this))},_stop:function(){return this._presenceProvider.unsubscribeFromAllAddressesPresence().always(function(){this._onStoppedCallbacks.fire(),this._onStartedCallbacks.empty(),this._onStoppedCallbacks.empty(),this._onPresenceReceivedCallbacks.empty(),this._onInternalPresenceReceivedCallbacks.empty(),this._onSelfPresenceReceivedCallbacks.empty()}.bind(this))}},c.Base.AOPTools.addAdvices(d,"PresenceListSubscription",["addAddress","removeAddress"],[c.Base.AOPCommonAdvices.LOG_PRESENCE_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_PRESENCE_ERROR]),c.Services.Presence.PresenceListSubscription=d}(AvayaClientServices),
function(a){"use strict";b.extend(a.Services.Presence.PresenceListSubscription.prototype,{addOnStartedCallback:function(a){this._onStartedCallbacks.add(a)},removeOnStartedCallback:function(a){this._onStartedCallbacks.remove(a)},addOnStoppedCallback:function(a){this._onStoppedCallbacks.add(a)},removeOnStoppedCallback:function(a){this._onStoppedCallbacks.remove(a)},addOnPresenceReceivedCallback:function(a){this._onPresenceReceivedCallbacks.add(a)},removeOnPresenceReceivedCallback:function(a){this._onPresenceReceivedCallbacks.remove(a)},_addOnInternalPresenceReceivedCallback:function(a){this._onInternalPresenceReceivedCallbacks.add(a)},_removeOnInternalPresenceReceivedCallback:function(a){this._onInternalPresenceReceivedCallbacks.remove(a)},_addOnSelfPresenceReceivedCallback:function(a){this._onSelfPresenceReceivedCallbacks.add(a)},_removeOnSelfPresenceReceivedCallback:function(a){this._onSelfPresenceReceivedCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";function d(d){this._presenceProvider=d,this._selfPresenceManagedExternally=!1,this._selfPresence=a,this._selfAddress=a,this._phoneAndVideoChannelAddress=a,this._presenceSubscriptions=new c.Services.Presence.PresenceListSubscription(this._presenceProvider),this._onSelfPresenceNotification=a,this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._available=a,this._starting=!1,this._started=!1,this._userConfiguration=a,this._onSelfPresenceReceivedCallbacks=b.Callbacks(),this._onPresenceServiceAvailableCallbacks=b.Callbacks(),this._onPresenceServiceUnavailableCallbacks=b.Callbacks()}d.prototype={publishAutomaticPresence:function(){return this._selfPresence?(this._selfPresence._setPhoneContact(this._phoneAndVideoChannelAddress),this._selfPresence._setVideoContact(this._phoneAndVideoChannelAddress),this._selfPresence._setEnterpriseIMContact(this._selfAddress),this._selfPresence._manualState!==c.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNKNOWN&&this._selfPresence._manualState!==c.Services.Presence.ManualPresenceState.PRESENCE_STATE_UNSPECIFIED&&c.Base.Logger.warn(c.Base.LoggerTags.PRESENCE_SERVICE,"Presence manual state set, automatic presence state will not take effect"),this._presenceProvider.publishAutomaticPresence(this._selfPresence)):b.Deferred().reject(new c.Services.Presence.PresenceError(c.Services.Presence.PresenceErrorReason.INVALID_STATE))},publishManualState:function(a){return this._presenceProvider.publishManualState(a)},publishLocationMode:function(a){return this._presenceProvider.publishLocationMode(a)},publishNote:function(a){return this._presenceProvider.publishNote(a)},getPresenceListSubscription:function(){return this._presenceSubscriptions},getSelfPresence:function(){return this._selfPresence},start:function(a){return this._startDfd=b.Deferred(),c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Starting the service"),this.userConfiguration=a,this._onSelfPresenceNotification=function(a){this._selfPresenceManagedExternally||(this._selfPresence=a,this._onSelfPresenceReceivedCallbacks.fire(this,a))}.bind(this),this._subscribeForProvidersNotifications(),this._starting=!0,this._presenceProvider.start(a).then(function(){return this._startPresenceSubscriptions()}.bind(this)).then(function(){this._onServiceAvailable(),c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Service started successfully")}.bind(this),function(a){this._starting=!1,c.Base.Logger.error(c.Base.LoggerTags.PRESENCE_SERVICE,"Failed to start service",a)}.bind(this)),this._startDfd.promise()},stop:function(){c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Stopping the service"),this._unsubscribeFromProvidersNotifications(),this._onServiceUnavailable();var a=b.Deferred();return this._presenceSubscriptions._stop().always(function(){this._presenceProvider.stop().then(function(){c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Service stopped successfully"),a.resolve()},function(b){c.Base.Logger.error(c.Base.LoggerTags.PRESENCE_SERVICE,"Failed to stop service",b),a.reject(b)}).always(function(){this._onSelfPresenceReceivedCallbacks.empty(),this._onPresenceServiceAvailableCallbacks.empty(),this._onPresenceServiceUnavailableCallbacks.empty(),this._presenceSubscriptions._removeOnSelfPresenceReceivedCallback(this._onSelfPresenceNotification),this._started=!1}.bind(this))}.bind(this)),a.promise()},_stopImmediately:function(){return c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Stopping the service"),this._started=!1,this._onServiceUnavailable(),c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Service stopped successfully"),b.Deferred().resolve().promise()},_setSelfPresence:function(a,b,c){this._selfPresenceManagedExternally=!0,this._selfPresence=a,this._selfAddress=b,this._phoneAndVideoChannelAddress=c},_onServiceAvailable:function(){var a;this._available||(a=function(){this._starting=!1,this._started=!0,this._available=!0,c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Service is available"),this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.resolve(),this._onPresenceServiceAvailableCallbacks.fire(this)}.bind(this),this._starting?a():this._startPresenceSubscriptions().then(function(){a()}.bind(this)))},_onServiceUnavailable:function(){(this._available||this._starting)&&(this._available=!1,c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Service is unavailable"),this._starting&&(this._starting=!1),this._startDfd.state()===c.Base.DeferredStates.PENDING&&this._startDfd.reject(),this._onPresenceServiceUnavailableCallbacks.fire(this))},_setPhoneVideoAdress:function(a){this._phoneAndVideoChannelAddress=a},_startPresenceSubscriptions:function(){return this._selfPresenceManagedExternally||(this._phoneAndVideoChannelAddress||(this._phoneAndVideoChannelAddress=this.userConfiguration.sgConfiguration.credentialProvider.username),this._selfAddress=this._phoneAndVideoChannelAddress),this._presenceSubscriptions._addOnSelfPresenceReceivedCallback(this._onSelfPresenceNotification),this._presenceSubscriptions._setSelfAddress(this._selfAddress),this._presenceSubscriptions._start().then(function(){c.Base.Logger.info(c.Base.LoggerTags.PRESENCE_SERVICE,"Presence subscriptions started successfully")}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.PRESENCE_SERVICE,"Failed to start presence subscriptions",a)}.bind(this))},_subscribeForProvidersNotifications:function(){this._started||this._starting||(this._onNetworkAvailable=this._onServiceAvailable.bind(this),this._onNetworkUnavailable=this._onServiceUnavailable.bind(this),this._onPresenceHandleReceived=this._setPhoneVideoAdress.bind(this),this._presenceProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._presenceProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._presenceProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._presenceProvider.on(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._presenceProvider.on(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,this._onPresenceHandleReceived))},_unsubscribeFromProvidersNotifications:function(){this._started&&(this._presenceProvider.off(c.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._presenceProvider.off(c.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._presenceProvider.off(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._presenceProvider.off(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._presenceProvider.on(c.Providers.Interfaces.PresenceProviderCallbackIds.PRESENCE_HANDLE_RECEIVED,this._onPresenceHandleReceived),this._onNetworkAvailable=a,this._onNetworkUnavailable=a,this._onPresenceHandleReceived=a)}},c.Base.AOPTools.addAdvices(d,"PresenceService",["publishAutomaticPresence","publishManualState","publishLocationMode","publishNote"],[c.Base.AOPCommonAdvices.LOG_PRESENCE_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_PRESENCE_ERROR]),c.Services.Presence.PresenceService=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Presence.PresenceService.prototype,{addOnSelfPresenceReceivedCallback:function(a){this._onSelfPresenceReceivedCallbacks.add(a)},removeOnSelfPresenceReceivedCallback:function(a){this._onSelfPresenceReceivedCallbacks.remove(a)},addOnPresenceServiceAvailableCallback:function(a){this._onPresenceServiceAvailableCallbacks.add(a)},removeOnPresenceServiceAvailableCallback:function(a){this._onPresenceServiceAvailableCallbacks.remove(a)},addOnPresenceServiceUnavailableCallback:function(a){this._onPresenceServiceUnavailableCallbacks.add(a)},removeOnPresenceServiceUnavailableCallback:function(a){this._onPresenceServiceUnavailableCallbacks.remove(a)}})}(AvayaClientServices),function(c){"use strict";function d(a){c.Base.WebSocketProvider.apply(this),this._parentLoggerTag=a,this._networkLogger=new c.Base.NetworkLogger(a),this._deferreds={},this._transactionIDLocation=""}(d.prototype=Object.create(c.Base.WebSocketProvider.prototype)).start=function(a,b,d,e,f){return d&&d.transactionIDLocation&&(this._transactionIDLocation=d.transactionIDLocation),c.Base.WebSocketProvider.prototype.start.call(this,a,b,d,e,f,this._handleOnMessage.bind(this))},d.prototype._handleOnMessage=function(b){var d,e,f,g=!0,h=!1;if(b.data instanceof ArrayBuffer==0)try{d=this.parseResponse(b.data),h=this.checkForPong(d),e=this.getTransactionIDFromResponse(d,this._transactionIDLocation),f=this._deferreds[e]}catch(d){"string"==typeof b.data&&c.Base.Logger.error(c.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,this._parentLoggerTag,d)}else h=this.checkForPong(b.data);e&&f&&(h||this._networkLogger.logRecvMessage(b.data,a),c.Base.Logger.debug(c.Base.LoggerTags.WEBSOCKET_NETWORK_PROVIDER,this._parentLoggerTag,"Resolving message "+d.name+" with transId "+e),delete this._deferreds[e],g=!1,f.resolve(d)),g&&this.onMessage(b)},d.prototype.parseMessage=function(a){return JSON.parse(a)},d.prototype.send=function(a,d,e){var f=b.Deferred(),g=this.getTransactionIDFromRequest(this.parseRequest(a),this._transactionIDLocation);return g&&(this._deferreds[g]=f),c.Base.WebSocketProvider.prototype.send.call(this,a,d,e).then(function(){g||f.resolve()},function(a){f.reject(a)}),f.promise()},d.prototype.close=function(){return this.cleanupTransactions("Request aborted due to close request"),c.Base.WebSocketProvider.prototype.close.call(this)},d.prototype.onClose=function(){return this.cleanupTransactions("Request failed due to network error"),c.Base.WebSocketProvider.prototype.onClose.call(this)},d.prototype.cleanupTransactions=function(a){for(var b in this._deferreds)this._deferreds.hasOwnProperty(b)&&(b=this._deferreds[b],c.Base.Utils.isDefined(b)&&(c.Base.Logger.debug("Rejecting transaction because: "+a),b.reject({message:a})));this._deferreds={}},d.prototype._getTransactionID=function(a,b){return c.Base.Utils.queryJSONObject(a,b)},d.prototype.getTransactionIDFromResponse=function(a,b){return this._getTransactionID(a,b)},d.prototype.getTransactionIDFromRequest=function(a,b){return this._getTransactionID(a,b)},d.prototype.parseRequest=function(a){return this.parseMessage(a)},d.prototype.parseResponse=function(a){return this.parseMessage(a)},d.prototype.registerBlackList=function(a){this._networkLogger.registerBlackList(a)},c.Base.TransactionalWebSocketProvider=d}(AvayaClientServices),function(c){"use strict";var d,e,f,g=[];g.type=new c.Base.Validators.TypeValidator,g.arrayElementType=new c.Base.Validators.ArrayElementTypeValidator,g.defined=new c.Base.Validators.DefinedValidator;var h=window.crypto||window.msCrypto;c.Base.Utils={isUndefined:function(a){return void 0===a},isDefined:function(a){return void 0!==a},isObject:function(a){return null!==a&&"object"==typeof a},validate:function(a,b,d){if(b.optional&&void 0===a)return!1;var e=!0;return b.validators.forEach(function(b){if(c.Base.Utils.isUndefined(g[b.type]))throw new Error("Validator of specified type does not exist.");e=e&&g[b.type].validate(a,b,d)}.bind(this)),e},makeId:function(a,b){a=a||10;for(var c=b||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d="",e=0;e<a;e++)d+=c.charAt(Math.floor(Math.random()*c.length));return d},clean:function(a,b){for(var c=0;c<a.length;c++)a[c]===b&&(a.splice(c,1),c--);return a},queryJSONObject:function(b,d){if(null==b)return a;var e=b,f=d.match(/(\w+)/g);if(!f)return a;for(var g=0;g<f.length;g++){var h=e[f[g]];if(!c.Base.Utils.isDefined(h)||null===h)return a;e=h}return e},getBrowserType:function(){return d!==a||(d=c.Base.BrowserType.UNKNOWN,window.chrome&&(-1<document.location.href.indexOf("chrome-extension")||-1===window.navigator.userAgent.indexOf("Edge"))||-1<window.navigator.userAgent.indexOf("Chrome")&&-1<window.navigator.userAgent.indexOf("Electron")||-1<window.navigator.userAgent.indexOf("HeadlessChrome")?d=c.Base.BrowserType.CHROME:window.chrome&&-1<document.location.href.indexOf("moz-extension")||"undefined"!=typeof InstallTrigger?d=c.Base.BrowserType.FIREFOX:-1!==window.navigator.userAgent.indexOf("Safari")&&-1===window.navigator.userAgent.indexOf("Chrome")&&-1===window.navigator.userAgent.indexOf("Edge")?d=c.Base.BrowserType.SAFARI:!(b=!!document.documentMode)&&window.StyleMedia?d=c.Base.BrowserType.EDGE:b&&(d=c.Base.BrowserType.IE)),d;var b},getBrowserSubType:function(){return e!==a||(e=c.Base.BrowserSubType.UNKNOWN,window.chrome&&0<Object.keys(window.chrome).length?-1<document.location.href.indexOf("chrome-extension")?e=c.Base.BrowserSubType.CHROME_EXTENSION:-1<document.location.href.indexOf("moz-extension")&&(e=c.Base.BrowserSubType.FIREFOX_EXTENSION):-1<window.navigator.userAgent.indexOf("Chrome")&&-1<window.navigator.userAgent.indexOf("Electron")&&(e=c.Base.BrowserSubType.ELECTRON)),e},getBrowserName:function(){var b;return f===a&&(b=this.getBrowserType(),f=b[0].toUpperCase()+b.toLowerCase().slice(1)),f},getBrowserTabVisibilityParams:function(){var a,b;return void 0!==document.visibilityState?(a="visibilitychange",b="visibilityState"):void 0!==document.mozVisibilityState?(a="mozvisibilitychange",b="mozVisibilityState"):void 0!==document.msVisibilityState?(a="msvisibilitychange",b="msVisibilityState"):void 0!==document.webkitVisibilityState&&(a="webkitvisibilitychange",b="webkitVisibilityState"),[a,b]},isApplicationTabActive:function(a){return this.isUndefined(a)&&(a=this.getBrowserTabVisibilityParams()[1]),"visible"===document[a]},isWebRTC_SupportedBrowser:function(a){var b=this.getBrowserType();if(this.isDefined(a)&&-1!==a.indexOf(b))return!1;var d=b===c.Base.BrowserType.CHROME||b===c.Base.BrowserType.FIREFOX||b===c.Base.BrowserType.EDGE||b===c.Base.BrowserType.SAFARI,a=[c.Base.BrowserType.EDGE,c.Base.BrowserType.SAFARI];return d=(d=!(d&&~a.indexOf(b)&&!window.RTCPeerConnection)&&d)&&b===c.Base.BrowserType.SAFARI?this.isSafariSupported(window.navigator.userAgent):d},isSafariSupported:function(a){return a=a.match(/Version\/(\d+)\.\d+/),!!a&&13<=a[1]},removeDuplicatesFromArray:function(b){return Array.isArray(b)?b.filter(function(a,b,c){return c.indexOf(a)===b}):a},parseUrl:function(b){if(b){var c;[/^(?:([^:/?#]+):)?\/\/(([^:\/?#]+\:\w*\@)??([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(?:\?)?([^#]*|)(?:#)?(.*|)$/,/^(?:([^:/?#]+):)?\/\/(([^:\/?#]+\:\w*\@)??([^:\/?#]*)(?:\:([0-9]+))?)$/].some(function(a){return c=b.match(a)});var d,e=c[4];return c[5]&&(e+=":"+c[5]),c[3]&&(d=c[3].slice(0,-1)),{url:c[0],protocol:c[1],host:e,credentials:d,hostname:c[4],port:parseInt(c[5]),path:c[6],query:c[7],hash:c[8],isSecure:!!c[1]&&("https"===c[1]||"wss"===c[1])}}return a},getHost:function(b){var c=b.port===a||isNaN(b.port)?b.isSecure?"443":"80":b.port;return b.hostname+":"+c},callFunction:function(a,c,d,e,f){var g=b.Deferred(),h=0;f=f||1e3;var i=function(b){setTimeout(function(){c.apply(a,d).then(function(a){g.resolve(a)},function(a){h++,e&&e<h?g.reject(a):i(f)})},b)};return i(0),g.promise()},connectionBackoffAlgorithm:function(a,d,e,f,g){function h(b,d){n||a(b,d).then(function(a){k.resolve(a)},function(a){a&&a.message===c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED?k.reject(a):o(++b,a)})}var i,j=f||2,k=b.Deferred(),l=0,g=c.Base.Utils.isDefined(g)?g:-1,m=e||15e3,n=!1,e={dfdPromise:k.promise(),cancel:function(){n=!0,c.Base.Utils.isDefined(i)&&clearTimeout(i),c.Base.Utils.isDefined(k)&&k.state()===c.Base.DeferredStates.PENDING&&k.reject(c.Base.ErrorReasons.BACKOFF_ALGORITHM_CANCELLED)}},o=function(a,b){var e;a<0?h(a,b):(e=m*Math.pow(j,a),l=12e4<e?12e4:Math.min(12e4,(Math.random()*(1-.8)+.8)*e),c.Base.Logger.debug(c.Base.LoggerTags.UTILS,"BackoffAlgorithm, ConsecutiveFailures: "+a+" Timeout: "+l+"msec"),d&&d(a),i=setTimeout(function(){h(a,b)},l))};return o(g),e},colorIntToHex:function(a){return a=parseInt(a).toString(16),(a="#000000".substr(0,7-a.length)+a).toUpperCase()},concatArrayBuffers:function(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);return c.set(new Uint8Array(a),0),c.set(new Uint8Array(b),a.byteLength),c.buffer},readAsByteArray:function(a){var c=b.Deferred(),d=new FileReader;return d.onload=function(){var a=new Uint8Array(d.result);c.resolve(a)},d.readAsArrayBuffer(a),c},getSingleByteArrayFromString:function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b},stringToArrayBuffer:function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b},createLocalMediaStream:function(b,d,e,f,g,h,i,j){c.Base.Logger.debug(c.Base.LoggerTags.UTILS,"The video resolution of the localStream has to be changed due to bandwidth management.");var k=e.localStream.getVideoTracks()[0];return k&&"function"==typeof k.applyConstraints?void f.getMediaServicesService().getUserMedia().updateStreamUsingApplyConstraints(k,g,e).always(function(){h.call(a,e,j)}):(b=b?b.getDeviceId():a,d=this.getVideoOptions(e.call.getVideoChannels(),d),e._rtConnection.stopStream(e.localStream),f.getMediaServicesService().createLocalMediaStream(e.call.getCallId(),!0,d.enable,b,d.videoDeviceId,d.videoChannelId,g).then(function(b){var d=b.stream;b.videoResolution&&e._updateVideoResolution(b.videoResolution);var f=e.getAudioStream(),g=[];return d.getTracks().forEach(function(a){var b;a.kind===c.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(b=(b=e.getVideoStreams()[0])?b.direction:c.Services.Call.MediaDirection.INACTIVE,g.push(new c.Providers.Interfaces.VideoStream(a.id,b)))}),e.setAVStreams(f,g),e._rtConnection.removeStream(e.localStream),e.localStream=d,e._rtConnection.addStream(e.localStream),e.call.isAudioMuted()&&e._rtConnection.disableLocalAudioStreams(),h.call(a,e,j),b.videoResolution},function(b){i.call(a,e,b)}))},getVideoOptions:function(a,b){var d,e,f=!1;if(c.Base.Utils.isDefined(a))for(var g=0;g<a.length;g++)a[g]._getInternalRequestedDirection()!==c.Services.Call.MediaDirection.INACTIVE&&(f=!0,d=a[g].getChannelId(),b&&(e=b.getDeviceId()));return{enable:f,videoChannelId:d,videoDeviceId:e}},getBytesCount:function(a){for(var b,c=0,d=0;d<a.length;d++){try{b=function(a,b){b=b||0;var c,d=a.charCodeAt(b);if(55296<=d&&d<=56319){if(c=d,b=a.charCodeAt(b+1),isNaN(b))throw"High surrogate not followed by low surrogate in fixedCharCodeAt()";return 1024*(c-55296)+(b-56320)+65536}return!(56320<=d&&d<=57343)&&d}(a,d)}catch(a){return 0}!1!==b&&(b<=127?c++:c+=b<=2047?2:b<=65535?3:b<=2097151?4:b<=67108863?5:6)}return c},isInteger:function(a){return(0^a)===a},generateUUID:void 0!==h&&void 0!==h.getRandomValues?function(){function a(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b}var b=new Uint16Array(8);return h.getRandomValues(b),a(b[0])+a(b[1])+"-"+a(b[2])+"-"+a(b[3])+"-"+a(b[4])+"-"+a(b[5])+a(b[6])+a(b[7])}:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})},deepMerge:function(a,b){if(c.Base.Utils.isUndefined(a)&&c.Base.Utils.isDefined(b))return b;for(var d in b)try{b[d].constructor===Object?a[d]=c.Base.Utils.deepMerge(a[d],b[d]):a[d]=b[d]}catch(e){a[d]=b[d]}return a},rejectIfPromiseNotResolvedInTime:function(a,d,e,f){var g=b.Deferred(),h=setTimeout(function(){g.state()===c.Base.DeferredStates.PENDING&&(c.Base.Logger.warn(c.Base.LoggerTags.UTILS,"cancelIfPromiseNotResolvedInTime - Promise was not resolved in time"),g.reject(e),f&&f())},d);return a.then(function(a){g.state()===c.Base.DeferredStates.PENDING&&(g.resolve(a),clearInterval(h))},function(a){g.state()===c.Base.DeferredStates.PENDING&&(g.reject(a),clearInterval(h))},function(a){g.state()===c.Base.DeferredStates.PENDING&&g.notify(a)}),g.promise()},waitForAllPromisesCompletion:function(a){for(var c,d=b.Deferred(),e=0,f=function(){},g=function(a){return c=c||a,b.Deferred().reject(a).promise()},h=function(a){d.notify(a)},i=function(){++e===a.length&&(c?d.reject(c):d.resolve())},j=0;j<a.length;j++)a[j].then(f,g,h).always(i);return d.promise()},isNotEmptyString:function(a){return!(!a||!a.trim())},isBool:function(a){return typeof a==typeof!0},includes:function(a,b){return Array.prototype.includes?b.includes(a):-1!==b.indexOf(a)},hasProperty:function(a,b){return a instanceof HTMLElement==1?b in a:b in document.createElement(a)},forEach:function(a,b,d){if(c.Base.Utils.isDefined(a.forEach))a.forEach(function(a){b.call(d,a)});else for(var e in a)a.hasOwnProperty(e)&&(e=a[e],b.call(d,e))},addToQueryString:function(a,c){return this.isUndefined(c)?a:~a.indexOf("?")?a+"&"+b.param(c):a+"?"+b.param(c)},normalizeAddress:function(a){return a=a.trim(),!1===/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/.test(a)&&!0===/^(\+?)([0-9\s\.\-\(\)\*\#\,\;]+)$/.test(a)?a.replace(/[\s\-\.\(\)]/g,""):a},cutNumberFromString:function(a){return a.match(/\d+/g).toString()},toNumber:function(a){return parseInt(a,10)},getAverageValueFromArray:function(a){for(var b=0,c=0;c<a.length;c++)"string"==typeof a[c]&&(a[c]=this.toNumber(this.cutNumberFromString(a[c]))),b+=a[c];return b/a.length},getLowerResolution:function(a,b){return a<b==1?a:b}},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a||null,c)}}),void 0===FileReader.prototype.readAsBinaryString&&(FileReader.prototype.readAsBinaryString=function(a){var c="",d=this,e=new FileReader;e.onload=function(a){for(var f=new Uint8Array(e.result),g=f.byteLength,h=0;h<g;h++)c+=String.fromCharCode(f[h]);d.content=c,b(d).trigger("onload")},e.readAsArrayBuffer(a)})}(AvayaClientServices),function(c){"use strict";function d(d,e,f,g){c.Base.Observable.call(this),this._requestBuilder=d,this._restProvider=e,this._restProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._notificationProvider=f,this._notificationProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._started=!1,this._acsAvailable=!1,this._acsConfig={},this._acsResources={},this._acsNotificationResources={},this._maxConnectionErrorCount=5,this._notificationsConfiguration=a,this._notificationPromises={},this._notificationHandlers={},this._eTag=null,this._refreshRestSessionIntervalId=a,this._refreshNotificationSessionIntervalId=a,this._startPromise=b.Deferred(),this._stopPromise=b.Deferred(),this._subscriptions={},this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var a=c.Base.Utils.makeId(32,"0123456789abcdef"),a={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=a,version:"1"}};return JSON.stringify(a)}.bind(this),wsIsPongMessage:function(a){return a="string"==typeof a?JSON.parse(a):a,c.Base.Utils.isDefined(a.pong)&&this._failoverPingData.wsPingMessageRequestId===a.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._blackList=[],this._discoveryBackoffDataObject=a,this._contactsAnalyticsService=g,this._invalidateBackoffDataObject=a,this._maxSearchResultsTotal=a,this._discoveryCounter=0,this._supportCSRF=!0,this._supportV7=!0,this._resourceDiscoveryRetryInterval=250}(d.prototype=b.extend({},c.Base.Observable.prototype)).start=function(a,d){return!1===this._started&&(this._started=!0,this._startPromise=b.Deferred(),this._acsConfig=a,this._restProvider.onMessage=function(a,b){this._setAcsAvailable(!0),void 0===b||null!=(b=b.getResponseHeader("ETag"))&&(this._eTag=b)}.bind(this),this._restProvider.onError=function(){this._setAcsAvailable(!1),d._fireContactsUnavailableCallback(d)}.bind(this),this._restProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._restProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._notificationProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._restProvider.registerBlackList(this._blackList),this._notificationProvider.registerBlackList(this._blackList),this._restProvider.start(this._acsConfig.networkProviderConfiguration,this._acsConfig.credentialProvider),this.discoverResources().then(function(){this.createNotificationsConfig(),this.startNotificationProvider(d).then(function(){this._startRefreshingRestSession(),this._startRefreshingNotificationSession(),this._startPromise.resolve()}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to start notification provider",a),this._started=!1,this._startPromise.reject(a)}.bind(this))}.bind(this))),this._startPromise.promise()},d.prototype.registerBlackList=function(a){this._blackList=a},d.prototype.stop=function(){if(!0===this._started){this._started=!1,this._stopPromise=b.Deferred(),c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=a),c.Base.Utils.isDefined(this._invalidateBackoffDataObject)&&(this._invalidateBackoffDataObject.cancel(),this._invalidateBackoffDataObject=a),this._restProvider.onClose=function(){this._setAcsAvailable(!1),this._stopRefreshingRestSession(),this._stopRefreshingNotificationSession(),this._acsResources={},this._eTag=null,this._stopPromise.resolve()}.bind(this),this._notificationProvider.onClose=function(){this._notificationPromises={},this._notificationHandlers={};try{this._restProvider.close()}catch(a){this._stopPromise.reject(a)}}.bind(this);try{this._notificationProvider.close()}catch(d){this._stopPromise.reject(d)}}return this._stopPromise.promise()},d.prototype.stopIfNoSubscriptions=function(){return Object.keys(this._subscriptions).length?b.Deferred().resolve().promise():this.stop()},d.prototype._startRefreshingRestSession=function(){this._refreshRestSessionIntervalId===a?this._refreshRestSessionIntervalId=setInterval(function(){this.sendRefreshRestSession().then(function(){c.Base.Logger.info(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Successfully refreshed auth session")},function(a){c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to refresh auth session",a)})}.bind(this),1e3*(this._acsResources.sessionManagement.timeout||900)*.8):c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Auth session refreshing is already active")},d.prototype._stopRefreshingRestSession=function(){this._refreshRestSessionIntervalId!==a?(clearInterval(this._refreshRestSessionIntervalId),this._refreshRestSessionIntervalId=a):c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Auth session refreshing is not active")},d.prototype._startRefreshingNotificationSession=function(){this._refreshNotificationSessionIntervalId===a?this._refreshNotificationSessionIntervalId=setInterval(function(){this.sendRefreshNotificationSession().then(function(){c.Base.Logger.info(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Successfully refreshed notification session")},function(a){c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to refresh notification session",a)})}.bind(this),1e3*(this._notificationResources.sessionManagement.timeout||900)*.8):c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification session refreshing is already active")},d.prototype._stopRefreshingNotificationSession=function(){this._refreshNotificationSessionIntervalId!==a?(clearInterval(this._refreshNotificationSessionIntervalId),this._refreshNotificationSessionIntervalId=a):c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification session refreshing is not active")},d.prototype.discoverResources=function(){var b="",d=function(a,c){return this._updateServerSupport(a,c),c=this._requestBuilder.buildResourcesOptions(this._supportCSRF,this._supportV7),this.send(null,c).then(function(a,c){return b=c.getResponseHeader("Content-Type"),a})}.bind(this);return this._discoveryBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(d,a,this._resourceDiscoveryRetryInterval),this._discoveryBackoffDataObject.dfdPromise.then(function(c){this._restProvider.onError=function(){},this._discoveryCounter++,this._resourceDiscoveryRetryInterval=a,this._discoveryBackoffDataObject=a,this._parseResources(c,b)}.bind(this))},d.prototype._updateServerSupport=function(a,b){b&&"function"==typeof b.getReason&&b.getReason()===c.Services.Contacts.ContactsErrorReason.INCOMPATIBLE_SERVER_VERSION?this._supportV7=!1:0===a&&0===this._discoveryCounter&&(this._supportCSRF=!1)},d.prototype.sendInvalidateSession=function(){var b=function(){return this.send(null,this._requestBuilder.buildInvalidateSessionOptions())}.bind(this);return this._invalidateBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(b),this._invalidateBackoffDataObject.dfdPromise.then(function(){this._invalidateBackoffDataObject=a}.bind(this))},d.prototype.sendRefreshRestSession=function(){return this.send(null,this._requestBuilder.buildRefreshRestSessionOptions())},d.prototype.sendRefreshNotificationSession=function(){return this.send(null,this._requestBuilder.buildRefreshNotificationSessionOptions())},d.prototype.send=function(a,b){return this._restProvider.send(a,b)["catch"](function(a){return this._handleError(a)}.bind(this))},d.prototype._handleError=function(a){var d,e=(a=a instanceof c.Base.NetworkError&&a.getData()instanceof c.Base.NetworkErrorEvent?a.getData():a)instanceof c.Base.NetworkErrorEvent?this._handleNetworkErrorEvent(a):a instanceof c.Base.NetworkError?this._handleNetworkError(a):(e=c.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,d="Unknown error: {"+a+"}",this._contactsAnalyticsService.trackContactProvidersUnavailable(e),new c.Services.Contacts.ContactsError(e,d));return c.Base.Logger.warn(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Request failed",d),b.Deferred().reject(e).promise()},d.prototype._handleNetworkErrorEvent=function(a){var b,d,e=a.getStatus();try{var f=JSON.parse(a.getResponseText()).displayMsg}catch(a){c.Base.Logger.debug(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to parse error response")}switch(this._setAcsAvailable(!0),e){case 400:b=c.Services.Contacts.ContactsErrorReason.INVALID_CONTACT,d=f||"Contact is invalid";break;case 401:b=c.Services.Contacts.ContactsErrorReason.AUTHENTICATION_FAILED,d="Authentication failed";break;case 404:b=c.Services.Contacts.ContactsErrorReason.CONTACT_NOT_FOUND,d="Contact was not found";break;case 406:b=c.Services.Contacts.ContactsErrorReason.INCOMPATIBLE_SERVER_VERSION,d="Incompatible server version.  The protocol version used by the client was rejected by the server";break;case 408:case 504:b=c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT,d="Request to server has timed out",this._contactsAnalyticsService.trackContactProvidersUnavailable(b);break;case 409:b=c.Services.Contacts.ContactsErrorReason.DUPLICATE_CONTACT,
d="Contact already exists";break;case 503:b=c.Services.Contacts.ContactsErrorReason.RETRY,d="Server is busy",this._contactsAnalyticsService.trackContactProvidersUnavailable(b);break;case 400001:b=c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE,d="Connection failed",this._contactsAnalyticsService.trackContactProvidersUnavailable(b);break;default:400<=e&&e<500?(b=c.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,d="Unknown Client Error"):(500<=e&&e<600?(this._setAcsAvailable(!1),b=c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE,d="Unknown ACS Server Error"):b=c.Services.Contacts.ContactsErrorReason.UNKNOWN_REASON,this._contactsAnalyticsService.trackContactProvidersUnavailable(b))}return new c.Services.Contacts.ContactsError(b,d)},d.prototype._handleNetworkError=function(a){var b,a=a.message===c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED?(b=c.Services.Contacts.ContactsErrorReason.AUTHENTICATION_CANCELLED,c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED):b=c.Services.Analytics.AnalyticsErrorCode.NETWORK_ERROR;return this._contactsAnalyticsService.trackContactProvidersUnavailable(b),new c.Services.Contacts.ContactsError(b,a)},d.prototype.onCredentialsRequired=function(a,b){b&&b!==this._acsConfig.credentialProvider&&c.Base.Utils.deepMerge(this._acsConfig.credentialProvider,b),this._acsConfig.credentialProvider.onAuthenticationChallenge(void 0,function(b){this.onCredentialsRetrieved(b,a)}.bind(this))},d.prototype.onCredentialsRetrieved=function(a,b){c.Base.Utils.isDefined(b.options)&&(b.options.headers=b.options.headers||{},!a.token||a.bearer&&a.bearer!==c.Config.Authentication.TokenType.UPTOKEN?a.token&&a.bearer?(b.options.wsSecureProtocolData=[],b.options.headers.Authorization=c.Config.Authentication.Header.bearer(a.bearer,a.token)):b.options.headers.Authorization=c.Config.Authentication.Header.basic(a.username,a.password):(b.options.wsSecureProtocolData=[c.Config.Authentication.TokenType.UPTOKEN,a.token],b.options.headers.Authorization=c.Config.Authentication.Header.bearer(c.Config.Authentication.TokenType.UPTOKEN,a.token)))},d.prototype._parseResources=function(d,e){var f;switch(e){case this._requestBuilder._contentTypes.resourcesV2:case this._requestBuilder._contentTypes.resourcesV7:f=new c.Providers.ACS.ResourcesV2;break;case this._requestBuilder._contentTypes.resourcesV1:f=new c.Providers.ACS.ResourcesV1;break;default:c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Unknown version of AADS was discovered. Returned Content-Type:",e),f=new c.Providers.ACS.ResourcesV2}this._acsResources=b.extend({},f,d),this._requestBuilder.setResources(this._acsResources),this._maxSearchResultsTotal=this._acsResources.resources.contacts&&this._acsResources.resources.contacts.GET.getContacts&&this._acsResources.resources.contacts.GET.getContacts.limits&&this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal?this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal:a},d.prototype.createNotificationsConfig=function(){var a=c.Base.Utils.parseUrl(this._acsResources.resources.notification.websocket.href),b=new c.Config.ServerInfo(a.hostname,a.port,a.isSecure,a.path),d=c.Base.Utils.parseUrl(this._acsResources.resources.notification.sse.href),a=new c.Config.ServerInfo(d.hostname,d.port,d.isSecure,d.path),d=new c.Config.ServerInfo;this._notificationsConfiguration=new c.Config.NetworkProviderConfiguration(d,b,a,this._maxConnectionErrorCount)},d.prototype.getETag=function(){return this._eTag},d.prototype.getResources=function(){return this._acsResources},d.prototype.startNotificationProvider=function(d){var e=b.Deferred();if(this._notificationProvider.isOpened())return e.resolve().promise();if(!this._notificationsConfiguration)return c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notifications provider configuration is absent"),this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR),e.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)).promise();this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){c.Base.Logger.debug(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notifications provider has been started"),this._notificationProvider.onMessage=function(a){a=a.data&&a.type!==c.Base.ProvidersEventTypes.PING?JSON.parse(a.data):a,a.notification?this._onNotification(a.notification):a.discovery?(this._onNotificationDiscovery(a.discovery),this._setAcsAvailable(!0),this.trigger(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE),e.resolve(),d._fireContactsAvailableCallback(d)):a.subscribed&&this._onSubscribed(a.subscribed)}.bind(this)}.bind(this),this._notificationProvider.onError=function(a){c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification provider connection failed",a),this._setAcsAvailable(!1),this.trigger(c.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE),e.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR)),d._fireContactsUnavailableCallback(d)}.bind(this);var f=function(){var a=b.Deferred();return this._setAcsAvailable(!1),d._fireContactsUnavailableCallback(d),this._stopRefreshingRestSession(),this._stopRefreshingNotificationSession(),this.discoverResources().then(function(){this.createNotificationsConfig(),this.startNotificationProvider(d).then(function(){a.resolve(),this._startPromise.resolve(),this._startRefreshingRestSession(),this._startRefreshingNotificationSession(),this._resubscribeNotifications()}.bind(this),function(){a.reject()})}.bind(this),function(){a.reject()}.bind(this)),a.promise()}.bind(this);return this._notificationProvider.start(this._notificationsConfiguration,this._acsConfig.credentialProvider,a,a,f,this._failoverPingData).then(function(){return c.Base.Utils.rejectIfPromiseNotResolvedInTime(e.promise(),3e4,new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Notification discovery was not received in time"),d._fireContactsUnavailableCallback(d)})},function(){this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.CONTACTS_NOTIFICATIONS_CHANNEL_FAILED),c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Start notification channel failed.")}.bind(this)),e.promise()},d.prototype._onNotificationDiscovery=function(a){this._notificationResources=b.extend({},new c.Providers.ACS.NotificationResourcesV1,a),this._requestBuilder.setNotificationResources(this._notificationResources),this._notificationResources.commandURL&&(a=c.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfiguration.restConfig.hostName=a.hostname,this._notificationsConfiguration.restConfig.port=a.port,this._notificationsConfiguration.restConfig.isSecure=a.isSecure,this._notificationsConfiguration.restConfig.path=a.path)},d.prototype._resubscribeNotifications=function(){this._subscriptions[c.Providers.ACS.ACSConstants.SVC_GET_CONTACTS]&&this.sendNotification(JSON.stringify(this._subscriptions[c.Providers.ACS.ACSConstants.SVC_GET_CONTACTS]),this._requestBuilder.buildNotificationsOptions()),this._subscriptions[c.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS]&&this.sendNotification(JSON.stringify(this._subscriptions[c.Providers.ACS.ACSConstants.SVC_SEARCH_CONTACTS]),this._requestBuilder.buildNotificationsOptions())},d.prototype._onSubscribed=function(a){var b;a.requestId&&a.results&&(b=this._notificationPromises[a.requestId])&&("acs"===c.Base.Utils.queryJSONObject(a,"results.successful[0].application")?(b.resolve(),c.Base.Logger.debug(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Subscribed to "+c.Base.Utils.queryJSONObject(a,"results.successful[0].resource"))):"acs"===c.Base.Utils.queryJSONObject(a,"results.failed[0].application")&&(a=c.Base.Utils.queryJSONObject(a,"results.failed[0].error.description"),c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Failed to subscribe for notifications",a),this._contactsAnalyticsService.trackContactProvidersUnavailable(c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE),b.reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.SERVER_UNAVAILABLE))))},d.prototype._onNotification=function(a){var b;"acs"!==a.application||!a.resource||(b=this._notificationHandlers[a.resource])&&b(a.contents)},d.prototype.subscribeForNotifications=function(a,d){var e=b.Deferred(),f=e.promise();return f.then(function(){this._notificationHandlers[a.subscribe.resources[0].resource]=d,this._subscriptions[a.subscribe.resources[0].service]=a}.bind(this)),this._notificationPromises[a.subscribe.requestId]=e,this.sendNotification(JSON.stringify(a),this._requestBuilder.buildNotificationsOptions()),c.Base.Utils.rejectIfPromiseNotResolvedInTime(f,3e4,new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Subscription confirmation was not received in time",a.subscribe.resources[0].resource)})},d.prototype.unsubscribeFromNotifications=function(a){return this.sendNotification(JSON.stringify(a),this._requestBuilder.buildNotificationsOptions()).always(function(){delete this._notificationHandlers[a.unsubscribe.resources[0].resource],delete this._subscriptions[a.unsubscribe.resources[0].service]}.bind(this))},d.prototype.sendNotification=function(a,d){return this._notificationProvider.isOpened()?this._notificationProvider.send(a,d).then(function(a){return a},function(a){return this._handleError(a)}.bind(this)):b.Deferred().reject(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.CONTACTS_NOTIFICATIONS_CHANNEL_FAILED)).promise()},d.prototype.isAcsAvailable=function(){return this._acsAvailable},d.prototype.isStarted=function(){return this._started},d.prototype.getMaxSearchResultsTotal=function(){return this._maxSearchResultsTotal},d.prototype._setAcsAvailable=function(a){this._acsAvailable!==a&&(this._acsAvailable=a,this.trigger("acs_availability_changed"))},c.Providers.ACS.ACSNetworkProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d){c.Providers.Interfaces.MessagingProvider.call(this),this._eTag="",this._conversationsLastModified=a,this._isStarted=!1,this._networkProvider=b,this._resources={},this._credentials=a,this._config={},this._ammMessagesParser=d,this._resourcesTypes={conversation:"application/vnd.avaya.aem.conversation.v1+json",conversationAccessTime:"application/vnd.avaya.aem.conversation.access.time.v1+json",conversationFlags:"application/vnd.avaya.aem.conversation.flags.v1+json",conversationIds:"application/vnd.avaya.aem.conversations.ids.v1+json",conversations:"application/vnd.avaya.aem.conversations.v1+json",entity:"application/vnd.avaya.aem.entity.v1+json",error:"application/vnd.avaya.aem.error.v1+json",event:"application/vnd.avaya.aem.event.v1+json",message:"application/vnd.avaya.aem.message.v1+json",messageFlags:"application/vnd.avaya.aem.message.flags.v1+json",messageIds:"application/vnd.avaya.aem.messageIds.v1+json",participants:"application/vnd.avaya.aem.participants.v1+json",resources:"application/vnd.avaya.aem.resources.v1+json",validatedAddresses:"application/vnd.avaya.aem.validatedAddresses.v2+json"},this._endpoints={conversations:"",validateAddresses:"",messages:"",outbox:"",markAsReadIf:"",markAsReadBatch:"",addresses:""},this._latestMessagesInConversations={},this._conversationsWithMissingMessages=[],this._needToGetMissingMessages=!1}var e="attachment",f="inline",g="\r\n";(d.prototype=Object.create(c.Providers.Interfaces.MessagingProvider.prototype)).onCredentialsRequired=function(a,b){b&&b!==this._config.credentialProvider&&c.Base.Utils.deepMerge(this._config.credentialProvider,b),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(b){this.onCredentialsRetrieved(b,a)}.bind(this))},d.prototype.onCredentialsRetrieved=function(b,d){this._credentials=b,d.options!==a&&(d.options.headers=d.options.headers||{},b.token?(b.bearer=b.bearer||c.Config.Authentication.TokenType.BEARER,d.options.headers.Authorization=c.Config.Authentication.Header.bearer(b.token,b.bearer)):d.options.headers.Authorization=c.Config.Authentication.Header.basic(b.username,b.password))},d.prototype.start=function(a){this._config=a,this._isStarted=!0},d.prototype.getConversations=function(a){return a=this._buildGetConversationsRequestOptions(a),this._networkProvider.send(null,a).then(this._onGetConversationsRequestSent.bind(this),this._handleError.bind(this))},d.prototype._buildGetConversationsRequestOptions=function(a){var b=[this._resourcesTypes.conversations,this._resourcesTypes.error].join(", ");return c.Base.Utils.deepMerge(a,{url:this._endpoints.conversations,sendType:"GET",dataType:"JSON",headers:{Accept:b}})},d.prototype._onGetConversationsRequestSent=function(a){return a=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,a),this._updateLatestMessagesInConversations(a.conversations),a},d.prototype.getConversationIds=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.getConversationsByQuery=function(a,b,c){return c=this._buildGetConversationsRequestOptions(c),c=b?this._getConversationsByIds(b,c):this._getConversationsByQuery(a,c),c.then(function(a){this._needToGetMissingMessages?(this._updateConversationsWithMissingMessages(a),this._loadMissingMsgs.apply(this,arguments)):this._updateLatestMessagesInConversations(a.conversations)}.bind(this)),c},d.prototype._getConversationsByIds=function(a,b){return b.url+="?"+a.map(function(a){return"id="+a}).join("&"),this._networkProvider.send(null,b).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},d.prototype._getConversationsByQuery=function(a,b){return this._networkProvider.send(a,b).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},d.prototype._onGetConversationsByQueryRequestSent=function(a){return this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,a)},d.prototype.parseResources=function(a){this._resources=a,this._config.endpoints={}},d.prototype.discoverResources=function(a){var b={urlSuffix:"/aem/resources",sendType:"GET",dataType:"JSON"};return b.headers={Accept:[this._resourcesTypes.resources,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,b).then(function(a){return a=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.DISCOVERY,a),this.parseResources(a),this._resources}.bind(this),this._handleError.bind(this))},d.prototype.getResources=function(){return this._resources},d.prototype.validateUsers=function(a){var b=a.map(function(a){return"address="+a}).join("&"),a=this._buildValidateUsersRequestOptions();return a.url=a.url+"?"+b,this._networkProvider.send(null,a).then(this._onValidateUsersRequestSent.bind(this),this._handleError.bind(this))},d.prototype._buildValidateUsersRequestOptions=function(){var a=[this._resourcesTypes.validatedAddresses,this._resourcesTypes.error].join(", ");return{url:this._endpoints.validateAddresses,sendType:"GET",dataType:"JSON",headers:{Accept:a}}},d.prototype._onValidateUsersRequestSent=function(a){return this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,a)},d.prototype.getRoutableDomains=function(){return this._resources.domains},d.prototype.getSelfAddress=function(){return this._resources.self},d.prototype.getParticipants=function(a,b){return b=b||{},b.url=this._endpoints.conversations+"/"+a+"/participants",b.sendType="GET",b.dataType="JSON",b.headers={Accept:[this._resourcesTypes.participants,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,b)["catch"](this._handleError.bind(this))},d.prototype.setLastAccessTime=function(a,b){return b=b||{},b.url=this._endpoints.conversations+"/"+a,b.sendType="POST",b.headers={"Content-Type":[this._resourcesTypes.conversationAccessTime].join(", "),Accept:[this._resourcesTypes.conversationAccessTime,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,b)["catch"](this._handleError.bind(this))},d.prototype.sendMessage=function(a,b){return b=b||{},b.url=this._endpoints.outbox,b.dataType=null,b.headers={Accept:[this._resourcesTypes.message,this._resourcesTypes.error].join(", "),"Content-Type":this._resourcesTypes.message},this._networkProvider.send(JSON.stringify(a),b).then(function(a){return this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.SEND,a)}.bind(this),this._handleError.bind(this))},d.prototype._handleError=function(a){return a=new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_SERVER_ERROR,a),b.Deferred().reject(a).promise()},d.prototype.sendMessageWithAttachments=function(a,d,e){var f=e||{};f.url=this._endpoints.outbox,f.dataType=null,f.headers={Accept:[this._resourcesTypes.message,this._resourcesTypes.error].join(", "),"Content-Type":'multipart/related;boundary="boundary"'},f.processData=!1;var g=b.Deferred();return this._createThumbnailsPromises(d).then(function(){return this._createAttachmentsPromises(d)}.bind(this),function(a){return b.Deferred().reject(a).promise()}).then(function(b){this._createBody("boundary",a,b).then(function(a){this._networkProvider.send(a,f).then(function(a){a=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.SEND,a),g.resolve(a)}.bind(this),function(a){this._handleError(a).fail(function(a){g.reject(a)})}.bind(this))}.bind(this))}.bind(this),function(a){a=new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_CREATE_ATTACHMENT_FAILED,a),g.reject(a)}),g.promise()},d.prototype._createThumbnailsPromises=function(a){var c=b.Deferred(),d=[];return a.forEach(function(a){d.push(a.createThumbnail())}),b.when.apply(this,d).then(function(){c.resolve(a)}),c.promise()},d.prototype._createAttachmentsPromises=function(a){var c=b.Deferred(),d=[];return a.forEach(function(a){d.push(this._readAttachment(a)),a.getCreateThumbnailCapability().isAllowed&&d.push(this._readAttachment(a.getThumbnail()))}.bind(this)),b.when.apply(this,d).then(function(){c.resolve(Array.prototype.slice.call(arguments))},c.reject),c.promise()},d.prototype._readAttachment=function(a){var d=b.Deferred(),e=new FileReader;return e.onload=function(b){var f;a.disposition&&(f=-1!==a.disposition.indexOf("inline")?c.Services.Messaging.AttachmentType.THUMBNAIL:c.Services.Messaging.AttachmentType.MAIN);var g={name:a.getName(),mime:a.getMimeType(),type:f,data:"",file:a.file},h="base64,";b&&b.target?f===c.Services.Messaging.AttachmentType.THUMBNAIL&&-1!==b.target.result.indexOf(h)?g.data=atob(b.target.result.slice(b.target.result.indexOf(h)+h.length)):g.data=b.target.result:f===c.Services.Messaging.AttachmentType.THUMBNAIL&&-1!==e.content.indexOf(h)?g.data=atob(e.content.slice(e.content.indexOf(h)+h.length)):g.data=e.content,d.resolve(g)},e.onerror=function(a){d.reject(a)},e.readAsBinaryString(a.file),d.promise()},d.prototype._createBody=function(a,b,d){var e=[this._createMessage(b)];d.map(this._createAttachment).map(function(a){e.push(a)});var f="--"+a+g,d="--"+a+"--"+g,a=e.reduce(function(a,b){return a.concat(f,b)});return a.unshift(f),a.push(d),c.Base.Utils.readAsByteArray(new Blob(a))},d.prototype._createMessage=function(a){return["Content-Type:"+this._resourcesTypes.message+";"+g+g,JSON.stringify(a),g]},d.prototype._createAttachment=function(b){var d=b.type===c.Services.Messaging.AttachmentType.THUMBNAIL?f:e,h=d===e&&b.file!==a?b.file:c.Base.Utils.getSingleByteArrayFromString(b.data);return["Content-Type:"+b.mime+g,"Content-Transfer-Encoding:binary\r\n","Content-Disposition:"+d+'; filename="'+b.name+'"'+g+g,h,g]},d.prototype.leaveConversation=function(a){var b={};return b.url=this._endpoints.conversations+"/"+a,b.sendType="DELETE",b.headers={Accept:[this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,b)["catch"](this._handleError.bind(this))},d.prototype.markAllAsRead=function(a,b,c){var d={};return d.url=this._endpoints.markAsReadIf,d.url+="?conversationId="+a,void 0!==b&&(d.url+="&hasAttachment="+!!b),c&&(d.url+="&upTo="+c),d.sendType="POST",d.headers={Accept:[this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,d)["catch"](this._handleError.bind(this))},d.prototype.changeSubject=function(a){var b={};return b.url=this._endpoints.outbox,b.dataType="JSON",b.headers={"Content-Type":this._resourcesTypes.message},this._networkProvider.send(JSON.stringify(a),b)["catch"](this._handleError.bind(this))},d.prototype.markAsReadBatch=function(a){var b={};if(b.url=this._endpoints.markAsReadBatch,""===b.url)throw new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE);return b.sendType="POST",b.headers={Accept:[this._resourcesTypes.error].join(", "),"Content-Type":this._resourcesTypes.messageIds},a=JSON.stringify({messageIds:a}),this._networkProvider.send(a,b)["catch"](this._handleError.bind(this))},d.prototype.getMessages=function(b,c,d,e,f){return e=e?e.id:a,f=f?f.id:a,this._getMsgs(b,c,d,e,f)},d.prototype.reportTyping=function(){},d.prototype.reportCustomChatNotification=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.observeConversations=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.startNotificationProvider=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.subscribeForTypingEventsInConversation=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.unsubscribeForTypingEventsInConversation=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.callEscalationEvent=function(a,b){var c={};return c.url=this._endpoints.conversations+"/"+b+"/events",c.sendType="POST",c.headers={"Content-Type":this._resourcesTypes.event},this._networkProvider.send(JSON.stringify(a),c)["catch"](this._handleError.bind(this))},d.prototype.addParticipantsToConversation=function(a,d,e){return e=b.extend(e,{headers:{}}),e.url=this._endpoints.conversations+"/"+a+"/participants",e.sendType="POST",e.dataType="JSON",e.headers={"Content-Type":this._resourcesTypes.participants},this._networkProvider.send(JSON.stringify(d),e).then(function(a){return this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,a)}.bind(this),this._handleError.bind(this))},d.prototype.close=function(a){var b={};return b.url=this._endpoints.conversations+"/"+a+"/flags",b.sendType="POST",b.dataType="JSON",b.headers={"Content-Type":this._resourcesTypes.conversationFlags},this._networkProvider.send(JSON.stringify({closed:!0}),b).then(function(a){return this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.CLOSE,a)}.bind(this),this._handleError.bind(this))},d.prototype.stop=function(){this._isStarted=!1,this._eTag="";var a=b.Deferred();return this._networkProvider.onClose=function(){this._resources={},a.resolve()}.bind(this),this._networkProvider.onError=function(b){"abort"===b.statusText?a.resolve():(b=new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_CLOSE_FAILED),a.reject(b))}.bind(this),this._networkProvider.close(),a.promise()},d.prototype.logout=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},d.prototype.isUpdateSubjectSupported=function(){return!1},d.prototype.isMarkAllContentAsReadSupported=function(){return!1},d.prototype.getMaxImageSize=function(){return 0},d.prototype.getMaxVideoSize=function(){return 0},d.prototype.getMaxAudioSize=function(){return 0},d.prototype.getMaxTextLength=function(){return 0},d.prototype.getMaxGenericAttachmentSize=function(){return 0},d.prototype.getConversationResource=function(){return this._resources.conversationsResource.href},d.prototype.getValidateAddressResource=function(){return this._resources.services.validateAddresses},d.prototype.getMarkAsReadResource=function(){return this._resources.services.markAsReadIf},d.prototype.isOpened=function(){return!1},d.prototype.getMaxMessageCount=function(){return 15},d.prototype.isStarted=function(){return this._isStarted},d.prototype._getMsgs=function(a,d,e,f,g){return a=b.extend(a,{headers:{}}),a.url=this._endpoints.conversations+"/"+d,d="?",c.Base.Utils.isDefined(e)&&(a.url+=d+"messageCount="+e,d="&"),c.Base.Utils.isDefined(f)&&(a.url+=d+"beforeId="+f,d="&"),c.Base.Utils.isDefined(g)&&(a.url+=d+"afterId="+g),a.sendType="GET",a.dataType="JSON",a.headers={Accept:[this._resourcesTypes.conversation,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,a).then(function(a){return a=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,a),this._needToGetMissingMessages||this._updateLatestMessagesInConversations([a]),a}.bind(this),this._handleError.bind(this))},d.prototype._loadMissingMsgs=function(a){for(var d={},e={},f=[],g=0;g<a.conversations.length;g++){var h=a.conversations[g],i=h.messages,j={id:i[0].id,receivedDate:i[0].receivedDate};-1!==this._conversationsWithMissingMessages.indexOf(h.id)?(e[h.id]={loadedMsgs:0,messageID:i[i.length-1].id},d[h.id]=j):this._latestMessagesInConversations[h.id]=j}var k,l=function(a,b,e){var g=15<=35-b.loadedMsgs?15:35-b.loadedMsgs;this._getMsgs({},a,g,b.messageID).then(function(g){var h=g.messages;if(this.trigger(c.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[{conversations:[g]}]),b.loadedMsgs+=h.length,35!==b.loadedMsgs){for(var i=!0,j=0;j<h.length;j++)if(h[j].id===this._latestMessagesInConversations[a].id){i=!1;break}i?(b.messageID=h[h.length-1].id,l.call(this,a,b,e)):(this._latestMessagesInConversations[a]=d[a],f[e].resolve())}else this._latestMessagesInConversations[a]=d[a],f[e].resolve()}.bind(this))};for(k in e)e.hasOwnProperty(k)&&(f.push(b.Deferred()),l.call(this,k,e[k],f.length-1));f.length?b.when.apply(this,f).then(function(){this._needToGetMissingMessages=!1}.bind(this)):this._needToGetMissingMessages=!1},d.prototype._updateLatestMessagesInConversations=function(a){if(a)for(var b=0;b<a.length;b++){var d=a[b];this._latestMessagesInConversations[d.id]=this._getLatestMessageInConversation(d)}else c.Base.Logger.warn(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"AbstractAMMProvider.prototype._updateLatestMessagesInConversations: conversations is not defined")},d.prototype._getLatestMessageInConversation=function(a){var b=a.id,c=a.messages,d=c.length?c[0]:null,a=this._latestMessagesInConversations[b],c=a?Date.parse(a.receivedDate):null,b=d?Date.parse(d.receivedDate):null;return d&&(!a||a&&c&&b&&c<b)?{id:d.id,receivedDate:d.receivedDate}:a||null},d.prototype._areMessagesInConversationUpToDate=function(a){var b=a.id;if(this._latestMessagesInConversations[b]){for(var c=a.messages,d=0;d<c.length;d++)if(c[d].id===this._latestMessagesInConversations[b].id)return!0;return!1}return!0},d.prototype._updateConversationsWithMissingMessages=function(a){a=a.conversations;for(var b=this._conversationsWithMissingMessages.length=0;b<a.length;b++){var c=a[b];this._areMessagesInConversationUpToDate(c)||this._conversationsWithMissingMessages.push(c.id)}},d.prototype._getConversationsState=function(){var a=b.Deferred();return a.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_FEATURE_NOT_AVAILABLE)),a.promise()},c.Providers.AMM.AbstractAMMProvider=d}(AvayaClientServices),function(a){"use strict";function c(b,c){a.Providers.AMM.AbstractAMMProvider.call(this,b,c),this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resourcesTypes.resources="application/vnd.avaya.aem.resources.v3+json",this._blackListedWords=["subject","message","body","mimeType","size","disposition","mediaUrl","media","givenName","href","nativeGivenName","nativeSurname","surname","address","duration"]}(c.prototype=Object.create(a.Providers.AMM.AbstractAMMProvider.prototype)).start=function(b,c){return this._config=b,this._isStarted=!0,this._networkProvider.onMessage=function(a,b){var c;void 0!==b&&(c=b.getResponseHeader("ETag"),a&&a.conversations&&(a.lastUpdated?this._conversationsLastModified=new Date(new Date(a.lastUpdated).getTime()+1):this._conversationsLastModified=new Date(new Date(b.getResponseHeader("Last-Modified")).getTime()+1)),null!=c&&(this._eTag=c))}.bind(this),this._networkProvider.onError=function(b){return c&&c._fireMessagingUnavailableCallback(a.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR),this._handleError(b)}.bind(this),this._networkProvider.on(a.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(a.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._networkProvider.on(a.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(a.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.start(this._config.networkProviderConfiguration,this._config.credentialProvider)},c.prototype._longPollConversations=function(){if(!b.isEmptyObject(this._resources)){var a=30,a={headers:{"Avaya-Request-Timeout":a=this._resources.avayaRequestTimeout&&this._resources.avayaRequestTimeout.recommended?this._resources.avayaRequestTimeout.recommended:a}};return this.getConversations(a)}},c.prototype.observeConversations=function(){return this._longPollConversations().then(function(a){if(this._isStarted)return a&&a.conversations&&0<a.conversations.length&&this.trigger("conversations.update",[a]),this.observeConversations()}.bind(this))},c.prototype.isUpdateSubjectSupported=function(){return!0},c.prototype.isMarkAllContentAsReadSupported=function(){return!!this._resources&&!!this._resources.services&&!!this._resources.services.markAsReadIf},c.prototype.parseResources=function(c){this._resources=b.extend(new a.Providers.AMM.ResourcesV2,c),this._endpoints.conversations=this._resources.conversationsResource.href,this._endpoints.validateAddresses=this._resources.services.validateAddresses,this._endpoints.messages=this._resources.messages,this._endpoints.outbox=this._resources.outbox,this._endpoints.markAsReadIf=this._resources.services.markAsReadIf,this._endpoints.addresses=this._resources.addresses},c.prototype.getMaxImageSize=function(){return a.Base.Utils.queryJSONObject(this,"_resources.limits.maxImageSize")},c.prototype.getMaxVideoSize=function(){return a.Base.Utils.queryJSONObject(this,"_resources.limits.maxVideoSize")},c.prototype.getMaxAudioSize=function(){return a.Base.Utils.queryJSONObject(this,"_resources.limits.maxAudioSize")},c.prototype.getMaxTextLength=function(){return a.Base.Utils.queryJSONObject(this,"_resources.limits.maxTextLength")},c.prototype.getMaxGenericAttachmentSize=function(){return a.Base.Utils.queryJSONObject(this,"_resources.limits.maxGenericAttachmentSize")},a.Providers.AMM.AMM2_1Provider=c}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f){c.Providers.AMM.AMM2_1Provider.call(this,b,f),this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resources={},this._notificationResources={},this._maxConnectionErrorCount=5,this._notificationsConfiguration={},
this._notificationProvider=d,this._notificationProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._resourcesTypes.conversation="application/vnd.avaya.aem.conversation.v2+json",this._resourcesTypes.conversationExtensions="application/vnd.avaya.aem.conversation.extensions.v1+json",this._resourcesTypes.conversations="application/vnd.avaya.aem.conversations.v2+json",this._resourcesTypes.message="application/vnd.avaya.aem.message.v2+json",this._resourcesTypes.resources="application/vnd.avaya.aem.resources.v4+json",this._resourcesTypes.subject="application/vnd.avaya.aem.subject.v1+json",this._isListening=!1,this._requests={},this._callbacksForTypingEvents={},this._identity={},this._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._dfdSubscribed={},this._dfdUnsubscribed={},this._dfdConversationsSubscribed={},this._chatStateNotifications=e,this._conversationsSubscribed=!1,this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var a=c.Base.Utils.makeId(32,"0123456789abcdef"),a={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=a,version:"1"}};return JSON.stringify(a)}.bind(this),wsIsPongMessage:function(a){return a="string"==typeof a?JSON.parse(a):a,c.Base.Utils.isDefined(a.pong)&&this._failoverPingData.wsPingMessageRequestId===a.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._discoveryBackoffDataObject=a,this._dfdConversationsResourceState={}}(d.prototype=Object.create(c.Providers.AMM.AMM2_1Provider.prototype)).start=function(a,b){return this._notificationProvider.registerBlackList(this._blackListedWords),c.Providers.AMM.AMM2_1Provider.prototype.start.call(this,a,b)},d.prototype.startNotificationProvider=function(d){var e,f=b.Deferred();return this.getResources().notificationService&&(this.getResources().notificationService.websocket.href||this.getResources().notificationService.sse.href)&&!this._notificationProvider.isOpened()?(this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){this._notificationProvider.onMessage=function(e){var g,h,i,j,e=e.data&&e.type!==c.Base.ProvidersEventTypes.PING?JSON.parse(e.data):e;if(e.notification){var k=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.NOTIFICATION,e.notification);switch(k.service){case c.Providers.AMM.MessagesService.CONVERSATION:this._eTag=c.Base.Utils.queryJSONObject(k,"contents.entityTag"),this.getConversationsByQuery({after:this._conversationsLastModified.toISOString()}).then(function(a){a&&a.conversations&&0<a.conversations.length&&this.trigger(c.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[a])}.bind(this));break;case c.Providers.AMM.MessagesService.CHAT_STATE:var l=b.extend(new c.Providers.AMM.NotificationContentsV1,k.contents),m=l.address===this._resources.self,n=k.resource.slice(this._resources.conversationsResource.href.length+1);this._chatStateNotifications.setChatStateNotification(l,m,this._callbacksForTypingEvents[n]),this._callbacksForTypingEvents[n].fire(l);break;default:c.Base.Logger.warn(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Unknown notification service value received: {0}",k.service)}}else e.notified?(g=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.NOTIFIED,e.notified),this._handleNotificationResponse(g)):e.discovery?(g=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.DISCOVERY_NOTIFICATION,e.discovery),this._notificationResources=b.extend(new c.Providers.AMM.NotificationResourcesV1,g),this._notificationResources.commandURL&&(g=c.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfiguration.restConfig.hostName=g.hostname,this._notificationsConfiguration.restConfig.port=g.port,this._notificationsConfiguration.restConfig.isSecure=g.isSecure,this._notificationsConfiguration.restConfig.path=g.path),f.resolve(),this.trigger(c.Providers.AMM.ProviderStates.AVAILABLE,[]),d._fireMessagingAvailableCallback()):e.subscribed?(j=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,e.subscribed),h=c.Base.Utils.queryJSONObject(j,"results.successful[0].service"),i=c.Base.Utils.queryJSONObject(j,"results.successful[0].resource"),h===c.Providers.AMM.MessagesService.CHAT_STATE&&this._dfdSubscribed[i]!==a&&this._dfdSubscribed[i].state()===c.Base.DeferredStates.PENDING?this._dfdSubscribed[i].resolve(j):h===c.Providers.AMM.MessagesService.CONVERSATION&&this._dfdConversationsSubscribed!==a&&this._dfdConversationsSubscribed.state()===c.Base.DeferredStates.PENDING&&(this._dfdConversationsSubscribed.resolve(j),this._conversationsSubscribed=!0)):e.unsubscribed?(j=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,e.unsubscribed),h=c.Base.Utils.queryJSONObject(j,"results.successful[0].service"),i=c.Base.Utils.queryJSONObject(j,"results.successful[0].resource"),h===c.Providers.AMM.MessagesService.CHAT_STATE&&this._dfdUnsubscribed[i]!==a&&this._dfdUnsubscribed[i].state()===c.Base.DeferredStates.PENDING&&(this._dfdUnsubscribed[i].resolve(j),this._chatStateNotifications.clearChatStateNotifications())):e.resourceState&&(e=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.RESOURCE_STATE,e.resourceState),h=c.Base.Utils.queryJSONObject(e,"results.successful[0].service"),i=c.Base.Utils.queryJSONObject(e,"results.successful[0].resource"),h===c.Providers.AMM.MessagesService.CONVERSATION&&this._dfdConversationsResourceState!==a&&this._dfdConversationsResourceState.state()===c.Base.DeferredStates.PENDING&&this._dfdConversationsResourceState.resolve(e))}.bind(this)}.bind(this),this._chatStateNotifications.onPauseChatState=function(a,d){return""!==this._chatStateNotifications.getConversationId()?this._reportChatState(a,d,!1):(c.Base.Logger.info("Not pausing chat state because conversation already terminated."),b.Deferred().resolve().promise())}.bind(this),this._notificationProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),e=function(){var a=b.Deferred();return this._needToGetMissingMessages=!0,this.trigger(c.Providers.AMM.ProviderStates.UNAVAILABLE,[]),d._fireMessagingUnavailableCallback(c.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR),this._discoverResources(d).then(function(){return this.startNotificationProvider(d).then(function(){return this._conversationsSubscribed?this.observeConversations().then(function(){return this._getConversationsState().then(function(b){var d=b.results.successful[0].state.entityTag,e=function(){a.resolve(),this._resubscribeForTypingEvents()}.bind(this);d!==this._eTag?this.getConversationsByQuery().then(function(a){a&&a.conversations&&0<a.conversations.length&&this.trigger(c.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,[a]),this._eTag=d,e()}.bind(this)):e()}.bind(this))}.bind(this)):void a.resolve()}.bind(this),function(){a.reject()}.bind(this))}.bind(this)),a.promise()}.bind(this),this._notificationProvider.start(this._notificationsConfiguration,this._config.credentialProvider,a,a,e,this._failoverPingData).fail(function(){c.Base.Logger.error(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Start notification channel failed."),f.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_NOTIFICATION_FAILED))})):f.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_NOTIFICATIONS_CHANNEL_FAILED)),c.Base.Utils.rejectIfPromiseNotResolvedInTime(f.promise(),3e4,new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Notification discovery was not received in time"),d._fireMessagingUnavailableCallback(c.Services.Analytics.AnalyticsErrorCode.NOTIFICATION_ERROR)})},d.prototype.stop=function(){var d=b.Deferred();return c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=a),c.Providers.AMM.AMM2_1Provider.prototype.stop.call(this).then(function(){this._notificationProvider.onClose=function(){this._conversationsLastModified=a,this._isListening=!1,d.resolve()}.bind(this);try{this._notificationProvider.close()}catch(b){d.reject(new c.Services.Messaging.MessagingError(c.Services.Messaging.MessagingErrorReason.MESSAGING_CLOSE_FAILED))}}.bind(this),d.reject),d.promise()},d.prototype.logout=function(){if(this._resources.sessionManagement){var a={};return a.url=this._resources.sessionManagement.href,a.sendType="DELETE",a.headers={Accept:this._resourcesTypes.error},this._networkProvider.send(null,a)}return b.Deferred().resolve().promise()},d.prototype.discoverResources=function(a){return this._discoverResources(a).then(function(b){var d=b.sessionManagement.username;return this._credentials.username!==d?(c.Base.Logger.warn(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Deleting session due to mismatch username"),this.logout().then(function(){return this.discoverResources(a)}.bind(this))):b}.bind(this))},d.prototype._discoverResources=function(b){var d=function(){var a={urlSuffix:"/aem/resources",sendType:"GET",dataType:"JSON",crossDomain:!0};return a.headers={Accept:[this._resourcesTypes.resources,this._resourcesTypes.error].join(", ")},this._networkProvider.send(null,a)}.bind(this);return this._discoveryBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(d),this._discoveryBackoffDataObject.dfdPromise.then(function(b){return b=this._ammMessagesParser.parse(c.Providers.AMM.AMMResponsesTypes.DISCOVERY,b),this._discoveryBackoffDataObject=a,this.parseResources(b)}.bind(this),function(a){return this.trigger(c.Providers.AMM.ProviderStates.UNAVAILABLE,[]),b._fireMessagingUnavailableCallback(c.Services.Analytics.AnalyticsErrorCode.CONNECTION_BACKOFF_ALGORITHM_ERROR),this._handleError(a)}.bind(this))},d.prototype.parseResources=function(a){this._resources=b.extend(new c.Providers.AMM.ResourcesV4,a),this._endpoints.conversations=this._resources.conversationsResource.href,this._endpoints.validateAddresses=this._resources.services.validateAddresses.href,this._endpoints.messages=this._resources.messages.href,this._endpoints.outbox=this._resources.outbox.href,this._endpoints.markAsReadIf=this._resources.services.markAsReadIf.href,this._endpoints.markAsReadBatch=this._resources.services.markAsReadBatch.href;var d=c.Base.Utils.parseUrl(this._resources.notificationService.websocket.href),e=new c.Config.ServerInfo(d.hostname,d.port,d.isSecure,d.path),a=c.Base.Utils.parseUrl(this._resources.notificationService.sse.href),d=new c.Config.ServerInfo(a.hostname,a.port,a.isSecure,a.path),a=new c.Config.ServerInfo;return this._notificationsConfiguration=new c.Config.NetworkProviderConfiguration(a,e,d,this._maxConnectionErrorCount),this._resources},d.prototype.getConversationIds=function(a){return a=c.Base.Utils.deepMerge(a,{headers:{}}),a.url=this._endpoints.conversations,a.sendType="GET",a.dataType="JSON",a.headers.Accept=[this._resourcesTypes.conversationIds,this._resourcesTypes.error].join(", "),this._networkProvider.send(null,a).then(function(a){return a},this._handleError.bind(this))},d.prototype.observeConversations=function(){this._dfdConversationsSubscribed=b.Deferred();var a={subscribe:{resources:[{application:"AMM",service:"conversation",resource:this._resources.conversationsResource.href}],version:"1"}};return this._notificationProvider.send(JSON.stringify(a),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdConversationsSubscribed.promise()},d.prototype.reportTyping=function(a,d){var e=this._chatStateNotifications.getChatNotification(this._resources.self);return e&&e.action!==c.Providers.AMM.ChatStateActions.TYPING&&(this._reportChatState(e.action,a,!1),this._chatStateNotifications.clearChatStateRefreshTimeout()),this._chatStateNotifications.isChatStateAdded()?((e=b.Deferred()).resolve(),e.promise()):(this._chatStateNotifications.setChatStateRefreshTimeout(),this._reportChatState(c.Providers.AMM.ChatStateActions.TYPING,a,d))},d.prototype.reportCustomChatNotification=function(a,d,e){var f=this._chatStateNotifications.getChatNotification(this._resources.self);return f&&f.action===c.Providers.AMM.ChatStateActions.TYPING&&(this._reportChatState(c.Providers.AMM.ChatStateActions.TYPING,a,!1),this._chatStateNotifications.clearChatStateRefreshTimeout()),this._chatStateNotifications.isChatStateAdded()?((f=b.Deferred()).resolve(),f.promise()):(this._chatStateNotifications.setChatStateRefreshTimeout(),this._reportChatState(d,a,e))},d.prototype.subscribeForTypingEventsInConversation=function(a,c){var d=this._resources.conversationsResource.href+"/"+a;this._chatStateNotifications.setConversationId(a),this._dfdSubscribed[d]=b.Deferred();var e={subscribe:{resources:[{application:"AMM",service:"chatState",resource:d}]}},f=!1;return this._callbacksForTypingEvents[a]||(this._callbacksForTypingEvents[a]=b.Callbacks()),this._callbacksForTypingEvents[a].has()||(f=!0),this._callbacksForTypingEvents[a].has(c)||this._callbacksForTypingEvents[a].add(c),f&&this._notificationProvider.send(JSON.stringify(e),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdSubscribed[d].promise()},d.prototype.unsubscribeForTypingEventsInConversation=function(a){var c=this._resources.conversationsResource.href+"/"+a;this._chatStateNotifications.setConversationId(""),this._dfdUnsubscribed[c]=b.Deferred();var d={unsubscribe:{resources:[{application:"AMM",service:"chatState",resource:c}]}};return this._callbacksForTypingEvents[a]&&this._callbacksForTypingEvents[a].has()&&this._callbacksForTypingEvents[a].empty(),this._notificationProvider.send(JSON.stringify(d),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdUnsubscribed[c].promise()},d.prototype._resubscribeForTypingEvents=function(){var a=this._chatStateNotifications.getConversationId();if(""!==a){var c=this._resources.conversationsResource.href+"/"+a;return this._dfdSubscribed[c]=b.Deferred(),a={subscribe:{resources:[{application:"AMM",service:"chatState",resource:c}]}},this._notificationProvider.send(JSON.stringify(a),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdSubscribed[c].promise()}},d.prototype._sendNotification=function(a,b){for(var d=c.Base.Utils.makeId();c.Base.Utils.isDefined(this._requests[d]);)d=c.Base.Utils.makeId();return a={notify:{requestId:d,notifications:[a]}},this._requests[d]=b,this._notificationProvider.send(JSON.stringify(a),{dataType:"JSON",headers:{"Content-Type":"application/json"}}).fail(function(a){this._requests[d].reject(a),delete this._requests[d]}.bind(this))},d.prototype._handleNotificationResponse=function(a){var b;a.results.successful&&c.Base.Utils.isDefined(this._requests[a.requestId])?(this._requests[a.requestId].resolve(a.results.successful[0]),delete this._requests[a.requestId]):a.results.failed&&c.Base.Utils.isDefined(this._requests[a.requestId])&&(b=new c.Services.Messaging.MessagingError(c.Base.ErrorReasons.AMM_NOTIFICATION_FAILED,c.Base.Utils.queryJSONObject(a,"results.failed")),this._requests[a.requestId].reject(b),delete this._requests[a.requestId])},d.prototype.isUpdateSubjectSupported=function(){return!!(this._resources&&this._resources.conversationsResource&&this._resources.conversationsResource.capabilities&&this._resources.conversationsResource.capabilities.subjectChange)},d.prototype.isMarkAllContentAsReadSupported=function(){return!!this._resources&&!!this._resources.services&&!!this._resources.services.markAsReadIf},d.prototype._reportChatState=function(a,d,e){var f=b.Deferred(),d={application:"AMM",service:"chatState",resource:this._resources.conversationsResource.href+"/"+d,contents:{state:c.Providers.AMM.ChatStates.PAUSED}};return e&&(d.contents={action:a,state:c.Providers.AMM.ChatStates.COMPOSING}),this._sendNotification(d,f),f.promise()},d.prototype.isOpened=function(){return this._notificationProvider.isOpened()},d.prototype.getMaxMessageCount=function(){return this._resources.conversationsResource.limits.maxMessageCount},d.prototype.getMaxImageSize=function(){return c.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxImageSize")},d.prototype.getMaxVideoSize=function(){return c.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxVideoSize")},d.prototype.getMaxAudioSize=function(){return c.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxAudioSize")},d.prototype.getMaxTextLength=function(){return c.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxTextLength")},d.prototype.getMaxGenericAttachmentSize=function(){return c.Base.Utils.queryJSONObject(this,"_resources.outbox.limits.maxGenericAttachmentSize")},d.prototype.changeSubject=function(a){var b={},c={subject:a.subject};return b.url=this._endpoints.conversations+"/"+a.threadId,b.sendType="POST",b.headers={"Content-Type":this._resourcesTypes.subject},this._networkProvider.send(JSON.stringify(c),b)["catch"](this._handleError.bind(this))},d.prototype._getConversationsState=function(){var a={getState:{requestId:"myGetState",resources:[{application:"AMM",service:"conversation",resource:this._resources.conversationsResource.href}],version:"1"}};return this._dfdConversationsResourceState=b.Deferred(),this._notificationProvider.send(JSON.stringify(a),{dataType:"JSON",headers:{"Content-Type":"application/json"}}),this._dfdConversationsResourceState.promise()},d.prototype.leaveConversation=function(a){return c.Providers.AMM.AbstractAMMProvider.prototype.leaveConversation.apply(this,[a]).then(function(){this._chatStateNotifications.setConversationId("")}.bind(this))},c.Providers.AMM.AMM3Provider=d}(AvayaClientServices),function(c){"use strict";function d(){c.Providers.AMM.AbstractAMMProvider.call(this),this._providers=[],this._selectedProvider=a,this._config={},this._isAvailable=!1}(d.prototype=Object.create(c.Providers.AMM.AbstractAMMProvider.prototype)).registerAMMProvider=function(a,b){b.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),b.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),b.on(c.Providers.AMM.ProviderStates.AVAILABLE,function(){this.trigger(c.Providers.AMM.ProviderStates.AVAILABLE,[])}.bind(this)),b.on(c.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this.trigger(c.Providers.AMM.ProviderStates.UNAVAILABLE,[])}.bind(this)),this._providers.push({version:a,provider:b})},d.prototype.start=function(a,c){return b.isEmptyObject(a)||this._config===a||(this._config=a),this.determineServerVersion(c)},d.prototype.determineServerVersion=function(a){var c=b.Deferred();return this._providers.sort(function(a,b){return b.version-a.version}),this._checkServer(0,c,this._config,a),c.promise()},d.prototype._checkServer=function(a,b,d,e){this._isProperVersion(a,d,e).then(function(){this._selectedProvider=this._providers[a].provider,c.Base.Logger.info(c.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"Determined AMM server version: "+this._selectedProvider._resourcesTypes.resources),this._selectedProvider.startNotificationProvider(e),b.resolve()}.bind(this),function(f){a+=1;var g=f.getData()&&f.getData().message===c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED,h=f.getData()&&f.getData()===c.Base.ErrorReasons.BACKOFF_ALGORITHM_CANCELLED;!(406===f.statusCode||a<this._providers.length-1)||g||h?b.reject(f):this._checkServer(a,b,d,e)}.bind(this))},d.prototype._isProperVersion=function(a,b,c){return this._selectedProvider=this._providers[a].provider,this._providers[a].provider.start(b,c),this._providers[a].provider.discoverResources(c).then(function(){this._isAvailable=!0}.bind(this))},d.prototype.getRoutableDomains=function(){return this._selectedProvider.getRoutableDomains()},d.prototype.getSelfAddress=function(){return this._selectedProvider.getSelfAddress()},d.prototype.getConversations=function(a){return this._selectedProvider.getConversations(a)},d.prototype.getConversationIds=function(a){return this._selectedProvider.getConversationIds(a).then(function(a){for(var b=[],d=0;d<a.conversationIds.length;d++)b.push(new c.Services.Messaging.ConversationId(a.conversationIds[d]));return b})},d.prototype.getConversationsByQuery=function(a,b,c){return this._selectedProvider.getConversationsByQuery(a,b,c)},d.prototype.discoverResources=function(){return this._selectedProvider.discoverResources()},d.prototype.getResources=function(){return this._selectedProvider.getResources()},d.prototype.validateUsers=function(a){return this._selectedProvider.validateUsers(a)},d.prototype.getParticipants=function(a,b){return this._selectedProvider.getParticipants(a,b)},d.prototype.sendMessage=function(a,b){return this._selectedProvider.sendMessage(a,b)},d.prototype.sendMessageWithAttachments=function(a,b,c){return this._selectedProvider.sendMessageWithAttachments(a,b,c)},d.prototype.leaveConversation=function(a){return this._selectedProvider.leaveConversation(a)},d.prototype.markAllAsRead=function(a){return this._selectedProvider.markAllAsRead(a)},d.prototype.changeSubject=function(a){return this._selectedProvider.changeSubject(a)},d.prototype.markAsReadBatch=function(a){return this._selectedProvider.markAsReadBatch(a)},d.prototype.getMessages=function(a,b,c,d,e){return this._selectedProvider.getMessages(a,b,c,d,e)},d.prototype.reportTyping=function(a,b){return this._selectedProvider.reportTyping(a,b)},d.prototype.reportCustomChatNotification=function(a,b,c){return this._selectedProvider.reportCustomChatNotification(a,b,c)},d.prototype.observeConversations=function(){return this._selectedProvider.observeConversations()},d.prototype.callEscalationEvent=function(a,b){return this._selectedProvider.callEscalationEvent(a,b)},d.prototype.setLastAccessTime=function(a,b){return this._selectedProvider.setLastAccessTime(a,b)},d.prototype.addParticipantsToConversation=function(a,b){return this._selectedProvider.addParticipantsToConversation(a,b)},d.prototype.subscribeForTypingEventsInConversation=function(a,b){return this._selectedProvider.subscribeForTypingEventsInConversation(a,b)},d.prototype.unsubscribeForTypingEventsInConversation=function(a){return this._selectedProvider.unsubscribeForTypingEventsInConversation(a)},d.prototype.close=function(a){return this._selectedProvider.close(a)},d.prototype.stop=function(){return this._selectedProvider.stop().then(function(){this._isAvailable=!1}.bind(this))},d.prototype.logout=function(){return this._selectedProvider.logout()},d.prototype.on=function(a,b){return this._selectedProvider?this._selectedProvider.on(a,b):c.Providers.AMM.AbstractAMMProvider.prototype.on.call(this,a,b)},d.prototype.off=function(a,b){return this._selectedProvider.off(a,b)},d.prototype.isUpdateSubjectSupported=function(){return this._selectedProvider.isUpdateSubjectSupported()},d.prototype.isMarkAllContentAsReadSupported=function(){return this._selectedProvider.isMarkAllContentAsReadSupported()},d.prototype.isOpened=function(){return this._selectedProvider.isOpened()},d.prototype.getMaxMessageCount=function(){return this._selectedProvider.getMaxMessageCount()},d.prototype.getMaxImageSize=function(){return this._selectedProvider.getMaxImageSize()},d.prototype.getMaxVideoSize=function(){return this._selectedProvider.getMaxVideoSize()},d.prototype.getMaxAudioSize=function(){return this._selectedProvider.getMaxAudioSize()},d.prototype.getMaxTextLength=function(){return this._selectedProvider.getMaxTextLength()},d.prototype.getMaxSubjectLength=function(){return 50},d.prototype.getMaxGenericAttachmentSize=function(){return this._selectedProvider.getMaxGenericAttachmentSize()},d.prototype.getConversationResource=function(){return this._selectedProvider.getConversationResource()},d.prototype.getValidateAddressResource=function(){return this._selectedProvider.getValidateAddressResource()},d.prototype.getMarkAsReadResource=function(){return this._selectedProvider.getMarkAsReadResource()},d.prototype.isAvailable=function(){return this._isAvailable&&!!this._selectedProvider&&!!this._selectedProvider.isStarted()&&this.isOpened()},c.Providers.AMM.AMMProvider=d}(AvayaClientServices),function(a){"use strict";var b="v",c="tid",d="cid",e="t",f="an",g="av",h="event",i="timing",j=!1,k=[],l={BUCKET_DEFINITIONS:{OPERATIONS_TIMING:{LESS_100:"<100 msec",MORE_100:"100-999 msec",MORE_1000:"1000-4999 msec",MORE_5000:"5000-9999 msec",MORE_10000:">=10000 msec"},SERVICE_OUTAGE:{LESS_1000:"<1 sec",MORE_1000:"1-59 sec",MORE_60000:"1-10 min",MORE_600000:"10-59 min",MORE_3600000:">=1 hour"},CALL_DURATION:{LESS_10000:"<10 sec",MORE_10000:"10-59 sec",MORE_60000:"1-5 min",MORE_300000:"5-10 min",MORE_600000:"10-60 min",MORE_3600000:">=60 min"},CONTACT_COUNT:{LESS_10:"<10",MORE_10:"10-99",MORE_100:"100-499",MORE_500:"500-999",MORE_1000:"1000-1999",MORE_2000:"2000-2999",MORE_3000:"3000-3999",MORE_4000:"4000-4999",MORE_5000:">=5000"},ATTACHMENT_SIZE:{LESS_100:"<100 KB",MORE_100:"100-999 KB",MORE_1000:"1000-4999 KB",MORE_5000:"5000-9999 KB",MORE_10000:"10000-29999 KB",MORE_30000:">=30000 KB"},CALL_PRESERVATION:{LESS_1000:"<1 sec",MORE_1000:"1-5 sec",MORE_5000:"5-10 sec",MORE_10000:"10-30 sec",MORE_30000:"30-60 sec",MORE_60000:">=60 sec"}}},m=a.Base.Utils;a.Providers.Analytics.AnalyticsStatistic={CONSTANTS:l,setCollectionEnabledState:function(a){(j=a)||(k.length=0)},isCollectionEnabled:function(){return j},queueCollectedHits:function(){this._hitTransmissionQueue=this._hitTransmissionQueue.concat(k),k.length=0},addHit:function(a){j&&k.push(a)},getCommonRequestsParams:function(a,e){for(var h="",i=[[b,1],[c,"UA-81637253-1"],[d,e],[f,"Client SDK Communications Package"],[g,a]],j=0;j<i.length;j++)h+=this.addURIParam(i[j][0],i[j][1],!h);return h},addHitTypeParameter:function(b){var c="";switch(b){case"event":c=h;break;case"timing":c=i;break;default:a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_PROVIDER,"Unknown type",b)}return this.addURIParam(e,c)},addCustomDimensionsParameters:function(a){var b,c,d="";for(b in a)!a.hasOwnProperty(b)||"string"==typeof(c=a[b])&&""!==c&&m.getBytesCount(encodeURIComponent(c))<=150&&(d+=this.addURIParam("cd"+b,c));return d},addURIParam:function(a,b,c){var d="";return d+=c?"":"&",d+=a+"="+encodeURIComponent(b)},getOperationTimingLabel:function(a){var b=l.BUCKET_DEFINITIONS.OPERATIONS_TIMING;return a<100?b.LESS_100:a<1e3?b.MORE_100:a<5e3?b.MORE_1000:a<1e4?b.MORE_5000:b.MORE_10000},getServiceOutageLabel:function(a){var b=l.BUCKET_DEFINITIONS.SERVICE_OUTAGE;return a<1e3?b.LESS_1000:a<6e4?b.MORE_1000:a<6e5?b.MORE_60000:a<36e5?b.MORE_600000:b.MORE_3600000},getCallDurationLabel:function(a){var b=l.BUCKET_DEFINITIONS.CALL_DURATION;return a<1e4?b.LESS_10000:a<6e4?b.MORE_10000:a<3e5?b.MORE_60000:a<6e5?b.MORE_300000:a<36e5?b.MORE_600000:b.MORE_3600000},getContactCountLabel:function(a){var b=l.BUCKET_DEFINITIONS.CONTACT_COUNT;return a<10?b.LESS_10:a<100?b.MORE_10:a<500?b.MORE_100:a<1e3?b.MORE_500:a<2e3?b.MORE_1000:a<3e3?b.MORE_2000:a<4e3?b.MORE_3000:a<5e3?b.MORE_4000:b.MORE_5000},getAttachmentSizeLabel:function(a){var b=l.BUCKET_DEFINITIONS.ATTACHMENT_SIZE;return(a/=1024)<100?b.LESS_100:a<1e3?b.MORE_100:a<5e3?b.MORE_1000:a<1e4?b.MORE_5000:a<3e4?b.MORE_10000:b.MORE_30000},getCallPreservation:function(a){var b=l.BUCKET_DEFINITIONS.CALL_PRESERVATION;return a<1e3?b.LESS_1000:a<5e3?b.MORE_1000:a<1e4?b.MORE_5000:a<3e4?b.MORE_10000:a<6e4?b.MORE_30000:b.MORE_60000}}}(AvayaClientServices),function(a){"use strict";var b="utc",c="utv",d="utt",e="utl",f=a.Base.Utils,g=a.Providers.Analytics.AnalyticsStatistic;a.Providers.Analytics.AnalyticsTimingStatistic={send:function(a,b,c,d,e){var f;!g.isCollectionEnabled()||(f=this._getTimingParams.apply(this,arguments))&&g.addHit(f)},_getTimingParams:function(a,h,i,j,k){if(!f.isInteger(i))return null;var l=g.addHitTypeParameter("timing"),m=[[b,a],[c,h],[d,i]];j&&m.push([e,j]);for(var n=0;n<m.length;n++)l+=g.addURIParam(m[n][0],m[n][1]);return l+=g.addCustomDimensionsParameters(k)}}}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f,g){c.Base.Observable.call(this),this._restProvider=d,this._restProvider.setCSRFSupport(!0),this._notificationProvider=e,this._restKeepAliveProvider=f,this._restKeepAliveProvider.setCSRFSupport(!0),this._residueRestKeepAliveProvider=a,this._messageBuilder=b,this._csgConfig=a,this._notificationsConfig=a,this._maxConnectionErrorCount=5,this._credentials=a,this._started=!1,this._isNetworkAvailable=!1,this._startPromise=a,this._eTag=a,this._cancelDiscovery=!1,this._resourceHrefs={},this._restResources={},this._notificationResources={},this._activeServices=[],this._serviceParameters={},this._notificationPromises={},this._notificationHandlers={},this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var a=c.Base.Utils.makeId(32,"0123456789abcdef"),a={ping:{requestId:this._failoverPingData.wsPingMessageRequestId=a,version:"1"}};return JSON.stringify(a)}.bind(this),wsIsPongMessage:function(a){return a="string"==typeof a?JSON.parse(a):a,c.Base.Utils.isDefined(a.pong)&&this._failoverPingData.wsPingMessageRequestId===a.pong.requestId}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3,ssePingInterval:65e3},this._blackListedWords=["remoteDisplayName","Authorization","authentication","meetingToken","meetingPasscode","meetingId","userIdentity","rlPresenceUpdatedEvent","contact","remoteAddress","targetRemoteAddress","targetCallId","participantId","webCollaborationUrl","callInfo","username","owner","userId"],this._discoveryBackoffDataObject=a,this._clientId=a,this._discoveryCounter=0,this._resourceDiscoveryRetryInterval=250,this._resourceDiscoveryRetryFactor=1.2}(d.prototype=Object.create(c.Base.Observable.prototype)).start=function(d){var e;return this._started||this._startPromise||(this._started=!0,this._csgConfig=d,this._discoveryCounter=0,this._cancelDiscovery=!1,this._startPromise=b.Deferred(),e=function(){this._discoverResources().then(this._startNotificationProvider.bind(this),function(d){return d!==c.Providers.CallServiceGateway.Constants.RESOURCE_DISCOVERY_USERNAME_MISMATCH?b.Deferred().reject(d).promise():(this._clientId=a,void e.call(this))}.bind(this)).then(function(){this._restProvider.onError=function(){},this._startRefreshingClientSession(),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Provider has been started successfully"),c.Base.Utils.isDefined(this._startPromise)&&this._startPromise.resolve()}.bind(this),function(a){c.Base.Utils.isDefined(this._startPromise)&&this._startPromise.reject(a)}.bind(this))}.bind(this),this._startRestProvider().then(e.bind(this))),this._startPromise.promise()},d.prototype.stop=function(){function a(a){d=d||a}if(!this._started&&this._isNetworkAvailable)return b.Deferred().reject("CSGProvider: Provider is not started").promise();if(0<this._activeServices.length)return b.Deferred().resolve().promise();c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel();var d,e=b.Deferred();return this._isNetworkAvailable?this._stopNotificationProvider().then(function(){return this._stopRefreshingClientAndRestSession()}.bind(this),function(b){return a(b),this._stopRefreshingClientAndRestSession()}.bind(this)).then(function(){return this._stopRestProvider()}.bind(this),function(b){return a(b),this._stopRestProvider()}.bind(this)).fail(function(b){a(b)}).always(function(){this._cleanupAfterStop(),d?e.reject(d):e.resolve()}.bind(this)):(this._pauseRefreshingClientSession(),this._stopNotificationProvider().always(function(){this._stopRestProvider().always(function(){this._cleanupAfterStop()}.bind(this)),e.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR))}.bind(this))),e.promise().then(function(){
c.Base.Logger.debug("CSGProvider: Provider has been stopped successfully")})},d.prototype.stopImmediately=function(){function a(a){d=d||a}if(!this._started)return b.Deferred().reject("CSGProvider: Provider is not started");var d,e=b.Deferred();return this._pauseRefreshingClientSession(),c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),this._stopRefreshingClientSessionSynchronously().then(function(){return this._stopNotificationProvider()}.bind(this),function(b){return a(b),this._stopNotificationProvider()}.bind(this)).then(function(){return this._stopRestProvider()}.bind(this),function(b){return a(b),this._stopRestProvider()}.bind(this)).fail(function(b){a(b)}.bind(this)).always(function(){this._cleanupAfterStop(),d?e.reject(d):e.resolve()}.bind(this)),e.promise().then(function(){c.Base.Logger.debug("CSGProvider: Provider has been stopped successfully")})},d.prototype._cleanupAfterStop=function(){this._removeListeners(),this._started=!1,this._discoveryCounter=0,this._cancelDiscovery=!1,this._notificationsConfig=a,this._credentials=a,this._startPromise=a,this._eTag=a,this._clientId=a,this._resourceHrefs={},this._restResources={},this._notificationResources={},this._activeServices=[],this._notificationPromises={},this._notificationHandlers={},c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Provider has been stopped successfully")},d.prototype._startRestProvider=function(){var a=b.Deferred();return this._restProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._restProvider.registerBlackList(this._blackListedWords),this._restProvider.onMessage=function(a,b){void 0===b||null!=(b=b.getResponseHeader("ETag"))&&(this._eTag=b)}.bind(this),this._restProvider.onConnectionUnavailable=function(a){this._handleError("Unable to communicate with REST server"),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",a])}.bind(this),this._restProvider.onOpen=function(){this._restProvider.onError=function(a){this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",a]))}.bind(this),a.resolve()}.bind(this),this._restProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){a.reject(c.Base.NetworkProviderEvents.UNAUTHORIZED),this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[]),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",c.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED])}.bind(this)),this._restProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this._restProvider.start(this._csgConfig.networkProviderConfiguration,this._csgConfig.credentialProvider),a.promise()},d.prototype._stopNotificationProvider=function(){var a=b.Deferred();return this._notificationProvider.onClose=function(){a.resolve(),c.Base.Logger.warn("CSGProvider: Notification service websocket connection is closed")},this._notificationProvider.stopMonitorFallback(),this._isNetworkAvailable?(this._notificationProvider.onError=function(b){c.Base.Logger.warn("CSGProvider: Notification service websocket connection is closed with error",b),a.resolve()},this._notificationProvider.close()):a.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR)),a.promise()},d.prototype._stopRestProvider=function(){return this._restProvider.close()},d.prototype.activateService=function(a,d){var e=this._messageBuilder.buildActivateServiceOptions(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.Services]),f=this._messageBuilder.buildActivateServiceData(a,d);return-1!==this._activeServices.indexOf(a)?(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Service already activated",a),b.Deferred().resolve().promise()):(this._serviceParameters[a]=d,f=JSON.stringify(f),c.Base.Utils.callFunction(this._restProvider,this._restProvider.send,[f,e],5,3200).then(function(b){return this._activeServices.push(a),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Service activated",a),b}.bind(this),function(d){return c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to activate service",a),b.Deferred().reject(d).promise()}.bind(this)))},d.prototype._reactivateService=function(){var a=this._activeServices.indexOf(c.Providers.CallServiceGateway.Constants.CALLS);-1!==a&&(this._activeServices.splice(a,1),this.activateService(c.Providers.CallServiceGateway.Constants.CALLS,this._serviceParameters[c.Providers.CallServiceGateway.Constants.CALLS])),a=this._activeServices.indexOf(c.Providers.CallServiceGateway.Constants.PRESENCE),-1!==a&&(this._activeServices.splice(a,1),this.activateService(c.Providers.CallServiceGateway.Constants.PRESENCE,this._serviceParameters[c.Providers.CallServiceGateway.Constants.PRESENCE]))},d.prototype.deactivateService=function(a){var b=this._messageBuilder.buildDeactivateServiceOptions(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.Services]),d=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(a)),a=this._activeServices.indexOf(a);return-1<a&&this._activeServices.splice(a,1),this._restProvider.send(d,b)},d.prototype._deactivateServicesImmediately=function(){var a=this._messageBuilder.buildDeactivateServiceOptions(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.Services]);a.async=!1;var b=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(c.Providers.CallServiceGateway.Constants.CALLS));this._restProvider.send(b,a),b=JSON.stringify(this._messageBuilder.buildDeactivateServiceData(c.Providers.CallServiceGateway.Constants.PRESENCE)),this._restProvider.send(b,a)},d.prototype._discoverResources=function(){if(this._cancelDiscovery)return b.Deferred().reject("Resource Discovery Cancelled").promise();var d=b.Deferred(),e=function(a){this._isCSRFSupportVerified(a)?c.Base.Utils.isDefined(this._startPromise)&&"pending"===this._startPromise.state()&&(this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST","Resource Discovery"]),this._startPromise.reject("Resource discovery failed detected")):(this._restProvider.setCSRFSupport(!1),this._restKeepAliveProvider.setCSRFSupport(!1))}.bind(this),f=function(a){var b,d,e,f=this._messageBuilder.buildResourceDiscoveryData(this._clientId),g=this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.Clients];g&&(b=(g=g.replace("/users/self/clients","")).indexOf("/csa"),d=g.indexOf("/bsid"),e=g.lastIndexOf("/resources"),-1!==b&&-1!==d&&-1!==e&&(h=g.substring(b,d)+g.substring(e))),c.Base.Utils.isUndefined(h)&&(h=this._csgConfig.networkProviderConfiguration.restConfig.path),this._credentials&&this._credentials.isGuest&&(f.name=this._credentials.displayName);var h=this._messageBuilder.buildResourceDiscoveryOptions(h);return this._restProvider.send(f,h)}.bind(this);return c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(f,e,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor),this._discoveryBackoffDataObject.dfdPromise.then(function(e){if(this._discoveryCounter++,this._resourceDiscoveryRetryInterval=1e3,this._discoveryBackoffDataObject=a,null!==e){if(this._restResources=b.extend({},new c.Providers.CallServiceGateway.RestResources,e),e.clientId&&(this._clientId=e.clientId),e.resources)for(var f=0;f<e.resources.length;f++){var g=e.resources[f];this._resourceHrefs[g.name]=g.serviceReference.href,"calls"===g.name?g.serviceReference.supported?this.trigger(c.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[g.serviceReference.supported]):this.trigger(c.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,[]):"upload-logs"===g.name&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,[g.serviceReference.href,g.bucketName,this._clientId])}var h,i;e.sessionManagement&&(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.RestSessionMgmt]=e.sessionManagement.href,h=c.Base.Utils.queryJSONObject(e,"sessionManagement.username"),c.Base.Utils.isDefined(this._credentials.username)&&(0<=(i=this._credentials.username).indexOf("csaGuest/")&&(i=i.substring("csaGuest/".length)),c.Base.Utils.isDefined(h)&&h!==i&&(!this._credentials.isGuest||0!==h.indexOf("jsg-")&&0!==h.indexOf("sessionId-")?(c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Rediscovering resources due to mismatch username"),this._deleteRestSession(),this._clientId=a,d.reject(c.Providers.CallServiceGateway.Constants.RESOURCE_DISCOVERY_USERNAME_MISMATCH)):(c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Overriding mismatch guest username"),this._credentials.username="csaGuest/"+h,this._csgConfig.credentialProvider.username=this._credentials.username)))),e.clientManagement&&(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.ClientKeepAlive]=e.clientManagement.refreshClient.href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.ClientTerminate]=e.clientManagement.terminateClient.href,e.clientManagement.fastDelete&&(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.FastDelete]=e.clientManagement.fastDelete.href)),e.stunServers&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,[e.stunServers]),e.presence&&(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.PublishPresenceMode]=e.presence.manualMode.set.href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.PublishPresenceState]=e.presence.manualPresenceState.set.href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.PublishPresenceNote]=e.presence.manualNote.set.href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.DeletePresenceMode]=e.presence.manualMode["delete"].href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.DeletePresenceState]=e.presence.manualPresenceState["delete"].href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.DeletePresenceNote]=e.presence.manualNote["delete"].href),e.pubSubContainers&&(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.CreatePresenceContainer]=e.pubSubContainers.create.href),e.notificationService?(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.Websocket]=e.notificationService.websocket.href,this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.SSE]=e.notificationService.sse.href,this._createNotificationsConfig(),d.resolve()):d.reject("Notification service is undefined")}}.bind(this),function(a){this._handleError("_discoverResources() network provider failed - "+a),d.reject(a)}.bind(this)),d.promise()},d.prototype._isCSRFSupportVerified=function(a){return 0<=a||0<this._discoveryCounter},d.prototype._createNotificationsConfig=function(){var a=c.Base.Utils.parseUrl(this._restResources.notificationService.websocket.href),b=new c.Config.ServerInfo(a.hostname,a.port,a.isSecure,a.path),d=c.Base.Utils.parseUrl(this._restResources.notificationService.sse.href),a=new c.Config.ServerInfo(d.hostname,d.port,d.isSecure,d.path),d=new c.Config.ServerInfo;this._notificationsConfig=new c.Config.NetworkProviderConfiguration(d,b,a,this._maxConnectionErrorCount)},d.prototype._startNotificationProvider=function(){var d=b.Deferred();if(this._notificationProvider.isOpened())return d.resolve().promise();if(!this._notificationsConfig)return d.reject(new Error("Unable to start notifications service - Notifications provider configuration is absent")).promise();this._notificationProvider.setHandleWebSocketUnauthorized(!1),this._notificationProvider.onOpen=function(){c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notifications provider has been started"),this._isNetworkAvailable=!0,this._notificationProvider.onMessage=function(a){var b,e,f=a.data&&a.type!==c.Base.ProvidersEventTypes.PING?JSON.parse(a.data):a;f.notification?this._onNotification(f.notification):f.subscribed?this._onSubscribed(f.subscribed):f.discovery?(this._onNotificationDiscovery(f.discovery),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE),d.resolve()):f.notified&&f.notified.results.failed&&(e=f.notified.requestId,b=c.Base.Utils.queryJSONObject(f.notified.results,"failed[0].error.errorCode"),a=c.Providers.CallServiceGateway.Utils.convertErrorCode(b),f=c.Base.Utils.queryJSONObject(f.notified.results,"failed[0].error.description"),null!==(e=e.match(/jscsdk\.(.*)\.req.*/))&&2===e.length&&"null"!==e[1]&&this.trigger(c.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[e[1],a,c.Services.Call.CallProtocolType.APPLICATION,b,f]))}.bind(this)}.bind(this),this._notificationProvider.onError=function(a){c.Base.Logger.warn(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notification service websocket connection failed: ",a),d.reject(new c.Base.NetworkError(c.Base.ErrorReasons.NETWORK_ERROR)),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification",a]))}.bind(this),this._notificationProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._notificationProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this));var e=function(){var a=b.Deferred();return this._pauseRefreshingClientSession(),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification","Unavailable"])),this._activeServices=[],this._discoverResources().then(function(){this._startNotificationProvider().then(function(){this._reactivateService(),this._startRefreshingClientSession(),a.resolve()}.bind(this),function(b){a.reject(b)})}.bind(this),function(b){a.reject(b)}),a.promise()}.bind(this);return this._notificationProvider.registerBlackList(this._blackListedWords),this._notificationProvider.start(this._notificationsConfig,a,a,a,e,this._failoverPingData).then(function(){return c.Base.Utils.rejectIfPromiseNotResolvedInTime(d.promise(),3e4,new c.Base.BaseError(c.Base.ErrorReasons.TIMEOUT),function(){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Notification discovery was not received in time"),this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["Notification","Unavailable"])}.bind(this))}.bind(this),function(){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Start notification channel failed.")}),d.promise()},d.prototype._onNotificationDiscovery=function(a){this._notificationResources=b.extend({},new c.Providers.CallServiceGateway.NotificationResources,a),this._notificationResources.commandURL&&this._resourceHrefs.hasOwnProperty(c.Providers.CallServiceGateway.ResourceType.SSE)&&(c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Using SSE connection"),a=c.Base.Utils.parseUrl(this._notificationResources.commandURL),this._notificationsConfig.restConfig.hostName=a.hostname,this._notificationsConfig.restConfig.port=a.port,this._notificationsConfig.restConfig.isSecure=a.isSecure,this._notificationsConfig.restConfig.path=a.path)},d.prototype._onSubscribed=function(a){var b;a.requestId&&a.results&&(b=this._notificationPromises[a.requestId])&&(c.Base.Utils.queryJSONObject(a,"results.successful[0].application")===c.Providers.CallServiceGateway.Constants.CSA_APPLICATION?(b.resolve(),c.Base.Logger.debug(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Subscribed",c.Base.Utils.queryJSONObject(a,"results.successful[0].resource"))):c.Base.Utils.queryJSONObject(a,"results.failed[0].application")===c.Providers.CallServiceGateway.Constants.CSA_APPLICATION&&(a=c.Base.Utils.queryJSONObject(a,"results.failed[0].error.description"),b.reject({message:"Failed to subscribe for notifications",details:a})))},d.prototype._onNotification=function(a){var b;a.application!==c.Providers.CallServiceGateway.Constants.CSA_APPLICATION||!a.resource||(b=this._notificationHandlers[a.resource])&&b(a.contents)},d.prototype.subscribeForNotifications=function(a,c){var d=b.Deferred(),e=d.promise();return e.then(function(){this._notificationHandlers[a.subscribe.resources[0].resource]=c}.bind(this)),this._notificationPromises[a.subscribe.requestId]=d,this.sendNotification(JSON.stringify(a),this._messageBuilder.buildNotificationsOptions()),e},d.prototype.unsubscribeFromNotifications=function(a){return this.sendNotification(JSON.stringify(a),this._messageBuilder.buildNotificationsOptions()).always(function(){delete this._notificationHandlers[a.unsubscribe.resources[0].resource]}.bind(this))},d.prototype.send=function(a,b){return this._restProvider.send(a,b).fail(function(a){var b=this._parseNetworkError(a);b&&c.Base.Utils.queryJSONObject(b,"error[0].errorCode")!==c.Providers.CallServiceGateway.Constants.CALL_DOES_NOT_EXISTS&&this._handleError(JSON.stringify(a))}.bind(this))},d.prototype.sendNotification=function(a,b){return this._notificationProvider.send(a,b).fail(function(a){this._handleError(JSON.stringify(a))}.bind(this))},d.prototype.getRestResources=function(){return this._restResources},d.prototype.getNotificationResources=function(){return this._restResources},d.prototype.getResourceHrefs=function(){return this._resourceHrefs},d.prototype.getCredentials=function(){return this._credentials},d.prototype.restProviderOnErrorHandler=function(a){this._restProvider.onError=a},d.prototype.forceNetworkRecovery=function(){this._pauseRefreshingClientSession(),this._notificationProvider.onConnectionUnavailable(),this._notificationProvider.close()},d.prototype._onCredentialsRequired=function(a,b){b&&b!==this._csgConfig.credentialProvider&&c.Base.Utils.deepMerge(this._csgConfig.credentialProvider,b),this._csgConfig.credentialProvider.onAuthenticationChallenge(void 0,function(b){this._onCredentialsRetrieved(b,a)}.bind(this))},d.prototype._onCredentialsRetrieved=function(a,b){c.Base.Utils.isDefined(b.options)&&(b.options.authentication=b.options.authentication||{},a.token?(a.bearer=a.bearer||c.Config.Authentication.TokenType.BEARER,!c.Base.Utils.isUndefined(this._credentials)&&this._credentials.token===a.token||(this._credentials=a),b.options.authentication.type=c.Config.Authentication.Scheme.BEARER,b.options.authentication.token=a.token,b.options.authentication.bearer=a.bearer):(!c.Base.Utils.isUndefined(this._credentials)&&this._credentials.username===a.username&&this._credentials.password===a.password||(this._credentials=a),b.options.authentication.type=c.Config.Authentication.Scheme.BASIC,b.options.authentication.username=a.username,b.options.authentication.password=a.password))},d.prototype._startRefreshingRestSession=function(){var a=this._messageBuilder.buildKeepAliveOptions();this._restResources.sessionManagement&&(this._restKeepAliveProvider.stopPolling(),this._restKeepAliveProvider.startPolling(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.RestSessionMgmt],1e3*this._restResources.sessionManagement.timeout*.8,{},a))},d.prototype._pauseRefreshingRestSession=function(){return this._restKeepAliveProvider.stopPolling()},d.prototype._startRefreshingClientSession=function(){var b,d=this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.ClientKeepAlive];c.Base.Utils.isDefined(d)?(b=this._messageBuilder.buildKeepAliveOptions(this._csgConfig),this._pauseRefreshingClientSession(),this._restKeepAliveProvider.startPolling(d,1e3*this._restResources.clientManagement.timeout*.8,{},b),this._restKeepAliveProvider.onMessage=function(b){this._residueRestKeepAliveProvider&&(this._residueRestKeepAliveProvider.stopPolling(),this._residueRestKeepAliveProvider=a),this._isNetworkAvailable||(this._isNetworkAvailable=!0,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE))}.bind(this),this._restKeepAliveProvider.onError=function(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network error detected while pinging session management: ",a),this._isNetworkAvailable?(this._isNetworkAvailable=!1,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",a]),this._monitorKeepAliveSession()):this._residueRestKeepAliveProvider&&this.forceNetworkRecovery()}.bind(this)):this._startRefreshingRestSession()},d.prototype._monitorKeepAliveSession=function(){var a,b,d=this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.ClientKeepAlive];c.Base.Utils.isDefined(d)&&(a=this._messageBuilder.buildKeepAliveOptions(this._csgConfig),this._residueRestKeepAliveProvider?this._residueRestKeepAliveProvider.stopPolling():(this._residueRestKeepAliveProvider=new c.Base.PollingRESTProvider,this._residueRestKeepAliveProvider.setCSRFSupport(!1)),b=3e4,this._restResources.clientManagement.timeout<30&&(b=1e3*this._restResources.clientManagement.timeout*(1-.8)),this._residueRestKeepAliveProvider.startPolling(d,b,{},a),this._residueRestKeepAliveProvider.onMessage=function(a){this._isNetworkAvailable||(this._isNetworkAvailable=!0,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE)),this._startRefreshingClientSession()}.bind(this),this._restKeepAliveProvider.onError=function(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Network error detected while pinging session management: ",a),this._isNetworkAvailable&&(this._isNetworkAvailable=!1,this.trigger(c.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,["REST",a]))}.bind(this))},d.prototype._pauseRefreshingClientSession=function(){return this._residueRestKeepAliveProvider&&(this._residueRestKeepAliveProvider.stopPolling(),this._residueRestKeepAliveProvider=a),this._restKeepAliveProvider.stopPolling()},d.prototype._stopRefreshingClientAndRestSession=function(){return this._pauseRefreshingClientSession(),this._invokeIfNetworkIsAvailable(function(){return this._invokeIfNetworkIsAvailable(this._deleteClientSession.bind(this)).then(function(){return this._invokeIfNetworkIsAvailable(this._deleteRestSession.bind(this))}.bind(this),function(a){return this._invokeIfNetworkIsAvailable(this._deleteRestSession.bind(this))}.bind(this))}.bind(this))},d.prototype._stopRefreshingClientSessionSynchronously=function(){return this._pauseRefreshingClientSession(),this._deleteClientSessionImmediately()},d.prototype._deleteClientSession=function(a){var d=this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.ClientTerminate];return this._isNetworkAvailable&&c.Base.Utils.isDefined(d)?(d=this._messageBuilder.buildDeleteSessionOptions(d),c.Base.Utils.isDefined(a)&&(d.async=a),this._restProvider.send(null,d)):b.Deferred().resolve().promise()},d.prototype._deleteClientSessionImmediately=function(){var a=this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.FastDelete];return a&&navigator.sendBeacon?(navigator.sendBeacon(a)?b.Deferred().resolve():b.Deferred().reject("Failed to delete client session")).promise():this._deleteClientSession(!1)},d.prototype._deleteRestSession=function(a){var b=this._messageBuilder.buildDeleteSessionOptions(this._resourceHrefs[c.Providers.CallServiceGateway.ResourceType.RestSessionMgmt]);return c.Base.Utils.isDefined(a)&&(b.async=a),this._restProvider.send(null,b)},d.prototype._invokeIfNetworkIsAvailable=function(a){return this._isNetworkAvailable?a():b.Deferred().reject("Network is unavailable").promise()},d.prototype._handleError=function(a){c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Error detected: "+a)},d.prototype._parseNetworkError=function(b){var d=c.Base.Utils.queryJSONObject(b,"_data._responseText");if(d)try{return JSON.parse(d)}catch(b){}return a},d.prototype.isNetworkAvailable=function(){return this._isNetworkAvailable},d.prototype.cancelDiscovery=function(){this._cancelDiscovery=!0,c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&this._discoveryBackoffDataObject.cancel(),c.Base.Logger.info(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Resource discovery cancelled")},d.prototype.invalidateClient=function(){this._clientId=a,this._pauseRefreshingClientSession()},d.prototype.isNetworkEventsUrlDefined=function(){return!!this.getResourceHrefs().mpaasevents},d.prototype.setOnNetworkEvents=function(a){if(!this.isNetworkEventsUrlDefined()){var d=new c.Services.Call.CallException(c.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,d),b.Deferred().reject(d).promise()}return d=this._messageBuilder.buildSubscribeGenericEventsOptions(this.getResourceHrefs().mpaasevents),a=JSON.stringify(a),this._restProvider.send(a,d)},d.prototype.removeOnNetworkEvents=function(a){if(!this.isNetworkEventsUrlDefined()){var d=new c.Services.Call.CallException(c.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,d),b.Deferred().reject(d).promise()}return a=this._messageBuilder.buildUnsubscribeGenericEventsOptions(this.getResourceHrefs().mpaasevents,a),this._restProvider.send(null,a)},d.prototype.updateOnNetworkEvents=function(a){if(!this.isNetworkEventsUrlDefined()){var d=new c.Services.Call.CallException(c.Services.Call.CallError.NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE);return c.Base.Logger.error(c.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,d),b.Deferred().reject(d).promise()}return d=this._messageBuilder.buildUpdateGenericEventsOptions(this.getResourceHrefs().mpaasevents),a=JSON.stringify(a),this._restProvider.send(a,d)},c.Providers.CallServiceGateway.CSGProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d,e){c.Providers.Interfaces.ConferenceDataProvider.call(this),this._networkProvider=b,this._config=a,this._messageBuilder=d,this._messageParser=e,this._isStarted=!1}(d.prototype=Object.create(c.Providers.Interfaces.ConferenceDataProvider.prototype)).start=function(a){var c=b.Deferred();return this._config=a,this._isStarted=!0,c.resolve(),c.promise()},d.prototype.onCredentialsRequired=function(a,b){b&&b!==this._config.credentialProvider&&c.Base.Utils.deepMerge(this._config.credentialProvider,b),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(b){this.onCredentialsRetrieved(b,a)}.bind(this))},d.prototype.onCredentialsRetrieved=function(a,b){},d.prototype.sendHandshake=function(a){return a=this._messageBuilder.buildHandshakeRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeMeetingInfo=function(a){return a=this._messageBuilder.buildSubscribeMeetingInfoRequest(a),this._sendMessage(a,"success")},d.prototype.startRecording=function(a,b,d){return d=this._messageBuilder.buildSetRecordingRequest(a,c.Services.Conference.RecordingOperation.START,b,d),this._sendMessage(d,"success")},d.prototype.stopRecording=function(a){return a=this._messageBuilder.buildSetRecordingRequest(a,c.Services.Conference.RecordingOperation.STOP),this._sendMessage(a,"success")},d.prototype.pauseRecording=function(a){return a=this._messageBuilder.buildSetRecordingRequest(a,c.Services.Conference.RecordingOperation.PAUSE),this._sendMessage(a,"success")},d.prototype.resumeRecording=function(a){return a=this._messageBuilder.buildSetRecordingRequest(a,c.Services.Conference.RecordingOperation.RESUME),this._sendMessage(a,"success")},d.prototype.subscribeRoster=function(a){return a=this._messageBuilder.buildSubscribeRosterRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeActiveTalker=function(a){return a=this._messageBuilder.buildSubscribeActiveTalkerRequest(a),this._sendMessage(a,"success")},d.prototype.subscribePermissions=function(a){return a=this._messageBuilder.buildSubscribePermissionsRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeSlider=function(a){return a=this._messageBuilder.buildSubscribeSliderRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeMeetingNote=function(a){return a=this._messageBuilder.buildSubscribeMeetingNoteRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeWebCollab=function(a){return a=this._messageBuilder.buildSubscribeWebCollabRequest(a),this._sendMessage(a,"success")},d.prototype.subscribeAvailableLayouts=function(a){return a=this._messageBuilder.buildSubscribeAvailableLayoutsRequest(a),this._sendMessage(a,"success")},d.prototype.setAsLecturer=function(a,b){return b=this._messageBuilder.buildSetAsLecturerRequest(a,b),this._sendMessage(b,"success")},d.prototype.unsetAsLecturer=function(a){return a=this._messageBuilder.buildUnsetAsLecturerRequest(a),this._sendMessage(a,"success")},d.prototype.disconnectParticipant=function(a,b){return b=this._messageBuilder.buildDisconnectParticipantRequest(a,b._participantId),this._sendMessage(b,"success")},d.prototype.setLocked=function(a,b){return b=this._messageBuilder.buildLockMeetingRequest(a,b),this._sendMessage(b,"success")},d.prototype.muteUnmute=function(a,b,c,d){return d=this._messageBuilder.buildModeratorMuteRequest(a,b,c,d),this._sendMessage(d,"success")},d.prototype.controlRemoteCamera=function(a,b,c){return c=this._messageBuilder.buildFeccRequest(a,b,c),this._sendMessage(c,"success")},d.prototype.muteUnmuteAll=function(a,b){return b=this._messageBuilder.buildMuteAllRequest(a,b),this._sendMessage(b,"success")},d.prototype.sendLocalMuteEvent=function(a,b,c){return c=this._messageBuilder.buildLocalMuteEvent(a,b,c),this._networkProvider.send(JSON.stringify(c))},d.prototype.sendDisconnectEvent=function(a,b){return b=this._messageBuilder.buildDisconnectEvent(a,b),this._networkProvider.send(JSON.stringify(b))},d.prototype.terminateConference=function(a){return a=this._messageBuilder.buildTerminateMeetingRequest(a),this._sendMessage(a,"success")},d.prototype.requestToBecomeModerator=function(a,b){return b=this._messageBuilder.buildStartModerationRequest(a,b),this._sendMessage(b,"success")},d.prototype.signIn=function(a,b){return b=this._messageBuilder.buildUpdateCredentialsTokenRequest(a,b),this._sendMessage(b,"success")},d.prototype.videoPin=function(a,b,c,d,e,f){return f=this._messageBuilder.buildVideoPinRequest(a,b,c,d,e,f),this._sendMessage(f,"success")},d.prototype.extendMeeting=function(a,b){return b=this._messageBuilder.buildExtendMeetingRequest(a,b),this._sendMessage(b,"success")},d.prototype.addParticipant=function(a,b){return b=this._messageBuilder.buildDialoutRequest(a,b),this._sendMessage(b,c.Services.Conference.DialoutStatus.DIALING)},d.prototype.cancelDialoutParticipant=function(a,b){return b=this._messageBuilder.buildCancelDialoutRequest(a,b),this._sendMessage(b,"success")},d.prototype.sendChatMessage=function(a,b,c){return c=this._messageBuilder.buildSendChatMessage(a,b,c),this._sendMessage(c,"success")},d.prototype.setVideoLayout=function(a,b){return b=this._messageBuilder.buildChangeLayoutGeometryRequest(a,b),this._sendMessage(b,"success")},d.prototype.setVideoLayoutSelfSee=function(a,b){return b=this._messageBuilder.buildChangeLayoutNoSelfSeeRequest(a,!b),this._sendMessage(b,"success")},d.prototype.setVideoLayoutTextOverlay=function(a,b){return b=this._messageBuilder.buildChangeLayoutTextOverlayRequest(a,b),this._sendMessage(b,"success")},d.prototype.getCurrentVideoLayout=function(a){return a=this._messageBuilder.buildCurrentLayoutRequest(a),this._sendMessage(a,"success")},d.prototype.raiseLowerHand=function(a,b){return b=this._messageBuilder.buildRaiseHandRequest(a,b),this._sendMessage(b,"success")},d.prototype.moderatorLowerHand=function(a,b,c){return c=this._messageBuilder.buildModeratorLowerHandRequest(a,b,c),this._sendMessage(c,"success")},d.prototype.moderatorAdmission=function(a,b,c){return c=this._messageBuilder.buildModeratorAdmissionRequest(a,b,c),
this._sendMessage(c,"success")},d.prototype.sendAdmissionRequest=function(a,d){var e=b.Deferred(),d=this._messageBuilder.buildAdmissionRequest(a,d);return this._sendMessage(d,[c.Services.Conference.AdmissionResponseCode.SUCCESS,c.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_TRY_AGAIN,c.Services.Conference.AdmissionResponseCode.PENDING_APPROVAL,c.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_DISCONNECTING,c.Services.Conference.AdmissionResponseCode.REJECTED]).then(function(a){this._resolveAdmissionResponse(e,a)}.bind(this),function(a){e.reject(a)}),this.on(c.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE,function(a){this._resolveAdmissionResponse(e,a)}.bind(this)),e.promise()},d.prototype._resolveAdmissionResponse=function(a,b){switch(b.responseCode){case c.Services.Conference.AdmissionResponseCode.SUCCESS:a.resolve(b);break;case c.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_DISCONNECTING:case c.Services.Conference.AdmissionResponseCode.REJECTED:case c.Services.Conference.AdmissionResponseCode.INCORRECT_PASSCODE_TRY_AGAIN:a.reject({name:"UCCPServerError",code:b.responseCode,message:"UCCP server responded with "+b.responseCode});break;case c.Services.Conference.AdmissionResponseCode.PENDING_APPROVAL:break;default:c.Base.Logger.warn(c.Base.LoggerTags.UCCP_CONFERENCE_PROVIDER,"Unknown response code received: {0}",b.responseCode)}},d.prototype.getDialInInfo=function(a){return a=this._messageBuilder.buildDialInInfoRequest(a),this._sendMessage(a,"success")},d.prototype._sendMessage=function(a,d){var e,f=b.Deferred(),g=this._networkProvider._communicationAdapter instanceof c.Providers.UCCP.UCCPLongPollingProvider,h=c.Base.Utils.queryJSONObject(a,"params.transId");return g&&(e={dfd:f,successIndicator:d},this._networkProvider._communicationAdapter._responsesData[h]=e),this._networkProvider.send(JSON.stringify(a)).then(function(a){g||this._resolveResponse(f,a,d)}.bind(this),function(a){g&&this._networkProvider._communicationAdapter._responsesData&&delete this._networkProvider._communicationAdapter._responsesData[h],f.reject(a)}.bind(this)),f.promise()},d.prototype._resolveResponse=function(a,b,c){var d,e;try{d=this._messageParser.parse(b)}catch(b){return void a.reject(b)}d&&d.responseCode&&(c.indexOf?-1<c.indexOf(d.responseCode):d.responseCode===c)?a.resolve(d):(e=400,b&&b.params&&b.params.responseCode&&(e=b.params.responseCode),-1<c.indexOf(e)?a.resolve(d):a.reject({name:"UCCPServerError",code:e,message:"UCCP server responded with "+e}))},d.prototype.changeParticipantName=function(a,b,c){return c=this._messageBuilder.buildChangeParticipantNameRequest(a,b,c),this._sendMessage(c,"success")},c.Providers.UCCP.AbstractUCCPProvider=d}(AvayaClientServices),function(c){"use strict";function d(b,d,e){c.Providers.UCCP.AbstractUCCPProvider.call(this),this._networkProvider=b,this._config=a,this._messageBuilder=d,this._messageParser=e,this._networkRequestRetryHelper=a,this._reconnectCount=0,this._isReconnecting=!1,this._isStarted=!1,this._fallbackPromise=a,this._handleReconnectRetryInterval=1e3,this._handleReconnectRetryFactor=1.2,this._blackListedWords=["text","lecturerName","presenterName","participantName","videoPin","participantDisplayName","meetingName","virtualRoomName","userId","callerId","login","virtualRoomOwnerId","email","userId","userID","pin"],this._failoverPingData={wsKeepAliveEnabled:!0,wsPingInterval:3e4,wsGeneratePingMessage:function(){var a=c.Base.Utils.makeId(32,"0123456789abcdef");return this._failoverPingData.wsPingMessageRequestId=a,a=this._messageBuilder.buildKeepaliveRequest(a),JSON.stringify(a)}.bind(this),wsIsPongMessage:function(a){return!!(a="string"==typeof a?JSON.parse(a):a).name&&a.name===c.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_RESPONSE&&this._failoverPingData.wsPingMessageRequestId===a.params.transId}.bind(this),wsIsPingMessage:function(a){return!!(a="string"==typeof a?JSON.parse(a):a).name&&a.name===c.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:15e3}}(d.prototype=Object.create(c.Providers.UCCP.AbstractUCCPProvider.prototype)).start=function(a,d){this._config=a;var e=b.Deferred();this._networkProvider._onCredentialsRequired=this.onCredentialsRequired.bind(this),this._networkProvider.onOpen=function(){this._networkProvider.onClose=function(){e.reject()},this._networkProvider.isOpened()?(this._isReconnecting&&(this._isReconnecting=!1,this.handleAfterReconnect(d)),this._isStarted=!0,e.resolve()):this._waitForSocketConnection(this._networkProvider,function(){this._isReconnecting&&(this._isReconnecting=!1,this.handleAfterReconnect(d)),this._isStarted=!0,e.resolve()}.bind(this),function(a){e.reject("Failed to open")}.bind(this))}.bind(this),this._networkProvider.onClose=function(){e.reject()},this._networkProvider.onMessage=function(a){var a=a.data?JSON.parse(a.data):JSON.parse(a),b=this._messageParser.parse(a);b instanceof c.Providers.UCCP.UCCPMessage&&(c.Base.Logger.debug(c.Base.LoggerTags.UCCP_CONFERENCE_PROVIDER,"Received message "+b.name),setTimeout(function(){this.trigger(b.name,[b])}.bind(this),0))}.bind(this);var f=a.networkProviderConfiguration.webSocketConfig,g={urlSuffix:f.path,transactionIDLocation:"params.transId"};c.Base.Utils.queryJSONObject(a,"networkProviderConfiguration.webSocketConfig.query")&&-1<f.query.indexOf("ticket=")&&(g.alreadyApplied=!0),f=new c.Config.ServerInfo(f.hostName,f.port,f.isSecure,f.path.replace(/ws$/,"rest"),"",f.query),a.networkProviderConfiguration.restConfig=f;var h=function(){return this._isReconnecting||d._conferenceService._isDisconnecting?b.Deferred().resolve().promise():(this._isReconnecting=!0,this.trigger(c.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_UNAVAILABLE),this._handleReconnect().then(function(){this._isReconnecting=!1,this.handleAfterReconnect()}.bind(this)))}.bind(this);return this._networkRequestRetryHelper=new c.Base.NetworkRequestRetryHelper(function(){return this._networkProvider.start(a.networkProviderConfiguration,a.credentialProvider,g,this._networkRequestRetryHelper,h,this._failoverPingData)}.bind(this)),this._networkProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),this._networkProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(c.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this.on(c.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,function(a){this._sendKeepAliveResponse(a)}.bind(this)),this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.start(a.networkProviderConfiguration,a.credentialProvider,g,this._networkRequestRetryHelper,h,this._failoverPingData),e.promise()},d.prototype._sendKeepAliveResponse=function(b){b=this._messageBuilder.buildKeepAliveResponse(b.transId),this._networkProvider.send(JSON.stringify(b),a,a,!0)},d.prototype._waitForSocketConnection=function(a,b,c){var d=function(e){e<10?setTimeout(function(){a.isOpened()?b():d(e+1)}.bind(this),100):c("Max retry reached")};d(0)},d.prototype._handleReconnect=function(){var d=this._networkRequestRetryHelper.getRetryCallback();return this._fallbackPromise=c.Base.Utils.connectionBackoffAlgorithm(d,a,this._handleReconnectRetryInterval,this._handleReconnectRetryFactor),this._fallbackPromise.dfdPromise.state()===c.Base.DeferredStates.PENDING?b.Deferred().reject().promise():this._fallbackPromise.dfdPromise},d.prototype.handleAfterReconnect=function(){this._fallbackPromise=a,this.trigger(c.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_AVAILABLE)},d.prototype.stop=function(){this._isStarted=!1,this._removeListeners(),c.Base.Utils.isDefined(this._fallbackPromise)&&this._fallbackPromise.cancel();var a=b.Deferred();return this._networkProvider.onClose=function(){a.resolve()},this._networkProvider.onError=function(b){a.reject(b)},this._networkProvider.close(),a.promise()},c.Providers.UCCP.UCCP1Provider=d}(AvayaClientServices),function(c){"use strict";function d(){c.Providers.UCCP.AbstractUCCPProvider.call(this),this._config=a,this._providers=[],this._selectedProvider=a}(d.prototype=Object.create(c.Providers.UCCP.AbstractUCCPProvider.prototype)).start=function(a,c){return b.isEmptyObject(a)||this._config===a||(this._config=a),this._selectedProvider=this._determineServerVersion(),this._selectedProvider.start(a,c)},d.prototype.stop=function(){return this._selectedProvider?this._selectedProvider.stop():b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.PROVIDER_UNAVAILABLE,"UUCPProvider")).promise()},d.prototype._determineServerVersion=function(){return this._providers[0].provider},d.prototype.getSelectedProvider=function(){return this._selectedProvider},d.prototype.registerUCCPProvider=function(a,b){return this._providers.push({version:a,provider:b})},d.prototype.sendHandshake=function(a){return this._selectedProvider.sendHandshake(a)},d.prototype.subscribeMeetingInfo=function(a){return this._selectedProvider.subscribeMeetingInfo(a)},d.prototype.startRecording=function(a,b,c){return this._selectedProvider.startRecording(a,b,c)},d.prototype.stopRecording=function(a){return this._selectedProvider.stopRecording(a)},d.prototype.pauseRecording=function(a){return this._selectedProvider.pauseRecording(a)},d.prototype.resumeRecording=function(a){return this._selectedProvider.resumeRecording(a)},d.prototype.subscribeRoster=function(a){return this._selectedProvider.subscribeRoster(a)},d.prototype.subscribeActiveTalker=function(a){return this._selectedProvider.subscribeActiveTalker(a)},d.prototype.subscribePermissions=function(a){return this._selectedProvider.subscribePermissions(a)},d.prototype.subscribeSlider=function(a){return this._selectedProvider.subscribeSlider(a)},d.prototype.subscribeMeetingNote=function(a){return this._selectedProvider.subscribeMeetingNote(a)},d.prototype.subscribeWebCollab=function(a){return this._selectedProvider.subscribeWebCollab(a)},d.prototype.subscribeAvailableLayouts=function(a){return this._selectedProvider.subscribeAvailableLayouts(a)},d.prototype.raiseHand=function(a){return this._selectedProvider.raiseHand(a)},d.prototype.setAsLecturer=function(a,b){return this._selectedProvider.setAsLecturer(a,b)},d.prototype.unsetAsLecturer=function(a){return this._selectedProvider.unsetAsLecturer(a)},d.prototype.disconnectParticipant=function(a,b){return this._selectedProvider.disconnectParticipant(a,b)},d.prototype.setLocked=function(a,b){return this._selectedProvider.setLocked(a,b)},d.prototype.setVideoLayout=function(a,b){return this._selectedProvider.setVideoLayout(a,b)},d.prototype.setVideoLayoutSelfSee=function(a,b){return this._selectedProvider.setVideoLayoutSelfSee(a,b)},d.prototype.setVideoLayoutTextOverlay=function(a,b){return this._selectedProvider.setVideoLayoutTextOverlay(a,b)},d.prototype.getCurrentVideoLayout=function(a){return this._selectedProvider.getCurrentVideoLayout(a)},d.prototype.muteUnmute=function(a,b,c,d){return this._selectedProvider.muteUnmute(a,b,c,d)},d.prototype.controlRemoteCamera=function(a,b,c){return this._selectedProvider.controlRemoteCamera(a,b,c)},d.prototype.muteUnmuteAll=function(a,b){return this._selectedProvider.muteUnmuteAll(a,b)},d.prototype.sendLocalMuteEvent=function(a,b,c){return this._selectedProvider.sendLocalMuteEvent(a,b,c)},d.prototype.sendDisconnectEvent=function(a,b){return this._selectedProvider.sendDisconnectEvent(a,b)},d.prototype.terminateConference=function(a){return this._selectedProvider.terminateConference(a)},d.prototype.requestToBecomeModerator=function(a,b){return this._selectedProvider.requestToBecomeModerator(a,b)},d.prototype.signIn=function(a,b){return this._selectedProvider.signIn(a,b)},d.prototype.videoPin=function(a,b,c,d,e,f){return this._selectedProvider.videoPin(a,b,c,d,e,f)},d.prototype.extendMeeting=function(a,b){return this._selectedProvider.extendMeeting(a,b)},d.prototype.addParticipant=function(a,b){return this._selectedProvider.addParticipant(a,b)},d.prototype.cancelDialoutParticipant=function(a,b){return this._selectedProvider.cancelDialoutParticipant(a,b)},d.prototype.sendChatMessage=function(a,b,c){return this._selectedProvider.sendChatMessage(a,b,c)},d.prototype.raiseLowerHand=function(a,b){return this._selectedProvider.raiseLowerHand(a,b)},d.prototype.moderatorLowerHand=function(a,b,c){return this._selectedProvider.moderatorLowerHand(a,b,c)},d.prototype.sendAdmissionRequest=function(a,b){return this._selectedProvider.sendAdmissionRequest(a,b)},d.prototype.moderatorAdmission=function(a,b,c){return this._selectedProvider.moderatorAdmission(a,b,c)},d.prototype.getDialInInfo=function(a){return this._selectedProvider.getDialInInfo(a)},d.prototype.changeParticipantName=function(a,b,c){return this._selectedProvider.changeParticipantName(a,b,c)},c.Providers.UCCP.UCCPProvider=d}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e){a.Providers.Interfaces.CollaborationProvider.call(this),this._networkProvider=b,this._wcsEventsParser=c,this._wcsBinaryParser=d,this._wcsMessageBuilder=e,this._config={}}(b.prototype=Object.create(a.Providers.Interfaces.CollaborationProvider.prototype)).onCredentialsRequired=function(b,c){c&&c!==this._config.credentialProvider&&a.Base.Utils.deepMerge(this._config.credentialProvider,c),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(a){this.onCredentialsRetrieved(a,b)}.bind(this))},b.prototype.onCredentialsRetrieved=function(a,b){},b.prototype.addShape=function(a){},b.prototype.addCircle=function(a){},b.prototype.getParticipants=function(){},b.prototype.discoverResources=function(){},b.prototype.run=function(){},a.Providers.WCS.AbstractWCSProvider=b}(AvayaClientServices),function(c){"use strict";function d(b,d,e,f,g,h,i,j,k){c.Providers.WCS.AbstractWCSProvider.call(this,b,d,e,f),this._meetingId=a,this._wcsContentSharingHandler=g,this._wcsWhiteboardHandler=h,this._wcsSliderHandler=i,this._version="1.1",this._bytesReceivedLastSecond=0,this._notificationsProvider=j,this._resources=a,this._isWhiteboardActive=!1,this._isScreenSharingActive=!1,this._isVideoSharingActive=!1,this._notificationPromise=a,this._discoveryBackoffDataObject=a,this._discoveryConsecutiveFailures=-1,this._binaryProtocolVersion=2,this._isAcksActivated=!0,this._isCometNotificationProvider=!1,this._liveSessionNotFoundCounter=0,this._liveSessionNotFoundCounterComet=0,this._maximumLiveSessionRetries=6,this._permanentlyUnavaliable=!1,this._cometSequencingActive=!1,this._pendingBlocks=[],this._urlSuffixes={comet:{startLiveSession:"/wcsws/Comet/StartLiveSession",endLiveSession:"/wcsws/Comet/EndLiveSession",data:"/wcsws/Comet/Data"}},this._blackListedWords=["username","user_name","token","participant_id","meeting_id","fromname","sender_id","sender_name","sender_username","from"],this._failoverPingData={allowAnyPong:!0,wsKeepAliveEnabled:!0,wsPingInterval:25e3,wsGeneratePingMessage:function(){var a=c.Base.Utils.makeId(32,"0123456789abcdef");return"live_ping?request_id="+(this._failoverPingData.wsPingMessageRequestId=a)+"&ws_connection_id="+this._wsConnectionId}.bind(this),wsIsPongMessage:function(a){var b=c.Base.Utils.queryJSONObject(a,"response[0].live_ping[0]"),d=c.Base.Utils.queryJSONObject(a,"response[0].live_ping[0].request_id[0]._text"),a=c.Base.Utils.queryJSONObject(a,"response[0].live_ping[0].ws_connection_id[0]._text");return c.Base.Utils.isDefined(b)&&this._failoverPingData.wsPingMessageRequestId===d&&this._wsConnectionId===a}.bind(this),wsPingMessageRequestId:"",keepAliveAnswerWaitingTime:2e4},this._isShutdown=!1,this._wsConnectionId="",this._supportedFeatures={},this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.LIBRARY]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.POLLING]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.MINUTES]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.WHITEBOARD]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.MESSAGES]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.REPORTS]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.SCREEN_SHARING]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.SLIDER]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.REMOTE_CONTROL]=!1,this._supportedFeatures[c.Services.Collaboration.FeaturesAvailable.VIDEO_SHARING_CONTROL_MESSAGING]=!0,this._colaborationsAnalyticsService=k,this._serverCapabilities={},this._resourceDiscoveryRetryInterval=1e3,this._resourceDiscoveryRetryFactor=1.2,this._isScreenSharingEnding=!1,this.binaryPromises=[]}(d.prototype=Object.create(c.Providers.WCS.AbstractWCSProvider.prototype)).start=function(c,d){var e=b.Deferred();return this._isShutdown=!1,this._config=c,this._meetingId=d,this._credentials=a,this._participant=a,this._pendingBlocks=[],this._networkProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._networkProvider.onOpen=function(){e.resolve()},this._networkProvider.registerBlackList(this._blackListedWords),this._networkProvider.disableOptionsLogging(!0),this._networkProvider.start(c.networkProviderConfiguration,c.credentialProvider),this._liveSessionNotFoundCounter=0,this._liveSessionNotFoundCounterComet=0,this._cometSequencingActive=!1,e.promise()},d.prototype.stop=function(){var d=b.Deferred();return this._isShutdown=!0,this._discoveryConsecutiveFailures=-1,c.Base.Utils.isDefined(this._discoveryBackoffDataObject)&&(this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=a),this._notificationsProvider.onClose=function(){this._colaborationsAnalyticsService.sendStopEvent(!0),c.Base.Logger.info(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS provider stopped"),d.resolve()}.bind(this),this._notificationsProvider.onError=function(a){this._colaborationsAnalyticsService.sendStopEvent(!1),this._colaborationsAnalyticsService.sendFailureStopEvent(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_STOP_FAILURE),c.Base.Logger.info(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error while stopping WCS provider",a),d.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_STOP_FAILURE,a))}.bind(this),this._notificationsProvider.close(),d.promise()},d.prototype.pause=function(){var a,c=this._wcsMessageBuilder.buildPauseMessage(),d=b.Deferred();return this._isCometNotificationProvider&&(a={urlSuffix:this._getCometDataUrlSuffix()}),this._notificationsProvider.send(c,a),d.resolve(),d.promise()},d.prototype.resume=function(){var a,c=this._wcsMessageBuilder.buildResumeMessage(),d=b.Deferred();return this._isCometNotificationProvider&&(a={urlSuffix:this._getCometDataUrlSuffix()}),this._notificationsProvider.send(c,a),d.resolve(),d.promise()},d.prototype._getFullUrlSuffix=function(a){return this._config.networkProviderConfiguration.restConfig&&this._config.networkProviderConfiguration.restConfig.path?this._config.networkProviderConfiguration.restConfig.path+a:a},d.prototype._getCometDataUrlSuffix=function(){return this._getFullUrlSuffix(this._urlSuffixes.comet.data)},d.prototype._sendLiveSession=function(){var a=Date.now(),b={urlSuffix:this._getFullUrlSuffix(this._urlSuffixes.comet.startLiveSession)},d=c.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789"),d="live_session?token="+this._credentials.token+"&brand="+this._resources.brandId+"&meeting_id="+this._meetingId+"&participant_id="+this._credentials.participantId+"&username="+this._credentials.username+"&last_event_offset=0&local_time="+a+"&ejected=false&session_id="+this._credentials.sessionId+"&remote_control_enabled=false&private_chat_enabled=true&user_agent="+navigator.userAgent+"&client_version=PC;WebCollab;local_version&binary_protocol="+this._binaryProtocolVersion+"&request_id="+d;return this._notificationsProvider.send(d,b)},d.prototype._onCredentialsRequired=function(a,b,d){c.Base.Utils.isUndefined(this._credentials)&&(d&&d!==this._config.credentialProvider&&c.Base.Utils.deepMerge(this._config.credentialProvider,d),this._config.credentialProvider.onAuthenticationChallenge(void 0,function(a){this._onCredentialsRetrieved(a,b)}.bind(this)))},d.prototype._onCredentialsRetrieved=function(a,b){this._credentials=a},d.prototype.observeCollaboration=function(b){this._networkProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(c.Base.Utils.isUndefined(b._isAvailable)||b._isAvailable)&&(b._isAvailable=!1,b._onCollaborationServiceUnavailableCallbacks.fire(b,this._permanentlyUnavaliable))}.bind(this)),this._notificationsProvider.on(c.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(c.Base.Utils.isUndefined(b._isAvailable)||b._isAvailable)&&(b._isAvailable=!1,b._onCollaborationServiceUnavailableCallbacks.fire(b,this._permanentlyUnavaliable))}.bind(this)),this._notificationsProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){!c.Base.Utils.isUndefined(b._isAvailable)&&b._isAvailable||(b._isAvailable=!0,b._onCollaborationServiceAvailableCallbacks.fire(b))}.bind(this)),this._networkProvider.on(c.Base.NetworkProviderEvents.AUTHORIZED,function(){!c.Base.Utils.isUndefined(b._isAvailable)&&b._isAvailable||(b._isAvailable=!0,b._onCollaborationServiceAvailableCallbacks.fire(b))}.bind(this));var d={urlSuffix:this._getCometDataUrlSuffix(),cometSequencing:this._cometSequencingActive};this._notificationsProvider.run(d),this._notificationsProvider.wsConnectionId=this._wsConnectionId,this._notificationsProvider.onMessage=function(d){var e=[];if(d.data instanceof ArrayBuffer)this._updateReceivingBitrate(d.data.byteLength),e.push(this._wcsBinaryParser.parse(d.data));else for(var f=this._wcsEventsParser.parse(d.data),g=f.length,h=0;h<g;h++)e.push(f[h]);for(var i,j,k=e.length,l=0;l<k;l++)this._delegateEvent(e[l],b);b._collaborationService.wasScreenSharingInterrupted()&&(i=b._collaborationService.getInterruptedSharingType(),j=b._collaborationService.getInterruptedSharingStream(),setTimeout(function(){!1===b.getContentSharing().isContentSharingActive()&&!1===this.isWhiteboardActive()&&(i===c.Services.Collaboration.ContentSharingType.ANY_TYPE?b.getContentSharing()._contentSharingService.startScreenSharingAnyType(b.getContentSharing(),j):i===c.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING?b.getContentSharing()._contentSharingService.startSharingApplicationWindow(b.getContentSharing(),a,j):i===c.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING?b.getContentSharing()._contentSharingService.startScreenSharingFullScreen(b.getContentSharing(),a,j):i===c.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&b.getContentSharing()._contentSharingService.restartScreenSharingUsingVideo(b.getContentSharing(),j))}.bind(this)),b._collaborationService._resetInterruptedSharing())}.bind(this)},d.prototype.startDrawShape=function(a,b){var c={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildStartDrawShapeMessage(a,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,c).then(this._getEventIdFromResponse.bind(this))},d.prototype._discoverResourcesFnc=function(){var a=this._wcsMessageBuilder.buildResourceDiscoveryMessage(this._credentials.mode,this._meetingId,this._credentials.participantId,this._credentials.username,this._credentials.token),b={urlSuffix:this._getFullUrlSuffix("/viewer/rest/live_viewer/"),method:"POST"},b=this._networkProvider.send(a,b);return b.fail(function(){this._discoveryConsecutiveFailures++}.bind(this)),b},d.prototype.discoverResources=function(b){return this._discoveryConsecutiveFailures=-1,this._discoveryBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(this._discoverResourcesFnc.bind(this),a,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor),this._discoveryBackoffDataObject.dfdPromise.then(this._parseResources.bind(this)).then(function(){return this._discoveryBackoffDataObject.cancel(),this._discoveryBackoffDataObject=a,this._startNotificationProvider(b)}.bind(this))},d.prototype._parseResources=function(a){return a=this._wcsEventsParser.parse(a),this._resources=a[0].data,this._resources},d.prototype._startNotificationProvider=function(d){var e=b.Deferred();this._notificationPromise||(this._notificationPromise=e),this._isCometNotificationProvider=this._notificationsProvider._communicationAdapter===this._notificationsProvider._fallbackProvider,this._notificationsProvider.onOpen=function(){this._sendLiveSession().done(function(b){if(b){this._discoveryConsecutiveFailures=-1,this._liveSessionNotFoundCounterComet=0,c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].cometSendData")&&(this._cometSequencingActive=!0);var e,f,g,h=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].live_attendee[0].attendee_id[0]._text");h&&(e=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].live_attendee[0].user_name[0]._text"),l=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].live_attendee[0].presenter[0]._text"),f=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].server_time_diff[0]._text"),void 0===(g=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].binary_protocol[0]._text"))||g<this._binaryProtocolVersion?this._isAcksActivated=!1:this._isAcksActivated=!0,this._participant=new c.Services.Collaboration.Participant(h,e),f&&(this._participant._joinTime+=f),this._participant._presenter=l),this._wsConnectionId=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].ws_connection_id[0]._text"),c.Base.Logger.info(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Socket open. wsConnId: "+this._wsConnectionId);for(var i=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].features[0].feature"),j=i.length-1;0<=j;j--){var k=c.Base.Utils.queryJSONObject(i[j],"type[0]._text");c.Base.Utils.isDefined(c.Services.Collaboration.FeaturesAvailable[k])&&(this._supportedFeatures[k]=c.Base.Utils.queryJSONObject(i[j],"enabled[0]._text"))}var l=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].suggested_screensharing_quality[0]._text");l&&d.getContentSharing()._setImageQuality(l),l=c.Base.Utils.queryJSONObject(b,"response[0].live_session[0].max_upload_speed[0]._text"),l&&d.getContentSharing()._setMaxUploadSpeed(l),this._notificationPromise&&(this._notificationPromise.resolve(this._participant),this._notificationPromise=a),d._isAvailable||(d._isAvailable=!0,d.isReceivingSharingPaused()&&d.pause(),(l=(b=d.getSlider()).getSlides()).length&&(b._removeSlides(),b._onSlidesRemovedCallbacks.fire(l)),d._onCollaborationServiceAvailableCallbacks.fire(d))}}.bind(this)).fail(function(a){e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,a)),d._isAvailable&&(d._isAvailable=!1,d._onCollaborationServiceUnavailableCallbacks.fire(d,this._permanentlyUnavaliable))}.bind(this))}.bind(this),this._notificationsProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._notificationsProvider.onClose=function(){this._isShutdown||(d._isAvailable&&(d._isAvailable=!1,d._onCollaborationServiceUnavailableCallbacks.fire(d,this._permanentlyUnavaliable)),this._notificationPromise&&(this._notificationPromise.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED)),this._notificationPromise=a)),c.Base.Logger.info(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Socket was closed. wsConnId: "+this._wsConnectionId)}.bind(this),this._notificationsProvider.onError=function(a){c.Base.Logger.info(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error on socket: ",a),e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,a)),a._data&&404===a._data._status&&(this._liveSessionNotFoundCounterComet++,this._liveSessionNotFoundCounterComet>this._maximumLiveSessionRetries&&this.stopCollaborationAndShutDown()),d._isAvailable&&(d._isAvailable=!1,d._onCollaborationServiceUnavailableCallbacks.fire(d,this._permanentlyUnavaliable))}.bind(this),this._notificationsProvider.onMessage=function(a){var f,g;a.data?(f=b.parseXML(a.data),f=(g=b(f)).find("code").text(),g=g.find("message").text(),f&&(this._discoveryConsecutiveFailures++,c.Base.Logger.error(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS live session response error:",f,g),e.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,g)),"404"===f&&(this._liveSessionNotFoundCounter++,this._liveSessionNotFoundCounter>=this._maximumLiveSessionRetries&&this.stopCollaborationAndShutDown()),d._isAvailable&&(d._isAvailable=!1,d._onCollaborationServiceUnavailableCallbacks.fire(d,this._permanentlyUnavaliable)))):c.Base.Logger.warn(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS sent some events before the live session response:",a,"These events will not be parsed.")}.bind(this),this.stopCollaborationAndShutDown=function(){this._permanentlyUnavaliable=!0,this.stop(),d.stop(),d._onCollaborationServiceUnavailableCallbacks.fire(d,this._permanentlyUnavaliable),c.Base.Logger.error(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"WCS live session reconnect maximum retries has been reached")}.bind(this);var f=new c.Config.ServerInfo(this._config.networkProviderConfiguration.restConfig.hostName,this._config.networkProviderConfiguration.restConfig.port,this._config.networkProviderConfiguration.restConfig.isSecure),g=new c.Config.ServerInfo(this._config.networkProviderConfiguration.restConfig.hostName,this._config.networkProviderConfiguration.restConfig.port,this._config.networkProviderConfiguration.restConfig.isSecure,this._getFullUrlSuffix("/"+this._resources.websocketPath)),h=function(){var e=b.Deferred();if(d._isStopped||this._isShutdown)return e.resolve().promise();d._isAvailable&&(d._isAvailable=!1,d._onCollaborationServiceUnavailableCallbacks.fire(d)),this._discoveryBackoffDataObject&&this._discoveryBackoffDataObject.cancel();var f=-1;return this._isCometNotificationProvider&&(f=++this._discoveryConsecutiveFailures),this._discoveryBackoffDataObject=c.Base.Utils.connectionBackoffAlgorithm(this._discoverResourcesFnc.bind(this),a,this._resourceDiscoveryRetryInterval,this._resourceDiscoveryRetryFactor,f),this._discoveryBackoffDataObject.dfdPromise.then(this._parseResources.bind(this)).then(function(){return this._discoveryBackoffDataObject=a,this._startNotificationProvider(d).then(function(a){d._setSelfParticipant(a),this.observeCollaboration(d),this._recalculateCollaborationCapabilities(d),e.resolve()}.bind(this),function(a){e.reject(a)}.bind(this))}.bind(this)),e.promise()}.bind(this),g=new c.Config.NetworkProviderConfiguration(f,g);return this._notificationsProvider.registerBlackList(this._blackListedWords),this._notificationsProvider.disableOptionsLogging(!0),this._notificationsProvider.start(g,this._config.credentialProvider,a,a,h,this._failoverPingData).fail(function(){this._notificationPromise.reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED)),this._notificationPromise=a}.bind(this)),e.promise()},d.prototype.liveDrawShape=function(a,b){var c,d={urlSuffix:this._getCometDataUrlSuffix()},e=a._getPointsToSend();return e&&e[0]&&e[0].isMove?(c=this._wcsMessageBuilder.buildFirstPointLiveDrawShapeMessage(e[0].point,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),a._markPointsAsSent(1)):(c=this._wcsMessageBuilder.buildLiveDrawShapeMessage(e,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),a._markPointsAsSent(a.getPoints().length)),this._notificationsProvider.send(c,d).then(this._getEventIdFromResponse.bind(this))},d.prototype.endDrawShape=function(a,b){var c={
urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildEndDrawShapeMessage(a,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,c).then(this._getEventIdFromResponse.bind(this))},d.prototype.addShape=function(a,b){var c={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildDrawShapeMessage(a,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,c).then(this._getEventIdFromResponse.bind(this))},d.prototype.moveSelection=function(a,b,c){var d={urlSuffix:this._getCometDataUrlSuffix()},c=this._wcsMessageBuilder.buildMoveSelectionMessage(a,b,c.getX(),c.getY(),this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(c,d).then(this._getEventIdFromResponse.bind(this))},d.prototype._updateReceivingBitrate=function(a){this._bytesReceivedLastSecond+=a,setTimeout(function(){this._bytesReceivedLastSecond-=a}.bind(this),1e3)},d.prototype.getReceivingBitrate=function(){return 8*this._bytesReceivedLastSecond},d.prototype.addCircle=function(a,b){var c={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildDrawCircleMessage(a,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,c).then(this._getEventIdFromResponse.bind(this))},d.prototype.addText=function(a,b){var c={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildDrawTextMessage(a,b,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,c).then(this._getEventIdFromResponse.bind(this))},d.prototype.startScreenSharing=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildStartScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isWhiteboardActive?this.endWhiteboard().then(function(){return this._notificationsProvider.send(b,a)}.bind(this)):this._isVideoSharingActive?this.stopVideoSharing().then(function(){return this._notificationsProvider.send(b,a)}.bind(this)):this._notificationsProvider.send(b,a)},d.prototype.stopScreenSharing=function(){var a,d={urlSuffix:this._getCometDataUrlSuffix()};return this._isScreenSharingActive?(a=this._wcsMessageBuilder.buildStopScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),this._isScreenSharingEnding=!0,this._notificationsProvider.send(a,d)):this._isVideoSharingActive?(a=this._wcsMessageBuilder.buildStopVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName()),this._isVideoSharingEnding=!0,this._notificationsProvider.send(a,d)):b.Deferred().reject(new c.Services.Collaboration.CollaborationError(c.Services.Collaboration.CollaborationErrorReason.SHARING_INACTIVE)).promise()},d.prototype.startVideoSharing=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildStartVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isWhiteboardActive?this.endWhiteboard().then(function(){return this._notificationsProvider.send(b,a)}.bind(this)):this._isScreenSharingActive?this.stopScreenSharing().then(function(){return this._notificationsProvider.send(b,a)}.bind(this)):this._notificationsProvider.send(b,a)},d.prototype.stopVideoSharing=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildStopVideoSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._isVideoSharingEnding=!0,this._notificationsProvider.send(b,a)},d.prototype.pauseScreenSharing=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildPauseScreenSharingMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,a)},d.prototype.sendLiveEvent=function(a){var b={urlSuffix:this._getCometDataUrlSuffix()},a=this._wcsMessageBuilder.buildLiveEventMessage(a,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(a,b)},d.prototype.sendBlocks=function(a,c){var d={urlSuffix:this._getCometDataUrlSuffix()};if(this._isScreenSharingActive){if(this._isCometNotificationProvider||!this._isAcksActivated)return this._notificationsProvider.send(a,d);var e=b.Deferred();return this.binaryPromises[c]=e,this._notificationsProvider.send(a,d),e}return e={},c?(e.message=a,e.messageId=c):e.message=a,this._pendingBlocks.push(e),b.Deferred().resolve().promise()},d.prototype.getBufferedAmount=function(){return this._notificationsProvider.getBufferedAmount()},d.prototype.startWhiteboard=function(a){var b={urlSuffix:this._getCometDataUrlSuffix()},c=this._wcsMessageBuilder.buildStartWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName(),a);return this._isScreenSharingActive?this.stopScreenSharing().then(function(){return this._notificationsProvider.send(c,b)}.bind(this)):this._isVideoSharingActive?this.stopVideoSharing().then(function(){return this._notificationsProvider.send(c,b)}.bind(this)):this._notificationsProvider.send(c,b)},d.prototype.endWhiteboard=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildEndWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,a)},d.prototype.addWhiteboardSurface=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildAddWhiteboardMessage(this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(b,a)},d.prototype.removeWhiteboardSurface=function(a){var b={urlSuffix:this._getCometDataUrlSuffix()},a=this._wcsMessageBuilder.buildRemoveWhiteboardMessage(a,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(a,b)},d.prototype.removeShape=function(a,b,c){var d={urlSuffix:this._getCometDataUrlSuffix()},c=this._wcsMessageBuilder.buildDeleteSelectionMessage(a,b,c.getX(),c.getY(),this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(c,d)},d.prototype.clearContent=function(a){var b={urlSuffix:this._getCometDataUrlSuffix()},a=this._wcsMessageBuilder.buildClearContentMessage(a,this._meetingId,this._participant.getParticipantId(),this._participant.getDisplayName());return this._notificationsProvider.send(a,b)},d.prototype.getParticipants=function(){var a={urlSuffix:this._getCometDataUrlSuffix()},b=this._wcsMessageBuilder.buildGetParticipantsMessage(!1);return this._notificationsProvider.send(b,a).then(function(a){for(var b=[],d=this._wcsEventsParser.parse(a),e=0;e<d[0].data.liveAttendees.length;e++){var f=c.Base.Utils.queryJSONObject(d[0],"data.liveAttendees["+e+"].attendeeId"),g=c.Base.Utils.queryJSONObject(d[0],"data.liveAttendees["+e+"].userName");b.push(new c.Services.Collaboration.Participant(f,g))}return b}.bind(this))},d.prototype.updateMaxDownload=function(a){var b={urlSuffix:this._getCometDataUrlSuffix()},a=this._wcsMessageBuilder.buildMaxDownloadMessage(a);return this._notificationsProvider.send(a,b)},d.prototype.isOpened=function(){return this._notificationsProvider.isOpened()},d.prototype.isFeatureAvailable=function(a){return this._supportedFeatures[a]||!1},d.prototype.isWhiteboardActive=function(){return this._isWhiteboardActive},d.prototype._delegateEvent=function(a,b){var d;if(!c.Base.Utils.isUndefined(a)&&!c.Base.Utils.isUndefined(a.type))switch(a.type){case c.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG:this._wcsContentSharingHandler.updateCursor(b,a);break;case c.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:case c.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:case c.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:this._wcsContentSharingHandler.updateFrame(b,a);break;case c.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG:this.binaryPromises[a.messageId].resolve();break;case c.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING:d=this._wcsWhiteboardHandler._getParticipant(b,a),this._isWhiteboardActive&&(this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(b,a)),this._isVideoSharingActive&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharingByParticipant(b,d)),!this._isScreenSharingActive||d.isLocalUser()||b._contentSharing._isPaused||this._wcsContentSharingHandler.endScreenSharingByParticipant(b,d),this._isScreenSharingActive=!0,this._isScreenSharingEnding=!1,d&&this._participant&&d.getParticipantId()===this._participant.getParticipantId()&&this._sendPendingBlocks(),this._wcsContentSharingHandler.startScreenSharing(b,a);break;case c.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING:this._wcsContentSharingHandler.pauseScreenSharing(b,a);break;case c.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING:this._isScreenSharingActive&&(this._isScreenSharingEnding||a.from!==b._selfParticipant._participantId&&!a.isServerInitiated())&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharing(b,a));break;case c.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING:d=this._wcsWhiteboardHandler._getParticipant(b,a),this._isWhiteboardActive&&(this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(b,a)),this._isScreenSharingActive&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharingByParticipant(b,d)),this._isVideoSharingActive&&!d.isLocalUser()&&this._wcsContentSharingHandler.endVideoSharingByParticipant(b,d),this._isVideoSharingActive=!0,this._isVideoSharingEnding=!1,this._wcsContentSharingHandler.startVideoSharing(b,a);break;case c.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING:this._isVideoSharingActive&&(this._isVideoSharingEnding||a.from!==b._selfParticipant._participantId&&!a.isServerInitiated())&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharing(b,a));break;case c.Providers.WCS.WCSEventTypes.FRAME_REPORT:this._wcsContentSharingHandler.frameReport(b,a);break;case c.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES:this._serverCapabilities=a.data,this.trigger(c.Providers.Interfaces.CollaborationProviderCallbackIds.SERVER_CAPABILITIES,[a.data]);break;case c.Providers.WCS.WCSEventTypes.START_WHITEBOARD:d=this._wcsWhiteboardHandler._getParticipant(b,a),this._isScreenSharingActive&&(this._isScreenSharingActive=!1,this._wcsContentSharingHandler.endScreenSharingByParticipant(b,d)),this._isVideoSharingActive&&(this._isVideoSharingActive=!1,this._wcsContentSharingHandler.endVideoSharingByParticipant(b,d)),this._isWhiteboardActive=!0,this._wcsWhiteboardHandler.startWhiteboard(b,a);break;case c.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD:this._wcsWhiteboardHandler.addWhiteboard(b,a);break;case c.Providers.WCS.WCSEventTypes.END_WHITEBOARD:this._isWhiteboardActive=!1,this._wcsWhiteboardHandler.endWhiteboard(b,a);break;case c.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD:this._wcsWhiteboardHandler.deleteWhiteboard(b,a);break;case c.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE:this._wcsWhiteboardHandler.startDrawShape(b,a);break;case c.Providers.WCS.WCSEventTypes.DRAW_SHAPE:this._wcsWhiteboardHandler.drawShape(b,a);break;case c.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE:this._wcsWhiteboardHandler.endDrawShape(b,a);break;case c.Providers.WCS.WCSEventTypes.DRAW_CIRCLE:this._wcsWhiteboardHandler.drawCircle(b,a);break;case c.Providers.WCS.WCSEventTypes.MOVE_SELECTION:this._wcsWhiteboardHandler.moveSelection(b,a);break;case c.Providers.WCS.WCSEventTypes.DRAW_TEXT:this._wcsWhiteboardHandler.drawText(b,a);break;case c.Providers.WCS.WCSEventTypes.DELETE_SELECTION:this._wcsWhiteboardHandler.deleteSelection(b,a);break;case c.Providers.WCS.WCSEventTypes.CLEAR_DRAWING:this._wcsWhiteboardHandler.clearDrawing(b,a);break;case c.Providers.WCS.WCSEventTypes.SLIDER_SLIDE:this._wcsSliderHandler.handleSliderSlide(b,a);break;case c.Providers.WCS.WCSEventTypes.SLIDER_EMPTY:this._wcsSliderHandler.handleSliderEmpty(b,a);break;case c.Providers.WCS.WCSEventTypes.END_MEETING:b._onCollaborationEndedCallbacks.fire(b),this._isShutdown||b.stop();break;case c.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT:a.data.targetId&&b._selfParticipant&&a.data.targetId===b._selfParticipant._participantId&&a.data.time>=b._selfParticipant._joinTime&&(b._onCollaborationNearEndByEjectCallbacks.fire(b),this._isShutdown||b.stop());break;case c.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING:a.data.targetId&&b._selfParticipant&&a.data.targetId===b._selfParticipant._participantId&&(b._selfParticipant._presenter=!0,this._recalculateCollaborationCapabilities(b));break;case c.Providers.WCS.WCSEventTypes.DENY_PRESENTING:a.data.targetId&&b._selfParticipant&&a.data.targetId===b._selfParticipant._participantId&&(b._selfParticipant._presenter=!1,this._recalculateCollaborationCapabilities(b));break;default:c.Base.Logger.warn(c.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown event type received: {0}",a.type)}},d.prototype._recalculateCollaborationCapabilities=function(a){a.getContentSharing()._recalculateShareApplicationWindowCapability(a),a.getContentSharing()._recalculateShareFullScreenCapability(a),a.getContentSharing()._recalculateShareAnyTypeCapability(a),a.getContentSharing()._recalculateShareContentVideoCapability(a),a._recalculateContentSharingCapability(a),a._recalculateWhiteboardCapability(a),a.getWhiteboard()._recalculateAddWhiteboardCapability(a),a.getWhiteboard()._recalculateRemoveWhiteboardCapability(a)},d.prototype._getEventIdFromResponse=function(a){return this._isCometNotificationProvider?a:c.Base.Utils.queryJSONObject(a,"response[0].live_event[0].event_id[0]._text")},d.prototype.getServerCapabilities=function(){return this._serverCapabilities},d.prototype._sendPendingBlocks=function(){for(var a=0;a<this._pendingBlocks.length;a++){var b=this._pendingBlocks[a];b.messageId?this.sendBlocks(b.message,b.messageId):this.sendBlocks(b.message)}this._pendingBlocks=[]},d.prototype.getAcksActivated=function(){return this._isAcksActivated},c.Providers.WCS.WCSv1_1Provider=d}(AvayaClientServices),function(a,b){"use strict";function c(){a.Base.TransactionalWebSocketProvider.apply(this,[a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER]),this._transactionIDLocation="request_id"}(c.prototype=Object.create(a.Base.TransactionalWebSocketProvider.prototype)).getTransactionIDFromRequest=function(a,b){return!(void 0===a||a instanceof ArrayBuffer||a instanceof Blob)&&a.match(b+"=(\\w*)&?")[1]},c.prototype.getTransactionIDFromResponse=function(a,b){if(void 0===a)return!1;var c=this._getTransactionID(a,"response[0].live_session[0].request_id[0]._text"),d=this._getTransactionID(a,"response[0].live_event[0].request_id[0]._text"),e=this._getTransactionID(a,"response[0].live_attendees[0].request_id[0]._text"),a=this._getTransactionID(a,"response[0].live_ping[0].request_id[0]._text");return d||c||e||a},c.prototype.parseRequest=function(a){return a},c.prototype.parseResponse=function(a){return b.parseString(a)},a.Providers.WCS.WCSTransactionalWebSocketProvider=c}(AvayaClientServices,xmlToJSON),function(c){"use strict";function d(b,d,e,f){this._id=c.Base.Utils.makeId(10,"0123456789"),this._color=e,this._width=f,this._translation=a,this._status=c.Services.Collaboration.SelectionStatus.PENDING,this._isMine=d,this._ownerDisplayName=b,this._finished=!1}d.prototype={getId:function(){return this._id},setId:function(a){this._id=a},getColor:function(){return this._color},getWidth:function(){return this._width},getOwnerDisplayName:function(){return this._ownerDisplayName},getTranslation:function(){return this._translation},setTranslation:function(a){this._translation=a},getStatus:function(){return this._status},isMine:function(){return this._isMine},isFinished:function(){return this._finished},finishDrawing:function(){return this._finished=!0,b.when(this._finished)}},c.Base.AOPTools.addAdvices(d,"AbstractShape",["finishDrawing"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.AbstractShape=d}(AvayaClientServices),function(a){"use strict";function b(b,c,d,e,f,g,h,i){a.Services.Collaboration.AbstractShape.call(this,d,f,g,i),this._topLeft=b,this._bottomRight=c,this._filled=e||!1,this._alpha=h||100}(b.prototype=Object.create(a.Services.Collaboration.AbstractShape.prototype)).getTopLeft=function(){return this._topLeft},b.prototype.setTopLeft=function(a){this._topLeft=a},b.prototype.getBottomRight=function(){return this._bottomRight},b.prototype.setBottomRight=function(a){this._bottomRight=a},b.prototype.isFilled=function(){return this._filled},b.prototype.getAlpha=function(){return this._alpha},a.Services.Collaboration.Circle=b}(AvayaClientServices),function(c){"use strict";function d(d,e,f,g,h,i){c.Services.Collaboration.AbstractShape.call(this,d,f,g,i),this._filled=e||!1,this._finished=!1,this._sentPointsPos=0,this._points=[],this._alpha=h||100,this._onShapeFinished=a,this._readyToSendCallbacks=b.Callbacks(),this._throttlingInterval=100}(d.prototype=Object.create(c.Services.Collaboration.AbstractShape.prototype))._addPoint=function(a,b){var c=(new Date).getTime();this._points.push({isMove:a,point:b,_timestamp:c}),(0===this._getSentPointsCount()||c-this._points[this._getSentPointsCount()-1]._timestamp>this._throttlingInterval)&&this._readyToSendCallbacks.fire()},d.prototype.addMovePoint=function(a){this._addPoint(!0,a)},d.prototype.addLinePoint=function(a){this._addPoint(!1,a)},d.prototype.finishDrawing=function(){return this._finished=!0,c.Base.Utils.isDefined(this._onShapeFinished)?this._onShapeFinished():b.when(this._finished)},d.prototype.getPoints=function(){return this._points},d.prototype.updatePoints=function(a){for(var b=0;b<a.length;b++)this._points.push(a[b])},d.prototype.isFilled=function(){return this._filled},d.prototype.setFilled=function(a){this._filled=a},d.prototype._hasPointsToSend=function(){return this._sentPointsPos!==this._points.length},d.prototype._getPointsToSend=function(){return this._points.slice(this._sentPointsPos)},d.prototype._markPointsAsSent=function(a){this._sentPointsPos=a},d.prototype._getSentPointsCount=function(){return this._sentPointsPos},d.prototype.getAlpha=function(){return this._alpha},c.Base.AOPTools.addAdvices(d,"Shape",["addMovePoint","updatePoints"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Shape",["finishDrawing"],[c.Base.AOPCommonAdvices.LOG_COLLABORATION_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_COLLABORATION_ERROR]),c.Services.Collaboration.Shape=d}(AvayaClientServices),function(b){"use strict";function c(c,d,e,f,g,h,i){b.Services.Collaboration.AbstractShape.call(this,e,g,h,i),this._content=c,this._filled=f||!1,this._fontSize=d,this._position=a}(c.prototype=Object.create(b.Services.Collaboration.AbstractShape.prototype)).getPosition=function(){return this._position},c.prototype.setPosition=function(a){this._position=a},c.prototype.getContent=function(){return this._content},c.prototype.getFontSize=function(){return this._fontSize},b.Services.Collaboration.WhiteboardText=c}(AvayaClientServices),function(c){"use strict";function d(d,e){c.Services.Conference.Participant.call(this,d,e),this._participantURI="",this._remoteDisplayName="",this._applicationActive=!1,this._handRaised=!1,this._presenter=!1,this._lecturer=!1,this._audioStatus=c.Services.Conference.ParticipantMediaState.MEDIA_STATUS_NO_MEDIA,this._videoStatus=c.Services.Conference.ParticipantMediaState.MEDIA_STATUS_NO_MEDIA,this._connectionStatus=c.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_UNKNOWN,this._disconnectionReason=a,this._audioId=a,this._videoId=a,this._lastSpokenTime=a,this._joinTime=a,this._lastSpokenTime=a,this._leaveTimeStamp=a,this._audioFromParticipant="",this._audioToParticipant="",this._userId="",this._sourceID="",this._feccRecvSupport=!1,this._videoFromParticipant="",this._videoToParticipant="",this._contentFromParticipant="",this._contentToParticipant="",this._canLecture=!1,this._role="",this._isVideoBlocked=!1,this._isAudioMuted=!1,this._isSelfParticipant=!1,this._wasPreviouslyNotVisibleInParticipantList=!1,this._status="",this._isConferenceOwner=!1,this._onParticipantCollaborationStatusChangedCallbacks=b.Callbacks(),this._onParticipantConnectionStatusChangedCallbacks=b.Callbacks(),this._onParticipantSetAsModeratorCallbacks=b.Callbacks(),this._onParticipantUnsetAsModeratorCallbacks=b.Callbacks(),this._onParticipantSetAsLecturerCallbacks=b.Callbacks(),this._onParticipantUnsetAsLecturerCallbacks=b.Callbacks(),this._onParticipantSetAsPresenterCallbacks=b.Callbacks(),this._onParticipantUnsetAsPresenterCallbacks=b.Callbacks(),this._onParticipantAudioStatusChangedCallbacks=b.Callbacks(),this._onParticipantVideoStatusChangedCallbacks=b.Callbacks(),this._onParticipantActiveTalkerStatusChangedCallbacks=b.Callbacks(),this._onParticipantHandRaisedCallbacks=b.Callbacks(),this._onParticipantHandLoweredCallbacks=b.Callbacks(),this._onParticipantDisplayNameChangedCallbacks=b.Callbacks(),this._onParticipantNameChangedCallbacks=b.Callbacks()}(d.prototype=Object.create(c.Services.Conference.Participant.prototype)).controlRemoteCamera=function(a){for(var d in c.Services.Conference.CameraControl)if(c.Services.Conference.CameraControl.hasOwnProperty(d)&&a===c.Services.Conference.CameraControl[d])return this._participantService.controlRemoteCamera(this,a);return b.Deferred().reject(new c.Services.Conference.ConferenceException(c.Services.Conference.ConferenceError.INVALID_ARGUMENT))},d.prototype.mute=function(){return this._participantService.mute(this)},d.prototype.unmute=function(){return this._participantService.unmute(this)},d.prototype.blockVideo=function(){return this._participantService.blockVideo(this)},d.prototype.unblockVideo=function(){return this._participantService.unblockVideo(this)},d.prototype.lowerHand=function(a){return this._participantService.lowerHand(this,a)},d.prototype.setAsLecturer=function(){return this._participantService.setAsLecturer(this)},d.prototype.unsetAsLecturer=function(){return this._participantService.unsetAsLecturer()},d.prototype.isHandRaised=function(){return this._handRaised},d.prototype.getJoinTime=function(){return this._joinTime},d.prototype.getLastSpokenTime=function(){return this._lastSpokenTime},d.prototype.isVideoBlocked=function(){return this._isVideoBlocked},d.prototype.isAudioMuted=function(){return this._isAudioMuted},d.prototype.isModerator=function(){return this._role===c.Services.Conference.ParticipantRole.MODERATOR},d.prototype.isRestrictedParticipant=function(){return this._role===c.Services.Conference.ParticipantRole.RESTRICTED_PARTICIPANT},d.prototype.wasPreviouslyNotVisibleInParticipantList=function(){return this._wasPreviouslyNotVisibleInParticipantList},d.prototype.getParticipantAudioStatus=function(){return this._audioFromParticipant},d.prototype.getParticipantVideoStatus=function(){return this._videoFromParticipant},d.prototype.isLecturer=function(){return this._lecturer},d.prototype.isPresenter=function(){return this._presenter},d.prototype.getFeccRecvSupport=function(){return this._feccRecvSupport},d.prototype.getContentToParticipant=function(){return this._contentToParticipant},d.prototype.getContentFromParticipant=function(){return this._contentFromParticipant},d.prototype.getParticipantConnectionStatus=function(){return this._connectionStatus},d.prototype.getRole=function(){return this._role},d.prototype.isConferenceOwner=function(){return this._isConferenceOwner},d.prototype.changeParticipantName=function(a){return this._participantService.changeParticipantName(this,a)},c.Base.AOPTools.addAdvices(d,"ActiveParticipant",["controlRemoteCamera","mute","unmute","blockVideo","unblockVideo","lowerHand","setAsLecturer","unsetAsLecturer"],[c.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),c.Services.Conference.ActiveParticipant=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Conference.ActiveParticipant.prototype,{addOnParticipantCollaborationStatusChangedCallback:function(a){this._onParticipantCollaborationStatusChangedCallbacks.add(a)},removeOnParticipantCollaborationStatusChangedCallback:function(a){this._onParticipantCollaborationStatusChangedCallbacks.remove(a)},addOnParticipantStatusChangedCallback:function(a){this._onParticipantStatusChangedCallbacks.add(a)},removeOnParticipantStatusChangedCallback:function(a){this._onParticipantStatusChangedCallbacks.remove(a)},addOnParticipantConnectionStatusChangedCallback:function(a){this._onParticipantConnectionStatusChangedCallbacks.add(a)},removeOnParticipantConnectionStatusChangedCallback:function(a){this._onParticipantConnectionStatusChangedCallbacks.remove(a)},addOnParticipantSetAsModeratorCallback:function(a){this._onParticipantSetAsModeratorCallbacks.add(a)},removeOnParticipantSetAsModeratorCallback:function(a){this._onParticipantSetAsModeratorCallbacks.remove(a)},addOnParticipantUnsetAsModeratorCallback:function(a){this._onParticipantUnsetAsModeratorCallbacks.add(a)},removeOnParticipantUnsetAsModeratorCallback:function(a){this._onParticipantUnsetAsModeratorCallbacks.remove(a)},addOnParticipantSetAsLecturerCallback:function(a){this._onParticipantSetAsLecturerCallbacks.add(a)},removeOnParticipantSetAsLecturerCallback:function(a){this._onParticipantSetAsLecturerCallbacks.remove(a)},addOnParticipantUnsetAsLecturerCallback:function(a){this._onParticipantUnsetAsLecturerCallbacks.add(a)},removeOnParticipantUnsetAsLecturerCallback:function(a){this._onParticipantUnsetAsLecturerCallbacks.remove(a)},addOnParticipantSetAsPresenterCallback:function(a){this._onParticipantSetAsPresenterCallbacks.add(a)},removeOnParticipantSetAsPresenterCallback:function(a){this._onParticipantSetAsPresenterCallbacks.remove(a)},addOnParticipantUnsetAsPresenterCallback:function(a){this._onParticipantUnsetAsPresenterCallbacks.add(a)},removeOnParticipantUnsetAsPresenterCallback:function(a){this._onParticipantUnsetAsPresenterCallbacks.remove(a)},addOnParticipantAudioStatusChangedCallback:function(a){this._onParticipantAudioStatusChangedCallbacks.add(a)},removeOnParticipantAudioStatusChangedCallback:function(a){this._onParticipantAudioStatusChangedCallbacks.remove(a)},addOnParticipantVideoStatusChangedCallback:function(a){this._onParticipantVideoStatusChangedCallbacks.add(a)},removeOnParticipantVideoStatusChangedCallback:function(a){this._onParticipantVideoStatusChangedCallbacks.remove(a)},addOnParticipantActiveTalkerStatusChangedCallback:function(a){this._onParticipantActiveTalkerStatusChangedCallbacks.add(a)},removeOnParticipantActiveTalkerStatusChangedCallback:function(a){this._onParticipantActiveTalkerStatusChangedCallbacks.remove(a)},addOnParticipantHandRaisedCallback:function(a){this._onParticipantHandRaisedCallbacks.add(a)},removeOnParticipantHandRaisedCallback:function(a){this._onParticipantHandRaisedCallbacks.remove(a)},addOnParticipantHandLoweredCallback:function(a){this._onParticipantHandLoweredCallbacks.add(a)},removeOnParticipantHandLoweredCallback:function(a){this._onParticipantHandLoweredCallbacks.remove(a)},addOnParticipantDisplayNameChangedCallback:function(a){this._onParticipantDisplayNameChangedCallbacks.add(a)},removeOnParticipantDisplayNameChangedCallback:function(a){this._onParticipantDisplayNameChangedCallbacks.remove(a)},addOnParticipantNameChangedCallback:function(a){this._onParticipantNameChangedCallbacks.add(a)},removeOnParticipantNameChangedCallback:function(a){this._onParticipantNameChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";function b(b,c){a.Services.Conference.Participant.call(this,b,c)}(b.prototype=Object.create(a.Services.Conference.Participant.prototype)).reinvite=function(){},a.Base.AOPTools.addAdvices(b,"DroppedParticipant",["reinvite"],[a.Base.AOPCommonAdvices.LOG_CONFERENCE_API_CALLS,a.Base.AOPCommonAdvices.WRAP_CAUGHT_CONFERENCE_ERROR]),a.Services.Conference.DroppedParticipant=b}(AvayaClientServices),function(c){"use strict";function d(d,e){this._escalationService=e,this.type=c.Services.Messaging.MessageType.SESSION,this.sessionType=a,this.participants=new c.Base.DataSet,this.extensions={},this._resourceStatus=c.Services.Messaging.ResourceStatus.DRAFT_UNSENT,c.Base.Utils.isDefined(d)&&(this.type=d.type,this.sessionType=d.sessionType,this.extensions=d.extensions,this.conversation=d.conversation),this._onTypeChangedCallbacks=b.Callbacks(),this._onStatusChangedCallbacks=b.Callbacks(),this._onSessionTypeChangedSuccessCallbacks=b.Callbacks(),this._onSessionTypeChangedFailedCallbacks=b.Callbacks(),this._onStartSuccessCallbacks=b.Callbacks(),this._onStartFailedCallbacks=b.Callbacks(),this._onMessagingEscalationCapabilitiesChangedCallbacks=b.Callbacks(),this._sendCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._addParticipantsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeParticipantsCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateSessionTypeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._removeCapability=new c.Base.Capability(c.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),e._recalculateAllEscalationCapabilities(this)}d.prototype={getStatus:function(){return this._resourceStatus},getSessionType:function(){return this.sessionType},getConversation:function(){return this.conversation},setSessionType:function(a){var b,d=!1;for(b in c.Services.Messaging.SessionType)if(c.Services.Messaging.SessionType.hasOwnProperty(b)&&a===c.Services.Messaging.SessionType[b]){this._escalationService.setSessionType(this,a),d=!0;break}return d},addParticipants:function(a){this._escalationService.addParticipants(this,a)},removeParticipants:function(a){this._escalationService.removeParticipants(this,a)},getParticipants:function(){return this.participants},send:function(){return this._escalationService.start(this)},_setStatus:function(a){if(!c.Base.Utils.isDefined(c.Services.Messaging.ResourceStatus[a]))throw new Error("Unknown ResourceStatus");this._resourceStatus=a,this._onStatusChangedCallbacks.fire(this,a)}},c.Base.AOPTools.addAdvices(d,"Escalation",["addParticipants","removeParticipants"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS]),c.Base.AOPTools.addAdvices(d,"Escalation",["send"],[c.Base.AOPCommonAdvices.LOG_MESSAGING_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_MESSAGING_ERROR]),c.Services.Messaging.Escalation=d}(AvayaClientServices),function(a){"use strict";b.extend(a.Services.Messaging.Escalation.prototype,{addOnSessionTypeChangedCallback:function(a){this._onTypeChangedCallbacks.add(a)},removeOnSessionTypeChangedCallback:function(a){this._onTypeChangedCallbacks.remove(a)},addOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.add(a)},removeOnStatusChangedCallback:function(a){this._onStatusChangedCallbacks.remove(a)}})}(AvayaClientServices),function(a){"use strict";var c={getSendCapability:function(){return this._sendCapability},_recalculateStartCapability:function(){var b,c=this._escalationService.isServiceAvailable()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._sendCapability._updateIfChanged(b,c)},getAddParticipantsCapability:function(){return this._addParticipantsCapability},_recalculateAddParticipantsCapability:function(){var b,c=this._escalationService.isServiceAvailable()?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,
a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._addParticipantsCapability._updateIfChanged(b,c)},getRemoveParticipantsCapability:function(){return this._removeParticipantsCapability},_recalculateRemoveParticipantsCapability:function(){var b,c=this._escalationService.isServiceAvailable()&&this._resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeParticipantsCapability._updateIfChanged(b,c)},getUpdateSessionTypeCapability:function(){return this._updateSessionTypeCapability},_recalculateUpdateSessionTypeCapability:function(){var b,c=this._escalationService.isServiceAvailable()&&this._resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._updateSessionTypeCapability._updateIfChanged(b,c)},getRemoveCapability:function(){return this._removeCapability},_recalculateRemoveCapability:function(){var b,c=this._escalationService.isServiceAvailable()&&this._resourceStatus===a.Services.Messaging.ResourceStatus.DRAFT_UNSENT?(b=!0,a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(b=!1,a.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE);this._removeCapability._updateIfChanged(b,c)}};b.extend(a.Services.Messaging.Escalation.prototype,c)}(AvayaClientServices),function(c){"use strict";function d(a,b,d,e){c.Providers.AMM.AMM3Provider.call(this,a,b,d,e),this._resourcesTypes.addressesToValidate="application/vnd.avaya.aem.addressesToValidate.v1+json",this._resourcesTypes.conversationsFilter="application/vnd.avaya.aem.conversationsFilter.v1+json"}(d.prototype=Object.create(c.Providers.AMM.AMM3Provider.prototype))._discoverResources=function(a){return b.Deferred(function(b){return c.Providers.AMM.AMM3Provider.prototype._discoverResources.call(this,a).then(function(a){this._isProviderSupported(a)?b.resolve(a):(a=new c.Base.BaseError("API in not supported, try different provider"),b.reject(a))}.bind(this),b.reject)}.bind(this))},d.prototype._isProviderSupported=function(a){var b=c.Base.Utils.queryJSONObject(a,"conversationsResource.requestTypes"),b=c.Base.Utils.isDefined(b)&&c.Base.Utils.includes(this._resourcesTypes.conversationsFilter,b),a=c.Base.Utils.queryJSONObject(a,"services.validateAddresses.requestTypes"),a=c.Base.Utils.isDefined(a)&&c.Base.Utils.includes(this._resourcesTypes.addressesToValidate,a);return b&&a},d.prototype.validateUsers=function(a){var b=JSON.stringify({addresses:a.map(function(a){return{address:a}})}),a=this._buildValidateUsersRequestOptions();return this._networkProvider.send(b,a).then(this._onValidateUsersRequestSent.bind(this),this._handleError.bind(this))},d.prototype._buildValidateUsersRequestOptions=function(){var a=c.Providers.AMM.AbstractAMMProvider.prototype._buildValidateUsersRequestOptions.call(this);return a.sendType="POST",a.headers["Content-Type"]=this._resourcesTypes.addressesToValidate,a},d.prototype.getConversations=function(a){var b=JSON.stringify({}),a=this._buildGetConversationsRequestOptions(a);return this._networkProvider.send(b,a).then(this._onGetConversationsRequestSent.bind(this),this._handleError.bind(this))},d.prototype._buildGetConversationsRequestOptions=function(a){return a=c.Providers.AMM.AMM3Provider.prototype._buildGetConversationsRequestOptions.call(this,a),a.sendType="POST",a.headers["Content-Type"]=this._resourcesTypes.conversationsFilter,a},d.prototype._getConversationsByIds=function(a,b){return a=JSON.stringify({ids:a.map(function(a){return{id:a}})}),this._networkProvider.send(a,b).then(this._onGetConversationsByQueryRequestSent.bind(this),this._handleError.bind(this))},d.prototype._getConversationsByQuery=function(b,d){var e={searchString:b.q,searchSubject:b.subject,searchParticipants:b.participants,searchBody:b.body};return b.after!==a&&(e.searchAfterDate=b.after),e=JSON.stringify(e),c.Providers.AMM.AMM3Provider.prototype._getConversationsByQuery.call(this,e,d)},c.Providers.AMM.AMM3_2Provider=d}(AvayaClientServices),function(a){"use strict";var b=a.Base.Utils,c=a.Providers.Analytics.AnalyticsStatistic,d="ec",e="ea",f="el",g="ev";a.Providers.Analytics.AnalyticsEventStatistic={send:function(a,b,d,e,f){var g;c.isCollectionEnabled()&&(g=this._getEventParams.apply(this,arguments),c.addHit(g))},_getEventParams:function(a,h,i,j,k){var l=c.addHitTypeParameter("event"),m=[[d,a],[e,h]];i&&m.push([f,i]),b.isInteger(j)&&m.push([g,j]);for(var n=0;n<m.length;n++)l+=c.addURIParam(m[n][0],m[n][1]);return l+=c.addCustomDimensionsParameters(k)}}}(AvayaClientServices),function(b){"use strict";function c(){this._category=a,this._customDimensions=a,this._init()}var d=b.Providers.Analytics.AnalyticsEventStatistic,e=b.Providers.Analytics.AnalyticsTimingStatistic;c.prototype._init=function(){this._category=this._createCategory(),this._customDimensions=this._createCustomDimensions()},c.prototype.sendTiming=function(a,b,c,d){if((d=!!d)&&!this._customDimensions)throw"Provider type is not set";d=d?this._customDimensions:{},e.send(this._category,a,c,b,d)},c.prototype.sendEvent=function(a,b,c,e){if(!this._category)throw"The category is not set";if(e&&!this._customDimensions)throw"Provider type is not set";e=e?this._customDimensions:{},d.send(this._category,a,b,c,e)},c.prototype._createCategory=function(){throw"You must create a category using the method _createCategory"},c.prototype._createCustomDimensions=function(){return{}},c.prototype.startTimingMetric=function(){return new Date},b.Services.Analytics.AnalyticsService=c}(AvayaClientServices),function(b){"use strict";function c(){b.Services.Analytics.AnalyticsService.call(this),this._callMediaTypes={AUDIO:1,VIDEO:0}}var d="Audio",e="Conference",f="Duration",g="Dropped",h="Error",i="Failure",j="Incoming",k="Media Types",l="Outgoing",m="P2P",n="Preservation",o="Service Unavailable",p="Start Type",q="Success (call continued)",r="Success (call ended)",s="Video",t=b.Providers.Analytics.AnalyticsStatistic,u=b.Providers.Analytics.AnalyticsCategories,v=b.Providers.Analytics.AnalyticsCustomDimensions,w=b.Providers.Analytics.AnalyticsProvidersTypes;(c.prototype=Object.create(b.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return u.CALLS},c.prototype._createCustomDimensions=function(){var a={};return a[v.PROVIDER_TYPE]=w.CALLS,a},c.prototype.sendCallInfo=function(a,b){var c=a?j:l,a=d;a+=b?"+"+s:"",this.sendEvent(c,a,null,!0)},c.prototype.callTimeEnd=function(a){var b;a&&(b=new Date-a,a=t.getCallDurationLabel(b),this.sendTiming(f,a,b,!0))},c.prototype.setCallMediaTypes=function(a){this._callMediaTypes.VIDEO=a?1:0},c.prototype.sendCallMediaTypes=function(){var a="";this._callMediaTypes.AUDIO&&(a+=d),this._callMediaTypes.VIDEO&&(a+=(a?"+":"")+s),this.sendEvent(k,a,null,!0)},c.prototype.sendOperationFailureEvent=function(a,b){this.sendEvent(a+" "+h,b,null,!0)},c.prototype.sendCallType=function(a){a=a?e:m,this.sendEvent(p,a,null,!0)},c.prototype.sendUnavailableEvent=function(a){this.sendEvent(o,a,null,!0)},c.prototype.serviceUnavailableTimeEnd=function(a){var b;a&&(b=new Date-a,a=t.getServiceOutageLabel(b),this.sendTiming(o,a,b,!0))},c.prototype.sendDroppedCallEvent=function(a){this.sendEvent(g,a,null,!0)},c.prototype.sendPreservationEvent=function(a,b){b&&(b=a?q:5e3<b?r:i,this.sendEvent(n,b,null,!0))},c.prototype.callPreservationTimeStart=function(b){return b?this.startTimingMetric():a},c.prototype.callPreservationTimeEnd=function(a){var b;return a&&(b=new Date-a,a=t.getCallPreservation(b),this.sendTiming(n,a,b,!0)),b},b.Services.Analytics.CallsAnalyticsService=c}(AvayaClientServices),function(a){"use strict";function b(b,c){this._productName=b,this._productVersion=c,a.Services.Analytics.AnalyticsService.call(this)}var c="Graceful",d="Avaya",e="Shutdown",f="Startup",g="Ungraceful",h=a.Providers.Analytics.AnalyticsCategories,i=a.Providers.Analytics.AnalyticsCustomDimensions;(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return h.CLIENT},b.prototype._createCustomDimensions=function(){var a={};return a[i.PRODUCT_VENDOR]=d,a[i.PRODUCT_NAME]=this._productName,a[i.PRODUCT_VERSION]=this._productVersion,a},b.prototype.sendStartupEvent=function(){this.sendEvent(f,null,null,!0)},b.prototype.sendShutdownEvent=function(a){a=a?c:g,this.sendEvent(e,a,null,!0)},b.prototype.shutdownTimeEnd=function(a,b){a&&(a=new Date-a,b=b?c:g,this.sendTiming(e,b,a,!0))},a.Services.Analytics.ClientAnalyticsService=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Analytics.AnalyticsService.call(this)}var c="Start Error",d="Duration",e="End",f="End Error",g="Failure",h="Start",i="Success",j=a.Providers.Analytics.AnalyticsStatistic,k=a.Providers.Analytics.AnalyticsCategories,l=a.Providers.Analytics.AnalyticsCustomDimensions,m=a.Providers.Analytics.AnalyticsProvidersTypes;(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return k.COLLABORATIONS},b.prototype._createCustomDimensions=function(){var a={};return a[l.PROVIDER_TYPE]=m.COLLABORATION,a},b.prototype.sendStartupEvent=function(a){a=a?i:g,this.sendEvent(h,a,null,!0)},b.prototype.durationTimeEnd=function(a){var b;a&&(b=new Date-a,a=j.getCallDurationLabel(b),this.sendTiming(d,a,b,!0))},b.prototype.sendStartErrorEvent=function(a){this.sendEvent(c,a,null,!0)},b.prototype.sendStopEvent=function(a){a=a?i:g,this.sendEvent(e,a,null,!0)},b.prototype.sendFailureStopEvent=function(a){this.sendEvent(f,a,null,!0)},a.Services.Analytics.CollaborationsAnalyticsService=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Analytics.AnalyticsService.call(this)}var c=a.Providers.Analytics.AnalyticsStatistic,d="Loaded",e="Cache Search",f="Directory Search",g="Service Unavailable",h="RESOLVE_CONTACTS";(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return a.Providers.Analytics.AnalyticsCategories.CONTACTS},b.prototype._createCustomDimensions=function(){var b={};return b[a.Providers.Analytics.AnalyticsCustomDimensions.PROVIDER_TYPE]=a.Providers.Analytics.AnalyticsProvidersTypes.CONTACTS,b},b.prototype.sendNumContactsLoaded=function(a){var b=c.getContactCountLabel(a);this.sendEvent(d,b,a,!0)},b.prototype.contactsLoadTimeEnd=function(b){var e;b?(e=new Date-b,b=c.getOperationTimingLabel(e),this.sendTiming(d,b,e,!0)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, contactsLoadTimeEnd: start time was not defined")},b.prototype.cachedContactsSearchTimeEnd=function(b){var d;b?(d=new Date-b,b=c.getOperationTimingLabel(d),this.sendTiming(e,b,d,!1)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, cachedContactsSearchTimeEnd: start time was not defined")},b.prototype.sendNumCachedContactSearches=function(a){this.sendEvent(e,a,null,!1)},b.prototype.sendNumDirectorySearches=function(a){this.sendEvent(f,a,null,!0)},b.prototype.directorySearchTimeEnd=function(b){var d;b?(d=new Date-b,b=c.getOperationTimingLabel(d),this.sendTiming(f,b,d,!0)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, directorySearchTimeEnd: start time was not defined")},b.prototype.trackContactProvidersUnavailable=function(a){this.sendEvent(g,a,null,!0)},b.prototype.durationContactProviderOutagesEnd=function(a){var b;a&&(b=new Date-a,a=c.getServiceOutageLabel(b),this.sendTiming(g,a,b,!0))},b.prototype.sendNumResolveContacts=function(a){this.sendEvent(h,a,null,!0)},b.prototype.resolveContactsTimeEnd=function(b){var d;b?(d=new Date-b,b=c.getOperationTimingLabel(d),this.sendTiming(h,b,d,!0)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Contacts, resolveContactsTimeEnd: start time was not defined")},a.Services.Analytics.ContactsAnalyticsService=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Analytics.AnalyticsService.call(this)}var c="Missed Hits",d="ga_missed_hits",e=a.Base.Storage,f=a.Providers.Analytics.AnalyticsCategories;(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return f.ANALYTICS},b.prototype._getMissedHitsObj=function(){return e.get(e.TYPES.LOCAL,d)},b.prototype.setMissedHitsObj=function(a){e.set(e.TYPES.LOCAL,d,a)},b.prototype.createMissedHitsObj=function(a,b){var c=this._getMissedHitsObj();a+=c?c.count:0,this.setMissedHitsObj({count:a,reason:b})},b.prototype.sendMissedHitsCount=function(){var a=this._getMissedHitsObj();a&&this.sendEvent(c,a.reason,a.count)},a.Services.Analytics.InfrastructureAnalyticsService=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Analytics.AnalyticsService.call(this)}var c=a.Providers.Analytics.AnalyticsStatistic,d="SendMessage",e="Attachment Size",f="SearchConversations",g="Service Unavailable",h="GetConversations",i="SearchConversations",j="LeaveConversations",k="ValidateAddresses",l="SendMessage",m="Text",n="Attachment",o="Body",p="Subject",q="Participants";(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return a.Providers.Analytics.AnalyticsCategories.MESSAGING},b.prototype._createCustomDimensions=function(){return{}},b.prototype._setCustomDimensionsMimeType=function(b){this._customDimensions[a.Providers.Analytics.AnalyticsCustomDimensions.MIME_TYPE]=b},b.prototype._resetCustomDimensionsMimeType=function(){delete this._customDimensions[a.Providers.Analytics.AnalyticsCustomDimensions.MIME_TYPE]},b.prototype.trackNumMessagesSent=function(a,b){b=this._getLabelTypeMessage(a,b),this.sendEvent(d,b,null,!1)},b.prototype._getLabelTypeMessage=function(a,b){var c=[];return a&&c.push(m),b&&c.push(n),c.join("+")},b.prototype.trackMessageAttachmentSize=function(a,b){this._setCustomDimensionsMimeType(b),b=c.getAttachmentSizeLabel(a),this.sendEvent(e,b,a,!0),this._resetCustomDimensionsMimeType()},b.prototype.trackNumConversationSearchRequests=function(a,b,c){var d=[];a&&d.push(o),b&&d.push(p),c&&d.push(q),d=d.join("+"),this.sendEvent(f,d,null,!1)},b.prototype.trackTimeRequestsGetConversationsEnd=function(a){this._sendTrackTimeRequests(h,a)},b.prototype.trackTimeRequestsSearchConversationsEnd=function(a){this._sendTrackTimeRequests(i,a)},b.prototype.trackTimeRequestsLeaveConversationsEnd=function(a){this._sendTrackTimeRequests(j,a)},b.prototype.trackTimeRequestsValidateAddressesEnd=function(a){this._sendTrackTimeRequests(k,a)},b.prototype.trackTimeRequestsSendMessageEnd=function(a){this._sendTrackTimeRequests(l,a)},b.prototype._sendTrackTimeRequests=function(b,d){var e;d?(e=new Date-d,d=c.getOperationTimingLabel(e),this.sendTiming(b,d,e,!1)):a.Base.Logger.warn(a.Base.LoggerTags.ANALYTICS_SERVICE,"Messaging, sendTrackTimeRequests: start time was not defined")},b.prototype.trackErrorsResponseGetConversations=function(a){this._trackErrorsResponse(h,a)},b.prototype.trackErrorsResponseSearchConversations=function(a){this._trackErrorsResponse(i,a)},b.prototype.trackErrorsResponseLeaveConversations=function(a){this._trackErrorsResponse(j,a)},b.prototype.trackErrorsResponseValidateAddresses=function(a){this._trackErrorsResponse(k,a)},b.prototype.trackErrorsResponseSendMessage=function(a){this._trackErrorsResponse(l,a)},b.prototype._trackErrorsResponse=function(a,b){this.sendEvent(a,b,null,!1)},b.prototype.trackServiceUnavailable=function(a){this.sendEvent(g,a,null,!1)},b.prototype.trackDurationServiceUnavailableEnd=function(a){var b;a&&(b=new Date-a,a=c.getServiceOutageLabel(b),this.sendTiming(g,a,b,!1))},a.Services.Analytics.MessagingAnalyticsService=b}(AvayaClientServices),function(a){"use strict";function b(){a.Services.Analytics.AnalyticsService.call(this)}var c="Create",d="Failure",e="Success",f="Services",g="Providers",h=a.Providers.Analytics.AnalyticsCategories,i=a.Providers.Analytics.AnalyticsServicesNames,j=a.Providers.Analytics.AnalyticsProvidersTypes;(b.prototype=Object.create(a.Services.Analytics.AnalyticsService.prototype))._createCategory=function(){return h.USER},b.prototype.userCreationTimeEnd=function(a,b){a&&(a=new Date-a,b=b?e:d,this.sendTiming(c,b,a))},b.prototype.sendInfoByUseOfServices=function(a,b,c,d,e,g){function h(a){j+=j?"+":"",j+=a}var j="";a&&h(i.CALL),b&&h(i.COLLABORATION),c&&h(i.CONTACT),d&&h(i.MESSAGING),e&&h(i.PRESENCE),g&&h(i.VOICE_MESSAGING),this.sendEvent(f,j)},b.prototype.sendInfoByUseOfProviders=function(a){function b(a){-1===c.indexOf(a)&&(c+=c?"+":"",c+=a)}var c="";a.acsConfiguration&&a.acsConfiguration.enabled&&b(j.CONTACTS),a.ammConfiguration&&a.ammConfiguration.enabled&&b(j.MESSAGING),a.sgConfiguration&&a.sgConfiguration.enabled&&b(j.CALLS),a.presenceConfiguration&&a.presenceConfiguration.enabled&&b(j.PRESENCE),a.wcsConfiguration&&a.wcsConfiguration.enabled&&b(j.COLLABORATION),a.uccpConfiguration&&a.uccpConfiguration.enabled&&b(j.CONFERENCE),this.sendEvent(g,c)},a.Services.Analytics.UserAnalyticsService=b}(AvayaClientServices),function(c){"use strict";function d(b,d){this._collaborationProvider=b,this._collaborationProviderInitialized=!1,this._whiteboards={},this._nextCollaborationId=1,this._colaborationsAnalyticsService=d,this._wasScreenSharingInterrupted=!1,this._interruptedStream=a,this._interruptedSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._interruptedSharingTimer=a}d.prototype={start:function(a,d,e){return a._isStarted?b.Deferred().resolve().promise():a._isStopped?(this._durationAnalyticsInit(a),a._isStopped=!1,c.Base.Logger.debug(c.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service is starting..."),this._collaborationProvider.start(d,e).then(function(){this._discoveryResource(a),a._isStarted=!0,a.addOnCollaborationServiceAvailableCallback(function(){this._recalculateAllCollaborationCapabilities(a)}.bind(this)),a.addOnCollaborationServiceUnavailableCallback(function(){a.getContentSharing().getOutgoingScreenSharingStream()&&(this._wasScreenSharingInterrupted=!0,this._interruptedStream=a.getContentSharing().getOutgoingScreenSharingStream().clone(),this._interruptedSharingType=a.getContentSharing()._contentSharingService._contentSharingType,this._interruptedSharingTimer=setTimeout(function(){this._resetInterruptedSharing()}.bind(this),3e5),a.getContentSharing()._clearActiveContentSharing(),a.getContentSharing()._endActiveScreenSharing(a._selfParticipant)),this._recalculateAllCollaborationCapabilities(a)}.bind(this)),a.getContentSharing().getShareApplicationWindowCapability().addOnChangedCallback(function(){a._recalculateContentSharingCapability(a)})}.bind(this),function(a){return this._colaborationsAnalyticsService.sendStartErrorEvent(c.Services.Analytics.AnalyticsErrorCode.STARTING_COLLABORATION_ERROR),b.Deferred().reject(a).promise()}.bind(this))):(c.Base.Logger.error(c.Base.LoggerTags.COLLABORATION_SERVICE,"Rejected attempt to start a collaboration that is already starting."),e=c.Services.Collaboration.CollaborationErrorReason.COLLABORATION_START_FAILURE,b.Deferred().reject(new c.Services.Collaboration.CollaborationError(e)).promise())},_durationAnalyticsInit:function(a){var b,c;a._whiteboard.addOnWhiteboardStartedCallback(function(){c=this._colaborationsAnalyticsService.startTimingMetric()}.bind(this)),a._whiteboard.addOnWhiteboardEndedCallback(function(){this._colaborationsAnalyticsService.durationTimeEnd(c)}.bind(this)),a._contentSharing.addOnContentSharingStartedCallback(function(){b=this._colaborationsAnalyticsService.startTimingMetric()}.bind(this)),a._contentSharing.addOnContentSharingEndedCallback(function(){this._colaborationsAnalyticsService.durationTimeEnd(b)}.bind(this))},_resetInterruptedSharing:function(){this._wasScreenSharingInterrupted=!1,this._interruptedSharingType=c.Services.Collaboration.ContentSharingType.NONE,this._interruptedStream=a,clearTimeout(this._interruptedSharingTimer),this._interruptedSharingTimer=a},_discoveryResource:function(a){return this._collaborationProvider.discoverResources(a).done(function(b){a._setSelfParticipant(b),this._collaborationProvider.observeCollaboration(a),!c.Base.Utils.isUndefined(a._isAvailable)&&a._isAvailable||(a._isAvailable=!0,a._onCollaborationServiceAvailableCallbacks.fire(a)),this._recalculateAllCollaborationCapabilities(a)}.bind(this))},stop:function(d){if(d._isStopped)return b.Deferred().resolve().promise();d._isStarted=!1,d._isAvailable&&(d._isAvailable=a,d._onCollaborationServiceUnavailableCallbacks.fire(d)),c.Base.Logger.debug(c.Base.LoggerTags.COLLABORATION_SERVICE,"Collaboration Service stop");var e=d.getSlider(),f=e.getSlides();return e._removeSlides(),e._onSlidesRemovedCallbacks.fire(f),d._selfParticipant=a,d._participants.length=0,d._participants.onDataSetChanged(d._participants,c.Base.DataSetChangeTypes.REMOVED),d._onCollaborationStartedCallbacks.empty(),d._onCollaborationEndedCallbacks.empty(),d._onCollaborationServiceAvailableCallbacks.empty(),d._onCollaborationServiceUnavailableCallbacks.empty(),d._onCollaborationNearEndByEjectCallbacks.empty(),d._onCollaborationPresenterPrivilegeChangedCallbacks.empty(),d._onCollaborationModeratorPrivilegeChangedCallbacks.empty(),d._onCollaborationInitializedCallbacks.empty(),d._isPaused=!1,this._collaborationProvider.stop().always(function(){d._isStopped=!0})},getNextCollaborationId:function(){return this._nextCollaborationId++},getParticipants:function(a){var b=new c.Base.DataRetrieval(a._participants),d=function(c){this.updateParticipantList(a,c),b._dataRetrievalProgress.fire(c.length,!1),b._dataRetrievalDone.fire()}.bind(this);return this._collaborationProvider.getParticipants(a).then(d),b},updateParticipantList:function(a,b){function d(a,c){return c.getParticipantId()===b[a].getParticipantId()}for(var e=[],f=0;f<b.length;f++)0===a._participants.filter(d.bind(this,f)).length&&(a._participants.push(b[f]),e.push(b[f]));0<e.length&&a._participants.onDataSetChanged(e,c.Base.DataSetChangeTypes.ADDED)},_recalculateAllCollaborationCapabilities:function(a){a.getContentSharing()._recalculateShareApplicationWindowCapability(a),a.getContentSharing()._recalculateShareFullScreenCapability(a),a.getContentSharing()._recalculateShareAnyTypeCapability(a),a.getContentSharing()._recalculateShareContentVideoCapability(a),a.getWhiteboard()._recalculateAddWhiteboardCapability(a),a._recalculateChatCapability(),a._recalculateMeetingMinutesCapability(),a._recalculateContentSharingCapability(a),a._recalculateNetworkLibraryCapability(),a._recalculateLibrarySharingCapability(),a._recalculateWhiteboardCapability(a),a._recalculateRetrieveParticipantListCapability(),a.getWhiteboard()._recalculateDrawingCapability(a),a._recalculateSliderCapability()},isFeatureSupported:function(a,b){return 0<=a._supportedFeatures.indexOf(b)&&this._collaborationProvider.isFeatureAvailable(b)},isServiceAvailable:function(){return this._collaborationProvider.isOpened()},pause:function(a){return this._collaborationProvider.pause()},resume:function(a){return this._collaborationProvider.resume()},wasScreenSharingInterrupted:function(){return this._wasScreenSharingInterrupted},getInterruptedSharingType:function(){return this._interruptedSharingType},getInterruptedSharingStream:function(){return this._interruptedStream}},c.Services.Collaboration.CollaborationService=d}(AvayaClientServices),function(c){"use strict";function d(b){var d=new c.Config.ServerInfo("www.google-analytics.com",null,(!0),"/batch"),e=new c.Base.RESTProvider;this._networkProviderConfiguration=new c.Config.NetworkProviderConfiguration(d),this._networkProvider=new c.Base.NetworkProvider(e,a,c.Base.LoggerTags.ANALYTICS_PROVIDER),this._dfdStop=null,this._reportingTimer=null,this._isRunning=!1,this._stopRequested=!1,this._httpRequestsOutstanding=0,this._hitTransmissionQueue=[],this._pendingRequest="",this._countHitsRequest=0,this._retriedOnce=!1,this._commonHitParameters=h.getCommonRequestsParams(b,this._getClientID()),this._infrastructureAnalyticsService=new c.Services.Analytics.InfrastructureAnalyticsService}var e="ga_client_id",f=c.Base.Storage,g=c.Base.Utils,h=c.Providers.Analytics.AnalyticsStatistic;(d.prototype={}).start=function(){return h.setCollectionEnabledState(!0),this._startProvider()},d.prototype.stop=function(){return this._dfdStop=b.Deferred(),this._isRunning?(this._stopRequested=!0,this._stopProvider()):this._stopCompleted(),h.setCollectionEnabledState(!1),this._dfdStop.promise()},d.prototype._isCollectionEnabled=function(){return h.isCollectionEnabled()},d.prototype._startReportingCycle=function(){this._hitTransmissionQueue.length||(h.queueCollectedHits.call(this),this._hitTransmissionQueue.length&&(this._infrastructureAnalyticsService.sendMissedHitsCount(),h.queueCollectedHits.call(this),this._sendBatch()))},d.prototype._sendBatch=function(){for(this._countHitsRequest=0,this._pendingRequest="";this._hitTransmissionQueue.length&&this._countHitsRequest<20;){var a=this._commonHitParameters;if(a+=this._hitTransmissionQueue[0]+"\n",8192<g.getBytesCount(a))this._hitTransmissionQueue.shift();else{if(16384<g.getBytesCount(this._pendingRequest+a))break;this._pendingRequest+=a,this._countHitsRequest++,this._hitTransmissionQueue.shift()}}this._retriedOnce=!1,this._sendRequest()},d.prototype._sendRequest=function(){this._networkProvider.send(this._pendingRequest,{contentType:"text/plain"}).then(function(a){this._onDataReceived()}.bind(this),function(a){c.Base.Logger.error(c.Base.LoggerTags.ANALYTICS_PROVIDER,"Failed to send request",a),this._onErrorReceived(a)}.bind(this)),this._httpRequestsOutstanding++},d.prototype._onDataReceived=function(){this._infrastructureAnalyticsService.setMissedHitsObj(null),this._pendingRequest="",this._hitTransmissionQueue.length&&this._sendBatch(),this._onRequestCompleted()},d.prototype._onErrorReceived=function(a){this._stopRequested||this._retriedOnce||!this._pendingRequest?(this._infrastructureAnalyticsService.createMissedHitsObj(this._countHitsRequest+this._hitTransmissionQueue.length,a.name),this._pendingRequest="",this._hitTransmissionQueue.length=0):(this._retriedOnce=!0,this._sendRequest()),this._onRequestCompleted()},d.prototype._onRequestCompleted=function(){--this._httpRequestsOutstanding<=0&&(this._httpRequestsOutstanding=0,this._stopRequested&&this._stopCompleted())},d.prototype._stopCompleted=function(){this._stopRequested=!1,this._httpRequestsOutstanding=0,this._dfdStop&&this._dfdStop.resolve()},d.prototype._startProvider=function(){this._networkProvider.start(this._networkProviderConfiguration),this._startReportingTimer(),this._isRunning=!0;var a=b.Deferred();return a.resolve(),a.promise()},d.prototype._stopProvider=function(){if(this._stopReportingTimer(),this._isRunning){for(this._isRunning=!1,h.queueCollectedHits.call(this);this._hitTransmissionQueue.length;)this._sendBatch();this._httpRequestsOutstanding<=0&&this._stopCompleted()}},d.prototype._startReportingTimer=function(){this._reportingTimer||(this._reportingTimer=window.setInterval(function(){this._startReportingCycle()}.bind(this),5e3))},d.prototype._stopReportingTimer=function(){this._reportingTimer&&(window.clearInterval(this._reportingTimer),this._reportingTimer=null)},d.prototype._getClientID=function(){var a=f.get(f.TYPES.LOCAL,e);return void 0===a&&(a=c.Base.Utils.generateUUID(),f.set(f.TYPES.LOCAL,e,a)),a},c.Providers.Analytics.AnalyticsProvider=d}(AvayaClientServices),function(c){"use strict";function d(d,e,f){var g,h,i,j;this._config=c.Base.Utils.deepMerge(new c.Config.UserConfiguration,d),this._mediaServiceFactory=e,this._version=f,this._collaborationFactory=a,this._collaboration=a,this._collaborations=a,this._callFactory=a,this._calls=a,this._messagingFactory=a,this._messaging=a,this._contacts=a,this._contactsService=a,this._contactsIntegrationService=a,this._presenceService=a,this._voiceMessaging=a,this._callPerformanceManager=new c.Base.CallPerformanceManager(this._config),this._diagnosticDataGenerator=new c.Base.DiagnosticDataGenerator,this._loggingInterval=a,this._isStopping=!1,this._isStarting=!1,this._isStarted=!1,this._userRegistrationSuccessfulCallbacks=b.Callbacks(),this._userUnregistrationSuccessfulCallbacks=b.Callbacks(),this._userRegistrationFailedCallbacks=b.Callbacks(),this._userUnregistrationFailedCallbacks=b.Callbacks(),this._providerFactory=new c.Base.ProviderFactory,this._contactsIntegrationService=new c.Services.Contacts.ContactsIntegrationService,this._config.presenceConfiguration&&this._config.presenceConfiguration.enabled&&this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(g=(h=this._config.sgConfiguration.networkProviderConfiguration.restConfig).hostName+":"+h.port,h=this._providerFactory.getPresenceProviders(g)[0],this._presenceService=new c.Services.Presence.PresenceService(h)),this._config.acsConfiguration&&this._config.acsConfiguration.enabled&&(g=this._providerFactory.getContactsProviders(this._config)[0],h=this._providerFactory.getDirectorySearchProviders(this._config)[0],i=new c.Services.Analytics.ContactsAnalyticsService,this._contactsService=new c.Services.Contacts.ContactsService(g,h,this._contactsIntegrationService,this._presenceService,i),this._contacts=new c.Services.Contacts.Contacts(this._contactsService)),this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(this._voiceMessaging=new c.Services.VoiceMessaging.VoiceMessaging),this._config.mediaServiceContext&&(c.Base.Logger.addLogger(this._providerFactory.getRemoteLoggerProvider().getLogger()),i=atob(this._config.mediaServiceContext),this._config._mediaServiceConfiguration=JSON.parse(i),i=c.Base.Utils.parseUrl(this._config._mediaServiceConfiguration.userAgentURL),i=new c.Config.ServerInfo(i.hostname,isNaN(i.port)?a:i.port,i.isSecure,i.path,i.credentials,i.query),this._config.sgConfiguration.networkProviderConfiguration=new c.Config.NetworkProviderConfiguration(i),i=new c.Config.CredentialTokenProvider(this._config._mediaServiceConfiguration.sessionToken,c.Config.Authentication.TokenType.BEARER),this._config.sgConfiguration.credentialProvider=i,this._config.sgConfiguration.enabled=!0),this._config.sgConfiguration!==a&&!c.Base.Utils.isBool(this._config.sgConfiguration.enabled)||(j=new c.Services.Analytics.CallsAnalyticsService,this._callFactory=new c.Services.Call.CallFactory(this._providerFactory,this._mediaServiceFactory,this._contactsIntegrationService,j,this._callPerformanceManager),this._callFactory.init(this._config),this._calls=this._callFactory.getCalls()),this._config.ammConfiguration&&this._config.ammConfiguration.enabled&&(this._messagingFactory=new c.Services.Messaging.MessagingFactory(this._config,this._providerFactory,this._contactsIntegrationService),this._messaging=this._messagingFactory.create()),this._config.wcsConfiguration&&this._config.wcsConfiguration.enabled&&(j=new c.Services.Analytics.CollaborationsAnalyticsService,this._collaborationFactory=new c.Services.Collaboration.CollaborationFactory(this._config,this._providerFactory,j,this._callPerformanceManager,this._callFactory.getCallService()),this._collaborations=new c.Services.Collaboration.Collaborations(this._collaborationFactory,this._callFactory.getCallService()),this._collaborations=new c.Services.Collaboration.Collaborations(this._collaborationFactory,this._callFactory.getCallService(),this._callFactory.getCallManager()),this._collaboration=this._collaborations.getCollaborationById("standalone"),this._callFactory&&this._callFactory.getCallService()&&this._callFactory.getCallService().setCollaborations(this._collaborations)),this._config.analyticsConfiguration&&(this._analyticsProvider=new c.Providers.Analytics.AnalyticsProvider(f)),this._clientAnalyticsService=new c.Services.Analytics.ClientAnalyticsService(this._config.applicationProductName,this._config.applicationProductVersion),this._userAnalyticsService=new c.Services.Analytics.UserAnalyticsService,this._boundedAOPexceptionHandler=this._aopExceptionHandler.bind(this)}var e=c.Providers.Analytics.AnalyticsStatistic;d.prototype={getCollaboration:function(){return c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"getCollaboration function is deprecated. Please use AvayaClientServices.User.prototype.getCollaborations instead. Usage of the new function is slightly different."),
this._collaboration},getCollaborations:function(){return this._collaborations},getMessaging:function(){return this._messaging},getContacts:function(){return this._contacts},getSelfContact:function(){return this._contactsService.getSelfContact()},getPresenceService:function(){return this._presenceService},getCalls:function(){return this._calls},getVoiceMessaging:function(){return this._voiceMessaging},stop:function(){var a,d,f,g,h=this._clientAnalyticsService.startTimingMetric(),i=b.Deferred(),j=[];return this._isStopping?(c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still stopping."),i.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()):this._isStarting?(c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still starting."),i.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()):(this._isStopping=!0,this._messaging&&(a=this._messaging.stop(),j.push(a)),this._voiceMessaging&&(d=this._voiceMessaging.stop(),j.push(d)),this._calls?(d=this._calls._stop(),j.push(d),d.then(function(){return this._userUnregistrationSuccessfulCallbacks.fire(),this._resetRegistrationCallbacks(),this._mediaServiceFactory.stop()}.bind(this),function(a){return this._userUnregistrationFailedCallbacks.fire(a),this._mediaServiceFactory.stop()}.bind(this))):this._mediaServiceFactory&&(f=this._mediaServiceFactory.stop(),j.push(f)),this._presenceService&&(f=this._presenceService.stop(),j.push(f)),this._contacts&&(g=this._contacts.stop(),j.push(g)),this._collaborations&&(g=this._collaborations._stopAndDeleteAllCollaborations(),j.push(g)),clearInterval(this._loggingInterval),b.when.apply(this,j).then(function(){this._isStopping=!1,e.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!0),this._clientAnalyticsService.shutdownTimeEnd(h,!0),this._analyticsProvider.stop().then(function(){i.resolve()}.bind(this))):i.resolve()}.bind(this),function(a){this._isStopping=!1,e.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!1),this._clientAnalyticsService.shutdownTimeEnd(h,!1),this._analyticsProvider.stop().always(function(){i.reject(a)})):i.reject(a)}.bind(this)).always(function(){this._isStarted=!1,this._config.mediaServiceContext&&this._calls&&(this._calls._uploadLogs(),c.Base.Logger.removeLogger(this._providerFactory.getRemoteLoggerProvider().getLogger())),c.Base.AOPTools.removeOnExceptionCallback(this._boundedAOPexceptionHandler)}.bind(this))),i.promise()},stopImmediately:function(){var a,d=this._clientAnalyticsService.startTimingMetric(),e=b.Deferred(),f=[];return this._isStopping?(c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still stopping."),e.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE))):this._isStarting?(c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot stop while services are still starting."),e.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE))):(this._isStopping=!0,this._calls?(a=this._calls._stopImmediately().then(function(){this._userUnregistrationSuccessfulCallbacks.fire()}.bind(this),function(a){this._userUnregistrationFailedCallbacks.fire()}.bind(this)).always(function(){this._stopOtherServicesImmediately(f,e)}.bind(this)),f.push(a)):this._stopOtherServicesImmediately(f,e,d)),e.promise()},_stopOtherServicesImmediately:function(a,c,d){var f,g,h;this._voiceMessaging&&(f=this._voiceMessaging._stopImmediately(),a.push(f)),this._presenceService&&(g=this._presenceService._stopImmediately(),a.push(g)),this._messaging&&(g=this._messaging._stopImmediately(),a.push(g)),this._contacts&&(h=this._contacts._stopImmediately(),a.push(h)),this._collaborations&&(h=this._collaborations._stopImmediately(),a.push(h)),b.when.apply(this,a).then(function(){this._isStopping=!1,this._userUnregistrationSuccessfulCallbacks.fire(),e.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!0),this._clientAnalyticsService.shutdownTimeEnd(d,!0),this._analyticsProvider.stop().then(function(){c.resolve()}.bind(this))):c.resolve()}.bind(this),function(a){this._isStopping=!1,this._userUnregistrationFailedCallbacks(),e.isCollectionEnabled()?(this._clientAnalyticsService.sendShutdownEvent(!1),this._clientAnalyticsService.shutdownTimeEnd(d,!1),this._analyticsProvider.stop().always(function(){c.reject(a)})):c.reject(a)}.bind(this)).always(function(){this._isStarted=!1}.bind(this))},start:function(){var a=this._clientAnalyticsService.startTimingMetric();c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Starting SDK, version is "+this._version);var d=b.Deferred();c.Base.AOPTools.addOnExceptionCallback(this._boundedAOPexceptionHandler);try{this._checkDependencies()}catch(e){var f=e.getMessage(),g=e.getData(),h=g.extent===c.Base.Library.Service.SUPPORT_EXTENT_NONE?c.Base.Logger.error:c.Base.Logger.warn,f=f+" "+g.info;if(h(c.Base.LoggerTags.USER_SERVICE,f),g.extent===c.Base.Library.Service.SUPPORT_EXTENT_NONE)return d.reject(e).promise()}var e,i,j,k,l,m=[];if(c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Browser detected as "+c.Base.Utils.getBrowserType()),c.Base.Utils.getBrowserSubType()!==c.Base.BrowserSubType.UNKNOWN&&c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Sub type detected as "+c.Base.Utils.getBrowserSubType()),c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"User agent "+navigator.userAgent),this._isStopping)return c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot start while services are still stopping."),d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),d.promise();if(this._isStarting)return c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot start service while services are still starting."),d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),d.promise();if(this._isStarted)return c.Base.Logger.warn(c.Base.LoggerTags.USER_SERVICE,"Cannot start service while service is already started."),d.reject(new c.Base.BaseError(c.Base.ErrorReasons.CAPABILITY_INVALID_STATE)),d.promise();this._isStarting=!0,this._analyticsProvider&&this._config.analyticsConfiguration&&this._config.analyticsConfiguration.enabled&&(e=this._analyticsProvider.start(),m.push(e),this._userAnalyticsService.sendInfoByUseOfServices(this._calls,this._collaboration||this._collaborations,this._contacts,this._messaging,this._presenceService,this._voiceMessaging),this._userAnalyticsService.sendInfoByUseOfProviders(this._config)),this._contacts&&(e=this._contacts.start(this._config),m.push(e)),this._messaging&&(i=this._messaging.start(this._config),m.push(i)),this._presenceService&&(i=this._presenceService.start(this._config),m.push(i)),this._calls&&(j=b.Deferred(),this._config.mediaConfiguration.mediaEngineEnabled&&(this._config.mediaConfiguration.retrieveDeviceLabelsEnabled&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia?(l=b.Deferred(),this._startMediaServiceFactory(l),m.push(l)):m.push(this._mediaServiceFactory.start())),this._calls._onCallsServiceRegistration=function(a){(a?this._userRegistrationSuccessfulCallbacks:this._userRegistrationFailedCallbacks).fire()}.bind(this),l=this._calls._start(),m.push(l),l.then(function(){j.resolve()}.bind(this),function(a){j.reject(a)}.bind(this))),this._voiceMessaging&&(this._calls?(k=b.Deferred(),m.push(k),j.promise().always(function(){var a=this._providerFactory.getVoiceMessagingProvider(this._config.sgConfiguration);this._voiceMessaging.start(this._config,a).then(function(){k.resolve()},function(a){k.reject(a)})}.bind(this))):(l=this._voiceMessaging.start(this._config),m.push(l))),this._loggingInterval=setInterval(function(){this._logDiagnosticData()}.bind(this),3e5);var n=0,o=0;return c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Starting "+m.length+" services."),m.forEach(function(b){b.then(function(){o++,d.state()===c.Base.DeferredStates.PENDING&&o+n===m.length&&(this._userAnalyticsService.userCreationTimeEnd(a,!0),this._isStarting=!1,this._isStarted=!0,c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Resolving promise : ["+o+","+n+"]"),d.resolve())}.bind(this),function(){n++,d.state()===c.Base.DeferredStates.PENDING&&(n===m.length?(this._userAnalyticsService.userCreationTimeEnd(a,!1),this._isStarting=!1,c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Rejecting promise : ["+o+","+n+"]"),d.reject()):o+n===m.length&&(this._userAnalyticsService.userCreationTimeEnd(a,!0),this._isStarting=!1,this._isStarted=!0,c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Resolving promise : ["+o+","+n+"]"),d.resolve()))}.bind(this))}.bind(this)),this._clientAnalyticsService.sendStartupEvent(),d.promise()},_startMediaServiceFactory:function(a){var b;c.Base.Utils.getBrowserType()===c.Base.BrowserType.SAFARI?this._startMediaServiceFactoryForSafari(a):(b=function(a){return this._mediaServiceFactory.start().then(function(){a.getTracks().forEach(function(a){a.stop()}),this._mediaServiceFactory.getMediaServicesService()._setDefaultDevices(a)}.bind(this),function(b){a.getTracks().forEach(function(a){a.stop()})}.bind(this))}.bind(this),window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(c){b(c).then(function(){a.resolve()},function(b){a.reject(b)})}.bind(this))["catch"](function(d){return"NotAllowedError"!==d.name&&"NotFoundError"!==d.name&&"PermissionDeniedError"!==d.name&&"NotReadableError"!==d.name?(c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+d),this._mediaServiceFactory.start().always(function(){a.reject("Can not receive media stream: "+d)})):void window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(c){b(c).then(function(){a.resolve()},function(b){a.reject(b)})}.bind(this),function(b){return c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+b),this._mediaServiceFactory.start().always(function(){a.reject("Can not receive media stream: "+b)})}.bind(this))}.bind(this)))},_startMediaServiceFactoryForSafari:function(a){var b=function(a){return this._mediaServiceFactory.start().then(function(){a.getTracks().forEach(function(a){a.stop()}),this._mediaServiceFactory.getMediaServicesService()._setDefaultDevices(a)}.bind(this),function(b){a.getTracks().forEach(function(a){a.stop()})})}.bind(this);window.navigator.mediaDevices.getUserMedia({audio:!0}).then(function(d){window.navigator.mediaDevices.getUserMedia({video:!0}).then(function(c){d.getTracks().forEach(function(a){c.addTrack(a)}),b(c).then(function(){a.resolve()},function(b){a.reject(b)})}.bind(this),function(e){c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Can only receive audio stream: "+e),b(d).then(function(){a.resolve()},function(b){a.reject(b)})}.bind(this))}.bind(this))["catch"](function(b){return"NotAllowedError"===b.name||"PermissionDeniedError"===b.name?(c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Audio media stream permission denied: "+b),this._mediaServiceFactory.start().always(function(){a.reject("Audio media stream permission denied: "+b)})):(c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+b),this._mediaServiceFactory.start().always(function(){a.reject("Can not receive media stream: "+b)}))}.bind(this))},_checkDependencies:function(){var a=c.Base.Library.Service.jQuery.getSupportExtent();if(a!==c.Base.Library.Service.SUPPORT_EXTENT_FULL)throw a={extent:a,info:"Supported version of jQuery is "+c.Base.Library.Service.jQuery.getSupportedVersion()+" while current version is "+c.Base.Library.Service.jQuery.getCurrentVersion()},new c.Base.BaseError(c.Base.ErrorReasons.LIBRARY_NOT_SUPPORTED,a)},_resetRegistrationCallbacks:function(){this._userRegistrationSuccessfulCallbacks.empty(),this._userUnregistrationSuccessfulCallbacks.empty(),this._userRegistrationFailedCallbacks.empty(),this._userUnregistrationFailedCallbacks.empty()},_logDiagnosticData:function(){var a=[];this._diagnosticDataGenerator.generateBatteryLogs(this._config).then(function(b){return a=a.concat(b),this._diagnosticDataGenerator.generateMessagingLogs(this._messaging)}.bind(this)).then(function(b){return a=a.concat(b),this._diagnosticDataGenerator.generateContactsLogs(this._contacts)}.bind(this)).then(function(b){return a=a.concat(b),this._diagnosticDataGenerator.generateCallLogs(this._calls)}.bind(this)).then(function(b){return a=a.concat(b),this._diagnosticDataGenerator.generatePerformanceLogs()}.bind(this)).then(function(b){a=a.concat(b),c.Base.Logger.info(c.Base.LoggerTags.USER_SERVICE,a.join("\r\n"))}.bind(this))},_aopExceptionHandler:function(a){c.Base.Logger.error(c.Base.LoggerTags.USER_SERVICE,"Caught service exception",a),this._config.mediaServiceContext&&this._calls&&this._calls._uploadLogs()}},c.Base.AOPTools.addAdvices(d,"User",["getSelfContact"],[c.Base.AOPCommonAdvices.LOG_USER_API_CALLS]),c.Base.AOPTools.addAdvices(d,"User",["start","stop","stopImmediately"],[c.Base.AOPCommonAdvices.LOG_USER_API_CALLS,c.Base.AOPCommonAdvices.WRAP_CAUGHT_USER_ERROR]),c.Base.AOPTools.addAdvices(window.AvayaClientServices,"AvayaClientServices",["createUser","registerLogger"],[c.Base.AOPCommonAdvices.LOG_USER_API_CALLS]),c.User=d}(AvayaClientServices),function(a){"use strict";b.extend(a.User.prototype,{addOnUserRegistrationSuccessful:function(a){this._userRegistrationSuccessfulCallbacks.add(a)},removeOnUserRegistrationSuccessful:function(a){this._userRegistrationSuccessfulCallbacks.remove(a)},addOnUserRegistrationFailed:function(a){this._userRegistrationFailedCallbacks.add(a)},removeOnUserRegistrationFailed:function(a){this._userRegistrationFailedCallbacks.remove(a)},addOnUserUnregistrationSuccessful:function(a){this._userUnregistrationSuccessfulCallbacks.add(a)},removeOnUserUnregistrationSuccessful:function(a){this._userUnregistrationSuccessfulCallbacks.remove(a)},addOnUserUnregistrationFailed:function(a){this._userUnregistrationFailedCallbacks.add(a)},removeOnUserUnregistrationFailed:function(a){this._userUnregistrationFailedCallbacks.remove(a)}})}(AvayaClientServices),AvayaClientServices.Base.Library.Service.jQuery.addOnVersionChangedCallback(function(a){b=a})}(),function(){function a(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}function b(a,b,c,d){for(var e=-1,f=null==a?0:a.length;++e<f;){var g=a[e];b(d,g,c(g),a)}return d}function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&!1!==b(a[c],c,a););return a}function d(a,b){for(var c=null==a?0:a.length;c--&&!1!==b(a[c],c,a););return a}function e(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function f(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}function g(a,b){return!(null==a||!a.length)&&-1<p(a,b,0)}function h(a,b,c){for(var d=-1,e=null==a?0:a.length;++d<e;)if(c(b,a[d]))return!0;return!1}function i(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function j(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function k(a,b,c,d){var e=-1,f=null==a?0:a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function l(a,b,c,d){var e=null==a?0:a.length;for(d&&e&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}function m(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function n(a,b,c){var d;return c(a,function(a,c,e){if(b(a,c,e))return d=c,!1}),d}function o(a,b,c,d){var e=a.length;for(c+=d?1:-1;d?c--:++c<e;)if(b(a[c],c,a))return c;return-1}function p(a,b,c){if(b===b)a:{--c;for(var d=a.length;++c<d;)if(a[c]===b){a=c;break a}a=-1}else a=o(a,r,c);return a}function q(a,b,c,d){--c;for(var e=a.length;++c<e;)if(d(a[c],b))return c;return-1}function r(a){return a!==a}function s(a,b){var c=null==a?0:a.length;return c?x(a,b)/c:P}function t(a){return function(b){return null==b?N:b[a]}}function u(a){return function(b){return null==a?N:a[b]}}function v(a,b,c,d,e){return e(a,function(a,e,f){c=d?(d=!1,a):b(c,a,e,f)}),c}function w(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].c;return a}function x(a,b){for(var c,d=-1,e=a.length;++d<e;){var f=b(a[d]);f!==N&&(c=c===N?f:c+f)}return c}function y(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function z(a,b){return i(b,function(b){return[b,a[b]]})}function A(a){return function(b){return a(b)}}function B(a,b){return i(b,function(b){return a[b]})}function C(a,b){return a.has(b)}function D(a,b){for(var c=-1,d=a.length;++c<d&&-1<p(b,a[c],0););return c}function E(a,b){for(var c=a.length;c--&&-1<p(b,a[c],0););return c}function F(a){return"\\"+Ia[a]}function G(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function H(a,b){return function(c){return a(b(c))}}function I(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c];g!==b&&"__lodash_placeholder__"!==g||(a[c]="__lodash_placeholder__",f[e++]=c)}return f}function J(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function K(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=[a,a]}),c}function L(a){if(Da.test(a)){for(var b=Ba.lastIndex=0;Ba.test(a);)++b;a=b}else a=Za(a);return a}function M(a){return Da.test(a)?a.match(Ba)||[]:a.split("")}var N,O=1/0,P=NaN,Q=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],R=/\b__p\+='';/g,S=/\b(__p\+=)''\+/g,T=/(__e\(.*?\)|\b__t\))\+'';/g,U=/&(?:amp|lt|gt|quot|#39);/g,V=/[&<>"']/g,W=RegExp(U.source),X=RegExp(V.source),Y=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,$=/<%=([\s\S]+?)%>/g,_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,aa=/^\w*$/,ba=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ca=/[\\^$.*+?()[\]{}|]/g,da=RegExp(ca.source),ea=/^\s+|\s+$/g,fa=/^\s+/,ga=/\s+$/,ha=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ia=/\{\n\/\* \[wrapped with (.+)\] \*/,ja=/,? & /,ka=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,la=/\\(\\)?/g,ma=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,na=/\w*$/,oa=/^[-+]0x[0-9a-f]+$/i,pa=/^0b[01]+$/i,qa=/^\[object .+?Constructor\]$/,ra=/^0o[0-7]+$/i,sa=/^(?:0|[1-9]\d*)$/,ta=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ua=/($^)/,va=/['\n\r\u2028\u2029\\]/g,wa="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",xa="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+wa,ya="(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])",za=RegExp("['’]","g"),Aa=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),Ba=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|"+ya+wa,"g"),Ca=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",xa].join("|"),"g"),Da=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),Ea=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Fa="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Ga={};Ga["[object Float32Array]"]=Ga["[object Float64Array]"]=Ga["[object Int8Array]"]=Ga["[object Int16Array]"]=Ga["[object Int32Array]"]=Ga["[object Uint8Array]"]=Ga["[object Uint8ClampedArray]"]=Ga["[object Uint16Array]"]=Ga["[object Uint32Array]"]=!0,Ga["[object Arguments]"]=Ga["[object Array]"]=Ga["[object ArrayBuffer]"]=Ga["[object Boolean]"]=Ga["[object DataView]"]=Ga["[object Date]"]=Ga["[object Error]"]=Ga["[object Function]"]=Ga["[object Map]"]=Ga["[object Number]"]=Ga["[object Object]"]=Ga["[object RegExp]"]=Ga["[object Set]"]=Ga["[object String]"]=Ga["[object WeakMap]"]=!1;var Ha={};Ha["[object Arguments]"]=Ha["[object Array]"]=Ha["[object ArrayBuffer]"]=Ha["[object DataView]"]=Ha["[object Boolean]"]=Ha["[object Date]"]=Ha["[object Float32Array]"]=Ha["[object Float64Array]"]=Ha["[object Int8Array]"]=Ha["[object Int16Array]"]=Ha["[object Int32Array]"]=Ha["[object Map]"]=Ha["[object Number]"]=Ha["[object Object]"]=Ha["[object RegExp]"]=Ha["[object Set]"]=Ha["[object String]"]=Ha["[object Symbol]"]=Ha["[object Uint8Array]"]=Ha["[object Uint8ClampedArray]"]=Ha["[object Uint16Array]"]=Ha["[object Uint32Array]"]=!0,Ha["[object Error]"]=Ha["[object Function]"]=Ha["[object WeakMap]"]=!1;var Ia={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ja=parseFloat,Ka=parseInt,La="object"==typeof global&&global&&global.Object===Object&&global,Ma="object"==typeof self&&self&&self.Object===Object&&self,Na=La||Ma||Function("return this")(),Oa="object"==typeof exports&&exports&&!exports.nodeType&&exports,Pa=Oa&&"object"==typeof module&&module&&!module.nodeType&&module,Qa=Pa&&Pa.exports===Oa,Ra=Qa&&La.process,Sa=function(){try{var a=Pa&&Pa.f&&Pa.f("util").types;return a?a:Ra&&Ra.binding&&Ra.binding("util")}catch(a){}}(),Ta=Sa&&Sa.isArrayBuffer,Ua=Sa&&Sa.isDate,Va=Sa&&Sa.isMap,Wa=Sa&&Sa.isRegExp,Xa=Sa&&Sa.isSet,Ya=Sa&&Sa.isTypedArray,Za=t("length"),$a=u({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),_a=u({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),ab=u({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),bb=function cb(u){function wa(a){if(re(a)&&!fh(a)&&!(a instanceof Ba)){if(a instanceof ya)return a;if(ff.call(a,"__wrapped__"))return Od(a)}return new ya(a)}function xa(){}function ya(a,b){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=N}function Ba(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Ia(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function La(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function Ma(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function Oa(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new Ma;++b<c;)this.add(a[b])}function Pa(a){this.size=(this.__data__=new La(a)).size}function Ra(a,b){var c,d=fh(a),e=!d&&eh(a),f=!d&&!e&&hh(a),g=!d&&!e&&!f&&mh(a),e=(d=d||e||f||g)?y(a.length,_e):[],h=e.length;for(c in a)!b&&!ff.call(a,c)||d&&("length"==c||f&&("offset"==c||"parent"==c)||g&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ad(c,h))||e.push(c);return e}function Sa(a){var b=a.length;return b?a[ec(0,b-1)]:N}function Za(a,b){return Kd(Ic(a),mb(b,0,a.length))}function db(a){return Kd(Ic(a))}function eb(a,b,c){(c===N||je(a[b],c))&&(c!==N||b in a)||kb(a,b,c)}function fb(a,b,c){var d=a[b];ff.call(a,b)&&je(d,c)&&(c!==N||b in a)||kb(a,b,c)}function gb(a,b){for(var c=a.length;c--;)if(je(a[c][0],b))return c;return-1}function hb(a,b,c,d){return eg(a,function(a,e,f){b(d,a,c(a),f)}),d}function ib(a,b){return a&&Jc(b,Fe(b),a)}function jb(a,b){return a&&Jc(b,Ge(b),a)}function kb(a,b,c){"__proto__"==b&&yf?yf(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c}function lb(a,b){for(var c=-1,d=b.length,e=Ue(d),f=null==a;++c<d;)e[c]=f?N:De(a,b[c]);return e}function mb(a,b,c){return a===a&&(c!==N&&(a=a<=c?a:c),b!==N&&(a=a>=b?a:b)),a}function nb(a,b,d,e,f,g){var h,i=1&b,j=2&b,k=4&b;if(d&&(h=f?d(a,e,f,g):d(a)),h!==N)return h;if(!qe(a))return a;if(e=fh(a)){if(h=wd(a),!i)return Ic(a,h)}else{var l=pg(a),m="[object Function]"==l||"[object GeneratorFunction]"==l;if(hh(a))return Cc(a,i);if("[object Object]"==l||"[object Arguments]"==l||m&&!f){if(h=j||m?{}:xd(a),!i)return j?Lc(a,jb(h,a)):Kc(a,ib(h,a))}else{if(!Ha[l])return f?a:{};h=yd(a,l,i)}}if(g||(g=new Pa),f=g.get(a))return f;g.set(a,h),lh(a)?a.forEach(function(c){h.add(nb(c,b,d,c,a,g))}):jh(a)&&a.forEach(function(c,e){h.set(e,nb(c,b,d,e,a,g))});var j=k?j?od:nd:j?Ge:Fe,n=e?N:j(a);return c(n||a,function(c,e){n&&(e=c,c=a[e]),fb(h,e,nb(c,b,d,e,a,g))}),h}function ob(a){var b=Fe(a);return function(c){return pb(c,a,b)}}function pb(a,b,c){var d=c.length;if(null==a)return!d;for(a=Ze(a);d--;){var e=c[d],f=b[e],g=a[e];if(g===N&&!(e in a)||!f(g))return!1}return!0}function qb(a,b,c){if("function"!=typeof a)throw new af("Expected a function");return sg(function(){a.apply(N,c)},b)}function rb(a,b,c,d){var e=-1,f=g,j=!0,k=a.length,l=[],m=b.length;if(!k)return l;c&&(b=i(b,A(c))),d?(f=h,j=!1):200<=b.length&&(f=C,j=!1,b=new Oa(b));a:for(;++e<k;){var n=a[e],o=null==c?n:c(n),n=d||0!==n?n:0;if(j&&o===o){for(var p=m;p--;)if(b[p]===o)continue a;l.push(n)}else f(b,o,d)||l.push(n)}return l}function sb(a,b){var c=!0;return eg(a,function(a,d,e){return c=!!b(a,d,e)}),c}function tb(a,b,c){for(var d=-1,e=a.length;++d<e;){var f=a[d],g=b(f);if(null!=g&&(h===N?g===g&&!ve(g):c(g,h)))var h=g,i=f}return i}function ub(a,b){var c=[];return eg(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c}function vb(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=zd),e||(e=[]);++f<g;){var h=a[f];0<b&&c(h)?1<b?vb(h,b-1,c,d,e):j(e,h):d||(e[e.length]=h)}return e}function wb(a,b){return a&&gg(a,b,Fe)}function xb(a,b){return a&&hg(a,b,Fe)}function yb(a,b){return f(b,function(b){return ne(a[b])})}function zb(a,b){b=Ac(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[Ld(b[c++])];return c&&c==d?a:N}function Ab(a,b,c){return b=b(a),fh(a)?b:j(b,c(a))}function Bb(a){if(null==a)a=a===N?"[object Undefined]":"[object Null]";else if(xf&&xf in Ze(a)){var b=ff.call(a,xf),c=a[xf];try{a[xf]=N;var d=!0}catch(a){}var e=jf.call(a);d&&(b?a[xf]=c:delete a[xf]),a=e}else a=jf.call(a);return a}function Cb(a,b){return a>b}function Db(a,b){return null!=a&&ff.call(a,b)}function Eb(a,b){return null!=a&&b in Ze(a)}function Fb(a,b,c){for(var d=c?h:g,e=a[0].length,f=a.length,j=f,k=Ue(f),l=1/0,m=[];j--;){var n=a[j];j&&b&&(n=i(n,A(b))),l=Kf(n.length,l),k[j]=!c&&(b||120<=e&&120<=n.length)?new Oa(j&&n):N}var n=a[0],o=-1,p=k[0];a:for(;++o<e&&m.length<l;){var q=n[o],r=b?b(q):q,q=c||0!==q?q:0;if(p?!C(p,r):!d(m,r,c)){for(j=f;--j;){var s=k[j];if(s?!C(s,r):!d(a[j],r,c))continue a}p&&p.push(r),m.push(q)}}return m}function Gb(a,b,c){var d={};return wb(a,function(a,e,f){b(d,c(a),e,f)}),d}function Hb(b,c,d){return c=Ac(c,b),b=2>c.length?b:zb(b,lc(c,0,-1)),c=null==b?b:b[Ld(Td(c))],null==c?N:a(c,b,d)}function Ib(a){return re(a)&&"[object Arguments]"==Bb(a)}function Jb(a){return re(a)&&"[object ArrayBuffer]"==Bb(a)}function Kb(a){return re(a)&&"[object Date]"==Bb(a)}function Lb(a,b,c,d,e){if(a===b)b=!0;else if(null==a||null==b||!re(a)&&!re(b))b=a!==a&&b!==b;else a:{var f=fh(a),g=fh(b),h=f?"[object Array]":pg(a),i=g?"[object Array]":pg(b),h="[object Arguments]"==h?"[object Object]":h,i="[object Arguments]"==i?"[object Object]":i,j="[object Object]"==h,g="[object Object]"==i;if((i=h==i)&&hh(a)){if(!hh(b)){b=!1;break a}f=!0,j=!1}if(i&&!j)e||(e=new Pa),b=f||mh(a)?kd(a,b,c,d,Lb,e):ld(a,b,h,c,d,Lb,e);else{if(!(1&c)&&(f=j&&ff.call(a,"__wrapped__"),h=g&&ff.call(b,"__wrapped__"),f||h)){a=f?a.value():a,b=h?b.value():b,e||(e=new Pa),b=Lb(a,b,c,d,e);break a}if(i)b:if(e||(e=new Pa),f=1&c,h=nd(a),g=h.length,i=nd(b).length,g==i||f){for(j=g;j--;){var k=h[j];if(!(f?k in b:ff.call(b,k))){b=!1;break b}}if((i=e.get(a))&&e.get(b))b=i==b;else{i=!0,e.set(a,b),e.set(b,a);for(var l=f;++j<g;){var k=h[j],m=a[k],n=b[k];if(d)var o=f?d(n,m,k,b,a,e):d(m,n,k,a,b,e);if(o===N?m!==n&&!Lb(m,n,c,d,e):!o){i=!1;break}l||(l="constructor"==k)}i&&!l&&(c=a.constructor,d=b.constructor,c!=d&&"constructor"in a&&"constructor"in b&&!("function"==typeof c&&c instanceof c&&"function"==typeof d&&d instanceof d)&&(i=!1)),e["delete"](a),e["delete"](b),b=i}}else b=!1;else b=!1}}return b}function Mb(a){return re(a)&&"[object Map]"==pg(a)}function Nb(a,b,c,d){var e=c.length,f=e,g=!d;if(null==a)return!f;for(a=Ze(a);e--;){var h=c[e];if(g&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++e<f;){var h=c[e],i=h[0],j=a[i],k=h[1];if(g&&h[2]){if(j===N&&!(i in a))return!1}else{if(h=new Pa,d)var l=d(j,k,i,a,b,h);if(l===N?!Lb(k,j,3,d,h):!l)return!1}}return!0}function Ob(a){return!(!qe(a)||hf&&hf in a)&&(ne(a)?mf:qa).test(Md(a))}function Pb(a){return re(a)&&"[object RegExp]"==Bb(a)}function Qb(a){return re(a)&&"[object Set]"==pg(a)}function Rb(a){return re(a)&&pe(a.length)&&!!Ga[Bb(a)];
}function Sb(a){return"function"==typeof a?a:null==a?Ne:"object"==typeof a?fh(a)?Xb(a[0],a[1]):Wb(a):Re(a)}function Tb(a){if(!Ed(a))return If(a);var b,c=[];for(b in Ze(a))ff.call(a,b)&&"constructor"!=b&&c.push(b);return c}function Ub(a,b){return a<b}function Vb(a,b){var c=-1,d=ke(a)?Ue(a.length):[];return eg(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function Wb(a){var b=td(a);return 1==b.length&&b[0][2]?Fd(b[0][0],b[0][1]):function(c){return c===a||Nb(c,a,b)}}function Xb(a,b){return Cd(a)&&b===b&&!qe(b)?Fd(Ld(a),b):function(c){var d=De(c,a);return d===N&&d===b?Ee(c,a):Lb(b,d,3)}}function Yb(a,b,c,d,e){a!==b&&gg(b,function(f,g){if(e||(e=new Pa),qe(f)){var h=e,i=Hd(a,g),j=Hd(b,g),k=h.get(j);if(k)eb(a,g,k);else{var k=d?d(i,j,g+"",a,b,h):N,l=k===N;if(l){var m=fh(j),n=!m&&hh(j),o=!m&&!n&&mh(j),k=j;m||n||o?fh(i)?k=i:le(i)?k=Ic(i):n?(l=!1,k=Cc(j,!0)):o?(l=!1,k=Ec(j,!0)):k=[]:te(j)||eh(j)?(k=i,eh(i)?k=Be(i):qe(i)&&!ne(i)||(k=xd(j))):l=!1}l&&(h.set(j,k),Yb(k,j,c,d,h),h["delete"](j)),eb(a,g,k)}}else h=d?d(Hd(a,g),f,g+"",a,b,e):N,h===N&&(h=f),eb(a,g,h)},Ge)}function Zb(a,b){var c=a.length;if(c)return b+=0>b?c:0,Ad(b,c)?a[b]:N}function $b(a,b,c){var d=-1;return b=i(b.length?b:[Ne],A(rd())),a=Vb(a,function(a){return{a:i(b,function(b){return b(a)}),b:++d,c:a}}),w(a,function(a,b){var d;a:{d=-1;for(var e=a.a,f=b.a,g=e.length,h=c.length;++d<g;){var i=Fc(e[d],f[d]);if(i){d=d>=h?i:i*("desc"==c[d]?-1:1);break a}}d=a.b-b.b}return d})}function _b(a,b){return ac(a,b,function(b,c){return Ee(a,c)})}function ac(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=zb(a,g);c(h,g)&&jc(f,Ac(g,a),h)}return f}function bc(a){return function(b){return zb(b,a)}}function cc(a,b,c,d){var e=d?q:p,f=-1,g=b.length,h=a;for(a===b&&(b=Ic(b)),c&&(h=i(a,A(c)));++f<g;)for(var j=0,k=b[f],k=c?c(k):k;-1<(j=e(h,k,j,d));)h!==a&&uf.call(h,j,1),uf.call(a,j,1);return a}function dc(a,b){for(var c=a?b.length:0,d=c-1;c--;){var e=b[c];if(c==d||e!==f){var f=e;Ad(e)?uf.call(a,e,1):tc(a,e)}}}function ec(a,b){return a+Df(Nf()*(b-a+1))}function fc(a,b){var c="";if(!a||1>b||9007199254740991<b)return c;do b%2&&(c+=a),(b=Df(b/2))&&(a+=a);while(b);return c}function gc(a,b){return tg(Gd(a,b,Ne),a+"")}function hc(a){return Sa(Ie(a))}function ic(a,b){var c=Ie(a);return Kd(c,mb(b,0,c.length))}function jc(a,b,c,d){if(!qe(a))return a;b=Ac(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=Ld(b[e]),j=c;if(e!=g){var k=h[i],j=d?d(k,i,h):N;j===N&&(j=qe(k)?k:Ad(b[e+1])?[]:{})}fb(h,i,j),h=h[i]}return a}function kc(a){return Kd(Ie(a))}function lc(a,b,c){var d=-1,e=a.length;for(0>b&&(b=-b>e?0:e+b),c=c>e?e:c,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0,c=Ue(e);++d<e;)c[d]=a[d+b];return c}function mc(a,b){var c;return eg(a,function(a,d,e){return c=b(a,d,e),!c}),!!c}function nc(a,b,c){var d=0,e=null==a?d:a.length;if("number"==typeof b&&b===b&&2147483647>=e){for(;d<e;){var f=d+e>>>1,g=a[f];null!==g&&!ve(g)&&(c?g<=b:g<b)?d=f+1:e=f}return e}return oc(a,b,Ne,c)}function oc(a,b,c,d){b=c(b);for(var e=0,f=null==a?0:a.length,g=b!==b,h=null===b,i=ve(b),j=b===N;e<f;){var k=Df((e+f)/2),l=c(a[k]),m=l!==N,n=null===l,o=l===l,p=ve(l);(g?d||o:j?o&&(d||m):h?o&&m&&(d||!n):i?o&&m&&!n&&(d||!p):n||p?0:d?l<=b:l<b)?e=k+1:f=k}return Kf(f,4294967294)}function pc(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c],h=b?b(g):g;if(!c||!je(h,i)){var i=h;f[e++]=0===g?0:g}}return f}function qc(a){return"number"==typeof a?a:ve(a)?P:+a}function rc(a){if("string"==typeof a)return a;if(fh(a))return i(a,rc)+"";if(ve(a))return cg?cg.call(a):"";var b=a+"";return"0"==b&&1/a==-O?"-0":b}function sc(a,b,c){var d=-1,e=g,f=a.length,i=!0,j=[],k=j;if(c)i=!1,e=h;else if(200<=f){if(e=b?null:lg(a))return J(e);i=!1,e=C,k=new Oa}else k=b?[]:j;a:for(;++d<f;){var l=a[d],m=b?b(l):l,l=c||0!==l?l:0;if(i&&m===m){for(var n=k.length;n--;)if(k[n]===m)continue a;b&&k.push(m),j.push(l)}else e(k,m,c)||(k!==j&&k.push(m),j.push(l))}return j}function tc(a,b){return b=Ac(b,a),a=2>b.length?a:zb(a,lc(b,0,-1)),null==a||delete a[Ld(Td(b))]}function uc(a,b,c,d){for(var e=a.length,f=d?e:-1;(d?f--:++f<e)&&b(a[f],f,a););return c?lc(a,d?0:f,d?f+1:e):lc(a,d?f+1:0,d?e:f)}function vc(a,b){var c=a;return c instanceof Ba&&(c=c.value()),k(b,function(a,b){return b.func.apply(b.thisArg,j([a],b.args))},c)}function wc(a,b,c){var d=a.length;if(2>d)return d?sc(a[0]):[];for(var e=-1,f=Ue(d);++e<d;)for(var g=a[e],h=-1;++h<d;)h!=e&&(f[e]=rb(f[e]||g,a[h],b,c));return sc(vb(f,1),b,c)}function xc(a,b,c){for(var d=-1,e=a.length,f=b.length,g={};++d<e;)c(g,a[d],d<f?b[d]:N);return g}function yc(a){return le(a)?a:[]}function zc(a){return"function"==typeof a?a:Ne}function Ac(a,b){return fh(a)?a:Cd(a,b)?[a]:ug(Ce(a))}function Bc(a,b,c){var d=a.length;return c=c===N?d:c,!b&&c>=d?a:lc(a,b,c)}function Cc(a,b){if(b)return a.slice();var c=a.length,c=qf?qf(c):new a.constructor(c);return a.copy(c),c}function Dc(a){var b=new a.constructor(a.byteLength);return new pf(b).set(new pf(a)),b}function Ec(a,b){return new a.constructor(b?Dc(a.buffer):a.buffer,a.byteOffset,a.length)}function Fc(a,b){if(a!==b){var c=a!==N,d=null===a,e=a===a,f=ve(a),g=b!==N,h=null===b,i=b===b,j=ve(b);if(!h&&!j&&!f&&a>b||f&&g&&i&&!h&&!j||d&&g&&i||!c&&i||!e)return 1;if(!d&&!f&&!j&&a<b||j&&c&&e&&!d&&!f||h&&c&&e||!g&&e||!i)return-1}return 0}function Gc(a,b,c,d){var e=-1,f=a.length,g=c.length,h=-1,i=b.length,j=Jf(f-g,0),k=Ue(i+j);for(d=!d;++h<i;)k[h]=b[h];for(;++e<g;)(d||e<f)&&(k[c[e]]=a[e]);for(;j--;)k[h++]=a[e++];return k}function Hc(a,b,c,d){var e=-1,f=a.length,g=-1,h=c.length,i=-1,j=b.length,k=Jf(f-h,0),l=Ue(k+j);for(d=!d;++e<k;)l[e]=a[e];for(k=e;++i<j;)l[k+i]=b[i];for(;++g<h;)(d||e<f)&&(l[k+c[g]]=a[e++]);return l}function Ic(a,b){var c=-1,d=a.length;for(b||(b=Ue(d));++c<d;)b[c]=a[c];return b}function Jc(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):N;i===N&&(i=a[h]),e?kb(c,h,i):fb(c,h,i)}return c}function Kc(a,b){return Jc(a,ng(a),b)}function Lc(a,b){return Jc(a,og(a),b)}function Mc(a,c){return function(d,e){var f=fh(d)?b:hb,g=c?c():{};return f(d,a,rd(e,2),g)}}function Nc(a){return gc(function(b,c){var d=-1,e=c.length,f=1<e?c[e-1]:N,g=2<e?c[2]:N,f=3<a.length&&"function"==typeof f?(e--,f):N;for(g&&Bd(c[0],c[1],g)&&(f=3>e?N:f,e=1),b=Ze(b);++d<e;)(g=c[d])&&a(b,g,d,f);return b})}function Oc(a,b){return function(c,d){if(null==c)return c;if(!ke(c))return a(c,d);for(var e=c.length,f=b?e:-1,g=Ze(c);(b?f--:++f<e)&&!1!==d(g[f],f,g););return c}}function Pc(a){return function(b,c,d){var e=-1,f=Ze(b);d=d(b);for(var g=d.length;g--;){var h=d[a?g:++e];if(!1===c(f[h],h,f))break}return b}}function Qc(a,b,c){function d(){return(this&&this!==Na&&this instanceof d?f:a).apply(e?c:this,arguments)}var e=1&b,f=Tc(a);return d}function Rc(a){return function(b){b=Ce(b);var c=Da.test(b)?M(b):N,d=c?c[0]:b.charAt(0);return b=c?Bc(c,1).join(""):b.slice(1),d[a]()+b}}function Sc(a){return function(b){return k(Le(Ke(b).replace(za,"")),a,"")}}function Tc(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=dg(a.prototype),b=a.apply(c,b);return qe(b)?b:c}}function Uc(b,c,d){function e(){for(var g=arguments.length,h=Ue(g),i=g,j=qd(e);i--;)h[i]=arguments[i];return i=3>g&&h[0]!==j&&h[g-1]!==j?[]:I(h,j),g-=i.length,g<d?dd(b,c,Xc,e.placeholder,N,h,i,N,N,d-g):a(this&&this!==Na&&this instanceof e?f:b,this,h)}var f=Tc(b);return e}function Vc(a){return function(b,c,d){var e=Ze(b);if(!ke(b)){var f=rd(c,3);b=Fe(b),c=function(a){return f(e[a],a,e)}}return c=a(b,c,d),-1<c?e[f?b[c]:c]:N}}function Wc(a){return md(function(b){var c=b.length,d=c,e=ya.prototype.thru;for(a&&b.reverse();d--;){var f=b[d];if("function"!=typeof f)throw new af("Expected a function");if(e&&!g&&"wrapper"==pd(f))var g=new ya([],(!0))}for(d=g?d:c;++d<c;)var f=b[d],e=pd(f),h="wrapper"==e?mg(f):N,g=h&&Dd(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?g[pd(h[0])].apply(g,h[3]):1==f.length&&Dd(f)?g[e]():g.thru(f);return function(){var a=arguments,d=a[0];if(g&&1==a.length&&fh(d))return g.plant(d).value();for(var e=0,a=c?b[e].apply(this,a):d;++e<c;)a=b[e].call(this,a);return a}})}function Xc(a,b,c,d,e,f,g,h,i,j){function k(){for(var r=arguments.length,s=Ue(r),t=r;t--;)s[t]=arguments[t];if(o){var u,v=qd(k),t=s.length;for(u=0;t--;)s[t]===v&&++u}if(d&&(s=Gc(s,d,e,o)),f&&(s=Hc(s,f,g,o)),r-=u,o&&r<j)return v=I(s,v),dd(a,b,Xc,k.placeholder,c,s,v,h,i,j-r);if(v=m?c:this,t=n?v[a]:a,r=s.length,h){u=s.length;for(var w=Kf(h.length,u),x=Ic(s);w--;){var y=h[w];s[w]=Ad(y,u)?x[y]:N}}else p&&1<r&&s.reverse();return l&&i<r&&(s.length=i),this&&this!==Na&&this instanceof k&&(t=q||Tc(t)),t.apply(v,s)}var l=128&b,m=1&b,n=2&b,o=24&b,p=512&b,q=n?N:Tc(a);return k}function Yc(a,b){return function(c,d){return Gb(c,a,b(d))}}function Zc(a,b){return function(c,d){var e;if(c===N&&d===N)return b;if(c!==N&&(e=c),d!==N){if(e===N)return d;"string"==typeof c||"string"==typeof d?(c=rc(c),d=rc(d)):(c=qc(c),d=qc(d)),e=a(c,d)}return e}}function $c(b){return md(function(c){return c=i(c,A(rd())),gc(function(d){var e=this;return b(c,function(b){return a(b,e,d)})})})}function _c(a,b){b=b===N?" ":rc(b);var c=b.length;return 2>c?c?fc(b,a):b:(c=fc(b,Cf(a/L(b))),Da.test(b)?Bc(M(c),0,a).join(""):c.slice(0,a))}function ad(b,c,d,e){function f(){for(var c=-1,i=arguments.length,j=-1,k=e.length,l=Ue(k+i),m=this&&this!==Na&&this instanceof f?h:b;++j<k;)l[j]=e[j];for(;i--;)l[j++]=arguments[++c];return a(m,g?d:this,l)}var g=1&c,h=Tc(b);return f}function bd(a){return function(b,c,d){d&&"number"!=typeof d&&Bd(b,c,d)&&(c=d=N),b=xe(b),c===N?(c=b,b=0):c=xe(c),d=d===N?b<c?1:-1:xe(d);var e=-1;c=Jf(Cf((c-b)/(d||1)),0);for(var f=Ue(c);c--;)f[a?c:++e]=b,b+=d;return f}}function cd(a){return function(b,c){return"string"==typeof b&&"string"==typeof c||(b=Ae(b),c=Ae(c)),a(b,c)}}function dd(a,b,c,d,e,f,g,h,i,j){var k=8&b,l=k?g:N;g=k?N:g;var m=k?f:N;return f=k?N:f,b=(b|(k?32:64))&~(k?64:32),4&b||(b&=-4),e=[a,b,e,m,l,f,g,h,i,j],c=c.apply(N,e),Dd(a)&&rg(c,e),c.placeholder=d,Id(c,a,b)}function ed(a){var b=Ye[a];return function(a,c){if(a=Ae(a),(c=null==c?0:Kf(ye(c),292))&&Gf(a)){var d=(Ce(a)+"e").split("e"),d=b(d[0]+"e"+(+d[1]+c)),d=(Ce(d)+"e").split("e");return+(d[0]+"e"+(+d[1]-c))}return b(a)}}function fd(a){return function(b){var c=pg(b);return"[object Map]"==c?G(b):"[object Set]"==c?K(b):z(b,a(b))}}function gd(a,b,c,d,e,f,g,h){var i=2&b;if(!i&&"function"!=typeof a)throw new af("Expected a function");var j=d?d.length:0;if(j||(b&=-97,d=e=N),g=g===N?g:Jf(ye(g),0),h=h===N?h:ye(h),j-=e?e.length:0,64&b){var k=d,l=e;d=e=N}var m=i?N:mg(a);return f=[a,b,c,d,e,k,l,f,g,h],m&&(c=f[1],a=m[1],b=c|a,d=128==a&&8==c||128==a&&256==c&&f[7].length<=m[8]||384==a&&m[7].length<=m[8]&&8==c,131>b||d)&&(1&a&&(f[2]=m[2],b|=1&c?0:4),(c=m[3])&&(d=f[3],f[3]=d?Gc(d,c,m[4]):c,f[4]=d?I(f[3],"__lodash_placeholder__"):m[4]),(c=m[5])&&(d=f[5],f[5]=d?Hc(d,c,m[6]):c,f[6]=d?I(f[5],"__lodash_placeholder__"):m[6]),(c=m[7])&&(f[7]=c),128&a&&(f[8]=null==f[8]?m[8]:Kf(f[8],m[8])),null==f[9]&&(f[9]=m[9]),f[0]=m[0],f[1]=b),a=f[0],b=f[1],c=f[2],d=f[3],e=f[4],h=f[9]=f[9]===N?i?0:a.length:Jf(f[9]-j,0),!h&&24&b&&(b&=-25),Id((m?ig:rg)(b&&1!=b?8==b||16==b?Uc(a,b,h):32!=b&&33!=b||e.length?Xc.apply(N,f):ad(a,b,c,d):Qc(a,b,c),f),a,b)}function hd(a,b,c,d){return a===N||je(a,cf[c])&&!ff.call(d,c)?b:a}function id(a,b,c,d,e,f){return qe(a)&&qe(b)&&(f.set(b,a),Yb(a,b,N,id,f),f["delete"](b)),a}function jd(a){return te(a)?N:a}function kd(a,b,c,d,e,f){var g=1&c,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;if((i=f.get(a))&&f.get(b))return i==b;var i=-1,j=!0,k=2&c?new Oa:N;for(f.set(a,b),f.set(b,a);++i<h;){var l=a[i],n=b[i];if(d)var o=g?d(n,l,i,b,a,f):d(l,n,i,a,b,f);if(o!==N){if(o)continue;j=!1;break}if(k){if(!m(b,function(a,b){if(!C(k,b)&&(l===a||e(l,a,c,d,f)))return k.push(b)})){j=!1;break}}else if(l!==n&&!e(l,n,c,d,f)){j=!1;break}}return f["delete"](a),f["delete"](b),j}function ld(a,b,c,d,e,f,g){switch(c){case"[object DataView]":if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer,b=b.buffer;case"[object ArrayBuffer]":if(a.byteLength!=b.byteLength||!f(new pf(a),new pf(b)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return je(+a,+b);case"[object Error]":return a.name==b.name&&a.message==b.message;case"[object RegExp]":case"[object String]":return a==b+"";case"[object Map]":var h=G;case"[object Set]":if(h||(h=J),a.size!=b.size&&!(1&d))break;return(c=g.get(a))?c==b:(d|=2,g.set(a,b),b=kd(h(a),h(b),d,e,f,g),g["delete"](a),b);case"[object Symbol]":if(bg)return bg.call(a)==bg.call(b)}return!1}function md(a){return tg(Gd(a,N,Rd),a+"")}function nd(a){return Ab(a,Fe,ng)}function od(a){return Ab(a,Ge,og)}function pd(a){for(var b=a.name+"",c=Wf[b],d=ff.call(Wf,b)?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function qd(a){return(ff.call(wa,"placeholder")?wa:a).placeholder}function rd(){var a=wa.iteratee||Oe,a=a===Oe?Sb:a;return arguments.length?a(arguments[0],arguments[1]):a}function sd(a,b){var c=a.__data__,d=typeof b;return("string"==d||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==b:null===b)?c["string"==typeof b?"string":"hash"]:c.map}function td(a){for(var b=Fe(a),c=b.length;c--;){var d=b[c],e=a[d];b[c]=[d,e,e===e&&!qe(e)]}return b}function ud(a,b){var c=null==a?N:a[b];return Ob(c)?c:N}function vd(a,b,c){b=Ac(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=Ld(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f||++d!=e?f:(e=null==a?0:a.length,!!e&&pe(e)&&Ad(g,e)&&(fh(a)||eh(a)))}function wd(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&ff.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function xd(a){return"function"!=typeof a.constructor||Ed(a)?{}:dg(rf(a))}function yd(a,b,c){var d=a.constructor;switch(b){case"[object ArrayBuffer]":return Dc(a);case"[object Boolean]":case"[object Date]":return new d((+a));case"[object DataView]":return b=c?Dc(a.buffer):a.buffer,new a.constructor(b,a.byteOffset,a.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ec(a,c);case"[object Map]":return new d;case"[object Number]":case"[object String]":return new d(a);case"[object RegExp]":return b=new a.constructor(a.source,na.exec(a)),b.lastIndex=a.lastIndex,b;case"[object Set]":return new d;case"[object Symbol]":return bg?Ze(bg.call(a)):{}}}function zd(a){return fh(a)||eh(a)||!!(vf&&a&&a[vf])}function Ad(a,b){var c=typeof a;return b=null==b?9007199254740991:b,!!b&&("number"==c||"symbol"!=c&&sa.test(a))&&-1<a&&0==a%1&&a<b}function Bd(a,b,c){if(!qe(c))return!1;var d=typeof b;return!!("number"==d?ke(c)&&Ad(b,c.length):"string"==d&&b in c)&&je(c[b],a)}function Cd(a,b){if(fh(a))return!1;var c=typeof a;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=a&&!ve(a))||aa.test(a)||!_.test(a)||null!=b&&a in Ze(b)}function Dd(a){var b=pd(a),c=wa[b];return"function"==typeof c&&b in Ba.prototype&&(a===c||(b=mg(c),!!b&&a===b[0]))}function Ed(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||cf)}function Fd(a,b){return function(c){return null!=c&&c[a]===b&&(b!==N||a in Ze(c))}}function Gd(b,c,d){return c=Jf(c===N?b.length-1:c,0),function(){for(var e=arguments,f=-1,g=Jf(e.length-c,0),h=Ue(g);++f<g;)h[f]=e[c+f];for(f=-1,g=Ue(c+1);++f<c;)g[f]=e[f];return g[c]=d(h),a(b,this,g)}}function Hd(a,b){if(("constructor"!==b||"function"!=typeof a[b])&&"__proto__"!=b)return a[b]}function Id(a,b,c){var d=b+"";b=tg;var e,f=Nd;return e=(e=d.match(ia))?e[1].split(ja):[],c=f(e,c),(f=c.length)&&(e=f-1,c[e]=(1<f?"& ":"")+c[e],c=c.join(2<f?", ":" "),d=d.replace(ha,"{\n/* [wrapped with "+c+"] */\n")),b(a,d)}function Jd(a){var b=0,c=0;return function(){var d=Lf(),e=16-(d-c);if(c=d,0<e){if(800<=++b)return arguments[0]}else b=0;return a.apply(N,arguments)}}function Kd(a,b){var c=-1,d=a.length,e=d-1;for(b=b===N?d:b;++c<b;){var d=ec(c,e),f=a[d];a[d]=a[c],a[c]=f}return a.length=b,a}function Ld(a){if("string"==typeof a||ve(a))return a;var b=a+"";return"0"==b&&1/a==-O?"-0":b}function Md(a){if(null!=a){try{return ef.call(a)}catch(a){}return a+""}return""}function Nd(a,b){return c(Q,function(c){var d="_."+c[0];b&c[1]&&!g(a,d)&&a.push(d)}),a.sort()}function Od(a){if(a instanceof Ba)return a.clone();var b=new ya(a.__wrapped__,a.__chain__);return b.__actions__=Ic(a.__actions__),b.__index__=a.__index__,b.__values__=a.__values__,b}function Pd(a,b,c){var d=null==a?0:a.length;return d?(c=null==c?0:ye(c),0>c&&(c=Jf(d+c,0)),o(a,rd(b,3),c)):-1}function Qd(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=d-1;return c!==N&&(e=ye(c),e=0>c?Jf(d+e,0):Kf(e,d-1)),o(a,rd(b,3),e,!0)}function Rd(a){return(null==a?0:a.length)?vb(a,1):[]}function Sd(a){return a&&a.length?a[0]:N}function Td(a){var b=null==a?0:a.length;return b?a[b-1]:N}function Ud(a,b){return a&&a.length&&b&&b.length?cc(a,b):a}function Vd(a){return null==a?a:Of.call(a)}function Wd(a){if(!a||!a.length)return[];var b=0;return a=f(a,function(a){if(le(a))return b=Jf(a.length,b),!0}),y(b,function(b){return i(a,t(b))})}function Xd(b,c){if(!b||!b.length)return[];var d=Wd(b);return null==c?d:i(d,function(b){return a(c,N,b)})}function Yd(a){return a=wa(a),a.__chain__=!0,a}function Zd(a,b){return b(a)}function $d(){return this}function _d(a,b){return(fh(a)?c:eg)(a,rd(b,3))}function ae(a,b){return(fh(a)?d:fg)(a,rd(b,3))}function be(a,b){return(fh(a)?i:Vb)(a,rd(b,3))}function ce(a,b,c){return b=c?N:b,b=a&&null==b?a.length:b,gd(a,128,N,N,N,N,b)}function de(a,b){var c;if("function"!=typeof b)throw new af("Expected a function");return a=ye(a),function(){return 0<--a&&(c=b.apply(this,arguments)),1>=a&&(b=N),c}}function ee(a,b,c){return b=c?N:b,a=gd(a,8,N,N,N,N,N,b),a.placeholder=ee.placeholder,a}function fe(a,b,c){return b=c?N:b,a=gd(a,16,N,N,N,N,N,b),a.placeholder=fe.placeholder,a}function ge(a,b,c){function d(b){var c=i,d=j;return i=j=N,o=b,l=a.apply(d,c)}function e(a){var c=a-n;return a-=o,n===N||c>=b||0>c||q&&a>=k}function f(){var a=Vg();if(e(a))return g(a);var c,d=sg;c=a-o,a=b-(a-n),c=q?Kf(a,k-c):a,m=d(f,c)}function g(a){return m=N,r&&i?d(a):(i=j=N,l)}function h(){var a=Vg(),c=e(a);if(i=arguments,j=this,n=a,c){if(m===N)return o=a=n,m=sg(f,b),p?d(a):l;if(q)return kg(m),m=sg(f,b),d(n)}return m===N&&(m=sg(f,b)),l}var i,j,k,l,m,n,o=0,p=!1,q=!1,r=!0;if("function"!=typeof a)throw new af("Expected a function");return b=Ae(b)||0,qe(c)&&(p=!!c.leading,k=(q="maxWait"in c)?Jf(Ae(c.maxWait)||0,b):k,r="trailing"in c?!!c.trailing:r),h.cancel=function(){m!==N&&kg(m),o=0,i=n=j=m=N},h.flush=function(){return m===N?l:g(Vg())},h}function he(a,b){function c(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;return f.has(e)?f.get(e):(d=a.apply(this,d),c.cache=f.set(e,d)||f,d)}if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new af("Expected a function");return c.cache=new(he.Cache||Ma),c}function ie(a){if("function"!=typeof a)throw new af("Expected a function");return function(){var b=arguments;switch(b.length){case 0:return!a.call(this);case 1:return!a.call(this,b[0]);case 2:return!a.call(this,b[0],b[1]);case 3:return!a.call(this,b[0],b[1],b[2])}return!a.apply(this,b)}}function je(a,b){return a===b||a!==a&&b!==b}function ke(a){return null!=a&&pe(a.length)&&!ne(a)}function le(a){return re(a)&&ke(a)}function me(a){if(!re(a))return!1;var b=Bb(a);return"[object Error]"==b||"[object DOMException]"==b||"string"==typeof a.message&&"string"==typeof a.name&&!te(a)}function ne(a){return!!qe(a)&&(a=Bb(a),"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a)}function oe(a){return"number"==typeof a&&a==ye(a)}function pe(a){return"number"==typeof a&&-1<a&&0==a%1&&9007199254740991>=a}function qe(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function re(a){return null!=a&&"object"==typeof a}function se(a){return"number"==typeof a||re(a)&&"[object Number]"==Bb(a)}function te(a){return!(!re(a)||"[object Object]"!=Bb(a))&&(a=rf(a),null===a||(a=ff.call(a,"constructor")&&a.constructor,"function"==typeof a&&a instanceof a&&ef.call(a)==kf))}function ue(a){return"string"==typeof a||!fh(a)&&re(a)&&"[object String]"==Bb(a)}function ve(a){return"symbol"==typeof a||re(a)&&"[object Symbol]"==Bb(a)}function we(a){if(!a)return[];if(ke(a))return ue(a)?M(a):Ic(a);if(wf&&a[wf]){a=a[wf]();for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}return b=pg(a),("[object Map]"==b?G:"[object Set]"==b?J:Ie)(a)}function xe(a){return a?(a=Ae(a),a===O||a===-O?1.7976931348623157e308*(0>a?-1:1):a===a?a:0):0===a?a:0}function ye(a){a=xe(a);var b=a%1;return a===a?b?a-b:a:0}function ze(a){return a?mb(ye(a),0,4294967295):0}function Ae(a){if("number"==typeof a)return a;if(ve(a))return P;if(qe(a)&&(a="function"==typeof a.valueOf?a.valueOf():a,a=qe(a)?a+"":a),"string"!=typeof a)return 0===a?a:+a;a=a.replace(ea,"");var b=pa.test(a);return b||ra.test(a)?Ka(a.slice(2),b?2:8):oa.test(a)?P:+a}function Be(a){return Jc(a,Ge(a))}function Ce(a){return null==a?"":rc(a)}function De(a,b,c){return a=null==a?N:zb(a,b),a===N?c:a}function Ee(a,b){return null!=a&&vd(a,b,Eb)}function Fe(a){return ke(a)?Ra(a):Tb(a)}function Ge(a){if(ke(a))a=Ra(a,!0);else if(qe(a)){var b,c=Ed(a),d=[];for(b in a)("constructor"!=b||!c&&ff.call(a,b))&&d.push(b);a=d}else{if(b=[],null!=a)for(c in Ze(a))b.push(c);a=b}return a}function He(a,b){if(null==a)return{};var c=i(od(a),function(a){return[a]});return b=rd(b),ac(a,c,function(a,c){return b(a,c[0])})}function Ie(a){return null==a?[]:B(a,Fe(a))}function Je(a){return Mh(Ce(a).toLowerCase())}function Ke(a){return(a=Ce(a))&&a.replace(ta,$a).replace(Aa,"")}function Le(a,b,c){return a=Ce(a),b=c?N:b,b===N?Ea.test(a)?a.match(Ca)||[]:a.match(ka)||[]:a.match(b)||[]}function Me(a){return function(){return a}}function Ne(a){return a}function Oe(a){return Sb("function"==typeof a?a:nb(a,1))}function Pe(a,b,d){var e=Fe(b),f=yb(b,e);null!=d||qe(b)&&(f.length||!e.length)||(d=b,b=a,a=this,f=yb(b,Fe(b)));var g=!(qe(d)&&"chain"in d&&!d.chain),h=ne(a);return c(f,function(c){var d=b[c];a[c]=d,h&&(a.prototype[c]=function(){var b=this.__chain__;if(g||b){var c=a(this.__wrapped__);return(c.__actions__=Ic(this.__actions__)).push({func:d,args:arguments,thisArg:a}),c.__chain__=b,c}return d.apply(a,j([this.value()],arguments))})}),a}function Qe(){}function Re(a){return Cd(a)?t(Ld(a)):bc(a)}function Se(){return[]}function Te(){return!1}u=null==u?Na:bb.defaults(Na.Object(),u,bb.pick(Na,Fa));var Ue=u.Array,Ve=u.Date,We=u.Error,Xe=u.Function,Ye=u.Math,Ze=u.Object,$e=u.RegExp,_e=u.String,af=u.TypeError,bf=Ue.prototype,cf=Ze.prototype,df=u["__core-js_shared__"],ef=Xe.prototype.toString,ff=cf.hasOwnProperty,gf=0,hf=function(){var a=/[^.]+$/.exec(df&&df.keys&&df.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),jf=cf.toString,kf=ef.call(Ze),lf=Na._,mf=$e("^"+ef.call(ff).replace(ca,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nf=Qa?u.Buffer:N,of=u.Symbol,pf=u.Uint8Array,qf=nf?nf.g:N,rf=H(Ze.getPrototypeOf,Ze),sf=Ze.create,tf=cf.propertyIsEnumerable,uf=bf.splice,vf=of?of.isConcatSpreadable:N,wf=of?of.iterator:N,xf=of?of.toStringTag:N,yf=function(){try{var a=ud(Ze,"defineProperty");return a({},"",{}),a}catch(a){}}(),zf=u.clearTimeout!==Na.clearTimeout&&u.clearTimeout,Af=Ve&&Ve.now!==Na.Date.now&&Ve.now,Bf=u.setTimeout!==Na.setTimeout&&u.setTimeout,Cf=Ye.ceil,Df=Ye.floor,Ef=Ze.getOwnPropertySymbols,Ff=nf?nf.isBuffer:N,Gf=u.isFinite,Hf=bf.join,If=H(Ze.keys,Ze),Jf=Ye.max,Kf=Ye.min,Lf=Ve.now,Mf=u.parseInt,Nf=Ye.random,Of=bf.reverse,Pf=ud(u,"DataView"),Qf=ud(u,"Map"),Rf=ud(u,"Promise"),Sf=ud(u,"Set"),Tf=ud(u,"WeakMap"),Uf=ud(Ze,"create"),Vf=Tf&&new Tf,Wf={},Xf=Md(Pf),Yf=Md(Qf),Zf=Md(Rf),$f=Md(Sf),_f=Md(Tf),ag=of?of.prototype:N,bg=ag?ag.valueOf:N,cg=ag?ag.toString:N,dg=function(){function a(){}return function(b){return qe(b)?sf?sf(b):(a.prototype=b,b=new a,a.prototype=N,b):{}}}();wa.templateSettings={escape:Y,evaluate:Z,interpolate:$,variable:"",imports:{_:wa}},wa.prototype=xa.prototype,wa.prototype.constructor=wa,ya.prototype=dg(xa.prototype),ya.prototype.constructor=ya,Ba.prototype=dg(xa.prototype),Ba.prototype.constructor=Ba,Ia.prototype.clear=function(){this.__data__=Uf?Uf(null):{},this.size=0},Ia.prototype["delete"]=function(a){return a=this.has(a)&&delete this.__data__[a],this.size-=a?1:0,a},Ia.prototype.get=function(a){var b=this.__data__;return Uf?(a=b[a],"__lodash_hash_undefined__"===a?N:a):ff.call(b,a)?b[a]:N},Ia.prototype.has=function(a){var b=this.__data__;return Uf?b[a]!==N:ff.call(b,a)},Ia.prototype.set=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=Uf&&b===N?"__lodash_hash_undefined__":b,this},La.prototype.clear=function(){this.__data__=[],this.size=0},La.prototype["delete"]=function(a){var b=this.__data__;return a=gb(b,a),!(0>a||(a==b.length-1?b.pop():uf.call(b,a,1),--this.size,0))},La.prototype.get=function(a){var b=this.__data__;return a=gb(b,a),0>a?N:b[a][1]},La.prototype.has=function(a){return-1<gb(this.__data__,a)},La.prototype.set=function(a,b){var c=this.__data__,d=gb(c,a);return 0>d?(++this.size,c.push([a,b])):c[d][1]=b,this},Ma.prototype.clear=function(){this.size=0,this.__data__={hash:new Ia,map:new(Qf||La),string:new Ia}},Ma.prototype["delete"]=function(a){return a=sd(this,a)["delete"](a),this.size-=a?1:0,a},Ma.prototype.get=function(a){return sd(this,a).get(a)},Ma.prototype.has=function(a){return sd(this,a).has(a)},Ma.prototype.set=function(a,b){var c=sd(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this},Oa.prototype.add=Oa.prototype.push=function(a){return this.__data__.set(a,"__lodash_hash_undefined__"),this},Oa.prototype.has=function(a){return this.__data__.has(a)},Pa.prototype.clear=function(){this.__data__=new La,this.size=0},Pa.prototype["delete"]=function(a){var b=this.__data__;return a=b["delete"](a),this.size=b.size,a},Pa.prototype.get=function(a){return this.__data__.get(a)},Pa.prototype.has=function(a){return this.__data__.has(a)},Pa.prototype.set=function(a,b){var c=this.__data__;if(c instanceof La){var d=c.__data__;if(!Qf||199>d.length)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new Ma(d)}return c.set(a,b),this.size=c.size,this};var eg=Oc(wb),fg=Oc(xb,!0),gg=Pc(),hg=Pc(!0),ig=Vf?function(a,b){return Vf.set(a,b),a}:Ne,jg=yf?function(a,b){return yf(a,"toString",{configurable:!0,enumerable:!1,value:Me(b),writable:!0})}:Ne,kg=zf||function(a){return Na.clearTimeout(a)},lg=Sf&&1/J(new Sf([,-0]))[1]==O?function(a){return new Sf(a)}:Qe,mg=Vf?function(a){return Vf.get(a)}:Qe,ng=Ef?function(a){return null==a?[]:(a=Ze(a),f(Ef(a),function(b){return tf.call(a,b)}))}:Se,og=Ef?function(a){for(var b=[];a;)j(b,ng(a)),a=rf(a);return b}:Se,pg=Bb;(Pf&&"[object DataView]"!=pg(new Pf(new ArrayBuffer(1)))||Qf&&"[object Map]"!=pg(new Qf)||Rf&&"[object Promise]"!=pg(Rf.resolve())||Sf&&"[object Set]"!=pg(new Sf)||Tf&&"[object WeakMap]"!=pg(new Tf))&&(pg=function(a){var b=Bb(a);if(a=(a="[object Object]"==b?a.constructor:N)?Md(a):"")switch(a){case Xf:return"[object DataView]";case Yf:return"[object Map]";case Zf:return"[object Promise]";case $f:return"[object Set]";case _f:return"[object WeakMap]"}return b});var qg=df?ne:Te,rg=Jd(ig),sg=Bf||function(a,b){return Na.setTimeout(a,b)},tg=Jd(jg),ug=function(a){a=he(a,function(a){return 500===b.size&&b.clear(),a});var b=a.cache;return a}(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(ba,function(a,c,d,e){b.push(d?e.replace(la,"$1"):c||a)}),b}),vg=gc(function(a,b){return le(a)?rb(a,vb(b,1,le,!0)):[]}),wg=gc(function(a,b){var c=Td(b);return le(c)&&(c=N),le(a)?rb(a,vb(b,1,le,!0),rd(c,2)):[]}),xg=gc(function(a,b){var c=Td(b);return le(c)&&(c=N),le(a)?rb(a,vb(b,1,le,!0),N,c):[]}),yg=gc(function(a){var b=i(a,yc);return b.length&&b[0]===a[0]?Fb(b):[]}),zg=gc(function(a){var b=Td(a),c=i(a,yc);return b===Td(c)?b=N:c.pop(),c.length&&c[0]===a[0]?Fb(c,rd(b,2)):[]}),Ag=gc(function(a){var b=Td(a),c=i(a,yc);return(b="function"==typeof b?b:N)&&c.pop(),c.length&&c[0]===a[0]?Fb(c,N,b):[]}),Bg=gc(Ud),Cg=md(function(a,b){var c=null==a?0:a.length,d=lb(a,b);return dc(a,i(b,function(a){return Ad(a,c)?+a:a}).sort(Fc)),d}),Dg=gc(function(a){return sc(vb(a,1,le,!0))}),Eg=gc(function(a){var b=Td(a);return le(b)&&(b=N),sc(vb(a,1,le,!0),rd(b,2))}),Fg=gc(function(a){var b=Td(a),b="function"==typeof b?b:N;return sc(vb(a,1,le,!0),N,b)}),Gg=gc(function(a,b){return le(a)?rb(a,b):[]}),Hg=gc(function(a){return wc(f(a,le))}),Ig=gc(function(a){var b=Td(a);return le(b)&&(b=N),wc(f(a,le),rd(b,2))}),Jg=gc(function(a){var b=Td(a),b="function"==typeof b?b:N;return wc(f(a,le),N,b)}),Kg=gc(Wd),Lg=gc(function(a){var b=a.length,b=1<b?a[b-1]:N,b="function"==typeof b?(a.pop(),b):N;return Xd(a,b)}),Mg=md(function(a){function b(b){return lb(b,a)}var c=a.length,d=c?a[0]:0,e=this.__wrapped__;return!(1<c||this.__actions__.length)&&e instanceof Ba&&Ad(d)?(e=e.slice(d,+d+(c?1:0)),e.__actions__.push({func:Zd,args:[b],thisArg:N}),new ya(e,this.__chain__).thru(function(a){return c&&!a.length&&a.push(N),a})):this.thru(b)}),Ng=Mc(function(a,b,c){ff.call(a,c)?++a[c]:kb(a,c,1)}),Og=Vc(Pd),Pg=Vc(Qd),Qg=Mc(function(a,b,c){ff.call(a,c)?a[c].push(b):kb(a,c,[b])}),Rg=gc(function(b,c,d){var e=-1,f="function"==typeof c,g=ke(b)?Ue(b.length):[];return eg(b,function(b){g[++e]=f?a(c,b,d):Hb(b,c,d)}),g}),Sg=Mc(function(a,b,c){kb(a,c,b)}),Tg=Mc(function(a,b,c){a[c?0:1].push(b)},function(){return[[],[]]}),Ug=gc(function(a,b){if(null==a)return[];var c=b.length;return 1<c&&Bd(a,b[0],b[1])?b=[]:2<c&&Bd(b[0],b[1],b[2])&&(b=[b[0]]),$b(a,vb(b,1),[])}),Vg=Af||function(){return Na.Date.now()},Wg=gc(function(a,b,c){var d=1;if(c.length)var e=I(c,qd(Wg)),d=32|d;return gd(a,d,b,c,e)}),Xg=gc(function(a,b,c){var d=3;if(c.length)var e=I(c,qd(Xg)),d=32|d;return gd(b,d,a,c,e)}),Yg=gc(function(a,b){return qb(a,1,b)}),Zg=gc(function(a,b,c){return qb(a,Ae(b)||0,c)});he.Cache=Ma;var $g=gc(function(b,c){c=1==c.length&&fh(c[0])?i(c[0],A(rd())):i(vb(c,1),A(rd()));var d=c.length;return gc(function(e){for(var f=-1,g=Kf(e.length,d);++f<g;)e[f]=c[f].call(this,e[f]);return a(b,this,e)})}),_g=gc(function(a,b){return gd(a,32,N,b,I(b,qd(_g)))}),ah=gc(function(a,b){return gd(a,64,N,b,I(b,qd(ah)))}),bh=md(function(a,b){return gd(a,256,N,N,N,b)}),ch=cd(Cb),dh=cd(function(a,b){return a>=b}),eh=Ib(function(){return arguments}())?Ib:function(a){return re(a)&&ff.call(a,"callee")&&!tf.call(a,"callee")},fh=Ue.isArray,gh=Ta?A(Ta):Jb,hh=Ff||Te,ih=Ua?A(Ua):Kb,jh=Va?A(Va):Mb,kh=Wa?A(Wa):Pb,lh=Xa?A(Xa):Qb,mh=Ya?A(Ya):Rb,nh=cd(Ub),oh=cd(function(a,b){return a<=b}),ph=Nc(function(a,b){if(Ed(b)||ke(b))Jc(b,Fe(b),a);else for(var c in b)ff.call(b,c)&&fb(a,c,b[c])}),qh=Nc(function(a,b){Jc(b,Ge(b),a)}),rh=Nc(function(a,b,c,d){Jc(b,Ge(b),a,d)}),sh=Nc(function(a,b,c,d){Jc(b,Fe(b),a,d)}),th=md(lb),uh=gc(function(a,b){a=Ze(a);var c=-1,d=b.length,e=2<d?b[2]:N;for(e&&Bd(b[0],b[1],e)&&(d=1);++c<d;)for(var e=b[c],f=Ge(e),g=-1,h=f.length;++g<h;){var i=f[g],j=a[i];(j===N||je(j,cf[i])&&!ff.call(a,i))&&(a[i]=e[i])}return a}),vh=gc(function(b){return b.push(N,id),a(Ah,N,b)}),wh=Yc(function(a,b,c){null!=b&&"function"!=typeof b.toString&&(b=jf.call(b)),a[b]=c},Me(Ne)),xh=Yc(function(a,b,c){null!=b&&"function"!=typeof b.toString&&(b=jf.call(b)),ff.call(a,b)?a[b].push(c):a[b]=[c]},rd),yh=gc(Hb),zh=Nc(function(a,b,c){Yb(a,b,c)}),Ah=Nc(function(a,b,c,d){Yb(a,b,c,d)}),Bh=md(function(a,b){var c={};if(null==a)return c;var d=!1;b=i(b,function(b){return b=Ac(b,a),d||(d=1<b.length),b}),Jc(a,od(a),c),d&&(c=nb(c,7,jd));for(var e=b.length;e--;)tc(c,b[e]);return c}),Ch=md(function(a,b){return null==a?{}:_b(a,b)}),Dh=fd(Fe),Eh=fd(Ge),Fh=Sc(function(a,b,c){return b=b.toLowerCase(),a+(c?Je(b):b)}),Gh=Sc(function(a,b,c){return a+(c?"-":"")+b.toLowerCase()}),Hh=Sc(function(a,b,c){return a+(c?" ":"")+b.toLowerCase()}),Ih=Rc("toLowerCase"),Jh=Sc(function(a,b,c){
return a+(c?"_":"")+b.toLowerCase()}),Kh=Sc(function(a,b,c){return a+(c?" ":"")+Mh(b)}),Lh=Sc(function(a,b,c){return a+(c?" ":"")+b.toUpperCase()}),Mh=Rc("toUpperCase"),Nh=gc(function(a,b){try{return c(a,N,b)}catch(c){return me(c)?c:new We(c)}}),Oh=md(function(a,b){return c(b,function(b){b=Ld(b),kb(a,b,Wg(a[b],a))}),a}),Ph=Wc(),Qh=Wc(!0),Rh=gc(function(a,b){return function(c){return Hb(c,a,b)}}),Sh=gc(function(a,b){return function(c){return Hb(a,c,b)}}),Th=$c(i),Uh=$c(e),Vh=$c(m),Wh=bd(),Xh=bd(!0),Yh=Zc(function(a,b){return a+b},0),Zh=ed("ceil"),$h=Zc(function(a,b){return a/b},1),_h=ed("floor"),ai=Zc(function(a,b){return a*b},1),bi=ed("round"),ci=Zc(function(a,b){return a-b},0);return wa.after=function(a,b){if("function"!=typeof b)throw new af("Expected a function");return a=ye(a),function(){if(1>--a)return b.apply(this,arguments)}},wa.ary=ce,wa.assign=ph,wa.assignIn=qh,wa.assignInWith=rh,wa.assignWith=sh,wa.at=th,wa.before=de,wa.bind=Wg,wa.bindAll=Oh,wa.bindKey=Xg,wa.castArray=function(){if(!arguments.length)return[];var a=arguments[0];return fh(a)?a:[a]},wa.chain=Yd,wa.chunk=function(a,b,c){if(b=(c?Bd(a,b,c):b===N)?1:Jf(ye(b),0),c=null==a?0:a.length,!c||1>b)return[];for(var d=0,e=0,f=Ue(Cf(c/b));d<c;)f[e++]=lc(a,d,d+=b);return f},wa.compact=function(a){for(var b=-1,c=null==a?0:a.length,d=0,e=[];++b<c;){var f=a[b];f&&(e[d++]=f)}return e},wa.concat=function(){var a=arguments.length;if(!a)return[];for(var b=Ue(a-1),c=arguments[0];a--;)b[a-1]=arguments[a];return j(fh(c)?Ic(c):[c],vb(b,1))},wa.cond=function(b){var c=null==b?0:b.length,d=rd();return b=c?i(b,function(a){if("function"!=typeof a[1])throw new af("Expected a function");return[d(a[0]),a[1]]}):[],gc(function(d){for(var e=-1;++e<c;){var f=b[e];if(a(f[0],this,d))return a(f[1],this,d)}})},wa.conforms=function(a){return ob(nb(a,1))},wa.constant=Me,wa.countBy=Ng,wa.create=function(a,b){var c=dg(a);return null==b?c:ib(c,b)},wa.curry=ee,wa.curryRight=fe,wa.debounce=ge,wa.defaults=uh,wa.defaultsDeep=vh,wa.defer=Yg,wa.delay=Zg,wa.difference=vg,wa.differenceBy=wg,wa.differenceWith=xg,wa.drop=function(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===N?1:ye(b),lc(a,0>b?0:b,d)):[]},wa.dropRight=function(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===N?1:ye(b),b=d-b,lc(a,0,0>b?0:b)):[]},wa.dropRightWhile=function(a,b){return a&&a.length?uc(a,rd(b,3),!0,!0):[]},wa.dropWhile=function(a,b){return a&&a.length?uc(a,rd(b,3),!0):[]},wa.fill=function(a,b,c,d){var e=null==a?0:a.length;if(!e)return[];for(c&&"number"!=typeof c&&Bd(a,b,c)&&(c=0,d=e),e=a.length,c=ye(c),0>c&&(c=-c>e?0:e+c),d=d===N||d>e?e:ye(d),0>d&&(d+=e),d=c>d?0:ze(d);c<d;)a[c++]=b;return a},wa.filter=function(a,b){return(fh(a)?f:ub)(a,rd(b,3))},wa.flatMap=function(a,b){return vb(be(a,b),1)},wa.flatMapDeep=function(a,b){return vb(be(a,b),sdk_$)},wa.flatMapDepth=function(a,b,c){return c=c===N?1:ye(c),vb(be(a,b),c)},wa.flatten=Rd,wa.flattenDeep=function(a){return(null==a?0:a.length)?vb(a,sdk_$):[]},wa.flattenDepth=function(a,b){return null!=a&&a.length?(b=b===N?1:ye(b),vb(a,b)):[]},wa.flip=function(a){return gd(a,512)},wa.flow=Ph,wa.flowRight=Qh,wa.fromPairs=function(a){for(var b=-1,c=null==a?0:a.length,d={};++b<c;){var e=a[b];d[e[0]]=e[1]}return d},wa.functions=function(a){return null==a?[]:yb(a,Fe(a))},wa.functionsIn=function(a){return null==a?[]:yb(a,Ge(a))},wa.groupBy=Qg,wa.initial=function(a){return(null==a?0:a.length)?lc(a,0,-1):[]},wa.intersection=yg,wa.intersectionBy=zg,wa.intersectionWith=Ag,wa.invert=wh,wa.invertBy=xh,wa.invokeMap=Rg,wa.iteratee=Oe,wa.keyBy=Sg,wa.keys=Fe,wa.keysIn=Ge,wa.map=be,wa.mapKeys=function(a,b){var c={};return b=rd(b,3),wb(a,function(a,d,e){kb(c,b(a,d,e),a)}),c},wa.mapValues=function(a,b){var c={};return b=rd(b,3),wb(a,function(a,d,e){kb(c,d,b(a,d,e))}),c},wa.matches=function(a){return Wb(nb(a,1))},wa.matchesProperty=function(a,b){return Xb(a,nb(b,1))},wa.memoize=he,wa.merge=zh,wa.mergeWith=Ah,wa.method=Rh,wa.methodOf=Sh,wa.mixin=Pe,wa.negate=ie,wa.nthArg=function(a){return a=ye(a),gc(function(b){return Zb(b,a)})},wa.omit=Bh,wa.omitBy=function(a,b){return He(a,ie(rd(b)))},wa.once=function(a){return de(2,a)},wa.orderBy=function(a,b,c,d){return null==a?[]:(fh(b)||(b=null==b?[]:[b]),c=d?N:c,fh(c)||(c=null==c?[]:[c]),$b(a,b,c))},wa.over=Th,wa.overArgs=$g,wa.overEvery=Uh,wa.overSome=Vh,wa.partial=_g,wa.partialRight=ah,wa.partition=Tg,wa.pick=Ch,wa.pickBy=He,wa.property=Re,wa.propertyOf=function(a){return function(b){return null==a?N:zb(a,b)}},wa.pull=Bg,wa.pullAll=Ud,wa.pullAllBy=function(a,b,c){return a&&a.length&&b&&b.length?cc(a,b,rd(c,2)):a},wa.pullAllWith=function(a,b,c){return a&&a.length&&b&&b.length?cc(a,b,N,c):a},wa.pullAt=Cg,wa.range=Wh,wa.rangeRight=Xh,wa.rearg=bh,wa.reject=function(a,b){return(fh(a)?f:ub)(a,ie(rd(b,3)))},wa.remove=function(a,b){var c=[];if(!a||!a.length)return c;var d=-1,e=[],f=a.length;for(b=rd(b,3);++d<f;){var g=a[d];b(g,d,a)&&(c.push(g),e.push(d))}return dc(a,e),c},wa.rest=function(a,b){if("function"!=typeof a)throw new af("Expected a function");return b=b===N?b:ye(b),gc(a,b)},wa.reverse=Vd,wa.sampleSize=function(a,b,c){return b=(c?Bd(a,b,c):b===N)?1:ye(b),(fh(a)?Za:ic)(a,b)},wa.set=function(a,b,c){return null==a?a:jc(a,b,c)},wa.setWith=function(a,b,c,d){return d="function"==typeof d?d:N,null==a?a:jc(a,b,c,d)},wa.shuffle=function(a){return(fh(a)?db:kc)(a)},wa.slice=function(a,b,c){var d=null==a?0:a.length;return d?(c&&"number"!=typeof c&&Bd(a,b,c)?(b=0,c=d):(b=null==b?0:ye(b),c=c===N?d:ye(c)),lc(a,b,c)):[]},wa.sortBy=Ug,wa.sortedUniq=function(a){return a&&a.length?pc(a):[]},wa.sortedUniqBy=function(a,b){return a&&a.length?pc(a,rd(b,2)):[]},wa.split=function(a,b,c){return c&&"number"!=typeof c&&Bd(a,b,c)&&(b=c=N),c=c===N?4294967295:c>>>0,c?(a=Ce(a))&&("string"==typeof b||null!=b&&!kh(b))&&(b=rc(b),!b&&Da.test(a))?Bc(M(a),0,c):a.split(b,c):[]},wa.spread=function(b,c){if("function"!=typeof b)throw new af("Expected a function");return c=null==c?0:Jf(ye(c),0),gc(function(d){var e=d[c];return d=Bc(d,0,c),e&&j(d,e),a(b,this,d)})},wa.tail=function(a){var b=null==a?0:a.length;return b?lc(a,1,b):[]},wa.take=function(a,b,c){return a&&a.length?(b=c||b===N?1:ye(b),lc(a,0,0>b?0:b)):[]},wa.takeRight=function(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===N?1:ye(b),b=d-b,lc(a,0>b?0:b,d)):[]},wa.takeRightWhile=function(a,b){return a&&a.length?uc(a,rd(b,3),!1,!0):[]},wa.takeWhile=function(a,b){return a&&a.length?uc(a,rd(b,3)):[]},wa.tap=function(a,b){return b(a),a},wa.throttle=function(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new af("Expected a function");return qe(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),ge(a,b,{leading:d,maxWait:b,trailing:e})},wa.thru=Zd,wa.toArray=we,wa.toPairs=Dh,wa.toPairsIn=Eh,wa.toPath=function(a){return fh(a)?i(a,Ld):ve(a)?[a]:Ic(ug(Ce(a)))},wa.toPlainObject=Be,wa.transform=function(a,b,d){var e=fh(a),f=e||hh(a)||mh(a);if(b=rd(b,4),null==d){var g=a&&a.constructor;d=f?e?new g:[]:qe(a)&&ne(g)?dg(rf(a)):{}}return(f?c:wb)(a,function(a,c,e){return b(d,a,c,e)}),d},wa.unary=function(a){return ce(a,1)},wa.union=Dg,wa.unionBy=Eg,wa.unionWith=Fg,wa.uniq=function(a){return a&&a.length?sc(a):[]},wa.uniqBy=function(a,b){return a&&a.length?sc(a,rd(b,2)):[]},wa.uniqWith=function(a,b){return b="function"==typeof b?b:N,a&&a.length?sc(a,N,b):[]},wa.unset=function(a,b){return null==a||tc(a,b)},wa.unzip=Wd,wa.unzipWith=Xd,wa.update=function(a,b,c){return null==a?a:jc(a,b,zc(c)(zb(a,b)),void 0)},wa.updateWith=function(a,b,c,d){return d="function"==typeof d?d:N,null!=a&&(a=jc(a,b,zc(c)(zb(a,b)),d)),a},wa.values=Ie,wa.valuesIn=function(a){return null==a?[]:B(a,Ge(a))},wa.without=Gg,wa.words=Le,wa.wrap=function(a,b){return _g(zc(b),a)},wa.xor=Hg,wa.xorBy=Ig,wa.xorWith=Jg,wa.zip=Kg,wa.zipObject=function(a,b){return xc(a||[],b||[],fb)},wa.zipObjectDeep=function(a,b){return xc(a||[],b||[],jc)},wa.zipWith=Lg,wa.entries=Dh,wa.entriesIn=Eh,wa.extend=qh,wa.extendWith=rh,Pe(wa,wa),wa.add=Yh,wa.attempt=Nh,wa.camelCase=Fh,wa.capitalize=Je,wa.ceil=Zh,wa.clamp=function(a,b,c){return c===N&&(c=b,b=N),c!==N&&(c=Ae(c),c=c===c?c:0),b!==N&&(b=Ae(b),b=b===b?b:0),mb(Ae(a),b,c)},wa.clone=function(a){return nb(a,4)},wa.cloneDeep=function(a){return nb(a,5)},wa.cloneDeepWith=function(a,b){return b="function"==typeof b?b:N,nb(a,5,b)},wa.cloneWith=function(a,b){return b="function"==typeof b?b:N,nb(a,4,b)},wa.conformsTo=function(a,b){return null==b||pb(a,b,Fe(b))},wa.deburr=Ke,wa.defaultTo=function(a,b){return null==a||a!==a?b:a},wa.divide=$h,wa.endsWith=function(a,b,c){a=Ce(a),b=rc(b);var d=a.length,d=c=c===N?d:mb(ye(c),0,d);return c-=b.length,0<=c&&a.slice(c,d)==b},wa.eq=je,wa.escape=function(a){return(a=Ce(a))&&X.test(a)?a.replace(V,_a):a},wa.escapeRegExp=function(a){return(a=Ce(a))&&da.test(a)?a.replace(ca,"\\$&"):a},wa.every=function(a,b,c){var d=fh(a)?e:sb;return c&&Bd(a,b,c)&&(b=N),d(a,rd(b,3))},wa.find=Og,wa.findIndex=Pd,wa.findKey=function(a,b){return n(a,rd(b,3),wb)},wa.findLast=Pg,wa.findLastIndex=Qd,wa.findLastKey=function(a,b){return n(a,rd(b,3),xb)},wa.floor=_h,wa.forEach=_d,wa.forEachRight=ae,wa.forIn=function(a,b){return null==a?a:gg(a,rd(b,3),Ge)},wa.forInRight=function(a,b){return null==a?a:hg(a,rd(b,3),Ge)},wa.forOwn=function(a,b){return a&&wb(a,rd(b,3))},wa.forOwnRight=function(a,b){return a&&xb(a,rd(b,3))},wa.get=De,wa.gt=ch,wa.gte=dh,wa.has=function(a,b){return null!=a&&vd(a,b,Db)},wa.hasIn=Ee,wa.head=Sd,wa.identity=Ne,wa.includes=function(a,b,c,d){return a=ke(a)?a:Ie(a),c=c&&!d?ye(c):0,d=a.length,0>c&&(c=Jf(d+c,0)),ue(a)?c<=d&&-1<a.indexOf(b,c):!!d&&-1<p(a,b,c)},wa.indexOf=function(a,b,c){var d=null==a?0:a.length;return d?(c=null==c?0:ye(c),0>c&&(c=Jf(d+c,0)),p(a,b,c)):-1},wa.inRange=function(a,b,c){return b=xe(b),c===N?(c=b,b=0):c=xe(c),a=Ae(a),a>=Kf(b,c)&&a<Jf(b,c)},wa.invoke=yh,wa.isArguments=eh,wa.isArray=fh,wa.isArrayBuffer=gh,wa.isArrayLike=ke,wa.isArrayLikeObject=le,wa.isBoolean=function(a){return!0===a||!1===a||re(a)&&"[object Boolean]"==Bb(a)},wa.isBuffer=hh,wa.isDate=ih,wa.isElement=function(a){return re(a)&&1===a.nodeType&&!te(a)},wa.isEmpty=function(a){if(null==a)return!0;if(ke(a)&&(fh(a)||"string"==typeof a||"function"==typeof a.splice||hh(a)||mh(a)||eh(a)))return!a.length;var b=pg(a);if("[object Map]"==b||"[object Set]"==b)return!a.size;if(Ed(a))return!Tb(a).length;for(var c in a)if(ff.call(a,c))return!1;return!0},wa.isEqual=function(a,b){return Lb(a,b)},wa.isEqualWith=function(a,b,c){var d=(c="function"==typeof c?c:N)?c(a,b):N;return d===N?Lb(a,b,N,c):!!d},wa.isError=me,wa.isFinite=function(a){return"number"==typeof a&&Gf(a)},wa.isFunction=ne,wa.isInteger=oe,wa.isLength=pe,wa.isMap=jh,wa.isMatch=function(a,b){return a===b||Nb(a,b,td(b))},wa.isMatchWith=function(a,b,c){return c="function"==typeof c?c:N,Nb(a,b,td(b),c)},wa.isNaN=function(a){return se(a)&&a!=+a},wa.isNative=function(a){if(qg(a))throw new We("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ob(a)},wa.isNil=function(a){return null==a},wa.isNull=function(a){return null===a},wa.isNumber=se,wa.isObject=qe,wa.isObjectLike=re,wa.isPlainObject=te,wa.isRegExp=kh,wa.isSafeInteger=function(a){return oe(a)&&-9007199254740991<=a&&9007199254740991>=a},wa.isSet=lh,wa.isString=ue,wa.isSymbol=ve,wa.isTypedArray=mh,wa.isUndefined=function(a){return a===N},wa.isWeakMap=function(a){return re(a)&&"[object WeakMap]"==pg(a)},wa.isWeakSet=function(a){return re(a)&&"[object WeakSet]"==Bb(a)},wa.join=function(a,b){return null==a?"":Hf.call(a,b)},wa.kebabCase=Gh,wa.last=Td,wa.lastIndexOf=function(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=d;if(c!==N&&(e=ye(c),e=0>e?Jf(d+e,0):Kf(e,d-1)),b===b){for(c=e+1;c--&&a[c]!==b;);a=c}else a=o(a,r,e,!0);return a},wa.lowerCase=Hh,wa.lowerFirst=Ih,wa.lt=nh,wa.lte=oh,wa.max=function(a){return a&&a.length?tb(a,Ne,Cb):N},wa.maxBy=function(a,b){return a&&a.length?tb(a,rd(b,2),Cb):N},wa.mean=function(a){return s(a,Ne)},wa.meanBy=function(a,b){return s(a,rd(b,2))},wa.min=function(a){return a&&a.length?tb(a,Ne,Ub):N},wa.minBy=function(a,b){return a&&a.length?tb(a,rd(b,2),Ub):N},wa.stubArray=Se,wa.stubFalse=Te,wa.stubObject=function(){return{}},wa.stubString=function(){return""},wa.stubTrue=function(){return!0},wa.multiply=ai,wa.nth=function(a,b){return a&&a.length?Zb(a,ye(b)):N},wa.noConflict=function(){return Na._===this&&(Na._=lf),this},wa.noop=Qe,wa.now=Vg,wa.pad=function(a,b,c){a=Ce(a);var d=(b=ye(b))?L(a):0;return!b||d>=b?a:(b=(b-d)/2,_c(Df(b),c)+a+_c(Cf(b),c))},wa.padEnd=function(a,b,c){a=Ce(a);var d=(b=ye(b))?L(a):0;return b&&d<b?a+_c(b-d,c):a},wa.padStart=function(a,b,c){a=Ce(a);var d=(b=ye(b))?L(a):0;return b&&d<b?_c(b-d,c)+a:a},wa.parseInt=function(a,b,c){return c||null==b?b=0:b&&(b=+b),Mf(Ce(a).replace(fa,""),b||0)},wa.random=function(a,b,c){if(c&&"boolean"!=typeof c&&Bd(a,b,c)&&(b=c=N),c===N&&("boolean"==typeof b?(c=b,b=N):"boolean"==typeof a&&(c=a,a=N)),a===N&&b===N?(a=0,b=1):(a=xe(a),b===N?(b=a,a=0):b=xe(b)),a>b){var d=a;a=b,b=d}return c||a%1||b%1?(c=Nf(),Kf(a+c*(b-a+Ja("1e-"+((c+"").length-1))),b)):ec(a,b)},wa.reduce=function(a,b,c){var d=fh(a)?k:v,e=3>arguments.length;return d(a,rd(b,4),c,e,eg)},wa.reduceRight=function(a,b,c){var d=fh(a)?l:v,e=3>arguments.length;return d(a,rd(b,4),c,e,fg)},wa.repeat=function(a,b,c){return b=(c?Bd(a,b,c):b===N)?1:ye(b),fc(Ce(a),b)},wa.replace=function(){var a=arguments,b=Ce(a[0]);return 3>a.length?b:b.replace(a[1],a[2])},wa.result=function(a,b,c){b=Ac(b,a);var d=-1,e=b.length;for(e||(e=1,a=N);++d<e;){var f=null==a?N:a[Ld(b[d])];f===N&&(d=e,f=c),a=ne(f)?f.call(a):f}return a},wa.round=bi,wa.runInContext=cb,wa.sample=function(a){return(fh(a)?Sa:hc)(a)},wa.size=function(a){if(null==a)return 0;if(ke(a))return ue(a)?L(a):a.length;var b=pg(a);return"[object Map]"==b||"[object Set]"==b?a.size:Tb(a).length},wa.snakeCase=Jh,wa.some=function(a,b,c){var d=fh(a)?m:mc;return c&&Bd(a,b,c)&&(b=N),d(a,rd(b,3))},wa.sortedIndex=function(a,b){return nc(a,b)},wa.sortedIndexBy=function(a,b,c){return oc(a,b,rd(c,2))},wa.sortedIndexOf=function(a,b){var c=null==a?0:a.length;if(c){var d=nc(a,b);if(d<c&&je(a[d],b))return d}return-1},wa.sortedLastIndex=function(a,b){return nc(a,b,!0)},wa.sortedLastIndexBy=function(a,b,c){return oc(a,b,rd(c,2),!0)},wa.sortedLastIndexOf=function(a,b){if(null==a?0:a.length){var c=nc(a,b,!0)-1;if(je(a[c],b))return c}return-1},wa.startCase=Kh,wa.startsWith=function(a,b,c){return a=Ce(a),c=null==c?0:mb(ye(c),0,a.length),b=rc(b),a.slice(c,c+b.length)==b},wa.subtract=ci,wa.sum=function(a){return a&&a.length?x(a,Ne):0},wa.sumBy=function(a,b){return a&&a.length?x(a,rd(b,2)):0},wa.template=function(a,b,c){var d=wa.templateSettings;c&&Bd(a,b,c)&&(b=N),a=Ce(a),b=rh({},b,d,hd),c=rh({},b.imports,d.imports,hd);var e,f,g=Fe(c),h=B(c,g),i=0;c=b.interpolate||ua;var j="__p+='";c=$e((b.escape||ua).source+"|"+c.source+"|"+(c===$?ma:ua).source+"|"+(b.evaluate||ua).source+"|$","g");var k=ff.call(b,"sourceURL")?"//# sourceURL="+(b.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";if(a.replace(c,function(b,c,d,g,h,k){return d||(d=g),j+=a.slice(i,k).replace(va,F),c&&(e=!0,j+="'+__e("+c+")+'"),h&&(f=!0,j+="';"+h+";\n__p+='"),d&&(j+="'+((__t=("+d+"))==null?'':__t)+'"),i=k+b.length,b}),j+="';",(b=ff.call(b,"variable")&&b.variable)||(j="with(obj){"+j+"}"),j=(f?j.replace(R,""):j).replace(S,"$1").replace(T,"$1;"),j="function("+(b||"obj")+"){"+(b?"":"obj||(obj={});")+"var __t,__p=''"+(e?",__e=_.escape":"")+(f?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+j+"return __p}",b=Nh(function(){return Xe(g,k+"return "+j).apply(N,h)}),b.source=j,me(b))throw b;return b},wa.times=function(a,b){if(a=ye(a),1>a||9007199254740991<a)return[];var c=4294967295,d=Kf(a,4294967295);for(b=rd(b),a-=4294967295,d=y(d,b);++c<a;)b(c);return d},wa.toFinite=xe,wa.toInteger=ye,wa.toLength=ze,wa.toLower=function(a){return Ce(a).toLowerCase()},wa.toNumber=Ae,wa.toSafeInteger=function(a){return a?mb(ye(a),-9007199254740991,9007199254740991):0===a?a:0},wa.toString=Ce,wa.toUpper=function(a){return Ce(a).toUpperCase()},wa.trim=function(a,b,c){return(a=Ce(a))&&(c||b===N)?a.replace(ea,""):a&&(b=rc(b))?(a=M(a),c=M(b),b=D(a,c),c=E(a,c)+1,Bc(a,b,c).join("")):a},wa.trimEnd=function(a,b,c){return(a=Ce(a))&&(c||b===N)?a.replace(ga,""):a&&(b=rc(b))?(a=M(a),b=E(a,M(b))+1,Bc(a,0,b).join("")):a},wa.trimStart=function(a,b,c){return(a=Ce(a))&&(c||b===N)?a.replace(fa,""):a&&(b=rc(b))?(a=M(a),b=D(a,M(b)),Bc(a,b).join("")):a},wa.truncate=function(a,b){var c=30,d="...";if(qe(b))var e="separator"in b?b.separator:e,c="length"in b?ye(b.length):c,d="omission"in b?rc(b.omission):d;a=Ce(a);var f=a.length;if(Da.test(a))var g=M(a),f=g.length;if(c>=f)return a;if(f=c-L(d),1>f)return d;if(c=g?Bc(g,0,f).join(""):a.slice(0,f),e===N)return c+d;if(g&&(f+=c.length-f),kh(e)){if(a.slice(f).search(e)){var h=c;for(e.global||(e=$e(e.source,Ce(na.exec(e))+"g")),e.lastIndex=0;g=e.exec(h);)var i=g.index;c=c.slice(0,i===N?f:i)}}else a.indexOf(rc(e),f)!=f&&(e=c.lastIndexOf(e),-1<e&&(c=c.slice(0,e)));return c+d},wa.unescape=function(a){return(a=Ce(a))&&W.test(a)?a.replace(U,ab):a},wa.uniqueId=function(a){var b=++gf;return Ce(a)+b},wa.upperCase=Lh,wa.upperFirst=Mh,wa.each=_d,wa.eachRight=ae,wa.first=Sd,Pe(wa,function(){var a={};return wb(wa,function(b,c){ff.call(wa.prototype,c)||(a[c]=b)}),a}(),{chain:!1}),wa.VERSION="4.17.15",c("bind bindKey curry curryRight partial partialRight".split(" "),function(a){wa[a].placeholder=wa}),c(["drop","take"],function(a,b){Ba.prototype[a]=function(c){c=c===N?1:Jf(ye(c),0);var d=this.__filtered__&&!b?new Ba(this):this.clone();return d.__filtered__?d.__takeCount__=Kf(c,d.__takeCount__):d.__views__.push({size:Kf(c,4294967295),type:a+(0>d.__dir__?"Right":"")}),d},Ba.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()}}),c(["filter","map","takeWhile"],function(a,b){var c=b+1,d=1==c||3==c;Ba.prototype[a]=function(a){var b=this.clone();return b.__iteratees__.push({iteratee:rd(a,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),c(["head","last"],function(a,b){var c="take"+(b?"Right":"");Ba.prototype[a]=function(){return this[c](1).value()[0]}}),c(["initial","tail"],function(a,b){var c="drop"+(b?"":"Right");Ba.prototype[a]=function(){return this.__filtered__?new Ba(this):this[c](1)}}),Ba.prototype.compact=function(){return this.filter(Ne)},Ba.prototype.find=function(a){return this.filter(a).head()},Ba.prototype.findLast=function(a){return this.reverse().find(a)},Ba.prototype.invokeMap=gc(function(a,b){return"function"==typeof a?new Ba(this):this.map(function(c){return Hb(c,a,b)})}),Ba.prototype.reject=function(a){return this.filter(ie(rd(a)))},Ba.prototype.slice=function(a,b){a=ye(a);var c=this;return c.__filtered__&&(0<a||0>b)?new Ba(c):(0>a?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==N&&(b=ye(b),c=0>b?c.dropRight(-b):c.take(b-a)),c)},Ba.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},Ba.prototype.toArray=function(){return this.take(4294967295)},wb(Ba.prototype,function(a,b){var c=/^(?:filter|find|map|reject)|While$/.test(b),d=/^(?:head|last)$/.test(b),e=wa[d?"take"+("last"==b?"Right":""):b],f=d||/^find/.test(b);e&&(wa.prototype[b]=function(){function b(a){return a=e.apply(wa,j([a],h)),d&&m?a[0]:a}var g=this.__wrapped__,h=d?[1]:arguments,i=g instanceof Ba,k=h[0],l=i||fh(g);l&&c&&"function"==typeof k&&1!=k.length&&(i=l=!1);var m=this.__chain__,n=!!this.__actions__.length,k=f&&!m,i=i&&!n;return!f&&l?(g=i?g:new Ba(this),g=a.apply(g,h),g.__actions__.push({func:Zd,args:[b],thisArg:N}),new ya(g,m)):k&&i?a.apply(this,h):(g=this.thru(b),k?d?g.value()[0]:g.value():g)})}),c("pop push shift sort splice unshift".split(" "),function(a){var b=bf[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:pop|shift)$/.test(a);wa.prototype[a]=function(){var a=arguments;if(d&&!this.__chain__){var e=this.value();return b.apply(fh(e)?e:[],a)}return this[c](function(c){return b.apply(fh(c)?c:[],a)})}}),wb(Ba.prototype,function(a,b){var c=wa[b];if(c){var d=c.name+"";ff.call(Wf,d)||(Wf[d]=[]),Wf[d].push({name:b,func:c})}}),Wf[Xc(N,2).name]=[{name:"wrapper",func:N}],Ba.prototype.clone=function(){var a=new Ba(this.__wrapped__);return a.__actions__=Ic(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=Ic(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=Ic(this.__views__),a},Ba.prototype.reverse=function(){if(this.__filtered__){var a=new Ba(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a},Ba.prototype.value=function(){var a,b=this.__wrapped__.value(),c=this.__dir__,d=fh(b),e=0>c,f=d?b.length:0;a=f;for(var g=this.__views__,h=0,i=-1,j=g.length;++i<j;){var k=g[i],l=k.size;switch(k.type){case"drop":h+=l;break;case"dropRight":a-=l;break;case"take":a=Kf(a,h+l);break;case"takeRight":h=Jf(h,a-l)}}if(a={start:h,end:a},g=a.start,h=a.end,a=h-g,g=e?h:g-1,h=this.__iteratees__,i=h.length,j=0,k=Kf(a,this.__takeCount__),!d||!e&&f==a&&k==a)return vc(b,this.__actions__);d=[];a:for(;a--&&j<k;){for(g+=c,e=-1,f=b[g];++e<i;){var m=h[e],l=m.type,m=(0,m.iteratee)(f);if(2==l)f=m;else if(!m){if(1==l)continue a;break a}}d[j++]=f}return d},wa.prototype.at=Mg,wa.prototype.chain=function(){return Yd(this)},wa.prototype.commit=function(){return new ya(this.value(),this.__chain__)},wa.prototype.next=function(){this.__values__===N&&(this.__values__=we(this.value()));var a=this.__index__>=this.__values__.length;return{done:a,value:a?N:this.__values__[this.__index__++]}},wa.prototype.plant=function(a){for(var b,c=this;c instanceof xa;){var d=Od(c);d.__index__=0,d.__values__=N,b?e.__wrapped__=d:b=d;var e=d,c=c.__wrapped__}return e.__wrapped__=a,b},wa.prototype.reverse=function(){var a=this.__wrapped__;return a instanceof Ba?(this.__actions__.length&&(a=new Ba(this)),a=a.reverse(),a.__actions__.push({func:Zd,args:[Vd],thisArg:N}),new ya(a,this.__chain__)):this.thru(Vd)},wa.prototype.toJSON=wa.prototype.valueOf=wa.prototype.value=function(){return vc(this.__wrapped__,this.__actions__)},wa.prototype.first=wa.prototype.head,wf&&(wa.prototype[wf]=$d),wa}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Na._=bb,define(function(){return bb})):Pa?((Pa.exports=bb)._=bb,Oa._=bb):Na._=bb}.call(this),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.RSVP=a.RSVP||{})}(this,function(a){"use strict";function b(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}function c(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function d(a,b){return 2!==arguments.length?wa[a]:void(wa[a]=b)}function e(a){var b=typeof a;return null!==a&&("object"===b||"function"===b)}function f(a){return"function"==typeof a}function g(a){return null!==a&&"object"==typeof a}function h(a){return null!==a&&"object"==typeof a}function i(){setTimeout(function(){for(var a=0;a<Aa.length;a++){var b=Aa[a],c=b.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),wa.trigger(b.name,b.payload)}Aa.length=0},50)}function j(a,b,c){1===Aa.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:za(),error:wa["instrument-with-stack"]?new Error(b._label):null}})&&i()}function k(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(m,b);return s(d,a),d}function l(){return new TypeError("A promises callback cannot return that same promise.")}function m(){}function n(a){try{return a.then}catch(b){return Ea.error=b,Ea}}function o(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function p(a,b,c){wa.async(function(a){var d=!1,e=o(c,b,function(c){d||(d=!0,b!==c?s(a,c,void 0):u(a,c))},function(b){d||(d=!0,v(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,v(a,e))},a)}function q(a,b){b._state===Ca?u(a,b._result):b._state===Da?(b._onError=null,v(a,b._result)):w(b,void 0,function(c){b!==c?s(a,c,void 0):u(a,c)},function(b){return v(a,b)})}function r(a,b,c){var d=b.constructor===a.constructor&&c===C&&a.constructor.resolve===k;d?q(a,b):c===Ea?(v(a,Ea.error),Ea.error=null):f(c)?p(a,b,c):u(a,b)}function s(a,b){a===b?u(a,b):e(b)?r(a,b,n(b)):u(a,b)}function t(a){a._onError&&a._onError(a._result),x(a)}function u(a,b){a._state===Ba&&(a._result=b,a._state=Ca,0===a._subscribers.length?wa.instrument&&j("fulfilled",a):wa.async(x,a))}function v(a,b){a._state===Ba&&(a._state=Da,a._result=b,wa.async(t,a))}function w(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Ca]=c,e[f+Da]=d,0===f&&a._state&&wa.async(x,a)}function x(a){var b=a._subscribers,c=a._state;if(wa.instrument&&j(c===Ca?"fulfilled":"rejected",a),0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?A(c,d,e,f):e(f);a._subscribers.length=0}}function y(){this.error=null}function z(a,b){try{return a(b)}catch(c){return Fa.error=c,Fa}}function A(a,b,c,d){var e=f(c),g=void 0,h=void 0;if(e){if(g=z(c,d),g===Fa)h=g.error,g.error=null;else if(g===b)return void v(b,l())}else g=d;b._state!==Ba||(e&&void 0===h?s(b,g):void 0!==h?v(b,h):a===Ca?u(b,g):a===Da&&v(b,g))}function B(a,b){var c=!1;try{b(function(b){c||(c=!0,s(a,b))},function(b){c||(c=!0,v(a,b))})}catch(d){v(a,d)}}function C(a,b,c){var d=this,e=d._state;if(e===Ca&&!a||e===Da&&!b)return wa.instrument&&j("chained",d,d),d;d._onError=null;var f=new d.constructor(m,c),g=d._result;if(wa.instrument&&j("chained",d,f),e===Ba)w(d,f,a,b);else{var h=e===Ca?a:b;wa.async(function(){return A(e,f,h,g)})}return f}function D(a,b,c){return a===Ca?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function E(a,b){return ya(a)?new Ga(this,a,(!0),b).promise:this.reject(new TypeError("Promise.all must be called with an array"),b)}function F(a,b){var c=this,d=new c(m,b);if(!ya(a))return v(d,new TypeError("Promise.race must be called with an array")),d;for(var e=0;d._state===Ba&&e<a.length;e++)w(c.resolve(a[e]),void 0,function(a){return s(d,a)},function(a){return v(d,a)});return d}function G(a,b){var c=this,d=new c(m,b);return v(d,a),d}function H(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function I(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function J(){this.value=void 0}function K(a){try{return a.then}catch(b){return Ka.value=b,Ka}}function L(a,b,c){try{a.apply(b,c)}catch(d){return Ka.value=d,Ka}}function M(a,b){for(var c={},d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=a[f];for(var g=0;g<b.length;g++){var h=b[g];c[h]=e[g+1]}return c}function N(a){for(var b=a.length,c=new Array(b-1),d=1;d<b;d++)c[d-1]=a[d];return c}function O(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function P(a,b){var c=function(){for(var c=this,d=arguments.length,e=new Array(d+1),f=!1,g=0;g<d;++g){var h=arguments[g];if(!f){if(f=S(h),f===La){var i=new Ja(m);return v(i,La.value),i}f&&f!==!0&&(h=O(f,h))}e[g]=h}var j=new Ja(m);return e[d]=function(a,c){a?v(j,a):void 0===b?s(j,c):b===!0?s(j,N(arguments)):ya(b)?s(j,M(arguments,b)):s(j,c)},f?R(j,e,a,c):Q(j,e,a,c)};return c.__proto__=a,c}function Q(a,b,c,d){var e=L(c,d,b);return e===Ka&&v(a,e.value),a}function R(a,b,c,d){return Ja.all(b).then(function(b){var e=L(c,d,b);return e===Ka&&v(a,e.value),a})}function S(a){return!(!a||"object"!=typeof a)&&(a.constructor===Ja||K(a))}function T(a,b){return Ja.all(a,b)}function U(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function V(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function W(a,b){return ya(a)?new Ma(Ja,a,b).promise:Ja.reject(new TypeError("Promise.allSettled must be called with an array"),b)}function X(a,b){return Ja.race(a,b)}function Y(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Z(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function $(a,b){return g(a)?new Oa(Ja,a,b).promise:Ja.reject(new TypeError("Promise.hash must be called with an object"),b)}function _(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function aa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ba(a,b){return g(a)?new Pa(Ja,a,(!1),b).promise:Ja.reject(new TypeError("RSVP.hashSettled must be called with an object"),b)}function ca(a){throw setTimeout(function(){throw a}),a}function da(a){var b={resolve:void 0,reject:void 0};return b.promise=new Ja(function(a,c){b.resolve=a,b.reject=c},a),b}function ea(a,b,c){return ya(a)?f(b)?Ja.all(a,c).then(function(a){for(var d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=b(a[f]);return Ja.all(e,c)}):Ja.reject(new TypeError("RSVP.map expects a function as a second argument"),c):Ja.reject(new TypeError("RSVP.map must be called with an array"),c)}function fa(a,b){return Ja.resolve(a,b)}function ga(a,b){return Ja.reject(a,b)}function ha(a,b){return Ja.all(a,b)}function ia(a,b){return Ja.resolve(a,b).then(function(a){return ha(a,b)})}function ja(a,b,c){if(!(ya(a)||g(a)&&void 0!==a.then))return Ja.reject(new TypeError("RSVP.filter must be called with an array or promise"),c);if(!f(b))return Ja.reject(new TypeError("RSVP.filter expects function as a second argument"),c);var d=ya(a)?ha(a,c):ia(a,c);return d.then(function(a){for(var d=a.length,e=new Array(d),f=0;f<d;f++)e[f]=b(a[f]);return ha(e,c).then(function(b){for(var c=new Array(d),e=0,f=0;f<d;f++)b[f]&&(c[e]=a[f],e++);return c.length=e,c})})}function ka(a,b){Xa[Qa]=a,Xa[Qa+1]=b,Qa+=2,2===Qa&&Ya()}function la(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){return a(qa)}}function ma(){return"undefined"!=typeof Ra?function(){Ra(qa)}:pa()}function na(){var a=0,b=new Ua(qa),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){return c.data=a=++a%2}}function oa(){var a=new MessageChannel;return a.port1.onmessage=qa,function(){return a.port2.postMessage(0)}}function pa(){return function(){return setTimeout(qa,1)}}function qa(){for(var a=0;a<Qa;a+=2){var b=Xa[a],c=Xa[a+1];b(c),Xa[a]=void 0,Xa[a+1]=void 0}Qa=0}function ra(){try{var a=require,b=a("vertx");return Ra=b.runOnLoop||b.runOnContext,ma()}catch(c){return pa()}}function sa(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function ta(){wa.on.apply(wa,arguments)}function ua(){wa.off.apply(wa,arguments)}var va={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,d){if("function"!=typeof d)throw new TypeError("Callback must be a function");var e=c(this),f=void 0;f=e[a],f||(f=e[a]=[]),b(f,d)===-1&&f.push(d)},off:function(a,d){var e=c(this),f=void 0,g=void 0;d?(f=e[a],g=b(f,d),g!==-1&&f.splice(g,1)):e[a]=[]},trigger:function(a,b,d){var e=c(this),f=void 0,g=void 0;if(f=e[a])for(var h=0;h<f.length;h++)(g=f[h])(b,d)}},wa={instrument:!1};va.mixin(wa);var xa=void 0;xa=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var ya=xa,za=Date.now||function(){return(new Date).getTime();
},Aa=[],Ba=void 0,Ca=1,Da=2,Ea=new y,Fa=new y,Ga=function(){function a(a,b,c,d){this._instanceConstructor=a,this.promise=new a(m,d),this._abortOnReject=c,this._init.apply(this,arguments)}return a.prototype._init=function(a,b){var c=b.length||0;this.length=c,this._remaining=c,this._result=new Array(c),this._enumerate(b),0===this._remaining&&u(this.promise,this._result)},a.prototype._enumerate=function(a){for(var b=this.length,c=this.promise,d=0;c._state===Ba&&d<b;d++)this._eachEntry(a[d],d)},a.prototype._settleMaybeThenable=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===k){var e=n(a);if(e===C&&a._state!==Ba)a._onError=null,this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=this._makeResult(Ca,b,a);else if(c===Ja){var f=new c(m);r(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},a.prototype._eachEntry=function(a,b){h(a)?this._settleMaybeThenable(a,b):(this._remaining--,this._result[b]=this._makeResult(Ca,b,a))},a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ba&&(this._abortOnReject&&a===Da?v(d,c):(this._remaining--,this._result[b]=this._makeResult(a,b,c),0===this._remaining&&u(d,this._result)))},a.prototype._makeResult=function(a,b,c){return c},a.prototype._willSettleAt=function(a,b){var c=this;w(a,void 0,function(a){return c._settledAt(Ca,b,a)},function(a){return c._settledAt(Da,b,a)})},a}(),Ha="rsvp_"+za()+"-",Ia=0,Ja=function(){function a(b,c){this._id=Ia++,this._label=c,this._state=void 0,this._result=void 0,this._subscribers=[],wa.instrument&&j("created",this),m!==b&&("function"!=typeof b&&H(),this instanceof a?B(this,b):I())}return a.prototype._onError=function(a){var b=this;wa.after(function(){b._onError&&wa.trigger("error",a,b._label)})},a.prototype["catch"]=function(a,b){return this.then(void 0,a,b)},a.prototype["finally"]=function(a,b){var c=this,d=c.constructor;return c.then(function(b){return d.resolve(a()).then(function(){return b})},function(b){return d.resolve(a()).then(function(){throw b})},b)},a}();Ja.cast=k,Ja.all=E,Ja.race=F,Ja.resolve=k,Ja.reject=G,Ja.prototype._guidKey=Ha,Ja.prototype.then=C;var Ka=new J,La=new J,Ma=function(a){function b(b,c,d){return U(this,a.call(this,b,c,!1,d))}return V(b,a),b}(Ga);Ma.prototype._makeResult=D;var Na=Object.prototype.hasOwnProperty,Oa=function(a){function b(b,c){var d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=arguments[3];return Y(this,a.call(this,b,c,d,e))}return Z(b,a),b.prototype._init=function(a,b){this._result={},this._enumerate(b),0===this._remaining&&u(this.promise,this._result)},b.prototype._enumerate=function(a){var b=this.promise,c=[];for(var d in a)Na.call(a,d)&&c.push({position:d,entry:a[d]});var e=c.length;this._remaining=e;for(var f=void 0,g=0;b._state===Ba&&g<e;g++)f=c[g],this._eachEntry(f.entry,f.position)},b}(Ga),Pa=function(a){function b(b,c,d){return _(this,a.call(this,b,c,!1,d))}return aa(b,a),b}(Oa);Pa.prototype._makeResult=D;var Qa=0,Ra=void 0,Sa="undefined"!=typeof window?window:void 0,Ta=Sa||{},Ua=Ta.MutationObserver||Ta.WebKitMutationObserver,Va="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Wa="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Xa=new Array(1e3),Ya=void 0;Ya=Va?la():Ua?na():Wa?oa():void 0===Sa&&"function"==typeof require?ra():pa();var Za=void 0;if("object"==typeof self)Za=self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");Za=global}var $a;wa.async=ka,wa.after=function(a){return setTimeout(a,0)};var _a=fa,ab=function(a,b){return wa.async(a,b)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var bb=window.__PROMISE_INSTRUMENTATION__;d("instrument",!0);for(var cb in bb)bb.hasOwnProperty(cb)&&ta(cb,bb[cb])}var db=($a={asap:ka,cast:_a,Promise:Ja,EventTarget:va,all:T,allSettled:W,race:X,hash:$,hashSettled:ba,rethrow:ca,defer:da,denodeify:P,configure:d,on:ta,off:ua,resolve:fa,reject:ga,map:ea},sa($a,"async",ab),sa($a,"filter",ja),$a);a["default"]=db,a.asap=ka,a.cast=_a,a.Promise=Ja,a.EventTarget=va,a.all=T,a.allSettled=W,a.race=X,a.hash=$,a.hashSettled=ba,a.rethrow=ca,a.defer=da,a.denodeify=P,a.configure=d,a.on=ta,a.off=ua,a.resolve=fa,a.reject=ga,a.map=ea,a.async=ab,a.filter=ja,Object.defineProperty(a,"__esModule",{value:!0})}),function(a){"use strict";function b(a){this.version="4.0.17",b.Base.Datastore.getInstance().config=a,b.Base.Logger.clearLoggers()}b.prototype={getVersionNumber:function(){return this.version},createWork:function(){return new b.Services.Work.Work},registerLogger:function(a){b.Base.Logger.addLogger(a)}},a.OceanaCustomerWebVoiceVideo=b}(window),function(a){"use strict";!function(a){a.Base=a.Base||{}}(a),function(a){a.Config=a.Config||{}}(a),function(a){a.Providers=a.Providers||{}}(a),function(a){a.Providers.AMC=a.Providers.AMC||{}}(a),function(a){a.Providers.AMC.Requests=a.Providers.AMC.Requests||{}}(a),function(a){a.Providers.Calls=a.Providers.Calls||{}}(a),function(a){a.Providers.CP=a.Providers.CP||{}}(a),function(a){a.Providers.CP.Parsers=a.Providers.CP.Parsers||{}}(a),function(a){a.Providers.CP.Handlers=a.Providers.CP.Handlers||{}}(a),function(a){a.Services=a.Services||{}}(a),function(a){a.Services.Devices=a.Services.Devices||{}}(a),function(a){a.Services.Work=a.Services.Work||{}}(a),function(a){a.Services.Work.Interactions=a.Services.Work.Interactions||{}}(a),function(a){a.Services.Work.Attributes=a.Services.Work.Attributes||{}}(a),function(a){a.Services.Work.Schema=a.Services.Work.Schema||{}}(a),function(a){a.Base.Collections=a.Base.Collections||{}}(a),function(a){a.Base.Network=a.Base.Network||{}}(a)}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(){this._callbacks=[]}c.prototype={add:function(a){this._callbacks.push(a)},fire:function(){var a=arguments;b.forEach(this._callbacks,function(b){b.apply(null,a)})},remove:function(a){var c=b.indexOf(this._callbacks,a);c!==-1&&this._callbacks.splice(c,1)},empty:function(){this._callbacks=[]}},a.Base.Callbacks=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";function c(){this.collection=[]}c.prototype={isPresent:function(a){var c=b.indexOf(this.collection,a);return c!==-1},findAll:function(){return this.collection},add:function(b){this.isPresent(b)?(a.Base.Logger.log("Collection: error adding object, object already exists"),a.Base.Logger.log(JSON.parse(JSON.stringify(b)))):this.collection.push(b)},addMultiple:function(c){var d=this;b.forEach(c,function(b){d.isPresent(b)?(a.Base.Logger.log("Collection: error adding object, object already exists"),a.Base.Logger.log(b)):d.collection.push(b)})},remove:function(a){var c=b.indexOf(this.collection,a);c!==-1&&this.collection.splice(c,1)},removeMultiple:function(a){var c=this;b.forEach(a,function(a){var d=b.indexOf(c.collection,a);d!==-1&&c.collection.splice(d,1)})},empty:function(){this.collection=[]}},a.Base.Collections.Collection=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";var b=function(){function a(){var a={config:"",authToken:"",attributes:[],context:"",topic:"",workRequest:{provided:!1,id:void 0},locale:void 0,routingStrategy:void 0,dataCenter:void 0,contextualData:void 0,services:[],resources:[],platformType:void 0};return a}var b;return{getInstance:function(){return b||(b=a()),b},clear:function(){var c=b.config;b=a(),b.config=c}}}();a.Base.Datastore=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(a,c,d,e){b.isUndefined(e)?a[c](d):a[c](d,e)}function d(a,c,d,e){b.isUndefined(e)?a.log(c,d):a.log(c,d,e)}var e=[];a.Base.Logger={log:function(a,b,c){e.forEach(function(e){d(e,a,b,c)})},info:function(a,b){e.forEach(function(e){"function"==typeof e.info?c(e,"info",a,b):d(e,"info",a,b)})},error:function(a,b){e.forEach(function(e){"function"==typeof e.error?c(e,"error",a,b):d(e,"error",a,b)})},fatal:function(a,b){e.forEach(function(e){"function"==typeof e.fatal?c(e,"fatal",a,b):d(e,"fatal",a,b)})},debug:function(a,b){e.forEach(function(e){"function"==typeof e.debug?c(e,"debug",a,b):d(e,"debug",a,b)})},trace:function(a,b){e.forEach(function(e){"function"==typeof e.trace?c(e,"trace",a,b):d(e,"trace",a,b)})},warn:function(a,b){e.forEach(function(e){"function"==typeof e.warn?c(e,"warn",a,b):d(e,"warn",a,b)})},getLoggers:function(a){return e},addLogger:function(a){if(!a||"undefined"==typeof a.log)throw new TypeError("Logger should implement log method.");e.push(a)},removeLogger:function(a){var b=e.indexOf(a);if(b===-1)throw new Error("Specified error does not exist.");e.splice(b,1)},clearLoggers:function(){e=[]}}}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";function b(){this.async=!0,this.headers={},this.timeout=2e4}a.Base.Network.HTTPOptions=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(b){if(this._xhr=void 0,window.XMLHttpRequest)this._xhr=new XMLHttpRequest;else{if(!window.ActiveXObject)throw new Error("There is no XHR protocol available for HTTP Requests");try{this._xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){this._xhr=new ActiveXObject("Microsoft.XMLHTTP")}}this._xhr.timeout=2e4,this._xhr.withCredentials=b.withCredentials,this._xhr.onloadstart=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.onprogress=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.onabort=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.onerror=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.onload=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.ontimeout=function(b){a.Base.Logger.debug("HTTPRequest",b.target)},this._xhr.onloadend=function(b){a.Base.Logger.debug("HTTPRequest",b.target)}}c.prototype={encode:function(a){if(a=a||{},"string"==typeof a)return a;var c=[];return b.forEach(a,function(a,b){c.push(encodeURIComponent(b)+"="+encodeURIComponent(a))}),c.join("&")},setRequestHeader:function(a,b){this._xhr.setRequestHeader(a,b)},setRequestHeaders:function(a){var c="application/x-www-form-urlencoded";b.forEach(a,b.bind(function(a,b){"content-type"===b.toLowerCase()?c=a:this.setRequestHeader(b,a)},this)),this.setRequestHeader("Content-type",c)},open:function(a,b,c){this._xhr.open(a,b,c)},abort:function(){this._xhr.abort()},send:function(a){this._xhr.send(a)},addOnStateChangeCallback:function(a){this._xhr.onreadystatechange=a}},a.Base.Network.HTTPRequest=c}(OceanaCustomerWebVoiceVideo,_),function(a,b,c){"use strict";function d(){this._options=new a.Base.Network.HTTPOptions,this._xhrPool=[]}d.prototype={send:function(d,e,f,g){g=b.assignIn({},this._options,g);var h=new a.Base.Network.HTTPRequest({});return new c(b.bind(function(a,b){var c=h.encode(f);"GET"===d&&c&&(e+="?"+c,c=null),h.open(d,e,g.async),h.setRequestHeaders(g.headers),h.addOnStateChangeCallback(function(){4===this.readyState&&(!this.status||(this.status<200||this.status>=300)&&304!==this.status?b(this):a(this.responseText,this))}),h.send(c),this._xhrPool.push(h)},this))},get:function(a,b,c){return this.send("GET",a,b,c)},post:function(a,b,c){return this.send("POST",a,b,c)},put:function(a,b,c){return this.send("PUT",a,b,c)},"delete":function(a,b,c){return this.send("DELETE",a,b,c)},close:function(){b.forEach(this._xhrPool,function(a){a.abort()}),this._xhrPool=[]}},a.Base.Network.RESTProvider=d}(OceanaCustomerWebVoiceVideo,_,RSVP.Promise),function(a,b){"use strict";function c(){this._listeners={}}c.prototype={on:function(a,b){return"function"!=typeof b?this:(this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this)},off:function(a,c){if("function"!=typeof c)return this;if(void 0===this._listeners[a])throw new Error("There is no such handler for event with name: "+a+".");var d=b.indexOf(this._listeners[a],c);if(d===-1)throw new Error("There is no such handler for event with name: "+a+".");return this._listeners[a].splice(d,1),0===b.size(this._listeners[a])&&delete this._listeners[a],this},trigger:function(a,c){var d=this._listeners[a];void 0!==d&&(c=c||[],b.forEach(d,function(a){a.apply(window,c)}))},removeListeners:function(a){var c=this;b.forEach(this._listeners,function(d,e){var f=b.isUndefined(a);if(a){var g=new RegExp("^"+a);f=null!==g.exec(e)}f&&b.forEach(d,function(a){c.off(e,a)})})}},a.Base.Observable=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";function b(a){}b.prototype={then:function(a,b,c){},"catch":function(a,b){},"finally":function(a,b){}},a.Base.Promise=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(){}c.prototype={watch:function(a,b,c){var d=a[b],e=d,f=function(){return e},g=function(f){d=e,e=f,c.call(a,b,d,f)};return delete a[b]&&Object.defineProperty&&Object.defineProperty(a,b,{get:f,set:g,enumerable:!1,configurable:!0}),this},unwatch:function(a,b){var c=a[b];return delete a[b],a[b]=c,this}},a.Base.Watcher=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";function b(){this.configuration=new a.Config.Configuration,this.webGatewayConfiguration=new a.Config.WebGatewayConfiguration}a.Config.ClientConfiguration=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){this.restUrl="",this.port=443,this.secure=!1,this.urlPath=""}a.Config.Configuration=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){this.webGatewayAddress="",this.port=443,this.secure=!0}a.Config.WebGatewayConfiguration=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){var b=a.Base.Datastore.getInstance().config;_.has(b,"configuration")&&(_.assign(b,b.configuration),delete b.configuration),g=e(b),f=new a.Base.Network.RESTProvider}function c(b){var c=new a.Providers.AMC.Requests.CreateAmcSession;return c.setInteractionType(b),c.fetchData(),f.post(g,c.parse(),{headers:{"Content-Type":"application/json"}})}function d(a){var b=g+"/"+a;return f["delete"](b)}function e(b){if(b.restUrl&&b.port){var c="services/AvayaMobileCommunications/sessions",d=b.secure?"https://":"http://",e=c;return b.urlPath&&(a.Base.Logger.debug("SDK: using ["+b.urlPath+"] as url path"),e=b.urlPath),d+b.restUrl+":"+b.port+"/"+e}a.Base.Logger.error("SDK: provided AMC server configuration is invalid"),a.Base.Logger.error(b)}var f,g;b.prototype={createAmcSession:function(a){return c(a)},endAmcSession:function(a){return d(a)}},a.Providers.AMC.AmcProvider=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(){this.platform=d(),this.customerId="",this.primaryChannel="VOICE",this.attributes=[],this.escalationChannels=[]}function d(){var a="BROWSER";window.chrome&&window.chrome.csi&&(a="CHROME"),"undefined"!=typeof InstallTrigger&&(a="FIREFOX");var b=!!document.documentMode;return!b&&window.StyleMedia&&(a="EDGE"),a}c.prototype={setInteractionType:function(b){b===a.Services.Work.InteractionType.AUDIO_ONLY?this.primaryChannel="VOICE":this.primaryChannel="VIDEO"},fetchData:function(){var c=a.Base.Datastore.getInstance();this.customerId=c.context,this.topic=c.topic,this.attributes=c.attributes,c.workRequest.provided&&c.workRequest.id&&(this.workRequestId=c.workRequest.id),c.locale&&(this.locale=c.locale),c.routingStrategy&&(this.routingStrategy=c.routingStrategy),c.dataCenter&&(this.dataCenter=c.dataCenter),c.contextualData&&(this.data=c.contextualData),c.services&&(this.services=b.keyBy(c.services,function(a){return c.services.indexOf(a)+1})),c.resources&&(this.resources=b.keyBy(c.resources,function(a){return c.resources.indexOf(a)+1}))},parse:function(){return JSON.stringify(this)}},a.Providers.AMC.Requests.CreateAmcSession=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";function b(){this.audioMuted=!1,this.videoMuted=!1,this.videoEnabled=!0}b.prototype={isAudioMuted:function(){return this.audioMuted},setAudioMuted:function(a){this.audioMuted=a},isVideoMuted:function(){return this.videoMuted},setVideoMuted:function(a){this.videoMuted=a},isVideoEnabled:function(){return this.videoEnabled},setVideoEnabled:function(a){this.videoEnabled=a}},a.Providers.Calls.CallConfig=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";var c={GET_STATE:"GET_STATE",GET_DURATION:"GET_DURATION",SEND_DTMF:"SEND_DTMF",IS_SERVICE_AVAILABLE:"IS_SERVICE_AVAILABLE"};a.Providers.Calls.CallOperations=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";var c={IS_AUDIO_MUTED:"IS_AUDIO_MUTED",MUTE_AUDIO:"MUTE_AUDIO",IS_VIDEO_MUTED:"IS_VIDEO_MUTED",MUTE_VIDEO:"MUTE_VIDEO",IS_VIDEO_ENABLED:"IS_VIDEO_ENABLED",ENABLE_VIDEO:"ENABLE_VIDEO",IS_CALL_HELD:"IS_CALL_HELD",HOLD_CALL:"HOLD_CALL"};a.Providers.Calls.MediaOperations=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";function c(b){a.Base.Observable.call(this),w=this,x=new AvayaClientServices,this._mediaServices=x.getMediaServices(),this._callService={},this._configHandler=new a.Providers.CP.Handlers.ConfigHandler,this._callTimeHandler=new a.Providers.CP.Handlers.CallTimeHandler,this._deviceHandler=new a.Providers.CP.Handlers.DeviceHandler(this._mediaServices),this._mediaOperationHandler=new a.Providers.CP.Handlers.MediaOperationHandler(this),this._webGatewayConfiguration=b,this._videoHandler=void 0}function d(b,c){a.Base.Logger.log("CP: Initialising Call Service");var d=AvayaClientServices.Config.VideoResolution.RESOLUTION_480p;c&&(d=s(c.getCameraCaptureResolution()));var e=w._configHandler.createUserConfig(b,d);_.forEach(a.Base.Logger.getLoggers(),function(a){x.registerLogger(a)}),a.Base.Logger.info("CP: creating user"),y=x.createUser(e),_.isEmpty(w._callService)&&(a.Base.Logger.info("CP: getting call service"),w._callService=y.getCalls()),w._callService.addOnCallsServiceAvailableCallback(function(b){a.Base.Logger.info("CP: Call service initialised")}),w._callService.addOnCallsServiceUnavailableCallback(function(b){w._active?(a.Base.Logger.warn("CP: Call service unavailable"),v(function(){w.trigger("service.connecting",[])},10,100,function(){w.trigger("service.disconnected",[]),w.stop()})):(a.Base.Logger.warn("CP: Call service shut down successfully"),w.trigger("service.disconnected",[]))}),w._callService.addOnCallRemovedCallback(function(a){w._mediaOperationHandler.setDefaultMediaState()}),y.addOnUserRegistrationFailed(function(b){a.Base.Logger.warn("CP: user registration failed")}),y.addOnUserRegistrationSuccessful(function(b){a.Base.Logger.info("CP: user registration successful")}),a.Base.Logger.info("CP: starting anonymous user");var f=y.start();f.then(function(b){a.Base.Logger.info("CP: Call service available and ready for use"),w.trigger("service.connected",[]),w._active=!0},function(b){a.Base.Logger.error("CP: Call service initialisation. Error: "+b)})}function e(){a.Base.Logger.info("CP: shutting down call service"),w._active=!1,y&&y.stop()}function f(b){var c={success:!1,reason:"",info:void 0},d=b.amcRoutepoint;if(null===d||"string"!=typeof d||""===d)c.success=!1,c.reason="Destination address is invalid";else{var e=b.workRequestId+","+b.interactionType+",N";c.info=new AvayaClientServices.Services.Call.CallCreationInfo(d);var f=w._webGatewayConfiguration.webGatewayAddress,g=w._webGatewayConfiguration.port,h=w._webGatewayConfiguration.secure?"https":"http",i=a.Base.Datastore.getInstance().authToken||"",j=h+"://"+f+":"+g+"/csa/resources/tenants/default";c.info.setServiceGatewayURL(j),c.info.setAuthorizationToken(i),c.info.setContextId(e),a.Base.Logger.info("CP: AAWG address is "+j),a.Base.Logger.info("CP: Starting call to - ["+b.amcRoutepoint+"] with Work Request ID - ["+b.workRequestId+"]"),c.success=!0}return c}function g(b,c){var d={success:!1,reason:"",info:void 0},e=b.destination;if(null===e||"string"!=typeof e||""===e)d.success=!1,d.reason="Destination address is invalid";else{var f=b.contextId;d.info=new AvayaClientServices.Services.Call.CallCreationInfo(e);var g=w._webGatewayConfiguration.webGatewayAddress,h=w._webGatewayConfiguration.port,i=w._webGatewayConfiguration.secure?"https":"http",j=a.Base.Datastore.getInstance().authToken||"",k=i+"://"+g+":"+h+"/csa/resources/tenants/default";d.info.setServiceGatewayURL(k),d.info.setAuthorizationToken(j),d.info.setContextId(f),a.Base.Logger.info("CP: AAWG address is "+k),a.Base.Logger.info("CP: Starting Elite call to - ["+e+"] "),d.success=!0}return d}function h(b,c,d){if(w._callService.getVoipCallingCapability().isAllowed){var e;if(b===a.Services.Work.PlatformType.OCEANA)e=f(c);else{var h=!!d;e=g(c,h)}if(e.success){var i=w._callService.createCall(e.info);if(i.addOnCallStartedCallback(function(){a.Base.Logger.info("CP: Call started")}),i.addOnCallRemoteAlertingCallback(function(b){a.Base.Logger.info("CP: Call alerting remotely"),w.trigger("interaction.alerting",[]),w._callTimeHandler.startTimer(),w._mediaOperationHandler.isAudioMuted()&&(a.Base.Logger.info("CP: pre-call: muting audio"),w._mediaOperationHandler.muteAudio(b,!0))}),i.addOnServiceQualityScoreChangedCallback(function(a){w.trigger("interaction.getCallQuality",[a])}),i.addOnCallEstablishedCallback(function(b){a.Base.Logger.info("CP: Call connected"),w.trigger("interaction.active",[])}),i.addOnCallEndedCallback(function(b){a.Base.Logger.info("CP: Call ended"),w._videoHandler&&w._videoHandler.clearVideoSurface(),w._callTimeHandler.stopTimer(),w.trigger("interaction.ended",[]),w.stop()}),i.addOnCallFailedCallback(function(b,c){w._videoHandler&&w._videoHandler.clearVideoSurface();var d=c.getError();a.Base.Logger.error("CP: Call failed. Error: "+d),w._callTimeHandler.pauseTimer(),w.trigger("interaction.failed",[{reason:d}])}),i.addOnCallHeldRemotelyCallback(function(b){a.Base.Logger.info("CP: Call remotely held"),w.trigger("interaction.remotely.held",[])}),i.addOnCallUnheldRemotelyCallback(function(b){a.Base.Logger.info("CP: Call remotely unheld"),w.trigger("interaction.remotely.unheld",[])}),i.addOnCallQueuedCallback(function(b){a.Base.Logger.info("CP: Call queued"),w.trigger("interaction.queued",[])}),i.addOnCallRedirectedCallback(function(b){a.Base.Logger.info("CP: Call redirected"),w.trigger("interaction.redirected",[])}),i.addOnCallAudioMuteStatusChangedCallback(function(b){a.Base.Logger.log("CP: new audio mute state: "+b.isAudioMuted()),w.trigger("interaction.audiomute.statechange",[{newState:b.isAudioMuted()}])}),i.addOnCallVideoChannelsUpdatedCallback(function(b,c){w._videoHandler?(a.Base.Logger.info("CP: video channels updated"),w._videoHandler.updateVideoSurfaces(c)):a.Base.Logger.error("CP: no video handler available")}),i.addOnCallIncomingVideoAddRequestReceivedCallback(function(b,c){a.Base.Logger.info("CP: far-end has requested to add ["+c+"] video to the call")}),i.addOnCallServiceAvailableCallback(function(b){a.Base.Logger.info("CP: Call signalling path available"),w.trigger("service.connected",[])}),i.addOnCallServiceUnavailableCallback(function(b){a.Base.Logger.warn("CP: Call signalling path unavailable"),w.trigger("service.disconnected",[])}),d){w._videoHandler=new a.Providers.CP.Handlers.VideoHandler(w._mediaServices,d);var j=w._mediaOperationHandler.getStartingVideoMode();i.setVideoMode(j)}i.start()}else a.Base.Logger.error("CP: Destination address is invalid"),w.trigger("interaction.failed",[{reason:e.reason}])}else w.trigger("interaction.failed",[{reason:"Call failed - VoIP capability is currently unavailable"}]),a.Base.Logger.error("CP: cannot make call - VoIP capability is currently unavailable")}function i(){var a=!1;return w._callService.getCallCount()>0&&(a=!0),a}function j(b,c){var d;if(i()&&b)switch(c.name){case a.Providers.Calls.CallOperations.GET_STATE:var e=new a.Providers.CP.Parsers.StateParser,f=b.getState();d=e.parse(f);break;case a.Providers.Calls.CallOperations.GET_DURATION:var g=w._callTimeHandler.getTimeElapsed(),h=new Date(null);h.setSeconds(g),d=h.getTime();break;case a.Providers.Calls.CallOperations.SEND_DTMF:var j=parseInt(c.tone);if(j>=0&&j<=15){var k=b.getSendDTMFCapability();if(k.isAllowed){var l=new a.Providers.CP.Parsers.DtmfParser,m=l.parse(j);b.sendDTMF(m),t(j)}else a.Base.Logger.warn("CP: sendDTMF capability not allowed ["+k.denialReason+"]")}else a.Base.Logger.error("CP: invalid DTMF value supplied");break;case a.Providers.Calls.CallOperations.IS_SERVICE_AVAILABLE:d=b.isServiceAvailable();break;default:a.Base.Logger.debug("CP: operation not supported ["+c.name+"]")}return d}function k(b,c){var d;switch(c.name){case a.Providers.Calls.MediaOperations.IS_AUDIO_MUTED:d=w._mediaOperationHandler.isAudioMuted(b);break;case a.Providers.Calls.MediaOperations.MUTE_AUDIO:"boolean"==typeof c.muted&&w._mediaOperationHandler.muteAudio(b,c.muted);break;case a.Providers.Calls.MediaOperations.IS_VIDEO_MUTED:d=w._mediaOperationHandler.isVideoMuted(b);break;case a.Providers.Calls.MediaOperations.MUTE_VIDEO:"boolean"==typeof c.muted&&w._mediaOperationHandler.muteVideo(b,c.muted);break;case a.Providers.Calls.MediaOperations.IS_VIDEO_ENABLED:d=w._mediaOperationHandler.isVideoEnabled(b);break;case a.Providers.Calls.MediaOperations.ENABLE_VIDEO:"boolean"==typeof c.enabled&&w._mediaOperationHandler.enableVideo(b,c.enabled);break;case a.Providers.Calls.MediaOperations.IS_CALL_HELD:"boolean"==typeof c.held&&w._mediaOperationHandler.isCallHeld(b,c.held);break;case a.Providers.Calls.MediaOperations.HOLD_CALL:"boolean"==typeof c.held&&w._mediaOperationHandler.holdCall(b,c.held);break;default:a.Base.Logger.debug("CP: media operation not supported  ["+c.name+"]")}return d}function l(a){w._videoHandler&&w._videoHandler.clearVideoSurface(),i()&&a&&a.end()}function m(b,c){b&&b.getAudioDetails().then(function(b){a.Base.Logger.debug("CpProvider: retrieved audio details");var d=q(b);c(d)},o)}function n(b,c){b&&b.getVideoDetails().then(function(b){a.Base.Logger.debug("CpProvider: retrieved video details");var d=r(b);c(d)},p)}function o(b){a.Base.Logger.error("CpProvider: failed to get audio details: "+b.getError())}function p(b){a.Base.Logger.error("CpProvider: failed to get video details: "+b.getError())}function q(a){var b={bytesReceived:a.bytesReceived,bytesTransmitted:a.bytesTransmitted,averageJitterReceivedMillis:a.jitterMillisecondsReceived,packetLossTotalReceived:a.packetLossTotalReceived,packetLossTotalTransmitted:a.packetLossTotalTransmitted,packetsReceived:a.packetsReceived,packetsTransmitted:a.packetsTransmitted,roundTripTimeMillis:a.roundTripTimeMilliseconds};return b}function r(a){var b={videoReceiveStatistics:{actualBitRate:a.actualBitRateReceived,actualFrameRate:a.actualFrameRateReceived,byteCount:a.bytesReceived,packetLossTotal:a.packetLossTotalReceived,packetLossFraction:a.packetsLossFractionReceived,packetCount:a.packetsReceived},videoTransmitStatistics:{actualBitRate:a.actualBitRateTransmitted,actualFrameRate:a.actualFrameRateTransmitted,byteCount:a.bytesTransmitted,packetLossTotal:a.packetLossTotalTransmitted,packetLossFraction:a.packetsLossFractionTransmitted,packetCount:a.packetsTransmitted}};return b}function s(b){switch(b){case a.Services.Devices.CameraResolution.RESOLUTION_320x180:return AvayaClientServices.Config.VideoResolution.RESOLUTION_180p;case a.Services.Devices.CameraResolution.RESOLUTION_416x240:return AvayaClientServices.Config.VideoResolution.RESOLUTION_240p;case a.Services.Devices.CameraResolution.RESOLUTION_640x360:return AvayaClientServices.Config.VideoResolution.RESOLUTION_360p;case a.Services.Devices.CameraResolution.RESOLUTION_848x480:return AvayaClientServices.Config.VideoResolution.RESOLUTION_480p;case a.Services.Devices.CameraResolution.RESOLUTION_1280x720:return AvayaClientServices.Config.VideoResolution.RESOLUTION_720p;case a.Services.Devices.CameraResolution.RESOLUTION_1920x1080:return AvayaClientServices.Config.VideoResolution.RESOLUTION_1080p}return AvayaClientServices.Config.VideoResolution.RESOLUTION_480p}function t(b){var c=new a.Providers.CP.Parsers.DtmfParser,d=u(c.getHighFrequency(b)),e=u(c.getLowFrequency(b));d.start(),e.start(),setTimeout(function(){d.stop(),e.stop()},100)}function u(a){z||(z=new window.AudioContext);var b=z.createGain();b.gain.value=.2,b.connect(z.destination);var c=z.createOscillator();return c.connect(b),c.frequency.value=a,c}function v(a,b,c,d){var e=a();e||(b>0?setTimeout(function(){v(a,--b,2*c,d)},c):d())}var w,x,y,z;c.prototype={start:function(b,c){var e=!0;b===a.Services.Work.InteractionType.AUDIO_ONLY&&(e=!1),a.Base.Logger.log("CP: start"),d(e,c)},stop:function(){a.Base.Logger.log("CP: stop"),e()},makeAudioCall:function(b,c){a.Base.Logger.log("CP: makeAudioCall"),this._deviceHandler.hasAudioDevice()?h(b,c):(a.Base.Logger.error("CP: cannot make a audio call [no audio device available]"),this.trigger("interaction.failed",[{reason:"No audio device available"}]))},makeVideoCall:function(b,c,d,e){a.Base.Logger.log("CP: makeVideoCall"),this._deviceHandler.hasAudioDevice()?h(b,c,d):(a.Base.Logger.error("CP: cannot make a video call [no audio device available]"),this.trigger("interaction.failed",[{reason:"No audio device available"}]))},performOperation:function(b){var c=!0;b.name!==a.Providers.Calls.CallOperations.GET_DURATION&&b.name!==a.Providers.Calls.CallOperations.GET_STATE||(c=!1),c&&a.Base.Logger.log("CP: performing operation "+b.name);var d=j(_.head(this._callService.getCalls()),b);return c&&a.Base.Logger.log("CP: performed operation "+b.name+" - result: "+d),d},performMediaOperation:function(b){var c;this._callService&&this._callService.getCalls&&(c=_.head(this._callService.getCalls())),a.Base.Logger.log("CP: performing media operation "+b.name);var d=k(c,b);return a.Base.Logger.log("CP: performed media operation "+b.name+" - result: "+d),d},endCall:function(){l(_.head(this._callService.getCalls()))},readAudioDetails:function(a){m(_.head(this._callService.getCalls()),a)},readVideoDetails:function(a){n(_.head(this._callService.getCalls()),a)}},_.defaults(c.prototype,a.Base.Observable.prototype),a.Providers.CP.CpProvider=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(){d=this,this._time=0,this._timerInterval=void 0}var d;c.prototype={startTimer:function(){d._timerInterval=setInterval(function(){d._time=d._time+1},1e3)},pauseTimer:function(){clearInterval(d._timerInterval)},stopTimer:function(){clearInterval(d._timerInterval),d._time=0},getTimeElapsed:function(){return d._time}},a.Providers.CP.Handlers.CallTimeHandler=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(){}c.prototype={createUserConfig:function(a,b){var c=new AvayaClientServices.Config.CallUserConfiguration;c.incomingCall=!1,c.videoEnabled=a,c.videoMaxBandwidthAnyNetwork=1024;var d=new AvayaClientServices.Config.MediaConfiguration;d.voipConfigurationVideo=new AvayaClientServices.Config.VoIPConfigurationVideo,d.voipConfigurationVideo.videoResolution=b;var e=new AvayaClientServices.Config.SGConfiguration;e.maxCallStartReconnectionAttempts=3;var f={callUserConfiguration:c,sgConfiguration:e,mediaConfiguration:d};return f}},a.Providers.CP.Handlers.ConfigHandler=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(a){this._mediaServices=a,this._audioInputInterface=this._mediaServices.getAudioInterface().getInputInterface(),this._audioOutputInterface=this._mediaServices.getAudioInterface().getOutputInterface(),this._videoInterface=this._mediaServices.getVideoInterface()}c.prototype={hasAudioDevice:function(){var b=this._audioOutputInterface.getAvailableDevices().length>0,c=this._audioInputInterface.getAvailableDevices().length>0;return a.Base.Logger.debug("CP: Microphone available: "+c),a.Base.Logger.debug("CP: Speakers available: "+b),c},hasVideoDevice:function(){return this._videoInterface.getAvailableDevices().length>0}},a.Providers.CP.Handlers.DeviceHandler=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(b){a.Base.Watcher.call(this),f=this,this._provider=b,this._audioMuted=!1,this._videoMuted=!1,this._videoEnabled=!0,this._callHeld=!1,this._videoMuteWatcher=function(a,b,c){c!==b&&f._provider.trigger("interaction.videomute.statechange",[{newState:c}])},this.videoEnabledWatcher=function(a,b,c){c!==b&&(!c&&f._videoMuted&&(f._videoMuted=!1),f._provider.trigger("interaction.videoenabled.statechange",[{newState:c
}]))},this.callHeldWatcher=function(a,b,c){c!==b&&f._provider.trigger("interaction.callhold.statechange",[{newState:c}])},this.watch(this,"_videoMuted",this._videoMuteWatcher),this.watch(this,"_videoEnabled",this.videoEnabledWatcher),this.watch(this,"_callHeld",this.callHeldWatcher)}function d(a,b){return _.includes(b,a.getState())}function e(a,b){return _.includes(b,a.getNegotiatedDirection())}var f;c.prototype={isAudioMuted:function(a){var b=this._audioMuted;return a&&d(a,["remote_alerting","established","renegotiating","far_end_renegotiating"])&&(b=a.isAudioMuted()),b},muteAudio:function(a,b){this._audioMuted=b,a&&d(a,["remote_alerting","established","renegotiating","far_end_renegotiating"])&&b?this.doMuteAudio(a):a&&d(a,["remote_alerting","established","renegotiating","far_end_renegotiating"])&&!b?this.doUnmuteAudio(a):this._audioMuted=b},doMuteAudio:function(b){var c=b.getMuteCapability();c.isAllowed?b.muteAudio():a.Base.Logger.warn("CpProvider: mute audio capability not allowed ["+c.denialReason+"]")},doUnmuteAudio:function(b){var c=b.getUnmuteCapability();c.isAllowed?b.unmuteAudio():a.Base.Logger.warn("CpProvider: umute audio capability not allowed ["+c.denialReason+"]")},isVideoMuted:function(a){var b=this._videoMuted;return a&&d(a,["idle","established","renegotiating","far_end_renegotiating"])&&a.getVideoChannels()[0]&&(b=e(a.getVideoChannels()[0],["recvonly"])),b},muteVideo:function(b,c){b?d(b,["idle","established","renegotiating","far_end_renegotiating"])&&c?this.doMuteVideo(b):d(b,["idle","established","renegotiating","far_end_renegotiating"])&&!c?this.doUnmuteVideo(b):a.Base.Logger.warn("CpProvider: cannot set video muted ["+c+"] in current call state ["+b.getState()+"]"):this._videoEnabled?(a.Base.Logger.info("CpProvider: pre-call: setting video mute to "+c),this._videoMuted=c):a.Base.Logger.warn("CpProvider: cannot set video muted ["+c+"] because video is not enabled")},doMuteVideo:function(b){if(e(b.getVideoChannels()[0],["sendrecv"])){var c=b.getUpdateVideoModeReceiveOnlyCapability();c.isAllowed?b.setVideoMode(AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY).then(function(){f._videoMuted=!0},function(b){a.Base.Logger.error("CpProvider: error muting video ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: mute video capability not allowed ["+c.denialReason+"]")}else a.Base.Logger.warn("CpProvider: mute video capability not allowed [NEGOTIATED_MEDIA_DIRECTION_INVALID]")},doUnmuteVideo:function(b){if(e(b.getVideoChannels()[0],["recvonly"])){var c=b.getUpdateVideoModeSendReceiveCapability();c.isAllowed?b.setVideoMode(AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE).then(function(){f._videoMuted=!1},function(b){a.Base.Logger.error("CpProvider: error unmuting video ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: unmute video capability not allowed ["+c.denialReason+"]")}else a.Base.Logger.warn("CpProvider: unmute video capability not allowed [NEGOTIATED_MEDIA_DIRECTION_INVALID]")},isVideoEnabled:function(a){var b=this._videoEnabled;return a&&d(a,["idle","established","renegotiating","far_end_renegotiating"])&&a.getVideoChannels()[0]&&(b=e(a.getVideoChannels()[0],["sendrecv","recvonly","sendonly"])),b},enableVideo:function(b,c){b&&d(b,["idle","established","renegotiating","far_end_renegotiating"])&&c?this.doEnableVideo(b):b&&d(b,["idle","established","renegotiating","far_end_renegotiating"])&&!c?this.doDisableVideo(b):a.Base.Logger.warn("CpProvider: cannot change video enable state to ["+c+"] in current call state ["+b.getState()+"]")},doEnableVideo:function(b){var c=b.getUpdateVideoModeSendReceiveCapability();c.isAllowed?b.setVideoMode(AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE).then(function(){a.Base.Logger.info("CpProvider: enabled video"),f._videoEnabled=!0},function(b){a.Base.Logger.error("CpProvider: error enabling video ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: enable video capability not allowed ["+c.denialReason+"]")},doDisableVideo:function(b){var c=b.getUpdateVideoModeDisableCapability();c.isAllowed?b.setVideoMode(AvayaClientServices.Services.Call.VideoMode.DISABLE).then(function(){a.Base.Logger.info("CpProvider: disabled video"),f._videoEnabled=!1},function(b){a.Base.Logger.error("CpProvider: error inactivating video ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: disable video capability not allowed ["+c.denialReason+"]")},getStartingVideoMode:function(){var b=AvayaClientServices.Services.Call.VideoMode.SEND_RECEIVE;return this._videoEnabled?this._videoEnabled&&this._videoMuted?b=AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY:this._provider._deviceHandler.hasVideoDevice()||(a.Base.Logger.error("CP: cannot start a video call with SEND_RECEIVE mode, falling back to RECEIVE_ONLY mode"),b=AvayaClientServices.Services.Call.VideoMode.RECEIVE_ONLY):b=AvayaClientServices.Services.Call.VideoMode.INACTIVE,b},setDefaultMediaState:function(){this.unwatch(this,"_videoMuted"),this.unwatch(this,"_videoEnabled"),this.unwatch(this,"_callHeld"),this._audioMuted=!1,this._videoMuted=!1,this._videoEnabled=!0,this.watch(this,"_videoMuted",this._videoMuteWatcher),this.watch(this,"_videoEnabled",this.videoEnabledWatcher),this.watch(this,"_callHeld",this.callHeldWatcher)},isCallHeld:function(a){return a&&d(a,["held"])},holdCall:function(a,b){a&&d(a,["established"])?this.doHoldCall(a):a&&d(a,["held"])?this.doUnholdCall(a):this._callHeld=b},doHoldCall:function(b){var c=b.getHoldCapability();c.isAllowed?b.hold().then(function(){a.Base.Logger.info("CpProvider: Call held"),f._callHeld=!0},function(b){a.Base.Logger.error("CpProvider: error holding call ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: Hold capability not allowed ["+c.denialReason+"]")},doUnholdCall:function(b){var c=b.getUnholdCapability();c.isAllowed?b.unhold().then(function(){a.Base.Logger.info("CpProvider: Call unheld"),f._callHeld=!1},function(b){a.Base.Logger.error("CpProvider: error unholding call ["+b.getError()+"]")}):a.Base.Logger.warn("CpProvider: Unhold  capability not allowed ["+c.denialReason+"]")}},_.defaults(c.prototype,a.Base.Watcher.prototype),a.Providers.CP.Handlers.MediaOperationHandler=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(a,b){this._mediaServices=a,this._videoDevice=b,this._localSurface=d(this._videoDevice.localView,"local",!0),this._remoteSurface=d(this._videoDevice.remoteView,"remote",!0)}function d(b,c,d){var e=document.getElementById(b);if(_.isUndefined(e))a.Base.Logger.debug("CpProvider: no "+c+" video surface");else{if("div"===e.tagName.toLowerCase()){var f;"local"===c?f=document.getElementById("videoLocal"):"remote"===c&&(f=document.getElementById("videoRemote")),f.setAttribute("width","100%"),f.setAttribute("height","100%"),f.muted=d,e=f}else a.Base.Logger.debug("CpProvider: cannot use "+b+" as "+c+" video surface is not a div : invalid tag: "+tagName);if("video"===e.tagName.toLowerCase())return e;a.Base.Logger.debug("CpProvider: cannot use "+b+" as "+c+" video surface: invalid tag: "+tagName)}}function e(b,c,d){if(a.Base.Logger.debug("CpProvider: setting up "+d+" video surface."),console.log("CpProvider: stream = "+c),console.log("CpProvider: surface = "+b),b)if(c){var e=AvayaClientServices.Base.Utils.getBrowserType()===AvayaClientServices.Base.BrowserType.FIREFOX;if("local"===d&&e){var f=new MediaStream;c.getVideoTracks().forEach(function(a){f.addTrack(a)}),b.srcObject=f}else b.srcObject=c,console.log("CpProvider: Surface video width = "+b.videoWidth+" video height = "+b.videoHeight);b.style.display="block"}else b.style.display="none",a.Base.Logger.debug("CpProvider: no media stream to add to "+d+" video surface; hiding surface");else a.Base.Logger.debug("CpProvider: no surface to display "+d+" video stream")}function f(a){}c.prototype={getStreams:function(a){var b={local:null,remote:null},c=a[0];if(c){var d,e;switch(c.getNegotiatedDirection()){case AvayaClientServices.Services.Call.MediaDirection.RECV_ONLY:d=null,e=this._mediaServices.getVideoInterface().getRemoteMediaStream(c.getChannelId());break;case AvayaClientServices.Services.Call.MediaDirection.SEND_ONLY:d=this._mediaServices.getVideoInterface().getLocalMediaStream(c.getChannelId()),e=null;break;case AvayaClientServices.Services.Call.MediaDirection.SEND_RECV:d=this._mediaServices.getVideoInterface().getLocalMediaStream(c.getChannelId()),e=this._mediaServices.getVideoInterface().getRemoteMediaStream(c.getChannelId());break;case AvayaClientServices.Services.Call.MediaDirection.INACTIVE:break;case AvayaClientServices.Services.Call.MediaDirection.DISABLE:break;default:d=null,e=null}b.local=d,b.remote=e}return b},updateVideoSurfaces:function(a){var b=this.getStreams(a);b&&(e(this._localSurface,b.local,"local"),e(this._remoteSurface,b.remote,"remote"))},clearVideoSurface:function(){f(this._videoDevice.localView),f(this._videoDevice.remoteView)}},a.Providers.CP.Handlers.VideoHandler=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(){}c.prototype={parse:function(b){var c;switch(b){case a.Services.Work.DTMFTone.ZERO:c=AvayaClientServices.Services.Call.DTMFTone.ZERO;break;case a.Services.Work.DTMFTone.ONE:c=AvayaClientServices.Services.Call.DTMFTone.ONE;break;case a.Services.Work.DTMFTone.TWO:c=AvayaClientServices.Services.Call.DTMFTone.TWO;break;case a.Services.Work.DTMFTone.THREE:c=AvayaClientServices.Services.Call.DTMFTone.THREE;break;case a.Services.Work.DTMFTone.FOUR:c=AvayaClientServices.Services.Call.DTMFTone.FOUR;break;case a.Services.Work.DTMFTone.FIVE:c=AvayaClientServices.Services.Call.DTMFTone.FIVE;break;case a.Services.Work.DTMFTone.SIX:c=AvayaClientServices.Services.Call.DTMFTone.SIX;break;case a.Services.Work.DTMFTone.SEVEN:c=AvayaClientServices.Services.Call.DTMFTone.SEVEN;break;case a.Services.Work.DTMFTone.EIGHT:c=AvayaClientServices.Services.Call.DTMFTone.EIGHT;break;case a.Services.Work.DTMFTone.NINE:c=AvayaClientServices.Services.Call.DTMFTone.NINE;break;case a.Services.Work.DTMFTone.STAR:c=AvayaClientServices.Services.Call.DTMFTone.STAR;break;case a.Services.Work.DTMFTone.POUND:c=AvayaClientServices.Services.Call.DTMFTone.POUND;break;case a.Services.Work.DTMFTone.A:c=AvayaClientServices.Services.Call.DTMFTone.A;break;case a.Services.Work.DTMFTone.B:c=AvayaClientServices.Services.Call.DTMFTone.B;break;case a.Services.Work.DTMFTone.C:c=AvayaClientServices.Services.Call.DTMFTone.C;break;case a.Services.Work.DTMFTone.D:c=AvayaClientServices.Services.Call.DTMFTone.D}return c},getHighFrequency:function(b){switch(b){case a.Services.Work.DTMFTone.ONE:case a.Services.Work.DTMFTone.FOUR:case a.Services.Work.DTMFTone.SEVEN:case a.Services.Work.DTMFTone.STAR:return 1209;case a.Services.Work.DTMFTone.TWO:case a.Services.Work.DTMFTone.FIVE:case a.Services.Work.DTMFTone.EIGHT:case a.Services.Work.DTMFTone.ZERO:return 1336;case a.Services.Work.DTMFTone.THREE:case a.Services.Work.DTMFTone.SIX:case a.Services.Work.DTMFTone.NINE:case a.Services.Work.DTMFTone.POUND:return 1477;case a.Services.Work.DTMFTone.A:case a.Services.Work.DTMFTone.B:case a.Services.Work.DTMFTone.C:case a.Services.Work.DTMFTone.D:return 1633}return 500},getLowFrequency:function(b){switch(b){case a.Services.Work.DTMFTone.ONE:case a.Services.Work.DTMFTone.TWO:case a.Services.Work.DTMFTone.THREE:case a.Services.Work.DTMFTone.A:return 697;case a.Services.Work.DTMFTone.FOUR:case a.Services.Work.DTMFTone.FIVE:case a.Services.Work.DTMFTone.SIX:case a.Services.Work.DTMFTone.B:return 770;case a.Services.Work.DTMFTone.SEVEN:case a.Services.Work.DTMFTone.EIGHT:case a.Services.Work.DTMFTone.NINE:case a.Services.Work.DTMFTone.C:return 852;case a.Services.Work.DTMFTone.STAR:case a.Services.Work.DTMFTone.ZERO:case a.Services.Work.DTMFTone.POUND:case a.Services.Work.DTMFTone.D:return 941}return 500}},a.Providers.CP.Parsers.DtmfParser=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(){}c.prototype={parse:function(b){var c;switch(b){case AvayaClientServices.Services.Call.CallStates.IDLE:c=a.Services.Work.InteractionState.INITIATING;break;case AvayaClientServices.Services.Call.CallStates.INITIATING:c=a.Services.Work.InteractionState.INITIATING;break;case AvayaClientServices.Services.Call.CallStates.REMOTE_ALERTING:c=a.Services.Work.InteractionState.REMOTE_ALERTING;break;case AvayaClientServices.Services.Call.CallStates.ESTABLISHED:c=a.Services.Work.InteractionState.ESTABLISHED;break;case AvayaClientServices.Services.Call.CallStates.FAILED:c=a.Services.Work.InteractionState.FAILED;break;case AvayaClientServices.Services.Call.CallStates.ENDING:c=a.Services.Work.InteractionState.ENDING;break;case AvayaClientServices.Services.Call.CallStates.ENDED:c=a.Services.Work.InteractionState.ENDED;break;case AvayaClientServices.Services.Call.CallStates.RENEGOTIATING:c=a.Services.Work.InteractionState.ESTABLISHED;break;case AvayaClientServices.Services.Call.CallStates.FAR_END_RENEGOTIATING:c=a.Services.Work.InteractionState.ESTABLISHED;break;case AvayaClientServices.Services.Call.CallStates.BEING_TRANSFERRED:c=a.Services.Work.InteractionState.ESTABLISHED;break;case AvayaClientServices.Services.Call.CallStates.HELD:c=a.Services.Work.InteractionState.HELD}return c}},a.Providers.CP.Parsers.StateParser=c}(OceanaCustomerWebVoiceVideo,window),function(a,b){"use strict";function c(){this._amcProvider={}}c.prototype={getAmcProvider:function(){return b.isEmpty(this._amcProvider)?(this._amcProvider=new a.Providers.AMC.AmcProvider,this._amcProvider):this._amcProvider},getCallProvider:function(){if(!b.isEmpty(this._callProvider))return this._callProvider;var c=a.Base.Datastore.getInstance().config;return b.has(c,"webGatewayConfiguration")?(a.Base.Logger.log("Provider: CP"),this._callProvider=new a.Providers.CP.CpProvider(c.webGatewayConfiguration)):a.Base.Logger.error("Cannot start provider - missing configuration"),this._callProvider}},a.Providers.ProviderFactory=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";var c={BAD:1,POOR:2,FAIR:3,GOOD:4,EXCELLENT:5};a.Services.Devices.CallQuality=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";var c={RESOLUTION_416x240:"416x240",RESOLUTION_640x360:"640x360",RESOLUTION_848x480:"848x480",RESOLUTION_1280x720:"1280x720",RESOLUTION_1920x1080:"1920x1080"};a.Services.Devices.CameraResolution=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";function c(){this.cameraCaptureResolution=a.Services.Devices.CameraResolution.RESOLUTION_848x480,this.localView=void 0,this.remoteView=void 0}c.prototype={getCameraCaptureResolution:function(){return this.cameraCaptureResolution},setCameraCaptureResolution:function(a){this.cameraCaptureResolution=a},withCameraCaptureResolution:function(a){return this.cameraCaptureResolution=a,this},setLocalView:function(a){this.localView=a},withLocalView:function(a){return this.localView=a,this},setRemoteView:function(a){this.remoteView=a},withRemoteView:function(a){return this.remoteView=a,this}},a.Services.Devices.VideoDevice=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";function b(){this.name=void 0,this.values=[],this.routable=!0}b.prototype={withName:function(a){return this.name=a,this},withValues:function(a){return this.values=a,this}},a.Services.Work.Attributes.Attribute=b}(OceanaCustomerWebVoiceVideo),function(a,b){"use strict";function c(){a.Base.Datastore.getInstance().attributes=[]}function d(a){var b=!1;return!(!a.name||!a.values)||b}c.prototype={createAttribute:function(){return new a.Services.Work.Attributes.Attribute},isPresent:function(c){var d=b.indexOf(a.Base.Datastore.getInstance().attributes,c);return d!==-1},findAll:function(){return a.Base.Datastore.getInstance().attributes},upsert:function(c){if(d(c))if(this.isPresent(c)){var e=b.indexOf(a.Base.Datastore.getInstance().attributes,b.find(a.Base.Datastore.getInstance().attributes,c.name));a.Base.Datastore.getInstance().attributes.splice(e,1,c)}else a.Base.Datastore.getInstance().attributes.push(c);else a.Base.Logger.debug("Error Adding Attribute: invalid attribute supplied"),a.Base.Logger.debug(JSON.parse(JSON.stringify(c)))},upsertMultiple:function(c){var e=this;b.forEach(c,function(c){if(d(c))if(e.isPresent(c)){var f=b.indexOf(a.Base.Datastore.getInstance().attributes,b.find(a.Base.Datastore.getInstance().attributes,c.name));a.Base.Datastore.getInstance().attributes.splice(f,1,c)}else a.Base.Datastore.getInstance().attributes.push(c);else a.Base.Logger.debug("Error Adding Attribute: invalid attribute supplied"),a.Base.Logger.debug(JSON.parse(JSON.stringify(c)))})},"delete":function(c){if(d(c)){var e=b.indexOf(a.Base.Datastore.getInstance().attributes,c);e!==-1&&a.Base.Datastore.getInstance().attributes.splice(e,1)}else a.Base.Logger.debug("Error Removing Attribute: invalid attribute supplied"),a.Base.Logger.debug(JSON.parse(JSON.stringify(c)))},deleteMultiple:function(c){b.forEach(c,function(c){if(d(c)){var e=b.indexOf(a.Base.Datastore.getInstance().attributes,c);e!==-1&&a.Base.Datastore.getInstance().attributes.splice(e,1)}else a.Base.Logger.debug("Error Removing Attribute: invalid attribute supplied"),a.Base.Logger.debug(JSON.parse(JSON.stringify(c)))})},deleteAll:function(){a.Base.Datastore.getInstance().attributes=[]}},a.Services.Work.Attributes.AttributeList=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";var c={ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,STAR:10,POUND:11,A:12,B:13,C:14,D:15};a.Services.Work.DTMFTone=c}(OceanaCustomerWebVoiceVideo,_),function(a,b){"use strict";var c={IDLE:0,INITIATING:1,REMOTE_ALERTING:2,ESTABLISHED:4,ENDING:5,ENDED:6,FAILED:7,HELD:8};a.Services.Work.InteractionState=c}(OceanaCustomerWebVoiceVideo,_),function(a){"use strict";var b={AUDIO_ONLY:0,VIDEO:1};a.Services.Work.InteractionType=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";var b={OCEANA:"OCEANA",ELITE:"ELITE"};a.Services.Work.PlatformType=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(b){a.Base.Observable.call(this),f=this,this.destination=void 0,this.contextId=void 0,this.platformType=b,this.onAudioInteractionInitiating=new a.Base.Callbacks,this.onAudioInteractionRemoteAlerting=new a.Base.Callbacks,this.onAudioInteractionActive=new a.Base.Callbacks,this.onAudioInteractionCallQuality=new a.Base.Callbacks,this.onAudioInteractionEnded=new a.Base.Callbacks,this.onAudioInteractionFailed=new a.Base.Callbacks,this.onAudioInteractionAudioMuteStatusChanged=new a.Base.Callbacks,this.onAudioInteractionHoldStatusChanged=new a.Base.Callbacks,this.onAudioInteractionServiceConnected=new a.Base.Callbacks,this.onAudioInteractionServiceConnecting=new a.Base.Callbacks,this.onAudioInteractionServiceDisconnected=new a.Base.Callbacks;var c=new a.Providers.ProviderFactory;this.platformType===a.Services.Work.PlatformType.OCEANA&&(g=c.getAmcProvider()),h=c.getCallProvider()}function c(b){var c=f,d=!0;h.removeListeners("service"),h.removeListeners("interaction"),h.on("service.connected",function(){d===!0&&(d=!1,b()),c.onAudioInteractionServiceConnected.fire()}),h.on("service.connecting",function(){c.onAudioInteractionServiceConnecting.fire()}),h.on("service.disconnected",function(){c.onAudioInteractionServiceDisconnected.fire()}),h.on("interaction.failed",function(b){i&&g.endAmcSession(i.workRequestId),j=a.Services.Work.InteractionState.FAILED,c.onAudioInteractionFailed.fire(b),f.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.AUDIO_ONLY}])}),h.on("interaction.ended",function(){i&&g.endAmcSession(i.workRequestId),c.onAudioInteractionEnded.fire(),f.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.AUDIO_ONLY}])}),h.on("interaction.active",function(){c.onAudioInteractionActive.fire()}),h.on("interaction.alerting",function(){c.onAudioInteractionRemoteAlerting.fire()}),h.on("interaction.getCallQuality",function(a){c.onAudioInteractionCallQuality.fire(a)}),h.on("interaction.audiomute.statechange",function(a){c.onAudioInteractionAudioMuteStatusChanged.fire(a.newState)}),h.on("interaction.callhold.statechange",function(a){c.onAudioInteractionHoldStatusChanged.fire(a.newState)}),h.start(a.Services.Work.InteractionType.AUDIO_ONLY,null)}function d(a){return h.performOperation(a)}function e(a){return h.performMediaOperation(a)}var f,g,h,i,j=a.Services.Work.InteractionState.IDLE;b.prototype={getAuthorizationToken:function(){return a.Base.Datastore.getInstance().authToken||""},setAuthorizationToken:function(b){a.Base.Datastore.getInstance().authToken=b},discard:function(){h.stop()},getDestinationAddress:function(){return this.destination},setDestinationAddress:function(b){var c=/^\+?(0|[1-9]\d*)$/.test(b);c?this.destination=b:(this.destination=void 0,a.Base.Logger.error("AUDIO INTERACTION: invalid destination supplied, please provide a number"))},getPlatformType:function(){return this.platformType||a.Services.Work.PlatformType.OCEANA},setPlatformType:function(a){this.platformType=a},getContextId:function(){return this.contextId},setContextId:function(a){this.contextId=a},start:function(){return a.Base.Datastore.getInstance().authToken?void c(function(){var b=f;if(j=a.Services.Work.InteractionState.IDLE,b.onAudioInteractionInitiating.fire(),b.getPlatformType()===a.Services.Work.PlatformType.OCEANA){var c=g.createAmcSession(a.Services.Work.InteractionType.AUDIO_ONLY);c.then(function(c){j=a.Services.Work.InteractionState.INITIATING,a.Base.Logger.log("AUDIO INTERACTION: amc session created"),a.Base.Logger.log("AUDIO INTERACTION: amc response ["+c+"]"),i=JSON.parse(c),i.interactionType="WV",b.destination&&(i.amcRoutepoint=b.destination),f.trigger("interaction.new",[{type:a.Services.Work.InteractionType.AUDIO_ONLY}]),h.makeAudioCall(b.getPlatformType(),i)},function(c){j=a.Services.Work.InteractionState.FAILED,a.Base.Logger.error("AUDIO INTERACTION: amc session not created"),c.responseText&&a.Base.Logger.error("AUDIO INTERACTION: "+c.responseText),b.onAudioInteractionFailed.fire({reason:"request to AMC failed"})})}else{j=a.Services.Work.InteractionState.INITIATING,f.trigger("interaction.new",[{type:a.Services.Work.InteractionType.AUDIO_ONLY}]);var d={destination:b.destination,contextId:b.contextId,interactionType:""};h.makeAudioCall(b.getPlatformType(),d)}}):void a.Base.Logger.warn("AUDIO INTERACTION: Cannot start Audio Interaction! Authorization Token has not been set.")},end:function(){h.endCall(),f.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.AUDIO_ONLY}])},getInteractionState:function(){var b=d({name:a.Providers.Calls.CallOperations.GET_STATE});return b&&(j=b),j},getInteractionTimeElapsed:function(){return d({name:a.Providers.Calls.CallOperations.GET_DURATION})},sendDTMF:function(b){d({name:a.Providers.Calls.CallOperations.SEND_DTMF,tone:b})},isServiceAvailable:function(){return d({name:a.Providers.Calls.Call.Operations.IS_SERVICE_AVAILABLE})},isAudioMuted:function(){return e({name:a.Providers.Calls.MediaOperations.IS_AUDIO_MUTED})},muteAudio:function(b){e({name:a.Providers.Calls.MediaOperations.MUTE_AUDIO,muted:b})},holdCall:function(b){e({name:a.Providers.Calls.MediaOperations.HOLD_CALL,held:b})},isCallHeld:function(){return e({name:a.Providers.Calls.MediaOperations.IS_CALL_HELD})},isHeldRemotely:function(){return h.isHeldRemotely()},addOnAudioInteractionInitiatingCallback:function(a){this.onAudioInteractionInitiating.add(a)},addOnAudioInteractionRemoteAlertingCallback:function(a){this.onAudioInteractionRemoteAlerting.add(a)},addOnAudioInteractionCallQualityCallback:function(a){this.onAudioInteractionCallQuality.add(a)},addOnAudioInteractionActiveCallback:function(a){this.onAudioInteractionActive.add(a)},addOnAudioInteractionEndedCallback:function(a){this.onAudioInteractionEnded.add(a)},addOnAudioInteractionFailedCallback:function(a){this.onAudioInteractionFailed.add(a)},addOnAudioInteractionAudioMuteStatusChangedCallback:function(a){this.onAudioInteractionAudioMuteStatusChanged.add(a)},addOnAudioInteractionHoldStatusChangedCallback:function(a){this.onAudioInteractionHoldStatusChanged.add(a)},addOnAudioInteractionServiceConnectedCallback:function(a){this.onAudioInteractionServiceConnected.add(a)},addOnAudioInteractionServiceConnectingCallback:function(a){this.onAudioInteractionServiceConnecting.add(a)},addOnAudioInteractionServiceDisconnectedCallback:function(a){this.onAudioInteractionServiceDisconnected.add(a)},removeCallbacks:function(){this.onAudioInteractionInitiating.empty(),this.onAudioInteractionRemoteAlerting.empty(),this.onAudioInteractionCallQuality.empty(),this.onAudioInteractionActive.empty(),this.onAudioInteractionEnded.empty(),this.onAudioInteractionFailed.empty(),this.onAudioInteractionAudioMuteStatusChanged.empty(),this.onAudioInteractionHoldStatusChanged.empty(),this.onAudioInteractionServiceConnected.empty(),this.onAudioInteractionServiceConnecting.empty(),this.onAudioInteractionServiceDisconnected.empty()},readAudioDetails:function(a){h.readAudioDetails(a)}},_.defaults(b.prototype,a.Base.Observable.prototype),a.Services.Work.Interactions.AudioInteraction=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(b){a.Base.Observable.call(this),g=this,this.device=new a.Services.Devices.VideoDevice,this.destination=void 0,this.contextId=void 0,this.platformType=b,this.onVideoInteractionInitiating=new a.Base.Callbacks,this.onVideoInteractionRemoteAlerting=new a.Base.Callbacks,this.onVideoInteractionCallQuality=new a.Base.Callbacks,this.onVideoInteractionActive=new a.Base.Callbacks,this.onVideoInteractionEnded=new a.Base.Callbacks,this.onVideoInteractionFailed=new a.Base.Callbacks,this.onVideoInteractionAudioMuteStatusChanged=new a.Base.Callbacks,this.onVideoInteractionVideoMuteStatusChanged=new a.Base.Callbacks,this.onVideoInteractionVideoEnabledStatusChanged=new a.Base.Callbacks,this.onVideoInteractionHoldStatusChanged=new a.Base.Callbacks,this.onVideoInteractionServiceConnected=new a.Base.Callbacks,this.onVideoInteractionServiceConnecting=new a.Base.Callbacks,this.onVideoInteractionServiceDisconnected=new a.Base.Callbacks;var c=new a.Providers.ProviderFactory;this.platformType===a.Services.Work.PlatformType.OCEANA&&(h=c.getAmcProvider()),i=c.getCallProvider()}function c(b){var c=g,d=!0;i.removeListeners("service"),i.removeListeners("interaction"),i.on("service.connected",function(){d===!0&&(d=!1,b()),c.onVideoInteractionServiceConnected.fire()}),i.on("service.connecting",function(){c.onVideoInteractionServiceConnecting.fire()}),i.on("service.disconnected",function(){c.onVideoInteractionServiceDisconnected.fire()}),i.on("interaction.failed",function(b){j&&h.endAmcSession(j.workRequestId),k=a.Services.Work.InteractionState.FAILED,c.onVideoInteractionFailed.fire(b),g.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.VIDEO}])}),i.on("interaction.ended",function(){j&&h.endAmcSession(j.workRequestId),c.onVideoInteractionEnded.fire(),g.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.VIDEO}])}),i.on("interaction.active",function(){c.onVideoInteractionActive.fire()}),i.on("interaction.alerting",function(){c.onVideoInteractionRemoteAlerting.fire()}),i.on("interaction.getCallQuality",function(a){c.onVideoInteractionCallQuality.fire(a)}),i.on("interaction.audiomute.statechange",function(a){c.onVideoInteractionAudioMuteStatusChanged.fire(a.newState)}),i.on("interaction.videomute.statechange",function(a){c.onVideoInteractionVideoMuteStatusChanged.fire(a.newState)}),i.on("interaction.videoenabled.statechange",function(a){c.onVideoInteractionVideoEnabledStatusChanged.fire(a.newState)}),i.on("interaction.callhold.statechange",function(a){c.onVideoInteractionHoldStatusChanged.fire(a.newState)}),i.start(a.Services.Work.InteractionType.VIDEO,c.device)}function d(a){var b=!1;return console.log(a),a.cameraCaptureResolution&&a.localView&&a.remoteView&&(b=!0),b}function e(a){return i.performOperation(a)}function f(a){return i.performMediaOperation(a)}var g,h,i,j,k=a.Services.Work.InteractionState.IDLE;b.prototype={getAuthorizationToken:function(){return a.Base.Datastore.getInstance().authToken||""},setAuthorizationToken:function(b){a.Base.Datastore.getInstance().authToken=b},discard:function(){i.stop()},getVideoDevice:function(){return this.device},getDestinationAddress:function(){return this.destination},setDestinationAddress:function(b){var c=/^\+?(0|[1-9]\d*)$/.test(b);c?this.destination=b:(this.destination=void 0,a.Base.Logger.error("VIDEO INTERACTION: invalid destination supplied, please provide a number"))},getPlatformType:function(){return this.platformType||a.Services.Work.PlatformType.OCEANA},setPlatformType:function(a){this.platformType=a},getContextId:function(){return this.contextId},setContextId:function(a){this.contextId=a},start:function(){if(!a.Base.Datastore.getInstance().authToken)return void a.Base.Logger.warn("VIDEO INTERACTION: Cannot start Video Interaction! Authorization Token has not been set.");var b=this;c(function(){if(d(b.device))if(k=a.Services.Work.InteractionState.IDLE,b.onVideoInteractionInitiating.fire(),b.getPlatformType()===a.Services.Work.PlatformType.OCEANA){var c=h.createAmcSession(a.Services.Work.InteractionType.VIDEO);c.then(function(c){a.Base.Logger.log("VIDEO INTERACTION: amc session created"),a.Base.Logger.log("VIDEO INTERACTION: amc response ["+c+"]"),k=a.Services.Work.InteractionState.INITIATING,j=JSON.parse(c),j.interactionType="VI",b.destination&&(j.amcRoutepoint=b.destination),g.trigger("interaction.new",[{type:a.Services.Work.InteractionType.VIDEO}]),i.makeVideoCall(b.getPlatformType(),j,b.device)},function(c){k=a.Services.Work.InteractionState.FAILED,a.Base.Logger.error("VIDEO INTERACTION: amc session not created"),c.responseText&&a.Base.Logger.error("VIDEO INTERACTION: "+c.responseText),b.onVideoInteractionFailed.fire({reason:"request to AMC failed"})})}else{k=a.Services.Work.InteractionState.INITIATING,g.trigger("interaction.new",[{type:a.Services.Work.InteractionType.VIDEO}]);var e={destination:b.destination,contextId:b.contextId,interactionType:"VI"};i.makeVideoCall(b.getPlatformType(),e,b.device)}else a.Base.Logger.error("VIDEO INTERACTION: device configuration is invalid, cannot start interaction")})},end:function(){i.endCall(),g.trigger("interaction.ended",[{type:a.Services.Work.InteractionType.VIDEO}])},getInteractionState:function(){var b=e({name:a.Providers.Calls.CallOperations.GET_STATE});return b&&(k=b),k},getInteractionTimeElapsed:function(){return e({name:a.Providers.Calls.CallOperations.GET_DURATION})},sendDTMF:function(b){e({name:a.Providers.Calls.CallOperations.SEND_DTMF,tone:b})},isServiceAvailable:function(){return e({name:a.Providers.Calls.Call.Operations.IS_SERVICE_AVAILABLE})},isAudioMuted:function(){return f({name:a.Providers.Calls.MediaOperations.IS_AUDIO_MUTED})},muteAudio:function(b){f({name:a.Providers.Calls.MediaOperations.MUTE_AUDIO,muted:b})},holdCall:function(b){f({name:a.Providers.Calls.MediaOperations.HOLD_CALL,held:b})},isCallHeld:function(){return f({name:a.Providers.Calls.MediaOperations.IS_CALL_HELD})},isHeldRemotely:function(){return i.isHeldRemotely()},isVideoMuted:function(){return f({name:a.Providers.Calls.MediaOperations.IS_VIDEO_MUTED})},muteVideo:function(b){f({name:a.Providers.Calls.MediaOperations.MUTE_VIDEO,muted:b})},isVideoEnabled:function(){return f({name:a.Providers.Calls.MediaOperations.IS_VIDEO_ENABLED})},enableVideo:function(b){f({name:a.Providers.Calls.MediaOperations.ENABLE_VIDEO,enabled:b})},addOnVideoInteractionInitiatingCallback:function(a){this.onVideoInteractionInitiating.add(a)},addOnVideoInteractionRemoteAlertingCallback:function(a){this.onVideoInteractionRemoteAlerting.add(a)},addOnVideoInteractionCallQualityCallback:function(a){this.onVideoInteractionCallQuality.add(a)},addOnVideoInteractionActiveCallback:function(a){this.onVideoInteractionActive.add(a)},addOnVideoInteractionEndedCallback:function(a){this.onVideoInteractionEnded.add(a)},addOnVideoInteractionFailedCallback:function(a){this.onVideoInteractionFailed.add(a)},addOnVideoInteractionAudioMuteStatusChangedCallback:function(a){this.onVideoInteractionAudioMuteStatusChanged.add(a);
},addOnVideoInteractionVideoMuteStatusChangedCallback:function(a){this.onVideoInteractionVideoMuteStatusChanged.add(a)},addOnVideoInteractionVideoEnabledStatusChangedCallback:function(a){this.onVideoInteractionVideoEnabledStatusChanged.add(a)},addOnVideoInteractionHoldStatusChangedCallback:function(a){this.onVideoInteractionHoldStatusChanged.add(a)},addOnVideoInteractionServiceConnectedCallback:function(a){this.onVideoInteractionServiceConnected.add(a)},addOnVideoInteractionServiceConnectingCallback:function(a){this.onVideoInteractionServiceConnecting.add(a)},addOnVideoInteractionServiceDisconnectedCallback:function(a){this.onVideoInteractionServiceDisconnected.add(a)},removeCallbacks:function(){this.onVideoInteractionInitiating.empty(),this.onVideoInteractionRemoteAlerting.empty(),this.onVideoInteractionActive.empty(),this.onVideoInteractionEnded.empty(),this.onVideoInteractionFailed.empty(),this.onVideoInteractionCallQuality.empty(),this.onVideoInteractionAudioMuteStatusChanged.empty(),this.onVideoInteractionVideoMuteStatusChanged.empty(),this.onVideoInteractionVideoEnabledStatusChanged.empty(),this.onVideoInteractionHoldStatusChanged.empty(),this.onVideoInteractionServiceConnected.empty(),this.onVideoInteractionServiceConnecting.empty(),this.onVideoInteractionServiceDisconnected.empty()},readAudioDetails:function(a){i.readAudioDetails(a)},readVideoDetails:function(a){i.readVideoDetails(a)}},_.defaults(b.prototype,a.Base.Observable.prototype),a.Services.Work.Interactions.VideoInteraction=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){this.NativeResourceId=void 0,this.SourceName=void 0}b.prototype={getNativeResourceId:function(){return this.NativeResourceId},setNativeResourceId:function(a){this.NativeResourceId=a},getSourceName:function(){return this.SourceName},setSourceName:function(a){this.SourceName=a}},a.Services.Work.Schema.Resource=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){this.attributes=void 0,this.priority=void 0,this.rank=void 0,this.resourceCount=void 0,this.minProficiency=void 0,this.maxProficiency=void 0}b.prototype={getAttributes:function(){return this.attributes},setAttributes:function(a){this.attributes=a},getPriority:function(){return this.priority},setPriority:function(a){this.priority=a},getRank:function(){return this.rank},setRank:function(a){this.rank=a},getResourceCount:function(){return this.resourceCount},setResourceCount:function(a){this.resourceCount=a},getMinProficiency:function(){return this.minProficiency},setMinProficiency:function(a){this.minProficiency=a},getMaxProficiency:function(){return this.maxProficiency},setMaxProficiency:function(a){this.maxProficiency=a}},a.Services.Work.Schema.Service=b}(OceanaCustomerWebVoiceVideo),function(a){"use strict";function b(){a.Base.Datastore.clear()}function c(b,c){var d;return d="VIDEO"===b?new a.Services.Work.Interactions.VideoInteraction(c):new a.Services.Work.Interactions.AudioInteraction(c),d.on("interaction.new",function(a){f.push(a.type)}),d.on("interaction.ended",function(a){e(a.type)}),d}function d(){var b=!0;return f.indexOf(a.Services.Work.InteractionType.VIDEO)===-1&&f.indexOf(a.Services.Work.InteractionType.AUDIO_ONLY)===-1&&(b=!1),b}function e(a){var b=f.indexOf(a);b>-1&&f.splice(b,1)}var f=[];b.prototype={getWorkRequestId:function(){return a.Base.Datastore.getInstance().workRequest.id},setWorkRequestId:function(b){var c={provided:!0,id:b};a.Base.Datastore.getInstance().workRequest=c},getLocale:function(){return a.Base.Datastore.getInstance().locale},setLocale:function(b){a.Base.Datastore.getInstance().locale=b},getRoutingStrategy:function(){return a.Base.Datastore.getInstance().routingStrategy},setRoutingStrategy:function(b){a.Base.Datastore.getInstance().routingStrategy=b},getServices:function(){return a.Base.Datastore.getInstance().services},setServices:function(b){a.Base.Datastore.getInstance().services=b},getResources:function(){return a.Base.Datastore.getInstance().resources},setResources:function(b){a.Base.Datastore.getInstance().resources=b},getAttributes:function(){return new a.Services.Work.Attributes.AttributeList},getContext:function(){return a.Base.Datastore.getInstance().context},setContext:function(b){a.Base.Datastore.getInstance().context=b},getTopic:function(){return a.Base.Datastore.getInstance().topic},setTopic:function(b){a.Base.Datastore.getInstance().topic=b},createAudioInteraction:function(b){return d()?void a.Base.Logger.warn("WORK: Web Voice interaction already active"):c("AUDIO",b)},createVideoInteraction:function(b){return d()?void a.Base.Logger.warn("WORK: Video interaction already active"):c("VIDEO",b)}},a.Services.Work.Work=b}(OceanaCustomerWebVoiceVideo);